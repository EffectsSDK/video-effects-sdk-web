/*! For license information please see tsvb.js.LICENSE.txt */
var __webpack_modules__={9452:t=>{var e=Object.prototype.hasOwnProperty,r="~";function n(){}function i(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||t,o),u=r?r+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],a]:t._events[u].push(a):(t._events[u]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,n,i=[];if(0===this._eventsCount)return i;for(n in t=this._events)e.call(t,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,i,s,o){var a=r?r+t:t;if(!this._events[a])return!1;var u,l,c=this._events[a],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,i),!0;case 5:return c.fn.call(c.context,e,n,i,s),!0;case 6:return c.fn.call(c.context,e,n,i,s,o),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,d=c.length;for(l=0;l<d;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,n);break;case 4:c[l].fn.call(c[l].context,e,n,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},a.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,n,i){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var u=0,l=[],c=a.length;u<c;u++)(a[u].fn!==e||i&&!a[u].once||n&&a[u].context!==n)&&l.push(a[u]);l.length?this._events[s]=1===l.length?l[0]:l:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a},3161:function(t){var e;e=function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}return r.m=t,r.c=e,r.p="",r(0)}([function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.isNotPNG=function(t){return t===a},e.isNotAPNG=function(t){return t===u},e.default=function(t){var e=new Uint8Array(t);if(Array.prototype.some.call(l,(function(t,r){return t!==e[r]})))return a;var r=!1;if(c(e,(function(t){return!(r="acTL"===t)})),!r)return u;var n=[],i=[],s=null,h=null,v=0,y=new o.APNG;if(c(e,(function(t,e,r,a){var u=new DataView(e.buffer);switch(t){case"IHDR":s=e.subarray(r+8,r+8+a),y.width=u.getUint32(r+8),y.height=u.getUint32(r+12);break;case"acTL":y.numPlays=u.getUint32(r+8+4);break;case"fcTL":h&&(y.frames.push(h),v++),(h=new o.Frame).width=u.getUint32(r+8+4),h.height=u.getUint32(r+8+8),h.left=u.getUint32(r+8+12),h.top=u.getUint32(r+8+16);var l=u.getUint16(r+8+20),c=u.getUint16(r+8+22);0===c&&(c=100),h.delay=1e3*l/c,h.delay<=10&&(h.delay=100),y.playTime+=h.delay,h.disposeOp=u.getUint8(r+8+24),h.blendOp=u.getUint8(r+8+25),h.dataParts=[],0===v&&2===h.disposeOp&&(h.disposeOp=1);break;case"fdAT":h&&h.dataParts.push(e.subarray(r+8+4,r+8+a));break;case"IDAT":h&&h.dataParts.push(e.subarray(r+8,r+8+a));break;case"IEND":i.push(f(e,r,12+a));break;default:n.push(f(e,r,12+a))}})),h&&y.frames.push(h),0==y.frames.length)return u;var b=new Blob(n),_=new Blob(i);return y.frames.forEach((function(t){var e=[];e.push(l),s.set(p(t.width),0),s.set(p(t.height),4),e.push(d("IHDR",s)),e.push(b),t.dataParts.forEach((function(t){return e.push(d("IDAT",t))})),e.push(_),t.imageData=new Blob(e,{type:"image/png"}),delete t.dataParts,e=null})),y};var n,i=r(1),s=(n=i)&&n.__esModule?n:{default:n},o=r(2),a=new Error("Not a PNG"),u=new Error("Not an animated PNG"),l=new Uint8Array([137,80,78,71,13,10,26,10]);function c(t,e){var r=new DataView(t.buffer),n=8,i=void 0,s=void 0,o=void 0;do{s=r.getUint32(n),o=e(i=h(t,n+4,4),t,n,s),n+=12+s}while(!1!==o&&"IEND"!=i&&n<t.length)}function h(t,e,r){var n=Array.prototype.slice.call(t.subarray(e,e+r));return String.fromCharCode.apply(String,n)}function f(t,e,r){var n=new Uint8Array(r);return n.set(t.subarray(e,e+r)),n}var d=function(t,e){var r=t.length+e.length,n=new Uint8Array(r+8),i=new DataView(n.buffer);i.setUint32(0,e.length),n.set(function(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}(t),4),n.set(e,8);var o=(0,s.default)(n,4,r);return i.setUint32(r+4,o),n},p=function(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=-1,i=e,s=e+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e);i<s;i++)n=n>>>8^r[255&(n^t[i])];return~n};for(var r=new Uint32Array(256),n=0;n<256;n++){for(var i=n,s=0;s<8;s++)i=1&i?3988292384^i>>>1:i>>>1;r[n]=i}},function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.Frame=e.APNG=void 0;var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=r(3),o=(n=s)&&n.__esModule?n:{default:n};function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.APNG=function(){function t(){a(this,t),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[]}return i(t,[{key:"createImages",value:function(){return Promise.all(this.frames.map((function(t){return t.createImage()})))}},{key:"getPlayer",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.createImages().then((function(){return new o.default(e,t,r)}))}}]),t}(),e.Frame=function(){function t(){a(this,t),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.imageData=null,this.imageElement=null}return i(t,[{key:"createImage",value:function(){var t=this;return this.imageElement?Promise.resolve():new Promise((function(e,r){var n=URL.createObjectURL(t.imageData);t.imageElement=document.createElement("img"),t.imageElement.onload=function(){URL.revokeObjectURL(n),e()},t.imageElement.onerror=function(){URL.revokeObjectURL(n),t.imageElement=null,r(new Error("Image creation error"))},t.imageElement.src=n}))}}]),t}()},function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=r(4),o=function(t){function e(t,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.playbackRate=1,i._currentFrameNumber=0,i._ended=!1,i._paused=!0,i._numPlays=0,i._rafId=null,i._apng=t,i.context=r,i.stop(),n&&i.play(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length,this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,0!==this._apng.numPlays&&this._numPlays>=this._apng.numPlays&&(this._ended=!0,this._paused=!0)),this._prevFrame&&1==this._prevFrame.disposeOp?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&2==this._prevFrame.disposeOp&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var t=this.currentFrame;this._prevFrame=t,this._prevFrameData=null,2==t.disposeOp&&(this._prevFrameData=this.context.getImageData(t.left,t.top,t.width,t.height)),0==t.blendOp&&this.context.clearRect(t.left,t.top,t.width,t.height),this.context.drawImage(t.imageElement,t.left,t.top),this.emit("frame",this._currentFrameNumber),this._ended&&this.emit("end")}},{key:"play",value:function(){var t=this;this._rafId&&cancelAnimationFrame(this._rafId),this.emit("play"),this._ended&&this.stop(),this._paused=!1;var e=performance.now()+this.currentFrame.delay/this.playbackRate;this._rafId=requestAnimationFrame((function r(n){if(!t._ended&&!t._paused){if(n>=e){for(;n-e>=t._apng.playTime/t.playbackRate;)e+=t._apng.playTime/t.playbackRate,t._numPlays++;do{t.renderNextFrame(),e+=t.currentFrame.delay/t.playbackRate}while(!t._ended&&!t._paused&&n>e)}t._rafId=requestAnimationFrame(r)}}))}},{key:"pause",value:function(){this._paused||(this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null),this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null),this.emit("stop"),this._numPlays=0,this._ended=!1,this._paused=!0,this._currentFrameNumber=-1,this.context.clearRect(0,0,this._apng.width,this._apng.height),this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]),e}(((n=s)&&n.__esModule?n:{default:n}).default);e.default=o},function(t,e){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,r,o,a,u,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(s(r=this._events[t]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(i(r))for(a=Array.prototype.slice.call(arguments,1),o=(l=r.slice()).length,u=0;u<o;u++)l[u].apply(this,a);return!0},r.prototype.addListener=function(t,e){var o;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(o=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){if(!n(e))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(t,i),r||(r=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},r.prototype.removeListener=function(t,e){var r,s,o,a;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(o=(r=this._events[t]).length,s=-1,r===e||n(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(r)){for(a=o;a-- >0;)if(r[a]===e||r[a].listener&&r[a].listener===e){s=a;break}if(s<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[t]))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(n(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}}])},t.exports=e()},2505:(t,e,r)=>{t.exports=r(8015)},5592:(t,e,r)=>{var n=r(9516),i=r(7522),s=r(3948),o=r(9106),a=r(9615),u=r(2012),l=r(4202),c=r(7763),h=r(4896),f=r(1928);t.exports=function(t){return new Promise((function(e,r){var d,p=t.data,v=t.headers,y=t.responseType;function b(){t.cancelToken&&t.cancelToken.unsubscribe(d),t.signal&&t.signal.removeEventListener("abort",d)}n.isFormData(p)&&delete v["Content-Type"];var _=new XMLHttpRequest;if(t.auth){var m=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";v.Authorization="Basic "+btoa(m+":"+g)}var w=a(t.baseURL,t.url);function x(){if(_){var n="getAllResponseHeaders"in _?u(_.getAllResponseHeaders()):null,s={data:y&&"text"!==y&&"json"!==y?_.response:_.responseText,status:_.status,statusText:_.statusText,headers:n,config:t,request:_};i((function(t){e(t),b()}),(function(t){r(t),b()}),s),_=null}}if(_.open(t.method.toUpperCase(),o(w,t.params,t.paramsSerializer),!0),_.timeout=t.timeout,"onloadend"in _?_.onloadend=x:_.onreadystatechange=function(){_&&4===_.readyState&&(0!==_.status||_.responseURL&&0===_.responseURL.indexOf("file:"))&&setTimeout(x)},_.onabort=function(){_&&(r(c("Request aborted",t,"ECONNABORTED",_)),_=null)},_.onerror=function(){r(c("Network Error",t,null,_)),_=null},_.ontimeout=function(){var e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded",n=t.transitional||h;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),r(c(e,t,n.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",_)),_=null},n.isStandardBrowserEnv()){var T=(t.withCredentials||l(w))&&t.xsrfCookieName?s.read(t.xsrfCookieName):void 0;T&&(v[t.xsrfHeaderName]=T)}"setRequestHeader"in _&&n.forEach(v,(function(t,e){void 0===p&&"content-type"===e.toLowerCase()?delete v[e]:_.setRequestHeader(e,t)})),n.isUndefined(t.withCredentials)||(_.withCredentials=!!t.withCredentials),y&&"json"!==y&&(_.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&_.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&_.upload&&_.upload.addEventListener("progress",t.onUploadProgress),(t.cancelToken||t.signal)&&(d=function(t){_&&(r(!t||t&&t.type?new f("canceled"):t),_.abort(),_=null)},t.cancelToken&&t.cancelToken.subscribe(d),t.signal&&(t.signal.aborted?d():t.signal.addEventListener("abort",d))),p||(p=null),_.send(p)}))}},8015:(t,e,r)=>{var n=r(9516),i=r(9012),s=r(5155),o=r(5343);var a=function t(e){var r=new s(e),a=i(s.prototype.request,r);return n.extend(a,s.prototype,r),n.extend(a,r),a.create=function(r){return t(o(e,r))},a}(r(7412));a.Axios=s,a.Cancel=r(1928),a.CancelToken=r(3191),a.isCancel=r(3864),a.VERSION=r(9641).version,a.all=function(t){return Promise.all(t)},a.spread=r(7980),a.isAxiosError=r(5019),t.exports=a,t.exports.default=a},1928:t=>{function e(t){this.message=t}e.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},e.prototype.__CANCEL__=!0,t.exports=e},3191:(t,e,r)=>{var n=r(1928);function i(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var r=this;this.promise.then((function(t){if(r._listeners){var e,n=r._listeners.length;for(e=0;e<n;e++)r._listeners[e](t);r._listeners=null}})),this.promise.then=function(t){var e,n=new Promise((function(t){r.subscribe(t),e=t})).then(t);return n.cancel=function(){r.unsubscribe(e)},n},t((function(t){r.reason||(r.reason=new n(t),e(r.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]},i.prototype.unsubscribe=function(t){if(this._listeners){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}},i.source=function(){var t;return{token:new i((function(e){t=e})),cancel:t}},t.exports=i},3864:t=>{t.exports=function(t){return!(!t||!t.__CANCEL__)}},5155:(t,e,r)=>{var n=r(9516),i=r(9106),s=r(3471),o=r(4490),a=r(5343),u=r(4841),l=u.validators;function c(t){this.defaults=t,this.interceptors={request:new s,response:new s}}c.prototype.request=function(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{},(e=a(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var r=e.transitional;void 0!==r&&u.assertOptions(r,{silentJSONParsing:l.transitional(l.boolean),forcedJSONParsing:l.transitional(l.boolean),clarifyTimeoutError:l.transitional(l.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(i=i&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var s,c=[];if(this.interceptors.response.forEach((function(t){c.push(t.fulfilled,t.rejected)})),!i){var h=[o,void 0];for(Array.prototype.unshift.apply(h,n),h=h.concat(c),s=Promise.resolve(e);h.length;)s=s.then(h.shift(),h.shift());return s}for(var f=e;n.length;){var d=n.shift(),p=n.shift();try{f=d(f)}catch(t){p(t);break}}try{s=o(f)}catch(t){return Promise.reject(t)}for(;c.length;)s=s.then(c.shift(),c.shift());return s},c.prototype.getUri=function(t){return t=a(this.defaults,t),i(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(t){c.prototype[t]=function(e,r){return this.request(a(r||{},{method:t,url:e,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(t){c.prototype[t]=function(e,r,n){return this.request(a(n||{},{method:t,url:e,data:r}))}})),t.exports=c},3471:(t,e,r)=>{var n=r(9516);function i(){this.handlers=[]}i.prototype.use=function(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},i.prototype.forEach=function(t){n.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=i},9615:(t,e,r)=>{var n=r(9137),i=r(4680);t.exports=function(t,e){return t&&!n(e)?i(t,e):e}},7763:(t,e,r)=>{var n=r(5449);t.exports=function(t,e,r,i,s){var o=new Error(t);return n(o,e,r,i,s)}},4490:(t,e,r)=>{var n=r(9516),i=r(2881),s=r(3864),o=r(7412),a=r(1928);function u(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new a("canceled")}t.exports=function(t){return u(t),t.headers=t.headers||{},t.data=i.call(t,t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||o.adapter)(t).then((function(e){return u(t),e.data=i.call(t,e.data,e.headers,t.transformResponse),e}),(function(e){return s(e)||(u(t),e&&e.response&&(e.response.data=i.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},5449:t=>{t.exports=function(t,e,r,n,i){return t.config=e,r&&(t.code=r),t.request=n,t.response=i,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t}},5343:(t,e,r)=>{var n=r(9516);t.exports=function(t,e){e=e||{};var r={};function i(t,e){return n.isPlainObject(t)&&n.isPlainObject(e)?n.merge(t,e):n.isPlainObject(e)?n.merge({},e):n.isArray(e)?e.slice():e}function s(r){return n.isUndefined(e[r])?n.isUndefined(t[r])?void 0:i(void 0,t[r]):i(t[r],e[r])}function o(t){if(!n.isUndefined(e[t]))return i(void 0,e[t])}function a(r){return n.isUndefined(e[r])?n.isUndefined(t[r])?void 0:i(void 0,t[r]):i(void 0,e[r])}function u(r){return r in e?i(t[r],e[r]):r in t?i(void 0,t[r]):void 0}var l={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:u};return n.forEach(Object.keys(t).concat(Object.keys(e)),(function(t){var e=l[t]||s,i=e(t);n.isUndefined(i)&&e!==u||(r[t]=i)})),r}},7522:(t,e,r)=>{var n=r(7763);t.exports=function(t,e,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?e(n("Request failed with status code "+r.status,r.config,null,r.request,r)):t(r)}},2881:(t,e,r)=>{var n=r(9516),i=r(7412);t.exports=function(t,e,r){var s=this||i;return n.forEach(r,(function(r){t=r.call(s,t,e)})),t}},7412:(t,e,r)=>{var n=r(5606),i=r(9516),s=r(7018),o=r(5449),a=r(4896),u={"Content-Type":"application/x-www-form-urlencoded"};function l(t,e){!i.isUndefined(t)&&i.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var c,h={transitional:a,adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==n&&"[object process]"===Object.prototype.toString.call(n))&&(c=r(5592)),c),transformRequest:[function(t,e){return s(e,"Accept"),s(e,"Content-Type"),i.isFormData(t)||i.isArrayBuffer(t)||i.isBuffer(t)||i.isStream(t)||i.isFile(t)||i.isBlob(t)?t:i.isArrayBufferView(t)?t.buffer:i.isURLSearchParams(t)?(l(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):i.isObject(t)||e&&"application/json"===e["Content-Type"]?(l(e,"application/json"),function(t,e,r){if(i.isString(t))try{return(e||JSON.parse)(t),i.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(r||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional||h.transitional,r=e&&e.silentJSONParsing,n=e&&e.forcedJSONParsing,s=!r&&"json"===this.responseType;if(s||n&&i.isString(t)&&t.length)try{return JSON.parse(t)}catch(t){if(s){if("SyntaxError"===t.name)throw o(t,this,"E_JSON_PARSE");throw t}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],(function(t){h.headers[t]={}})),i.forEach(["post","put","patch"],(function(t){h.headers[t]=i.merge(u)})),t.exports=h},4896:t=>{t.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},9641:t=>{t.exports={version:"0.26.1"}},9012:t=>{t.exports=function(t,e){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return t.apply(e,r)}}},9106:(t,e,r)=>{var n=r(9516);function i(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,r){if(!e)return t;var s;if(r)s=r(e);else if(n.isURLSearchParams(e))s=e.toString();else{var o=[];n.forEach(e,(function(t,e){null!=t&&(n.isArray(t)?e+="[]":t=[t],n.forEach(t,(function(t){n.isDate(t)?t=t.toISOString():n.isObject(t)&&(t=JSON.stringify(t)),o.push(i(e)+"="+i(t))})))})),s=o.join("&")}if(s){var a=t.indexOf("#");-1!==a&&(t=t.slice(0,a)),t+=(-1===t.indexOf("?")?"?":"&")+s}return t}},4680:t=>{t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},3948:(t,e,r)=>{var n=r(9516);t.exports=n.isStandardBrowserEnv()?{write:function(t,e,r,i,s,o){var a=[];a.push(t+"="+encodeURIComponent(e)),n.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),n.isString(i)&&a.push("path="+i),n.isString(s)&&a.push("domain="+s),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},9137:t=>{t.exports=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}},5019:(t,e,r)=>{var n=r(9516);t.exports=function(t){return n.isObject(t)&&!0===t.isAxiosError}},4202:(t,e,r)=>{var n=r(9516);t.exports=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(t){var n=t;return e&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=i(window.location.href),function(e){var r=n.isString(e)?i(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}},7018:(t,e,r)=>{var n=r(9516);t.exports=function(t,e){n.forEach(t,(function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])}))}},2012:(t,e,r)=>{var n=r(9516),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,r,s,o={};return t?(n.forEach(t.split("\n"),(function(t){if(s=t.indexOf(":"),e=n.trim(t.substr(0,s)).toLowerCase(),r=n.trim(t.substr(s+1)),e){if(o[e]&&i.indexOf(e)>=0)return;o[e]="set-cookie"===e?(o[e]?o[e]:[]).concat([r]):o[e]?o[e]+", "+r:r}})),o):o}},7980:t=>{t.exports=function(t){return function(e){return t.apply(null,e)}}},4841:(t,e,r)=>{var n=r(9641).version,i={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){i[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}}));var s={};i.transitional=function(t,e,r){function i(t,e){return"[Axios v"+n+"] Transitional option '"+t+"'"+e+(r?". "+r:"")}return function(r,n,o){if(!1===t)throw new Error(i(n," has been removed"+(e?" in "+e:"")));return e&&!s[n]&&(s[n]=!0,console.warn(i(n," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,n,o)}},t.exports={assertOptions:function(t,e,r){if("object"!=typeof t)throw new TypeError("options must be an object");for(var n=Object.keys(t),i=n.length;i-- >0;){var s=n[i],o=e[s];if(o){var a=t[s],u=void 0===a||o(a,s,t);if(!0!==u)throw new TypeError("option "+s+" must be "+u)}else if(!0!==r)throw Error("Unknown option "+s)}},validators:i}},9516:(t,e,r)=>{var n=r(9012),i=Object.prototype.toString;function s(t){return Array.isArray(t)}function o(t){return void 0===t}function a(t){return"[object ArrayBuffer]"===i.call(t)}function u(t){return null!==t&&"object"==typeof t}function l(t){if("[object Object]"!==i.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function c(t){return"[object Function]"===i.call(t)}function h(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),s(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}t.exports={isArray:s,isArrayBuffer:a,isBuffer:function(t){return null!==t&&!o(t)&&null!==t.constructor&&!o(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"[object FormData]"===i.call(t)},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&a(t.buffer)},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:u,isPlainObject:l,isUndefined:o,isDate:function(t){return"[object Date]"===i.call(t)},isFile:function(t){return"[object File]"===i.call(t)},isBlob:function(t){return"[object Blob]"===i.call(t)},isFunction:c,isStream:function(t){return u(t)&&c(t.pipe)},isURLSearchParams:function(t){return"[object URLSearchParams]"===i.call(t)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:h,merge:function t(){var e={};function r(r,n){l(e[n])&&l(r)?e[n]=t(e[n],r):l(r)?e[n]=t({},r):s(r)?e[n]=r.slice():e[n]=r}for(var n=0,i=arguments.length;n<i;n++)h(arguments[n],r);return e},extend:function(t,e,r){return h(e,(function(e,i){t[i]=r&&"function"==typeof e?n(e,r):e})),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t}}},8380:(t,e,r)=>{r.d(e,{yy:()=>f,y$:()=>l});const n="3.5.0";function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function o(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==i(e)?e:e+""}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var l,c={overlay:!1,overlay_attrs:{url:"https://effectssdk.ai/assets/videos/overlay/esdk.mp4"},lowerthird:!1,lowerthird_type:"lowerthird_3",lowerthird_text:{text:{title:"Max Troshin",subtitle:"CEO at Effects SDK / effectssdk.com"}},lowerthird_color:{color:{primary:161271}},lowerthird_offset:{offset:{x:15/1280,y:75/720}},emoji_duration:{duration:3500},emoji_size:{size:.3},emoji_position:{position:{placement:"top-left"}},giphy_duration:{duration:3500},giphy_size:{size:.3},giphy_position:{position:{placement:"top-left"}},seg_mode:"balanced",background:"none",layout:"center",layout_custom:void 0,blur:!0,blur_power:.6,beautification:!0,beauty_power:.68,boundary:0,frameskipping:!1,sz_switch:!0,sz_facearea:.1,sz_drawface:!1,sz_drawprefaces:!1,sz_accuracy:.75,sz_smoothing:.2,sz_period:100,cc_switch:!1,cc_power:1,cc_part:1,cc_period:1e3,cf_switch:!1,cf_lut:{lut:"none"},cf_part:{part:1},cf_power:{power:1},cf_capacity:{capacity:5},sh_switch:!1,sh_power:.5},h=o((function t(){u(this,t)}));h.APP_ENV="web",h.API_URL="https://effectssdk.ai/sdk/session/",h.STATS_URL="https://effectssdk.ai/sdk/stats/",h.BASE_URL="https://effectssdk.ai/",h.SDK_URL=h.BASE_URL+"sdk/",h.VB_MODEL=h.SDK_URL+"models/model-1.2.1.0.tsvb",h.PRESET="balanced",h.DEMO_IMAGE=h.SDK_URL+"100.jpg",h.DEMO_VIDEO=h.SDK_URL+"video-background.mp4",function(t){t.VIRTUAL_BACKGROUND="VIRTUAL_BACKGROUND",t.SMART_ZOOM="SMART_ZOOM",t.CUSTOM_RESOLUTION="CUSTOM_RESOLUTION",t.LOW_LIGHT="LOW_LIGHT",t.COLOR_CORRECTION="COLOR_CORRECTION",t.COLOR_FILTER="COLOR_FILTER",t.SHARPNESS="SHARPNESS",t.MIRRORING="MIRRORING"}(l||(l={}));var f=function(){function t(){u(this,t)}return o(t,null,[{key:"isEffectExist",value:function(t){var e=new Map;e.set(l.COLOR_CORRECTION,"colorcorrector"),e.set(l.SMART_ZOOM,"facedetector"),e.set(l.LOW_LIGHT,"lowlighter");var r=this.EFFECTS.includes(t),n=e.get(t);return n&&(r=r&&this.MODELS[n]),r}},{key:"getModelUrl",value:function(e){return t.SDK_URL+e}},{key:"getPresetUrl",value:function(e){return t.SDK_URL+e}},{key:"setVersion",value:function(){t.VERSION=n}}])}();f.EFFECTS=[l.VIRTUAL_BACKGROUND,l.SMART_ZOOM,l.LOW_LIGHT,l.COLOR_CORRECTION,l.COLOR_FILTER,l.SHARPNESS,l.MIRRORING],f.VERSION="0.0.0",f.CUSTOMER_ID="",f.APP_ENV=h.APP_ENV,f.API_URL=h.API_URL,f.STATS_URL=h.STATS_URL,f.MODEL_URL=h.SDK_URL+"models/model-1.2.1.tsvb",f.PRESET=h.PRESET,f.SDK_URL=h.SDK_URL,f.MODELS={colorcorrector:"models/model-cc-1.0.0.tsvb",facedetector:"models/model-fd-1.1.0.tsvb",lowlighter:"models/model-ll-1.2.0.tsvb"},f.PROXY=!0,f.STATS=!1,f.PROVIDER="wasm",f.WASM_PATHS={},f.PRESETS={quality:"models/model-1.0.1.tsvb",balanced:"models/model-5.5.0.tsvb",speed:"models/model-3.1.1.tsvb",lightning:"models/model-4.0.1.tsvb"},f.PRESETS_PORTRAIT={quality:"models/m-model-1.0.1.tsvb",balanced:"models/m-model-5.5.0.tsvb",speed:"models/m-model-3.1.1.tsvb",lightning:"models/m-model-4.0.1.tsvb"},f.STATES_PRESET=c},9672:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function s(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}r.d(e,{By:()=>a,JK:()=>u,O4:()=>o,bv:()=>l});var o,a,u,l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return e=t,n=[{key:"getInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}],(r=[{key:"subscribe",value:function(t){var e="function"==typeof t;this.onErrorFunction=e?t:void 0}},{key:"notify",value:function(t){"function"==typeof this.onErrorFunction&&(t.emitter&&(t.message="[ ".concat(t.emitter," ]: ").concat(t.message)),t.type||(t.type=a.ERROR),this.onErrorFunction(t))}}])&&i(e.prototype,r),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,n}().getInstance();!function(t){t[t.GPU_DEVICE_LOST=1001]="GPU_DEVICE_LOST",t[t.APP_CREATION_ISSUE=1002]="APP_CREATION_ISSUE"}(o||(o={})),function(t){t.INFO="info",t.WARNING="warning",t.ERROR="error"}(a||(a={})),function(t){t.TSVB="tsvb",t.COMPONENTS_SYSTEM="components_system",t.SRTEAM_PROCESSOR="stream_processor",t.ML_INFERENCE="ml_inference",t.SESSION_MANAGER="session_manager",t.SESSION_RUNNER="session_runner",t.PRESET_INIT="preset_init",t.RENDERER="renderer",t.RECORDER="recorder",t.WORKER_TIMERS="worker_timers",t.EFFECT_VIRTUAL_BACKGROUND="effect_virtual_background",t.EFFECT_COLOR_CORRECTION="effect_color_correction",t.EFFECT_COLOR_FILTER="effect_color_filter",t.EFFECT_SMART_ZOOM="effect_smart_zoom",t.EFFECT_LOW_LIGHT="effect_low_light"}(u||(u={}))},7036:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function s(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}r.d(e,{P:()=>o});var o=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"createPromise",value:function(){var t=this;return this._promise=new Promise((function(e,r){t.resolver=e,t.rejecter=r})),this._promise}},{key:"promise",get:function(){return this._promise}},{key:"resolve",value:function(t){if("function"!=typeof this.resolver)return!1;this.resolver(t),this.resolver=void 0}},{key:"reject",value:function(t){if("function"!=typeof this.rejecter)return!1;this.rejecter(t),this.rejecter=void 0,this._promise=void 0}}],e&&i(t.prototype,e),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}()},6739:(t,e,r)=>{function n(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}r.d(e,{Y:()=>R,kc:()=>p,Uz:()=>d});var i=r(8380),s=r(2004),o=r(2505),a=r.n(o);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function l(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return c(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==u(e)?e:e+""}var d=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=[],this.delay=5e3,this.isRunning=!1,this.deferred=new Map},r=[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}],(e=[{key:"setCustomerID",value:function(t){this.customer_id=t}},{key:"push",value:function(t,e){var r=this;i.yy.STATS&&(this.checkRunning(t),this.isRunning?(clearTimeout(this.timer),this.data.push({feature:t,user_id:s.W.getInstance().getUID(this.customer_id),data:e}),this.timer=setTimeout((function(){return r.send()}),this.delay)):this.deferred.set(t,e))}},{key:"send",value:function(){var t=this,e=l(this.data);this.data=[];var r=i.yy.STATS_URL+this.customer_id,n={"Tsvb-Version":i.yy.VERSION};a().post(r,e,{headers:n}).catch((function(r){return t.data=[].concat(l(e),l(t.data)),r}))}},{key:"checkRunning",value:function(t){var e=this,r=s.W.getInstance().getUID(this.customer_id);"run"===t&&(this.isRunning=!0,this.deferred.forEach((function(t,n){e.data.push({feature:n,user_id:r,data:t})})),this.deferred.clear())}}])&&h(t.prototype,e),r&&h(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();function p(t){return function(e,r,i){var s=i.value;i.value=function(){var e=r+n(t);d.Instance.push(e);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return s.apply(this,o)}}}function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function b(t){var e=function(t,e){if("object"!=v(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==v(e)?e:e+""}var _=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},r=[{key:"isStattable",value:function(t,e){var r;return(null!==(r=this.FEATURES[t])&&void 0!==r?r:[]).includes(e)}}],(e=null)&&y(t.prototype,e),r&&y(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function g(){g=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new R(n||[]);return i(o,"_invoke",{value:A(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function w(){}var x={};l(x,o,(function(){return this}));var T=Object.getPrototypeOf,S=T&&T(T($([])));S&&S!==r&&n.call(S,o)&&(x=S);var E=w.prototype=b.prototype=Object.create(x);function O(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==m(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function A(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=C(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function C(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function $(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(m(e)+" is not iterable")}return _.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:_,configurable:!0}),_.displayName=l(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,l(t,u,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},O(P.prototype),l(P.prototype,a,(function(){return this})),e.AsyncIterator=P,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new P(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},O(E),l(E,u,"Generator"),l(E,o,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=$,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;I(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:$(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}_.FEATURES={recorder:["start","stop","pause","resume"],tsvb:["run","stop","enableBeautification","disableBeautification","setBlur","clearBlur","setBackground","clearBackground","enableSmartZoom","disableSmartZoom","enableColorCorrector","disableColorCorrector","enableFrameSkipping","disableFrameSkipping","setLayout","enableColorFilter","disableColorFilter","setSegmentationPreset","enableLowLightEffect","disableLowLightEffect","enableSharpnessEffect","disableSharpnessEffect"]},_.SDK_RUNNING_INTERVALS=[{feature:"run5",delay_ms:3e5},{feature:"run10",delay_ms:3e5},{feature:"run15",delay_ms:3e5},{feature:"run20",delay_ms:3e5}];var w=g().mark(S);function x(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return T(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function S(t){var e,r,n;return g().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:e=x(t),i.prev=1,e.s();case 3:if((r=e.n()).done){i.next=9;break}return n=r.value,i.next=7,n;case 7:i.next=3;break;case 9:i.next=14;break;case 11:i.prev=11,i.t0=i.catch(1),e.e(i.t0);case 14:return i.prev=14,e.f(),i.finish(14);case 17:case"end":return i.stop()}}),w,null,[[1,11,14,17]])}function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function O(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,P(n.key),n)}}function P(t){var e=function(t,e){if("object"!=E(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==E(e)?e:e+""}var A=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return e=t,i=[{key:"getInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}],(r=[{key:"setFeatureData",value:function(t,e){this.feature=e,this.type=t}},{key:"handle",value:function(){this.isDisableToPush()||(this.pushStat(),this.isSdkRunFeature()&&(clearTimeout(this.sdkRunningTimer),this.intervalIterator=S(_.SDK_RUNNING_INTERVALS),this.handleSdkRunningInterval()),this.isSdkStopFeature()&&clearTimeout(this.sdkRunningTimer))}},{key:"isDisableToPush",value:function(){return!_.isStattable(this.type,this.feature)||!!this.isEqualLastPushedFeature()}},{key:"pushStat",value:function(){var t=this.getFeatureName();d.Instance.push(t),this.lastPushedFeature=t}},{key:"getFeatureName",value:function(){var t="tsvb"!==this.type?n(this.type):"";return this.feature+t}},{key:"isSdkRunFeature",value:function(){return"tsvb"===this.type&&"run"===this.feature}},{key:"isSdkStopFeature",value:function(){return"tsvb"===this.type&&"stop"===this.feature}},{key:"isEqualLastPushedFeature",value:function(){return this.lastPushedFeature===this.getFeatureName()}},{key:"handleSdkRunningInterval",value:function(){var t=this.intervalIterator.next(),e=t.value;t.done||this.startSdkRunningTimer(e.feature,e.delay_ms)}},{key:"startSdkRunningTimer",value:function(t,e){var r=this;this.sdkRunningTimer=setTimeout((function(){d.Instance.push(t),r.handleSdkRunningInterval()}),e)}}])&&O(e.prototype,r),i&&O(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,i}().getInstance();function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function k(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return I(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function R(t){return function(e){var r,n=k(Object.getOwnPropertyNames(e.prototype));try{var i=function(){var n=r.value,i=Object.getOwnPropertyDescriptor(e.prototype,n);if(!i)return 0;var s=i.value;if(!(s instanceof Function))return 0;i.value=function(){A.setFeatureData(t,n),A.handle();for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var o=s.apply(this,r),a=function(){};if("object"===C(o)&&"function"==typeof o.then){var u=o.then(a);"function"==typeof u.catch&&u.catch((function(t){return t}))}return o},Object.defineProperty(e.prototype,n,i)};for(n.s();!(r=n.n()).done;)i()}catch(t){n.e(t)}finally{n.f()}}}},2004:(t,e,r)=>{function n(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}r.d(e,{W:()=>v});var i=function t(e,r){function i(t,i,s){if("undefined"!=typeof document){"number"==typeof(s=n({},r,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var a in s)s[a]&&(o+="; "+a,!0!==s[a]&&(o+="="+s[a].split(";")[0]));return document.cookie=t+"="+e.write(i,t)+o}}return Object.create({set:i,get:function(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var r=document.cookie?document.cookie.split("; "):[],n={},i=0;i<r.length;i++){var s=r[i].split("="),o=s.slice(1).join("=");try{var a=decodeURIComponent(s[0]);if(n[a]=e.read(o,a),t===a)break}catch(t){}}return t?n[t]:n}},remove:function(t,e){i(t,"",n({},e,{expires:-1}))},withAttributes:function(e){return t(this.converter,n({},this.attributes,e))},withConverter:function(e){return t(n({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(e)}})}({read:function(t){return'"'===t[0]&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let o;const a=new Uint8Array(16);function u(){if(!o&&(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!o))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(a)}const l=[];for(let t=0;t<256;++t)l.push((t+256).toString(16).slice(1));function c(t,e=0){return l[t[e+0]]+l[t[e+1]]+l[t[e+2]]+l[t[e+3]]+"-"+l[t[e+4]]+l[t[e+5]]+"-"+l[t[e+6]]+l[t[e+7]]+"-"+l[t[e+8]]+l[t[e+9]]+"-"+l[t[e+10]]+l[t[e+11]]+l[t[e+12]]+l[t[e+13]]+l[t[e+14]]+l[t[e+15]]}const h=function(t,e,r){if(s.randomUUID&&!e&&!t)return s.randomUUID();const n=(t=t||{}).random||(t.rng||u)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(let t=0;t<16;++t)e[r+t]=n[t];return e}return c(n)};function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,p(n.key),n)}}function p(t){var e=function(t,e){if("object"!=f(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==f(e)?e:e+""}var v=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return e=t,n=[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}],(r=[{key:"getUID",value:function(t){if(this._uid)return this._uid;var e=i.get("TSVB_UID");return e||(e=h(),i.set("TSVB_UID",e)),e}},{key:"setUID",value:function(t){this._uid=t}}])&&d(e.prototype,r),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,n}()},7526:(t,e)=>{e.byteLength=function(t){var e=a(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,s=a(t),o=s[0],u=s[1],l=new i(function(t,e,r){return 3*(e+r)/4-r}(0,o,u)),c=0,h=u>0?o-4:o;for(r=0;r<h;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],l[c++]=e>>16&255,l[c++]=e>>8&255,l[c++]=255&e;2===u&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,l[c++]=255&e);1===u&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,l[c++]=e>>8&255,l[c++]=255&e);return l},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,s=[],o=16383,a=0,l=n-i;a<l;a+=o)s.push(u(t,a,a+o>l?l:a+o));1===i?(e=t[n-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)r[o]=s[o],n[s.charCodeAt(o)]=o;function a(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function u(t,e,n){for(var i,s,o=[],a=e;a<n;a+=3)i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},8287:(t,e,r)=>{var n=r(7526),i=r(251),s=r(4634);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(o()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return l(this,t,e,r)}function l(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=f(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(e,r);t=a(t,n);var i=t.write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|d(e.length);return 0===(t=a(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?a(t,0):f(t,e);if("Buffer"===e.type&&s(e.data))return f(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(c(e),t=a(t,e<0?0:0|d(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function f(t,e){var r=e.length<0?0:0|d(e.length);t=a(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function p(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return j(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(t).length;default:if(n)return j(t).length;e=(""+e).toLowerCase(),n=!0}}function v(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return k(this,e,r);case"utf8":case"utf-8":return O(this,e,r);case"ascii":return A(this,e,r);case"latin1":case"binary":return C(this,e,r);case"base64":return E(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function y(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function b(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:_(t,e,r,n,i);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):_(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function _(t,e,r,n,i){var s,o=1,a=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,a/=2,u/=2,r/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var c=-1;for(s=r;s<a;s++)if(l(t,s)===l(e,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===u)return c*o}else-1!==c&&(s-=s-c),c=-1}else for(r+u>a&&(r=a-u),s=r;s>=0;s--){for(var h=!0,f=0;f<u;f++)if(l(t,s+f)!==l(e,f)){h=!1;break}if(h)return s}return-1}function m(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[r+o]=a}return o}function g(t,e,r,n){return G(j(e,t.length-r),t,r,n)}function w(t,e,r,n){return G(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function x(t,e,r,n){return w(t,e,r,n)}function T(t,e,r,n){return G(z(e),t,r,n)}function S(t,e,r,n){return G(function(t,e){for(var r,n,i,s=[],o=0;o<t.length&&!((e-=2)<0);++o)n=(r=t.charCodeAt(o))>>8,i=r%256,s.push(i),s.push(n);return s}(e,t.length-r),t,r,n)}function E(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function O(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var s,o,a,u,l=t[i],c=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=r)switch(h){case 1:l<128&&(c=l);break;case 2:128==(192&(s=t[i+1]))&&(u=(31&l)<<6|63&s)>127&&(c=u);break;case 3:s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&(u=(15&l)<<12|(63&s)<<6|63&o)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(u=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&u<1114112&&(c=u)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(t){var e=t.length;if(e<=P)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=P));return r}(n)}e.hp=u,e.IS=50,u.TYPED_ARRAY_SUPPORT=void 0!==r.g.TYPED_ARRAY_SUPPORT?r.g.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),o(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return l(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,n){return c(e),e<=0?a(t,e):void 0!==r?"string"==typeof n?a(t,e).fill(r,n):a(t,e).fill(r):a(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return h(null,t)},u.allocUnsafeSlow=function(t){return h(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)y(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?O(this,0,t):v.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.IS;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(e>>>=0),a=Math.min(s,o),l=this.slice(n,i),c=t.slice(e,r),h=0;h<a;++h)if(l[h]!==c[h]){s=l[h],o=c[h];break}return s<o?-1:o<s?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return b(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return b(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return m(this,t,e,r);case"utf8":case"utf-8":return g(this,t,e,r);case"ascii":return w(this,t,e,r);case"latin1":case"binary":return x(this,t,e,r);case"base64":return T(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var P=4096;function A(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function C(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function k(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=e;s<r;++s)i+=U(t[s]);return i}function I(t,e,r){for(var n=t.slice(e,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function R(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function $(t,e,r,n,i,s){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function M(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,s=Math.min(t.length-r,2);i<s;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function D(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,s=Math.min(t.length-r,4);i<s;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function B(t,e,r,n,i,s){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function L(t,e,r,n,s){return s||B(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function N(t,e,r,n,s){return s||B(t,0,r,8),i.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var i=e-t;r=new u(i,void 0);for(var s=0;s<i;++s)r[s]=this[s+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||R(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||R(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},u.prototype.readUInt8=function(t,e){return e||R(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||R(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||R(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||R(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||R(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||R(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||R(t,e,this.length);for(var n=e,i=1,s=this[t+--n];n>0&&(i*=256);)s+=this[t+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},u.prototype.readInt8=function(t,e){return e||R(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||R(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||R(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||R(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||R(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||R(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||R(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||R(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||R(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||$(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[e]=255&t;++s<r&&(i*=256);)this[e+s]=t/i&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||$(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||$(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||$(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||$(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||$(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):D(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||$(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);$(this,t,e,r,i-1,-i)}var s=0,o=1,a=0;for(this[e]=255&t;++s<r&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o|0)-a&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);$(this,t,e,r,i-1,-i)}var s=r-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o|0)-a&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||$(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||$(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||$(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||$(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):D(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||$(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return L(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return L(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return N(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return N(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,s=n-r;if(this===t&&r<e&&e<n)for(i=s-1;i>=0;--i)t[i+e]=this[i+r];else if(s<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+s),e);return s},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var s;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(s=e;s<r;++s)this[s]=t;else{var o=u.isBuffer(t)?t:j(new u(t,n).toString()),a=o.length;for(s=0;s<r-e;++s)this[s+e]=o[s%a]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function U(t){return t<16?"0"+t.toString(16):t.toString(16)}function j(t,e){var r;e=e||1/0;for(var n=t.length,i=null,s=[],o=0;o<n;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function z(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(F,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function G(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}},3144:(t,e,r)=>{var n=r(6743),i=r(1002),s=r(76),o=r(7119);t.exports=o||n.call(s,i)},1002:t=>{t.exports=Function.prototype.apply},76:t=>{t.exports=Function.prototype.call},3126:(t,e,r)=>{var n=r(6743),i=r(9675),s=r(76),o=r(3144);t.exports=function(t){if(t.length<1||"function"!=typeof t[0])throw new i("a function is required");return o(n,s,t)}},7119:t=>{t.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},6556:(t,e,r)=>{var n=r(453),i=r(3126),s=i([n("%String.prototype.indexOf%")]);t.exports=function(t,e){var r=n(t,!!e);return"function"==typeof r&&s(t,".prototype.")>-1?i([r]):r}},7176:(t,e,r)=>{var n,i=r(3126),s=r(5795);try{n=[].__proto__===Array.prototype}catch(t){if(!t||"object"!=typeof t||!("code"in t)||"ERR_PROTO_ACCESS"!==t.code)throw t}var o=!!n&&s&&s(Object.prototype,"__proto__"),a=Object,u=a.getPrototypeOf;t.exports=o&&"function"==typeof o.get?i([o.get]):"function"==typeof u&&function(t){return u(null==t?t:a(t))}},6570:t=>{function e(t,e,n){n=n||2;var s,o,a,u,h,f,p,v=e&&e.length,y=v?e[0]*n:t.length,b=r(t,0,y,n,!0),_=[];if(!b||b.next===b.prev)return _;if(v&&(b=function(t,e,n,i){var s,o,a,u=[];for(s=0,o=e.length;s<o;s++)(a=r(t,e[s]*i,s<o-1?e[s+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),u.push(d(a));for(u.sort(l),s=0;s<u.length;s++)n=c(u[s],n);return n}(t,e,b,n)),t.length>80*n){s=a=t[0],o=u=t[1];for(var m=n;m<y;m+=n)(h=t[m])<s&&(s=h),(f=t[m+1])<o&&(o=f),h>a&&(a=h),f>u&&(u=f);p=0!==(p=Math.max(a-s,u-o))?32767/p:0}return i(b,_,n,s,o,p,0),_}function r(t,e,r,n,i){var s,o;if(i===O(t,e,r,n)>0)for(s=e;s<r;s+=n)o=T(s,t[s],t[s+1],o);else for(s=r-n;s>=e;s-=n)o=T(s,t[s],t[s+1],o);return o&&b(o,o.next)&&(S(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!b(n,n.next)&&0!==y(n.prev,n,n.next))n=n.next;else{if(S(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function i(t,e,r,l,c,h,d){if(t){!d&&h&&function(t,e,r,n){var i=t;do{0===i.z&&(i.z=f(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,s,o,a,u,l=1;do{for(r=t,t=null,s=null,o=0;r;){for(o++,n=r,a=0,e=0;e<l&&(a++,n=n.nextZ);e++);for(u=l;a>0||u>0&&n;)0!==a&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,u--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;r=n}s.nextZ=null,l*=2}while(o>1)}(i)}(t,l,c,h);for(var p,v,y=t;t.prev!==t.next;)if(p=t.prev,v=t.next,h?o(t,l,c,h):s(t))e.push(p.i/r|0),e.push(t.i/r|0),e.push(v.i/r|0),S(t),t=v.next,y=v.next;else if((t=v)===y){d?1===d?i(t=a(n(t),e,r),e,r,l,c,h,2):2===d&&u(t,e,r,l,c,h):i(n(t),e,r,l,c,h,1);break}}}function s(t){var e=t.prev,r=t,n=t.next;if(y(e,r,n)>=0)return!1;for(var i=e.x,s=r.x,o=n.x,a=e.y,u=r.y,l=n.y,c=i<s?i<o?i:o:s<o?s:o,h=a<u?a<l?a:l:u<l?u:l,f=i>s?i>o?i:o:s>o?s:o,d=a>u?a>l?a:l:u>l?u:l,v=n.next;v!==e;){if(v.x>=c&&v.x<=f&&v.y>=h&&v.y<=d&&p(i,a,s,u,o,l,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function o(t,e,r,n){var i=t.prev,s=t,o=t.next;if(y(i,s,o)>=0)return!1;for(var a=i.x,u=s.x,l=o.x,c=i.y,h=s.y,d=o.y,v=a<u?a<l?a:l:u<l?u:l,b=c<h?c<d?c:d:h<d?h:d,_=a>u?a>l?a:l:u>l?u:l,m=c>h?c>d?c:d:h>d?h:d,g=f(v,b,e,r,n),w=f(_,m,e,r,n),x=t.prevZ,T=t.nextZ;x&&x.z>=g&&T&&T.z<=w;){if(x.x>=v&&x.x<=_&&x.y>=b&&x.y<=m&&x!==i&&x!==o&&p(a,c,u,h,l,d,x.x,x.y)&&y(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,T.x>=v&&T.x<=_&&T.y>=b&&T.y<=m&&T!==i&&T!==o&&p(a,c,u,h,l,d,T.x,T.y)&&y(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;x&&x.z>=g;){if(x.x>=v&&x.x<=_&&x.y>=b&&x.y<=m&&x!==i&&x!==o&&p(a,c,u,h,l,d,x.x,x.y)&&y(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;T&&T.z<=w;){if(T.x>=v&&T.x<=_&&T.y>=b&&T.y<=m&&T!==i&&T!==o&&p(a,c,u,h,l,d,T.x,T.y)&&y(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function a(t,e,r){var i=t;do{var s=i.prev,o=i.next.next;!b(s,o)&&_(s,i,i.next,o)&&w(s,o)&&w(o,s)&&(e.push(s.i/r|0),e.push(i.i/r|0),e.push(o.i/r|0),S(i),S(i.next),i=t=o),i=i.next}while(i!==t);return n(i)}function u(t,e,r,s,o,a){var u=t;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&v(u,l)){var c=x(u,l);return u=n(u,u.next),c=n(c,c.next),i(u,e,r,s,o,a,0),void i(c,e,r,s,o,a,0)}l=l.next}u=u.next}while(u!==t)}function l(t,e){return t.x-e.x}function c(t,e){var r=function(t,e){var r,n=e,i=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>o&&(o=a,r=n.x<n.next.x?n:n.next,a===i))return r}n=n.next}while(n!==e);if(!r)return null;var u,l=r,c=r.x,f=r.y,d=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&p(s<f?i:o,s,c,f,s<f?o:i,s,n.x,n.y)&&(u=Math.abs(s-n.y)/(i-n.x),w(n,t)&&(u<d||u===d&&(n.x>r.x||n.x===r.x&&h(r,n)))&&(r=n,d=u)),n=n.next}while(n!==l);return r}(t,e);if(!r)return e;var i=x(r,t);return n(i,i.next),n(r,r.next)}function h(t,e){return y(t.prev,t,e.prev)<0&&y(e.next,t,t.next)<0}function f(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function d(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function p(t,e,r,n,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(n-a)>=(r-o)*(e-a)&&(r-o)*(s-a)>=(i-o)*(n-a)}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&_(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(w(t,e)&&w(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(y(t.prev,t,e.prev)||y(t,e.prev,e))||b(t,e)&&y(t.prev,t,t.next)>0&&y(e.prev,e,e.next)>0)}function y(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function b(t,e){return t.x===e.x&&t.y===e.y}function _(t,e,r,n){var i=g(y(t,e,r)),s=g(y(t,e,n)),o=g(y(r,n,t)),a=g(y(r,n,e));return i!==s&&o!==a||(!(0!==i||!m(t,r,e))||(!(0!==s||!m(t,n,e))||(!(0!==o||!m(r,t,n))||!(0!==a||!m(r,e,n)))))}function m(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function g(t){return t>0?1:t<0?-1:0}function w(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function x(t,e){var r=new E(t.i,t.x,t.y),n=new E(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function T(t,e,r,n){var i=new E(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(t,e,r,n){for(var i=0,s=e,o=r-n;s<r;s+=n)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}t.exports=e,t.exports.default=e,e.deviation=function(t,e,r,n){var i=e&&e.length,s=i?e[0]*r:t.length,o=Math.abs(O(t,0,s,r));if(i)for(var a=0,u=e.length;a<u;a++){var l=e[a]*r,c=a<u-1?e[a+1]*r:t.length;o-=Math.abs(O(t,l,c,r))}var h=0;for(a=0;a<n.length;a+=3){var f=n[a]*r,d=n[a+1]*r,p=n[a+2]*r;h+=Math.abs((t[f]-t[p])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[p+1]-t[f+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},e.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)r.vertices.push(t[i][s][o]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r}},655:t=>{var e=Object.defineProperty||!1;if(e)try{e({},"a",{value:1})}catch(t){e=!1}t.exports=e},1237:t=>{t.exports=EvalError},9383:t=>{t.exports=Error},9290:t=>{t.exports=RangeError},9538:t=>{t.exports=ReferenceError},8068:t=>{t.exports=SyntaxError},9675:t=>{t.exports=TypeError},5345:t=>{t.exports=URIError},9612:t=>{t.exports=Object},228:t=>{var e=Object.prototype.hasOwnProperty,r="~";function n(){}function i(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||t,o),u=r?r+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],a]:t._events[u].push(a):(t._events[u]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,n,i=[];if(0===this._eventsCount)return i;for(n in t=this._events)e.call(t,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,i,s,o){var a=r?r+t:t;if(!this._events[a])return!1;var u,l,c=this._events[a],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,i),!0;case 5:return c.fn.call(c.context,e,n,i,s),!0;case 6:return c.fn.call(c.context,e,n,i,s,o),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,d=c.length;for(l=0;l<d;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,n);break;case 4:c[l].fn.call(c[l].context,e,n,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},a.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,n,i){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var u=0,l=[],c=a.length;u<c;u++)(a[u].fn!==e||i&&!a[u].once||n&&a[u].context!==n)&&l.push(a[u]);l.length?this._events[s]=1===l.length?l[0]:l:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a},8389:function(t,e){!function(t){var e=function(t){return function(e){var r=t(e);return e.add(r),r}},r=function(t){return function(e,r){return t.set(e,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,i=536870912,s=2*i,o=function(t,e){return function(r){var o=e.get(r),a=void 0===o?r.size:o<s?o+1:0;if(!r.has(a))return t(r,a);if(r.size<i){for(;r.has(a);)a=Math.floor(Math.random()*s);return t(r,a)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(a);)a=Math.floor(Math.random()*n);return t(r,a)}},a=new WeakMap,u=r(a),l=o(u,a),c=e(l);t.addUniqueNumber=c,t.generateUniqueNumber=l}(e)},1707:(t,e,r)=>{var n,i;void 0===(i="function"==typeof(n=function(){var t={172351395:{name:"EBML",type:"Container"},646:{name:"EBMLVersion",type:"Uint"},759:{name:"EBMLReadVersion",type:"Uint"},754:{name:"EBMLMaxIDLength",type:"Uint"},755:{name:"EBMLMaxSizeLength",type:"Uint"},642:{name:"DocType",type:"String"},647:{name:"DocTypeVersion",type:"Uint"},645:{name:"DocTypeReadVersion",type:"Uint"},108:{name:"Void",type:"Binary"},63:{name:"CRC-32",type:"Binary"},190023271:{name:"SignatureSlot",type:"Container"},16010:{name:"SignatureAlgo",type:"Uint"},16026:{name:"SignatureHash",type:"Uint"},16037:{name:"SignaturePublicKey",type:"Binary"},16053:{name:"Signature",type:"Binary"},15963:{name:"SignatureElements",type:"Container"},15995:{name:"SignatureElementList",type:"Container"},9522:{name:"SignedElement",type:"Binary"},139690087:{name:"Segment",type:"Container"},21863284:{name:"SeekHead",type:"Container"},3515:{name:"Seek",type:"Container"},5035:{name:"SeekID",type:"Binary"},5036:{name:"SeekPosition",type:"Uint"},88713574:{name:"Info",type:"Container"},13220:{name:"SegmentUID",type:"Binary"},13188:{name:"SegmentFilename",type:"String"},1882403:{name:"PrevUID",type:"Binary"},1868715:{name:"PrevFilename",type:"String"},2013475:{name:"NextUID",type:"Binary"},1999803:{name:"NextFilename",type:"String"},1092:{name:"SegmentFamily",type:"Binary"},10532:{name:"ChapterTranslate",type:"Container"},10748:{name:"ChapterTranslateEditionUID",type:"Uint"},10687:{name:"ChapterTranslateCodec",type:"Uint"},10661:{name:"ChapterTranslateID",type:"Binary"},710577:{name:"TimecodeScale",type:"Uint"},1161:{name:"Duration",type:"Float"},1121:{name:"DateUTC",type:"Date"},15273:{name:"Title",type:"String"},3456:{name:"MuxingApp",type:"String"},5953:{name:"WritingApp",type:"String"},103:{name:"Timecode",type:"Uint"},6228:{name:"SilentTracks",type:"Container"},6359:{name:"SilentTrackNumber",type:"Uint"},39:{name:"Position",type:"Uint"},43:{name:"PrevSize",type:"Uint"},35:{name:"SimpleBlock",type:"Binary"},32:{name:"BlockGroup",type:"Container"},33:{name:"Block",type:"Binary"},34:{name:"BlockVirtual",type:"Binary"},13729:{name:"BlockAdditions",type:"Container"},38:{name:"BlockMore",type:"Container"},110:{name:"BlockAddID",type:"Uint"},37:{name:"BlockAdditional",type:"Binary"},27:{name:"BlockDuration",type:"Uint"},122:{name:"ReferencePriority",type:"Uint"},123:{name:"ReferenceBlock",type:"Int"},125:{name:"ReferenceVirtual",type:"Int"},36:{name:"CodecState",type:"Binary"},13730:{name:"DiscardPadding",type:"Int"},14:{name:"Slices",type:"Container"},104:{name:"TimeSlice",type:"Container"},76:{name:"LaceNumber",type:"Uint"},77:{name:"FrameNumber",type:"Uint"},75:{name:"BlockAdditionID",type:"Uint"},78:{name:"Delay",type:"Uint"},79:{name:"SliceDuration",type:"Uint"},72:{name:"ReferenceFrame",type:"Container"},73:{name:"ReferenceOffset",type:"Uint"},74:{name:"ReferenceTimeCode",type:"Uint"},47:{name:"EncryptedBlock",type:"Binary"},106212971:{name:"Tracks",type:"Container"},46:{name:"TrackEntry",type:"Container"},87:{name:"TrackNumber",type:"Uint"},13253:{name:"TrackUID",type:"Uint"},3:{name:"TrackType",type:"Uint"},57:{name:"FlagEnabled",type:"Uint"},8:{name:"FlagDefault",type:"Uint"},5546:{name:"FlagForced",type:"Uint"},28:{name:"FlagLacing",type:"Uint"},11751:{name:"MinCache",type:"Uint"},11768:{name:"MaxCache",type:"Uint"},254851:{name:"DefaultDuration",type:"Uint"},216698:{name:"DefaultDecodedFieldDuration",type:"Uint"},209231:{name:"TrackTimecodeScale",type:"Float"},4991:{name:"TrackOffset",type:"Int"},5614:{name:"MaxBlockAdditionID",type:"Uint"},4974:{name:"Name",type:"String"},177564:{name:"Language",type:"String"},6:{name:"CodecID",type:"String"},9122:{name:"CodecPrivate",type:"Binary"},362120:{name:"CodecName",type:"String"},13382:{name:"AttachmentLink",type:"Uint"},1742487:{name:"CodecSettings",type:"String"},1785920:{name:"CodecInfoURL",type:"String"},438848:{name:"CodecDownloadURL",type:"String"},42:{name:"CodecDecodeAll",type:"Uint"},12203:{name:"TrackOverlay",type:"Uint"},5802:{name:"CodecDelay",type:"Uint"},5819:{name:"SeekPreRoll",type:"Uint"},9764:{name:"TrackTranslate",type:"Container"},9980:{name:"TrackTranslateEditionUID",type:"Uint"},9919:{name:"TrackTranslateCodec",type:"Uint"},9893:{name:"TrackTranslateTrackID",type:"Binary"},96:{name:"Video",type:"Container"},26:{name:"FlagInterlaced",type:"Uint"},5048:{name:"StereoMode",type:"Uint"},5056:{name:"AlphaMode",type:"Uint"},5049:{name:"OldStereoMode",type:"Uint"},48:{name:"PixelWidth",type:"Uint"},58:{name:"PixelHeight",type:"Uint"},5290:{name:"PixelCropBottom",type:"Uint"},5307:{name:"PixelCropTop",type:"Uint"},5324:{name:"PixelCropLeft",type:"Uint"},5341:{name:"PixelCropRight",type:"Uint"},5296:{name:"DisplayWidth",type:"Uint"},5306:{name:"DisplayHeight",type:"Uint"},5298:{name:"DisplayUnit",type:"Uint"},5299:{name:"AspectRatioType",type:"Uint"},963876:{name:"ColourSpace",type:"Binary"},1029411:{name:"GammaValue",type:"Float"},230371:{name:"FrameRate",type:"Float"},97:{name:"Audio",type:"Container"},53:{name:"SamplingFrequency",type:"Float"},14517:{name:"OutputSamplingFrequency",type:"Float"},31:{name:"Channels",type:"Uint"},15739:{name:"ChannelPositions",type:"Binary"},8804:{name:"BitDepth",type:"Uint"},98:{name:"TrackOperation",type:"Container"},99:{name:"TrackCombinePlanes",type:"Container"},100:{name:"TrackPlane",type:"Container"},101:{name:"TrackPlaneUID",type:"Uint"},102:{name:"TrackPlaneType",type:"Uint"},105:{name:"TrackJoinBlocks",type:"Container"},109:{name:"TrackJoinUID",type:"Uint"},64:{name:"TrickTrackUID",type:"Uint"},65:{name:"TrickTrackSegmentUID",type:"Binary"},70:{name:"TrickTrackFlag",type:"Uint"},71:{name:"TrickMasterTrackUID",type:"Uint"},68:{name:"TrickMasterTrackSegmentUID",type:"Binary"},11648:{name:"ContentEncodings",type:"Container"},8768:{name:"ContentEncoding",type:"Container"},4145:{name:"ContentEncodingOrder",type:"Uint"},4146:{name:"ContentEncodingScope",type:"Uint"},4147:{name:"ContentEncodingType",type:"Uint"},4148:{name:"ContentCompression",type:"Container"},596:{name:"ContentCompAlgo",type:"Uint"},597:{name:"ContentCompSettings",type:"Binary"},4149:{name:"ContentEncryption",type:"Container"},2017:{name:"ContentEncAlgo",type:"Uint"},2018:{name:"ContentEncKeyID",type:"Binary"},2019:{name:"ContentSignature",type:"Binary"},2020:{name:"ContentSigKeyID",type:"Binary"},2021:{name:"ContentSigAlgo",type:"Uint"},2022:{name:"ContentSigHashAlgo",type:"Uint"},206814059:{name:"Cues",type:"Container"},59:{name:"CuePoint",type:"Container"},51:{name:"CueTime",type:"Uint"},55:{name:"CueTrackPositions",type:"Container"},119:{name:"CueTrack",type:"Uint"},113:{name:"CueClusterPosition",type:"Uint"},112:{name:"CueRelativePosition",type:"Uint"},50:{name:"CueDuration",type:"Uint"},4984:{name:"CueBlockNumber",type:"Uint"},106:{name:"CueCodecState",type:"Uint"},91:{name:"CueReference",type:"Container"},22:{name:"CueRefTime",type:"Uint"},23:{name:"CueRefCluster",type:"Uint"},4959:{name:"CueRefNumber",type:"Uint"},107:{name:"CueRefCodecState",type:"Uint"},155296873:{name:"Attachments",type:"Container"},8615:{name:"AttachedFile",type:"Container"},1662:{name:"FileDescription",type:"String"},1646:{name:"FileName",type:"String"},1632:{name:"FileMimeType",type:"String"},1628:{name:"FileData",type:"Binary"},1710:{name:"FileUID",type:"Uint"},1653:{name:"FileReferral",type:"Binary"},1633:{name:"FileUsedStartTime",type:"Uint"},1634:{name:"FileUsedEndTime",type:"Uint"},4433776:{name:"Chapters",type:"Container"},1465:{name:"EditionEntry",type:"Container"},1468:{name:"EditionUID",type:"Uint"},1469:{name:"EditionFlagHidden",type:"Uint"},1499:{name:"EditionFlagDefault",type:"Uint"},1501:{name:"EditionFlagOrdered",type:"Uint"},54:{name:"ChapterAtom",type:"Container"},13252:{name:"ChapterUID",type:"Uint"},5716:{name:"ChapterStringUID",type:"String"},17:{name:"ChapterTimeStart",type:"Uint"},18:{name:"ChapterTimeEnd",type:"Uint"},24:{name:"ChapterFlagHidden",type:"Uint"},1432:{name:"ChapterFlagEnabled",type:"Uint"},11879:{name:"ChapterSegmentUID",type:"Binary"},11964:{name:"ChapterSegmentEditionUID",type:"Uint"},9155:{name:"ChapterPhysicalEquiv",type:"Uint"},15:{name:"ChapterTrack",type:"Container"},9:{name:"ChapterTrackNumber",type:"Uint"},0:{name:"ChapterDisplay",type:"Container"},5:{name:"ChapString",type:"String"},892:{name:"ChapLanguage",type:"String"},894:{name:"ChapCountry",type:"String"},10564:{name:"ChapProcess",type:"Container"},10581:{name:"ChapProcessCodecID",type:"Uint"},1293:{name:"ChapProcessPrivate",type:"Binary"},10513:{name:"ChapProcessCommand",type:"Container"},10530:{name:"ChapProcessTime",type:"Uint"},10547:{name:"ChapProcessData",type:"Binary"},39109479:{name:"Tags",type:"Container"},13171:{name:"Tag",type:"Container"},9152:{name:"Targets",type:"Container"},10442:{name:"TargetTypeValue",type:"Uint"},9162:{name:"TargetType",type:"String"},9157:{name:"TagTrackUID",type:"Uint"},9161:{name:"TagEditionUID",type:"Uint"},9156:{name:"TagChapterUID",type:"Uint"},9158:{name:"TagAttachmentUID",type:"Uint"},10184:{name:"SimpleTag",type:"Container"},1443:{name:"TagName",type:"String"},1146:{name:"TagLanguage",type:"String"},1156:{name:"TagDefault",type:"Uint"},1159:{name:"TagString",type:"String"},1157:{name:"TagBinary",type:"Binary"}};function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t}function r(t,e){this.name=t||"Unknown",this.type=e||"Unknown"}function n(t,e){r.call(this,t,e||"Uint")}function i(t){return t.length%2==1?"0"+t:t}function s(t,e){r.call(this,t,e||"Float")}function o(t,e){r.call(this,t,e||"Container")}function a(t){o.call(this,"File","File"),this.setSource(t)}function u(t,e,r,n){if("object"==typeof r&&(n=r,r=void 0),!r)return new Promise((function(r){u(t,e,r,n)}));try{var i=new FileReader;i.onloadend=function(){try{var s=new a(new Uint8Array(i.result));s.fixDuration(e,n)&&(t=s.toBlob(t.type))}catch(t){}r(t)},i.readAsArrayBuffer(t)}catch(e){r(t)}}return r.prototype.updateBySource=function(){},r.prototype.setSource=function(t){this.source=t,this.updateBySource()},r.prototype.updateByData=function(){},r.prototype.setData=function(t){this.data=t,this.updateByData()},e(n,r),n.prototype.updateBySource=function(){this.data="";for(var t=0;t<this.source.length;t++){var e=this.source[t].toString(16);this.data+=i(e)}},n.prototype.updateByData=function(){var t=this.data.length/2;this.source=new Uint8Array(t);for(var e=0;e<t;e++){var r=this.data.substr(2*e,2);this.source[e]=parseInt(r,16)}},n.prototype.getValue=function(){return parseInt(this.data,16)},n.prototype.setValue=function(t){this.setData(i(t.toString(16)))},e(s,r),s.prototype.getFloatArrayType=function(){return this.source&&4===this.source.length?Float32Array:Float64Array},s.prototype.updateBySource=function(){var t=this.source.reverse(),e=new(this.getFloatArrayType())(t.buffer);this.data=e[0]},s.prototype.updateByData=function(){var t=new(this.getFloatArrayType())([this.data]),e=new Uint8Array(t.buffer);this.source=e.reverse()},s.prototype.getValue=function(){return this.data},s.prototype.setValue=function(t){this.setData(t)},e(o,r),o.prototype.readByte=function(){return this.source[this.offset++]},o.prototype.readUint=function(){for(var t=this.readByte(),e=8-t.toString(2).length,r=t-(1<<7-e),n=0;n<e;n++)r*=256,r+=this.readByte();return r},o.prototype.updateBySource=function(){for(this.data=[],this.offset=0;this.offset<this.source.length;this.offset=a){var e=this.readUint(),i=this.readUint(),a=Math.min(this.offset+i,this.source.length),u=this.source.slice(this.offset,a),l=t[e]||{name:"Unknown",type:"Unknown"},c=r;switch(l.type){case"Container":c=o;break;case"Uint":c=n;break;case"Float":c=s}var h=new c(l.name,l.type);h.setSource(u),this.data.push({id:e,idHex:e.toString(16),data:h})}},o.prototype.writeUint=function(t,e){for(var r=1,n=128;t>=n&&r<8;r++,n*=128);if(!e)for(var i=n+t,s=r-1;s>=0;s--){var o=i%256;this.source[this.offset+s]=o,i=(i-o)/256}this.offset+=r},o.prototype.writeSections=function(t){this.offset=0;for(var e=0;e<this.data.length;e++){var r=this.data[e],n=r.data.source,i=n.length;this.writeUint(r.id,t),this.writeUint(i,t),t||this.source.set(n,this.offset),this.offset+=i}return this.offset},o.prototype.updateByData=function(){var t=this.writeSections("draft");this.source=new Uint8Array(t),this.writeSections()},o.prototype.getSectionById=function(t){for(var e=0;e<this.data.length;e++){var r=this.data[e];if(r.id===t)return r.data}return null},e(a,o),a.prototype.fixDuration=function(t,e){var r=e&&e.logger;void 0===r?r=function(t){console.log(t)}:r||(r=function(){});var n=this.getSectionById(139690087);if(!n)return r("[fix-webm-duration] Segment section is missing"),!1;var i=n.getSectionById(88713574);if(!i)return r("[fix-webm-duration] Info section is missing"),!1;var o=i.getSectionById(710577);if(!o)return r("[fix-webm-duration] TimecodeScale section is missing"),!1;var a=i.getSectionById(1161);if(a){if(!(a.getValue()<=0))return r(`[fix-webm-duration] Duration section is present, and the value is ${a.getValue()}`),!1;r(`[fix-webm-duration] Duration section is present, but the value is ${a.getValue()}`),a.setValue(t)}else r("[fix-webm-duration] Duration section is missing"),(a=new s("Duration","Float")).setValue(t),i.data.push({id:1161,data:a});return o.setValue(1e6),i.updateByData(),n.updateByData(),this.updateByData(),!0},a.prototype.toBlob=function(t){return new Blob([this.source.buffer],{type:t||"video/webm"})},u.default=u,u})?n.call(e,r,e,t):n)||(t.exports=i)},9353:t=>{var e=Object.prototype.toString,r=Math.max,n=function(t,e){for(var r=[],n=0;n<t.length;n+=1)r[n]=t[n];for(var i=0;i<e.length;i+=1)r[i+t.length]=e[i];return r};t.exports=function(t){var i=this;if("function"!=typeof i||"[object Function]"!==e.apply(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var s,o=function(t,e){for(var r=[],n=e||0,i=0;n<t.length;n+=1,i+=1)r[i]=t[n];return r}(arguments,1),a=r(0,i.length-o.length),u=[],l=0;l<a;l++)u[l]="$"+l;if(s=Function("binder","return function ("+function(t,e){for(var r="",n=0;n<t.length;n+=1)r+=t[n],n+1<t.length&&(r+=e);return r}(u,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var e=i.apply(this,n(o,arguments));return Object(e)===e?e:this}return i.apply(t,n(o,arguments))})),i.prototype){var c=function(){};c.prototype=i.prototype,s.prototype=new c,c.prototype=null}return s}},6743:(t,e,r)=>{var n=r(9353);t.exports=Function.prototype.bind||n},453:(t,e,r)=>{var n,i=r(9612),s=r(9383),o=r(1237),a=r(9290),u=r(9538),l=r(8068),c=r(9675),h=r(5345),f=r(1514),d=r(8968),p=r(6188),v=r(8002),y=r(5880),b=r(414),_=r(3093),m=Function,g=function(t){try{return m('"use strict"; return ('+t+").constructor;")()}catch(t){}},w=r(5795),x=r(655),T=function(){throw new c},S=w?function(){try{return T}catch(t){try{return w(arguments,"callee").get}catch(t){return T}}}():T,E=r(4039)(),O=r(3628),P=r(1064),A=r(8648),C=r(1002),k=r(76),I={},R="undefined"!=typeof Uint8Array&&O?O(Uint8Array):n,$={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":E&&O?O([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":I,"%AsyncGenerator%":I,"%AsyncGeneratorFunction%":I,"%AsyncIteratorPrototype%":I,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":s,"%eval%":eval,"%EvalError%":o,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":m,"%GeneratorFunction%":I,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":E&&O?O(O([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&E&&O?O((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":i,"%Object.getOwnPropertyDescriptor%":w,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":a,"%ReferenceError%":u,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&E&&O?O((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":E&&O?O(""[Symbol.iterator]()):n,"%Symbol%":E?Symbol:n,"%SyntaxError%":l,"%ThrowTypeError%":S,"%TypedArray%":R,"%TypeError%":c,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":h,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet,"%Function.prototype.call%":k,"%Function.prototype.apply%":C,"%Object.defineProperty%":x,"%Object.getPrototypeOf%":P,"%Math.abs%":f,"%Math.floor%":d,"%Math.max%":p,"%Math.min%":v,"%Math.pow%":y,"%Math.round%":b,"%Math.sign%":_,"%Reflect.getPrototypeOf%":A};if(O)try{null.error}catch(t){var M=O(O(t));$["%Error.prototype%"]=M}var D=function t(e){var r;if("%AsyncFunction%"===e)r=g("async function () {}");else if("%GeneratorFunction%"===e)r=g("function* () {}");else if("%AsyncGeneratorFunction%"===e)r=g("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var i=t("%AsyncGenerator%");i&&O&&(r=O(i.prototype))}return $[e]=r,r},B={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},L=r(6743),N=r(9957),F=L.call(k,Array.prototype.concat),U=L.call(C,Array.prototype.splice),j=L.call(k,String.prototype.replace),z=L.call(k,String.prototype.slice),G=L.call(k,RegExp.prototype.exec),V=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,H=/\\(\\)?/g,W=function(t,e){var r,n=t;if(N(B,n)&&(n="%"+(r=B[n])[0]+"%"),N($,n)){var i=$[n];if(i===I&&(i=D(n)),void 0===i&&!e)throw new c("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new l("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new c("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new c('"allowMissing" argument must be a boolean');if(null===G(/^%?[^%]*%?$/,t))throw new l("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(t){var e=z(t,0,1),r=z(t,-1);if("%"===e&&"%"!==r)throw new l("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new l("invalid intrinsic syntax, expected opening `%`");var n=[];return j(t,V,(function(t,e,r,i){n[n.length]=r?j(i,H,"$1"):e||t})),n}(t),n=r.length>0?r[0]:"",i=W("%"+n+"%",e),s=i.name,o=i.value,a=!1,u=i.alias;u&&(n=u[0],U(r,F([0,1],u)));for(var h=1,f=!0;h<r.length;h+=1){var d=r[h],p=z(d,0,1),v=z(d,-1);if(('"'===p||"'"===p||"`"===p||'"'===v||"'"===v||"`"===v)&&p!==v)throw new l("property names with quotes must have matching quotes");if("constructor"!==d&&f||(a=!0),N($,s="%"+(n+="."+d)+"%"))o=$[s];else if(null!=o){if(!(d in o)){if(!e)throw new c("base intrinsic for "+t+" exists, but the property is not available.");return}if(w&&h+1>=r.length){var y=w(o,d);o=(f=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:o[d]}else f=N(o,d),o=o[d];f&&!a&&($[s]=o)}}return o}},1064:(t,e,r)=>{var n=r(9612);t.exports=n.getPrototypeOf||null},8648:t=>{t.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},3628:(t,e,r)=>{var n=r(8648),i=r(1064),s=r(7176);t.exports=n?function(t){return n(t)}:i?function(t){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("getProto: not an object");return i(t)}:s?function(t){return s(t)}:null},6549:t=>{t.exports=Object.getOwnPropertyDescriptor},5795:(t,e,r)=>{var n=r(6549);if(n)try{n([],"length")}catch(t){n=null}t.exports=n},4039:(t,e,r)=>{var n="undefined"!=typeof Symbol&&Symbol,i=r(1333);t.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&i())))}},1333:t=>{t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(var n in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var i=Object.getOwnPropertySymbols(t);if(1!==i.length||i[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(t,e);if(42!==s.value||!0!==s.enumerable)return!1}return!0}},9957:(t,e,r)=>{var n=Function.prototype.call,i=Object.prototype.hasOwnProperty,s=r(6743);t.exports=s.call(n,i)},251:(t,e)=>{e.read=function(t,e,r,n,i){var s,o,a=8*i-n-1,u=(1<<a)-1,l=u>>1,c=-7,h=r?i-1:0,f=r?-1:1,d=t[e+h];for(h+=f,s=d&(1<<-c)-1,d>>=-c,c+=a;c>0;s=256*s+t[e+h],h+=f,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+t[e+h],h+=f,c-=8);if(0===s)s=1-l;else{if(s===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),s-=l}return(d?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,r,n,i,s){var o,a,u,l=8*s-i-1,c=(1<<l)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,p=n?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(a=0,o=c):o+h>=1?(a=(e*u-1)*Math.pow(2,i),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[r+d]=255&a,d+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[r+d]=255&o,d+=p,o/=256,l-=8);t[r+d-p]|=128*v}},4634:t=>{var e={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==e.call(t)}},1514:t=>{t.exports=Math.abs},8968:t=>{t.exports=Math.floor},4459:t=>{t.exports=Number.isNaN||function(t){return t!=t}},6188:t=>{t.exports=Math.max},8002:t=>{t.exports=Math.min},5880:t=>{t.exports=Math.pow},414:t=>{t.exports=Math.round},3093:(t,e,r)=>{var n=r(4459);t.exports=function(t){return n(t)||0===t?t:t<0?-1:1}},8859:(t,e,r)=>{var n="function"==typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=n&&i&&"function"==typeof i.get?i.get:null,o=n&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,u=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=a&&u&&"function"==typeof u.get?u.get:null,c=a&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,f="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,d="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,v=Object.prototype.toString,y=Function.prototype.toString,b=String.prototype.match,_=String.prototype.slice,m=String.prototype.replace,g=String.prototype.toUpperCase,w=String.prototype.toLowerCase,x=RegExp.prototype.test,T=Array.prototype.concat,S=Array.prototype.join,E=Array.prototype.slice,O=Math.floor,P="function"==typeof BigInt?BigInt.prototype.valueOf:null,A=Object.getOwnPropertySymbols,C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,k="function"==typeof Symbol&&"object"==typeof Symbol.iterator,I="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===k||"symbol")?Symbol.toStringTag:null,R=Object.prototype.propertyIsEnumerable,$=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function M(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||x.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var n=t<0?-O(-t):O(t);if(n!==t){var i=String(n),s=_.call(e,i.length+1);return m.call(i,r,"$&_")+"."+m.call(m.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return m.call(e,r,"$&_")}var D=r(2634),B=D.custom,L=V(B)?B:null,N={__proto__:null,double:'"',single:"'"},F={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function U(t,e,r){var n=r.quoteStyle||e,i=N[n];return i+t+i}function j(t){return m.call(String(t),/"/g,"&quot;")}function z(t){return!("[object Array]"!==q(t)||I&&"object"==typeof t&&I in t)}function G(t){return!("[object RegExp]"!==q(t)||I&&"object"==typeof t&&I in t)}function V(t){if(k)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!C)return!1;try{return C.call(t),!0}catch(t){}return!1}t.exports=function t(e,n,i,a){var u=n||{};if(W(u,"quoteStyle")&&!W(N,u.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(W(u,"maxStringLength")&&("number"==typeof u.maxStringLength?u.maxStringLength<0&&u.maxStringLength!==1/0:null!==u.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var v=!W(u,"customInspect")||u.customInspect;if("boolean"!=typeof v&&"symbol"!==v)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(W(u,"indent")&&null!==u.indent&&"\t"!==u.indent&&!(parseInt(u.indent,10)===u.indent&&u.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(W(u,"numericSeparator")&&"boolean"!=typeof u.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var g=u.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return K(e,u);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var x=String(e);return g?M(e,x):x}if("bigint"==typeof e){var O=String(e)+"n";return g?M(e,O):O}var A=void 0===u.depth?5:u.depth;if(void 0===i&&(i=0),i>=A&&A>0&&"object"==typeof e)return z(e)?"[Array]":"[Object]";var B=function(t,e){var r;if("\t"===t.indent)r="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;r=S.call(Array(t.indent+1)," ")}return{base:r,prev:S.call(Array(e+1),r)}}(u,i);if(void 0===a)a=[];else if(Y(a,e)>=0)return"[Circular]";function F(e,r,n){if(r&&(a=E.call(a)).push(r),n){var s={depth:u.depth};return W(u,"quoteStyle")&&(s.quoteStyle=u.quoteStyle),t(e,s,i+1,a)}return t(e,u,i+1,a)}if("function"==typeof e&&!G(e)){var H=function(t){if(t.name)return t.name;var e=b.call(y.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(e),X=et(e,F);return"[Function"+(H?": "+H:" (anonymous)")+"]"+(X.length>0?" { "+S.call(X,", ")+" }":"")}if(V(e)){var rt=k?m.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):C.call(e);return"object"!=typeof e||k?rt:Z(rt)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(e)){for(var nt="<"+w.call(String(e.nodeName)),it=e.attributes||[],st=0;st<it.length;st++)nt+=" "+it[st].name+"="+U(j(it[st].value),"double",u);return nt+=">",e.childNodes&&e.childNodes.length&&(nt+="..."),nt+="</"+w.call(String(e.nodeName))+">"}if(z(e)){if(0===e.length)return"[]";var ot=et(e,F);return B&&!function(t){for(var e=0;e<t.length;e++)if(Y(t[e],"\n")>=0)return!1;return!0}(ot)?"["+tt(ot,B)+"]":"[ "+S.call(ot,", ")+" ]"}if(function(t){return!("[object Error]"!==q(t)||I&&"object"==typeof t&&I in t)}(e)){var at=et(e,F);return"cause"in Error.prototype||!("cause"in e)||R.call(e,"cause")?0===at.length?"["+String(e)+"]":"{ ["+String(e)+"] "+S.call(at,", ")+" }":"{ ["+String(e)+"] "+S.call(T.call("[cause]: "+F(e.cause),at),", ")+" }"}if("object"==typeof e&&v){if(L&&"function"==typeof e[L]&&D)return D(e,{depth:A-i});if("symbol"!==v&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!s||!t||"object"!=typeof t)return!1;try{s.call(t);try{l.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}(e)){var ut=[];return o&&o.call(e,(function(t,r){ut.push(F(r,e,!0)+" => "+F(t,e))})),Q("Map",s.call(e),ut,B)}if(function(t){if(!l||!t||"object"!=typeof t)return!1;try{l.call(t);try{s.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}(e)){var lt=[];return c&&c.call(e,(function(t){lt.push(F(t,e))})),Q("Set",l.call(e),lt,B)}if(function(t){if(!h||!t||"object"!=typeof t)return!1;try{h.call(t,h);try{f.call(t,f)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}(e))return J("WeakMap");if(function(t){if(!f||!t||"object"!=typeof t)return!1;try{f.call(t,f);try{h.call(t,h)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}(e))return J("WeakSet");if(function(t){if(!d||!t||"object"!=typeof t)return!1;try{return d.call(t),!0}catch(t){}return!1}(e))return J("WeakRef");if(function(t){return!("[object Number]"!==q(t)||I&&"object"==typeof t&&I in t)}(e))return Z(F(Number(e)));if(function(t){if(!t||"object"!=typeof t||!P)return!1;try{return P.call(t),!0}catch(t){}return!1}(e))return Z(F(P.call(e)));if(function(t){return!("[object Boolean]"!==q(t)||I&&"object"==typeof t&&I in t)}(e))return Z(p.call(e));if(function(t){return!("[object String]"!==q(t)||I&&"object"==typeof t&&I in t)}(e))return Z(F(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&e===globalThis||void 0!==r.g&&e===r.g)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==q(t)||I&&"object"==typeof t&&I in t)}(e)&&!G(e)){var ct=et(e,F),ht=$?$(e)===Object.prototype:e instanceof Object||e.constructor===Object,ft=e instanceof Object?"":"null prototype",dt=!ht&&I&&Object(e)===e&&I in e?_.call(q(e),8,-1):ft?"Object":"",pt=(ht||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(dt||ft?"["+S.call(T.call([],dt||[],ft||[]),": ")+"] ":"");return 0===ct.length?pt+"{}":B?pt+"{"+tt(ct,B)+"}":pt+"{ "+S.call(ct,", ")+" }"}return String(e)};var H=Object.prototype.hasOwnProperty||function(t){return t in this};function W(t,e){return H.call(t,e)}function q(t){return v.call(t)}function Y(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function K(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return K(_.call(t,0,e.maxStringLength),e)+n}var i=F[e.quoteStyle||"single"];return i.lastIndex=0,U(m.call(m.call(t,i,"\\$1"),/[\x00-\x1f]/g,X),"single",e)}function X(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+g.call(e.toString(16))}function Z(t){return"Object("+t+")"}function J(t){return t+" { ? }"}function Q(t,e,r,n){return t+" ("+e+") {"+(n?tt(r,n):S.call(r,", "))+"}"}function tt(t,e){if(0===t.length)return"";var r="\n"+e.prev+e.base;return r+S.call(t,","+r)+"\n"+e.prev}function et(t,e){var r=z(t),n=[];if(r){n.length=t.length;for(var i=0;i<t.length;i++)n[i]=W(t,i)?e(t[i],t):""}var s,o="function"==typeof A?A(t):[];if(k){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var u in t)W(t,u)&&(r&&String(Number(u))===u&&u<t.length||k&&s["$"+u]instanceof Symbol||(x.call(/[^\w$]/,u)?n.push(e(u,t)+": "+e(t[u],t)):n.push(u+": "+e(t[u],t))));if("function"==typeof A)for(var l=0;l<o.length;l++)R.call(t,o[l])&&n.push("["+e(o[l])+"]: "+e(t[o[l]],t));return n}},5606:t=>{var e,r,n=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===i||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:i}catch(t){e=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var a,u=[],l=!1,c=-1;function h(){l&&a&&(l=!1,a.length?u=a.concat(u):c=-1,u.length&&f())}function f(){if(!l){var t=o(h);l=!0;for(var e=u.length;e;){for(a=u,u=[];++c<e;)a&&a[c].run();c=-1,e=u.length}a=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{return r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];u.push(new d(t,e)),1!==u.length||l||o(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},9655:function(t,e,r){var n;t=r.nmd(t),function(){e&&e.nodeType,t&&t.nodeType;var i="object"==typeof r.g&&r.g;i.global!==i&&i.window!==i&&i.self;var s,o=2147483647,a=36,u=/^xn--/,l=/[^\x20-\x7E]/,c=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,d=String.fromCharCode;function p(t){throw new RangeError(h[t])}function v(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function y(t,e){var r=t.split("@"),n="";return r.length>1&&(n=r[0]+"@",t=r[1]),n+v((t=t.replace(c,".")).split("."),e).join(".")}function b(t){for(var e,r,n=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function _(t){return v(t,(function(t){var e="";return t>65535&&(e+=d((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=d(t)})).join("")}function m(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function g(t,e,r){var n=0;for(t=r?f(t/700):t>>1,t+=f(t/e);t>455;n+=a)t=f(t/35);return f(n+36*t/(t+38))}function w(t){var e,r,n,i,s,u,l,c,h,d,v,y=[],b=t.length,m=0,w=128,x=72;for((r=t.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)t.charCodeAt(n)>=128&&p("not-basic"),y.push(t.charCodeAt(n));for(i=r>0?r+1:0;i<b;){for(s=m,u=1,l=a;i>=b&&p("invalid-input"),((c=(v=t.charCodeAt(i++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:a)>=a||c>f((o-m)/u))&&p("overflow"),m+=c*u,!(c<(h=l<=x?1:l>=x+26?26:l-x));l+=a)u>f(o/(d=a-h))&&p("overflow"),u*=d;x=g(m-s,e=y.length+1,0==s),f(m/e)>o-w&&p("overflow"),w+=f(m/e),m%=e,y.splice(m++,0,w)}return _(y)}function x(t){var e,r,n,i,s,u,l,c,h,v,y,_,w,x,T,S=[];for(_=(t=b(t)).length,e=128,r=0,s=72,u=0;u<_;++u)(y=t[u])<128&&S.push(d(y));for(n=i=S.length,i&&S.push("-");n<_;){for(l=o,u=0;u<_;++u)(y=t[u])>=e&&y<l&&(l=y);for(l-e>f((o-r)/(w=n+1))&&p("overflow"),r+=(l-e)*w,e=l,u=0;u<_;++u)if((y=t[u])<e&&++r>o&&p("overflow"),y==e){for(c=r,h=a;!(c<(v=h<=s?1:h>=s+26?26:h-s));h+=a)T=c-v,x=a-v,S.push(d(m(v+T%x,0))),c=f(T/x);S.push(d(m(c,0))),s=g(r,w,n==i),r=0,++n}++r,++e}return S.join("")}s={version:"1.4.1",ucs2:{decode:b,encode:_},decode:w,encode:x,toASCII:function(t){return y(t,(function(t){return l.test(t)?"xn--"+x(t):t}))},toUnicode:function(t){return y(t,(function(t){return u.test(t)?w(t.slice(4).toLowerCase()):t}))}},void 0===(n=function(){return s}.call(e,r,e,t))||(t.exports=n)}()},4765:t=>{var e=String.prototype.replace,r=/%20/g,n="RFC1738",i="RFC3986";t.exports={default:i,formatters:{RFC1738:function(t){return e.call(t,r,"+")},RFC3986:function(t){return String(t)}},RFC1738:n,RFC3986:i}},5373:(t,e,r)=>{var n=r(8636),i=r(2642),s=r(4765);t.exports={formats:s,parse:i,stringify:n}},2642:(t,e,r)=>{var n=r(7720),i=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:n.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},u=function(t,e,r){if(t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1)return t.split(",");if(e.throwOnLimitExceeded&&r>=e.arrayLimit)throw new RangeError("Array limit exceeded. Only "+e.arrayLimit+" element"+(1===e.arrayLimit?"":"s")+" allowed in an array.");return t},l=function(t,e,r,s){if(t){var o=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,a=/(\[[^[\]]*])/g,l=r.depth>0&&/(\[[^[\]]*])/.exec(o),c=l?o.slice(0,l.index):o,h=[];if(c){if(!r.plainObjects&&i.call(Object.prototype,c)&&!r.allowPrototypes)return;h.push(c)}for(var f=0;r.depth>0&&null!==(l=a.exec(o))&&f<r.depth;){if(f+=1,!r.plainObjects&&i.call(Object.prototype,l[1].slice(1,-1))&&!r.allowPrototypes)return;h.push(l[1])}if(l){if(!0===r.strictDepth)throw new RangeError("Input depth exceeded depth option of "+r.depth+" and strictDepth is true");h.push("["+o.slice(l.index)+"]")}return function(t,e,r,i){var s=0;if(t.length>0&&"[]"===t[t.length-1]){var o=t.slice(0,-1).join("");s=Array.isArray(e)&&e[o]?e[o].length:0}for(var a=i?e:u(e,r,s),l=t.length-1;l>=0;--l){var c,h=t[l];if("[]"===h&&r.parseArrays)c=r.allowEmptyArrays&&(""===a||r.strictNullHandling&&null===a)?[]:n.combine([],a);else{c=r.plainObjects?{__proto__:null}:{};var f="["===h.charAt(0)&&"]"===h.charAt(h.length-1)?h.slice(1,-1):h,d=r.decodeDotInKeys?f.replace(/%2E/g,"."):f,p=parseInt(d,10);r.parseArrays||""!==d?!isNaN(p)&&h!==d&&String(p)===d&&p>=0&&r.parseArrays&&p<=r.arrayLimit?(c=[])[p]=a:"__proto__"!==d&&(c[d]=a):c={0:a}}a=c}return a}(h,e,r,s)}};t.exports=function(t,e){var r=function(t){if(!t)return o;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.decodeDotInKeys&&"boolean"!=typeof t.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(void 0!==t.throwOnLimitExceeded&&"boolean"!=typeof t.throwOnLimitExceeded)throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var e=void 0===t.charset?o.charset:t.charset,r=void 0===t.duplicates?o.duplicates:t.duplicates;if("combine"!==r&&"first"!==r&&"last"!==r)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===t.allowDots?!0===t.decodeDotInKeys||o.allowDots:!!t.allowDots,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:o.allowEmptyArrays,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:o.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:o.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:o.comma,decodeDotInKeys:"boolean"==typeof t.decodeDotInKeys?t.decodeDotInKeys:o.decodeDotInKeys,decoder:"function"==typeof t.decoder?t.decoder:o.decoder,delimiter:"string"==typeof t.delimiter||n.isRegExp(t.delimiter)?t.delimiter:o.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:o.depth,duplicates:r,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:o.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:o.plainObjects,strictDepth:"boolean"==typeof t.strictDepth?!!t.strictDepth:o.strictDepth,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:o.strictNullHandling,throwOnLimitExceeded:"boolean"==typeof t.throwOnLimitExceeded&&t.throwOnLimitExceeded}}(e);if(""===t||null==t)return r.plainObjects?{__proto__:null}:{};for(var c="string"==typeof t?function(t,e){var r={__proto__:null},l=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;l=l.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var c=e.parameterLimit===1/0?void 0:e.parameterLimit,h=l.split(e.delimiter,e.throwOnLimitExceeded?c+1:c);if(e.throwOnLimitExceeded&&h.length>c)throw new RangeError("Parameter limit exceeded. Only "+c+" parameter"+(1===c?"":"s")+" allowed.");var f,d=-1,p=e.charset;if(e.charsetSentinel)for(f=0;f<h.length;++f)0===h[f].indexOf("utf8=")&&("utf8=%E2%9C%93"===h[f]?p="utf-8":"utf8=%26%2310003%3B"===h[f]&&(p="iso-8859-1"),d=f,f=h.length);for(f=0;f<h.length;++f)if(f!==d){var v,y,b=h[f],_=b.indexOf("]="),m=-1===_?b.indexOf("="):_+1;-1===m?(v=e.decoder(b,o.decoder,p,"key"),y=e.strictNullHandling?null:""):(v=e.decoder(b.slice(0,m),o.decoder,p,"key"),y=n.maybeMap(u(b.slice(m+1),e,s(r[v])?r[v].length:0),(function(t){return e.decoder(t,o.decoder,p,"value")}))),y&&e.interpretNumericEntities&&"iso-8859-1"===p&&(y=a(String(y))),b.indexOf("[]=")>-1&&(y=s(y)?[y]:y);var g=i.call(r,v);g&&"combine"===e.duplicates?r[v]=n.combine(r[v],y):g&&"last"!==e.duplicates||(r[v]=y)}return r}(t,r):t,h=r.plainObjects?{__proto__:null}:{},f=Object.keys(c),d=0;d<f.length;++d){var p=f[d],v=l(p,c[p],r,"string"==typeof t);h=n.merge(h,v,r)}return!0===r.allowSparse?h:n.compact(h)}},8636:(t,e,r)=>{var n=r(920),i=r(7720),s=r(4765),o=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},u=Array.isArray,l=Array.prototype.push,c=function(t,e){l.apply(t,u(e)?e:[e])},h=Date.prototype.toISOString,f=s.default,d={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:i.encode,encodeValuesOnly:!1,filter:void 0,format:f,formatter:s.formatters[f],indices:!1,serializeDate:function(t){return h.call(t)},skipNulls:!1,strictNullHandling:!1},p={},v=function t(e,r,s,o,a,l,h,f,v,y,b,_,m,g,w,x,T,S){for(var E,O=e,P=S,A=0,C=!1;void 0!==(P=P.get(p))&&!C;){var k=P.get(e);if(A+=1,void 0!==k){if(k===A)throw new RangeError("Cyclic object value");C=!0}void 0===P.get(p)&&(A=0)}if("function"==typeof y?O=y(r,O):O instanceof Date?O=m(O):"comma"===s&&u(O)&&(O=i.maybeMap(O,(function(t){return t instanceof Date?m(t):t}))),null===O){if(l)return v&&!x?v(r,d.encoder,T,"key",g):r;O=""}if("string"==typeof(E=O)||"number"==typeof E||"boolean"==typeof E||"symbol"==typeof E||"bigint"==typeof E||i.isBuffer(O))return v?[w(x?r:v(r,d.encoder,T,"key",g))+"="+w(v(O,d.encoder,T,"value",g))]:[w(r)+"="+w(String(O))];var I,R=[];if(void 0===O)return R;if("comma"===s&&u(O))x&&v&&(O=i.maybeMap(O,v)),I=[{value:O.length>0?O.join(",")||null:void 0}];else if(u(y))I=y;else{var $=Object.keys(O);I=b?$.sort(b):$}var M=f?String(r).replace(/\./g,"%2E"):String(r),D=o&&u(O)&&1===O.length?M+"[]":M;if(a&&u(O)&&0===O.length)return D+"[]";for(var B=0;B<I.length;++B){var L=I[B],N="object"==typeof L&&L&&void 0!==L.value?L.value:O[L];if(!h||null!==N){var F=_&&f?String(L).replace(/\./g,"%2E"):String(L),U=u(O)?"function"==typeof s?s(D,F):D:D+(_?"."+F:"["+F+"]");S.set(e,A);var j=n();j.set(p,S),c(R,t(N,U,s,o,a,l,h,f,"comma"===s&&x&&u(O)?null:v,y,b,_,m,g,w,x,T,j))}}return R};t.exports=function(t,e){var r,i=t,l=function(t){if(!t)return d;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.encodeDotInKeys&&"boolean"!=typeof t.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||d.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=s.default;if(void 0!==t.format){if(!o.call(s.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var n,i=s.formatters[r],l=d.filter;if(("function"==typeof t.filter||u(t.filter))&&(l=t.filter),n=t.arrayFormat in a?t.arrayFormat:"indices"in t?t.indices?"indices":"repeat":d.arrayFormat,"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var c=void 0===t.allowDots?!0===t.encodeDotInKeys||d.allowDots:!!t.allowDots;return{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:d.addQueryPrefix,allowDots:c,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:d.allowEmptyArrays,arrayFormat:n,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:d.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:void 0===t.delimiter?d.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:d.encode,encodeDotInKeys:"boolean"==typeof t.encodeDotInKeys?t.encodeDotInKeys:d.encodeDotInKeys,encoder:"function"==typeof t.encoder?t.encoder:d.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:d.encodeValuesOnly,filter:l,format:r,formatter:i,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:d.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:d.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:d.strictNullHandling}}(e);"function"==typeof l.filter?i=(0,l.filter)("",i):u(l.filter)&&(r=l.filter);var h=[];if("object"!=typeof i||null===i)return"";var f=a[l.arrayFormat],p="comma"===f&&l.commaRoundTrip;r||(r=Object.keys(i)),l.sort&&r.sort(l.sort);for(var y=n(),b=0;b<r.length;++b){var _=r[b],m=i[_];l.skipNulls&&null===m||c(h,v(m,_,f,p,l.allowEmptyArrays,l.strictNullHandling,l.skipNulls,l.encodeDotInKeys,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,y))}var g=h.join(l.delimiter),w=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),g.length>0?w+g:""}},7720:(t,e,r)=>{var n=r(4765),i=Object.prototype.hasOwnProperty,s=Array.isArray,o=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var r=e&&e.plainObjects?{__proto__:null}:{},n=0;n<t.length;++n)void 0!==t[n]&&(r[n]=t[n]);return r},u=1024;t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce((function(t,r){return t[r]=e[r],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var i=e[n],o=i.obj[i.prop],a=Object.keys(o),u=0;u<a.length;++u){var l=a[u],c=o[l];"object"==typeof c&&null!==c&&-1===r.indexOf(c)&&(e.push({obj:o,prop:l}),r.push(c))}return function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(s(r)){for(var n=[],i=0;i<r.length;++i)void 0!==r[i]&&n.push(r[i]);e.obj[e.prop]=n}}}(e),t},decode:function(t,e,r){var n=t.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(t){return n}},encode:function(t,e,r,i,s){if(0===t.length)return t;var a=t;if("symbol"==typeof t?a=Symbol.prototype.toString.call(t):"string"!=typeof t&&(a=String(t)),"iso-8859-1"===r)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var l="",c=0;c<a.length;c+=u){for(var h=a.length>=u?a.slice(c,c+u):a,f=[],d=0;d<h.length;++d){var p=h.charCodeAt(d);45===p||46===p||95===p||126===p||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||s===n.RFC1738&&(40===p||41===p)?f[f.length]=h.charAt(d):p<128?f[f.length]=o[p]:p<2048?f[f.length]=o[192|p>>6]+o[128|63&p]:p<55296||p>=57344?f[f.length]=o[224|p>>12]+o[128|p>>6&63]+o[128|63&p]:(d+=1,p=65536+((1023&p)<<10|1023&h.charCodeAt(d)),f[f.length]=o[240|p>>18]+o[128|p>>12&63]+o[128|p>>6&63]+o[128|63&p])}l+=f.join("")}return l},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(s(t)){for(var r=[],n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)},merge:function t(e,r,n){if(!r)return e;if("object"!=typeof r&&"function"!=typeof r){if(s(e))e.push(r);else{if(!e||"object"!=typeof e)return[e,r];(n&&(n.plainObjects||n.allowPrototypes)||!i.call(Object.prototype,r))&&(e[r]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(r);var o=e;return s(e)&&!s(r)&&(o=a(e,n)),s(e)&&s(r)?(r.forEach((function(r,s){if(i.call(e,s)){var o=e[s];o&&"object"==typeof o&&r&&"object"==typeof r?e[s]=t(o,r,n):e.push(r)}else e[s]=r})),e):Object.keys(r).reduce((function(e,s){var o=r[s];return i.call(e,s)?e[s]=t(e[s],o,n):e[s]=o,e}),o)}}},4803:(t,e,r)=>{var n=r(8859),i=r(9675),s=function(t,e,r){for(var n,i=t;null!=(n=i.next);i=n)if(n.key===e)return i.next=n.next,r||(n.next=t.next,t.next=n),n};t.exports=function(){var t,e={assert:function(t){if(!e.has(t))throw new i("Side channel does not contain "+n(t))},delete:function(e){var r=t&&t.next,n=function(t,e){if(t)return s(t,e,!0)}(t,e);return n&&r&&r===n&&(t=void 0),!!n},get:function(e){return function(t,e){if(t){var r=s(t,e);return r&&r.value}}(t,e)},has:function(e){return function(t,e){return!!t&&!!s(t,e)}(t,e)},set:function(e,r){t||(t={next:void 0}),function(t,e,r){var n=s(t,e);n?n.value=r:t.next={key:e,next:t.next,value:r}}(t,e,r)}};return e}},507:(t,e,r)=>{var n=r(453),i=r(6556),s=r(8859),o=r(9675),a=n("%Map%",!0),u=i("Map.prototype.get",!0),l=i("Map.prototype.set",!0),c=i("Map.prototype.has",!0),h=i("Map.prototype.delete",!0),f=i("Map.prototype.size",!0);t.exports=!!a&&function(){var t,e={assert:function(t){if(!e.has(t))throw new o("Side channel does not contain "+s(t))},delete:function(e){if(t){var r=h(t,e);return 0===f(t)&&(t=void 0),r}return!1},get:function(e){if(t)return u(t,e)},has:function(e){return!!t&&c(t,e)},set:function(e,r){t||(t=new a),l(t,e,r)}};return e}},2271:(t,e,r)=>{var n=r(453),i=r(6556),s=r(8859),o=r(507),a=r(9675),u=n("%WeakMap%",!0),l=i("WeakMap.prototype.get",!0),c=i("WeakMap.prototype.set",!0),h=i("WeakMap.prototype.has",!0),f=i("WeakMap.prototype.delete",!0);t.exports=u?function(){var t,e,r={assert:function(t){if(!r.has(t))throw new a("Side channel does not contain "+s(t))},delete:function(r){if(u&&r&&("object"==typeof r||"function"==typeof r)){if(t)return f(t,r)}else if(o&&e)return e.delete(r);return!1},get:function(r){return u&&r&&("object"==typeof r||"function"==typeof r)&&t?l(t,r):e&&e.get(r)},has:function(r){return u&&r&&("object"==typeof r||"function"==typeof r)&&t?h(t,r):!!e&&e.has(r)},set:function(r,n){u&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new u),c(t,r,n)):o&&(e||(e=o()),e.set(r,n))}};return r}:o},920:(t,e,r)=>{var n=r(9675),i=r(8859),s=r(4803),o=r(507),a=r(2271)||o||s;t.exports=function(){var t,e={assert:function(t){if(!e.has(t))throw new n("Side channel does not contain "+i(t))},delete:function(e){return!!t&&t.delete(e)},get:function(e){return t&&t.get(e)},has:function(e){return!!t&&t.has(e)},set:function(e,r){t||(t=a()),t.set(e,r)}};return e}},8835:(t,e,r)=>{var n=r(9655);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var s=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(u),c=["%","/","?",";","#"].concat(l),h=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=r(5373);function _(t,e,r){if(t&&"object"==typeof t&&t instanceof i)return t;var n=new i;return n.parse(t,e,r),n}i.prototype.parse=function(t,e,r){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),o=-1!==i&&i<t.indexOf("#")?"?":"#",u=t.split(o);u[0]=u[0].replace(/\\/g,"/");var _=t=u.join(o);if(_=_.trim(),!r&&1===t.split("#").length){var m=a.exec(_);if(m)return this.path=_,this.href=_,this.pathname=m[1],m[2]?(this.search=m[2],this.query=e?b.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var g=s.exec(_);if(g){var w=(g=g[0]).toLowerCase();this.protocol=w,_=_.substr(g.length)}if(r||g||_.match(/^\/\/[^@/]+@[^@/]+/)){var x="//"===_.substr(0,2);!x||g&&v[g]||(_=_.substr(2),this.slashes=!0)}if(!v[g]&&(x||g&&!y[g])){for(var T,S,E=-1,O=0;O<h.length;O++){-1!==(P=_.indexOf(h[O]))&&(-1===E||P<E)&&(E=P)}-1!==(S=-1===E?_.lastIndexOf("@"):_.lastIndexOf("@",E))&&(T=_.slice(0,S),_=_.slice(S+1),this.auth=decodeURIComponent(T)),E=-1;for(O=0;O<c.length;O++){var P;-1!==(P=_.indexOf(c[O]))&&(-1===E||P<E)&&(E=P)}-1===E&&(E=_.length),this.host=_.slice(0,E),_=_.slice(E),this.parseHost(),this.hostname=this.hostname||"";var A="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var C=this.hostname.split(/\./),k=(O=0,C.length);O<k;O++){var I=C[O];if(I&&!I.match(f)){for(var R="",$=0,M=I.length;$<M;$++)I.charCodeAt($)>127?R+="x":R+=I[$];if(!R.match(f)){var D=C.slice(0,O),B=C.slice(O+1),L=I.match(d);L&&(D.push(L[1]),B.unshift(L[2])),B.length&&(_="/"+B.join(".")+_),this.hostname=D.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=n.toASCII(this.hostname));var N=this.port?":"+this.port:"",F=this.hostname||"";this.host=F+N,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!p[w])for(O=0,k=l.length;O<k;O++){var U=l[O];if(-1!==_.indexOf(U)){var j=encodeURIComponent(U);j===U&&(j=escape(U)),_=_.split(U).join(j)}}var z=_.indexOf("#");-1!==z&&(this.hash=_.substr(z),_=_.slice(0,z));var G=_.indexOf("?");if(-1!==G?(this.search=_.substr(G),this.query=_.substr(G+1),e&&(this.query=b.parse(this.query)),_=_.slice(0,G)):e&&(this.search="",this.query={}),_&&(this.pathname=_),y[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var V=this.search||"";this.path=N+V}return this.href=this.format(),this},i.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,s="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(s=b.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||y[e])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),o&&"?"!==o.charAt(0)&&(o="?"+o),e+i+(r=r.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+n},i.prototype.resolve=function(t){return this.resolveObject(_(t,!1,!0)).format()},i.prototype.resolveObject=function(t){if("string"==typeof t){var e=new i;e.parse(t,!1,!0),t=e}for(var r=new i,n=Object.keys(this),s=0;s<n.length;s++){var o=n[s];r[o]=this[o]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),u=0;u<a.length;u++){var l=a[u];"protocol"!==l&&(r[l]=t[l])}return y[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!y[t.protocol]){for(var c=Object.keys(t),h=0;h<c.length;h++){var f=c[h];r[f]=t[f]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||v[t.protocol])r.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var p=r.pathname||"",b=r.search||"";r.path=p+b}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var _=r.pathname&&"/"===r.pathname.charAt(0),m=t.host||t.pathname&&"/"===t.pathname.charAt(0),g=m||_||r.host&&t.pathname,w=g,x=r.pathname&&r.pathname.split("/")||[],T=(d=t.pathname&&t.pathname.split("/")||[],r.protocol&&!y[r.protocol]);if(T&&(r.hostname="",r.port=null,r.host&&(""===x[0]?x[0]=r.host:x.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),g=g&&(""===d[0]||""===x[0])),m)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,x=d;else if(d.length)x||(x=[]),x.pop(),x=x.concat(d),r.search=t.search,r.query=t.query;else if(null!=t.search){if(T)r.host=x.shift(),r.hostname=r.host,(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.hostname=A.shift(),r.host=r.hostname);return r.search=t.search,r.query=t.query,null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!x.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var S=x.slice(-1)[0],E=(r.host||t.host||x.length>1)&&("."===S||".."===S)||""===S,O=0,P=x.length;P>=0;P--)"."===(S=x[P])?x.splice(P,1):".."===S?(x.splice(P,1),O++):O&&(x.splice(P,1),O--);if(!g&&!w)for(;O--;O)x.unshift("..");!g||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),E&&"/"!==x.join("/").substr(-1)&&x.push("");var A,C=""===x[0]||x[0]&&"/"===x[0].charAt(0);T&&(r.hostname=C?"":x.length?x.shift():"",r.host=r.hostname,(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.hostname=A.shift(),r.host=r.hostname));return(g=g||r.host&&x.length)&&!C&&x.unshift(""),x.length>0?r.pathname=x.join("/"):(r.pathname=null,r.path=null),null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},i.prototype.parseHost=function(){var t=this.host,e=o.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},e.qg=_,e.hd=function(t,e){return _(t,!1,!0).resolve(e)},e.GP=function(t){return"string"==typeof t&&(t=_(t)),t instanceof i?t.format():i.prototype.format.call(t)}},2634:()=>{},7734:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_K:()=>ee,qY:()=>Ne,wV:()=>Md});var process=__webpack_require__(5606),Buffer=__webpack_require__(8287).hp,Bd=Object.create,kn=Object.defineProperty,$d=Object.getOwnPropertyDescriptor,kd=Object.getOwnPropertyNames,Nd=Object.getPrototypeOf,Rd=Object.prototype.hasOwnProperty,D=(t,e)=>()=>(t&&(e=t(t=0)),e),ye=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),pr=(t,e)=>{for(var r in e)kn(t,r,{get:e[r],enumerable:!0})},Qa=(t,e,r,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of kd(e))!Rd.call(t,i)&&i!==r&&kn(t,i,{get:()=>e[i],enumerable:!(n=$d(e,i))||n.enumerable});return t},Nr=(t,e,r)=>(r=null!=t?Bd(Nd(t)):{},Qa(!e&&t&&t.__esModule?r:kn(r,"default",{value:t,enumerable:!0}),t)),jt=t=>Qa(kn({},"__esModule",{value:!0}),t),Nn,dr,hr,Rn,Mn=D((()=>{Nn=new Map,dr=[],hr=(t,e,r)=>{if(!e||"function"!=typeof e.init||"function"!=typeof e.createInferenceSessionHandler)throw new TypeError("not a valid backend");{let n=Nn.get(t);if(void 0===n)Nn.set(t,{backend:e,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==e)throw new Error(`cannot register backend "${t}" using priority ${r}`)}if(r>=0){let e=dr.indexOf(t);-1!==e&&dr.splice(e,1);for(let e=0;e<dr.length;e++)if(Nn.get(dr[e]).priority<=r)return void dr.splice(e,0,t);dr.push(t)}}},Rn=async t=>{let e=0===t.length?dr:t,r=[];for(let t of e){let e=Nn.get(t);if(e){if(e.initialized)return e.backend;if(e.aborted)continue;let n=!!e.initPromise;try{return n||(e.initPromise=e.backend.init(t)),await e.initPromise,e.initialized=!0,e.backend}catch(i){n||r.push({name:t,err:i}),e.aborted=!0}finally{delete e.initPromise}}}throw new Error(`no available backend found. ERR: ${r.map((t=>`[${t.name}] ${t.err}`)).join(", ")}`)}})),es=D((()=>{Mn()})),ts,rs=D((()=>{ts="1.17.0"})),ns,mr,Jo=D((()=>{rs(),ns="warning",mr={wasm:{},webgl:{},webgpu:{},versions:{common:ts},set logLevel(t){if(void 0!==t){if("string"!=typeof t||-1===["verbose","info","warning","error","fatal"].indexOf(t))throw new Error(`Unsupported logging level: ${t}`);ns=t}},get logLevel(){return ns}},Object.defineProperty(mr,"logLevel",{enumerable:!0})})),ee,os=D((()=>{Jo(),ee=mr})),is,as,ss=D((()=>{is=(t,e)=>{let r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=t.dims[3],r.height=t.dims[2];let n=r.getContext("2d");if(null!=n){let i,s;void 0!==e?.tensorLayout&&"NHWC"===e.tensorLayout?(i=t.dims[2],s=t.dims[3]):(i=t.dims[3],s=t.dims[2]);let o,a,u=void 0!==e?.format?e.format:"RGB",l=e?.norm;void 0===l||void 0===l.mean?o=[255,255,255,255]:"number"==typeof l.mean?o=[l.mean,l.mean,l.mean,l.mean]:(o=[l.mean[0],l.mean[1],l.mean[2],0],void 0!==l.mean[3]&&(o[3]=l.mean[3])),void 0===l||void 0===l.bias?a=[0,0,0,0]:"number"==typeof l.bias?a=[l.bias,l.bias,l.bias,l.bias]:(a=[l.bias[0],l.bias[1],l.bias[2],0],void 0!==l.bias[3]&&(a[3]=l.bias[3]));let c=s*i,h=0,f=c,d=2*c,p=-1;"RGBA"===u?(h=0,f=c,d=2*c,p=3*c):"RGB"===u?(h=0,f=c,d=2*c):"RBG"===u&&(h=0,d=c,f=2*c);for(let e=0;e<s;e++)for(let r=0;r<i;r++){let i=(t.data[h++]-a[0])*o[0],s=(t.data[f++]-a[1])*o[1],u=(t.data[d++]-a[2])*o[2],l=-1===p?255:(t.data[p++]-a[3])*o[3];n.fillStyle="rgba("+i+","+s+","+u+","+l+")",n.fillRect(r,e,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}throw new Error("Can not access image data")},as=(t,e)=>{let r,n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");if(null==n)throw new Error("Can not access image data");{let i,s,o;void 0!==e?.tensorLayout&&"NHWC"===e.tensorLayout?(i=t.dims[2],s=t.dims[1],o=t.dims[3]):(i=t.dims[3],s=t.dims[2],o=t.dims[1]);let a,u,l=void 0!==e&&void 0!==e.format?e.format:"RGB",c=e?.norm;void 0===c||void 0===c.mean?a=[255,255,255,255]:"number"==typeof c.mean?a=[c.mean,c.mean,c.mean,c.mean]:(a=[c.mean[0],c.mean[1],c.mean[2],255],void 0!==c.mean[3]&&(a[3]=c.mean[3])),void 0===c||void 0===c.bias?u=[0,0,0,0]:"number"==typeof c.bias?u=[c.bias,c.bias,c.bias,c.bias]:(u=[c.bias[0],c.bias[1],c.bias[2],0],void 0!==c.bias[3]&&(u[3]=c.bias[3]));let h=s*i;if(void 0!==e&&(void 0!==e.format&&4===o&&"RGBA"!==e.format||3===o&&"RGB"!==e.format&&"BGR"!==e.format))throw new Error("Tensor format doesn't match input tensor dims");let f=4,d=0,p=1,v=2,y=3,b=0,_=h,m=2*h,g=-1;"RGBA"===l?(b=0,_=h,m=2*h,g=3*h):"RGB"===l?(b=0,_=h,m=2*h):"RBG"===l&&(b=0,m=h,_=2*h),r=n.createImageData(i,s);for(let e=0;e<s*i;d+=f,p+=f,v+=f,y+=f,e++)r.data[d]=(t.data[b++]-u[0])*a[0],r.data[p]=(t.data[_++]-u[1])*a[1],r.data[v]=(t.data[m++]-u[2])*a[2],r.data[y]=-1===g?255:(t.data[g++]-u[3])*a[3]}return r}})),Zo,us,ls,fs,cs,ps=D((()=>{Gn(),Zo=(t,e)=>{if(void 0===t)throw new Error("Image buffer must be defined");if(void 0===e.height||void 0===e.width)throw new Error("Image height and width must be defined");if("NHWC"===e.tensorLayout)throw new Error("NHWC Tensor layout is not supported yet");let r,n,{height:i,width:s}=e,o=e.norm??{mean:255,bias:0};r="number"==typeof o.mean?[o.mean,o.mean,o.mean,o.mean]:[o.mean[0],o.mean[1],o.mean[2],o.mean[3]??255],n="number"==typeof o.bias?[o.bias,o.bias,o.bias,o.bias]:[o.bias[0],o.bias[1],o.bias[2],o.bias[3]??0];let a=void 0!==e.format?e.format:"RGBA",u=void 0!==e.tensorFormat&&void 0!==e.tensorFormat?e.tensorFormat:"RGB",l=i*s,c="RGBA"===u?new Float32Array(4*l):new Float32Array(3*l),h=4,f=0,d=1,p=2,v=3,y=0,b=l,_=2*l,m=-1;"RGB"===a&&(h=3,f=0,d=1,p=2,v=-1),"RGBA"===u?m=3*l:"RBG"===u?(y=0,_=l,b=2*l):"BGR"===u&&(_=0,b=l,y=2*l);for(let e=0;e<l;e++,f+=h,p+=h,d+=h,v+=h)c[y++]=(t[f]+n[0])/r[0],c[b++]=(t[d]+n[1])/r[1],c[_++]=(t[p]+n[2])/r[2],-1!==m&&-1!==v&&(c[m++]=(t[v]+n[3])/r[3]);return new Ye("float32",c,"RGBA"===u?[1,4,i,s]:[1,3,i,s])},us=async(t,e)=>{let r,n=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,i=typeof ImageData<"u"&&t instanceof ImageData,s=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,o="string"==typeof t,a=e??{},u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},l=t=>t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas?t.getContext("2d"):null;if(n){let n=u();n.width=t.width,n.height=t.height;let i=l(n);if(null==i)throw new Error("Can not access image data");{let n=t.height,s=t.width;if(void 0!==e&&void 0!==e.resizedHeight&&void 0!==e.resizedWidth&&(n=e.resizedHeight,s=e.resizedWidth),void 0!==e){if(a=e,void 0!==e.tensorFormat)throw new Error("Image input config format must be RGBA for HTMLImageElement");a.tensorFormat="RGBA",a.height=n,a.width=s}else a.tensorFormat="RGBA",a.height=n,a.width=s;i.drawImage(t,0,0),r=i.getImageData(0,0,s,n).data}}else{if(!i){if(s){if(void 0===e)throw new Error("Please provide image config with format for Imagebitmap");let n=u();n.width=t.width,n.height=t.height;let i=l(n);if(null!=i){let e=t.height,n=t.width;return i.drawImage(t,0,0,n,e),r=i.getImageData(0,0,n,e).data,a.height=e,a.width=n,Zo(r,a)}throw new Error("Can not access image data")}if(o)return new Promise(((e,r)=>{let n=u(),i=l(n);if(!t||!i)return r();let s=new Image;s.crossOrigin="Anonymous",s.src=t,s.onload=()=>{n.width=s.width,n.height=s.height,i.drawImage(s,0,0,n.width,n.height);let t=i.getImageData(0,0,n.width,n.height);a.height=n.height,a.width=n.width,e(Zo(t.data,a))}}));throw new Error("Input data provided is not supported - aborted tensor creation")}{let n,i;if(void 0!==e&&void 0!==e.resizedWidth&&void 0!==e.resizedHeight?(n=e.resizedHeight,i=e.resizedWidth):(n=t.height,i=t.width),void 0!==e&&(a=e),a.format="RGBA",a.height=n,a.width=i,void 0!==e){let e=u();e.width=i,e.height=n;let s=l(e);if(null==s)throw new Error("Can not access image data");s.putImageData(t,0,0),r=s.getImageData(0,0,i,n).data}else r=t.data}}if(void 0!==r)return Zo(r,a);throw new Error("Input data provided is not supported - aborted tensor creation")},ls=(t,e)=>{let{width:r,height:n,download:i,dispose:s}=e;return new Ye({location:"texture",type:"float32",texture:t,dims:[1,n,r,4],download:i,dispose:s})},fs=(t,e)=>{let{dataType:r,dims:n,download:i,dispose:s}=e;return new Ye({location:"gpu-buffer",type:r??"float32",gpuBuffer:t,dims:n,download:i,dispose:s})},cs=(t,e,r)=>new Ye({location:"cpu-pinned",type:t,data:e,dims:r??[e.length]})})),sn,Un,ds,hs,ms=D((()=>{sn=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["float16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),Un=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),ds=!1,hs=()=>{if(!ds){ds=!0;let t=typeof BigInt64Array<"u"&&"function"==typeof BigInt64Array.from,e=typeof BigUint64Array<"u"&&"function"==typeof BigUint64Array.from;t&&(sn.set("int64",BigInt64Array),Un.set(BigInt64Array,"int64")),e&&(sn.set("uint64",BigUint64Array),Un.set(BigUint64Array,"uint64"))}}})),bs,gs,ys=D((()=>{Gn(),bs=t=>{let e=1;for(let r=0;r<t.length;r++){let n=t[r];if("number"!=typeof n||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);e*=n}return e},gs=(t,e)=>{switch(t.location){case"cpu":return new Ye(t.type,t.data,e);case"cpu-pinned":return new Ye({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case"texture":return new Ye({location:"texture",texture:t.texture,type:t.type,dims:e});case"gpu-buffer":return new Ye({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}}})),Ye,Gn=D((()=>{ss(),ps(),ms(),ys(),Ye=class{constructor(t,e,r){let n,i;if(hs(),"object"==typeof t&&"location"in t)switch(this.dataLocation=t.location,n=t.type,i=t.dims,t.location){case"cpu-pinned":{let e=sn.get(n);if(!e)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(t.data instanceof e))throw new TypeError(`buffer should be of type ${e.name}`);this.cpuData=t.data;break}case"texture":if("float32"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break;case"gpu-buffer":if("float32"!==n&&"float16"!==n&&"int32"!==n&&"int64"!==n&&"uint32"!==n&&"bool"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break;default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let s,o;if("string"==typeof t)if(n=t,o=r,"string"===t){if(!Array.isArray(e))throw new TypeError("A string tensor's data must be a string array.");s=e}else{let r=sn.get(t);if(void 0===r)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(e)){if("float16"===t)throw new TypeError("Creating a float16 tensor from number array is not supported. Please use Uint16Array as data.");s="uint64"===t||"int64"===t?r.from(e,BigInt):r.from(e)}else{if(!(e instanceof r))throw new TypeError(`A ${n} tensor's data must be type of ${r}`);s=e}}else if(o=e,Array.isArray(t)){if(0===t.length)throw new TypeError("Tensor type cannot be inferred from an empty array.");let e=typeof t[0];if("string"===e)n="string",s=t;else{if("boolean"!==e)throw new TypeError(`Invalid element type of data array: ${e}.`);n="bool",s=Uint8Array.from(t)}}else{let e=Un.get(t.constructor);if(void 0===e)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);n=e,s=t}if(void 0===o)o=[s.length];else if(!Array.isArray(o))throw new TypeError("A tensor's dims must be a number array");i=o,this.cpuData=s,this.dataLocation="cpu"}let s=bs(i);if(this.cpuData&&s!==this.cpuData.length)throw new Error(`Tensor's size(${s}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=i,this.size=s}static async fromImage(t,e){return us(t,e)}static fromTexture(t,e){return ls(t,e)}static fromGpuBuffer(t,e){return fs(t,e)}static fromPinnedBuffer(t,e,r){return cs(t,e,r)}toDataURL(t){return is(this,t)}toImageData(t){return as(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let e=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=e,t&&this.disposer&&(this.disposer(),this.disposer=void 0),e}finally{this.isDownloading=!1}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return gs(this,t)}}})),Ne,zn=D((()=>{Gn(),Ne=Ye})),Ts,xs,br,gr,Qo=D((()=>{Jo(),Ts=(t,e)=>{mr.wasm.trace&&console.timeStamp(`${t}::ORT::${e}`)},xs=(t,e)=>{let r=(new Error).stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let i=0;i<r.length;i++){if(n&&!r[i].includes("TRACE_FUNC")){let n=`FUNC_${t}::${r[i].trim().split(" ")[1]}`;return e&&(n+=`::${e}`),void Ts("CPU",n)}r[i].includes("TRACE_FUNC")&&(n=!0)}},br=t=>{mr.wasm.trace&&xs("BEGIN",t)},gr=t=>{mr.wasm.trace&&xs("END",t)}})),Wn,ws=D((()=>{Mn(),zn(),Qo(),Wn=class t{constructor(t){this.handler=t}async run(t,e,r){br();let n={},i={};if("object"!=typeof t||null===t||t instanceof Ne||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let s=!0;if("object"==typeof e){if(null===e)throw new TypeError("Unexpected argument[1]: cannot be null.");if(e instanceof Ne)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(e)){if(0===e.length)throw new TypeError("'fetches' cannot be an empty array.");s=!1;for(let t of e){if("string"!=typeof t)throw new TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(t))throw new RangeError(`'fetches' contains invalid output name: ${t}.`);n[t]=null}if("object"==typeof r&&null!==r)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{let t=!1,o=Object.getOwnPropertyNames(e);for(let r of this.outputNames)if(-1!==o.indexOf(r)){let i=e[r];(null===i||i instanceof Ne)&&(t=!0,s=!1,n[r]=i)}if(t){if("object"==typeof r&&null!==r)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else i=e}}else if(typeof e<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let e of this.inputNames)if(typeof t[e]>"u")throw new Error(`input '${e}' is missing in 'feeds'.`);if(s)for(let t of this.outputNames)n[t]=null;let o=await this.handler.run(t,n,i),a={};for(let t in o)if(Object.hasOwnProperty.call(o,t)){let e=o[t];a[t]=e instanceof Ne?e:new Ne(e.type,e.data,e.dims)}return gr(),a}async release(){return this.handler.dispose()}async configure(t){return await this.handler.configure(t)}async auth(t){return await this.handler.auth(t)}static async create(e,r,n,i){br();let s,o={};if("string"==typeof e){if(s=e,"object"==typeof r&&null!==r)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(s=e,"object"==typeof r&&null!==r)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{if(!(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer))throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");{let t=e,a=0,u=e.byteLength;if("object"==typeof r&&null!==r)o=r;else if("number"==typeof r){if(a=r,!Number.isSafeInteger(a))throw new RangeError("'byteOffset' must be an integer.");if(a<0||a>=t.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${t.byteLength}).`);if(u=e.byteLength-a,"number"==typeof n){if(u=n,!Number.isSafeInteger(u))throw new RangeError("'byteLength' must be an integer.");if(u<=0||a+u>t.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${t.byteLength-a}].`);if("object"==typeof i&&null!==i)o=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");s=new Uint8Array(t,a,u)}}let a=(o.executionProviders||[]).map((t=>"string"==typeof t?t:t.name)),u=await(await Rn(a)).createInferenceSessionHandler(s,o);return gr(),new t(u)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}})),Md,vs=D((()=>{ws(),Md=Wn})),_s=D((()=>{})),Gd,Vn,Os=D((()=>{Mn(),zn(),Gd="Training backend could not be resolved. Make sure you're using the correct configuration & WebAssembly files.",Vn=class t{constructor(t,e,r){this.handler=t,this.hasOptimizerModel=e,this.hasEvalModel=r}get trainingInputNames(){return this.handler.inputNames}get trainingOutputNames(){return this.handler.outputNames}get evalInputNames(){if(this.hasEvalModel)return this.handler.evalInputNames;throw new Error("This training session has no evalModel loaded.")}get evalOutputNames(){if(this.hasEvalModel)return this.handler.evalOutputNames;throw new Error("This training session has no evalModel loaded.")}static async create(e,r){let n=e.evalModel||"",i=e.optimizerModel||"",s=r||{},o=(s.executionProviders||[]).map((t=>"string"==typeof t?t:t.name)),a=await Rn(o);if(a.createTrainingSessionHandler){let r=await a.createTrainingSessionHandler(e.checkpointState,e.trainModel,n,i,s);return new t(r,!!e.optimizerModel,!!e.evalModel)}throw new Error(Gd)}typeNarrowingForRunStep(t,e,r,n,i){let s={},o={};if("object"!=typeof r||null===r||r instanceof Ne||Array.isArray(r))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if("object"==typeof n){if(null===n)throw new TypeError("Unexpected argument[1]: cannot be null.");if(n instanceof Ne)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(n)){if(0===n.length)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let t of n){if("string"!=typeof t)throw new TypeError("'fetches' must be a string array or an object.");if(-1===e.indexOf(t))throw new RangeError(`'fetches' contains invalid output name: ${t}.`);s[t]=null}if("object"==typeof i&&null!==i)o=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else{let t=!1,r=Object.getOwnPropertyNames(n);for(let i of e)if(-1!==r.indexOf(i)){let e=n[i];(null===e||e instanceof Ne)&&(t=!0,a=!1,s[i]=e)}if(t){if("object"==typeof i&&null!==i)o=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else o=n}}else if(typeof n<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let e of t)if(typeof r[e]>"u")throw new Error(`input '${e}' is missing in 'feeds'.`);if(a)for(let t of e)s[t]=null;return[s,o]}convertHandlerReturnTypeToMapOfTensors(t){let e={};for(let r in t)if(Object.hasOwnProperty.call(t,r)){let n=t[r];e[r]=n instanceof Ne?n:new Ne(n.type,n.data,n.dims)}return e}async lazyResetGrad(){await this.handler.lazyResetGrad()}async runTrainStep(t,e,r){let[n,i]=this.typeNarrowingForRunStep(this.trainingInputNames,this.trainingOutputNames,t,e,r),s=await this.handler.runTrainStep(t,n,i);return this.convertHandlerReturnTypeToMapOfTensors(s)}async runOptimizerStep(t){if(!this.hasOptimizerModel)throw new Error("This TrainingSession has no OptimizerModel loaded.");await this.handler.runOptimizerStep(t||{})}async runEvalStep(t,e,r){if(this.hasEvalModel){let[n,i]=this.typeNarrowingForRunStep(this.evalInputNames,this.evalOutputNames,t,e,r),s=await this.handler.runEvalStep(t,n,i);return this.convertHandlerReturnTypeToMapOfTensors(s)}throw new Error("This TrainingSession has no EvalModel loaded.")}async getParametersSize(t=!0){return this.handler.getParametersSize(t)}async loadParametersBuffer(t,e=!0){let r=await this.getParametersSize(e);if(t.length!==4*r)throw new Error("Size of the buffer passed into loadParametersBuffer must match the number of parameters in the model. Please use getParametersSize method to check.");return this.handler.loadParametersBuffer(t,e)}async getContiguousParameters(t=!0){return this.handler.getContiguousParameters(t)}async release(){return this.handler.dispose()}}})),Ud,Ss=D((()=>{Os(),Ud=Vn})),ei={};pr(ei,{InferenceSession:()=>Md,TRACE:()=>Ts,TRACE_FUNC_BEGIN:()=>br,TRACE_FUNC_END:()=>gr,Tensor:()=>Ne,TrainingSession:()=>Ud,env:()=>ee,registerBackend:()=>hr});var _t=D((()=>{es(),os(),vs(),zn(),Qo(),_s(),Ss()}));function Zt(t,e,r,n){if(void 0===e)return Wd(t);if(void 0===r)Hn(t,e,1);else if("number"==typeof r&&void 0===n)Hn(t,e,r);else if("string"==typeof r&&void 0===n)Hn(t,r,1,e);else{if("string"!=typeof r||"number"!=typeof n)throw new TypeError("input is valid");Hn(t,r,n,e)}}function Wd(t){return{verbose:Zt.verbose.bind(null,t),info:Zt.info.bind(null,t),warning:Zt.warning.bind(null,t),error:Zt.error.bind(null,t),fatal:Zt.fatal.bind(null,t)}}function Hn(t,e,r,n){let i=un[n||""]||un[""];As[t]<As[i.minimalSeverity]||(i.logDateTime&&(e=`${(new Date).toISOString()}|${e}`),i.logSourceLocation,zd[i.provider].log(t,e,n))}var ti,ri,As,zd,Es,un,pe,qn,Yn,Xn,jn,pt=D((()=>{ti=class{log(t,e,r){}},ri=class{log(t,e,r){console.log(`${this.color(t)} ${r?"[35m"+r+"[0m ":""}${e}`)}color(t){switch(t){case"verbose":return"[34;40mv[0m";case"info":return"[32mi[0m";case"warning":return"[30;43mw[0m";case"error":return"[31;40me[0m";case"fatal":return"[101mf[0m";default:throw new Error(`unsupported severity: ${t}`)}}},As={verbose:1e3,info:2e3,warning:4e3,error:5e3,fatal:6e3},zd={none:new ti,console:new ri},un={"":Es={provider:"console",minimalSeverity:"warning",logDateTime:!0,logSourceLocation:!1}},(t=>{function e(t){un={},r("",t||{})}function r(t,r){if("*"===t)e(r);else{let e=un[t]||Es;un[t]={provider:r.provider||e.provider,minimalSeverity:r.minimalSeverity||e.minimalSeverity,logDateTime:void 0===r.logDateTime?e.logDateTime:r.logDateTime,logSourceLocation:void 0===r.logSourceLocation?e.logSourceLocation:r.logSourceLocation}}}t.verbose=function(e,r){t("verbose",e,r)},t.info=function(e,r){t("info",e,r)},t.warning=function(e,r){t("warning",e,r)},t.error=function(e,r){t("error",e,r)},t.fatal=function(e,r){t("fatal",e,r)},t.reset=e,t.set=r,t.setWithEnv=function(t){let e={};t.logLevel&&(e.minimalSeverity=t.logLevel),r("",e)}})(Zt||={}),pe=Zt,qn=class{constructor(t,e,r,n,i,s){this.category=t,this.name=e,this.startTime=r,this.endCallback=n,this.timer=i,this.ctx=s}async end(){return this.endCallback(this)}async checkTimer(){if(void 0===this.ctx||void 0===this.timer)throw new Error("No webgl timer found");return this.ctx.endTimer(),this.ctx.waitForQueryAndGetTime(this.timer)}},Yn=class{constructor(t,e,r,n){this.category=t,this.name=e,this.startTime=r,this.endTime=n}},Xn=class{constructor(t,e,r){this._started=!1,this._flushPointer=0,this._started=!1,this._maxNumberEvents=void 0===t?1e4:t,this._flushBatchSize=void 0===e?10:e,this._flushIntervalInMilliseconds=void 0===r?5e3:r}static create(t){return void 0===t?new this:new this(t.maxNumberEvents,t.flushBatchSize,t.flushIntervalInMilliseconds)}start(){this._started=!0,this._timingEvents=[],this._flushTime=jn(),this._flushPointer=0}stop(){for(this._started=!1;this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer])}event(t,e,r,n){let i=this._started?this.begin(t,e,n):void 0,s=!1,o=r();if(o&&"function"==typeof o.then)return s=!0,new Promise(((t,e)=>{o.then((async e=>{i&&await i.end(),t(e)}),(async t=>{i&&await i.end(),e(t)}))}));if(!s&&i){let t=i.end();if(t&&"function"==typeof t.then)return new Promise(((e,r)=>{t.then((()=>{e(o)}),(t=>{r(t)}))}))}return o}begin(t,e,r){if(!this._started)throw new Error("profiler is not started yet");if(void 0===r){let r=jn();return this.flush(r),new qn(t,e,r,(t=>this.endSync(t)))}{let n=r.beginTimer();return new qn(t,e,0,(async t=>this.end(t)),n,r)}}async end(t){let e=await t.checkTimer();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new Yn(t.category,t.name,t.startTime,e)),this.flush(e))}endSync(t){let e=jn();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new Yn(t.category,t.name,t.startTime,e)),this.flush(e))}logOneEvent(t){pe.verbose(`Profiler.${t.category}`,`${(t.endTime-t.startTime).toFixed(2)}ms on event '${t.name}' at ${t.endTime.toFixed(2)}`)}flush(t){if(this._timingEvents.length-this._flushPointer>=this._flushBatchSize||t-this._flushTime>=this._flushIntervalInMilliseconds){for(let t=this._flushPointer;this._flushPointer<t+this._flushBatchSize&&this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer]);this._flushTime=jn()}}get started(){return this._started}},jn=typeof performance<"u"&&performance.now?()=>performance.now():Date.now}));function Ps(t,e,r){for(let n of r){let r=n[0],i=n[1],s=n[2],o=n[3],a=n[4];if(t.opType===r)for(let t of e)if((t.domain===i||"ai.onnx"===t.domain&&""===i)&&Vd(t.version,s))return{opImpl:o,opInit:a}}throw new TypeError(`cannot resolve operator '${t.opType}' with opsets: ${e.map((t=>`${t.domain||"ai.onnx"} v${t.version}`)).join(", ")}`)}function Vd(t,e){if(e.endsWith("+")){let r=Number.parseInt(e.substring(0,e.length-1),10);return!isNaN(r)&&r<=t}if(2===e.split("-").length){let r=e.split("-"),n=Number.parseInt(r[0],10),i=Number.parseInt(r[1],10);return!isNaN(n)&&!isNaN(i)&&n<=t&&t<=i}return Number.parseInt(e,10)===t}var Ds=D((()=>{})),Ls=ye((t=>{t.__esModule=!0;var e=function(){function t(e){if(!e)throw new TypeError("Invalid argument; `value` has no value.");this.value=t.EMPTY,e&&t.isGuid(e)&&(this.value=e)}return t.isGuid=function(e){var r=e.toString();return e&&(e instanceof t||t.validator.test(r))},t.create=function(){return new t([t.gen(2),t.gen(1),t.gen(1),t.gen(1),t.gen(3)].join("-"))},t.createEmpty=function(){return new t("emptyguid")},t.parse=function(e){return new t(e)},t.raw=function(){return[t.gen(2),t.gen(1),t.gen(1),t.gen(1),t.gen(3)].join("-")},t.gen=function(t){for(var e="",r=0;r<t;r++)e+=(65536*(1+Math.random())|0).toString(16).substring(1);return e},t.prototype.equals=function(e){return t.isGuid(e)&&this.value===e.toString()},t.prototype.isEmpty=function(){return this.value===t.EMPTY},t.prototype.toString=function(){return this.value},t.prototype.toJSON=function(){return{value:this.value}},t.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),t.EMPTY="00000000-0000-0000-0000-000000000000",t}();t.Guid=e}));function Te(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function qe(t){return!0===(t&&t.__isLong__)}function Cs(t){var e=Math.clz32(t&-t);return t?31-e:e}function yr(t,e){var r,n,i;return e?(i=0<=(t>>>=0)&&t<256)&&(n=Bs[t])?n:(r=le(t,0,!0),i&&(Bs[t]=r),r):(i=-128<=(t|=0)&&t<128)&&(n=Fs[t])?n:(r=le(t,t<0?-1:0,!1),i&&(Fs[t]=r),r)}function ht(t,e){if(isNaN(t))return e?qt:Ot;if(e){if(t<0)return qt;if(t>=Rs)return Us}else{if(t<=-ks)return rt;if(t+1>=ks)return Gs}return t<0?ht(-t,e).neg():le(t%Mr|0,t/Mr|0,e)}function le(t,e,r){return new Te(t,e,r)}function ii(t,e,r){if(0===t.length)throw Error("empty string");if("number"==typeof e?(r=e,e=!1):e=!!e,"NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return e?qt:Ot;if((r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return ii(t.substring(1),e,r).neg();for(var i=ht(Kn(r,8)),s=Ot,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),u=parseInt(t.substring(o,o+a),r);if(a<8){var l=ht(Kn(r,a));s=s.mul(l).add(ht(u))}else s=(s=s.mul(i)).add(ht(u))}return s.unsigned=e,s}function St(t,e){return"number"==typeof t?ht(t,e):"string"==typeof t?ii(t,e):le(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}var dt,Fs,Bs,Kn,$s,jd,Mr,Rs,ks,Ns,Ot,qt,Rr,Ms,oi,Gs,Us,rt,N,Yt,ai=D((()=>{dt=null;try{dt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}Te.prototype.__isLong__,Object.defineProperty(Te.prototype,"__isLong__",{value:!0}),Te.isLong=qe,Fs={},Bs={},Te.fromInt=yr,Te.fromNumber=ht,Te.fromBits=le,Kn=Math.pow,Te.fromString=ii,Te.fromValue=St,ks=(Rs=(Mr=($s=65536)*$s)*Mr)/2,Ns=yr(jd=1<<24),Ot=yr(0),Te.ZERO=Ot,qt=yr(0,!0),Te.UZERO=qt,Rr=yr(1),Te.ONE=Rr,Ms=yr(1,!0),Te.UONE=Ms,oi=yr(-1),Te.NEG_ONE=oi,Gs=le(-1,2147483647,!1),Te.MAX_VALUE=Gs,Us=le(-1,-1,!0),Te.MAX_UNSIGNED_VALUE=Us,rt=le(0,-2147483648,!1),Te.MIN_VALUE=rt,(N=Te.prototype).toInt=function(){return this.unsigned?this.low>>>0:this.low},N.toNumber=function(){return this.unsigned?(this.high>>>0)*Mr+(this.low>>>0):this.high*Mr+(this.low>>>0)},N.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(rt)){var e=ht(t),r=this.div(e),n=r.mul(e).sub(this);return r.toString(t)+n.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=ht(Kn(t,6),this.unsigned),s=this,o="";;){var a=s.div(i),u=(s.sub(a.mul(i)).toInt()>>>0).toString(t);if((s=a).isZero())return u+o;for(;u.length<6;)u="0"+u;o=""+u+o}},N.getHighBits=function(){return this.high},N.getHighBitsUnsigned=function(){return this.high>>>0},N.getLowBits=function(){return this.low},N.getLowBitsUnsigned=function(){return this.low>>>0},N.getNumBitsAbs=function(){if(this.isNegative())return this.eq(rt)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return 0!=this.high?e+33:e+1},N.isZero=function(){return 0===this.high&&0===this.low},N.eqz=N.isZero,N.isNegative=function(){return!this.unsigned&&this.high<0},N.isPositive=function(){return this.unsigned||this.high>=0},N.isOdd=function(){return!(1&~this.low)},N.isEven=function(){return!(1&this.low)},N.equals=function(t){return qe(t)||(t=St(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},N.eq=N.equals,N.notEquals=function(t){return!this.eq(t)},N.neq=N.notEquals,N.ne=N.notEquals,N.lessThan=function(t){return this.comp(t)<0},N.lt=N.lessThan,N.lessThanOrEqual=function(t){return this.comp(t)<=0},N.lte=N.lessThanOrEqual,N.le=N.lessThanOrEqual,N.greaterThan=function(t){return this.comp(t)>0},N.gt=N.greaterThan,N.greaterThanOrEqual=function(t){return this.comp(t)>=0},N.gte=N.greaterThanOrEqual,N.ge=N.greaterThanOrEqual,N.compare=function(t){if(qe(t)||(t=St(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},N.comp=N.compare,N.negate=function(){return!this.unsigned&&this.eq(rt)?rt:this.not().add(Rr)},N.neg=N.negate,N.add=function(t){qe(t)||(t=St(t));var e=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,u=0,l=0,c=0,h=0;return c+=(h+=i+(65535&t.low))>>>16,l+=(c+=n+a)>>>16,u+=(l+=r+o)>>>16,u+=e+s,le((c&=65535)<<16|(h&=65535),(u&=65535)<<16|(l&=65535),this.unsigned)},N.subtract=function(t){return qe(t)||(t=St(t)),this.add(t.neg())},N.sub=N.subtract,N.multiply=function(t){if(this.isZero())return this;if(qe(t)||(t=St(t)),dt)return le(dt.mul(this.low,this.high,t.low,t.high),dt.get_high(),this.unsigned);if(t.isZero())return this.unsigned?qt:Ot;if(this.eq(rt))return t.isOdd()?rt:Ot;if(t.eq(rt))return this.isOdd()?rt:Ot;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Ns)&&t.lt(Ns))return ht(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,u=65535&t.low,l=0,c=0,h=0,f=0;return h+=(f+=i*u)>>>16,c+=(h+=n*u)>>>16,h&=65535,c+=(h+=i*a)>>>16,l+=(c+=r*u)>>>16,c&=65535,l+=(c+=n*a)>>>16,c&=65535,l+=(c+=i*o)>>>16,l+=e*u+r*a+n*o+i*s,le((h&=65535)<<16|(f&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},N.mul=N.multiply,N.divide=function(t){if(qe(t)||(t=St(t)),t.isZero())throw Error("division by zero");var e,r,n;if(dt)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?le((this.unsigned?dt.div_u:dt.div_s)(this.low,this.high,t.low,t.high),dt.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?qt:Ot;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return qt;if(t.gt(this.shru(1)))return Ms;n=qt}else{if(this.eq(rt))return t.eq(Rr)||t.eq(oi)?rt:t.eq(rt)?Rr:(e=this.shr(1).div(t).shl(1)).eq(Ot)?t.isNegative()?Rr:oi:(r=this.sub(t.mul(e)),n=e.add(r.div(t)));if(t.eq(rt))return this.unsigned?qt:Ot;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=Ot}for(r=this;r.gte(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(e)/Math.LN2),s=i<=48?1:Kn(2,i-48),o=ht(e),a=o.mul(t);a.isNegative()||a.gt(r);)a=(o=ht(e-=s,this.unsigned)).mul(t);o.isZero()&&(o=Rr),n=n.add(o),r=r.sub(a)}return n},N.div=N.divide,N.modulo=function(t){return qe(t)||(t=St(t)),dt?le((this.unsigned?dt.rem_u:dt.rem_s)(this.low,this.high,t.low,t.high),dt.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},N.mod=N.modulo,N.rem=N.modulo,N.not=function(){return le(~this.low,~this.high,this.unsigned)},N.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},N.clz=N.countLeadingZeros,N.countTrailingZeros=function(){return this.low?Cs(this.low):Cs(this.high)+32},N.ctz=N.countTrailingZeros,N.and=function(t){return qe(t)||(t=St(t)),le(this.low&t.low,this.high&t.high,this.unsigned)},N.or=function(t){return qe(t)||(t=St(t)),le(this.low|t.low,this.high|t.high,this.unsigned)},N.xor=function(t){return qe(t)||(t=St(t)),le(this.low^t.low,this.high^t.high,this.unsigned)},N.shiftLeft=function(t){return qe(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?le(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):le(0,this.low<<t-32,this.unsigned)},N.shl=N.shiftLeft,N.shiftRight=function(t){return qe(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?le(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):le(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},N.shr=N.shiftRight,N.shiftRightUnsigned=function(t){return qe(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?le(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):le(32===t?this.high:this.high>>>t-32,0,this.unsigned)},N.shru=N.shiftRightUnsigned,N.shr_u=N.shiftRightUnsigned,N.rotateLeft=function(t){var e;return qe(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?le(this.high,this.low,this.unsigned):t<32?(e=32-t,le(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(e=32-(t-=32),le(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))},N.rotl=N.rotateLeft,N.rotateRight=function(t){var e;return qe(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?le(this.high,this.low,this.unsigned):t<32?(e=32-t,le(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(e=32-(t-=32),le(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))},N.rotr=N.rotateRight,N.toSigned=function(){return this.unsigned?le(this.low,this.high,!1):this},N.toUnsigned=function(){return this.unsigned?this:le(this.low,this.high,!0)},N.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},N.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},N.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},Te.fromBytes=function(t,e,r){return r?Te.fromBytesLE(t,e):Te.fromBytesBE(t,e)},Te.fromBytesLE=function(t,e){return new Te(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Te.fromBytesBE=function(t,e){return new Te(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)},Yt=Te})),S,Jn=D((()=>{S={},S.Table,S.SIZEOF_SHORT=2,S.SIZEOF_INT=4,S.FILE_IDENTIFIER_LENGTH=4,S.SIZE_PREFIX_LENGTH=4,S.Encoding={UTF8_BYTES:1,UTF16_STRING:2},S.int32=new Int32Array(2),S.float32=new Float32Array(S.int32.buffer),S.float64=new Float64Array(S.int32.buffer),S.isLittleEndian=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0],S.Long=function(t,e){this.low=0|t,this.high=0|e},S.Long.create=function(t,e){return 0==t&&0==e?S.Long.ZERO:new S.Long(t,e)},S.Long.prototype.toFloat64=function(){return(this.low>>>0)+4294967296*this.high},S.Long.prototype.equals=function(t){return this.low==t.low&&this.high==t.high},S.Long.ZERO=new S.Long(0,0),S.Builder=function(t){if(t)var e=t;else e=1024;this.bb=S.ByteBuffer.allocate(e),this.space=e,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},S.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},S.Builder.prototype.forceDefaults=function(t){this.force_defaults=t},S.Builder.prototype.dataBuffer=function(){return this.bb},S.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},S.Builder.prototype.prep=function(t,e){t>this.minalign&&(this.minalign=t);for(var r=1+~(this.bb.capacity()-this.space+e)&t-1;this.space<r+t+e;){var n=this.bb.capacity();this.bb=S.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(r)},S.Builder.prototype.pad=function(t){for(var e=0;e<t;e++)this.bb.writeInt8(--this.space,0)},S.Builder.prototype.writeInt8=function(t){this.bb.writeInt8(this.space-=1,t)},S.Builder.prototype.writeInt16=function(t){this.bb.writeInt16(this.space-=2,t)},S.Builder.prototype.writeInt32=function(t){this.bb.writeInt32(this.space-=4,t)},S.Builder.prototype.writeInt64=function(t){this.bb.writeInt64(this.space-=8,t)},S.Builder.prototype.writeFloat32=function(t){this.bb.writeFloat32(this.space-=4,t)},S.Builder.prototype.writeFloat64=function(t){this.bb.writeFloat64(this.space-=8,t)},S.Builder.prototype.addInt8=function(t){this.prep(1,0),this.writeInt8(t)},S.Builder.prototype.addInt16=function(t){this.prep(2,0),this.writeInt16(t)},S.Builder.prototype.addInt32=function(t){this.prep(4,0),this.writeInt32(t)},S.Builder.prototype.addInt64=function(t){this.prep(8,0),this.writeInt64(t)},S.Builder.prototype.addFloat32=function(t){this.prep(4,0),this.writeFloat32(t)},S.Builder.prototype.addFloat64=function(t){this.prep(8,0),this.writeFloat64(t)},S.Builder.prototype.addFieldInt8=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt8(e),this.slot(t))},S.Builder.prototype.addFieldInt16=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt16(e),this.slot(t))},S.Builder.prototype.addFieldInt32=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt32(e),this.slot(t))},S.Builder.prototype.addFieldInt64=function(t,e,r){(this.force_defaults||!e.equals(r))&&(this.addInt64(e),this.slot(t))},S.Builder.prototype.addFieldFloat32=function(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat32(e),this.slot(t))},S.Builder.prototype.addFieldFloat64=function(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat64(e),this.slot(t))},S.Builder.prototype.addFieldOffset=function(t,e,r){(this.force_defaults||e!=r)&&(this.addOffset(e),this.slot(t))},S.Builder.prototype.addFieldStruct=function(t,e,r){e!=r&&(this.nested(e),this.slot(t))},S.Builder.prototype.nested=function(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")},S.Builder.prototype.notNested=function(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")},S.Builder.prototype.slot=function(t){this.vtable[t]=this.offset()},S.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},S.Builder.growByteBuffer=function(t){var e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var r=e<<1,n=S.ByteBuffer.allocate(r);return n.setPosition(r-e),n.bytes().set(t.bytes(),r-e),n},S.Builder.prototype.addOffset=function(t){this.prep(S.SIZEOF_INT,0),this.writeInt32(this.offset()-t+S.SIZEOF_INT)},S.Builder.prototype.startObject=function(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(var e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()},S.Builder.prototype.endObject=function(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var t=this.offset(),e=this.vtable_in_use-1;e>=0&&0==this.vtable[e];e--);for(var r=e+1;e>=0;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);var n=(r+2)*S.SIZEOF_SHORT;this.addInt16(n);var i=0,s=this.space;t:for(e=0;e<this.vtables.length;e++){var o=this.bb.capacity()-this.vtables[e];if(n==this.bb.readInt16(o)){for(var a=S.SIZEOF_SHORT;a<n;a+=S.SIZEOF_SHORT)if(this.bb.readInt16(s+a)!=this.bb.readInt16(o+a))continue t;i=this.vtables[e];break}}return i?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,i-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t},S.Builder.prototype.finish=function(t,e,r){var n=r?S.SIZE_PREFIX_LENGTH:0;if(e){var i=e;if(this.prep(this.minalign,S.SIZEOF_INT+S.FILE_IDENTIFIER_LENGTH+n),i.length!=S.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+S.FILE_IDENTIFIER_LENGTH);for(var s=S.FILE_IDENTIFIER_LENGTH-1;s>=0;s--)this.writeInt8(i.charCodeAt(s))}this.prep(this.minalign,S.SIZEOF_INT+n),this.addOffset(t),n&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},S.Builder.prototype.finishSizePrefixed=function(t,e){this.finish(t,e,!0)},S.Builder.prototype.requiredField=function(t,e){var r=this.bb.capacity()-t,n=r-this.bb.readInt32(r);if(!(0!=this.bb.readInt16(n+e)))throw new Error("FlatBuffers: field "+e+" must be set")},S.Builder.prototype.startVector=function(t,e,r){this.notNested(),this.vector_num_elems=e,this.prep(S.SIZEOF_INT,t*e),this.prep(r,t*e)},S.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},S.Builder.prototype.createString=function(t){if(t instanceof Uint8Array)var e=t;else{e=[];for(var r=0;r<t.length;){var n,i=t.charCodeAt(r++);if(i<55296||i>=56320)n=i;else n=(i<<10)+t.charCodeAt(r++)+-56613888;n<128?e.push(n):(n<2048?e.push(n>>6&31|192):(n<65536?e.push(n>>12&15|224):e.push(n>>18&7|240,n>>12&63|128),e.push(n>>6&63|128)),e.push(63&n|128))}}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);r=0;for(var s=this.space,o=this.bb.bytes();r<e.length;r++)o[s++]=e[r];return this.endVector()},S.Builder.prototype.createLong=function(t,e){return S.Long.create(t,e)},S.ByteBuffer=function(t){this.bytes_=t,this.position_=0},S.ByteBuffer.allocate=function(t){return new S.ByteBuffer(new Uint8Array(t))},S.ByteBuffer.prototype.clear=function(){this.position_=0},S.ByteBuffer.prototype.bytes=function(){return this.bytes_},S.ByteBuffer.prototype.position=function(){return this.position_},S.ByteBuffer.prototype.setPosition=function(t){this.position_=t},S.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},S.ByteBuffer.prototype.readInt8=function(t){return this.readUint8(t)<<24>>24},S.ByteBuffer.prototype.readUint8=function(t){return this.bytes_[t]},S.ByteBuffer.prototype.readInt16=function(t){return this.readUint16(t)<<16>>16},S.ByteBuffer.prototype.readUint16=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8},S.ByteBuffer.prototype.readInt32=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24},S.ByteBuffer.prototype.readUint32=function(t){return this.readInt32(t)>>>0},S.ByteBuffer.prototype.readInt64=function(t){return new S.Long(this.readInt32(t),this.readInt32(t+4))},S.ByteBuffer.prototype.readUint64=function(t){return new S.Long(this.readUint32(t),this.readUint32(t+4))},S.ByteBuffer.prototype.readFloat32=function(t){return S.int32[0]=this.readInt32(t),S.float32[0]},S.ByteBuffer.prototype.readFloat64=function(t){return S.int32[S.isLittleEndian?0:1]=this.readInt32(t),S.int32[S.isLittleEndian?1:0]=this.readInt32(t+4),S.float64[0]},S.ByteBuffer.prototype.writeInt8=function(t,e){this.bytes_[t]=e},S.ByteBuffer.prototype.writeUint8=function(t,e){this.bytes_[t]=e},S.ByteBuffer.prototype.writeInt16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},S.ByteBuffer.prototype.writeUint16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},S.ByteBuffer.prototype.writeInt32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},S.ByteBuffer.prototype.writeUint32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},S.ByteBuffer.prototype.writeInt64=function(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)},S.ByteBuffer.prototype.writeUint64=function(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)},S.ByteBuffer.prototype.writeFloat32=function(t,e){S.float32[0]=e,this.writeInt32(t,S.int32[0])},S.ByteBuffer.prototype.writeFloat64=function(t,e){S.float64[0]=e,this.writeInt32(t,S.int32[S.isLittleEndian?0:1]),this.writeInt32(t+4,S.int32[S.isLittleEndian?1:0])},S.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+S.SIZEOF_INT+S.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var t="",e=0;e<S.FILE_IDENTIFIER_LENGTH;e++)t+=String.fromCharCode(this.readInt8(this.position_+S.SIZEOF_INT+e));return t},S.ByteBuffer.prototype.__offset=function(t,e){var r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0},S.ByteBuffer.prototype.__union=function(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t},S.ByteBuffer.prototype.__string=function(t,e){t+=this.readInt32(t);var r=this.readInt32(t),n="",i=0;if(t+=S.SIZEOF_INT,e===S.Encoding.UTF8_BYTES)return this.bytes_.subarray(t,t+r);for(;i<r;){var s,o=this.readUint8(t+i++);if(o<192)s=o;else{var a=this.readUint8(t+i++);if(o<224)s=(31&o)<<6|63&a;else{var u=this.readUint8(t+i++);if(o<240)s=(15&o)<<12|(63&a)<<6|63&u;else s=(7&o)<<18|(63&a)<<12|(63&u)<<6|63&this.readUint8(t+i++)}}s<65536?n+=String.fromCharCode(s):(s-=65536,n+=String.fromCharCode(55296+(s>>10),56320+(1023&s)))}return n},S.ByteBuffer.prototype.__indirect=function(t){return t+this.readInt32(t)},S.ByteBuffer.prototype.__vector=function(t){return t+this.readInt32(t)+S.SIZEOF_INT},S.ByteBuffer.prototype.__vector_len=function(t){return this.readInt32(t+this.readInt32(t))},S.ByteBuffer.prototype.__has_identifier=function(t){if(t.length!=S.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+S.FILE_IDENTIFIER_LENGTH);for(var e=0;e<S.FILE_IDENTIFIER_LENGTH;e++)if(t.charCodeAt(e)!=this.readInt8(this.position_+S.SIZEOF_INT+e))return!1;return!0},S.ByteBuffer.prototype.createLong=function(t,e){return S.Long.create(t,e)}})),H,ln=D((()=>{Jn(),(t=>{let e;(t=>{let e;(t=>{let e;var r;(r=e=t.AttributeType||={})[r.UNDEFINED=0]="UNDEFINED",r[r.FLOAT=1]="FLOAT",r[r.INT=2]="INT",r[r.STRING=3]="STRING",r[r.TENSOR=4]="TENSOR",r[r.GRAPH=5]="GRAPH",r[r.FLOATS=6]="FLOATS",r[r.INTS=7]="INTS",r[r.STRINGS=8]="STRINGS",r[r.TENSORS=9]="TENSORS",r[r.GRAPHS=10]="GRAPHS",r[r.SPARSE_TENSOR=11]="SPARSE_TENSOR",r[r.SPARSE_TENSORS=12]="SPARSE_TENSORS"})(e=t.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(t=>{let e;(t=>{let e;var r;(r=e=t.DimensionValueType||={})[r.UNKNOWN=0]="UNKNOWN",r[r.VALUE=1]="VALUE",r[r.PARAM=2]="PARAM"})(e=t.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(t=>{let e;(t=>{let e;var r;(r=e=t.TensorDataType||={})[r.UNDEFINED=0]="UNDEFINED",r[r.FLOAT=1]="FLOAT",r[r.UINT8=2]="UINT8",r[r.INT8=3]="INT8",r[r.UINT16=4]="UINT16",r[r.INT16=5]="INT16",r[r.INT32=6]="INT32",r[r.INT64=7]="INT64",r[r.STRING=8]="STRING",r[r.BOOL=9]="BOOL",r[r.FLOAT16=10]="FLOAT16",r[r.DOUBLE=11]="DOUBLE",r[r.UINT32=12]="UINT32",r[r.UINT64=13]="UINT64",r[r.COMPLEX64=14]="COMPLEX64",r[r.COMPLEX128=15]="COMPLEX128",r[r.BFLOAT16=16]="BFLOAT16",r[r.FLOAT8E4M3FN=17]="FLOAT8E4M3FN",r[r.FLOAT8E4M3FNUZ=18]="FLOAT8E4M3FNUZ",r[r.FLOAT8E5M2=19]="FLOAT8E5M2",r[r.FLOAT8E5M2FNUZ=20]="FLOAT8E5M2FNUZ"})(e=t.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(t=>{let e;(t=>{let e;var r;(r=e=t.NodeType||={})[r.Primitive=0]="Primitive",r[r.Fused=1]="Fused"})(e=t.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(t=>{let e;(t=>{let e;var r;(r=e=t.TypeInfoValue||={})[r.NONE=0]="NONE",r[r.tensor_type=1]="tensor_type",r[r.sequence_type=2]="sequence_type",r[r.map_type=3]="map_type"})(e=t.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShape(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShape(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}dim(e,r){let n=this.bb.__offset(this.bb_pos,4);return n?(r||new t.experimental.fbs.Dimension).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}dimLength(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startShape(t){t.startObject(1)}static addDim(t,e){t.addFieldOffset(0,e,0)}static createDimVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startDimVector(t,e){t.startVector(4,e,4)}static endShape(t){return t.endObject()}static createShape(t,e){return r.startShape(t),r.addDim(t,e),r.endShape(t)}}e.Shape=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDimension(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDimension(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}value(e){let r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.experimental.fbs.DimensionValue).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}denotation(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startDimension(t){t.startObject(2)}static addValue(t,e){t.addFieldOffset(0,e,0)}static addDenotation(t,e){t.addFieldOffset(1,e,0)}static endDimension(t){return t.endObject()}static createDimension(t,e,n){return r.startDimension(t),r.addValue(t,e),r.addDenotation(t,n),r.endDimension(t)}}e.Dimension=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(t=>{let e;(t=>{class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDimensionValue(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDimensionValue(t,r){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}dimType(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):0}dimValue(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}dimParam(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}static startDimensionValue(t){t.startObject(3)}static addDimType(t,e){t.addFieldInt8(0,e,0)}static addDimValue(t,e){t.addFieldInt64(1,e,t.createLong(0,0))}static addDimParam(t,e){t.addFieldOffset(2,e,0)}static endDimensionValue(t){return t.endObject()}static createDimensionValue(t,r,n,i){return e.startDimensionValue(t),e.addDimType(t,r),e.addDimValue(t,n),e.addDimParam(t,i),e.endDimensionValue(t)}}t.DimensionValue=e})(e=t.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTensorTypeAndShape(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTensorTypeAndShape(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}elemType(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}shape(e){let r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.experimental.fbs.Shape).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startTensorTypeAndShape(t){t.startObject(2)}static addElemType(t,e){t.addFieldInt32(0,e,0)}static addShape(t,e){t.addFieldOffset(1,e,0)}static endTensorTypeAndShape(t){return t.endObject()}static createTensorTypeAndShape(t,e,n){return r.startTensorTypeAndShape(t),r.addElemType(t,e),r.addShape(t,n),r.endTensorTypeAndShape(t)}}e.TensorTypeAndShape=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMapType(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMapType(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}keyType(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}valueType(e){let r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startMapType(t){t.startObject(2)}static addKeyType(t,e){t.addFieldInt32(0,e,0)}static addValueType(t,e){t.addFieldOffset(1,e,0)}static endMapType(t){return t.endObject()}static createMapType(t,e,n){return r.startMapType(t),r.addKeyType(t,e),r.addValueType(t,n),r.endMapType(t)}}e.MapType=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSequenceType(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSequenceType(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}elemType(e){let r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startSequenceType(t){t.startObject(1)}static addElemType(t,e){t.addFieldOffset(0,e,0)}static endSequenceType(t){return t.endObject()}static createSequenceType(t,e){return r.startSequenceType(t),r.addElemType(t,e),r.endSequenceType(t)}}e.SequenceType=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(t=>{let e;(e=t.fbs||={}).EdgeEnd=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}nodeIndex(){return this.bb.readUint32(this.bb_pos)}srcArgIndex(){return this.bb.readInt32(this.bb_pos+4)}dstArgIndex(){return this.bb.readInt32(this.bb_pos+8)}static createEdgeEnd(t,e,r,n){return t.prep(4,12),t.writeInt32(n),t.writeInt32(r),t.writeInt32(e),t.offset()}}})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsNodeEdge(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNodeEdge(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}nodeIndex(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb_pos+t):0}inputEdges(e,r){let n=this.bb.__offset(this.bb_pos,6);return n?(r||new t.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+n)+12*e,this.bb):null}inputEdgesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}outputEdges(e,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new t.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+n)+12*e,this.bb):null}outputEdgesLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startNodeEdge(t){t.startObject(3)}static addNodeIndex(t,e){t.addFieldInt32(0,e,0)}static addInputEdges(t,e){t.addFieldOffset(1,e,0)}static startInputEdgesVector(t,e){t.startVector(12,e,4)}static addOutputEdges(t,e){t.addFieldOffset(2,e,0)}static startOutputEdgesVector(t,e){t.startVector(12,e,4)}static endNodeEdge(t){return t.endObject()}static createNodeEdge(t,e,n,i){return r.startNodeEdge(t),r.addNodeIndex(t,e),r.addInputEdges(t,n),r.addOutputEdges(t,i),r.endNodeEdge(t)}}e.NodeEdge=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsNode(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNode(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}docString(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}domain(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}sinceVersion(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt32(this.bb_pos+t):0}index(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readUint32(this.bb_pos+t):0}opType(t){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}type(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):0}executionProviderType(t){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__string(this.bb_pos+e,t):null}inputs(t,e){let r=this.bb.__offset(this.bb_pos,20);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null}inputsLength(){let t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}outputs(t,e){let r=this.bb.__offset(this.bb_pos,22);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null}outputsLength(){let t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__vector_len(this.bb_pos+t):0}attributes(e,r){let n=this.bb.__offset(this.bb_pos,24);return n?(r||new t.experimental.fbs.Attribute).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}attributesLength(){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__vector_len(this.bb_pos+t):0}inputArgCounts(t){let e=this.bb.__offset(this.bb_pos,26);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0}inputArgCountsLength(){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__vector_len(this.bb_pos+t):0}inputArgCountsArray(){let t=this.bb.__offset(this.bb_pos,26);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}implicitInputs(t,e){let r=this.bb.__offset(this.bb_pos,28);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null}implicitInputsLength(){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__vector_len(this.bb_pos+t):0}static startNode(t){t.startObject(13)}static addName(t,e){t.addFieldOffset(0,e,0)}static addDocString(t,e){t.addFieldOffset(1,e,0)}static addDomain(t,e){t.addFieldOffset(2,e,0)}static addSinceVersion(t,e){t.addFieldInt32(3,e,0)}static addIndex(t,e){t.addFieldInt32(4,e,0)}static addOpType(t,e){t.addFieldOffset(5,e,0)}static addType(t,e){t.addFieldInt32(6,e,0)}static addExecutionProviderType(t,e){t.addFieldOffset(7,e,0)}static addInputs(t,e){t.addFieldOffset(8,e,0)}static createInputsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startInputsVector(t,e){t.startVector(4,e,4)}static addOutputs(t,e){t.addFieldOffset(9,e,0)}static createOutputsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startOutputsVector(t,e){t.startVector(4,e,4)}static addAttributes(t,e){t.addFieldOffset(10,e,0)}static createAttributesVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startAttributesVector(t,e){t.startVector(4,e,4)}static addInputArgCounts(t,e){t.addFieldOffset(11,e,0)}static createInputArgCountsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}static startInputArgCountsVector(t,e){t.startVector(4,e,4)}static addImplicitInputs(t,e){t.addFieldOffset(12,e,0)}static createImplicitInputsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startImplicitInputsVector(t,e){t.startVector(4,e,4)}static endNode(t){return t.endObject()}static createNode(t,e,n,i,s,o,a,u,l,c,h,f,d,p){return r.startNode(t),r.addName(t,e),r.addDocString(t,n),r.addDomain(t,i),r.addSinceVersion(t,s),r.addIndex(t,o),r.addOpType(t,a),r.addType(t,u),r.addExecutionProviderType(t,l),r.addInputs(t,c),r.addOutputs(t,h),r.addAttributes(t,f),r.addInputArgCounts(t,d),r.addImplicitInputs(t,p),r.endNode(t)}}e.Node=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsValueInfo(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsValueInfo(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}docString(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}type(e){let r=this.bb.__offset(this.bb_pos,8);return r?(e||new t.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startValueInfo(t){t.startObject(3)}static addName(t,e){t.addFieldOffset(0,e,0)}static addDocString(t,e){t.addFieldOffset(1,e,0)}static addType(t,e){t.addFieldOffset(2,e,0)}static endValueInfo(t){return t.endObject()}static createValueInfo(t,e,n,i){return r.startValueInfo(t),r.addName(t,e),r.addDocString(t,n),r.addType(t,i),r.endValueInfo(t)}}e.ValueInfo=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(t=>{let e;(t=>{class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTypeInfo(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTypeInfo(t,r){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}denotation(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}valueType(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):0}value(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__union(t,this.bb_pos+e):null}static startTypeInfo(t){t.startObject(3)}static addDenotation(t,e){t.addFieldOffset(0,e,0)}static addValueType(t,e){t.addFieldInt8(1,e,0)}static addValue(t,e){t.addFieldOffset(2,e,0)}static endTypeInfo(t){return t.endObject()}static createTypeInfo(t,r,n,i){return e.startTypeInfo(t),e.addDenotation(t,r),e.addValueType(t,n),e.addValue(t,i),e.endTypeInfo(t)}}t.TypeInfo=e})(e=t.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(t=>{let e;(t=>{class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsOperatorSetId(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsOperatorSetId(t,r){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}domain(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}version(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}static startOperatorSetId(t){t.startObject(2)}static addDomain(t,e){t.addFieldOffset(0,e,0)}static addVersion(t,e){t.addFieldInt64(1,e,t.createLong(0,0))}static endOperatorSetId(t){return t.endObject()}static createOperatorSetId(t,r,n){return e.startOperatorSetId(t),e.addDomain(t,r),e.addVersion(t,n),e.endOperatorSetId(t)}}t.OperatorSetId=e})(e=t.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(t=>{let e;(t=>{class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTensor(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTensor(t,r){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}docString(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}dims(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt64(this.bb.__vector(this.bb_pos+e)+8*t):this.bb.createLong(0,0)}dimsLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}dataType(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt32(this.bb_pos+t):0}rawData(t){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}rawDataLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}rawDataArray(){let t=this.bb.__offset(this.bb_pos,12);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}stringData(t,e){let r=this.bb.__offset(this.bb_pos,14);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null}stringDataLength(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}static startTensor(t){t.startObject(6)}static addName(t,e){t.addFieldOffset(0,e,0)}static addDocString(t,e){t.addFieldOffset(1,e,0)}static addDims(t,e){t.addFieldOffset(2,e,0)}static createDimsVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startDimsVector(t,e){t.startVector(8,e,8)}static addDataType(t,e){t.addFieldInt32(3,e,0)}static addRawData(t,e){t.addFieldOffset(4,e,0)}static createRawDataVector(t,e){t.startVector(1,e.length,1);for(let r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()}static startRawDataVector(t,e){t.startVector(1,e,1)}static addStringData(t,e){t.addFieldOffset(5,e,0)}static createStringDataVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startStringDataVector(t,e){t.startVector(4,e,4)}static endTensor(t){return t.endObject()}static createTensor(t,r,n,i,s,o,a){return e.startTensor(t),e.addName(t,r),e.addDocString(t,n),e.addDims(t,i),e.addDataType(t,s),e.addRawData(t,o),e.addStringData(t,a),e.endTensor(t)}}t.Tensor=e})(e=t.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSparseTensor(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSparseTensor(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}values(e){let r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}indices(e){let r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}dims(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt64(this.bb.__vector(this.bb_pos+e)+8*t):this.bb.createLong(0,0)}dimsLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSparseTensor(t){t.startObject(3)}static addValues(t,e){t.addFieldOffset(0,e,0)}static addIndices(t,e){t.addFieldOffset(1,e,0)}static addDims(t,e){t.addFieldOffset(2,e,0)}static createDimsVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startDimsVector(t,e){t.startVector(8,e,8)}static endSparseTensor(t){return t.endObject()}static createSparseTensor(t,e,n,i){return r.startSparseTensor(t),r.addValues(t,e),r.addIndices(t,n),r.addDims(t,i),r.endSparseTensor(t)}}e.SparseTensor=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAttribute(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAttribute(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}docString(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}type(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):0}f(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat32(this.bb_pos+t):0}i(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}s(t){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}t(e){let r=this.bb.__offset(this.bb_pos,16);return r?(e||new t.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}g(e){let r=this.bb.__offset(this.bb_pos,18);return r?(e||new t.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}floats(t){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0}floatsLength(){let t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}floatsArray(){let t=this.bb.__offset(this.bb_pos,20);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}ints(t){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readInt64(this.bb.__vector(this.bb_pos+e)+8*t):this.bb.createLong(0,0)}intsLength(){let t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__vector_len(this.bb_pos+t):0}strings(t,e){let r=this.bb.__offset(this.bb_pos,24);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null}stringsLength(){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__vector_len(this.bb_pos+t):0}tensors(e,r){let n=this.bb.__offset(this.bb_pos,26);return n?(r||new t.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}tensorsLength(){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__vector_len(this.bb_pos+t):0}graphs(e,r){let n=this.bb.__offset(this.bb_pos,28);return n?(r||new t.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}graphsLength(){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAttribute(t){t.startObject(13)}static addName(t,e){t.addFieldOffset(0,e,0)}static addDocString(t,e){t.addFieldOffset(1,e,0)}static addType(t,e){t.addFieldInt32(2,e,0)}static addF(t,e){t.addFieldFloat32(3,e,0)}static addI(t,e){t.addFieldInt64(4,e,t.createLong(0,0))}static addS(t,e){t.addFieldOffset(5,e,0)}static addT(t,e){t.addFieldOffset(6,e,0)}static addG(t,e){t.addFieldOffset(7,e,0)}static addFloats(t,e){t.addFieldOffset(8,e,0)}static createFloatsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addFloat32(e[r]);return t.endVector()}static startFloatsVector(t,e){t.startVector(4,e,4)}static addInts(t,e){t.addFieldOffset(9,e,0)}static createIntsVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startIntsVector(t,e){t.startVector(8,e,8)}static addStrings(t,e){t.addFieldOffset(10,e,0)}static createStringsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startStringsVector(t,e){t.startVector(4,e,4)}static addTensors(t,e){t.addFieldOffset(11,e,0)}static createTensorsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startTensorsVector(t,e){t.startVector(4,e,4)}static addGraphs(t,e){t.addFieldOffset(12,e,0)}static createGraphsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startGraphsVector(t,e){t.startVector(4,e,4)}static endAttribute(t){return t.endObject()}static createAttribute(t,e,n,i,s,o,a,u,l,c,h,f,d,p){return r.startAttribute(t),r.addName(t,e),r.addDocString(t,n),r.addType(t,i),r.addF(t,s),r.addI(t,o),r.addS(t,a),r.addT(t,u),r.addG(t,l),r.addFloats(t,c),r.addInts(t,h),r.addStrings(t,f),r.addTensors(t,d),r.addGraphs(t,p),r.endAttribute(t)}}e.Attribute=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGraph(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGraph(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}initializers(e,r){let n=this.bb.__offset(this.bb_pos,4);return n?(r||new t.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}initializersLength(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}nodeArgs(e,r){let n=this.bb.__offset(this.bb_pos,6);return n?(r||new t.experimental.fbs.ValueInfo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}nodeArgsLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}nodes(e,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new t.experimental.fbs.Node).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}nodesLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}maxNodeIndex(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint32(this.bb_pos+t):0}nodeEdges(e,r){let n=this.bb.__offset(this.bb_pos,12);return n?(r||new t.experimental.fbs.NodeEdge).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}nodeEdgesLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}inputs(t,e){let r=this.bb.__offset(this.bb_pos,14);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null}inputsLength(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}outputs(t,e){let r=this.bb.__offset(this.bb_pos,16);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null}outputsLength(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}sparseInitializers(e,r){let n=this.bb.__offset(this.bb_pos,18);return n?(r||new t.experimental.fbs.SparseTensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}sparseInitializersLength(){let t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGraph(t){t.startObject(8)}static addInitializers(t,e){t.addFieldOffset(0,e,0)}static createInitializersVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startInitializersVector(t,e){t.startVector(4,e,4)}static addNodeArgs(t,e){t.addFieldOffset(1,e,0)}static createNodeArgsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startNodeArgsVector(t,e){t.startVector(4,e,4)}static addNodes(t,e){t.addFieldOffset(2,e,0)}static createNodesVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startNodesVector(t,e){t.startVector(4,e,4)}static addMaxNodeIndex(t,e){t.addFieldInt32(3,e,0)}static addNodeEdges(t,e){t.addFieldOffset(4,e,0)}static createNodeEdgesVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startNodeEdgesVector(t,e){t.startVector(4,e,4)}static addInputs(t,e){t.addFieldOffset(5,e,0)}static createInputsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startInputsVector(t,e){t.startVector(4,e,4)}static addOutputs(t,e){t.addFieldOffset(6,e,0)}static createOutputsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startOutputsVector(t,e){t.startVector(4,e,4)}static addSparseInitializers(t,e){t.addFieldOffset(7,e,0)}static createSparseInitializersVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startSparseInitializersVector(t,e){t.startVector(4,e,4)}static endGraph(t){return t.endObject()}static createGraph(t,e,n,i,s,o,a,u,l){return r.startGraph(t),r.addInitializers(t,e),r.addNodeArgs(t,n),r.addNodes(t,i),r.addMaxNodeIndex(t,s),r.addNodeEdges(t,o),r.addInputs(t,a),r.addOutputs(t,u),r.addSparseInitializers(t,l),r.endGraph(t)}}e.Graph=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsModel(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsModel(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}irVersion(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}opsetImport(e,r){let n=this.bb.__offset(this.bb_pos,6);return n?(r||new t.experimental.fbs.OperatorSetId).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}opsetImportLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}producerName(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}producerVersion(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}domain(t){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}modelVersion(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}docString(t){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__string(this.bb_pos+e,t):null}graph(e){let r=this.bb.__offset(this.bb_pos,18);return r?(e||new t.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}graphDocString(t){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.__string(this.bb_pos+e,t):null}static startModel(t){t.startObject(9)}static addIrVersion(t,e){t.addFieldInt64(0,e,t.createLong(0,0))}static addOpsetImport(t,e){t.addFieldOffset(1,e,0)}static createOpsetImportVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startOpsetImportVector(t,e){t.startVector(4,e,4)}static addProducerName(t,e){t.addFieldOffset(2,e,0)}static addProducerVersion(t,e){t.addFieldOffset(3,e,0)}static addDomain(t,e){t.addFieldOffset(4,e,0)}static addModelVersion(t,e){t.addFieldInt64(5,e,t.createLong(0,0))}static addDocString(t,e){t.addFieldOffset(6,e,0)}static addGraph(t,e){t.addFieldOffset(7,e,0)}static addGraphDocString(t,e){t.addFieldOffset(8,e,0)}static endModel(t){return t.endObject()}static createModel(t,e,n,i,s,o,a,u,l,c){return r.startModel(t),r.addIrVersion(t,e),r.addOpsetImport(t,n),r.addProducerName(t,i),r.addProducerVersion(t,s),r.addDomain(t,o),r.addModelVersion(t,a),r.addDocString(t,u),r.addGraph(t,l),r.addGraphDocString(t,c),r.endModel(t)}}e.Model=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(t=>{let e;(t=>{class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsKernelCreateInfos(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKernelCreateInfos(t,r){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}nodeIndices(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}nodeIndicesLength(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}nodeIndicesArray(){let t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}kernelDefHashes(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+8*t):this.bb.createLong(0,0)}kernelDefHashesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}static startKernelCreateInfos(t){t.startObject(2)}static addNodeIndices(t,e){t.addFieldOffset(0,e,0)}static createNodeIndicesVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}static startNodeIndicesVector(t,e){t.startVector(4,e,4)}static addKernelDefHashes(t,e){t.addFieldOffset(1,e,0)}static createKernelDefHashesVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startKernelDefHashesVector(t,e){t.startVector(8,e,8)}static endKernelCreateInfos(t){return t.endObject()}static createKernelCreateInfos(t,r,n){return e.startKernelCreateInfos(t),e.addNodeIndices(t,r),e.addKernelDefHashes(t,n),e.endKernelCreateInfos(t)}}t.KernelCreateInfos=e})(e=t.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSubGraphSessionState(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSubGraphSessionState(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}graphId(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}sessionState(e){let r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startSubGraphSessionState(t){t.startObject(2)}static addGraphId(t,e){t.addFieldOffset(0,e,0)}static addSessionState(t,e){t.addFieldOffset(1,e,0)}static endSubGraphSessionState(t){let e=t.endObject();return t.requiredField(e,4),e}static createSubGraphSessionState(t,e,n){return r.startSubGraphSessionState(t),r.addGraphId(t,e),r.addSessionState(t,n),r.endSubGraphSessionState(t)}}e.SubGraphSessionState=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSessionState(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSessionState(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}kernels(e){let r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.experimental.fbs.KernelCreateInfos).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}subGraphSessionStates(e,r){let n=this.bb.__offset(this.bb_pos,6);return n?(r||new t.experimental.fbs.SubGraphSessionState).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}subGraphSessionStatesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSessionState(t){t.startObject(2)}static addKernels(t,e){t.addFieldOffset(0,e,0)}static addSubGraphSessionStates(t,e){t.addFieldOffset(1,e,0)}static createSubGraphSessionStatesVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startSubGraphSessionStatesVector(t,e){t.startVector(4,e,4)}static endSessionState(t){return t.endObject()}static createSessionState(t,e,n){return r.startSessionState(t),r.addKernels(t,e),r.addSubGraphSessionStates(t,n),r.endSessionState(t)}}e.SessionState=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={}),(t=>{let e;(e=>{let r;(e=>{class r{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInferenceSession(t,e){return(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInferenceSession(t,e){return t.setPosition(t.position()+S.SIZE_PREFIX_LENGTH),(e||new r).__init(t.readInt32(t.position())+t.position(),t)}static bufferHasIdentifier(t){return t.__has_identifier("ORTM")}ortVersion(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}model(e){let r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.experimental.fbs.Model).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}sessionState(e){let r=this.bb.__offset(this.bb_pos,8);return r?(e||new t.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startInferenceSession(t){t.startObject(3)}static addOrtVersion(t,e){t.addFieldOffset(0,e,0)}static addModel(t,e){t.addFieldOffset(1,e,0)}static addSessionState(t,e){t.addFieldOffset(2,e,0)}static endInferenceSession(t){return t.endObject()}static finishInferenceSessionBuffer(t,e){t.finish(e,"ORTM")}static finishSizePrefixedInferenceSessionBuffer(t,e){t.finish(e,"ORTM",!0)}static createInferenceSession(t,e,n,i){return r.startInferenceSession(t),r.addOrtVersion(t,e),r.addModel(t,n),r.addSessionState(t,i),r.endInferenceSession(t)}}e.InferenceSession=r})(r=e.fbs||={})})(e=t.experimental||={})})(H||={})})),Ws=ye(((t,e)=>{e.exports=function(t,e){for(var r=new Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,o){r[n]=function(t){if(s)if(s=!1,t)o(t);else{for(var e=new Array(arguments.length-1),r=0;r<e.length;)e[r++]=arguments[r];i.apply(null,e)}};try{t.apply(e||null,r)}catch(t){s&&(s=!1,o(t))}}))}})),qs=ye((t=>{var e=t;e.length=function(t){var e=t.length;if(!e)return 0;for(var r=0;--e%4>1&&"="===t.charAt(e);)++r;return Math.ceil(3*t.length)/4-r};var r,n=new Array(64),i=new Array(123);for(r=0;r<64;)i[n[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;e.encode=function(t,e,r){for(var i,s=null,o=[],a=0,u=0;e<r;){var l=t[e++];switch(u){case 0:o[a++]=n[l>>2],i=(3&l)<<4,u=1;break;case 1:o[a++]=n[i|l>>4],i=(15&l)<<2,u=2;break;case 2:o[a++]=n[i|l>>6],o[a++]=n[63&l],u=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return u&&(o[a++]=n[i],o[a++]=61,1===u&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var s="invalid encoding";e.decode=function(t,e,r){for(var n,o=r,a=0,u=0;u<t.length;){var l=t.charCodeAt(u++);if(61===l&&a>1)break;if(void 0===(l=i[l]))throw Error(s);switch(a){case 0:n=l,a=1;break;case 1:e[r++]=n<<2|(48&l)>>4,n=l,a=2;break;case 2:e[r++]=(15&n)<<4|(60&l)>>2,n=l,a=3;break;case 3:e[r++]=(3&n)<<6|l,a=0}}if(1===a)throw Error(s);return r-o},e.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}})),Xs=ye(((t,e)=>{function r(){this._listeners={}}e.exports=r,r.prototype.on=function(t,e,r){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:r||this}),this},r.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var r=this._listeners[t],n=0;n<r.length;)r[n].fn===e?r.splice(n,1):++n;return this},r.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<e.length;)e[n].fn.apply(e[n++].ctx,r)}return this}})),ru=ye(((t,e)=>{function r(t){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),r=new Uint8Array(e.buffer),n=128===r[3];function i(t,n,i){e[0]=t,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(t,n,i){e[0]=t,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function o(t,n){return r[0]=t[n],r[1]=t[n+1],r[2]=t[n+2],r[3]=t[n+3],e[0]}function a(t,n){return r[3]=t[n],r[2]=t[n+1],r[1]=t[n+2],r[0]=t[n+3],e[0]}t.writeFloatLE=n?i:s,t.writeFloatBE=n?s:i,t.readFloatLE=n?o:a,t.readFloatBE=n?a:o}():function(){function e(t,e,r,n){var i=e<0?1:0;if(i&&(e=-e),0===e)t(1/e>0?0:2147483648,r,n);else if(isNaN(e))t(2143289344,r,n);else if(e>34028234663852886e22)t((i<<31|2139095040)>>>0,r,n);else if(e<11754943508222875e-54)t((i<<31|Math.round(e/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(e)/Math.LN2);t((i<<31|s+127<<23|8388607&Math.round(e*Math.pow(2,-s)*8388608))>>>0,r,n)}}function r(t,e,r){var n=t(e,r),i=2*(n>>31)+1,s=n>>>23&255,o=8388607&n;return 255===s?o?NaN:i*(1/0):0===s?1401298464324817e-60*i*o:i*Math.pow(2,s-150)*(o+8388608)}t.writeFloatLE=e.bind(null,n),t.writeFloatBE=e.bind(null,i),t.readFloatLE=r.bind(null,s),t.readFloatBE=r.bind(null,o)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),r=new Uint8Array(e.buffer),n=128===r[7];function i(t,n,i){e[0]=t,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(t,n,i){e[0]=t,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function o(t,n){return r[0]=t[n],r[1]=t[n+1],r[2]=t[n+2],r[3]=t[n+3],r[4]=t[n+4],r[5]=t[n+5],r[6]=t[n+6],r[7]=t[n+7],e[0]}function a(t,n){return r[7]=t[n],r[6]=t[n+1],r[5]=t[n+2],r[4]=t[n+3],r[3]=t[n+4],r[2]=t[n+5],r[1]=t[n+6],r[0]=t[n+7],e[0]}t.writeDoubleLE=n?i:s,t.writeDoubleBE=n?s:i,t.readDoubleLE=n?o:a,t.readDoubleBE=n?a:o}():function(){function e(t,e,r,n,i,s){var o=n<0?1:0;if(o&&(n=-n),0===n)t(0,i,s+e),t(1/n>0?0:2147483648,i,s+r);else if(isNaN(n))t(0,i,s+e),t(2146959360,i,s+r);else if(n>17976931348623157e292)t(0,i,s+e),t((o<<31|2146435072)>>>0,i,s+r);else{var a;if(n<22250738585072014e-324)t((a=n/5e-324)>>>0,i,s+e),t((o<<31|a/4294967296)>>>0,i,s+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),t(4503599627370496*(a=n*Math.pow(2,-u))>>>0,i,s+e),t((o<<31|u+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}}function r(t,e,r,n,i){var s=t(n,i+e),o=t(n,i+r),a=2*(o>>31)+1,u=o>>>20&2047,l=4294967296*(1048575&o)+s;return 2047===u?l?NaN:a*(1/0):0===u?5e-324*a*l:a*Math.pow(2,u-1075)*(l+4503599627370496)}t.writeDoubleLE=e.bind(null,n,0,4),t.writeDoubleBE=e.bind(null,i,4,0),t.readDoubleLE=r.bind(null,s,0,4),t.readDoubleBE=r.bind(null,o,4,0)}(),t}function n(t,e,r){e[r]=255&t,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function i(t,e,r){e[r]=t>>>24,e[r+1]=t>>>16&255,e[r+2]=t>>>8&255,e[r+3]=255&t}function s(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function o(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}e.exports=r(r)})),nu=ye(((exports,module)=>{function inquire(moduleName){try{var mod=undefined;if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire})),iu=ye((t=>{var e=t;e.length=function(t){for(var e=0,r=0,n=0;n<t.length;++n)(r=t.charCodeAt(n))<128?e+=1:r<2048?e+=2:55296==(64512&r)&&56320==(64512&t.charCodeAt(n+1))?(++n,e+=4):e+=3;return e},e.read=function(t,e,r){if(r-e<1)return"";for(var n,i=null,s=[],o=0;e<r;)(n=t[e++])<128?s[o++]=n:n>191&&n<224?s[o++]=(31&n)<<6|63&t[e++]:n>239&&n<365?(n=((7&n)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,s[o++]=55296+(n>>10),s[o++]=56320+(1023&n)):s[o++]=(15&n)<<12|(63&t[e++])<<6|63&t[e++],o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))},e.write=function(t,e,r){for(var n,i,s=r,o=0;o<t.length;++o)(n=t.charCodeAt(o))<128?e[r++]=n:n<2048?(e[r++]=n>>6|192,e[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=t.charCodeAt(o+1)))?(n=65536+((1023&n)<<10)+(1023&i),++o,e[r++]=n>>18|240,e[r++]=n>>12&63|128,e[r++]=n>>6&63|128,e[r++]=63&n|128):(e[r++]=n>>12|224,e[r++]=n>>6&63|128,e[r++]=63&n|128);return r-s}})),su=ye(((t,e)=>{e.exports=function(t,e,r){var n=r||8192,i=n>>>1,s=null,o=n;return function(r){if(r<1||r>i)return t(r);o+r>n&&(s=t(n),o=0);var a=e.call(s,o,o+=r);return 7&o&&(o=1+(7|o)),a}}})),lu=ye(((t,e)=>{e.exports=n;var r=er();function n(t,e){this.lo=t>>>0,this.hi=e>>>0}var i=n.zero=new n(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var s=n.zeroHash="\0\0\0\0\0\0\0\0";n.fromNumber=function(t){if(0===t)return i;var e=t<0;e&&(t=-t);var r=t>>>0,s=(t-r)/4294967296>>>0;return e&&(s=~s>>>0,r=~r>>>0,++r>4294967295&&(r=0,++s>4294967295&&(s=0))),new n(r,s)},n.from=function(t){if("number"==typeof t)return n.fromNumber(t);if(r.isString(t)){if(!r.Long)return n.fromNumber(parseInt(t,10));t=r.Long.fromString(t)}return t.low||t.high?new n(t.low>>>0,t.high>>>0):i},n.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,r=~this.hi>>>0;return e||(r=r+1>>>0),-(e+4294967296*r)}return this.lo+4294967296*this.hi},n.prototype.toLong=function(t){return r.Long?new r.Long(0|this.lo,0|this.hi,!!t):{low:0|this.lo,high:0|this.hi,unsigned:!!t}};var o=String.prototype.charCodeAt;n.fromHash=function(t){return t===s?i:new n((o.call(t,0)|o.call(t,1)<<8|o.call(t,2)<<16|o.call(t,3)<<24)>>>0,(o.call(t,4)|o.call(t,5)<<8|o.call(t,6)<<16|o.call(t,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},n.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},n.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:r<128?9:10}})),er=ye((t=>{var e=t;function r(t,e,r){for(var n=Object.keys(e),i=0;i<n.length;++i)(void 0===t[n[i]]||!r)&&(t[n[i]]=e[n[i]]);return t}function n(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return t},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}e.asPromise=Ws(),e.base64=qs(),e.EventEmitter=Xs(),e.float=ru(),e.inquire=nu(),e.utf8=iu(),e.pool=su(),e.LongBits=lu(),e.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node),e.global=e.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||t,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},e.isString=function(t){return"string"==typeof t||t instanceof String},e.isObject=function(t){return t&&"object"==typeof t},e.isset=e.isSet=function(t,e){var r=t[e];return!(null==r||!t.hasOwnProperty(e))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},e.Buffer=function(){try{var t=e.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(t){return"number"==typeof t?e.Buffer?e._Buffer_allocUnsafe(t):new e.Array(t):e.Buffer?e._Buffer_from(t):typeof Uint8Array>"u"?t:new Uint8Array(t)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(t){return t?e.LongBits.from(t).toHash():e.LongBits.zeroHash},e.longFromHash=function(t,r){var n=e.LongBits.fromHash(t);return e.Long?e.Long.fromBits(n.lo,n.hi,r):n.toNumber(!!r)},e.merge=r,e.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},e.newError=n,e.ProtocolError=n("ProtocolError"),e.oneOfGetter=function(t){for(var e={},r=0;r<t.length;++r)e[t[r]]=1;return function(){for(var t=Object.keys(this),r=t.length-1;r>-1;--r)if(1===e[t[r]]&&void 0!==this[t[r]]&&null!==this[t[r]])return t[r]}},e.oneOfSetter=function(t){return function(e){for(var r=0;r<t.length;++r)t[r]!==e&&delete this[t[r]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var t=e.Buffer;t?(e._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,r){return new t(e,r)},e._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):e._Buffer_from=e._Buffer_allocUnsafe=null}})),mi=ye(((t,e)=>{e.exports=c;var r,n=er(),i=n.LongBits,s=n.base64,o=n.utf8;function a(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function u(){}function l(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function c(){this.len=0,this.head=new a(u,0,0),this.tail=this.head,this.states=null}var h=function(){return n.Buffer?function(){return(c.create=function(){return new r})()}:function(){return new c}};function f(t,e,r){e[r]=255&t}function d(t,e){this.len=t,this.next=void 0,this.val=e}function p(t,e,r){for(;t.hi;)e[r++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=127&t.lo|128,t.lo=t.lo>>>7;e[r++]=t.lo}function v(t,e,r){e[r]=255&t,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}c.create=h(),c.alloc=function(t){return new n.Array(t)},n.Array!==Array&&(c.alloc=n.pool(c.alloc,n.Array.prototype.subarray)),c.prototype._push=function(t,e,r){return this.tail=this.tail.next=new a(t,e,r),this.len+=e,this},d.prototype=Object.create(a.prototype),d.prototype.fn=function(t,e,r){for(;t>127;)e[r++]=127&t|128,t>>>=7;e[r]=t},c.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new d((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},c.prototype.int32=function(t){return t<0?this._push(p,10,i.fromNumber(t)):this.uint32(t)},c.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},c.prototype.uint64=function(t){var e=i.from(t);return this._push(p,e.length(),e)},c.prototype.int64=c.prototype.uint64,c.prototype.sint64=function(t){var e=i.from(t).zzEncode();return this._push(p,e.length(),e)},c.prototype.bool=function(t){return this._push(f,1,t?1:0)},c.prototype.fixed32=function(t){return this._push(v,4,t>>>0)},c.prototype.sfixed32=c.prototype.fixed32,c.prototype.fixed64=function(t){var e=i.from(t);return this._push(v,4,e.lo)._push(v,4,e.hi)},c.prototype.sfixed64=c.prototype.fixed64,c.prototype.float=function(t){return this._push(n.float.writeFloatLE,4,t)},c.prototype.double=function(t){return this._push(n.float.writeDoubleLE,8,t)};var y=n.Array.prototype.set?function(t,e,r){e.set(t,r)}:function(t,e,r){for(var n=0;n<t.length;++n)e[r+n]=t[n]};c.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(f,1,0);if(n.isString(t)){var r=c.alloc(e=s.length(t));s.decode(t,r,0),t=r}return this.uint32(e)._push(y,e,t)},c.prototype.string=function(t){var e=o.length(t);return e?this.uint32(e)._push(o.write,e,t):this._push(f,1,0)},c.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new a(u,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new a(u,0,0),this.len=0),this},c.prototype.ldelim=function(){var t=this.head,e=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=t.next,this.tail=e,this.len+=r),this},c.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),r=0;t;)t.fn(t.val,e,r),r+=t.len,t=t.next;return e},c._configure=function(t){r=t,c.create=h(),r._configure()}})),yu=ye(((t,e)=>{e.exports=i;var r=mi();(i.prototype=Object.create(r.prototype)).constructor=i;var n=er();function i(){r.call(this)}function s(t,e,r){t.length<40?n.utf8.write(t,e,r):e.utf8Write?e.utf8Write(t,r):e.write(t,r)}i._configure=function(){i.alloc=n._Buffer_allocUnsafe,i.writeBytesBuffer=n.Buffer&&n.Buffer.prototype instanceof Uint8Array&&"set"===n.Buffer.prototype.set.name?function(t,e,r){e.set(t,r)}:function(t,e,r){if(t.copy)t.copy(e,r,0,t.length);else for(var n=0;n<t.length;)e[r++]=t[n++]}},i.prototype.bytes=function(t){n.isString(t)&&(t=n._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(i.writeBytesBuffer,e,t),this},i.prototype.string=function(t){var e=n.Buffer.byteLength(t);return this.uint32(e),e&&this._push(s,e,t),this},i._configure()})),yi=ye(((t,e)=>{e.exports=a;var r,n=er(),i=n.LongBits,s=n.utf8;function o(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function a(t){this.buf=t,this.pos=0,this.len=t.length}var u,l=typeof Uint8Array<"u"?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new a(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new a(t);throw Error("illegal buffer")},c=function(){return n.Buffer?function(t){return(a.create=function(t){return n.Buffer.isBuffer(t)?new r(t):l(t)})(t)}:l};function h(){var t=new i(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw o(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw o(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function f(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw o(this,8);return new i(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}a.create=c(),a.prototype._slice=n.Array.prototype.subarray||n.Array.prototype.slice,a.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return u;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return u}),a.prototype.int32=function(){return 0|this.uint32()},a.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)},a.prototype.bool=function(){return 0!==this.uint32()},a.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return f(this.buf,this.pos+=4)},a.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|f(this.buf,this.pos+=4)},a.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var t=n.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},a.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var t=n.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},a.prototype.bytes=function(){var t=this.uint32(),e=this.pos,r=this.pos+t;if(r>this.len)throw o(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,r):e===r?new this.buf.constructor(0):this._slice.call(this.buf,e,r)},a.prototype.string=function(){var t=this.bytes();return s.read(t,0,t.length)},a.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw o(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw o(this)}while(128&this.buf[this.pos++]);return this},a.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},a._configure=function(t){r=t,a.create=c(),r._configure();var e=n.Long?"toLong":"toNumber";n.merge(a.prototype,{int64:function(){return h.call(this)[e](!1)},uint64:function(){return h.call(this)[e](!0)},sint64:function(){return h.call(this).zzDecode()[e](!1)},fixed64:function(){return d.call(this)[e](!0)},sfixed64:function(){return d.call(this)[e](!1)}})}})),Au=ye(((t,e)=>{e.exports=i;var r=yi();(i.prototype=Object.create(r.prototype)).constructor=i;var n=er();function i(t){r.call(this,t)}i._configure=function(){n.Buffer&&(i.prototype._slice=n.Buffer.prototype.slice)},i.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},i._configure()})),Pu=ye(((t,e)=>{e.exports=n;var r=er();function n(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!e,this.responseDelimited=!!n}(n.prototype=Object.create(r.EventEmitter.prototype)).constructor=n,n.prototype.rpcCall=function t(e,n,i,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(t,a,e,n,i,s);if(a.rpcImpl)try{return a.rpcImpl(e,n[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),(function(t,r){if(t)return a.emit("error",t,e),o(t);if(null!==r){if(!(r instanceof i))try{r=i[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(t){return a.emit("error",t,e),o(t)}return a.emit("data",r,e),o(null,r)}a.end(!0)}))}catch(t){return a.emit("error",t,e),void setTimeout((function(){o(t)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},n.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}})),Lu=ye((t=>{t.Service=Pu()})),Fu=ye(((t,e)=>{e.exports={}})),ku=ye((t=>{var e=t;function r(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}e.build="minimal",e.Writer=mi(),e.BufferWriter=yu(),e.Reader=yi(),e.BufferReader=Au(),e.util=er(),e.rpc=Lu(),e.roots=Fu(),e.configure=r,r()})),Ru=ye(((t,e)=>{e.exports=ku()})),Ur=ye(((t,e)=>{var r,n,i,s=Ru(),o=s.Reader,a=s.Writer,u=s.util,l=s.roots.default||(s.roots.default={});l.onnx=((i={}).Version=(r={},(n=Object.create(r))[r[0]="_START_VERSION"]=0,n[r[1]="IR_VERSION_2017_10_10"]=1,n[r[2]="IR_VERSION_2017_10_30"]=2,n[r[3]="IR_VERSION_2017_11_3"]=3,n[r[4]="IR_VERSION_2019_1_22"]=4,n[r[5]="IR_VERSION_2019_3_18"]=5,n[r[6]="IR_VERSION_2019_9_19"]=6,n[r[7]="IR_VERSION_2020_5_8"]=7,n[r[8]="IR_VERSION_2021_7_30"]=8,n[r[9]="IR_VERSION"]=9,n),i.AttributeProto=function(){function t(t){if(this.floats=[],this.ints=[],this.strings=[],this.tensors=[],this.graphs=[],this.sparseTensors=[],this.typeProtos=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.name="",t.prototype.refAttrName="",t.prototype.docString="",t.prototype.type=0,t.prototype.f=0,t.prototype.i=u.Long?u.Long.fromBits(0,0,!1):0,t.prototype.s=u.newBuffer([]),t.prototype.t=null,t.prototype.g=null,t.prototype.sparseTensor=null,t.prototype.tp=null,t.prototype.floats=u.emptyArray,t.prototype.ints=u.emptyArray,t.prototype.strings=u.emptyArray,t.prototype.tensors=u.emptyArray,t.prototype.graphs=u.emptyArray,t.prototype.sparseTensors=u.emptyArray,t.prototype.typeProtos=u.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(10).string(t.name),null!=t.f&&Object.hasOwnProperty.call(t,"f")&&e.uint32(21).float(t.f),null!=t.i&&Object.hasOwnProperty.call(t,"i")&&e.uint32(24).int64(t.i),null!=t.s&&Object.hasOwnProperty.call(t,"s")&&e.uint32(34).bytes(t.s),null!=t.t&&Object.hasOwnProperty.call(t,"t")&&l.onnx.TensorProto.encode(t.t,e.uint32(42).fork()).ldelim(),null!=t.g&&Object.hasOwnProperty.call(t,"g")&&l.onnx.GraphProto.encode(t.g,e.uint32(50).fork()).ldelim(),null!=t.floats&&t.floats.length){e.uint32(58).fork();for(var r=0;r<t.floats.length;++r)e.float(t.floats[r]);e.ldelim()}if(null!=t.ints&&t.ints.length){for(e.uint32(66).fork(),r=0;r<t.ints.length;++r)e.int64(t.ints[r]);e.ldelim()}if(null!=t.strings&&t.strings.length)for(r=0;r<t.strings.length;++r)e.uint32(74).bytes(t.strings[r]);if(null!=t.tensors&&t.tensors.length)for(r=0;r<t.tensors.length;++r)l.onnx.TensorProto.encode(t.tensors[r],e.uint32(82).fork()).ldelim();if(null!=t.graphs&&t.graphs.length)for(r=0;r<t.graphs.length;++r)l.onnx.GraphProto.encode(t.graphs[r],e.uint32(90).fork()).ldelim();if(null!=t.docString&&Object.hasOwnProperty.call(t,"docString")&&e.uint32(106).string(t.docString),null!=t.tp&&Object.hasOwnProperty.call(t,"tp")&&l.onnx.TypeProto.encode(t.tp,e.uint32(114).fork()).ldelim(),null!=t.typeProtos&&t.typeProtos.length)for(r=0;r<t.typeProtos.length;++r)l.onnx.TypeProto.encode(t.typeProtos[r],e.uint32(122).fork()).ldelim();if(null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(160).int32(t.type),null!=t.refAttrName&&Object.hasOwnProperty.call(t,"refAttrName")&&e.uint32(170).string(t.refAttrName),null!=t.sparseTensor&&Object.hasOwnProperty.call(t,"sparseTensor")&&l.onnx.SparseTensorProto.encode(t.sparseTensor,e.uint32(178).fork()).ldelim(),null!=t.sparseTensors&&t.sparseTensors.length)for(r=0;r<t.sparseTensors.length;++r)l.onnx.SparseTensorProto.encode(t.sparseTensors[r],e.uint32(186).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.AttributeProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.name=t.string();break;case 21:n.refAttrName=t.string();break;case 13:n.docString=t.string();break;case 20:n.type=t.int32();break;case 2:n.f=t.float();break;case 3:n.i=t.int64();break;case 4:n.s=t.bytes();break;case 5:n.t=l.onnx.TensorProto.decode(t,t.uint32());break;case 6:n.g=l.onnx.GraphProto.decode(t,t.uint32());break;case 22:n.sparseTensor=l.onnx.SparseTensorProto.decode(t,t.uint32());break;case 14:n.tp=l.onnx.TypeProto.decode(t,t.uint32());break;case 7:if(n.floats&&n.floats.length||(n.floats=[]),2==(7&i))for(var s=t.uint32()+t.pos;t.pos<s;)n.floats.push(t.float());else n.floats.push(t.float());break;case 8:if(n.ints&&n.ints.length||(n.ints=[]),2==(7&i))for(s=t.uint32()+t.pos;t.pos<s;)n.ints.push(t.int64());else n.ints.push(t.int64());break;case 9:n.strings&&n.strings.length||(n.strings=[]),n.strings.push(t.bytes());break;case 10:n.tensors&&n.tensors.length||(n.tensors=[]),n.tensors.push(l.onnx.TensorProto.decode(t,t.uint32()));break;case 11:n.graphs&&n.graphs.length||(n.graphs=[]),n.graphs.push(l.onnx.GraphProto.decode(t,t.uint32()));break;case 23:n.sparseTensors&&n.sparseTensors.length||(n.sparseTensors=[]),n.sparseTensors.push(l.onnx.SparseTensorProto.decode(t,t.uint32()));break;case 15:n.typeProtos&&n.typeProtos.length||(n.typeProtos=[]),n.typeProtos.push(l.onnx.TypeProto.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.name&&t.hasOwnProperty("name")&&!u.isString(t.name))return"name: string expected";if(null!=t.refAttrName&&t.hasOwnProperty("refAttrName")&&!u.isString(t.refAttrName))return"refAttrName: string expected";if(null!=t.docString&&t.hasOwnProperty("docString")&&!u.isString(t.docString))return"docString: string expected";if(null!=t.type&&t.hasOwnProperty("type"))switch(t.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 11:case 13:case 6:case 7:case 8:case 9:case 10:case 12:case 14:}if(null!=t.f&&t.hasOwnProperty("f")&&"number"!=typeof t.f)return"f: number expected";if(null!=t.i&&t.hasOwnProperty("i")&&!u.isInteger(t.i)&&!(t.i&&u.isInteger(t.i.low)&&u.isInteger(t.i.high)))return"i: integer|Long expected";if(null!=t.s&&t.hasOwnProperty("s")&&!(t.s&&"number"==typeof t.s.length||u.isString(t.s)))return"s: buffer expected";if(null!=t.t&&t.hasOwnProperty("t")&&(r=l.onnx.TensorProto.verify(t.t)))return"t."+r;if(null!=t.g&&t.hasOwnProperty("g")&&(r=l.onnx.GraphProto.verify(t.g)))return"g."+r;if(null!=t.sparseTensor&&t.hasOwnProperty("sparseTensor")&&(r=l.onnx.SparseTensorProto.verify(t.sparseTensor)))return"sparseTensor."+r;if(null!=t.tp&&t.hasOwnProperty("tp")&&(r=l.onnx.TypeProto.verify(t.tp)))return"tp."+r;if(null!=t.floats&&t.hasOwnProperty("floats")){if(!Array.isArray(t.floats))return"floats: array expected";for(var e=0;e<t.floats.length;++e)if("number"!=typeof t.floats[e])return"floats: number[] expected"}if(null!=t.ints&&t.hasOwnProperty("ints")){if(!Array.isArray(t.ints))return"ints: array expected";for(e=0;e<t.ints.length;++e)if(!(u.isInteger(t.ints[e])||t.ints[e]&&u.isInteger(t.ints[e].low)&&u.isInteger(t.ints[e].high)))return"ints: integer|Long[] expected"}if(null!=t.strings&&t.hasOwnProperty("strings")){if(!Array.isArray(t.strings))return"strings: array expected";for(e=0;e<t.strings.length;++e)if(!(t.strings[e]&&"number"==typeof t.strings[e].length||u.isString(t.strings[e])))return"strings: buffer[] expected"}if(null!=t.tensors&&t.hasOwnProperty("tensors")){if(!Array.isArray(t.tensors))return"tensors: array expected";for(e=0;e<t.tensors.length;++e)if(r=l.onnx.TensorProto.verify(t.tensors[e]))return"tensors."+r}if(null!=t.graphs&&t.hasOwnProperty("graphs")){if(!Array.isArray(t.graphs))return"graphs: array expected";for(e=0;e<t.graphs.length;++e)if(r=l.onnx.GraphProto.verify(t.graphs[e]))return"graphs."+r}if(null!=t.sparseTensors&&t.hasOwnProperty("sparseTensors")){if(!Array.isArray(t.sparseTensors))return"sparseTensors: array expected";for(e=0;e<t.sparseTensors.length;++e)if(r=l.onnx.SparseTensorProto.verify(t.sparseTensors[e]))return"sparseTensors."+r}if(null!=t.typeProtos&&t.hasOwnProperty("typeProtos")){if(!Array.isArray(t.typeProtos))return"typeProtos: array expected";for(e=0;e<t.typeProtos.length;++e){var r;if(r=l.onnx.TypeProto.verify(t.typeProtos[e]))return"typeProtos."+r}}return null},t.fromObject=function(t){if(t instanceof l.onnx.AttributeProto)return t;var e=new l.onnx.AttributeProto;switch(null!=t.name&&(e.name=String(t.name)),null!=t.refAttrName&&(e.refAttrName=String(t.refAttrName)),null!=t.docString&&(e.docString=String(t.docString)),t.type){default:if("number"==typeof t.type){e.type=t.type;break}break;case"UNDEFINED":case 0:e.type=0;break;case"FLOAT":case 1:e.type=1;break;case"INT":case 2:e.type=2;break;case"STRING":case 3:e.type=3;break;case"TENSOR":case 4:e.type=4;break;case"GRAPH":case 5:e.type=5;break;case"SPARSE_TENSOR":case 11:e.type=11;break;case"TYPE_PROTO":case 13:e.type=13;break;case"FLOATS":case 6:e.type=6;break;case"INTS":case 7:e.type=7;break;case"STRINGS":case 8:e.type=8;break;case"TENSORS":case 9:e.type=9;break;case"GRAPHS":case 10:e.type=10;break;case"SPARSE_TENSORS":case 12:e.type=12;break;case"TYPE_PROTOS":case 14:e.type=14}if(null!=t.f&&(e.f=Number(t.f)),null!=t.i&&(u.Long?(e.i=u.Long.fromValue(t.i)).unsigned=!1:"string"==typeof t.i?e.i=parseInt(t.i,10):"number"==typeof t.i?e.i=t.i:"object"==typeof t.i&&(e.i=new u.LongBits(t.i.low>>>0,t.i.high>>>0).toNumber())),null!=t.s&&("string"==typeof t.s?u.base64.decode(t.s,e.s=u.newBuffer(u.base64.length(t.s)),0):t.s.length>=0&&(e.s=t.s)),null!=t.t){if("object"!=typeof t.t)throw TypeError(".onnx.AttributeProto.t: object expected");e.t=l.onnx.TensorProto.fromObject(t.t)}if(null!=t.g){if("object"!=typeof t.g)throw TypeError(".onnx.AttributeProto.g: object expected");e.g=l.onnx.GraphProto.fromObject(t.g)}if(null!=t.sparseTensor){if("object"!=typeof t.sparseTensor)throw TypeError(".onnx.AttributeProto.sparseTensor: object expected");e.sparseTensor=l.onnx.SparseTensorProto.fromObject(t.sparseTensor)}if(null!=t.tp){if("object"!=typeof t.tp)throw TypeError(".onnx.AttributeProto.tp: object expected");e.tp=l.onnx.TypeProto.fromObject(t.tp)}if(t.floats){if(!Array.isArray(t.floats))throw TypeError(".onnx.AttributeProto.floats: array expected");e.floats=[];for(var r=0;r<t.floats.length;++r)e.floats[r]=Number(t.floats[r])}if(t.ints){if(!Array.isArray(t.ints))throw TypeError(".onnx.AttributeProto.ints: array expected");for(e.ints=[],r=0;r<t.ints.length;++r)u.Long?(e.ints[r]=u.Long.fromValue(t.ints[r])).unsigned=!1:"string"==typeof t.ints[r]?e.ints[r]=parseInt(t.ints[r],10):"number"==typeof t.ints[r]?e.ints[r]=t.ints[r]:"object"==typeof t.ints[r]&&(e.ints[r]=new u.LongBits(t.ints[r].low>>>0,t.ints[r].high>>>0).toNumber())}if(t.strings){if(!Array.isArray(t.strings))throw TypeError(".onnx.AttributeProto.strings: array expected");for(e.strings=[],r=0;r<t.strings.length;++r)"string"==typeof t.strings[r]?u.base64.decode(t.strings[r],e.strings[r]=u.newBuffer(u.base64.length(t.strings[r])),0):t.strings[r].length>=0&&(e.strings[r]=t.strings[r])}if(t.tensors){if(!Array.isArray(t.tensors))throw TypeError(".onnx.AttributeProto.tensors: array expected");for(e.tensors=[],r=0;r<t.tensors.length;++r){if("object"!=typeof t.tensors[r])throw TypeError(".onnx.AttributeProto.tensors: object expected");e.tensors[r]=l.onnx.TensorProto.fromObject(t.tensors[r])}}if(t.graphs){if(!Array.isArray(t.graphs))throw TypeError(".onnx.AttributeProto.graphs: array expected");for(e.graphs=[],r=0;r<t.graphs.length;++r){if("object"!=typeof t.graphs[r])throw TypeError(".onnx.AttributeProto.graphs: object expected");e.graphs[r]=l.onnx.GraphProto.fromObject(t.graphs[r])}}if(t.sparseTensors){if(!Array.isArray(t.sparseTensors))throw TypeError(".onnx.AttributeProto.sparseTensors: array expected");for(e.sparseTensors=[],r=0;r<t.sparseTensors.length;++r){if("object"!=typeof t.sparseTensors[r])throw TypeError(".onnx.AttributeProto.sparseTensors: object expected");e.sparseTensors[r]=l.onnx.SparseTensorProto.fromObject(t.sparseTensors[r])}}if(t.typeProtos){if(!Array.isArray(t.typeProtos))throw TypeError(".onnx.AttributeProto.typeProtos: array expected");for(e.typeProtos=[],r=0;r<t.typeProtos.length;++r){if("object"!=typeof t.typeProtos[r])throw TypeError(".onnx.AttributeProto.typeProtos: object expected");e.typeProtos[r]=l.onnx.TypeProto.fromObject(t.typeProtos[r])}}return e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.floats=[],r.ints=[],r.strings=[],r.tensors=[],r.graphs=[],r.typeProtos=[],r.sparseTensors=[]),e.defaults){if(r.name="",r.f=0,u.Long){var n=new u.Long(0,0,!1);r.i=e.longs===String?n.toString():e.longs===Number?n.toNumber():n}else r.i=e.longs===String?"0":0;e.bytes===String?r.s="":(r.s=[],e.bytes!==Array&&(r.s=u.newBuffer(r.s))),r.t=null,r.g=null,r.docString="",r.tp=null,r.type=e.enums===String?"UNDEFINED":0,r.refAttrName="",r.sparseTensor=null}if(null!=t.name&&t.hasOwnProperty("name")&&(r.name=t.name),null!=t.f&&t.hasOwnProperty("f")&&(r.f=e.json&&!isFinite(t.f)?String(t.f):t.f),null!=t.i&&t.hasOwnProperty("i")&&("number"==typeof t.i?r.i=e.longs===String?String(t.i):t.i:r.i=e.longs===String?u.Long.prototype.toString.call(t.i):e.longs===Number?new u.LongBits(t.i.low>>>0,t.i.high>>>0).toNumber():t.i),null!=t.s&&t.hasOwnProperty("s")&&(r.s=e.bytes===String?u.base64.encode(t.s,0,t.s.length):e.bytes===Array?Array.prototype.slice.call(t.s):t.s),null!=t.t&&t.hasOwnProperty("t")&&(r.t=l.onnx.TensorProto.toObject(t.t,e)),null!=t.g&&t.hasOwnProperty("g")&&(r.g=l.onnx.GraphProto.toObject(t.g,e)),t.floats&&t.floats.length){r.floats=[];for(var i=0;i<t.floats.length;++i)r.floats[i]=e.json&&!isFinite(t.floats[i])?String(t.floats[i]):t.floats[i]}if(t.ints&&t.ints.length)for(r.ints=[],i=0;i<t.ints.length;++i)"number"==typeof t.ints[i]?r.ints[i]=e.longs===String?String(t.ints[i]):t.ints[i]:r.ints[i]=e.longs===String?u.Long.prototype.toString.call(t.ints[i]):e.longs===Number?new u.LongBits(t.ints[i].low>>>0,t.ints[i].high>>>0).toNumber():t.ints[i];if(t.strings&&t.strings.length)for(r.strings=[],i=0;i<t.strings.length;++i)r.strings[i]=e.bytes===String?u.base64.encode(t.strings[i],0,t.strings[i].length):e.bytes===Array?Array.prototype.slice.call(t.strings[i]):t.strings[i];if(t.tensors&&t.tensors.length)for(r.tensors=[],i=0;i<t.tensors.length;++i)r.tensors[i]=l.onnx.TensorProto.toObject(t.tensors[i],e);if(t.graphs&&t.graphs.length)for(r.graphs=[],i=0;i<t.graphs.length;++i)r.graphs[i]=l.onnx.GraphProto.toObject(t.graphs[i],e);if(null!=t.docString&&t.hasOwnProperty("docString")&&(r.docString=t.docString),null!=t.tp&&t.hasOwnProperty("tp")&&(r.tp=l.onnx.TypeProto.toObject(t.tp,e)),t.typeProtos&&t.typeProtos.length)for(r.typeProtos=[],i=0;i<t.typeProtos.length;++i)r.typeProtos[i]=l.onnx.TypeProto.toObject(t.typeProtos[i],e);if(null!=t.type&&t.hasOwnProperty("type")&&(r.type=e.enums===String?void 0===l.onnx.AttributeProto.AttributeType[t.type]?t.type:l.onnx.AttributeProto.AttributeType[t.type]:t.type),null!=t.refAttrName&&t.hasOwnProperty("refAttrName")&&(r.refAttrName=t.refAttrName),null!=t.sparseTensor&&t.hasOwnProperty("sparseTensor")&&(r.sparseTensor=l.onnx.SparseTensorProto.toObject(t.sparseTensor,e)),t.sparseTensors&&t.sparseTensors.length)for(r.sparseTensors=[],i=0;i<t.sparseTensors.length;++i)r.sparseTensors[i]=l.onnx.SparseTensorProto.toObject(t.sparseTensors[i],e);return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.AttributeProto"},t.AttributeType=function(){var t={},e=Object.create(t);return e[t[0]="UNDEFINED"]=0,e[t[1]="FLOAT"]=1,e[t[2]="INT"]=2,e[t[3]="STRING"]=3,e[t[4]="TENSOR"]=4,e[t[5]="GRAPH"]=5,e[t[11]="SPARSE_TENSOR"]=11,e[t[13]="TYPE_PROTO"]=13,e[t[6]="FLOATS"]=6,e[t[7]="INTS"]=7,e[t[8]="STRINGS"]=8,e[t[9]="TENSORS"]=9,e[t[10]="GRAPHS"]=10,e[t[12]="SPARSE_TENSORS"]=12,e[t[14]="TYPE_PROTOS"]=14,e}(),t}(),i.ValueInfoProto=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.name="",t.prototype.type=null,t.prototype.docString="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(10).string(t.name),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&l.onnx.TypeProto.encode(t.type,e.uint32(18).fork()).ldelim(),null!=t.docString&&Object.hasOwnProperty.call(t,"docString")&&e.uint32(26).string(t.docString),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.ValueInfoProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.name=t.string();break;case 2:n.type=l.onnx.TypeProto.decode(t,t.uint32());break;case 3:n.docString=t.string();break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.name&&t.hasOwnProperty("name")&&!u.isString(t.name))return"name: string expected";if(null!=t.type&&t.hasOwnProperty("type")){var e=l.onnx.TypeProto.verify(t.type);if(e)return"type."+e}return null!=t.docString&&t.hasOwnProperty("docString")&&!u.isString(t.docString)?"docString: string expected":null},t.fromObject=function(t){if(t instanceof l.onnx.ValueInfoProto)return t;var e=new l.onnx.ValueInfoProto;if(null!=t.name&&(e.name=String(t.name)),null!=t.type){if("object"!=typeof t.type)throw TypeError(".onnx.ValueInfoProto.type: object expected");e.type=l.onnx.TypeProto.fromObject(t.type)}return null!=t.docString&&(e.docString=String(t.docString)),e},t.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.name="",r.type=null,r.docString=""),null!=t.name&&t.hasOwnProperty("name")&&(r.name=t.name),null!=t.type&&t.hasOwnProperty("type")&&(r.type=l.onnx.TypeProto.toObject(t.type,e)),null!=t.docString&&t.hasOwnProperty("docString")&&(r.docString=t.docString),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.ValueInfoProto"},t}(),i.NodeProto=function(){function t(t){if(this.input=[],this.output=[],this.attribute=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.input=u.emptyArray,t.prototype.output=u.emptyArray,t.prototype.name="",t.prototype.opType="",t.prototype.domain="",t.prototype.attribute=u.emptyArray,t.prototype.docString="",t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.input&&t.input.length)for(var r=0;r<t.input.length;++r)e.uint32(10).string(t.input[r]);if(null!=t.output&&t.output.length)for(r=0;r<t.output.length;++r)e.uint32(18).string(t.output[r]);if(null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(26).string(t.name),null!=t.opType&&Object.hasOwnProperty.call(t,"opType")&&e.uint32(34).string(t.opType),null!=t.attribute&&t.attribute.length)for(r=0;r<t.attribute.length;++r)l.onnx.AttributeProto.encode(t.attribute[r],e.uint32(42).fork()).ldelim();return null!=t.docString&&Object.hasOwnProperty.call(t,"docString")&&e.uint32(50).string(t.docString),null!=t.domain&&Object.hasOwnProperty.call(t,"domain")&&e.uint32(58).string(t.domain),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.NodeProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.input&&n.input.length||(n.input=[]),n.input.push(t.string());break;case 2:n.output&&n.output.length||(n.output=[]),n.output.push(t.string());break;case 3:n.name=t.string();break;case 4:n.opType=t.string();break;case 7:n.domain=t.string();break;case 5:n.attribute&&n.attribute.length||(n.attribute=[]),n.attribute.push(l.onnx.AttributeProto.decode(t,t.uint32()));break;case 6:n.docString=t.string();break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.input&&t.hasOwnProperty("input")){if(!Array.isArray(t.input))return"input: array expected";for(var e=0;e<t.input.length;++e)if(!u.isString(t.input[e]))return"input: string[] expected"}if(null!=t.output&&t.hasOwnProperty("output")){if(!Array.isArray(t.output))return"output: array expected";for(e=0;e<t.output.length;++e)if(!u.isString(t.output[e]))return"output: string[] expected"}if(null!=t.name&&t.hasOwnProperty("name")&&!u.isString(t.name))return"name: string expected";if(null!=t.opType&&t.hasOwnProperty("opType")&&!u.isString(t.opType))return"opType: string expected";if(null!=t.domain&&t.hasOwnProperty("domain")&&!u.isString(t.domain))return"domain: string expected";if(null!=t.attribute&&t.hasOwnProperty("attribute")){if(!Array.isArray(t.attribute))return"attribute: array expected";for(e=0;e<t.attribute.length;++e){var r=l.onnx.AttributeProto.verify(t.attribute[e]);if(r)return"attribute."+r}}return null!=t.docString&&t.hasOwnProperty("docString")&&!u.isString(t.docString)?"docString: string expected":null},t.fromObject=function(t){if(t instanceof l.onnx.NodeProto)return t;var e=new l.onnx.NodeProto;if(t.input){if(!Array.isArray(t.input))throw TypeError(".onnx.NodeProto.input: array expected");e.input=[];for(var r=0;r<t.input.length;++r)e.input[r]=String(t.input[r])}if(t.output){if(!Array.isArray(t.output))throw TypeError(".onnx.NodeProto.output: array expected");for(e.output=[],r=0;r<t.output.length;++r)e.output[r]=String(t.output[r])}if(null!=t.name&&(e.name=String(t.name)),null!=t.opType&&(e.opType=String(t.opType)),null!=t.domain&&(e.domain=String(t.domain)),t.attribute){if(!Array.isArray(t.attribute))throw TypeError(".onnx.NodeProto.attribute: array expected");for(e.attribute=[],r=0;r<t.attribute.length;++r){if("object"!=typeof t.attribute[r])throw TypeError(".onnx.NodeProto.attribute: object expected");e.attribute[r]=l.onnx.AttributeProto.fromObject(t.attribute[r])}}return null!=t.docString&&(e.docString=String(t.docString)),e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.input=[],r.output=[],r.attribute=[]),e.defaults&&(r.name="",r.opType="",r.docString="",r.domain=""),t.input&&t.input.length){r.input=[];for(var n=0;n<t.input.length;++n)r.input[n]=t.input[n]}if(t.output&&t.output.length)for(r.output=[],n=0;n<t.output.length;++n)r.output[n]=t.output[n];if(null!=t.name&&t.hasOwnProperty("name")&&(r.name=t.name),null!=t.opType&&t.hasOwnProperty("opType")&&(r.opType=t.opType),t.attribute&&t.attribute.length)for(r.attribute=[],n=0;n<t.attribute.length;++n)r.attribute[n]=l.onnx.AttributeProto.toObject(t.attribute[n],e);return null!=t.docString&&t.hasOwnProperty("docString")&&(r.docString=t.docString),null!=t.domain&&t.hasOwnProperty("domain")&&(r.domain=t.domain),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.NodeProto"},t}(),i.TrainingInfoProto=function(){function t(t){if(this.initializationBinding=[],this.updateBinding=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.initialization=null,t.prototype.algorithm=null,t.prototype.initializationBinding=u.emptyArray,t.prototype.updateBinding=u.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.initialization&&Object.hasOwnProperty.call(t,"initialization")&&l.onnx.GraphProto.encode(t.initialization,e.uint32(10).fork()).ldelim(),null!=t.algorithm&&Object.hasOwnProperty.call(t,"algorithm")&&l.onnx.GraphProto.encode(t.algorithm,e.uint32(18).fork()).ldelim(),null!=t.initializationBinding&&t.initializationBinding.length)for(var r=0;r<t.initializationBinding.length;++r)l.onnx.StringStringEntryProto.encode(t.initializationBinding[r],e.uint32(26).fork()).ldelim();if(null!=t.updateBinding&&t.updateBinding.length)for(r=0;r<t.updateBinding.length;++r)l.onnx.StringStringEntryProto.encode(t.updateBinding[r],e.uint32(34).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TrainingInfoProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.initialization=l.onnx.GraphProto.decode(t,t.uint32());break;case 2:n.algorithm=l.onnx.GraphProto.decode(t,t.uint32());break;case 3:n.initializationBinding&&n.initializationBinding.length||(n.initializationBinding=[]),n.initializationBinding.push(l.onnx.StringStringEntryProto.decode(t,t.uint32()));break;case 4:n.updateBinding&&n.updateBinding.length||(n.updateBinding=[]),n.updateBinding.push(l.onnx.StringStringEntryProto.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.initialization&&t.hasOwnProperty("initialization")&&(r=l.onnx.GraphProto.verify(t.initialization)))return"initialization."+r;if(null!=t.algorithm&&t.hasOwnProperty("algorithm")&&(r=l.onnx.GraphProto.verify(t.algorithm)))return"algorithm."+r;if(null!=t.initializationBinding&&t.hasOwnProperty("initializationBinding")){if(!Array.isArray(t.initializationBinding))return"initializationBinding: array expected";for(var e=0;e<t.initializationBinding.length;++e)if(r=l.onnx.StringStringEntryProto.verify(t.initializationBinding[e]))return"initializationBinding."+r}if(null!=t.updateBinding&&t.hasOwnProperty("updateBinding")){if(!Array.isArray(t.updateBinding))return"updateBinding: array expected";for(e=0;e<t.updateBinding.length;++e){var r;if(r=l.onnx.StringStringEntryProto.verify(t.updateBinding[e]))return"updateBinding."+r}}return null},t.fromObject=function(t){if(t instanceof l.onnx.TrainingInfoProto)return t;var e=new l.onnx.TrainingInfoProto;if(null!=t.initialization){if("object"!=typeof t.initialization)throw TypeError(".onnx.TrainingInfoProto.initialization: object expected");e.initialization=l.onnx.GraphProto.fromObject(t.initialization)}if(null!=t.algorithm){if("object"!=typeof t.algorithm)throw TypeError(".onnx.TrainingInfoProto.algorithm: object expected");e.algorithm=l.onnx.GraphProto.fromObject(t.algorithm)}if(t.initializationBinding){if(!Array.isArray(t.initializationBinding))throw TypeError(".onnx.TrainingInfoProto.initializationBinding: array expected");e.initializationBinding=[];for(var r=0;r<t.initializationBinding.length;++r){if("object"!=typeof t.initializationBinding[r])throw TypeError(".onnx.TrainingInfoProto.initializationBinding: object expected");e.initializationBinding[r]=l.onnx.StringStringEntryProto.fromObject(t.initializationBinding[r])}}if(t.updateBinding){if(!Array.isArray(t.updateBinding))throw TypeError(".onnx.TrainingInfoProto.updateBinding: array expected");for(e.updateBinding=[],r=0;r<t.updateBinding.length;++r){if("object"!=typeof t.updateBinding[r])throw TypeError(".onnx.TrainingInfoProto.updateBinding: object expected");e.updateBinding[r]=l.onnx.StringStringEntryProto.fromObject(t.updateBinding[r])}}return e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.initializationBinding=[],r.updateBinding=[]),e.defaults&&(r.initialization=null,r.algorithm=null),null!=t.initialization&&t.hasOwnProperty("initialization")&&(r.initialization=l.onnx.GraphProto.toObject(t.initialization,e)),null!=t.algorithm&&t.hasOwnProperty("algorithm")&&(r.algorithm=l.onnx.GraphProto.toObject(t.algorithm,e)),t.initializationBinding&&t.initializationBinding.length){r.initializationBinding=[];for(var n=0;n<t.initializationBinding.length;++n)r.initializationBinding[n]=l.onnx.StringStringEntryProto.toObject(t.initializationBinding[n],e)}if(t.updateBinding&&t.updateBinding.length)for(r.updateBinding=[],n=0;n<t.updateBinding.length;++n)r.updateBinding[n]=l.onnx.StringStringEntryProto.toObject(t.updateBinding[n],e);return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TrainingInfoProto"},t}(),i.ModelProto=function(){function t(t){if(this.opsetImport=[],this.metadataProps=[],this.trainingInfo=[],this.functions=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.irVersion=u.Long?u.Long.fromBits(0,0,!1):0,t.prototype.opsetImport=u.emptyArray,t.prototype.producerName="",t.prototype.producerVersion="",t.prototype.domain="",t.prototype.modelVersion=u.Long?u.Long.fromBits(0,0,!1):0,t.prototype.docString="",t.prototype.graph=null,t.prototype.metadataProps=u.emptyArray,t.prototype.trainingInfo=u.emptyArray,t.prototype.functions=u.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.irVersion&&Object.hasOwnProperty.call(t,"irVersion")&&e.uint32(8).int64(t.irVersion),null!=t.producerName&&Object.hasOwnProperty.call(t,"producerName")&&e.uint32(18).string(t.producerName),null!=t.producerVersion&&Object.hasOwnProperty.call(t,"producerVersion")&&e.uint32(26).string(t.producerVersion),null!=t.domain&&Object.hasOwnProperty.call(t,"domain")&&e.uint32(34).string(t.domain),null!=t.modelVersion&&Object.hasOwnProperty.call(t,"modelVersion")&&e.uint32(40).int64(t.modelVersion),null!=t.docString&&Object.hasOwnProperty.call(t,"docString")&&e.uint32(50).string(t.docString),null!=t.graph&&Object.hasOwnProperty.call(t,"graph")&&l.onnx.GraphProto.encode(t.graph,e.uint32(58).fork()).ldelim(),null!=t.opsetImport&&t.opsetImport.length)for(var r=0;r<t.opsetImport.length;++r)l.onnx.OperatorSetIdProto.encode(t.opsetImport[r],e.uint32(66).fork()).ldelim();if(null!=t.metadataProps&&t.metadataProps.length)for(r=0;r<t.metadataProps.length;++r)l.onnx.StringStringEntryProto.encode(t.metadataProps[r],e.uint32(114).fork()).ldelim();if(null!=t.trainingInfo&&t.trainingInfo.length)for(r=0;r<t.trainingInfo.length;++r)l.onnx.TrainingInfoProto.encode(t.trainingInfo[r],e.uint32(162).fork()).ldelim();if(null!=t.functions&&t.functions.length)for(r=0;r<t.functions.length;++r)l.onnx.FunctionProto.encode(t.functions[r],e.uint32(202).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.ModelProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.irVersion=t.int64();break;case 8:n.opsetImport&&n.opsetImport.length||(n.opsetImport=[]),n.opsetImport.push(l.onnx.OperatorSetIdProto.decode(t,t.uint32()));break;case 2:n.producerName=t.string();break;case 3:n.producerVersion=t.string();break;case 4:n.domain=t.string();break;case 5:n.modelVersion=t.int64();break;case 6:n.docString=t.string();break;case 7:n.graph=l.onnx.GraphProto.decode(t,t.uint32());break;case 14:n.metadataProps&&n.metadataProps.length||(n.metadataProps=[]),n.metadataProps.push(l.onnx.StringStringEntryProto.decode(t,t.uint32()));break;case 20:n.trainingInfo&&n.trainingInfo.length||(n.trainingInfo=[]),n.trainingInfo.push(l.onnx.TrainingInfoProto.decode(t,t.uint32()));break;case 25:n.functions&&n.functions.length||(n.functions=[]),n.functions.push(l.onnx.FunctionProto.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.irVersion&&t.hasOwnProperty("irVersion")&&!u.isInteger(t.irVersion)&&!(t.irVersion&&u.isInteger(t.irVersion.low)&&u.isInteger(t.irVersion.high)))return"irVersion: integer|Long expected";if(null!=t.opsetImport&&t.hasOwnProperty("opsetImport")){if(!Array.isArray(t.opsetImport))return"opsetImport: array expected";for(var e=0;e<t.opsetImport.length;++e)if(r=l.onnx.OperatorSetIdProto.verify(t.opsetImport[e]))return"opsetImport."+r}if(null!=t.producerName&&t.hasOwnProperty("producerName")&&!u.isString(t.producerName))return"producerName: string expected";if(null!=t.producerVersion&&t.hasOwnProperty("producerVersion")&&!u.isString(t.producerVersion))return"producerVersion: string expected";if(null!=t.domain&&t.hasOwnProperty("domain")&&!u.isString(t.domain))return"domain: string expected";if(null!=t.modelVersion&&t.hasOwnProperty("modelVersion")&&!u.isInteger(t.modelVersion)&&!(t.modelVersion&&u.isInteger(t.modelVersion.low)&&u.isInteger(t.modelVersion.high)))return"modelVersion: integer|Long expected";if(null!=t.docString&&t.hasOwnProperty("docString")&&!u.isString(t.docString))return"docString: string expected";if(null!=t.graph&&t.hasOwnProperty("graph")&&(r=l.onnx.GraphProto.verify(t.graph)))return"graph."+r;if(null!=t.metadataProps&&t.hasOwnProperty("metadataProps")){if(!Array.isArray(t.metadataProps))return"metadataProps: array expected";for(e=0;e<t.metadataProps.length;++e)if(r=l.onnx.StringStringEntryProto.verify(t.metadataProps[e]))return"metadataProps."+r}if(null!=t.trainingInfo&&t.hasOwnProperty("trainingInfo")){if(!Array.isArray(t.trainingInfo))return"trainingInfo: array expected";for(e=0;e<t.trainingInfo.length;++e)if(r=l.onnx.TrainingInfoProto.verify(t.trainingInfo[e]))return"trainingInfo."+r}if(null!=t.functions&&t.hasOwnProperty("functions")){if(!Array.isArray(t.functions))return"functions: array expected";for(e=0;e<t.functions.length;++e){var r;if(r=l.onnx.FunctionProto.verify(t.functions[e]))return"functions."+r}}return null},t.fromObject=function(t){if(t instanceof l.onnx.ModelProto)return t;var e=new l.onnx.ModelProto;if(null!=t.irVersion&&(u.Long?(e.irVersion=u.Long.fromValue(t.irVersion)).unsigned=!1:"string"==typeof t.irVersion?e.irVersion=parseInt(t.irVersion,10):"number"==typeof t.irVersion?e.irVersion=t.irVersion:"object"==typeof t.irVersion&&(e.irVersion=new u.LongBits(t.irVersion.low>>>0,t.irVersion.high>>>0).toNumber())),t.opsetImport){if(!Array.isArray(t.opsetImport))throw TypeError(".onnx.ModelProto.opsetImport: array expected");e.opsetImport=[];for(var r=0;r<t.opsetImport.length;++r){if("object"!=typeof t.opsetImport[r])throw TypeError(".onnx.ModelProto.opsetImport: object expected");e.opsetImport[r]=l.onnx.OperatorSetIdProto.fromObject(t.opsetImport[r])}}if(null!=t.producerName&&(e.producerName=String(t.producerName)),null!=t.producerVersion&&(e.producerVersion=String(t.producerVersion)),null!=t.domain&&(e.domain=String(t.domain)),null!=t.modelVersion&&(u.Long?(e.modelVersion=u.Long.fromValue(t.modelVersion)).unsigned=!1:"string"==typeof t.modelVersion?e.modelVersion=parseInt(t.modelVersion,10):"number"==typeof t.modelVersion?e.modelVersion=t.modelVersion:"object"==typeof t.modelVersion&&(e.modelVersion=new u.LongBits(t.modelVersion.low>>>0,t.modelVersion.high>>>0).toNumber())),null!=t.docString&&(e.docString=String(t.docString)),null!=t.graph){if("object"!=typeof t.graph)throw TypeError(".onnx.ModelProto.graph: object expected");e.graph=l.onnx.GraphProto.fromObject(t.graph)}if(t.metadataProps){if(!Array.isArray(t.metadataProps))throw TypeError(".onnx.ModelProto.metadataProps: array expected");for(e.metadataProps=[],r=0;r<t.metadataProps.length;++r){if("object"!=typeof t.metadataProps[r])throw TypeError(".onnx.ModelProto.metadataProps: object expected");e.metadataProps[r]=l.onnx.StringStringEntryProto.fromObject(t.metadataProps[r])}}if(t.trainingInfo){if(!Array.isArray(t.trainingInfo))throw TypeError(".onnx.ModelProto.trainingInfo: array expected");for(e.trainingInfo=[],r=0;r<t.trainingInfo.length;++r){if("object"!=typeof t.trainingInfo[r])throw TypeError(".onnx.ModelProto.trainingInfo: object expected");e.trainingInfo[r]=l.onnx.TrainingInfoProto.fromObject(t.trainingInfo[r])}}if(t.functions){if(!Array.isArray(t.functions))throw TypeError(".onnx.ModelProto.functions: array expected");for(e.functions=[],r=0;r<t.functions.length;++r){if("object"!=typeof t.functions[r])throw TypeError(".onnx.ModelProto.functions: object expected");e.functions[r]=l.onnx.FunctionProto.fromObject(t.functions[r])}}return e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.opsetImport=[],r.metadataProps=[],r.trainingInfo=[],r.functions=[]),e.defaults){if(u.Long){var n=new u.Long(0,0,!1);r.irVersion=e.longs===String?n.toString():e.longs===Number?n.toNumber():n}else r.irVersion=e.longs===String?"0":0;r.producerName="",r.producerVersion="",r.domain="",u.Long?(n=new u.Long(0,0,!1),r.modelVersion=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):r.modelVersion=e.longs===String?"0":0,r.docString="",r.graph=null}if(null!=t.irVersion&&t.hasOwnProperty("irVersion")&&("number"==typeof t.irVersion?r.irVersion=e.longs===String?String(t.irVersion):t.irVersion:r.irVersion=e.longs===String?u.Long.prototype.toString.call(t.irVersion):e.longs===Number?new u.LongBits(t.irVersion.low>>>0,t.irVersion.high>>>0).toNumber():t.irVersion),null!=t.producerName&&t.hasOwnProperty("producerName")&&(r.producerName=t.producerName),null!=t.producerVersion&&t.hasOwnProperty("producerVersion")&&(r.producerVersion=t.producerVersion),null!=t.domain&&t.hasOwnProperty("domain")&&(r.domain=t.domain),null!=t.modelVersion&&t.hasOwnProperty("modelVersion")&&("number"==typeof t.modelVersion?r.modelVersion=e.longs===String?String(t.modelVersion):t.modelVersion:r.modelVersion=e.longs===String?u.Long.prototype.toString.call(t.modelVersion):e.longs===Number?new u.LongBits(t.modelVersion.low>>>0,t.modelVersion.high>>>0).toNumber():t.modelVersion),null!=t.docString&&t.hasOwnProperty("docString")&&(r.docString=t.docString),null!=t.graph&&t.hasOwnProperty("graph")&&(r.graph=l.onnx.GraphProto.toObject(t.graph,e)),t.opsetImport&&t.opsetImport.length){r.opsetImport=[];for(var i=0;i<t.opsetImport.length;++i)r.opsetImport[i]=l.onnx.OperatorSetIdProto.toObject(t.opsetImport[i],e)}if(t.metadataProps&&t.metadataProps.length)for(r.metadataProps=[],i=0;i<t.metadataProps.length;++i)r.metadataProps[i]=l.onnx.StringStringEntryProto.toObject(t.metadataProps[i],e);if(t.trainingInfo&&t.trainingInfo.length)for(r.trainingInfo=[],i=0;i<t.trainingInfo.length;++i)r.trainingInfo[i]=l.onnx.TrainingInfoProto.toObject(t.trainingInfo[i],e);if(t.functions&&t.functions.length)for(r.functions=[],i=0;i<t.functions.length;++i)r.functions[i]=l.onnx.FunctionProto.toObject(t.functions[i],e);return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.ModelProto"},t}(),i.StringStringEntryProto=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.key="",t.prototype.value="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.StringStringEntryProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.key=t.string();break;case 2:n.value=t.string();break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.key&&t.hasOwnProperty("key")&&!u.isString(t.key)?"key: string expected":null!=t.value&&t.hasOwnProperty("value")&&!u.isString(t.value)?"value: string expected":null},t.fromObject=function(t){if(t instanceof l.onnx.StringStringEntryProto)return t;var e=new l.onnx.StringStringEntryProto;return null!=t.key&&(e.key=String(t.key)),null!=t.value&&(e.value=String(t.value)),e},t.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.key="",r.value=""),null!=t.key&&t.hasOwnProperty("key")&&(r.key=t.key),null!=t.value&&t.hasOwnProperty("value")&&(r.value=t.value),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.StringStringEntryProto"},t}(),i.TensorAnnotation=function(){function t(t){if(this.quantParameterTensorNames=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.tensorName="",t.prototype.quantParameterTensorNames=u.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.tensorName&&Object.hasOwnProperty.call(t,"tensorName")&&e.uint32(10).string(t.tensorName),null!=t.quantParameterTensorNames&&t.quantParameterTensorNames.length)for(var r=0;r<t.quantParameterTensorNames.length;++r)l.onnx.StringStringEntryProto.encode(t.quantParameterTensorNames[r],e.uint32(18).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TensorAnnotation;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.tensorName=t.string();break;case 2:n.quantParameterTensorNames&&n.quantParameterTensorNames.length||(n.quantParameterTensorNames=[]),n.quantParameterTensorNames.push(l.onnx.StringStringEntryProto.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.tensorName&&t.hasOwnProperty("tensorName")&&!u.isString(t.tensorName))return"tensorName: string expected";if(null!=t.quantParameterTensorNames&&t.hasOwnProperty("quantParameterTensorNames")){if(!Array.isArray(t.quantParameterTensorNames))return"quantParameterTensorNames: array expected";for(var e=0;e<t.quantParameterTensorNames.length;++e){var r=l.onnx.StringStringEntryProto.verify(t.quantParameterTensorNames[e]);if(r)return"quantParameterTensorNames."+r}}return null},t.fromObject=function(t){if(t instanceof l.onnx.TensorAnnotation)return t;var e=new l.onnx.TensorAnnotation;if(null!=t.tensorName&&(e.tensorName=String(t.tensorName)),t.quantParameterTensorNames){if(!Array.isArray(t.quantParameterTensorNames))throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: array expected");e.quantParameterTensorNames=[];for(var r=0;r<t.quantParameterTensorNames.length;++r){if("object"!=typeof t.quantParameterTensorNames[r])throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: object expected");e.quantParameterTensorNames[r]=l.onnx.StringStringEntryProto.fromObject(t.quantParameterTensorNames[r])}}return e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.quantParameterTensorNames=[]),e.defaults&&(r.tensorName=""),null!=t.tensorName&&t.hasOwnProperty("tensorName")&&(r.tensorName=t.tensorName),t.quantParameterTensorNames&&t.quantParameterTensorNames.length){r.quantParameterTensorNames=[];for(var n=0;n<t.quantParameterTensorNames.length;++n)r.quantParameterTensorNames[n]=l.onnx.StringStringEntryProto.toObject(t.quantParameterTensorNames[n],e)}return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TensorAnnotation"},t}(),i.GraphProto=function(){function t(t){if(this.node=[],this.initializer=[],this.sparseInitializer=[],this.input=[],this.output=[],this.valueInfo=[],this.quantizationAnnotation=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.node=u.emptyArray,t.prototype.name="",t.prototype.initializer=u.emptyArray,t.prototype.sparseInitializer=u.emptyArray,t.prototype.docString="",t.prototype.input=u.emptyArray,t.prototype.output=u.emptyArray,t.prototype.valueInfo=u.emptyArray,t.prototype.quantizationAnnotation=u.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.node&&t.node.length)for(var r=0;r<t.node.length;++r)l.onnx.NodeProto.encode(t.node[r],e.uint32(10).fork()).ldelim();if(null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(18).string(t.name),null!=t.initializer&&t.initializer.length)for(r=0;r<t.initializer.length;++r)l.onnx.TensorProto.encode(t.initializer[r],e.uint32(42).fork()).ldelim();if(null!=t.docString&&Object.hasOwnProperty.call(t,"docString")&&e.uint32(82).string(t.docString),null!=t.input&&t.input.length)for(r=0;r<t.input.length;++r)l.onnx.ValueInfoProto.encode(t.input[r],e.uint32(90).fork()).ldelim();if(null!=t.output&&t.output.length)for(r=0;r<t.output.length;++r)l.onnx.ValueInfoProto.encode(t.output[r],e.uint32(98).fork()).ldelim();if(null!=t.valueInfo&&t.valueInfo.length)for(r=0;r<t.valueInfo.length;++r)l.onnx.ValueInfoProto.encode(t.valueInfo[r],e.uint32(106).fork()).ldelim();if(null!=t.quantizationAnnotation&&t.quantizationAnnotation.length)for(r=0;r<t.quantizationAnnotation.length;++r)l.onnx.TensorAnnotation.encode(t.quantizationAnnotation[r],e.uint32(114).fork()).ldelim();if(null!=t.sparseInitializer&&t.sparseInitializer.length)for(r=0;r<t.sparseInitializer.length;++r)l.onnx.SparseTensorProto.encode(t.sparseInitializer[r],e.uint32(122).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.GraphProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.node&&n.node.length||(n.node=[]),n.node.push(l.onnx.NodeProto.decode(t,t.uint32()));break;case 2:n.name=t.string();break;case 5:n.initializer&&n.initializer.length||(n.initializer=[]),n.initializer.push(l.onnx.TensorProto.decode(t,t.uint32()));break;case 15:n.sparseInitializer&&n.sparseInitializer.length||(n.sparseInitializer=[]),n.sparseInitializer.push(l.onnx.SparseTensorProto.decode(t,t.uint32()));break;case 10:n.docString=t.string();break;case 11:n.input&&n.input.length||(n.input=[]),n.input.push(l.onnx.ValueInfoProto.decode(t,t.uint32()));break;case 12:n.output&&n.output.length||(n.output=[]),n.output.push(l.onnx.ValueInfoProto.decode(t,t.uint32()));break;case 13:n.valueInfo&&n.valueInfo.length||(n.valueInfo=[]),n.valueInfo.push(l.onnx.ValueInfoProto.decode(t,t.uint32()));break;case 14:n.quantizationAnnotation&&n.quantizationAnnotation.length||(n.quantizationAnnotation=[]),n.quantizationAnnotation.push(l.onnx.TensorAnnotation.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.node&&t.hasOwnProperty("node")){if(!Array.isArray(t.node))return"node: array expected";for(var e=0;e<t.node.length;++e)if(r=l.onnx.NodeProto.verify(t.node[e]))return"node."+r}if(null!=t.name&&t.hasOwnProperty("name")&&!u.isString(t.name))return"name: string expected";if(null!=t.initializer&&t.hasOwnProperty("initializer")){if(!Array.isArray(t.initializer))return"initializer: array expected";for(e=0;e<t.initializer.length;++e)if(r=l.onnx.TensorProto.verify(t.initializer[e]))return"initializer."+r}if(null!=t.sparseInitializer&&t.hasOwnProperty("sparseInitializer")){if(!Array.isArray(t.sparseInitializer))return"sparseInitializer: array expected";for(e=0;e<t.sparseInitializer.length;++e)if(r=l.onnx.SparseTensorProto.verify(t.sparseInitializer[e]))return"sparseInitializer."+r}if(null!=t.docString&&t.hasOwnProperty("docString")&&!u.isString(t.docString))return"docString: string expected";if(null!=t.input&&t.hasOwnProperty("input")){if(!Array.isArray(t.input))return"input: array expected";for(e=0;e<t.input.length;++e)if(r=l.onnx.ValueInfoProto.verify(t.input[e]))return"input."+r}if(null!=t.output&&t.hasOwnProperty("output")){if(!Array.isArray(t.output))return"output: array expected";for(e=0;e<t.output.length;++e)if(r=l.onnx.ValueInfoProto.verify(t.output[e]))return"output."+r}if(null!=t.valueInfo&&t.hasOwnProperty("valueInfo")){if(!Array.isArray(t.valueInfo))return"valueInfo: array expected";for(e=0;e<t.valueInfo.length;++e)if(r=l.onnx.ValueInfoProto.verify(t.valueInfo[e]))return"valueInfo."+r}if(null!=t.quantizationAnnotation&&t.hasOwnProperty("quantizationAnnotation")){if(!Array.isArray(t.quantizationAnnotation))return"quantizationAnnotation: array expected";for(e=0;e<t.quantizationAnnotation.length;++e){var r;if(r=l.onnx.TensorAnnotation.verify(t.quantizationAnnotation[e]))return"quantizationAnnotation."+r}}return null},t.fromObject=function(t){if(t instanceof l.onnx.GraphProto)return t;var e=new l.onnx.GraphProto;if(t.node){if(!Array.isArray(t.node))throw TypeError(".onnx.GraphProto.node: array expected");e.node=[];for(var r=0;r<t.node.length;++r){if("object"!=typeof t.node[r])throw TypeError(".onnx.GraphProto.node: object expected");e.node[r]=l.onnx.NodeProto.fromObject(t.node[r])}}if(null!=t.name&&(e.name=String(t.name)),t.initializer){if(!Array.isArray(t.initializer))throw TypeError(".onnx.GraphProto.initializer: array expected");for(e.initializer=[],r=0;r<t.initializer.length;++r){if("object"!=typeof t.initializer[r])throw TypeError(".onnx.GraphProto.initializer: object expected");e.initializer[r]=l.onnx.TensorProto.fromObject(t.initializer[r])}}if(t.sparseInitializer){if(!Array.isArray(t.sparseInitializer))throw TypeError(".onnx.GraphProto.sparseInitializer: array expected");for(e.sparseInitializer=[],r=0;r<t.sparseInitializer.length;++r){if("object"!=typeof t.sparseInitializer[r])throw TypeError(".onnx.GraphProto.sparseInitializer: object expected");e.sparseInitializer[r]=l.onnx.SparseTensorProto.fromObject(t.sparseInitializer[r])}}if(null!=t.docString&&(e.docString=String(t.docString)),t.input){if(!Array.isArray(t.input))throw TypeError(".onnx.GraphProto.input: array expected");for(e.input=[],r=0;r<t.input.length;++r){if("object"!=typeof t.input[r])throw TypeError(".onnx.GraphProto.input: object expected");e.input[r]=l.onnx.ValueInfoProto.fromObject(t.input[r])}}if(t.output){if(!Array.isArray(t.output))throw TypeError(".onnx.GraphProto.output: array expected");for(e.output=[],r=0;r<t.output.length;++r){if("object"!=typeof t.output[r])throw TypeError(".onnx.GraphProto.output: object expected");e.output[r]=l.onnx.ValueInfoProto.fromObject(t.output[r])}}if(t.valueInfo){if(!Array.isArray(t.valueInfo))throw TypeError(".onnx.GraphProto.valueInfo: array expected");for(e.valueInfo=[],r=0;r<t.valueInfo.length;++r){if("object"!=typeof t.valueInfo[r])throw TypeError(".onnx.GraphProto.valueInfo: object expected");e.valueInfo[r]=l.onnx.ValueInfoProto.fromObject(t.valueInfo[r])}}if(t.quantizationAnnotation){if(!Array.isArray(t.quantizationAnnotation))throw TypeError(".onnx.GraphProto.quantizationAnnotation: array expected");for(e.quantizationAnnotation=[],r=0;r<t.quantizationAnnotation.length;++r){if("object"!=typeof t.quantizationAnnotation[r])throw TypeError(".onnx.GraphProto.quantizationAnnotation: object expected");e.quantizationAnnotation[r]=l.onnx.TensorAnnotation.fromObject(t.quantizationAnnotation[r])}}return e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.node=[],r.initializer=[],r.input=[],r.output=[],r.valueInfo=[],r.quantizationAnnotation=[],r.sparseInitializer=[]),e.defaults&&(r.name="",r.docString=""),t.node&&t.node.length){r.node=[];for(var n=0;n<t.node.length;++n)r.node[n]=l.onnx.NodeProto.toObject(t.node[n],e)}if(null!=t.name&&t.hasOwnProperty("name")&&(r.name=t.name),t.initializer&&t.initializer.length)for(r.initializer=[],n=0;n<t.initializer.length;++n)r.initializer[n]=l.onnx.TensorProto.toObject(t.initializer[n],e);if(null!=t.docString&&t.hasOwnProperty("docString")&&(r.docString=t.docString),t.input&&t.input.length)for(r.input=[],n=0;n<t.input.length;++n)r.input[n]=l.onnx.ValueInfoProto.toObject(t.input[n],e);if(t.output&&t.output.length)for(r.output=[],n=0;n<t.output.length;++n)r.output[n]=l.onnx.ValueInfoProto.toObject(t.output[n],e);if(t.valueInfo&&t.valueInfo.length)for(r.valueInfo=[],n=0;n<t.valueInfo.length;++n)r.valueInfo[n]=l.onnx.ValueInfoProto.toObject(t.valueInfo[n],e);if(t.quantizationAnnotation&&t.quantizationAnnotation.length)for(r.quantizationAnnotation=[],n=0;n<t.quantizationAnnotation.length;++n)r.quantizationAnnotation[n]=l.onnx.TensorAnnotation.toObject(t.quantizationAnnotation[n],e);if(t.sparseInitializer&&t.sparseInitializer.length)for(r.sparseInitializer=[],n=0;n<t.sparseInitializer.length;++n)r.sparseInitializer[n]=l.onnx.SparseTensorProto.toObject(t.sparseInitializer[n],e);return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.GraphProto"},t}(),i.TensorProto=function(){function t(t){if(this.dims=[],this.floatData=[],this.int32Data=[],this.stringData=[],this.int64Data=[],this.externalData=[],this.doubleData=[],this.uint64Data=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.dims=u.emptyArray,t.prototype.dataType=0,t.prototype.segment=null,t.prototype.floatData=u.emptyArray,t.prototype.int32Data=u.emptyArray,t.prototype.stringData=u.emptyArray,t.prototype.int64Data=u.emptyArray,t.prototype.name="",t.prototype.docString="",t.prototype.rawData=u.newBuffer([]),t.prototype.externalData=u.emptyArray,t.prototype.dataLocation=0,t.prototype.doubleData=u.emptyArray,t.prototype.uint64Data=u.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.dims&&t.dims.length){e.uint32(10).fork();for(var r=0;r<t.dims.length;++r)e.int64(t.dims[r]);e.ldelim()}if(null!=t.dataType&&Object.hasOwnProperty.call(t,"dataType")&&e.uint32(16).int32(t.dataType),null!=t.segment&&Object.hasOwnProperty.call(t,"segment")&&l.onnx.TensorProto.Segment.encode(t.segment,e.uint32(26).fork()).ldelim(),null!=t.floatData&&t.floatData.length){for(e.uint32(34).fork(),r=0;r<t.floatData.length;++r)e.float(t.floatData[r]);e.ldelim()}if(null!=t.int32Data&&t.int32Data.length){for(e.uint32(42).fork(),r=0;r<t.int32Data.length;++r)e.int32(t.int32Data[r]);e.ldelim()}if(null!=t.stringData&&t.stringData.length)for(r=0;r<t.stringData.length;++r)e.uint32(50).bytes(t.stringData[r]);if(null!=t.int64Data&&t.int64Data.length){for(e.uint32(58).fork(),r=0;r<t.int64Data.length;++r)e.int64(t.int64Data[r]);e.ldelim()}if(null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(66).string(t.name),null!=t.rawData&&Object.hasOwnProperty.call(t,"rawData")&&e.uint32(74).bytes(t.rawData),null!=t.doubleData&&t.doubleData.length){for(e.uint32(82).fork(),r=0;r<t.doubleData.length;++r)e.double(t.doubleData[r]);e.ldelim()}if(null!=t.uint64Data&&t.uint64Data.length){for(e.uint32(90).fork(),r=0;r<t.uint64Data.length;++r)e.uint64(t.uint64Data[r]);e.ldelim()}if(null!=t.docString&&Object.hasOwnProperty.call(t,"docString")&&e.uint32(98).string(t.docString),null!=t.externalData&&t.externalData.length)for(r=0;r<t.externalData.length;++r)l.onnx.StringStringEntryProto.encode(t.externalData[r],e.uint32(106).fork()).ldelim();return null!=t.dataLocation&&Object.hasOwnProperty.call(t,"dataLocation")&&e.uint32(112).int32(t.dataLocation),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TensorProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:if(n.dims&&n.dims.length||(n.dims=[]),2==(7&i))for(var s=t.uint32()+t.pos;t.pos<s;)n.dims.push(t.int64());else n.dims.push(t.int64());break;case 2:n.dataType=t.int32();break;case 3:n.segment=l.onnx.TensorProto.Segment.decode(t,t.uint32());break;case 4:if(n.floatData&&n.floatData.length||(n.floatData=[]),2==(7&i))for(s=t.uint32()+t.pos;t.pos<s;)n.floatData.push(t.float());else n.floatData.push(t.float());break;case 5:if(n.int32Data&&n.int32Data.length||(n.int32Data=[]),2==(7&i))for(s=t.uint32()+t.pos;t.pos<s;)n.int32Data.push(t.int32());else n.int32Data.push(t.int32());break;case 6:n.stringData&&n.stringData.length||(n.stringData=[]),n.stringData.push(t.bytes());break;case 7:if(n.int64Data&&n.int64Data.length||(n.int64Data=[]),2==(7&i))for(s=t.uint32()+t.pos;t.pos<s;)n.int64Data.push(t.int64());else n.int64Data.push(t.int64());break;case 8:n.name=t.string();break;case 12:n.docString=t.string();break;case 9:n.rawData=t.bytes();break;case 13:n.externalData&&n.externalData.length||(n.externalData=[]),n.externalData.push(l.onnx.StringStringEntryProto.decode(t,t.uint32()));break;case 14:n.dataLocation=t.int32();break;case 10:if(n.doubleData&&n.doubleData.length||(n.doubleData=[]),2==(7&i))for(s=t.uint32()+t.pos;t.pos<s;)n.doubleData.push(t.double());else n.doubleData.push(t.double());break;case 11:if(n.uint64Data&&n.uint64Data.length||(n.uint64Data=[]),2==(7&i))for(s=t.uint32()+t.pos;t.pos<s;)n.uint64Data.push(t.uint64());else n.uint64Data.push(t.uint64());break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.dims&&t.hasOwnProperty("dims")){if(!Array.isArray(t.dims))return"dims: array expected";for(var e=0;e<t.dims.length;++e)if(!(u.isInteger(t.dims[e])||t.dims[e]&&u.isInteger(t.dims[e].low)&&u.isInteger(t.dims[e].high)))return"dims: integer|Long[] expected"}if(null!=t.dataType&&t.hasOwnProperty("dataType")&&!u.isInteger(t.dataType))return"dataType: integer expected";if(null!=t.segment&&t.hasOwnProperty("segment")&&(r=l.onnx.TensorProto.Segment.verify(t.segment)))return"segment."+r;if(null!=t.floatData&&t.hasOwnProperty("floatData")){if(!Array.isArray(t.floatData))return"floatData: array expected";for(e=0;e<t.floatData.length;++e)if("number"!=typeof t.floatData[e])return"floatData: number[] expected"}if(null!=t.int32Data&&t.hasOwnProperty("int32Data")){if(!Array.isArray(t.int32Data))return"int32Data: array expected";for(e=0;e<t.int32Data.length;++e)if(!u.isInteger(t.int32Data[e]))return"int32Data: integer[] expected"}if(null!=t.stringData&&t.hasOwnProperty("stringData")){if(!Array.isArray(t.stringData))return"stringData: array expected";for(e=0;e<t.stringData.length;++e)if(!(t.stringData[e]&&"number"==typeof t.stringData[e].length||u.isString(t.stringData[e])))return"stringData: buffer[] expected"}if(null!=t.int64Data&&t.hasOwnProperty("int64Data")){if(!Array.isArray(t.int64Data))return"int64Data: array expected";for(e=0;e<t.int64Data.length;++e)if(!(u.isInteger(t.int64Data[e])||t.int64Data[e]&&u.isInteger(t.int64Data[e].low)&&u.isInteger(t.int64Data[e].high)))return"int64Data: integer|Long[] expected"}if(null!=t.name&&t.hasOwnProperty("name")&&!u.isString(t.name))return"name: string expected";if(null!=t.docString&&t.hasOwnProperty("docString")&&!u.isString(t.docString))return"docString: string expected";if(null!=t.rawData&&t.hasOwnProperty("rawData")&&!(t.rawData&&"number"==typeof t.rawData.length||u.isString(t.rawData)))return"rawData: buffer expected";if(null!=t.externalData&&t.hasOwnProperty("externalData")){if(!Array.isArray(t.externalData))return"externalData: array expected";for(e=0;e<t.externalData.length;++e){var r;if(r=l.onnx.StringStringEntryProto.verify(t.externalData[e]))return"externalData."+r}}if(null!=t.dataLocation&&t.hasOwnProperty("dataLocation"))switch(t.dataLocation){default:return"dataLocation: enum value expected";case 0:case 1:}if(null!=t.doubleData&&t.hasOwnProperty("doubleData")){if(!Array.isArray(t.doubleData))return"doubleData: array expected";for(e=0;e<t.doubleData.length;++e)if("number"!=typeof t.doubleData[e])return"doubleData: number[] expected"}if(null!=t.uint64Data&&t.hasOwnProperty("uint64Data")){if(!Array.isArray(t.uint64Data))return"uint64Data: array expected";for(e=0;e<t.uint64Data.length;++e)if(!(u.isInteger(t.uint64Data[e])||t.uint64Data[e]&&u.isInteger(t.uint64Data[e].low)&&u.isInteger(t.uint64Data[e].high)))return"uint64Data: integer|Long[] expected"}return null},t.fromObject=function(t){if(t instanceof l.onnx.TensorProto)return t;var e=new l.onnx.TensorProto;if(t.dims){if(!Array.isArray(t.dims))throw TypeError(".onnx.TensorProto.dims: array expected");e.dims=[];for(var r=0;r<t.dims.length;++r)u.Long?(e.dims[r]=u.Long.fromValue(t.dims[r])).unsigned=!1:"string"==typeof t.dims[r]?e.dims[r]=parseInt(t.dims[r],10):"number"==typeof t.dims[r]?e.dims[r]=t.dims[r]:"object"==typeof t.dims[r]&&(e.dims[r]=new u.LongBits(t.dims[r].low>>>0,t.dims[r].high>>>0).toNumber())}if(null!=t.dataType&&(e.dataType=0|t.dataType),null!=t.segment){if("object"!=typeof t.segment)throw TypeError(".onnx.TensorProto.segment: object expected");e.segment=l.onnx.TensorProto.Segment.fromObject(t.segment)}if(t.floatData){if(!Array.isArray(t.floatData))throw TypeError(".onnx.TensorProto.floatData: array expected");for(e.floatData=[],r=0;r<t.floatData.length;++r)e.floatData[r]=Number(t.floatData[r])}if(t.int32Data){if(!Array.isArray(t.int32Data))throw TypeError(".onnx.TensorProto.int32Data: array expected");for(e.int32Data=[],r=0;r<t.int32Data.length;++r)e.int32Data[r]=0|t.int32Data[r]}if(t.stringData){if(!Array.isArray(t.stringData))throw TypeError(".onnx.TensorProto.stringData: array expected");for(e.stringData=[],r=0;r<t.stringData.length;++r)"string"==typeof t.stringData[r]?u.base64.decode(t.stringData[r],e.stringData[r]=u.newBuffer(u.base64.length(t.stringData[r])),0):t.stringData[r].length>=0&&(e.stringData[r]=t.stringData[r])}if(t.int64Data){if(!Array.isArray(t.int64Data))throw TypeError(".onnx.TensorProto.int64Data: array expected");for(e.int64Data=[],r=0;r<t.int64Data.length;++r)u.Long?(e.int64Data[r]=u.Long.fromValue(t.int64Data[r])).unsigned=!1:"string"==typeof t.int64Data[r]?e.int64Data[r]=parseInt(t.int64Data[r],10):"number"==typeof t.int64Data[r]?e.int64Data[r]=t.int64Data[r]:"object"==typeof t.int64Data[r]&&(e.int64Data[r]=new u.LongBits(t.int64Data[r].low>>>0,t.int64Data[r].high>>>0).toNumber())}if(null!=t.name&&(e.name=String(t.name)),null!=t.docString&&(e.docString=String(t.docString)),null!=t.rawData&&("string"==typeof t.rawData?u.base64.decode(t.rawData,e.rawData=u.newBuffer(u.base64.length(t.rawData)),0):t.rawData.length>=0&&(e.rawData=t.rawData)),t.externalData){if(!Array.isArray(t.externalData))throw TypeError(".onnx.TensorProto.externalData: array expected");for(e.externalData=[],r=0;r<t.externalData.length;++r){if("object"!=typeof t.externalData[r])throw TypeError(".onnx.TensorProto.externalData: object expected");e.externalData[r]=l.onnx.StringStringEntryProto.fromObject(t.externalData[r])}}switch(t.dataLocation){default:if("number"==typeof t.dataLocation){e.dataLocation=t.dataLocation;break}break;case"DEFAULT":case 0:e.dataLocation=0;break;case"EXTERNAL":case 1:e.dataLocation=1}if(t.doubleData){if(!Array.isArray(t.doubleData))throw TypeError(".onnx.TensorProto.doubleData: array expected");for(e.doubleData=[],r=0;r<t.doubleData.length;++r)e.doubleData[r]=Number(t.doubleData[r])}if(t.uint64Data){if(!Array.isArray(t.uint64Data))throw TypeError(".onnx.TensorProto.uint64Data: array expected");for(e.uint64Data=[],r=0;r<t.uint64Data.length;++r)u.Long?(e.uint64Data[r]=u.Long.fromValue(t.uint64Data[r])).unsigned=!0:"string"==typeof t.uint64Data[r]?e.uint64Data[r]=parseInt(t.uint64Data[r],10):"number"==typeof t.uint64Data[r]?e.uint64Data[r]=t.uint64Data[r]:"object"==typeof t.uint64Data[r]&&(e.uint64Data[r]=new u.LongBits(t.uint64Data[r].low>>>0,t.uint64Data[r].high>>>0).toNumber(!0))}return e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.dims=[],r.floatData=[],r.int32Data=[],r.stringData=[],r.int64Data=[],r.doubleData=[],r.uint64Data=[],r.externalData=[]),e.defaults&&(r.dataType=0,r.segment=null,r.name="",e.bytes===String?r.rawData="":(r.rawData=[],e.bytes!==Array&&(r.rawData=u.newBuffer(r.rawData))),r.docString="",r.dataLocation=e.enums===String?"DEFAULT":0),t.dims&&t.dims.length){r.dims=[];for(var n=0;n<t.dims.length;++n)"number"==typeof t.dims[n]?r.dims[n]=e.longs===String?String(t.dims[n]):t.dims[n]:r.dims[n]=e.longs===String?u.Long.prototype.toString.call(t.dims[n]):e.longs===Number?new u.LongBits(t.dims[n].low>>>0,t.dims[n].high>>>0).toNumber():t.dims[n]}if(null!=t.dataType&&t.hasOwnProperty("dataType")&&(r.dataType=t.dataType),null!=t.segment&&t.hasOwnProperty("segment")&&(r.segment=l.onnx.TensorProto.Segment.toObject(t.segment,e)),t.floatData&&t.floatData.length)for(r.floatData=[],n=0;n<t.floatData.length;++n)r.floatData[n]=e.json&&!isFinite(t.floatData[n])?String(t.floatData[n]):t.floatData[n];if(t.int32Data&&t.int32Data.length)for(r.int32Data=[],n=0;n<t.int32Data.length;++n)r.int32Data[n]=t.int32Data[n];if(t.stringData&&t.stringData.length)for(r.stringData=[],n=0;n<t.stringData.length;++n)r.stringData[n]=e.bytes===String?u.base64.encode(t.stringData[n],0,t.stringData[n].length):e.bytes===Array?Array.prototype.slice.call(t.stringData[n]):t.stringData[n];if(t.int64Data&&t.int64Data.length)for(r.int64Data=[],n=0;n<t.int64Data.length;++n)"number"==typeof t.int64Data[n]?r.int64Data[n]=e.longs===String?String(t.int64Data[n]):t.int64Data[n]:r.int64Data[n]=e.longs===String?u.Long.prototype.toString.call(t.int64Data[n]):e.longs===Number?new u.LongBits(t.int64Data[n].low>>>0,t.int64Data[n].high>>>0).toNumber():t.int64Data[n];if(null!=t.name&&t.hasOwnProperty("name")&&(r.name=t.name),null!=t.rawData&&t.hasOwnProperty("rawData")&&(r.rawData=e.bytes===String?u.base64.encode(t.rawData,0,t.rawData.length):e.bytes===Array?Array.prototype.slice.call(t.rawData):t.rawData),t.doubleData&&t.doubleData.length)for(r.doubleData=[],n=0;n<t.doubleData.length;++n)r.doubleData[n]=e.json&&!isFinite(t.doubleData[n])?String(t.doubleData[n]):t.doubleData[n];if(t.uint64Data&&t.uint64Data.length)for(r.uint64Data=[],n=0;n<t.uint64Data.length;++n)"number"==typeof t.uint64Data[n]?r.uint64Data[n]=e.longs===String?String(t.uint64Data[n]):t.uint64Data[n]:r.uint64Data[n]=e.longs===String?u.Long.prototype.toString.call(t.uint64Data[n]):e.longs===Number?new u.LongBits(t.uint64Data[n].low>>>0,t.uint64Data[n].high>>>0).toNumber(!0):t.uint64Data[n];if(null!=t.docString&&t.hasOwnProperty("docString")&&(r.docString=t.docString),t.externalData&&t.externalData.length)for(r.externalData=[],n=0;n<t.externalData.length;++n)r.externalData[n]=l.onnx.StringStringEntryProto.toObject(t.externalData[n],e);return null!=t.dataLocation&&t.hasOwnProperty("dataLocation")&&(r.dataLocation=e.enums===String?void 0===l.onnx.TensorProto.DataLocation[t.dataLocation]?t.dataLocation:l.onnx.TensorProto.DataLocation[t.dataLocation]:t.dataLocation),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TensorProto"},t.DataType=function(){var t={},e=Object.create(t);return e[t[0]="UNDEFINED"]=0,e[t[1]="FLOAT"]=1,e[t[2]="UINT8"]=2,e[t[3]="INT8"]=3,e[t[4]="UINT16"]=4,e[t[5]="INT16"]=5,e[t[6]="INT32"]=6,e[t[7]="INT64"]=7,e[t[8]="STRING"]=8,e[t[9]="BOOL"]=9,e[t[10]="FLOAT16"]=10,e[t[11]="DOUBLE"]=11,e[t[12]="UINT32"]=12,e[t[13]="UINT64"]=13,e[t[14]="COMPLEX64"]=14,e[t[15]="COMPLEX128"]=15,e[t[16]="BFLOAT16"]=16,e[t[17]="FLOAT8E4M3FN"]=17,e[t[18]="FLOAT8E4M3FNUZ"]=18,e[t[19]="FLOAT8E5M2"]=19,e[t[20]="FLOAT8E5M2FNUZ"]=20,e}(),t.Segment=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.begin=u.Long?u.Long.fromBits(0,0,!1):0,t.prototype.end=u.Long?u.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.begin&&Object.hasOwnProperty.call(t,"begin")&&e.uint32(8).int64(t.begin),null!=t.end&&Object.hasOwnProperty.call(t,"end")&&e.uint32(16).int64(t.end),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TensorProto.Segment;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.begin=t.int64();break;case 2:n.end=t.int64();break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null==t.begin||!t.hasOwnProperty("begin")||u.isInteger(t.begin)||t.begin&&u.isInteger(t.begin.low)&&u.isInteger(t.begin.high)?null==t.end||!t.hasOwnProperty("end")||u.isInteger(t.end)||t.end&&u.isInteger(t.end.low)&&u.isInteger(t.end.high)?null:"end: integer|Long expected":"begin: integer|Long expected"},t.fromObject=function(t){if(t instanceof l.onnx.TensorProto.Segment)return t;var e=new l.onnx.TensorProto.Segment;return null!=t.begin&&(u.Long?(e.begin=u.Long.fromValue(t.begin)).unsigned=!1:"string"==typeof t.begin?e.begin=parseInt(t.begin,10):"number"==typeof t.begin?e.begin=t.begin:"object"==typeof t.begin&&(e.begin=new u.LongBits(t.begin.low>>>0,t.begin.high>>>0).toNumber())),null!=t.end&&(u.Long?(e.end=u.Long.fromValue(t.end)).unsigned=!1:"string"==typeof t.end?e.end=parseInt(t.end,10):"number"==typeof t.end?e.end=t.end:"object"==typeof t.end&&(e.end=new u.LongBits(t.end.low>>>0,t.end.high>>>0).toNumber())),e},t.toObject=function(t,e){e||(e={});var r={};if(e.defaults){if(u.Long){var n=new u.Long(0,0,!1);r.begin=e.longs===String?n.toString():e.longs===Number?n.toNumber():n}else r.begin=e.longs===String?"0":0;u.Long?(n=new u.Long(0,0,!1),r.end=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):r.end=e.longs===String?"0":0}return null!=t.begin&&t.hasOwnProperty("begin")&&("number"==typeof t.begin?r.begin=e.longs===String?String(t.begin):t.begin:r.begin=e.longs===String?u.Long.prototype.toString.call(t.begin):e.longs===Number?new u.LongBits(t.begin.low>>>0,t.begin.high>>>0).toNumber():t.begin),null!=t.end&&t.hasOwnProperty("end")&&("number"==typeof t.end?r.end=e.longs===String?String(t.end):t.end:r.end=e.longs===String?u.Long.prototype.toString.call(t.end):e.longs===Number?new u.LongBits(t.end.low>>>0,t.end.high>>>0).toNumber():t.end),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TensorProto.Segment"},t}(),t.DataLocation=function(){var t={},e=Object.create(t);return e[t[0]="DEFAULT"]=0,e[t[1]="EXTERNAL"]=1,e}(),t}(),i.SparseTensorProto=function(){function t(t){if(this.dims=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.values=null,t.prototype.indices=null,t.prototype.dims=u.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.values&&Object.hasOwnProperty.call(t,"values")&&l.onnx.TensorProto.encode(t.values,e.uint32(10).fork()).ldelim(),null!=t.indices&&Object.hasOwnProperty.call(t,"indices")&&l.onnx.TensorProto.encode(t.indices,e.uint32(18).fork()).ldelim(),null!=t.dims&&t.dims.length){e.uint32(26).fork();for(var r=0;r<t.dims.length;++r)e.int64(t.dims[r]);e.ldelim()}return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.SparseTensorProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.values=l.onnx.TensorProto.decode(t,t.uint32());break;case 2:n.indices=l.onnx.TensorProto.decode(t,t.uint32());break;case 3:if(n.dims&&n.dims.length||(n.dims=[]),2==(7&i))for(var s=t.uint32()+t.pos;t.pos<s;)n.dims.push(t.int64());else n.dims.push(t.int64());break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";var e;if(null!=t.values&&t.hasOwnProperty("values")&&(e=l.onnx.TensorProto.verify(t.values)))return"values."+e;if(null!=t.indices&&t.hasOwnProperty("indices")&&(e=l.onnx.TensorProto.verify(t.indices)))return"indices."+e;if(null!=t.dims&&t.hasOwnProperty("dims")){if(!Array.isArray(t.dims))return"dims: array expected";for(var r=0;r<t.dims.length;++r)if(!(u.isInteger(t.dims[r])||t.dims[r]&&u.isInteger(t.dims[r].low)&&u.isInteger(t.dims[r].high)))return"dims: integer|Long[] expected"}return null},t.fromObject=function(t){if(t instanceof l.onnx.SparseTensorProto)return t;var e=new l.onnx.SparseTensorProto;if(null!=t.values){if("object"!=typeof t.values)throw TypeError(".onnx.SparseTensorProto.values: object expected");e.values=l.onnx.TensorProto.fromObject(t.values)}if(null!=t.indices){if("object"!=typeof t.indices)throw TypeError(".onnx.SparseTensorProto.indices: object expected");e.indices=l.onnx.TensorProto.fromObject(t.indices)}if(t.dims){if(!Array.isArray(t.dims))throw TypeError(".onnx.SparseTensorProto.dims: array expected");e.dims=[];for(var r=0;r<t.dims.length;++r)u.Long?(e.dims[r]=u.Long.fromValue(t.dims[r])).unsigned=!1:"string"==typeof t.dims[r]?e.dims[r]=parseInt(t.dims[r],10):"number"==typeof t.dims[r]?e.dims[r]=t.dims[r]:"object"==typeof t.dims[r]&&(e.dims[r]=new u.LongBits(t.dims[r].low>>>0,t.dims[r].high>>>0).toNumber())}return e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.dims=[]),e.defaults&&(r.values=null,r.indices=null),null!=t.values&&t.hasOwnProperty("values")&&(r.values=l.onnx.TensorProto.toObject(t.values,e)),null!=t.indices&&t.hasOwnProperty("indices")&&(r.indices=l.onnx.TensorProto.toObject(t.indices,e)),t.dims&&t.dims.length){r.dims=[];for(var n=0;n<t.dims.length;++n)"number"==typeof t.dims[n]?r.dims[n]=e.longs===String?String(t.dims[n]):t.dims[n]:r.dims[n]=e.longs===String?u.Long.prototype.toString.call(t.dims[n]):e.longs===Number?new u.LongBits(t.dims[n].low>>>0,t.dims[n].high>>>0).toNumber():t.dims[n]}return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.SparseTensorProto"},t}(),i.TensorShapeProto=function(){function t(t){if(this.dim=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.dim=u.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.dim&&t.dim.length)for(var r=0;r<t.dim.length;++r)l.onnx.TensorShapeProto.Dimension.encode(t.dim[r],e.uint32(10).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TensorShapeProto;t.pos<r;){var i=t.uint32();i>>>3==1?(n.dim&&n.dim.length||(n.dim=[]),n.dim.push(l.onnx.TensorShapeProto.Dimension.decode(t,t.uint32()))):t.skipType(7&i)}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.dim&&t.hasOwnProperty("dim")){if(!Array.isArray(t.dim))return"dim: array expected";for(var e=0;e<t.dim.length;++e){var r=l.onnx.TensorShapeProto.Dimension.verify(t.dim[e]);if(r)return"dim."+r}}return null},t.fromObject=function(t){if(t instanceof l.onnx.TensorShapeProto)return t;var e=new l.onnx.TensorShapeProto;if(t.dim){if(!Array.isArray(t.dim))throw TypeError(".onnx.TensorShapeProto.dim: array expected");e.dim=[];for(var r=0;r<t.dim.length;++r){if("object"!=typeof t.dim[r])throw TypeError(".onnx.TensorShapeProto.dim: object expected");e.dim[r]=l.onnx.TensorShapeProto.Dimension.fromObject(t.dim[r])}}return e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.dim=[]),t.dim&&t.dim.length){r.dim=[];for(var n=0;n<t.dim.length;++n)r.dim[n]=l.onnx.TensorShapeProto.Dimension.toObject(t.dim[n],e)}return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TensorShapeProto"},t.Dimension=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}var e;return t.prototype.dimValue=null,t.prototype.dimParam=null,t.prototype.denotation="",Object.defineProperty(t.prototype,"value",{get:u.oneOfGetter(e=["dimValue","dimParam"]),set:u.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.dimValue&&Object.hasOwnProperty.call(t,"dimValue")&&e.uint32(8).int64(t.dimValue),null!=t.dimParam&&Object.hasOwnProperty.call(t,"dimParam")&&e.uint32(18).string(t.dimParam),null!=t.denotation&&Object.hasOwnProperty.call(t,"denotation")&&e.uint32(26).string(t.denotation),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TensorShapeProto.Dimension;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.dimValue=t.int64();break;case 2:n.dimParam=t.string();break;case 3:n.denotation=t.string();break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";var e={};if(null!=t.dimValue&&t.hasOwnProperty("dimValue")&&(e.value=1,!(u.isInteger(t.dimValue)||t.dimValue&&u.isInteger(t.dimValue.low)&&u.isInteger(t.dimValue.high))))return"dimValue: integer|Long expected";if(null!=t.dimParam&&t.hasOwnProperty("dimParam")){if(1===e.value)return"value: multiple values";if(e.value=1,!u.isString(t.dimParam))return"dimParam: string expected"}return null!=t.denotation&&t.hasOwnProperty("denotation")&&!u.isString(t.denotation)?"denotation: string expected":null},t.fromObject=function(t){if(t instanceof l.onnx.TensorShapeProto.Dimension)return t;var e=new l.onnx.TensorShapeProto.Dimension;return null!=t.dimValue&&(u.Long?(e.dimValue=u.Long.fromValue(t.dimValue)).unsigned=!1:"string"==typeof t.dimValue?e.dimValue=parseInt(t.dimValue,10):"number"==typeof t.dimValue?e.dimValue=t.dimValue:"object"==typeof t.dimValue&&(e.dimValue=new u.LongBits(t.dimValue.low>>>0,t.dimValue.high>>>0).toNumber())),null!=t.dimParam&&(e.dimParam=String(t.dimParam)),null!=t.denotation&&(e.denotation=String(t.denotation)),e},t.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.denotation=""),null!=t.dimValue&&t.hasOwnProperty("dimValue")&&("number"==typeof t.dimValue?r.dimValue=e.longs===String?String(t.dimValue):t.dimValue:r.dimValue=e.longs===String?u.Long.prototype.toString.call(t.dimValue):e.longs===Number?new u.LongBits(t.dimValue.low>>>0,t.dimValue.high>>>0).toNumber():t.dimValue,e.oneofs&&(r.value="dimValue")),null!=t.dimParam&&t.hasOwnProperty("dimParam")&&(r.dimParam=t.dimParam,e.oneofs&&(r.value="dimParam")),null!=t.denotation&&t.hasOwnProperty("denotation")&&(r.denotation=t.denotation),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TensorShapeProto.Dimension"},t}(),t}(),i.TypeProto=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}var e;return t.prototype.tensorType=null,t.prototype.sequenceType=null,t.prototype.mapType=null,t.prototype.optionalType=null,t.prototype.sparseTensorType=null,t.prototype.denotation="",Object.defineProperty(t.prototype,"value",{get:u.oneOfGetter(e=["tensorType","sequenceType","mapType","optionalType","sparseTensorType"]),set:u.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.tensorType&&Object.hasOwnProperty.call(t,"tensorType")&&l.onnx.TypeProto.Tensor.encode(t.tensorType,e.uint32(10).fork()).ldelim(),null!=t.sequenceType&&Object.hasOwnProperty.call(t,"sequenceType")&&l.onnx.TypeProto.Sequence.encode(t.sequenceType,e.uint32(34).fork()).ldelim(),null!=t.mapType&&Object.hasOwnProperty.call(t,"mapType")&&l.onnx.TypeProto.Map.encode(t.mapType,e.uint32(42).fork()).ldelim(),null!=t.denotation&&Object.hasOwnProperty.call(t,"denotation")&&e.uint32(50).string(t.denotation),null!=t.sparseTensorType&&Object.hasOwnProperty.call(t,"sparseTensorType")&&l.onnx.TypeProto.SparseTensor.encode(t.sparseTensorType,e.uint32(66).fork()).ldelim(),null!=t.optionalType&&Object.hasOwnProperty.call(t,"optionalType")&&l.onnx.TypeProto.Optional.encode(t.optionalType,e.uint32(74).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TypeProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.tensorType=l.onnx.TypeProto.Tensor.decode(t,t.uint32());break;case 4:n.sequenceType=l.onnx.TypeProto.Sequence.decode(t,t.uint32());break;case 5:n.mapType=l.onnx.TypeProto.Map.decode(t,t.uint32());break;case 9:n.optionalType=l.onnx.TypeProto.Optional.decode(t,t.uint32());break;case 8:n.sparseTensorType=l.onnx.TypeProto.SparseTensor.decode(t,t.uint32());break;case 6:n.denotation=t.string();break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";var e={};if(null!=t.tensorType&&t.hasOwnProperty("tensorType")&&(e.value=1,r=l.onnx.TypeProto.Tensor.verify(t.tensorType)))return"tensorType."+r;if(null!=t.sequenceType&&t.hasOwnProperty("sequenceType")){if(1===e.value)return"value: multiple values";if(e.value=1,r=l.onnx.TypeProto.Sequence.verify(t.sequenceType))return"sequenceType."+r}if(null!=t.mapType&&t.hasOwnProperty("mapType")){if(1===e.value)return"value: multiple values";if(e.value=1,r=l.onnx.TypeProto.Map.verify(t.mapType))return"mapType."+r}if(null!=t.optionalType&&t.hasOwnProperty("optionalType")){if(1===e.value)return"value: multiple values";if(e.value=1,r=l.onnx.TypeProto.Optional.verify(t.optionalType))return"optionalType."+r}if(null!=t.sparseTensorType&&t.hasOwnProperty("sparseTensorType")){if(1===e.value)return"value: multiple values";var r;if(e.value=1,r=l.onnx.TypeProto.SparseTensor.verify(t.sparseTensorType))return"sparseTensorType."+r}return null!=t.denotation&&t.hasOwnProperty("denotation")&&!u.isString(t.denotation)?"denotation: string expected":null},t.fromObject=function(t){if(t instanceof l.onnx.TypeProto)return t;var e=new l.onnx.TypeProto;if(null!=t.tensorType){if("object"!=typeof t.tensorType)throw TypeError(".onnx.TypeProto.tensorType: object expected");e.tensorType=l.onnx.TypeProto.Tensor.fromObject(t.tensorType)}if(null!=t.sequenceType){if("object"!=typeof t.sequenceType)throw TypeError(".onnx.TypeProto.sequenceType: object expected");e.sequenceType=l.onnx.TypeProto.Sequence.fromObject(t.sequenceType)}if(null!=t.mapType){if("object"!=typeof t.mapType)throw TypeError(".onnx.TypeProto.mapType: object expected");e.mapType=l.onnx.TypeProto.Map.fromObject(t.mapType)}if(null!=t.optionalType){if("object"!=typeof t.optionalType)throw TypeError(".onnx.TypeProto.optionalType: object expected");e.optionalType=l.onnx.TypeProto.Optional.fromObject(t.optionalType)}if(null!=t.sparseTensorType){if("object"!=typeof t.sparseTensorType)throw TypeError(".onnx.TypeProto.sparseTensorType: object expected");e.sparseTensorType=l.onnx.TypeProto.SparseTensor.fromObject(t.sparseTensorType)}return null!=t.denotation&&(e.denotation=String(t.denotation)),e},t.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.denotation=""),null!=t.tensorType&&t.hasOwnProperty("tensorType")&&(r.tensorType=l.onnx.TypeProto.Tensor.toObject(t.tensorType,e),e.oneofs&&(r.value="tensorType")),null!=t.sequenceType&&t.hasOwnProperty("sequenceType")&&(r.sequenceType=l.onnx.TypeProto.Sequence.toObject(t.sequenceType,e),e.oneofs&&(r.value="sequenceType")),null!=t.mapType&&t.hasOwnProperty("mapType")&&(r.mapType=l.onnx.TypeProto.Map.toObject(t.mapType,e),e.oneofs&&(r.value="mapType")),null!=t.denotation&&t.hasOwnProperty("denotation")&&(r.denotation=t.denotation),null!=t.sparseTensorType&&t.hasOwnProperty("sparseTensorType")&&(r.sparseTensorType=l.onnx.TypeProto.SparseTensor.toObject(t.sparseTensorType,e),e.oneofs&&(r.value="sparseTensorType")),null!=t.optionalType&&t.hasOwnProperty("optionalType")&&(r.optionalType=l.onnx.TypeProto.Optional.toObject(t.optionalType,e),e.oneofs&&(r.value="optionalType")),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TypeProto"},t.Tensor=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.elemType=0,t.prototype.shape=null,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.elemType&&Object.hasOwnProperty.call(t,"elemType")&&e.uint32(8).int32(t.elemType),null!=t.shape&&Object.hasOwnProperty.call(t,"shape")&&l.onnx.TensorShapeProto.encode(t.shape,e.uint32(18).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TypeProto.Tensor;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.elemType=t.int32();break;case 2:n.shape=l.onnx.TensorShapeProto.decode(t,t.uint32());break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.elemType&&t.hasOwnProperty("elemType")&&!u.isInteger(t.elemType))return"elemType: integer expected";if(null!=t.shape&&t.hasOwnProperty("shape")){var e=l.onnx.TensorShapeProto.verify(t.shape);if(e)return"shape."+e}return null},t.fromObject=function(t){if(t instanceof l.onnx.TypeProto.Tensor)return t;var e=new l.onnx.TypeProto.Tensor;if(null!=t.elemType&&(e.elemType=0|t.elemType),null!=t.shape){if("object"!=typeof t.shape)throw TypeError(".onnx.TypeProto.Tensor.shape: object expected");e.shape=l.onnx.TensorShapeProto.fromObject(t.shape)}return e},t.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.elemType=0,r.shape=null),null!=t.elemType&&t.hasOwnProperty("elemType")&&(r.elemType=t.elemType),null!=t.shape&&t.hasOwnProperty("shape")&&(r.shape=l.onnx.TensorShapeProto.toObject(t.shape,e)),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TypeProto.Tensor"},t}(),t.Sequence=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.elemType=null,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.elemType&&Object.hasOwnProperty.call(t,"elemType")&&l.onnx.TypeProto.encode(t.elemType,e.uint32(10).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TypeProto.Sequence;t.pos<r;){var i=t.uint32();i>>>3==1?n.elemType=l.onnx.TypeProto.decode(t,t.uint32()):t.skipType(7&i)}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.elemType&&t.hasOwnProperty("elemType")){var e=l.onnx.TypeProto.verify(t.elemType);if(e)return"elemType."+e}return null},t.fromObject=function(t){if(t instanceof l.onnx.TypeProto.Sequence)return t;var e=new l.onnx.TypeProto.Sequence;if(null!=t.elemType){if("object"!=typeof t.elemType)throw TypeError(".onnx.TypeProto.Sequence.elemType: object expected");e.elemType=l.onnx.TypeProto.fromObject(t.elemType)}return e},t.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.elemType=null),null!=t.elemType&&t.hasOwnProperty("elemType")&&(r.elemType=l.onnx.TypeProto.toObject(t.elemType,e)),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TypeProto.Sequence"},t}(),t.Map=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.keyType=0,t.prototype.valueType=null,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.keyType&&Object.hasOwnProperty.call(t,"keyType")&&e.uint32(8).int32(t.keyType),null!=t.valueType&&Object.hasOwnProperty.call(t,"valueType")&&l.onnx.TypeProto.encode(t.valueType,e.uint32(18).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TypeProto.Map;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.keyType=t.int32();break;case 2:n.valueType=l.onnx.TypeProto.decode(t,t.uint32());break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.keyType&&t.hasOwnProperty("keyType")&&!u.isInteger(t.keyType))return"keyType: integer expected";if(null!=t.valueType&&t.hasOwnProperty("valueType")){var e=l.onnx.TypeProto.verify(t.valueType);if(e)return"valueType."+e}return null},t.fromObject=function(t){if(t instanceof l.onnx.TypeProto.Map)return t;var e=new l.onnx.TypeProto.Map;if(null!=t.keyType&&(e.keyType=0|t.keyType),null!=t.valueType){if("object"!=typeof t.valueType)throw TypeError(".onnx.TypeProto.Map.valueType: object expected");e.valueType=l.onnx.TypeProto.fromObject(t.valueType)}return e},t.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.keyType=0,r.valueType=null),null!=t.keyType&&t.hasOwnProperty("keyType")&&(r.keyType=t.keyType),null!=t.valueType&&t.hasOwnProperty("valueType")&&(r.valueType=l.onnx.TypeProto.toObject(t.valueType,e)),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TypeProto.Map"},t}(),t.Optional=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.elemType=null,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.elemType&&Object.hasOwnProperty.call(t,"elemType")&&l.onnx.TypeProto.encode(t.elemType,e.uint32(10).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TypeProto.Optional;t.pos<r;){var i=t.uint32();i>>>3==1?n.elemType=l.onnx.TypeProto.decode(t,t.uint32()):t.skipType(7&i)}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.elemType&&t.hasOwnProperty("elemType")){var e=l.onnx.TypeProto.verify(t.elemType);if(e)return"elemType."+e}return null},t.fromObject=function(t){if(t instanceof l.onnx.TypeProto.Optional)return t;var e=new l.onnx.TypeProto.Optional;if(null!=t.elemType){if("object"!=typeof t.elemType)throw TypeError(".onnx.TypeProto.Optional.elemType: object expected");e.elemType=l.onnx.TypeProto.fromObject(t.elemType)}return e},t.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.elemType=null),null!=t.elemType&&t.hasOwnProperty("elemType")&&(r.elemType=l.onnx.TypeProto.toObject(t.elemType,e)),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TypeProto.Optional"},t}(),t.SparseTensor=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.elemType=0,t.prototype.shape=null,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.elemType&&Object.hasOwnProperty.call(t,"elemType")&&e.uint32(8).int32(t.elemType),null!=t.shape&&Object.hasOwnProperty.call(t,"shape")&&l.onnx.TensorShapeProto.encode(t.shape,e.uint32(18).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.TypeProto.SparseTensor;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.elemType=t.int32();break;case 2:n.shape=l.onnx.TensorShapeProto.decode(t,t.uint32());break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.elemType&&t.hasOwnProperty("elemType")&&!u.isInteger(t.elemType))return"elemType: integer expected";if(null!=t.shape&&t.hasOwnProperty("shape")){var e=l.onnx.TensorShapeProto.verify(t.shape);if(e)return"shape."+e}return null},t.fromObject=function(t){if(t instanceof l.onnx.TypeProto.SparseTensor)return t;var e=new l.onnx.TypeProto.SparseTensor;if(null!=t.elemType&&(e.elemType=0|t.elemType),null!=t.shape){if("object"!=typeof t.shape)throw TypeError(".onnx.TypeProto.SparseTensor.shape: object expected");e.shape=l.onnx.TensorShapeProto.fromObject(t.shape)}return e},t.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.elemType=0,r.shape=null),null!=t.elemType&&t.hasOwnProperty("elemType")&&(r.elemType=t.elemType),null!=t.shape&&t.hasOwnProperty("shape")&&(r.shape=l.onnx.TensorShapeProto.toObject(t.shape,e)),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.TypeProto.SparseTensor"},t}(),t}(),i.OperatorSetIdProto=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.domain="",t.prototype.version=u.Long?u.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.domain&&Object.hasOwnProperty.call(t,"domain")&&e.uint32(10).string(t.domain),null!=t.version&&Object.hasOwnProperty.call(t,"version")&&e.uint32(16).int64(t.version),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.OperatorSetIdProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.domain=t.string();break;case 2:n.version=t.int64();break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.domain&&t.hasOwnProperty("domain")&&!u.isString(t.domain)?"domain: string expected":null==t.version||!t.hasOwnProperty("version")||u.isInteger(t.version)||t.version&&u.isInteger(t.version.low)&&u.isInteger(t.version.high)?null:"version: integer|Long expected"},t.fromObject=function(t){if(t instanceof l.onnx.OperatorSetIdProto)return t;var e=new l.onnx.OperatorSetIdProto;return null!=t.domain&&(e.domain=String(t.domain)),null!=t.version&&(u.Long?(e.version=u.Long.fromValue(t.version)).unsigned=!1:"string"==typeof t.version?e.version=parseInt(t.version,10):"number"==typeof t.version?e.version=t.version:"object"==typeof t.version&&(e.version=new u.LongBits(t.version.low>>>0,t.version.high>>>0).toNumber())),e},t.toObject=function(t,e){e||(e={});var r={};if(e.defaults)if(r.domain="",u.Long){var n=new u.Long(0,0,!1);r.version=e.longs===String?n.toString():e.longs===Number?n.toNumber():n}else r.version=e.longs===String?"0":0;return null!=t.domain&&t.hasOwnProperty("domain")&&(r.domain=t.domain),null!=t.version&&t.hasOwnProperty("version")&&("number"==typeof t.version?r.version=e.longs===String?String(t.version):t.version:r.version=e.longs===String?u.Long.prototype.toString.call(t.version):e.longs===Number?new u.LongBits(t.version.low>>>0,t.version.high>>>0).toNumber():t.version),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.OperatorSetIdProto"},t}(),i.OperatorStatus=function(){var t={},e=Object.create(t);return e[t[0]="EXPERIMENTAL"]=0,e[t[1]="STABLE"]=1,e}(),i.FunctionProto=function(){function t(t){if(this.input=[],this.output=[],this.attribute=[],this.attributeProto=[],this.node=[],this.opsetImport=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.name="",t.prototype.input=u.emptyArray,t.prototype.output=u.emptyArray,t.prototype.attribute=u.emptyArray,t.prototype.attributeProto=u.emptyArray,t.prototype.node=u.emptyArray,t.prototype.docString="",t.prototype.opsetImport=u.emptyArray,t.prototype.domain="",t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(10).string(t.name),null!=t.input&&t.input.length)for(var r=0;r<t.input.length;++r)e.uint32(34).string(t.input[r]);if(null!=t.output&&t.output.length)for(r=0;r<t.output.length;++r)e.uint32(42).string(t.output[r]);if(null!=t.attribute&&t.attribute.length)for(r=0;r<t.attribute.length;++r)e.uint32(50).string(t.attribute[r]);if(null!=t.node&&t.node.length)for(r=0;r<t.node.length;++r)l.onnx.NodeProto.encode(t.node[r],e.uint32(58).fork()).ldelim();if(null!=t.docString&&Object.hasOwnProperty.call(t,"docString")&&e.uint32(66).string(t.docString),null!=t.opsetImport&&t.opsetImport.length)for(r=0;r<t.opsetImport.length;++r)l.onnx.OperatorSetIdProto.encode(t.opsetImport[r],e.uint32(74).fork()).ldelim();if(null!=t.domain&&Object.hasOwnProperty.call(t,"domain")&&e.uint32(82).string(t.domain),null!=t.attributeProto&&t.attributeProto.length)for(r=0;r<t.attributeProto.length;++r)l.onnx.AttributeProto.encode(t.attributeProto[r],e.uint32(90).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var r=void 0===e?t.len:t.pos+e,n=new l.onnx.FunctionProto;t.pos<r;){var i=t.uint32();switch(i>>>3){case 1:n.name=t.string();break;case 4:n.input&&n.input.length||(n.input=[]),n.input.push(t.string());break;case 5:n.output&&n.output.length||(n.output=[]),n.output.push(t.string());break;case 6:n.attribute&&n.attribute.length||(n.attribute=[]),n.attribute.push(t.string());break;case 11:n.attributeProto&&n.attributeProto.length||(n.attributeProto=[]),n.attributeProto.push(l.onnx.AttributeProto.decode(t,t.uint32()));break;case 7:n.node&&n.node.length||(n.node=[]),n.node.push(l.onnx.NodeProto.decode(t,t.uint32()));break;case 8:n.docString=t.string();break;case 9:n.opsetImport&&n.opsetImport.length||(n.opsetImport=[]),n.opsetImport.push(l.onnx.OperatorSetIdProto.decode(t,t.uint32()));break;case 10:n.domain=t.string();break;default:t.skipType(7&i)}}return n},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.name&&t.hasOwnProperty("name")&&!u.isString(t.name))return"name: string expected";if(null!=t.input&&t.hasOwnProperty("input")){if(!Array.isArray(t.input))return"input: array expected";for(var e=0;e<t.input.length;++e)if(!u.isString(t.input[e]))return"input: string[] expected"}if(null!=t.output&&t.hasOwnProperty("output")){if(!Array.isArray(t.output))return"output: array expected";for(e=0;e<t.output.length;++e)if(!u.isString(t.output[e]))return"output: string[] expected"}if(null!=t.attribute&&t.hasOwnProperty("attribute")){if(!Array.isArray(t.attribute))return"attribute: array expected";for(e=0;e<t.attribute.length;++e)if(!u.isString(t.attribute[e]))return"attribute: string[] expected"}if(null!=t.attributeProto&&t.hasOwnProperty("attributeProto")){if(!Array.isArray(t.attributeProto))return"attributeProto: array expected";for(e=0;e<t.attributeProto.length;++e)if(r=l.onnx.AttributeProto.verify(t.attributeProto[e]))return"attributeProto."+r}if(null!=t.node&&t.hasOwnProperty("node")){if(!Array.isArray(t.node))return"node: array expected";for(e=0;e<t.node.length;++e)if(r=l.onnx.NodeProto.verify(t.node[e]))return"node."+r}if(null!=t.docString&&t.hasOwnProperty("docString")&&!u.isString(t.docString))return"docString: string expected";if(null!=t.opsetImport&&t.hasOwnProperty("opsetImport")){if(!Array.isArray(t.opsetImport))return"opsetImport: array expected";for(e=0;e<t.opsetImport.length;++e){var r;if(r=l.onnx.OperatorSetIdProto.verify(t.opsetImport[e]))return"opsetImport."+r}}return null!=t.domain&&t.hasOwnProperty("domain")&&!u.isString(t.domain)?"domain: string expected":null},t.fromObject=function(t){if(t instanceof l.onnx.FunctionProto)return t;var e=new l.onnx.FunctionProto;if(null!=t.name&&(e.name=String(t.name)),t.input){if(!Array.isArray(t.input))throw TypeError(".onnx.FunctionProto.input: array expected");e.input=[];for(var r=0;r<t.input.length;++r)e.input[r]=String(t.input[r])}if(t.output){if(!Array.isArray(t.output))throw TypeError(".onnx.FunctionProto.output: array expected");for(e.output=[],r=0;r<t.output.length;++r)e.output[r]=String(t.output[r])}if(t.attribute){if(!Array.isArray(t.attribute))throw TypeError(".onnx.FunctionProto.attribute: array expected");for(e.attribute=[],r=0;r<t.attribute.length;++r)e.attribute[r]=String(t.attribute[r])}if(t.attributeProto){if(!Array.isArray(t.attributeProto))throw TypeError(".onnx.FunctionProto.attributeProto: array expected");for(e.attributeProto=[],r=0;r<t.attributeProto.length;++r){if("object"!=typeof t.attributeProto[r])throw TypeError(".onnx.FunctionProto.attributeProto: object expected");e.attributeProto[r]=l.onnx.AttributeProto.fromObject(t.attributeProto[r])}}if(t.node){if(!Array.isArray(t.node))throw TypeError(".onnx.FunctionProto.node: array expected");for(e.node=[],r=0;r<t.node.length;++r){if("object"!=typeof t.node[r])throw TypeError(".onnx.FunctionProto.node: object expected");e.node[r]=l.onnx.NodeProto.fromObject(t.node[r])}}if(null!=t.docString&&(e.docString=String(t.docString)),t.opsetImport){if(!Array.isArray(t.opsetImport))throw TypeError(".onnx.FunctionProto.opsetImport: array expected");for(e.opsetImport=[],r=0;r<t.opsetImport.length;++r){if("object"!=typeof t.opsetImport[r])throw TypeError(".onnx.FunctionProto.opsetImport: object expected");e.opsetImport[r]=l.onnx.OperatorSetIdProto.fromObject(t.opsetImport[r])}}return null!=t.domain&&(e.domain=String(t.domain)),e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.input=[],r.output=[],r.attribute=[],r.node=[],r.opsetImport=[],r.attributeProto=[]),e.defaults&&(r.name="",r.docString="",r.domain=""),null!=t.name&&t.hasOwnProperty("name")&&(r.name=t.name),t.input&&t.input.length){r.input=[];for(var n=0;n<t.input.length;++n)r.input[n]=t.input[n]}if(t.output&&t.output.length)for(r.output=[],n=0;n<t.output.length;++n)r.output[n]=t.output[n];if(t.attribute&&t.attribute.length)for(r.attribute=[],n=0;n<t.attribute.length;++n)r.attribute[n]=t.attribute[n];if(t.node&&t.node.length)for(r.node=[],n=0;n<t.node.length;++n)r.node[n]=l.onnx.NodeProto.toObject(t.node[n],e);if(null!=t.docString&&t.hasOwnProperty("docString")&&(r.docString=t.docString),t.opsetImport&&t.opsetImport.length)for(r.opsetImport=[],n=0;n<t.opsetImport.length;++n)r.opsetImport[n]=l.onnx.OperatorSetIdProto.toObject(t.opsetImport[n],e);if(null!=t.domain&&t.hasOwnProperty("domain")&&(r.domain=t.domain),t.attributeProto&&t.attributeProto.length)for(r.attributeProto=[],n=0;n<t.attributeProto.length;++n)r.attributeProto[n]=l.onnx.AttributeProto.toObject(t.attributeProto[n],e);return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/onnx.FunctionProto"},t}(),i),e.exports=l}));function zr(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function hn(t){return(new TextDecoder).decode(t)}var we,wr,xi,Xe,ro,Ve,ot,z,dn,vr,_r,Or,fe=D((()=>{Jn(),ai(),we=Nr(Ur()),Sr(),wr=class{static arraysEqual(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}},xi=class{static preprocessInputShapes(t,e){return[1===t.length?[1,t[0]]:t,1===e.length?[e[0],1]:e]}static postprocessOutputShape(t,e,r){1===e&&t.splice(t.length-2,1),1===r&&t.pop()}static calcMatMulShape(t,e){return t[1]!==e[0]?void 0:[t[0],e[1]]}},Xe=class t{static calcShape(t,e,r=!1){let n=t.length,i=e.length;if(0===n)return e;if(0===i)return t;let s=Math.max(t.length,e.length),o=new Array(s);if(r){if(n<2||i<2)return;let r=xi.calcMatMulShape([t[n-2],t[n-1]],[e[i-2],e[i-1]]);if(void 0===r)return;[o[s-2],o[s-1]]=r}for(let a=r?3:1;a<=s;a++){let r=n-a<0?1:t[n-a],u=i-a<0?1:e[i-a];if(r!==u&&r>1&&u>1)return;o[s-a]=Math.max(r,u)}return o}static index(e,r){let n=new Array(r.length);return t.fillIndex(e,r,n),n}static fillIndex(t,e,r){let n=t.length-e.length;for(let i=0;i<e.length;i++)r[i]=t[n+i]%e[i]}static calc(e,r,n,i,s){let o=t.calcShape(e.dims,r.dims);if(o){if(i&&!z.areEqual(o,e.dims))return;let a=z.size(o),u=i?e:new Be(o,s||e.type);if(0===o.length)u.set([],n(e.get([]),r.get([])));else{let i,s=new Array(o.length),l=new Array(e.dims.length),c=new Array(r.dims.length),h=0,f=0,d=!1,p=!1;0===e.dims.length&&(h=e.get([]),d=!0),0===r.dims.length&&(f=r.get([]),p=!0);for(let v=0;v<a;v++){i=v;for(let t=o.length-1;t>=0;t--)s[t]=i%o[t],i=Math.floor(i/o[t]);d||(t.fillIndex(s,e.dims,l),h=e.get(l)),p||(t.fillIndex(s,r.dims,c),f=r.get(c)),u.set(s,n(h,f))}}return u}}static isValidBroadcast(t,e){let r=t.length,n=e.length;if(r>n)return!1;for(let i=1;i<=r;i++)if(1!==t[r-i]&&t[r-i]!==e[n-i])return!1;return!0}static getBroadcastDims(t,e){let r=t.length,n=[];for(let i=0;i<r;i++){let s=r-1-i,o=t[s]||1;(e[e.length-1-i]||1)>1&&1===o&&n.unshift(s)}return n}},ro=class{static getShapeOfGemmResult(t,e,r,n,i){if(2!==t.length||2!==r.length)throw new Error("shape need to be of size 2");let s,o,a;e?(s=t[1],o=t[0]):(s=t[0],o=t[1]);let u=-1;if(n?(a=r[0],u=1):(a=r[1],u=0),r[u]!==o)throw new Error("dimension mismatch");if(s<=0||a<=0||o<=0)throw new Error("invalid shape specified");if(i&&!Xe.isValidBroadcast(i,[s,a]))throw new Error("gemm: invalid bias shape for broadcast");return[s,a,o]}},Ve=class t{static tensorDataTypeFromProto(t){switch(t){case we.onnx.TensorProto.DataType.INT8:return"int8";case we.onnx.TensorProto.DataType.UINT8:return"uint8";case we.onnx.TensorProto.DataType.BOOL:return"bool";case we.onnx.TensorProto.DataType.INT16:return"int16";case we.onnx.TensorProto.DataType.UINT16:return"uint16";case we.onnx.TensorProto.DataType.INT32:return"int32";case we.onnx.TensorProto.DataType.UINT32:return"uint32";case we.onnx.TensorProto.DataType.FLOAT:return"float32";case we.onnx.TensorProto.DataType.DOUBLE:return"float64";case we.onnx.TensorProto.DataType.STRING:return"string";case we.onnx.TensorProto.DataType.INT64:return"int32";case we.onnx.TensorProto.DataType.UINT64:return"uint32";default:throw new Error(`unsupported data type: ${we.onnx.TensorProto.DataType[t]}`)}}static tensorDataTypeStringToEnum(t){switch(t){case"int8":return we.onnx.TensorProto.DataType.INT8;case"uint8":return we.onnx.TensorProto.DataType.UINT8;case"bool":return we.onnx.TensorProto.DataType.BOOL;case"int16":return we.onnx.TensorProto.DataType.INT16;case"uint16":return we.onnx.TensorProto.DataType.UINT16;case"int32":return we.onnx.TensorProto.DataType.INT32;case"uint32":return we.onnx.TensorProto.DataType.UINT32;case"float32":return we.onnx.TensorProto.DataType.FLOAT;case"float64":return we.onnx.TensorProto.DataType.DOUBLE;case"string":return we.onnx.TensorProto.DataType.STRING;case"int64":return we.onnx.TensorProto.DataType.INT64;case"uint64":return we.onnx.TensorProto.DataType.UINT64;default:throw new Error(`unsupported data type: ${t}`)}}static tensorDimsFromProto(t){return t.map((t=>Yt.isLong(t)?t.toNumber():t))}static tensorValueTypeFromProto(e){return{tensorType:t.tensorDataTypeFromProto(e.elemType),shape:{dims:t.tensorDimsFromProto(e.shape.dim.map((t=>t.dimValue)))}}}static tensorDimsFromORTFormat(t){let e=[];for(let r=0;r<t.dimsLength();r++)e.push(ot.longToNumber(t.dims(r)));return e}static tensorAttributesFromORTFormat(t){let e=[];for(let r=0;r<t.attributesLength();r++)e.push(t.attributes(r));return e}},ot=class{static longToNumber(t,e){return Yt.isLong(t)?t.toNumber():t instanceof S.Long?Yt.fromValue({low:t.low,high:t.high,unsigned:e??!1}).toNumber():t}static isLong(t){return Yt.isLong(t)||t instanceof S.Long}},z=class t{static size(e){return t.getSizeFromDimensionRange(e,0,e.length)}static sizeFromDimension(e,r){if(r<0||r>e.length)throw new Error(`invalid dimension of ${r} for sizeFromDimension as Tensor has ${e.length} dimensions.`);return t.getSizeFromDimensionRange(e,r,e.length)}static sizeToDimension(e,r){if(r<0||r>e.length)throw new Error(`invalid dimension of ${r} for sizeToDimension as Tensor has ${e.length} dimensions.`);return t.getSizeFromDimensionRange(e,0,r)}static getSizeFromDimensionRange(t,e,r){let n=1;for(let i=e;i<r;i++){if(t[i]<=0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains 0 or negative values in them.");n*=t[i]}return n}static computeStrides(t){let e=t.length;if(0===e)return[];if(1===e)return[1];let r=new Array(e);r[e-1]=1,r[e-2]=t[e-1];for(let n=e-3;n>=0;--n)r[n]=r[n+1]*t[n+1];return r}static transpose(t){return t.slice().reverse()}static indicesToOffset(t,e,r){void 0===r&&(r=t.length);let n=0;for(let i=0;i<r;++i)n+=e[i]*t[i];return n}static offsetToIndices(t,e){let r=e.length;if(0===r)return[];if(1===r)return[t*e[0]];let n=new Array(e.length);for(let r=0;r<n.length-1;++r)n[r]=Math.floor(t/e[r]),t-=n[r]*e[r];return n[n.length-1]=t,n}static normalizeAxis(t,e){if(t<-e&&t>=e)throw new Error("unsupported axis for this operation.");return t<0?t+e:t}static normalizeAxes(t,e){return t.map((t=>this.normalizeAxis(t,e)))}static incrementIndex(t,e,r){if(0===e.length||0===t.length)throw new Error("Index incrementing unsupported for scalar Tensor");if(void 0===r)r=e.length;else if(r<=0||r>e.length)throw new Error("Incorrect axis to increment on");for(let n=r-1;n>=0&&(t[n]++,!(t[n]<e[n]));--n)t[n]=0}static calculateReshapedDims(e,r){if(0===r.length){if(0===e.length||1===t.size(e))return[];throw new Error("cannot reshape to a scalar Tensor")}let n=r.length,i=new Array(n),s=-1,o=1;for(let t=0;t<n;t++){if(r[t]<-1)throw new Error("a dimension in shape hints cannot be less than -1");if(-1===r[t]){if(-1!==s)throw new Error("at most one dimension in shape hints can be -1");s=t}else{if(0===r[t]){if(t>=e.length)throw new Error("the dimension with value zero exceeds the dimension size of the input tensor");i[t]=e[t]}else i[t]=r[t];o*=i[t]}}let a=t.size(e);if(-1!==s){if(a%o!=0)throw new Error(`the input tensor cannot be reshaped to the requested shape. Input shape: [${e}] Output shape: [${r}]`);i[s]=a/o}else if(o!==a)throw new Error("reshapedDims and originalDims don't have matching sizes");return i}static sortBasedOnPerm(t,e){return e?e.map((e=>t[e])):t.slice().reverse()}static padShape(t,e){let r=t.length;return t.map(((t,n)=>t+e[n]+e[n+r]))}static areEqual(t,e){return t.length===e.length&&t.every(((t,r)=>t===e[r]))}static validateDimsAndCalcSize(t){if(t.length>6)throw new TypeError("Only rank 0 to 6 is supported for tensor shape.");let e=1;for(let r of t){if(!Number.isInteger(r))throw new TypeError(`Invalid shape: ${r} is not an integer`);if(r<0||r>2147483647)throw new TypeError(`Invalid shape: length ${r} is not allowed`);e*=r}return e}static flattenShape(t,e){e<0&&(e+=t.length);let r=t.reduce(((t,e)=>t*e),1),n=t.slice(e).reduce(((t,e)=>t*e),1);return[r/n,n]}static squeezeShape(e,r){let n=new Array;r=t.normalizeAxes(r,e.length);for(let t=0;t<e.length;t++){let i=r.indexOf(t)>=0;if(i&&1!==e[t])throw new Error("squeeze an axis of size different than 1");(0===r.length&&e[t]>1||r.length>0&&!i)&&n.push(e[t])}return n}static unsqueezeShape(e,r){let n=new Array(e.length+r.length);n.fill(0);for(let e=0;e<r.length;e++){let i=t.normalizeAxis(r[e],n.length);if(i>=n.length)throw new Error("'axes' has an out of range axis");if(0!==n[i])throw new Error("'axes' has a duplicate axis");n[i]=1}let i=0;for(let t=0;t<n.length;t++)0===n[t]&&(n[t]=e[i++]);if(i!==e.length)throw new Error("the unsqueezed dimension could not be established");return n}},dn=class t{static splitShape(e,r,n,i){if(0===n.length){if(!i)throw new Error("need to know number of outputs when the 'split' attribute is not specified");t.determineSplit(e[r],i,n)}let s=[],o=[0];for(let t=0;t<n.length;++t){0!==t&&o.push(o[t-1]+n[t-1]);let i=e.slice();i[r]=n[t],s.push(i)}return[s,o]}static determineSplit(t,e,r){if(t%e!=0)throw new Error("cannot split tensor to equal sized parts");for(let n=0;n<e;++n)r.push(t/e)}},vr=class t{static adjustPoolAttributes(t,e,r,n,i,s){if(!t&&r.length!==e.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let t=0;t<e.length-2;t++)t>=r.length?r.push(e[t+2]):r[t]=e[t+2];for(let t=0;t<r.length;t++)if(t<n.length){if(n[t]<0)throw new Error("strides should be greater than or equal to 1")}else n.push(1);for(let t=0;t<r.length;t++)if(t<i.length){if(i[t]<0)throw new Error("dilations should be greater than or equal to 1")}else i.push(1);for(let t=0;t<2*r.length;t++)if(t<s.length){if(s[t]<0)throw new Error("pad should be greater than or equal to 1")}else s.push(0);for(let t=0;t<r.length;t++){if(r[t]<=0)throw new Error("kernel shapes need to be greater than 0");if(s[t]>=r[t]||s[t+r.length]>=r[t])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(e,r,n,i,s,o){if(o){if(s.length!==2*(e.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(r.length!==e.length-2)throw new Error("length of strides should be the length of data dimensions");if(i.length!==e.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let a=0;a<e.length-2;a++)t.adjustPadAndReturnShape(e[a+2],r[a],n[a],i[a],s,a,a+e.length-2,o)}}static computePoolOutputShape(e,r,n,i,s,o,a){if(r.length<=0)throw new Error("input shape must be of size greater than 0");let u=[r[0],r[1]];return t.computeShapeHelper(e,r,u,n,i,s,o,a),u}static computeConvOutputShape(e,r,n,i,s,o,a){if(e.length<=0||r.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let u=[e[0],r[0]];return t.computeShapeHelper(!1,e,u,n,i,s,o,a),u}static computeShapeHelper(e,r,n,i,s,o,a,u){if(e)for(let t=0;t<r.length-2;t++)n.push(1);else for(let e=0;e<r.length-2;e++)n.push(t.adjustPadAndReturnShape(r[e+2],i[e],s[e],o[e],a,e,e+r.length-2,u))}static adjustPadAndReturnShape(t,e,r,n,i,s,o,a){let u=r*(n-1)+1;if(!a||"NOTSET"===a)return Math.floor((t+i[s]+i[o]-u)/e+1);switch(a){case"VALID":return i[s]=0,i[o]=0,Math.floor((t-u)/e+1);case"SAME_LOWER":case"SAME_UPPER":if(1!==r)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let r=((t+e-1)/e-1)*e+n-t;return i[s]=Math.floor("SAME_LOWER"===a?(r+1)/2:r/2),i[o]=r-i[s],Math.floor((t+r-n)/e+1)}default:throw new Error("Unsupported AutoPad type")}}},_r=-34028234663852886e22,Or=34028234663852886e22}));function rh(t){switch(t){case"bool":case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;case"float64":return 8;default:throw new Error(`cannot calculate sizeof() on type ${t}`)}}function Gu(t){switch(t){case ne.onnx.TensorProto.DataType.UINT8:case ne.onnx.TensorProto.DataType.INT8:case ne.onnx.TensorProto.DataType.BOOL:return 1;case ne.onnx.TensorProto.DataType.UINT16:case ne.onnx.TensorProto.DataType.INT16:return 2;case ne.onnx.TensorProto.DataType.FLOAT:case ne.onnx.TensorProto.DataType.INT32:case ne.onnx.TensorProto.DataType.UINT32:return 4;case ne.onnx.TensorProto.DataType.INT64:case ne.onnx.TensorProto.DataType.DOUBLE:case ne.onnx.TensorProto.DataType.UINT64:return 8;default:throw new Error(`cannot calculate sizeof() on type ${ne.onnx.TensorProto.DataType[t]}`)}}function nh(t,e){return new(Wu(e))(t)}function Wu(t){switch(t){case"bool":case"uint8":return Uint8Array;case"int8":return Int8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"float32":return Float32Array;case"float64":return Float64Array;default:throw new Error("unspecified error")}}function vi(t,e){if(e===ne.onnx.TensorProto.DataType.INT64||e===wi.TensorDataType.INT64){if(t.greaterThanOrEqual(2147483648)||t.lessThan(-2147483648))throw new TypeError("int64 is not supported")}else{if(e!==ne.onnx.TensorProto.DataType.UINT32&&e!==wi.TensorDataType.UINT32&&e!==ne.onnx.TensorProto.DataType.UINT64&&e!==wi.TensorDataType.UINT64)throw new TypeError(`not a LONG type: ${ne.onnx.TensorProto.DataType[e]}`);if(t.greaterThanOrEqual(4294967296)||t.lessThan(0))throw new TypeError("uint64 is not supported")}return t.toNumber()}function Uu(t,e,r){switch(e){case ne.onnx.TensorProto.DataType.BOOL:case ne.onnx.TensorProto.DataType.UINT8:return t.getUint8(r);case ne.onnx.TensorProto.DataType.INT8:return t.getInt8(r);case ne.onnx.TensorProto.DataType.UINT16:return t.getUint16(r,!0);case ne.onnx.TensorProto.DataType.INT16:return t.getInt16(r,!0);case ne.onnx.TensorProto.DataType.FLOAT:return t.getFloat32(r,!0);case ne.onnx.TensorProto.DataType.INT32:return t.getInt32(r,!0);case ne.onnx.TensorProto.DataType.UINT32:return t.getUint32(r,!0);case ne.onnx.TensorProto.DataType.INT64:return vi(Yt.fromBits(t.getUint32(r,!0),t.getUint32(r+4,!0),!1),e);case ne.onnx.TensorProto.DataType.DOUBLE:return t.getFloat64(r,!0);case ne.onnx.TensorProto.DataType.UINT64:return vi(Yt.fromBits(t.getUint32(r,!0),t.getUint32(r+4,!0),!0),e);default:throw new Error(`cannot read from DataView for type ${ne.onnx.TensorProto.DataType[e]}`)}}var zu,ne,wi,Be,Sr=D((()=>{zu=Nr(Ls()),ai(),ln(),ne=Nr(Ur()),fe(),wi=H.experimental.fbs,Be=class t{constructor(t,e,r,n,i,s=zu.Guid.create()){this.dims=t,this.type=e,this.dataProvider=r,this.asyncDataProvider=n,this.cache=i,this.dataId=s,this.size=z.validateDimsAndCalcSize(t);let o=this.size,a=void 0===r&&void 0===n&&void 0===i;if(void 0!==i&&i.length!==o)throw new RangeError("Input dims doesn't match data length.");if("string"===e){if(!(void 0===i||Array.isArray(i)&&i.every((t=>"string"==typeof t))))throw new TypeError("cache should be a string array");a&&(this.cache=new Array(o))}else{if(void 0!==i){let t=Wu(e);if(!(i instanceof t))throw new TypeError(`cache should be type ${t.name}`)}if(a){let t=new ArrayBuffer(o*rh(e));this.cache=nh(t,e)}}}get data(){if(void 0===this.cache){let t=this.dataProvider(this.dataId);if(t.length!==this.size)throw new Error("Length of data provided by the Data Provider is inconsistent with the dims of this Tensor.");this.cache=t}return this.cache}get stringData(){if("string"!==this.type)throw new TypeError("data type is not string");return this.data}get integerData(){switch(this.type){case"uint8":case"int8":case"uint16":case"int16":case"int32":case"uint32":case"bool":return this.data;default:throw new TypeError("data type is not integer (uint8, int8, uint16, int16, int32, uint32, bool)")}}get floatData(){switch(this.type){case"float32":case"float64":return this.data;default:throw new TypeError("data type is not float (float32, float64)")}}get numberData(){if("string"!==this.type)return this.data;throw new TypeError("type cannot be non-number (string)")}get(t){return this.data[z.indicesToOffset(t,this.strides)]}set(t,e){this.data[z.indicesToOffset(t,this.strides)]=e}async getData(){return void 0===this.cache&&(this.cache=await this.asyncDataProvider(this.dataId)),this.cache}get strides(){return this._strides||(this._strides=z.computeStrides(this.dims)),this._strides}static fromProto(e){if(!e)throw new Error("cannot construct Value from an empty tensor");let r=Ve.tensorDataTypeFromProto(e.dataType),n=Ve.tensorDimsFromProto(e.dims),i=new t(n,r);if("string"===r)e.stringData.forEach(((t,e)=>{i.data[e]=hn(t)}));else if(e.rawData&&"number"==typeof e.rawData.byteLength&&e.rawData.byteLength>0){let t=i.data,r=new DataView(e.rawData.buffer,e.rawData.byteOffset,e.rawData.byteLength),n=Gu(e.dataType),s=e.rawData.byteLength/n;if(e.rawData.byteLength%n!=0)throw new Error("invalid buffer length");if(t.length!==s)throw new Error("buffer length mismatch");for(let i=0;i<s;i++){let s=Uu(r,e.dataType,i*n);t[i]=s}}else{let t;switch(e.dataType){case ne.onnx.TensorProto.DataType.FLOAT:t=e.floatData;break;case ne.onnx.TensorProto.DataType.INT32:case ne.onnx.TensorProto.DataType.INT16:case ne.onnx.TensorProto.DataType.UINT16:case ne.onnx.TensorProto.DataType.INT8:case ne.onnx.TensorProto.DataType.UINT8:case ne.onnx.TensorProto.DataType.BOOL:t=e.int32Data;break;case ne.onnx.TensorProto.DataType.INT64:t=e.int64Data;break;case ne.onnx.TensorProto.DataType.DOUBLE:t=e.doubleData;break;case ne.onnx.TensorProto.DataType.UINT32:case ne.onnx.TensorProto.DataType.UINT64:t=e.uint64Data;break;default:throw new Error("unspecific error")}if(null==t)throw new Error("failed to populate data from a tensorproto value");let r=i.data;if(r.length!==t.length)throw new Error("array length mismatch");for(let n=0;n<t.length;n++){let i=t[n];Yt.isLong(i)?r[n]=vi(i,e.dataType):r[n]=i}}return i}static fromData(e,r,n){return new t(r,n,void 0,void 0,e)}static fromOrtTensor(e){if(!e)throw new Error("cannot construct Value from an empty tensor");let r=Ve.tensorDimsFromORTFormat(e),n=Ve.tensorDataTypeFromProto(e.dataType()),i=new t(r,n);if("string"===n)for(let t=0;t<e.stringDataLength();t++)i.data[t]=e.stringData(t);else if(e.rawDataArray()&&"number"==typeof e.rawDataLength()&&e.rawDataLength()>0){let t=i.data,r=new DataView(e.rawDataArray().buffer,e.rawDataArray().byteOffset,e.rawDataLength()),n=Gu(e.dataType()),s=e.rawDataLength()/n;if(e.rawDataLength()%n!=0)throw new Error("invalid buffer length");if(t.length!==s)throw new Error("buffer length mismatch");for(let i=0;i<s;i++){let s=Uu(r,e.dataType(),i*n);t[i]=s}}return i}}}));function Y(t){return 1===t?oh:ih}function Vu(t){let e=Y(t);return`${e.version}\n      precision highp float;\n      ${e.attribute} vec3 position;\n      ${e.attribute} vec2 textureCoord;\n\n      ${e.varyingVertex} vec2 TexCoords;\n\n      void main()\n      {\n          gl_Position = vec4(position, 1.0);\n          TexCoords = textureCoord;\n      }`}function Hu(t){let e=Y(t);return`${e.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${e.varyingFrag} vec2 TexCoords;\n    ${e.outputDeclaration}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    // Custom vector types to handle higher dimenalities.\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    `}function ju(t,e){return`\n  void main() {\n    int indices[${e}];\n    toVec(TexCoords, indices);\n    vec4 result = vec4(process(indices));\n    ${Y(t).output} = result;\n  }\n  `}var oh,ih,ve=D((()=>{oh={version:"",attribute:"attribute",varyingVertex:"varying",varyingFrag:"varying",texture2D:"texture2D",output:"gl_FragColor",outputDeclaration:""},ih={version:"#version 300 es",attribute:"in",varyingVertex:"out",varyingFrag:"in",texture2D:"texture",output:"outputColor",outputDeclaration:"out vec4 outputColor;"}})),ae=D((()=>{}));async function _i(t,e=t=>0,r){return new Promise(((n,i)=>{let s=0,o=()=>{if(t())return void n();s++;let a=e(s);null!=r&&s>=r?i():setTimeout(o,a)};o()}))}function no(t){return zr(typeof t<"u"&&0!==t.length,(()=>"empty string found for sampler name")),"get"+t.charAt(0).toUpperCase()+t.slice(1)}function qu(t){return zr(typeof t<"u"&&0!==t.length,(()=>"empty string found for sampler name")),"get"+t.charAt(0).toUpperCase()+t.slice(1)+"AtOutCoords"}function Wr(t,e){let r=JSON.parse(JSON.stringify(t));return r=e,r}function Vr(t,e){return e.map((e=>t[e])).join(", ")}function Ke(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function Et(t=6){return["x","y","z","w","u","v"].slice(0,t)}var Rt=D((()=>{fe()}));function ah(t,e){return Et(e).map((e=>`${t}.${e}`))}function Hr(t,e){return 1===e?[t]:ah(t,e)}function Mt(){return"\n    float getChannel(vec4 frag, int dim) {\n      int modCoord = imod(dim, 2);\n      return modCoord == 0 ? frag.r : frag.g;\n    }\n\n    float getChannel(vec4 frag, vec2 innerDims) {\n      vec2 modCoord = mod(innerDims, 2.);\n      return modCoord.x == 0. ?\n        (modCoord.y == 0. ? frag.r : frag.g) :\n        (modCoord.y == 0. ? frag.b : frag.a);\n    }\n  "}var Ir=D((()=>{Rt()}));function uh(t,e,r){if(0===t)return"false";if(1===t)return`rc > ${e[0]}`;let n="";for(let i=t-2;i<t;i++)n+=`${r[i]} >= ${e[i-t+2]}`,i<t-1&&(n+="||");return n}function lh(t,e){let r=t.length;if(0===r)return"getA(), 0, 0, 0";if(1===r)return`getA(rc),\n            rc + 1 >= ${t[0]} ? 0. : getA(rc + 1),\n            0, 0`;let n="";if(r>2)for(let t=0;t<r-2;++t)n+=`${e[t]},`;return`getA(${n}r, c),\n          rEdge ? 0. : getA(${n}rp1, c),\n          cEdge ? 0. : getA(${n}r, cp1),\n          rEdge || cEdge ? 0. : getA(${n}rp1, cp1)`}function fh(t,e,r,n){return 0===t||1===t?"":`\n    int r = ${e[t-2]};\n    int c = ${e[t-1]};\n    int rp1 = ${e[t-2]} + 1;\n    int cp1 = ${e[t-1]} + 1;\n    bool rEdge = rp1 >= ${n};\n    bool cEdge = cp1 >= ${r};\n    `}var Yu,sh,Xu,Ku=D((()=>{ve(),ae(),Rt(),Ir(),Yu={name:"pack",inputNames:["A"],inputTypes:[1]},sh=(t,e)=>{let r,n=Y(t.session.backend.glContext.version),i=e.dims,s=i.length,o=e.dims.length,a=Ke(o),u=Hr("rc",o),l=fh(o,u,i[i.length-2],i[i.length-1]);r=0===s?[1,1]:1===s?[i[0],1]:[i[o-1],i[o-2]];let c=uh(o,r,u),h=lh(i,u),f=`\n        void main() {\n          ${a} rc = getOutputCoords();\n\n          if(${c}) {\n            ${n.output} = vec4(0);\n          } else {\n            ${l}\n\n            ${n.output} = vec4(${h});\n          }\n        }\n      `;return{...Yu,hasMain:!0,output:{dims:e.dims,type:e.type,textureType:2},shaderSource:f}},Xu=(t,e)=>({...Yu,get:()=>sh(t,e)})}));function Oi(t){if(0===t.length)return[1,1,1];let e=1;for(let r=0;r<t.length-2;++r)e*=t[r];return[e,t.length>1?t[t.length-2]:1,t[t.length-1]]}function Zu(t,e){let r=!1;return r=0===t.length||0===e.length||(t.length<2||e.length<2?t[t.length-1]===e[e.length-1]:t[t.length-1]===e[e.length-1]&&t[t.length-2]===e[e.length-2]),r}function dh(t){let e=z.computeStrides(t),r=["b","r","c"],n="index";return`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${e.map(((t,i)=>`${`int ${r[i]} = ${n} / ${t}`}; ${i===e.length-1?`int ${r[i+1]} = ${n} - ${r[i]} * ${t}`:`index -= ${r[i]} * ${t}`};`)).join("")}\n      return ivec3(b, r, c);\n    }\n  `}function hh(t){let e=z.computeStrides(t);return`\n  int getFlattenedIndex(ivec3 coords) {\n    // reverse y, z order\n    return coords.x * ${e[0]} + coords.z * ${e[1]} + coords.y;\n  }\n`}var ch,ph,Ju,Qu=D((()=>{fe(),ve(),ae(),Ir(),ch=t=>({name:"Reshape (packed)",inputTypes:[2],inputNames:["A"],cacheHint:`${t}`}),ph=(t,e,r,n)=>{let i=e.dims,s=n,o="";for(let t=0;t<4;t++){let e="";switch(t){case 0:e="outputCoords = rc;";break;case 1:e="outputCoords = ivec3(rc.x, rc.y+1, rc.z);";break;case 2:e="outputCoords = ivec3(rc.x, rc.y, rc.z+1);";break;case 3:e="outputCoords = ivec3(rc.x, rc.y+1, rc.z+1);";break;default:throw new Error}o+=`\n        ${e}\n        ${t>0?"if(outputCoords.y < rows && outputCoords.z < cols){":""}\n          int flattenedIndex = getFlattenedIndex(outputCoords);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flattenedIndex);\n          vec2 innerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${t}] = getChannel(getA(inputRC.x, inputRC.y, inputRC.z), innerDims);\n\n        ${t>0?"}":""}\n      `}let a=Y(t.session.backend.glContext.version),u=`\n      ${dh(i)}\n      ${hh(s)}\n      ${Mt()}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.0);\n\n        ivec3 outputCoords;\n        int rows = ${s[2]};\n        int cols = ${s[1]};\n\n        ${o}\n        ${a.output} = result;\n      }\n    `;return{...r,output:{dims:s,type:e.type,textureType:2},shaderSource:u,hasMain:!0}},Ju=(t,e,r)=>{let n=ch(r);return{...n,get:()=>ph(t,e,n,r)}}})),Si,el=D((()=>{ve(),ae(),Si=(t,e)=>{let r=e.shape,n=Y(t.session.backend.glContext.version),i=`\n    const float FLOAT_MAX = 1.70141184e38;\n    const float FLOAT_MIN = 1.17549435e-38;\n\n    bool isNaN(float val) {\n      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;\n    }\n\n    highp vec4 encodeAsUint8(highp float v) {\n      if (isNaN(v)) {\n        return vec4(255, 255, 255, 255);\n      }\n\n      highp float av = abs(v);\n\n      if(av < FLOAT_MIN) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n      } else if(v > FLOAT_MAX) {\n        return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n      } else if(v < -FLOAT_MAX) {\n        return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n      }\n\n      highp vec4 c = vec4(0,0,0,0);\n\n      highp float e = floor(log2(av));\n      highp float m = exp2(fract(log2(av))) - 1.0;\n\n      c[2] = floor(128.0 * m);\n      m -= c[2] / 128.0;\n      c[1] = floor(32768.0 * m);\n      m -= c[1] / 32768.0;\n      c[0] = floor(8388608.0 * m);\n\n      highp float ebias = e + 127.0;\n      c[3] = floor(ebias / 2.0);\n      ebias -= c[3] * 2.0;\n      c[2] += floor(ebias) * 128.0;\n\n      c[3] += 128.0 * step(0.0, -v);\n\n      return c / 255.0;\n    }\n\n    void main() {\n      float value = ${n.texture2D}(X,TexCoords).r;\n      ${n.output} = encodeAsUint8(value);\n    }`,s={name:"Uint8Encode",inputTypes:[0],inputNames:["X"],output:{dims:r,type:e.tensor.type,textureType:3},shaderSource:i,hasMain:!0};return t.executeProgram(s,[e.tensor])}}));function bh(t,e){if(1===t)return"rc";let r="";for(let n=0;n<t;n++)r+=e[n],n<t-1&&(r+=",");return r}var tl,mh,rl,nl=D((()=>{ve(),ae(),Rt(),Ir(),tl={name:"unpack",inputNames:["A"],inputTypes:[2]},mh=(t,e)=>{let r=e.dims.length,n=Hr("rc",r),i=n.slice(-2),s=Ke(r),o=Mt(),a=0===e.dims.length?"":bh(r,n),u=r<=1?"rc":`vec2(${i.join(",")})`,l=`\n    ${o}\n    void main() {\n      ${s} rc = getOutputCoords();\n\n       // Sample the texture with the coords to get the rgba channel value.\n       vec4 packedInput = getA(${a});\n\n       ${Y(t.session.backend.glContext.version).output} = vec4(getChannel(packedInput, ${u}), 0, 0, 0);\n     }\n   `;return{...tl,hasMain:!0,output:{dims:e.dims,type:e.type,textureType:0},shaderSource:l}},rl=(t,e)=>({...tl,get:()=>mh(t,e)})})),oo,mn,io,bn=D((()=>{pt(),oo=class{constructor(t,e=1){if(1===e)this.internalFormat=t.R32F,this.format=t.RED,this.textureType=t.FLOAT,this.channelSize=e;else{if(4!==e)throw new Error(`Invalid number of channels: ${e}`);this.internalFormat=t.RGBA32F,this.format=t.RGBA,this.textureType=t.FLOAT,this.channelSize=e}}encode(t,e){let r,n;return t.constructor!==Float32Array&&(pe.warning("Encoder","data was not of type Float32; creating new Float32Array"),n=new Float32Array(t)),e*this.channelSize>t.length?(pe.warning("Encoder","Source data too small. Allocating larger array"),n=t,r=this.allocate(e*this.channelSize),n.forEach(((t,e)=>r[e]=t))):(n=t,r=n),r}allocate(t){return new Float32Array(4*t)}decode(t,e){return 1===this.channelSize?t.filter(((t,e)=>e%4==0)).subarray(0,e):t.subarray(0,e)}},mn=class{constructor(t,e=1,r){if(1!==e&&4!==e)throw new Error(`Invalid number of channels: ${e}`);this.internalFormat=t.RGBA,this.format=t.RGBA,this.channelSize=e,this.textureType=r||t.FLOAT}encode(t,e){let r=t;return 1===this.channelSize&&(pe.verbose("Encoder","Exploding into a larger array"),r=this.allocate(e),t.forEach(((t,e)=>r[4*e]=t))),r}allocate(t){return new Float32Array(4*t)}decode(t,e){return 1===this.channelSize?t.filter(((t,e)=>e%4==0)).subarray(0,e):t.subarray(0,e)}},io=class{constructor(t,e=1){if(this.channelSize=4,1===e)this.internalFormat=t.ALPHA,this.format=t.ALPHA,this.textureType=t.UNSIGNED_BYTE,this.channelSize=e;else{if(4!==e)throw new Error(`Invalid number of channels: ${e}`);this.internalFormat=t.RGBA,this.format=t.RGBA,this.textureType=t.UNSIGNED_BYTE,this.channelSize=e}}encode(t,e){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}allocate(t){return new Uint8Array(t*this.channelSize)}decode(t,e){if(t instanceof Uint8Array)return t.subarray(0,e);throw new Error(`Invalid array type: ${t.constructor}`)}}})),gn,ol,Ii,il=D((()=>{fe(),ae(),gn=(t,e,r)=>{let n=0===r||1===r?1:4,i=2===r,s=1===r||2===r,o=4===r?e.length-1:void 0,a=4===r?e.map(((t,r)=>r===e.length-1?4*t:t)):void 0;return Ii(t,e,n,a,{isPacked:i,reverseWH:s,breakAxis:o})},ol=(t,e,r)=>{let n=gn(t,e,r);return[n.width,n.height]},Ii=(t,e,r=1,n,i)=>{let s=!(!i||!i.isPacked),[o,a]=t.computeTextureWH(s&&n||e,i),u=e.length,l=e.slice(0);if(0===u&&(l=[1]),1===r)n=e;else if(s){if(4!==r)throw new Error("a packed texture must be 4-channel");n=e,u>0&&(l[u-1]=Math.ceil(l[u-1]/2)),u>1&&(l[u-2]=Math.ceil(l[u-2]/2))}else if(!n)throw new Error("Unpacked shape is needed when using channels > 1");return{width:o,height:a,channels:r,isPacked:s,shape:l,strides:z.computeStrides(l),unpackedShape:n,reversedWH:i&&i.reverseWH}}})),yh,ao,sl=D((()=>{pt(),Sr(),fe(),Ku(),Qu(),el(),nl(),bn(),il(),ae(),yh=(t,e)=>{let r=e.map((t=>`${t.unpackedShape.join(",")};${t.width}x${t.height}`)).join("_"),n=t.name;return t.cacheHint&&(n+="["+t.cacheHint+"]"),n+=":"+r,n},ao=class{constructor(t){this.session=t,this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map}calculateTextureWidthAndHeight(t,e){return ol(this.session.layoutStrategy,t,e)}executeProgram(t,e){if(e.length<t.inputNames.length)throw new Error(`Input size mustn't be less than ${t.inputNames.length}.`);if(t.inputNames.length!==t.inputTypes.length)throw new Error("input names size does not match input types");let r=[];for(let n=0;n<t.inputNames.length;++n)r[n]=this.getOrCreateTextureData(e[n],t.inputTypes[n]);let n=yh(t,r),i=this.session.programManager.getArtifact(n),s=i?i.programInfo:"function"==typeof t.get?t.get():t,o=gn(this.session.layoutStrategy,s.output.dims,s.output.textureType),a=this.createTextureData(o,s.output.type);return i||(i=this.session.programManager.build(s,r,a),this.session.programManager.setArtifact(n,i)),this.runProgram(i,r,a),a}run(t,e){return this.executeProgram(t,e).tensor}runProgram(t,e,r){for(let r=0;r<e.length;++r)if(!!e[r].isPacked!=(2===t.programInfo.inputTypes[r]))throw new Error(`input[${r}] property packed inconsistent`);if(!!r.isPacked!=(2===t.programInfo.output.textureType))throw new Error("output property packed inconsistent");this.session.programManager.run(t,e,r)}getOrCreateTextureData(t,e){let r=this.getTextureData(t.dataId,2===e);if(!r&&(r=this.getTextureData(t.dataId,2!==e),r))return 2===e?this.pack(r):this.unpack(r);if(!r){let n=gn(this.session.layoutStrategy,t.dims,e);if(4===e){let r=t.dims;if(4===r.length){let n=[r[0],Math.ceil(r[1]*r[2]*r[3]/4)],i=gn(this.session.layoutStrategy,n,e),s=t.numberData;if(r[1]*r[2]*r[3]%4!=0){let e=r[0],n=r[1]*r[2]*r[3],i=4*Math.ceil(1*n/4);s=new Float32Array(e*i);for(let r=0;r<e;++r){let e=r*n,o=r*i+r%1*n;s.set(t.numberData.subarray(e,e+n),o)}}return this.createTextureData(i,t.type,s,t,1)}}if(2===e){let e=Ii(this.session.layoutStrategy,t.dims,1,[],{reverseWH:!0}),n=this.createTextureData(e,t.type,t.numberData,t,1);r=this.pack(n)}else r=this.createTextureData(n,t.type,t.numberData,t,1)}return r}createTextureDataFromLayoutBindTensor(t,e,r,n){return this.createTextureData(t,e,r,n,1)}createTextureData(t,e,r,n,i){pe.verbose("InferenceHandler",`Creating TextureData: layout:[${JSON.stringify(t)}]`);let s=this.session.textureManager.createTextureFromLayout(e,t,r,i);return this.createTextureDataFromTexture(t,e,s,n)}reshapeUnpacked(t,e){let r=this.getOrCreateTextureData(t,0),n={channels:r.channels,height:r.height,width:r.width,shape:0!==e.length?e:[1],strides:z.computeStrides(e),unpackedShape:e};return this.createTextureDataFromTexture(n,t.type,r.texture).tensor}reshapePacked(t,e){let r=this.getOrCreateTextureData(t,2);if(Zu(t.dims,e)){let n={channels:r.channels,height:r.height,width:r.width,shape:0!==e.length?e:[1],strides:z.computeStrides(e),unpackedShape:e,isPacked:!0};return this.createTextureDataFromTexture(n,t.type,r.texture).tensor}let n=Oi(t.dims),i=Oi(e),s=this.reshapePacked(t,n),o=this.run(Ju(this,s,i),[s]);return this.reshapePacked(o,e)}cast(t,e){let r=this.getOrCreateTextureData(t,0);return this.createTextureDataFromTexture(r,e,r.texture).tensor}createTextureDataFromTexture(t,e,r,n,i){let s={...t,tensor:n||new Be(t.unpackedShape,e,(t=>this.readTexture(s)),(async t=>this.readTextureAsync(s)),void 0,i),texture:r};return this.setTextureData(s.tensor.dataId,s,t.isPacked),s}getTextureData(t,e=!1){return this.session.isInitializer(t)?this.session.getTextureData(t,e):e?this.packedTextureDataCache.get(t):this.unpackedTextureDataCache.get(t)}setTextureData(t,e,r=!1){this.session.isInitializer(t)?this.session.setTextureData(t,e,r):(r?this.packedTextureDataCache:this.unpackedTextureDataCache).set(t,e)}isTextureLayoutCached(t,e=!1){return!!this.getTextureData(t.dataId,e)}dispose(){this.session.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach((t=>this.session.textureManager.releaseTexture(t))),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach((t=>this.session.textureManager.releaseTexture(t))),this.unpackedTextureDataCache=new Map}readTexture(t){return t.isPacked?this.readTexture(this.unpack(t)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTexture(t,t.tensor.type,t.channels):this.session.textureManager.readUint8TextureAsFloat(Si(this,t))}async readTextureAsync(t){return t.isPacked?this.readTextureAsync(this.unpack(t)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTextureAsync(t,t.tensor.type,t.channels):this.session.textureManager.readUint8TextureAsFloat(Si(this,t))}pack(t){return this.executeProgram(Xu(this,t.tensor),[t.tensor])}unpack(t){return this.executeProgram(rl(this,t.tensor),[t.tensor])}}})),Ai,re,Me=D((()=>{Ai=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map((t=>`${this[t]}`)).join(";")),this.key}},re=t=>new Ai(t)})),ul,ll,fl,Th,xh,cl=D((()=>{Me(),ve(),ae(),ul={name:"BatchNormalization",inputNames:["A","Scale","B","Mean","Variance"],inputTypes:[0,0,0,0,0]},ll=(t,e,r)=>(xh(e),[t.run({...ul,cacheHint:r.cacheKey,get:()=>Th(t,e,r)},e)]),fl=t=>{let e=t.attributes.getFloat("epsilon",1e-5),r=t.attributes.getFloat("momentum",.9),n=t.attributes.getInt("spatial",1);return re({epsilon:e,momentum:r,spatial:n})},Th=(t,e,r)=>{let n=Y(t.session.backend.glContext.version),i=e[0].dims.length,[s,o]=t.calculateTextureWidthAndHeight(e[1].dims,0),a=`\n  float process(int[${i}] indices) {\n    vec2 position = offsetToCoords(indices[1], ${s}, ${o});\n    float scale = getColorAsFloat(${n.texture2D}(Scale, position));\n    float mean = getColorAsFloat(${n.texture2D}(Mean, position));\n    float variance = getColorAsFloat(${n.texture2D}(Variance, position));\n    float b = getColorAsFloat(${n.texture2D}(B, position));\n\n    return scale * ( (_A(indices) - mean) / sqrt(variance + float(${r.epsilon})) ) + b;\n  }`;return{...ul,output:{dims:e[0].dims,type:e[0].type,textureType:0},shaderSource:a}},xh=t=>{if(!t||5!==t.length)throw new Error("BatchNormalization requires 5 inputs.");let e=t[0],r=t[1],n=t[2],i=t[3],s=t[4];if(e.dims.length<3||1!==r.dims.length||1!==n.dims.length||1!==i.dims.length||1!==s.dims.length)throw new Error("invalid input shape.");if(r.dims[0]!==e.dims[1]||n.dims[0]!==e.dims[1]||i.dims[0]!==e.dims[1]||s.dims[0]!==e.dims[1])throw new Error("invalid input shape.");if("float32"!==e.type&&"float64"!==e.type||"float32"!==r.type&&"float64"!==r.type||"float32"!==n.type&&"float64"!==n.type||"float32"!==i.type&&"float64"!==i.type||"float32"!==s.type&&"float64"!==s.type)throw new Error("invalid input tensor types.")}})),so,bt,G,yn,uo,Xt=D((()=>{so=class{constructor(t,e,r,n){this.glContext=t,this.programInfo=e,this.inputTextureLayouts=r,this.outputTextureLayout=n}},bt=class{constructor(t){this.context=t}},G=class{constructor(t,e){this.routineBody=t,this.dependencies=e}},yn=class{constructor(t,e,r){this.name=t,this.dependencies=r||[],e&&(this.routineBody=e)}addDependency(t){t&&this.dependencies.push(t)}},uo=class{static returnOrderedNodes(t){if(!t||0===t.length)return[];if(1===t.length)return t;let e=new Set,r=new Set,n=new Array;return this.createOrderedNodes(t,e,r,n),n}static createOrderedNodes(t,e,r,n){for(let i=0;i<t.length;++i)this.dfsTraverse(t[i],e,r,n)}static dfsTraverse(t,e,r,n){if(!t||r.has(t.name))return;if(e.has(t.name))throw new Error("Cyclic dependency detected. Can't topologically sort routines needed for shader.");e.add(t.name);let i=t.dependencies;if(i&&i.length>0)for(let t=0;t<i.length;++t)this.dfsTraverse(i[t],e,r,n);n.push(t),r.add(t.name),e.delete(t.name)}}}));function vh(){let t="add_";return{body:`\n  float ${t}(float a, float b) {\n    return a + b;\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    return v1 + v2;\n  }\n  `,name:t,type:0}}function _h(){let t="div_";return{body:`\n  float ${t}(float a, float b) {\n    return a / b;\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    return v1 / v2;\n  }\n  `,name:t,type:0}}function Oh(){let t="mul_";return{body:`\n  float ${t}(float a, float b) {\n    return a * b;\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    return v1 * v2;\n  }\n  `,name:t,type:0}}function Sh(){let t="sub_";return{body:`\n  float ${t}(float a, float b) {\n    return a - b;\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    return v1 - v2;\n  }\n  `,name:t,type:0}}function Ih(){let t="equal_";return{body:`\n  float ${t}(float a, float b) {\n    return float(a == b);\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    return vec4(equal(v1, v2));\n  }\n  `,name:t,type:0}}function Ah(){let t="greater_";return{body:`\n  float ${t}(float a, float b) {\n    return float(a > b);\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    return vec4( v1.r > v2.r ,\n      v1.g > v2.g,\n      v1.b > v2.b,\n      v1.a > v2.a );\n  }\n  `,name:t,type:0}}function Eh(){let t="less_";return{body:`\n  float ${t}(float a, float b) {\n    return float(a < b);\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    return vec4( v1.r < v2.r ,\n                v1.g < v2.g,\n                v1.b < v2.b,\n                v1.a < v2.a );\n  }\n  `,name:t,type:0}}function Ph(){let t="and_";return{body:`\n  float ${t}(float a, float b) {\n    return float( bool(a) && bool(b) );\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    bvec4 b1 = bvec4(v1);\n    bvec4 b2 = bvec4(v2);\n    return vec4( b1.r && b2.r ,\n                b1.g && b2.g,\n                b1.b && b2.b,\n                b1.a && b2.a );\n  }\n  `,name:t,type:0}}function Dh(){let t="or_";return{body:`\n  float ${t}(float a, float b) {\n    return float( bool(a) || bool(b) );\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    bvec4 b1 = bvec4(v1);\n    bvec4 b2 = bvec4(v2);\n    return vec4( b1.r || b2.r ,\n                b1.g || b2.g,\n                b1.b || b2.b,\n                b1.a || b2.a );\n  }\n  `,name:t,type:0}}function Lh(){let t="xor_";return{body:`\n  float ${t}(float a, float b) {\n    return float( bool(a) ^^ bool(b) );\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    bvec4 b1 = bvec4(v1);\n    bvec4 b2 = bvec4(v2);\n    return vec4( b1.r ^^ b2.r ,\n                b1.g ^^ b2.g,\n                b1.b ^^ b2.b,\n                b1.a ^^ b2.a );\n  }\n  `,name:t,type:0}}function Ch(){return Bh("pow")}function Fh(){let t="prelu_";return{body:`\n  float ${t}(float a, float b) {\n    return a < 0.0 ? a * b: a;\n  }\n  vec4 ${t}(vec4 v1, vec4 v2) {\n    return vec4(\n      v1.r < 0.0 ? v1.r * v2.r: v1.r,\n      v1.g < 0.0 ? v1.g * v2.g: v1.g,\n      v1.b < 0.0 ? v1.b * v2.b: v1.b,\n      v1.a < 0.0 ? v1.a * v2.a: v1.a\n      );\n  }\n  `,name:t,type:0}}function Bh(t){let e=`${t}_`;return{body:`\n  float ${e}(float a, float b) {\n    return ${t}(a, b);\n  }\n  vec4 ${e}(vec4 v1, vec4 v2) {\n    return ${t}(v1, v2);\n  }\n  `,name:e,type:0}}var gt,$h,pl,dl,hl,ml,bl,gl,yl,Tl,xl,wl,vl,_l,Ol=D((()=>{fe(),Xt(),ve(),ae(),gt=(t,e,r,n=e[0].type,i)=>{let s=t.session.pack?2:0;return{name:r.name,inputNames:["A","B"],inputTypes:[s,s],cacheHint:i,get:()=>$h(t,e,r,n)}},$h=(t,e,r,n=e[0].type)=>{let i=t.session.pack?2:0,s=!z.areEqual(e[0].dims,e[1].dims),o=e[0].dims,a=t.session.pack;if(s){let s=Xe.calcShape(e[0].dims,e[1].dims,!1);if(!s)throw new Error("Can't perform binary op on the given tensors");o=s;let u=o.length,l=0!==e[0].dims.length?e[0].dims.length:1,c=0!==e[1].dims.length?e[1].dims.length:1,h=0!==e[0].dims.length?"bcastIndices_A(indices, aindices);":"aindices[0] = 0;",f=0!==e[1].dims.length?"bcastIndices_B(indices, bindices);":"bindices[0] = 0;",d=Y(t.session.backend.glContext.version),p=a?`\n      ${r.body}\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n        vec4 result = ${r.name}(a, b);\n        ${d.output} = result;\n      }`:`\n      ${r.body}\n      float process(int indices[${u}]) {\n        int aindices[${l}];\n        int bindices[${c}];\n        ${h}\n        ${f}\n        return ${r.name}(_A(aindices), _B(bindices));\n      }`;return{name:r.name,inputNames:["A","B"],inputTypes:[i,i],output:{dims:o,type:n,textureType:i},shaderSource:p,hasMain:a}}let u=Y(t.session.backend.glContext.version),l=`\n    ${r.body}\n    void main() {\n      vec4 v1 = ${u.texture2D}(A, TexCoords);\n      vec4 v2 = ${u.texture2D}(B, TexCoords);\n      vec4 result = ${r.name}(v1, v2);\n      ${u.output} = result;\n    }\n    `;return{name:r.name,inputNames:["A","B"],inputTypes:[i,i],output:{dims:e[0].dims,type:n,textureType:i},shaderSource:l,hasMain:!0}},pl=(t,e)=>[t.run(gt(t,e,vh()),e)],dl=(t,e)=>[t.run(gt(t,e,Ph(),"bool"),e)],hl=(t,e)=>[t.run(gt(t,e,_h()),e)],ml=(t,e)=>[t.run(gt(t,e,Ih(),"bool"),e)],bl=(t,e)=>[t.run(gt(t,e,Ah(),"bool"),e)],gl=(t,e)=>[t.run(gt(t,e,Eh(),"bool"),e)],yl=(t,e)=>[t.run(gt(t,e,Oh()),e)],Tl=(t,e)=>[t.run(gt(t,e,Dh(),"bool"),e)],xl=(t,e)=>[t.run(gt(t,e,Ch()),e)],wl=(t,e)=>[t.run(gt(t,e,Fh()),e)],vl=(t,e)=>[t.run(gt(t,e,Sh()),e)],_l=(t,e)=>[t.run(gt(t,e,Lh(),"bool"),e)]})),Sl,Il,Nh,Al=D((()=>{fe(),Sl=(t,e,r)=>(Nh(e),[t.cast(e[0],r)]),Il=t=>Ve.tensorDataTypeFromProto(t.attributes.getInt("to")),Nh=t=>{if(!t||1!==t.length)throw new Error("Cast requires 1 input.");if("string"===t[0].type)throw new Error("Invalid input type.")}})),Rh,Mh,El,lo,Pl=D((()=>{ve(),ae(),Rt(),Ir(),Rh=(t,e)=>({name:"Concat (packed)",inputNames:Array.from({length:t},((t,e)=>`X${e}`)),inputTypes:Array(t).fill(2),cacheHint:e}),Mh=(t,e,r,n)=>{let i=r[0].dims.slice();if(n>=i.length||n<-1*i.length)throw new Error("axis specified for concat doesn't match input dimensionality");n<0&&(n=i.length+n);let s=i.slice(0);for(let t=1;t<r.length;t++){let e=r[t].dims.slice();for(let t=0;t<i.length;t++)if(t===n)s[n]+=e[t];else if(i[t]!==e[t])throw new Error("non concat dimensions must match")}let o=s.length,a=Hr("coords",o),u=Ke(o),l=Mt(),c=r.map((t=>t.dims)),h=Et(o),f=new Array(c.length-1);f[0]=c[0][n];for(let t=1;t<f.length;t++)f[t]=f[t-1]+c[t][n];let d=h[n],p=h.slice(-2),v=h.join(),y=`if (${d} < ${f[0]}) {\n        return getChannel(\n            getX0(${v}), vec2(${p.join()}));\n        }`;for(let t=1;t<f.length;t++){let e=f[t-1];y+=`\n            if (${d} < ${f[t]}  && ${d} >= ${f[t-1]}) {\n              return getChannel(\n                getX${t}(${lo(h,d,e)}),\n                vec2(${lo(p,d,e)}));\n            }`}let b=f.length,_=f[f.length-1];y+=`\n            return getChannel(\n              getX${b}(${lo(h,d,_)}),\n              vec2(${lo(p,d,_)}));`;let m=Y(t.session.backend.glContext.version),g=`\n          ${l}\n          float getValue(${h.map((t=>"int "+t))}) {\n            ${y}\n          }\n\n          void main() {\n            ${u} coords = getOutputCoords();\n            int lastDim = coords.${h[o-1]};\n            coords.${h[o-1]} = coords.${h[o-2]};\n            coords.${h[o-2]} = lastDim;\n\n            vec4 result = vec4(getValue(${a}), 0., 0., 0.);\n\n            ${a[o-1]} = ${a[o-1]} + 1;\n            if (${a[o-1]} < ${s[o-1]}) {\n              result.g = getValue(${a});\n            }\n\n            ${a[o-2]} = ${a[o-2]} + 1;\n            if (${a[o-2]} < ${s[o-2]}) {\n              result.a = getValue(${a});\n            }\n\n            ${a[o-1]} = ${a[o-1]} - 1;\n            if (${a[o-2]} < ${s[o-2]} &&\n                ${a[o-1]} < ${s[o-1]}) {\n              result.b = getValue(${a});\n            }\n            ${m.output} = result;\n          }\n        `;return{...e,output:{dims:s,type:r[0].type,textureType:2},shaderSource:g,hasMain:!0}},El=(t,e,r)=>{let n=Rh(e.length,r.cacheKey);return{...n,get:()=>Mh(t,n,e,r.axis)}},lo=(t,e,r)=>{let n=t.indexOf(e);return t.map(((t,e)=>e===n?`${t} - ${r}`:t)).join()}})),Dl,Gh,Uh,zh,Ll,Wh,Vh,Hh,Cl,jh,Fl=D((()=>{Me(),ae(),Pl(),Dl=(t,e,r)=>(jh(e),t.session.pack&&e[0].dims.length>1?[t.run(El(t,e,r),e)]:[t.run(zh(t,e,r),e)]),Gh=(t,e)=>({name:"Concat",inputNames:Array.from({length:t},((t,e)=>`X${e}`)),inputTypes:Array(t).fill(0),cacheHint:e}),Uh=(t,e,r,n)=>{let i=r[0].dims.slice();if(n>=i.length||n<-1*i.length)throw new Error("axis specified for concat doesn't match input dimensionality");n<0&&(n=i.length+n);let s=i.slice(0);for(let t=1;t<r.length;t++){let e=r[t].dims.slice();for(let t=0;t<i.length;t++)if(t===n)s[n]+=e[t];else if(i[t]!==e[t])throw new Error("non concat dimensions must match")}let o=s.length,a=new Array(r.length),u=0;for(let t=0;t<a.length;++t)u+=r[t].dims[n],a[t]=u;let l="";l=r.length<5?Ll(a):Wh(a);let c=`\n        ${Vh(r.length,o)}\n        ${Hh(a)}\n        ${l}\n        float process(int indices[${o}]) {\n          int textureIndex = getTextureWhereDataResides (indices[${n}]);\n\n          if(textureIndex != 0) {\n            indices[${n}] = indices[${n}] - int(getSizeInConcatAxisValueFromIndex(textureIndex-int(1)));\n          }\n\n          return fetchDataFromCorrectTexture(textureIndex, indices);\n        }`;return{...e,output:{dims:s,type:r[0].type,textureType:0},shaderSource:c}},zh=(t,e,r)=>{let n=Gh(e.length,r.cacheKey);return{...n,get:()=>Uh(t,n,e,r.axis)}},Ll=t=>`int getTextureWhereDataResides(int index) {\n      ${t.map(((t,e)=>`if(index<${t}) {return ${e};}\n`)).join("")}\n    }`,Wh=t=>Ll(t),Vh=(t,e)=>{let r=[`float fetchDataFromCorrectTexture(int textureIndex, int indices[${e}]) {`];for(let e=0;e<t;++e)0===e?r.push(`\tif (textureIndex == ${e}) { return _X${e}(indices); }`):e===t-1?r.push(`\telse { return _X${e}(indices); }`):r.push(`\telse if (textureIndex == ${e}) { return _X${e}(indices); }`);return r.push("\t}"),r.join("\n")},Hh=t=>{let e=["int getSizeInConcatAxisValueFromIndex(int index) {"];for(let r=0;r<t.length;++r)0===r?e.push(`\tif (index == ${r}) { return ${t[r]}; }`):r===t.length-1?e.push(`\telse { return ${t[r]}; }`):e.push(`\telse if (index == ${r}) { return ${t[r]}; }`);return e.push("\t}"),e.join("\n")},Cl=t=>re({axis:t.attributes.getInt("axis")}),jh=t=>{if(!t||t.length<1)throw new Error("too few inputs");let e=t[0].type,r=t[0].dims.length;if("string"===e)throw new Error("string tensor is not supported yet");for(let n of t){if(n.type!==e)throw new Error("input tensors should be one type");if(n.dims.length!==r)throw new Error("input tensors should have the same shape")}}}));function qh(){return yt("abs")}function Yh(){return yt("acos")}function Xh(){return yt("asin")}function Kh(){return yt("atan")}function Jh(){return yt("ceil")}function Zh(){return yt("cos")}function Qh(t){let e="elu";return{body:`\n  const float alpha = float(${t});\n\n  float ${e}_(float a) {\n    return a >= 0.0 ? a: (exp(a) - 1.0) * alpha;\n  }\n  vec4 ${e}_(vec4 v) {\n    return vec4(${e}_(v.x), ${e}_(v.y), ${e}_(v.z), ${e}_(v.w));\n  }\n  `,name:e,type:0}}function em(){return yt("exp")}function tm(){return yt("floor")}function Ei(t,e){let r="clip";return{body:`\n  const float min = float(${t});\n  const float max = float(${e});\n\n  float ${r}_(float a) {\n    return clamp(a, min, max);\n  }\n  vec4 ${r}_(vec4 v) {\n    return clamp(v, min, max);\n  }\n  `,name:r,type:0}}function rm(){let t="indentity";return{body:`\n  float ${t}_(float a) {\n    return a;\n  }\n  vec4 ${t}_(vec4 v) {\n    return v;\n  }\n  `,name:t,type:0}}function nm(t){let e="leakyRelu";return{body:`\n  const float alpha = float(${t});\n\n  float ${e}_(float a) {\n    return a < 0.0 ? a * alpha : a;\n  }\n  vec4 ${e}_(vec4 v) {\n    return vec4(${e}_(v.x), ${e}_(v.y), ${e}_(v.z), ${e}_(v.w));\n  }\n  `,name:e,type:0}}function om(){return yt("log")}function im(){let t="neg";return{body:`\n  float ${t}_(float a) {\n    return -a;\n  }\n  vec4 ${t}_(vec4 v) {\n    return -v;\n  }\n  `,name:t,type:0}}function am(){let t="not";return{body:`\n  float ${t}_(float a) {\n    return float( ! bool(a) );\n  }\n  bool ${t}_(bool a) {\n    return !a;\n  }\n  vec4 ${t}_(vec4 v) {\n    return vec4(!bool(v.x), !bool(v.y), !bool(v.z), !bool(v.w));\n  }\n  bvec4 ${t}_(bvec4 v) {\n    return bvec4(!v.x, !v.y, !v.z, !v.w);\n  }\n  `,name:t,type:0}}function sm(){return yt("sin")}function Pi(){let t="relu";return{body:`\n  float ${t}_(float a) {\n    return max( a, 0.0 );\n  }\n  vec4 ${t}_(vec4 v) {\n    return max( v, 0.0 );\n  }\n  `,name:t,type:0}}function Di(){let t="sigmoid";return{body:`\n  float ${t}_(float a) {\n    return 1.0 / (1.0 + exp(-a));\n  }\n  vec4 ${t}_(vec4 v) {\n    return 1.0 / (1.0 + exp(-v));\n  }\n  `,name:t,type:0}}function um(){return yt("sqrt")}function lm(){return yt("tan")}function fm(){let t="tanh";return{body:`\n  float ${t}_(float a) {\n    a = clamp(a, -10., 10.);\n    a = exp(2.*a);\n    return (a - 1.) / (a + 1.);\n  }\n  vec4 ${t}_(vec4 v) {\n    v = clamp(v, -10., 10.);\n    v = exp(2.*v);\n    return (v - 1.) / (v + 1.);\n  }\n  `,name:t,type:0}}function yt(t){return{body:`\n  float ${t}_(float a) {\n    return ${t}(a);\n  }\n  vec4 ${t}_(vec4 v) {\n    return ${t}(v);\n  }\n  `,name:t,type:0}}var cm,Ce,Bl,$l,kl,Nl,Li,Rl,Ml,pm,Gl,Ul,zl,Wl,Vl,Hl,Ci,jl,ql,Yl,Xl,Kl,Jl,Zl,Ql,ef,tf,rf,Fi=D((()=>{Me(),fe(),Xt(),ve(),ae(),cm=(t,e,r,n)=>{let i=t.session.pack?2:0,s=Y(t.session.backend.glContext.version);return{...e,output:{dims:r.dims,type:r.type,textureType:i},shaderSource:`\n     ${n.body}\n     void main() {\n       vec4 v = ${s.texture2D}(A, TexCoords);\n       v = ${n.name}_(v);\n       ${s.output} = v;\n     }\n     `,hasMain:!0}},Ce=(t,e,r,n)=>{let i=t.session.pack?2:0,s={name:r.name,inputTypes:[i],inputNames:["A"],cacheHint:n};return{...s,get:()=>cm(t,s,e,r)}},Bl=(t,e)=>[t.run(Ce(t,e[0],qh()),e)],$l=(t,e)=>[t.run(Ce(t,e[0],Yh()),e)],kl=(t,e)=>[t.run(Ce(t,e[0],Xh()),e)],Nl=(t,e)=>[t.run(Ce(t,e[0],Kh()),e)],Li=(t,e,r)=>[t.run(Ce(t,e[0],Ei(r.min,r.max),r.cacheKey),e)],Rl=t=>re({min:t.attributes.getFloat("min",_r),max:t.attributes.getFloat("max",Or)}),Ml=(t,e)=>{let r=pm(t,e);return Li(t,[e[0]],r)},pm=(t,e)=>{if(e.length>=3&&(!t.session.isInitializer(e[1].dataId)||!t.session.isInitializer(e[2].dataId)))throw new Error("dynamic clip attributes are not allowed");let r=e.length>=3?e[1].numberData[0]:_r,n=e.length>=3?e[2].numberData[0]:Or;return re({min:r,max:n})},Gl=(t,e)=>[t.run(Ce(t,e[0],Jh()),e)],Ul=(t,e)=>[t.run(Ce(t,e[0],Zh()),e)],zl=(t,e,r)=>[t.run(Ce(t,e[0],Qh(r.alpha),r.cacheKey),e)],Wl=t=>re({alpha:t.attributes.getFloat("alpha",1)}),Vl=(t,e)=>[t.run(Ce(t,e[0],em()),e)],Hl=(t,e)=>[t.run(Ce(t,e[0],tm()),e)],Ci=(t,e)=>[t.run(Ce(t,e[0],rm()),e)],jl=(t,e,r)=>[t.run(Ce(t,e[0],nm(r.alpha),r.cacheKey),e)],ql=t=>re({alpha:t.attributes.getFloat("alpha",.01)}),Yl=(t,e)=>[t.run(Ce(t,e[0],om()),e)],Xl=(t,e)=>[t.run(Ce(t,e[0],im()),e)],Kl=(t,e)=>[t.run(Ce(t,e[0],am()),e)],Jl=(t,e)=>[t.run(Ce(t,e[0],Pi()),e)],Zl=(t,e)=>[t.run(Ce(t,e[0],Di()),e)],Ql=(t,e)=>[t.run(Ce(t,e[0],sm()),e)],ef=(t,e)=>[t.run(Ce(t,e[0],um()),e)],tf=(t,e)=>[t.run(Ce(t,e[0],lm()),e)],rf=(t,e)=>[t.run(Ce(t,e[0],fm()),e)]}));function Gt(t){let e;switch(t.activation){case"Relu":e=Pi();break;case"Sigmoid":e=Di();break;case"Clip":e=Ei(t.clipMin,t.clipMax);break;default:return{activationFunction:"",applyActivation:""}}let r=e.name;return{activationFunction:e.body,applyActivation:`value = ${r}_(value);`}}var jr,Ar=D((()=>{fe(),Fi(),jr=t=>{let e=t.getString("activation","");if("Clip"===e){let[r,n]=t.getFloats("activation_params",[_r,Or]);return{activation:e,clipMax:n,clipMin:r,activationCacheKey:`${e}:${r},${n}`}}return{activation:e,activationCacheKey:e}}})),hm,mm,nf,of=D((()=>{pt(),ve(),ae(),fo(),Ar(),hm=(t,e)=>({name:"GroupedConv",inputNames:t?["X","W","Bias"]:["X","W"],inputTypes:t?[0,0,0]:[0,0],cacheHint:e}),mm=(t,e,r,n)=>{let i=e.length>2?"value += getBias(output_channel);":"",s=e[0].dims.slice(),o=e[1].dims.slice(),a=o[0]/n.group;pe.verbose("GroupedConv",`autpPad:${n.autoPad}, dilations:${n.dilations}, group:${n.group}, kernelShape:${n.kernelShape}, pads:${n.pads}, strides:${n.strides}`);let u=qr(s,o,n.dilations,n.pads,n.strides),l=Y(t.session.backend.glContext.version),{activationFunction:c,applyActivation:h}=Gt(n),f=`\n  const ivec2 strides = ivec2(${n.strides[0]}, ${n.strides[1]});\n  const ivec2 pads = ivec2(${n.pads[0]}, ${n.pads[1]});\n  ${c}\n  void main() {\n    ivec4 coords = getOutputCoords();\n    int batch = coords.x;\n    int output_channel = coords.y;\n    ivec2 xRCCorner = coords.zw * strides - pads;\n    int group_id = output_channel / ${a};\n\n    float value = 0.0;\n    for (int wInChannel = 0; wInChannel < ${o[1]}; wInChannel++) {\n      int input_channel = group_id * ${o[1]} + wInChannel;\n      for (int wHeight = 0; wHeight < ${o[2]}; wHeight++) {\n        int xHeight = xRCCorner.x + wHeight * ${n.dilations[0]};\n\n        if (xHeight < 0 || xHeight >= ${s[2]}) {\n          continue;\n        }\n\n        for (int wWidth = 0; wWidth < ${o[3]}; wWidth++) {\n          int xWidth = xRCCorner.y + wWidth * ${n.dilations[1]};\n          if (xWidth < 0 || xWidth >= ${s[3]}) {\n            continue;\n          }\n\n          float xVal = getX(batch, input_channel, xWidth, xHeight);\n          float wVal = getW(output_channel, wInChannel, wWidth, wHeight);\n          value += xVal*wVal;\n        }\n      }\n    }\n    ${i}\n    ${h}\n    ${l.output} = vec4(value, .0, .0, .0);\n  }\n`;return{...r,output:{dims:u,type:e[0].type,textureType:0},shaderSource:f,hasMain:!0}},nf=(t,e,r)=>{let n=hm(e.length>2,r.cacheKey);return{...n,get:()=>mm(t,e,n,r)}}})),bm,gm,af,sf=D((()=>{ve(),ae(),Ir(),bm=t=>({name:"Im2Col (packed)",inputNames:["A"],inputTypes:[2],cacheHint:t}),gm=(t,e,r,n,i,s)=>{let o=r.dims,a=n.dims,u=i.length,l=[a[1]*a[2]*a[3],i[2]*i[3]],c=a[2]*a[3],h=Mt(),f=Y(t.session.backend.glContext.version),d="";for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)d+=`\n            blockIndex = rc.x + ${e};\n            pos = rc.y + ${t};\n\n            if(blockIndex < ${l[1]} && pos < ${l[0]}) {\n              offsetY = int(blockIndex / (${i[u-1]})) * ${s.strides[0]} -\n                ${s.pads[0]};\n              d0 = offsetY + ${s.dilations[0]} * (imod(pos, ${c}) / ${a[2]});\n\n              if(d0 < ${o[2]} && d0 >= 0) {\n                offsetX = imod(blockIndex, ${i[u-1]}) * ${s.strides[1]} -\n                  ${s.pads[1]};\n                d1 = offsetX + ${s.dilations[1]} * imod(imod(pos, ${c}), ${a[2]});\n\n                if(d1 < ${o[3]} && d1 >= 0) {\n\n                  ch = int(float(pos)/ ${c}.);\n                    innerDims = vec2(d0, d1);\n                    result[${2*t+e}] = getChannel(\n                      getA(0, ch, int(innerDims.x),\n                      int(innerDims.y)), innerDims);\n                }\n              }\n            }\n\n          `;let p=`\n      ${h}\n\n      void main() {\n        ivec2 rc = getOutputCoords();\n          vec4 result = vec4(0.0);\n          int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n          vec2 innerDims;\n          ${d}\n          ${f.output} = result;\n      }\n            `;return{...e,output:{dims:l,type:r.type,textureType:2},shaderSource:p,hasMain:!0}},af=(t,e,r,n,i)=>{let s=bm(i.cacheKey);return{...s,get:()=>gm(t,s,e,r,n,i)}}}));function Tm(t,e,r){let n=e[0].dims,i=e[1].dims,s=Xe.calcShape(n,i,!0);if(!s)throw new Error("Can't use matmul on the given tensors");let o=Ke(s.length),a=Et(),{activationFunction:u,applyActivation:l}=Gt(r),c=e.length>2,h=c?"value += getBiasForMatmul();":"",f=c?`${$i(o,a,e[2].dims,s,!1)}`:"",d=s.length,p=n.length,v=i.length,y=`\n    ${u}\n    ${f}\n    float process(int indices[${d}]) {\n        int a[${p}];\n        int b[${v}];\n        bcastMatmulIndices_A(indices, a);\n        bcastMatmulIndices_B(indices, b);\n\n        float value;\n        for (int k=0; k<${n[n.length-1]}; ++k) {\n            a[${p-1}] = k;\n            b[${v-2}] = k;\n            value += _A(a) * _B(b);\n        }\n        ${h}\n        ${l}\n        return value;\n    }`;return{...t,output:{dims:s,type:e[0].type,textureType:0},shaderSource:y}}function Bi(t,e){let r=ym(t.length>2,e.activationCacheKey);return{...r,get:()=>Tm(r,t,e)}}function $i(t,e,r,n,i){let s="",o=r.length,a=n.length,u=a-o;s=a<2&&o>0?"coords":r.map(((t,r)=>`coords.${e[r+u]}`)).join(", ");let l=Xe.getBroadcastDims(r,n).map((t=>`coords.${e[t+u]} = 0;`)).join("\n"),c="vec4(outputValue.xx, outputValue.yy)";return 1===z.size(r)&&(c="vec4(outputValue.x)"),i?`\nvec4 getBiasForMatmul() {\n  ${t} coords = getOutputCoords();\n  ${l}\n  vec4 outputValue = getBias(${s});\n  return ${c};\n}`:`\nfloat getBiasForMatmul() {\n  ${t} coords = getOutputCoords();\n  ${l}\n  return getBias(coords.x);\n}`}var uf,lf,ym,xm,co=D((()=>{fe(),ae(),Rt(),Ar(),ki(),uf=(t,e,r)=>(xm(e),t.session.pack?[t.run(po(t,e,r),e)]:[t.run(Bi(e,r),e)]),lf=t=>jr(t.attributes),ym=(t,e)=>({name:"MatMul",inputNames:t?["A","B","Bias"]:["A","B"],inputTypes:t?[0,0,0]:[0,0],cacheHint:e}),xm=t=>{if(!t||2!==t.length)throw new Error("MatMul requires 2 inputs.");if(t[0].dims[t[0].dims.length-1]!==t[1].dims[t[1].dims.length-2])throw new Error("shared dimension does not match.");if("float32"!==t[0].type&&"float64"!==t[0].type||"float32"!==t[1].type&&"float64"!==t[1].type)throw new Error("inputs should be float type");if(t[0].type!==t[1].type)throw new Error("inputs types should match")}}));function _m(t,e,r,n){let i=[],s=[],o=r[0].dims,a=r[1].dims,u=o.length,l=a.length,c=n.length,h=c-u,f=c-l;i=o.map(((t,r)=>`coords.${e[r+h]}`)),i[u-1]="i*2",i.join(", "),s=a.map(((t,r)=>`coords.${e[r+f]}`)),s[l-2]="i*2",s.join(", ");let d=Xe.getBroadcastDims(o,n),p=Xe.getBroadcastDims(a,n),v=d.map((t=>`coords.${e[t+h]} = 0;`)).join("\n"),y=p.map((t=>`coords.${e[t+f]} = 0;`)).join("\n"),b=`int lastDim = coords.${e[c-1]};\n  coords.${e[c-1]} = coords.${e[c-2]};\n  coords.${e[c-2]} = lastDim;`;return`\nvec4 getAAtOutCoordsMatmul(int i) {\n  ${t} coords = getOutputCoords();\n  ${b}\n  ${v}\n  vec4 outputValue = getA(${i});\n  return outputValue;\n}\n\nvec4 getBAtOutCoordsMatmul(int i) {\n  ${t} coords = getOutputCoords();\n  ${b}\n  ${y}\n  vec4 outputValue = getB(${s});\n  return outputValue;\n}`}function Om(t,e){let r="";for(let n=0;n<e-2;n++)r+=`rc.${t[n]}, `;return r+=`rc.${t[e-2]}, i*2`,r}function Sm(t,e){let r="";for(let n=0;n<e-2;n++)r+=`rc.${t[n]}, `;return r+=`i*2, rc.${t[e-1]}`,r}var wm,vm,po,ki=D((()=>{fe(),ve(),ae(),Rt(),Ar(),co(),wm=(t,e)=>({name:"MatMul (packed)",inputNames:t?["A","B","Bias"]:["A","B"],inputTypes:t?[2,2,2]:[2,2],cacheHint:e}),vm=(t,e,r,n)=>{let i=r.length>2,s=i?"value += getBiasForMatmul();":"",o=r[0].dims,a=r[1].dims,u=Xe.calcShape(o,a,!0),l=!z.areEqual(r[0].dims,r[1].dims);if(!u)throw new Error("Can't use matmul on the given tensors");let c=o[o.length-1],h=Math.ceil(c/2),f=o.length,d=a.length,p=Y(t.session.backend.glContext.version),v=Ke(u.length),y=u.length,b=Et(),{activationFunction:_,applyActivation:m}=Gt(n),g=i?`${$i(v,b,r[2].dims,u,!0)}`:"",w=l?`${_m(v,b,r,u)}`:"",x=l?"getAAtOutCoordsMatmul(i)":`getA(${Om(b,f)})`,T=l?"getBAtOutCoordsMatmul(i)":`getB(${Sm(b,d)})`,S=`\n            ${w}\n            ${g}\n            ${_}\n            void main() {\n              ${l?"":`${v} rc =\n          getOutputCoords(); int lastDim = rc.${b[y-1]}; rc.${b[y-1]} =\n          rc.${b[y-2]}; rc.${b[y-2]} = lastDim;\n      `}\n\n              vec4 value = vec4(0);\n              for (int i = 0; i < ${h}; i++) {\n                vec4 a = ${x};\n                vec4 b = ${T};\n\n                value += (a.rrbb * b.rgrg);\n                value += (a.ggaa * b.baba);\n              }\n              ${s}\n              ${m}\n              ${p.output} = value;\n            }`;return{...e,output:{dims:u,type:r[0].type,textureType:2},shaderSource:S,hasMain:!0}},po=(t,e,r)=>{let n=wm(e.length>2,r.activationCacheKey);return{...n,get:()=>vm(t,n,e,r)}}})),ff,cf=D((()=>{fo(),sf(),ki(),ff=(t,e,r)=>{let n=e[0].dims,i=e[1].dims,s=qr(n,i,r.dilations,r.pads,r.strides),o=t.run(af(t,e[0],e[1],s,r),[e[0]]),a=t.reshapePacked(e[1],[i[0],i[1]*i[2]*i[3]]),u=3===e.length?[a,o,e[2]]:[a,o],l=t.run(po(t,u,r),u);return t.reshapePacked(l,s)}})),Im,Am,pf,Ni,Ri=D((()=>{ae(),Im=t=>({name:"Im2Col",inputNames:["X"],inputTypes:[0],cacheHint:t}),Am=(t,e,r,n,i,s)=>{let o=r.dims,a=n.dims,u=i.length,l=Ni(o,a,i,4),c=`\n        const int XC = ${o[1]};\n        const int XH = ${o[2]};\n        const int XW = ${o[3]};\n        const int KH = ${s.kernelShape[0]};\n        const int KW = ${s.kernelShape[1]};\n        const int dilationH = ${s.dilations[0]};\n        const int dilationW = ${s.dilations[1]};\n        const int strideH = ${s.strides[0]};\n        const int strideW = ${s.strides[1]};\n        const int padH = ${s.pads[0]};\n        const int padW = ${s.pads[1]};\n        const int KHKW = KH*KW;\n        const int XCKHKW = XC * KHKW;\n        const int outputChannels = 4;\n        vec4 process(int indices[${u}]) {\n          int b  = indices[0]; // batch size\n          int oh = indices[1] * strideH - padH; //output height\n          int ow = indices[2] * strideW - padW; //output width\n          int p = indices[3] * outputChannels; //patch\n          vec4 value = vec4(0.0);\n          for(int i=0; i < outputChannels; ++i) {\n            if(p < XCKHKW) {\n              int patchC = p / KHKW;\n              int patchH = (p - patchC*KHKW) / KW;\n              int patchW = (p - patchC*KHKW) - patchH * KW;\n              int xh2 = oh + patchH * dilationH;\n              int xw2 = ow + patchW * dilationW;\n              int x[${o.length}];\n              x[0] = b;\n              x[1] = patchC;\n              x[2] = xh2;\n              x[3] = xw2;\n              if(xh2 >= 0 &&\n                  xh2 < XH &&\n                  xw2 >= 0 &&\n                  xw2 < XW) {\n                value[i] = _X(x);\n              }\n            }\n            ++p;\n          }\n          return value;\n        }\n        `;return{...e,output:{dims:l,type:r.type,textureType:4},shaderSource:c}},pf=(t,e,r,n,i)=>{let s=Im(i.cacheKey);return{...s,get:()=>Am(t,s,e,r,n,i)}},Ni=(t,e,r,n=4)=>[r[0],r[2],r[3],Math.ceil(t[1]*e[2]*e[3]/n)]})),Em,Pm,df,hf=D((()=>{fe(),ve(),ae(),Ar(),Ri(),Em=(t,e)=>({name:"ConvDotProduct",inputNames:t?["Im2Col","K","B"]:["Im2Col","K"],inputTypes:t?[0,4,0]:[0,4],cacheKey:e.activationCacheKey}),Pm=(t,e,r,n,i)=>{let s=r[0].dims,o=r[1].dims,a=[o[0],Math.ceil(s[1]*o[2]*o[3]/4)],u=Ni(s,o,n),[l,c]=t.calculateTextureWidthAndHeight(a,4),h=z.computeStrides(u),[f,d]=t.calculateTextureWidthAndHeight(u,4),p=n.length,v=r.length<3?"0.0":"_B(b)",y=Math.ceil(s[1]*o[2]*o[3]/4),{activationFunction:b,applyActivation:_}=Gt(i),m=Y(t.session.backend.glContext.version),g=`\n${b}\nfloat process(int indices[${p}]) {\n  int b[1];\n  b[0] = indices[1];\n  int im2col[4];\n  im2col[0] = indices[0];\n  im2col[1] = indices[2];\n  im2col[2] = indices[3];\n  int im2colOffset = im2col[0] * ${h[0]} + im2col[1] * ${h[1]} + im2col[2] * ${h[2]};\n  int kernelOffset = indices[1] * ${a[1]};\n  float value = ${v};\n  for (int i = 0; i < ${y}; ++i) {\n    vec2 im2colCoords = offsetToCoords(im2colOffset, ${f}, ${d});\n    vec2 kernelCoords = offsetToCoords(kernelOffset, ${l}, ${c});\n    value += dot(${m.texture2D}(Im2Col, im2colCoords), ${m.texture2D}(K, kernelCoords));\n    ++im2colOffset;\n    ++kernelOffset;\n  }\n  ${_}\n  return value;\n}`;return{...e,output:{dims:n,type:r[0].type,textureType:0},shaderSource:g}},df=(t,e,r,n)=>{let i=Em(e.length>2,n);return{...i,get:()=>Pm(t,i,e,r,n)}}})),qr,Mi,Dm,Lm,Cm,Fm,Gi,Bm,fo=D((()=>{Me(),fe(),of(),cf(),hf(),Ar(),Ri(),co(),qr=(t,e,r,n,i)=>{let s=t[0],o=t.slice(2),a=o.length,u=e[0],l=e.slice(2).map(((t,e)=>t+(t-1)*(r[e]-1))),c=o.map(((t,e)=>t+n[e]+n[e+a])).map(((t,e)=>Math.floor((t-l[e]+i[e])/i[e])));return[s,u].concat(...c)},Mi=(t,e,r)=>(Bm(e,r),Dm(t,e,r)),Dm=(t,e,r)=>{let n=Fm(r,e),i=t.session.pack,s=1===n.kernelShape[0]&&1===n.kernelShape[1];return n.group>1?[t.run(nf(t,e,n),e)]:s&&i?[Lm(t,e,n)]:i&&4===e[0].dims.length&&1===e[0].dims[0]&&!s?[ff(t,e,n)]:[Cm(t,e,n)]},Lm=(t,e,r)=>{let n=e[0].dims,i=e[1].dims,s=qr(n,i,r.dilations,r.pads,r.strides),o=t.reshapeUnpacked(e[0],[n[1],n[2]*n[3]]),a=t.reshapeUnpacked(e[1],[i[0],i[1]]),u=e.length>2?[a,o,e[2]]:[a,o],l=t.run(Bi(u,r),u);return t.reshapeUnpacked(l,s)},Cm=(t,e,r)=>{let n=e[0].dims,i=e[1].dims,s=qr(n,i,r.dilations,r.pads,r.strides),o=t.run(pf(t,e[0],e[1],s,r),[e[0]]),a=3===e.length?[o,e[1],e[2]]:[o,e[1]];return t.run(df(t,e,s,r),a)},Fm=(t,e)=>{let r=t.kernelShape.slice();if(0===t.kernelShape.length)for(let t=2;t<e[1].dims.length;++t)r.push(e[1].dims[t]);let n=t.pads.slice();vr.adjustPadsBasedOnAutoPad(e[0].dims,t.strides,t.dilations,r,n,t.autoPad);let i=Object.assign({},t);return Object.assign(i,{kernelShape:r,pads:n,cacheKey:t.cacheKey}),i},Gi=t=>{let e=t.attributes,r=jr(e),n=e.getString("auto_pad","NOTSET"),i=e.getInts("dilations",[1,1]),s=e.getInt("group",1),o=e.getInts("kernel_shape",[]),a=e.getInts("pads",[0,0,0,0]),u=e.getInts("strides",[1,1]);return re({autoPad:n,dilations:i,group:s,kernelShape:o,pads:a,strides:u,...r})},Bm=(t,e)=>{if(!t||2!==t.length&&3!==t.length)throw new Error("Conv requires 2 or 3 inputs");if(4!==t[0].dims.length||4!==t[1].dims.length)throw new Error("currently only support 2-dimensional conv");if(t[0].dims[1]!==t[1].dims[1]*e.group)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(3===t.length&&(1!==t[2].dims.length||t[1].dims[0]!==t[2].dims[0]))throw new Error("invalid bias");let r=t[0].dims.length-2;if(e.dilations.length!==r)throw new Error(`dilations should be ${r}D`);if(e.strides.length!==r)throw new Error(`strides should be ${r}D`);if(e.pads.length!==2*r)throw new Error(`pads should be ${2*r}D`);if(0!==e.kernelShape.length&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape");if("float32"!==t[0].type||"float32"!==t[1].type)throw new Error("Conv input(X,W) should be float tensor");if(3===t.length&&"float32"!==t[2].type)throw new Error("Conv input(bias) should be float tensor")}})),$m,km,Nm,mf,Rm,Mm,Gm,Um,zm,Wm,bf,Vm,gf=D((()=>{Me(),ve(),ae(),Ar(),$m=(t,e,r,n,i,s)=>(t-1)*e+r+(n-1)*i+1-s,km=(t,e,r,n,i)=>{let s=Math.floor(t/2);"SAME_UPPER"===e?(r[n]=s,r[i]=t-s):"SAME_LOWER"===e&&(r[n]=t-s,r[i]=s)},Nm=(t,e,r,n,i,s,o,a)=>{let u=t.length-2,l=0===a.length;for(let c=0;c<u;++c){let h=l?t[c+2]*s[c]:a[c],f=$m(t[c+2],s[c],i[c],e[c],r[c],h);km(f,n,i,c,c+u),l&&a.push(s[c]*(t[c+2]-1)+o[c]+(e[c]-1)*r[c]+1-i[c]-i[c+u])}},mf=(t,e,r)=>(Vm(e,r),Rm(t,e,r)),Rm=(t,e,r)=>{let n=Wm(r,e);return[zm(t,e,n)]},Mm=(t,e)=>({name:"ConvTranspose",inputNames:t?["X","W","B"]:["X","W"],inputTypes:t?[0,0,0]:[0,0],cacheHint:e}),Gm=(t,e,r,n)=>{let i=e.length>2?"getB(output_channel)":"0.0",s=e[0].dims,o=e[1].dims,a=o[1],u=o[0]/n.group,l=[e[0].dims[0],e[1].dims[1]*n.group,...n.outputShape],c=Y(t.session.backend.glContext.version),{activationFunction:h,applyActivation:f}=Gt(n),d=`\n  const ivec2 strides = ivec2(${n.strides[0]}, ${n.strides[1]});\n  const ivec2 pads = ivec2(${n.pads[0]}, ${n.pads[1]});\n  ${h}\n  void main() {\n    ivec4 coords = getOutputCoords();\n    int batch = coords.x;\n    int output_channel = coords.y;\n\n    ivec2 loc = coords.zw + pads;\n\n    int group_id = output_channel / ${a};\n    int wOutChannel = output_channel - group_id * ${a};\n\n    float value = ${i};\n    for (int inChannelOffset = 0; inChannelOffset < ${u}; inChannelOffset++) {\n      int input_channel = group_id * ${u} + inChannelOffset;\n      for (int wWOff = 0; wWOff < ${o[2]}; wWOff++) {\n        for (int wHOff = 0; wHOff < ${o[3]}; wHOff++) {\n          ivec2 wOff = ivec2(wWOff * ${n.dilations[0]}, wHOff * ${n.dilations[1]});\n          ivec2 wLoc = loc - wOff;\n          ivec2 wLocIn = wLoc / strides;\n          if (\n            wLocIn * strides == wLoc &&\n            wLocIn.x >= 0 && wLocIn.x < ${s[2]} &&\n            wLocIn.y >= 0 && wLocIn.y < ${s[3]}\n          ) {\n            float xVal = getX(batch, input_channel, wLocIn.y, wLocIn.x);\n            float wVal = getW(input_channel, wOutChannel, wHOff, wWOff);\n            value += xVal * wVal;\n          }\n        }\n      }\n    }\n    ${f}\n    ${c.output} = vec4(value, .0, .0, .0);\n  }\n`;return{...r,output:{dims:l,type:e[0].type,textureType:0},shaderSource:d,hasMain:!0}},Um=(t,e,r)=>{let n=Mm(e.length>2,r.cacheKey);return{...n,get:()=>Gm(t,e,n,r)}},zm=(t,e,r)=>t.run(Um(t,e,r),e),Wm=(t,e)=>{let r=t.kernelShape.slice();if(0===t.kernelShape.length)for(let t=2;t<e[1].dims.length;++t)r.push(e[1].dims[t]);let n=t.pads.slice(),i=t.outputShape.slice(),s=e[0].dims;Nm(s,r,t.dilations,t.autoPad,n,t.strides,t.outputPadding,i);let o=Object.assign({},t);return Object.assign(o,{kernelShape:r,pads:n,outputShape:i,cacheKey:t.cacheKey}),o},bf=t=>{let e=t.attributes,r=jr(e),n=e.getString("auto_pad","NOTSET"),i=e.getInts("dilations",[1,1]),s=e.getInt("group",1),o=e.getInts("kernel_shape",[]),a=e.getInts("output_padding",[0,0]),u=e.getInts("output_shape",[]),l=e.getInts("pads",[0,0,0,0]),c=e.getInts("strides",[1,1]);return re({autoPad:n,dilations:i,group:s,kernelShape:o,outputPadding:a,outputShape:u,pads:l,strides:c,...r})},Vm=(t,e)=>{if(!t||2!==t.length&&3!==t.length)throw new Error("Conv requires 2 or 3 inputs");if(4!==t[0].dims.length||4!==t[1].dims.length)throw new Error("currently only support 2-dimensional conv");if(t[0].dims[1]!==t[1].dims[0])throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let r=t[1].dims[1]*e.group;if(3===t.length&&(1!==t[2].dims.length||t[2].dims[0]!==r))throw new Error("invalid bias");let n=t[0].dims.length-2;if(e.dilations.length!==n)throw new Error(`dilations should be ${n}D`);if(e.strides.length!==n)throw new Error(`strides should be ${n}D`);if(e.pads.length!==2*n)throw new Error(`pads should be ${2*n}D`);if(e.outputPadding.length!==n)throw new Error(`output_padding should be ${n}D`);if(0!==e.kernelShape.length&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape");if(0!==e.outputShape.length&&e.outputShape.length!==t[0].dims.length-2)throw new Error("invalid output shape");if("float32"!==t[0].type||"float32"!==t[1].type)throw new Error("ConvTranspose input(X,W) should be float tensor");if(3===t.length&&"float32"!==t[2].type)throw new Error("ConvTranspose input(bias) should be float tensor")}})),yf,Er,Tf,Hm,xf,jm,qm,Ym,ho=D((()=>{Me(),fe(),ae(),yf={name:"Transpose",inputNames:["A"],inputTypes:[0]},Er=(t,e,r)=>(Ym(e),[t.run({...yf,cacheHint:r.cacheKey,get:()=>Hm(t,e[0],r.perm)},e)]),Tf=t=>re({perm:t.attributes.getInts("perm",[])}),Hm=(t,e,r)=>{let n=e.dims;r=xf(n,r);let i=jm(n,r),s=n.length,o=`\n      ${qm("perm",r,s)}\n      float process(int indices[${s}]) {\n        int a[${s}];\n        perm(a, indices);\n        return _A(a);\n      }`;return{...yf,output:{dims:i,type:e.type,textureType:0},shaderSource:o}},xf=(t,e)=>(e&&e.length!==t.length&&(e=[...t.keys()].reverse()),e),jm=(t,e)=>(e=xf(t,e),z.sortBasedOnPerm(t,e)),qm=(t,e,r)=>{let n=[];n.push(`void ${t}(out int a[${r}], int src[${r}]) {`);for(let t=0;t<r;++t)n.push(`\ta[${e[t]}]=src[${t}];`);return n.push("\t}"),n.join("\n")},Ym=t=>{if(!t||1!==t.length)throw new Error("Transpose requires 1 input.");if("float32"!==t[0].type&&"float64"!==t[0].type)throw new Error("input should be float tensor")}})),wf,vf,Xm,_f=D((()=>{ho(),wf=(t,e,r)=>{Xm(e);let n=r.blocksize,i=n*n,s="DCR"===r.mode?[0,3,4,1,5,2]:[0,1,4,2,5,3],o="DCR"===r.mode?[e[0].dims[0],n,n,e[0].dims[1]/i,e[0].dims[2],e[0].dims[3]]:[e[0].dims[0],e[0].dims[1]/i,n,n,e[0].dims[2],e[0].dims[3]],a=t.reshapeUnpacked(e[0],o),u={perm:s,cacheKey:`${s}`},[l]=Er(t,[a],u),c=[e[0].dims[0],e[0].dims[1]/i,e[0].dims[2]*n,e[0].dims[3]*n];return[t.reshapeUnpacked(l,c)]},vf=t=>{let e=t.attributes.getInt("blocksize");if(e<1)throw new Error(`blocksize must be >= 1, but got : ${e} for DepthToSpace`);let r=t.attributes.getString("mode","DCR");if("DCR"!==r&&"CRD"!==r)throw new Error(`unrecognized mode: ${r} for DepthToSpace`);return{mode:r,blocksize:e}},Xm=t=>{if(1!==t.length)throw new Error(`DepthToSpace expect 1 inputs, but got ${t.length}`);if("string"===t[0].type||4!==t[0].dims.length)throw new TypeError("DepthToSpace input should be a 4-D numeric tensor")}})),Of,Sf,Km,If=D((()=>{fe(),Of=(t,e,r)=>{Km(e,r);let n=z.flattenShape(e[0].dims,r);return[t.reshapeUnpacked(e[0],n)]},Sf=t=>t.attributes.getInt("axis",1),Km=(t,e)=>{if(!t||1!==t.length)throw new Error("Flatten requires 1 input.");let r=t[0].dims.length;if(0===r)throw new Error("scalar tensor is not supported.");if(e<-r||e>r)throw new Error("Invalid axis");if("string"===t[0].type)throw new Error("string tensor is not supported.")}})),rr,Tn=D((()=>{rr=["float32","float64","int32","int16","int8","uint16","uint32","uint8"]})),Af,Ef,Jm,Zm,Qm,eb,Pf=D((()=>{Me(),Tn(),fe(),ae(),Af=(t,e,r)=>(eb(e,r.axis),[t.run(Qm(t,e,r),e)]),Ef=t=>re({axis:t.attributes.getInt("axis",0)}),Jm={name:"Gather",inputNames:["A","B"],inputTypes:[0,0]},Zm=(t,e,r,n)=>{let i=r[0].dims.slice(),s=r[1].dims.slice(),o=new Array(i.length+s.length-1);n=z.normalizeAxis(n,i.length);let a=[];for(let t=0;t<o.length;t++)t<n?(o[t]=i[t],a.push(`inputIdx[${t}] = outputIdx[${t}];`)):t<n+s.length?(o[t]=s[t-n],a.push(`indexDataIdx[${t-n}] = outputIdx[${t}];`)):(o[t]=i[t-s.length+1],a.push(`inputIdx[${t-s.length+1}] = outputIdx[${t}];`));let u=`\n      float process(int outputIdx[${o.length||1}]) {\n        int inputIdx[${i.length}];\n        int indexDataIdx[${s.length||1}];\n        indexDataIdx[0] = 0;\n        ${a.join("\n        ")}\n        int idx = int(_B(indexDataIdx));\n        inputIdx[${n}] = idx < 0 ? idx + ${i[n]} : idx;\n        return _A(inputIdx);\n      }`;return{...e,output:{dims:o,type:r[0].type,textureType:0},shaderSource:u}},Qm=(t,e,r)=>{let n={...Jm,cacheHint:r.cacheKey};return{...n,get:()=>Zm(t,n,e,r.axis)}},eb=(t,e)=>{if(!t||2!==t.length)throw new Error("Gather requires 2 inputs.");let r=t[0].dims.length;if(r<1)throw new Error("Invalid input shape.");if(e<-r||e>r-1)throw new Error("Invalid axis.");if(-1===rr.indexOf(t[0].type))throw new Error("Invaid input type.");if("int32"!==t[1].type&&"int16"!==t[1].type)throw new Error("Invaid input type.")}})),Ui,Df,Lf,Cf,tb,rb,nb,Ff=D((()=>{Me(),fe(),ae(),Ui=(t,e,r)=>(nb(e,r),[t.run(tb(e,r),e)]),Df=(t,e)=>{let r=0!==t.attributes.getInt("transA",0),n=0!==t.attributes.getInt("transB",0),i=t.attributes.getFloat("alpha",1),s=t.attributes.getFloat("beta",1);return re({transA:r,transB:n,alpha:i,beta:s,isOptionalC:e})},Lf=t=>Df(t,!1),Cf=t=>Df(t,!0),tb=(t,e)=>{let r={name:"Gemm",inputNames:3===t.length?["A","B","C"]:["A","B"],inputTypes:3===t.length?[0,0,0]:[0,0],key:e.cacheKey};return{...r,get:()=>rb(r,t,e)}},rb=(t,e,r)=>{let n=e[0].dims.slice(),i=e[1].dims.slice(),[s,o]=ro.getShapeOfGemmResult(n,r.transA,i,r.transB,3===e.length?e[2].dims:void 0),a=[s,o];if(!a)throw new Error("Can't use gemm on the given tensors");let u=n[n.length-1],l="";r.transA&&(u=n[0]),r.transA&&r.transB?l="value += _A_T(a) * _B_T(b);":r.transA&&!r.transB?l="value += _A_T(a) * _B(b);":!r.transA&&r.transB?l="value += _A(a) * _B_T(b);":!r.transA&&!r.transB&&(l="value += _A(a) * _B(b);");let c=a.length,h=`\n      float process(int indices[${c}]) {\n          int a[${c}];\n          int b[${c}];\n          ${3===e.length?`int c[${e[2].dims.length}];`:""}\n\n          copyVec(indices, a);\n          copyVec(indices, b);\n          ${3===e.length?"bcastIndices_C(indices, c);":""}\n\n          float value = 0.0;\n          for (int k=0; k<${u}; ++k) {\n              a[${c-1}] = k;\n              b[${c-2}] = k;\n              ${l}\n          }\n\n          value = value * alpha;\n          ${3===e.length?"value += beta * _C(c);":""}\n          return value;\n      }`;return{...t,output:{dims:a,type:e[0].type,textureType:0},variables:[{name:"alpha",type:"float",data:r.alpha},{name:"beta",type:"float",data:r.beta}],shaderSource:h}},nb=(t,e)=>{if(!t)throw new Error("Input is missing");if(e.isOptionalC&&(t.length<2||t.length>3))throw new Error("Invaid input shape.");if(!e.isOptionalC&&3!==t.length)throw new Error("Gemm requires 3 inputs");if(3===t.length&&1!==t[2].dims.length&&2!==t[2].dims.length)throw new Error("Invalid input shape of C");if("float32"!==t[0].type&&"float64"!==t[0].type||"float32"!==t[1].type&&"float64"!==t[1].type||3===t.length&&"float32"!==t[2].type&&"float64"!==t[2].type)throw new Error("Invalid input type.");if(t[0].type!==t[1].type||3===t.length&&t[0].type!==t[2].type)throw new Error("Input types are mismatched")}})),Bf,$f,ob,ib,ab,sb,ub,kf=D((()=>{Me(),ae(),Bf=(t,e,r)=>(ub(e),[t.run(ab(t,e,r),e)]),$f=t=>{let e=t.attributes.getFloat("scale"),r=t.attributes.getFloats("bias");return re({scale:e,bias:r})},ob={name:"ImageScaler",inputNames:["X"],inputTypes:[0]},ib=(t,e,r,n)=>{let i=r[0].dims.slice(),s=i.length,o=`\n      ${sb(n.bias.length)}\n      float process(int indices[${s}]) {\n        return _X(indices) * scale + getBias(bias, indices[1]);\n      }`;return{...e,output:{dims:i,type:r[0].type,textureType:0},variables:[{name:"bias",type:"float",arrayLength:n.bias.length,data:n.bias},{name:"scale",type:"float",data:n.scale}],shaderSource:o}},ab=(t,e,r)=>{let n={...ob,cacheHint:r.cacheKey};return{...n,get:()=>ib(t,n,e,r)}},sb=t=>{let e=[`float getBias(float bias[${t}], int channel) {`];for(let r=0;r<t;++r)0===r?e.push(`\tif (channel == ${r}) { return bias[${r}]; }`):r===t-1?e.push(`\telse { return bias[${r}]; }`):e.push(`\telse if (channel == ${r}) { return bias[${r}]; }`);return e.push("\t}"),e.join("\n")},ub=t=>{if(!t||1!==t.length)throw new Error("ImageScaler requires 1 input.");if(4!==t[0].dims.length)throw new Error("Invalid input shape.");if("float32"!==t[0].type&&"float64"!==t[0].type)throw new Error("Invalid input type.")}})),Rf,Mf,Nf,lb,fb,cb,pb,db,hb,Gf=D((()=>{ve(),ae(),Rf=(t,e,r)=>{hb(e);let n=t.run(fb(e[0]),e);return[t.run(db(t,e[0],r,n.dims),[e[0],n,e[1],e[2]])]},Mf=t=>t.attributes.getFloat("epsilon",1e-5),Nf={name:"InstanceNormalization_MeanAndVariance",inputNames:["X"],inputTypes:[0]},lb=(t,e)=>{let r=e.dims.slice(),n=r[1],i=r[2]*r[3],s=[r[0],n],o=`\n      vec4 process(int[2] indices) {\n        vec4 v = vec4(0.0);\n        int a[4];\n        a[0] = indices[0];\n        a[1] = indices[1];\n        float temp = 0.0;\n        for(int a2=0; a2<${r[2]}; a2++) {\n          a[2] = a2;\n          for(int a3=0; a3<${r[3]}; a3++) {\n            a[3] = a3;\n            float x = _X(a);\n            temp += x;\n          }\n        }\n        float mean = temp / float(${i});\n        temp = 0.0;\n        for(int a2=0; a2<${r[2]}; a2++) {\n          a[2] = a2;\n          for(int a3=0; a3<${r[3]}; a3++) {\n            a[3] = a3;\n            float x = _X(a);\n            temp += (x - mean) * (x - mean);\n          }\n        }\n        v.r = mean;\n        v.g = temp / float(${i});\n\n        return v;\n      }`;return{...t,output:{dims:s,type:e.type,textureType:4},shaderSource:o}},fb=t=>({...Nf,get:()=>lb(Nf,t)}),cb={name:"InstanceNormalization_ComputeOutput",inputNames:["X","MeanAndVariance","Scale","B"],inputTypes:[0,4,0,0]},pb=(t,e,r,n,i)=>{let s=Y(t.session.backend.glContext.version),[o,a]=t.calculateTextureWidthAndHeight(i,4),[u,l]=[o/4,a],c=`\n      vec4 get_MeanAndVariance(int[2] mv) {\n        int offset = indicesToOffset_MeanAndVariance(mv);\n        vec2 coords = offsetToCoords(offset, ${u}, ${l});\n        return ${s.texture2D}(MeanAndVariance, coords);\n      }\n\n      float process(int[4] indices) {\n        int mv[2];\n        mv[0] = indices[0];\n        mv[1] = indices[1];\n        vec4 mean_and_variance = get_MeanAndVariance(mv);\n        float mean = mean_and_variance.r;\n        float variance = mean_and_variance.g;\n\n        int sb[1];\n        sb[0] = indices[1];\n        float scale = _Scale(sb);\n        float b = _B(sb);\n\n        return scale * (_X(indices) - mean) / sqrt(variance + epsilon) + b;\n      }`;return{...e,output:{dims:r.dims,type:r.type,textureType:0},variables:[{name:"epsilon",type:"float",data:n}],shaderSource:c}},db=(t,e,r,n)=>{let i={...cb,cacheHint:`${r}`};return{...i,get:()=>pb(t,i,e,r,n)}},hb=t=>{if(!t||3!==t.length)throw new Error("InstanceNormalization requires 3 inputs.");let e=t[0],r=t[1],n=t[2];if(e.dims.length<3||1!==r.dims.length||1!==n.dims.length)throw new Error("Invalid input shape.");if(r.dims[0]!==e.dims[1]||n.dims[0]!==e.dims[1])throw new Error("Input shapes are mismatched.");if("float32"!==e.type&&"float64"!==e.type||"float32"!==r.type&&"float64"!==r.type||"float32"!==n.type&&"float64"!==n.type)throw new Error("Invalid input type.");if(4!==t[0].dims.length)throw new Error("Only support 4-D input shape.")}}));function mb(t,e){let r=t[0].dims[1],n=t[0].dims.length,i=-Math.floor((e.size-1)/2),s=Math.ceil((e.size-1)/2),o=`float(${e.alpha}) / float(${e.size})`,a=`\n    float process(int indices[${n}]) {\n        int c = indices[1];\n        float x = _X(indices);\n        float square_sum = 0.0;\n\n        for (int i = ${i}; i <= ${s}; i++) {\n          int idx = c + i;\n          if (c >= 0 && c < ${r}) {\n            indices[1] = idx;\n            float j = _X(indices);\n            square_sum += j * j;\n          }\n        }\n        return x / pow(${`float(${e.bias})`} + ${o} * square_sum, ${`float(${e.beta})`});\n    }`;return{...Wf,cacheHint:e.cacheKey,output:{dims:t[0].dims,type:t[0].type,textureType:0},shaderSource:a}}function bb(t,e){return{...Wf,cacheHint:e.cacheKey,get:()=>mb(t,e)}}var Uf,zf,Wf,gb,Vf=D((()=>{Me(),ae(),Uf=(t,e,r)=>(gb(e),[t.run(bb(e,r),e)]),zf=t=>{let e=t.attributes.getFloat("alpha",1e-4),r=t.attributes.getFloat("beta",.75),n=t.attributes.getFloat("bias",1),i=t.attributes.getInt("size");return re({alpha:e,beta:r,bias:n,size:i})},Wf={name:"LRN",inputNames:["X"],inputTypes:[0]},gb=t=>{if(!t||1!==t.length)throw new Error("LRN requires 1 input.");if(4!==t[0].dims.length)throw new Error('currently only support LRN for input with "NCHW" format');if("float32"!==t[0].type)throw new Error("input should be float type")}})),yb,zi,Hf,jf,qf,Tb,xb,wb,vb,_b,Ob,Sb,Ib,Yf=D((()=>{Me(),fe(),ve(),ae(),yb={name:"Pad",inputNames:["A"],inputTypes:[0]},zi=(t,e,r)=>(wb(e),[t.run({...yb,cacheHint:r.cacheKey,get:()=>xb(t,e[0],r)},e)]),Hf=t=>{let e=t.attributes.getString("mode","constant"),r=t.attributes.getFloat("value",0),n=t.attributes.getInts("pads");return re({mode:e,value:r,pads:n})},jf=(t,e,r)=>{vb(e);let n=Tb(t,e,r);return zi(t,[e[0]],n)},qf=t=>t.attributes.getString("mode","constant"),Tb=(t,e,r)=>{if(!t.session.isInitializer(e[1].dataId)||e.length>=3&&!t.session.isInitializer(e[2].dataId))throw new Error("dynamic pad attributes are not allowed");let n=Array.from(e[1].integerData),i=e.length>=3?e[2].floatData[0]:0;return re({mode:r,pads:n,value:i})},xb=(t,e,r)=>{let n=z.padShape(e.dims.slice(),r.pads),i=n.length,s=`\n      ${_b(t,e,r)}\n      float process(int[${i}] indices) {\n          return padA(indices);\n      }`;return{name:"Pad",inputNames:["A"],inputTypes:[0],output:{dims:n,type:e.type,textureType:0},shaderSource:s}},wb=t=>{if(!t||1!==t.length)throw new Error("Pad requires 1 input");if("float32"!==t[0].type&&"float64"!==t[0].type)throw new Error("Invalid input type.")},vb=t=>{if(!t||2!==t.length&&3!==t.length)throw new Error("Pad requires 2 or 3 inputs");if("int32"!==t[1].type)throw new Error("Invalid input type.");if(t.length>=3&&"string"===t[2].type)throw new Error("Invalid input type.")},_b=(t,e,r)=>{let n=Y(t.session.backend.glContext.version),[i,s]=t.calculateTextureWidthAndHeight(e.dims,0),o=z.computeStrides(e.dims);switch(r.mode){case"constant":return Ob(n,e.dims,o,i,s,r.pads,r.value);case"reflect":return Sb(n,e.dims,o,i,s,r.pads);case"edge":return Ib(n,e.dims,o,i,s,r.pads);default:throw new Error("Invalid mode")}},Ob=(t,e,r,n,i,s,o)=>{let a=e.length,u="";for(let t=a-1;t>=0;--t)u+=`\n        k = m[${t}] - ${s[t]};\n        if (k < 0)  return constant;\n        if (k >= ${e[t]}) return constant;\n        offset += k * ${r[t]};\n        `;return`\n      float padA(int m[${a}]) {\n        const float constant = float(${o});\n        int offset = 0;\n        int k = 0;\n        ${u}\n        vec2 coords = offsetToCoords(offset, ${n}, ${i});\n        float value = getColorAsFloat(${t.texture2D}(A, coords));\n        return value;\n      }\n      `},Sb=(t,e,r,n,i,s)=>{let o=e.length,a="";for(let t=o-1;t>=0;--t)a+=`\n        k = m[${t}] - ${s[t]};\n        if (k < 0) { k = -k; }\n        {\n          const int _2n_1 = ${2*(e[t]-1)};\n          k = int( mod( float(k), float(_2n_1) ) ) ;\n          if(k >= ${e[t]}) { k = _2n_1 - k; }\n        }\n        offset += k * ${r[t]};\n        `;return`\n      float padA(int m[${o}]) {\n        int offset = 0;\n        int k = 0;\n        ${a}\n        vec2 coords = offsetToCoords(offset, ${n}, ${i});\n        float value = getColorAsFloat(${t.texture2D}(A, coords));\n        return value;\n      }\n      `},Ib=(t,e,r,n,i,s)=>{let o=e.length,a="";for(let t=o-1;t>=0;--t)a+=`\n        k = m[${t}] - ${s[t]};\n        if (k < 0)  k = 0;\n        if (k >= ${e[t]}) k = ${e[t]-1};\n        offset += k * ${r[t]};\n      `;return`\n      float padA(int m[${o}]) {\n        int offset = 0;\n        int k = 0;\n        ${a}\n        vec2 coords = offsetToCoords(offset, ${n}, ${i});\n        float value = getColorAsFloat(${t.texture2D}(A, coords));\n        return value;\n      }\n      `}})),Kf,Jf,Zf,Qf,ec,tc,rc,nc,oc,Ab,Xf,ic,bo,ac,mo,Eb,sc=D((()=>{Me(),fe(),ae(),Kf=(t,e,r)=>{bo(e);let n={name:"AveragePool",inputNames:["X"],inputTypes:[0],cacheHint:r.cacheKey};return[t.run({...n,get:()=>Zf(e,n,!1,r)},e)]},Jf=t=>{let e=t.attributes.getString("auto_pad","NOTSET"),r=t.attributes.getInt("ceil_mode",0),n=0!==t.attributes.getInt("count_include_pad",0),i=t.attributes.getInts("kernel_shape"),s=t.attributes.getInts("strides",[]),o=t.attributes.getInts("pads",[]);if(0!==r)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");return re({autoPad:e,ceilMode:r,countIncludePad:n,kernelShape:i,strides:s,pads:o})},Zf=(t,e,r,n)=>{let[i,s]=oc(t,n,r),o=z.size(i.kernelShape),a="";i.countIncludePad?a+=`value /= float(${o});`:a+=`value /= float(${o} - pad);`;let u=`\n        ${ac(t[0].dims,i,"value += _X(x);",a,"0.0")}\n      `;return{...e,output:{dims:s,type:t[0].type,textureType:0},shaderSource:u}},Qf=(t,e,r)=>{bo(e);let n={name:"GlobalAveragePool",inputNames:["X"],inputTypes:[0],cacheHint:`${r.countIncludePad}`};return[t.run({...n,get:()=>Zf(e,n,!0,r)},e)]},ec=t=>{let e=0!==t.attributes.getInt("count_include_pad",0);return re({autoPad:"",ceilMode:0,countIncludePad:e,kernelShape:[],strides:[],pads:[]})},tc=(t,e,r)=>{bo(e);let n={name:"MaxPool",inputNames:["X"],inputTypes:[0],cacheHint:r.cacheKey};return[t.run({...n,get:()=>nc(e,n,!1,r)},e)]},rc=t=>{let e=t.attributes.getString("auto_pad","NOTSET"),r=t.attributes.getInt("ceil_mode",0),n=t.attributes.getInts("kernel_shape"),i=t.attributes.getInts("strides",[]),s=t.attributes.getInts("pads",[]),o=t.attributes.getInt("storage_order",0),a=t.attributes.getInts("dilations",[]);if(0!==o)throw new Error("column major storage order is not yet supported for MaxPool");if(0!==r)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");return re({autoPad:e,ceilMode:r,countIncludePad:!1,kernelShape:n,strides:i,pads:s,storageOrder:o,dilations:a})},nc=(t,e,r,n)=>{let[i,s]=oc(t,n,r),o=`\n      ${ac(t[0].dims,i,"\n      value = max(_X(x), value);\n    ","","-1e5")}\n    `;return{...e,output:{dims:s,type:t[0].type,textureType:0},shaderSource:o}},oc=(t,e,r)=>{let n=t[0].dims.slice(),i=Object.hasOwnProperty.call(e,"dilations"),s=e.kernelShape.slice(),o=e.strides.slice(),a=i?e.dilations.slice():[],u=e.pads.slice();vr.adjustPoolAttributes(r,n,s,o,a,u);let l=vr.computePoolOutputShape(r,n,o,a,s,u,e.autoPad),c=Object.assign({},e);return i?Object.assign(c,{kernelShape:s,strides:o,pads:u,dilations:a,cacheKey:e.cacheKey}):Object.assign(c,{kernelShape:s,strides:o,pads:u,cacheKey:e.cacheKey}),[c,l]},Ab={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[],cacheKey:""},Xf={name:"GlobalMaxPool",inputNames:["X"],inputTypes:[0]},ic=(t,e)=>(bo(e),[t.run({...Xf,get:()=>nc(e,Xf,!0,Ab)},e)]),bo=t=>{if(!t||1!==t.length)throw new Error("Pool ops requires 1 input.");if("float32"!==t[0].type&&"float64"!==t[0].type)throw new Error("Invalid input type.")},ac=(t,e,r,n,i)=>{let s=t.length;if(e.kernelShape.length<=2){let o=e.kernelShape[e.kernelShape.length-1],a=e.strides[e.strides.length-1],u=e.pads[e.pads.length/2-1],l=e.pads[e.pads.length-1],c=t[s-1],h="",f="",d="";if(h=u+l!==0?`\n          for (int i = 0; i < ${o}; i++) {\n            x[${s} - 1] = indices[${s} - 1] * ${a} - ${u} + i;\n            if (x[${s} - 1] < 0 || x[${s} - 1] >= ${c}) {\n              pad++;\n              continue;\n            }\n            ${r}\n          }`:`\n          for (int i = 0; i < ${o}; i++) {\n            x[${s} - 1] = indices[${s} - 1] * ${a} - ${u} + i;\n            ${r}\n          }`,2===e.kernelShape.length){let r=e.kernelShape[e.kernelShape.length-2],n=e.strides[e.strides.length-2],i=e.pads[e.pads.length/2-2],a=e.pads[e.pads.length-2],u=t[s-2];f=i+a!==0?`\n            for (int j = 0; j < ${r}; j++) {\n              x[${s} - 2] = indices[${s} - 2] * ${n} - ${i} + j;\n              if (x[${s} - 2] < 0 || x[${s} - 2] >= ${u}) {\n                pad+= ${o};\n                continue;\n              }\n          `:`\n            for (int j = 0; j < ${r}; j++) {\n              x[${s} - 2] = indices[${s} - 2] * ${n} - ${i} + j;\n            `,d="\n          }\n        "}return`\n        float process(int indices[${s}]) {\n          int x[${s}];\n          copyVec(indices, x);\n\n          float value = ${i};\n          int pad = 0;\n          ${f}\n          ${h}\n          ${d}\n          ${n}\n          return value;\n        }\n      `}{let o=z.size(e.kernelShape),a=z.computeStrides(e.kernelShape),u=a.length,l=e.pads.length,c=Eb(u),h=mo(t,"inputDims"),f=mo(e.pads,"pads"),d=mo(a,"kernelStrides"),p=mo(e.strides,"strides"),v="";return v=e.pads.reduce(((t,e)=>t+e))?`\n            if (x[j] >= inputDims[j] || x[j] < 0) {\n              pad++;\n              isPad = true;\n              break;\n            }\n          }\n          if (!isPad) {\n            ${r}\n          }`:`\n          }\n          ${r}\n        `,`\n        ${c}\n        float process(int indices[${s}]) {\n          int x[${s}];\n          copyVec(indices, x);\n          int offset[${u}];\n          int pads[${l}];\n          int inputDims[${s}];\n          int kernelStrides[${u}];\n          int strides[${u}];\n          ${f}\n          ${h}\n          ${p}\n          ${d}\n\n          float value = ${i};\n          int pad = 0;\n          bool isPad = false;\n          for (int i = 0; i < ${o}; i++) {\n            offsetToIndices(i, kernelStrides, offset);\n            isPad = false;\n            for (int j = ${s} - ${u}; j < ${s}; j++) {\n              x[j] = indices[j] * strides[j - ${s} + ${u}]\n                + offset[j - ${s} + ${u}] - pads[j - 2];\n              ${v}\n          }\n          ${n}\n\n          return value;\n        }\n      `}},mo=(t,e)=>{let r="";for(let n=0;n<t.length;n++)r+=`\n      ${e}[${n}] = ${t[n]};\n    `;return r},Eb=t=>`\n  void offsetToIndices(int offset, int[${t}] strides, out int[${t}] indices) {\n    if (${t} == 0) {\n      return;\n    }\n    for (int i = 0; i < ${t} - 1; ++i) {\n      indices[i] = offset / strides[i];\n      offset -= indices[i] * strides[i];\n    }\n    indices[${t} - 1] = offset;\n  }`})),Pr,nr,Pb,Db,uc,lc,fc,cc,pc,dc,hc,mc=D((()=>{Me(),Tn(),fe(),ae(),Pr=(t,e,r,n,i)=>{Db(e);let s={name:n,inputNames:["A"],inputTypes:[0]};return[t.run({...s,cacheHint:r.cacheKey,get:()=>Pb(t,e,r,n,i,s)},e)]},nr=t=>{let e=t.attributes.getInts("axes",[]),r=1===t.attributes.getInt("keepdims",1);return re({axes:e,keepDims:r})},Pb=(t,e,r,n,i,s)=>{let o=[],a=e[0].dims.length||1,u=[],l=z.normalizeAxes(r.axes,e[0].dims.length),c=i(e,l),h=c[1];for(let t=0;t<e[0].dims.length;t++)l.indexOf(t)>=0||0===l.length?(r.keepDims&&o.push(1),h=`\n          for(int j${t} = 0; j${t} < ${e[0].dims[t]}; j${t}++) {\n            inputIdx[${t}] = j${t};\n            ${h}\n          }`):(u.push(`inputIdx[${t}] = outputIdx[${o.length}];`),o.push(e[0].dims[t]));let f=`\n      float process(int outputIdx[${o.length||1}]) {\n        float value;                 // final result\n        int inputIdx[${a}];      // addressing input data\n        ${u.join("\n")}\n        ${c[0]}       // init ops for reduce max/min\n        ${h}\n        ${c[2]}       // final computation for reduce mean\n        return value;\n      }`;return{...s,output:{dims:o,type:e[0].type,textureType:0},shaderSource:f}},Db=t=>{if(!t||1!==t.length)throw new Error("Reduce op requires 1 input.");if(-1===rr.indexOf(t[0].type))throw new Error("Invalid input type.")},uc=(t,e,r)=>Pr(t,e,r,"ReduceSum",(()=>["value = 0.0;","value += _A(inputIdx);",""])),lc=(t,e,r)=>Pr(t,e,r,"ReduceMean",((t,e)=>{let r=1;for(let n=0;n<t[0].dims.length;n++)(e.indexOf(n)>=0||0===e.length)&&(r*=t[0].dims[n]);return["value = 0.0;","value += _A(inputIdx);",`value /= ${r}.;`]})),fc=(t,e,r)=>Pr(t,e,r,"ReduceMax",((t,e)=>{let r=[];for(let n=0;n<t[0].dims.length;n++)(e.indexOf(n)>=0||0===e.length)&&r.push(`inputIdx[${n}] = 0;`);return[`${r.join("\n")}\nvalue = _A(inputIdx);`,"value = max(value, _A(inputIdx));",""]})),cc=(t,e,r)=>Pr(t,e,r,"ReduceMin",((t,e)=>{let r=[];for(let n=0;n<t[0].dims.length;n++)(e.indexOf(n)>=0||0===e.length)&&r.push(`inputIdx[${n}] = 0;`);return[`${r.join("\n")}\nvalue = _A(inputIdx);`,"value = min(value, _A(inputIdx));",""]})),pc=(t,e,r)=>Pr(t,e,r,"ReduceProd",(()=>["value = 1.0;","value *= _A(inputIdx);",""])),dc=(t,e,r)=>Pr(t,e,r,"ReduceLogSum",(()=>["value = 0.0;","value += _A(inputIdx);","value = log(value);"])),hc=(t,e,r)=>Pr(t,e,r,"ReduceLogSumSquare",(()=>["float t; value = 0.0;","t = _A(inputIdx); value += t * t;",""]))})),bc,gc=D((()=>{fe(),bc=(t,e)=>{let r=z.calculateReshapedDims(e[0].dims,e[1].integerData);return t.session.pack?[t.reshapePacked(e[0],r)]:[t.reshapeUnpacked(e[0],r)]}})),yc,Wi,Tc,xc,xn,Lb,Vi,go,Hi=D((()=>{Me(),ve(),ae(),yc={name:"Upsample",inputNames:["X"],inputTypes:[0]},Wi=(t,e,r)=>(Vi(e,r),[t.run({...yc,cacheHint:r.cacheKey,get:()=>Lb(t,e,r)},e)]),Tc=t=>xn(t,7),xc=t=>xn(t,9),xn=(t,e)=>{let r=e>=10,n=t.attributes.getString("mode","nearest");if("nearest"!==n&&"linear"!==n&&(e<11||"cubic"!==n))throw new Error(`unrecognized mode: ${n}`);let i=[];e<9&&(i=t.attributes.getFloats("scales"),go(i,n,r));let s=t.attributes.getFloat("extrapolation_value",0),o=e>10?t.attributes.getString("coordinate_transformation_mode","half_pixel"):"asymmetric";if(-1===["asymmetric","pytorch_half_pixel","tf_half_pixel_for_nn","align_corners","tf_crop_and_resize","half_pixel"].indexOf(o))throw new Error(`coordinate_transform_mode '${o}' is not supported`);let a="tf_crop_and_resize"===o,u=a,l="nearest"===n&&e>=11?t.attributes.getString("nearest_mode","round_prefer_floor"):"";if(-1===["round_prefer_floor","round_prefer_ceil","floor","ceil",""].indexOf(l))throw new Error(`nearest_mode '${l}' is not supported`);let c=t.attributes.getFloat("cubic_coeff_a",-.75),h=0!==t.attributes.getInt("exclude_outside",0);if(h&&"cubic"!==n)throw new Error("exclude_outside can be set to 1 only when mode is CUBIC.");let f=e<11||"nearest"===n&&"asymmetric"===o&&"floor"===l,d=0,p=0,v=0;return e>10?t.inputs.length>2?(d=1,p=2,v=3):(p=1,v=2):9===e&&(p=1),re({opset:e,isResize:r,mode:n,scales:i,extrapolationValue:s,coordinateTransformMode:o,useExtrapolation:u,needRoiInput:a,nearestMode:l,cubicCoefficientA:c,excludeOutside:h,useNearest2xOptimization:f,roiInputIdx:d,scalesInputIdx:p,sizesInputIdx:v})},Lb=(t,e,r)=>{let n=Y(t.session.backend.glContext.version),[i,s]=t.calculateTextureWidthAndHeight(e[0].dims,0),o=e[0].dims.map(((t,e)=>Math.floor(t*r.scales[e]))),[a,u]=t.calculateTextureWidthAndHeight(o,0),l=o.length,c=new Array(l),h=new Array(l),f=`\n      int output_pitches[${l}];\n      int input_pitches[${l}];\n      `;for(let t=l-1;t>=0;t--)c[t]=t===l-1?1:c[t+1]*o[t+1],h[t]=t===l-1?1:h[t+1]*e[0].dims[t+1],f+=`\n        output_pitches[${t}] = ${c[t]};\n        input_pitches[${t}] = ${h[t]};\n        `;let d=`\n      float getInputFloat(int index) {\n        vec2 coords = offsetToCoords(index, ${i}, ${s});\n        float value = getColorAsFloat(${n.texture2D}(X, coords));\n        return value;\n      }\n      `,p="nearest"===r.mode?`\n    ${d}\n    float process(int indices[${l}]) {\n      int input_index = 0;\n      int output_index = coordsToOffset(TexCoords, ${a}, ${u});\n\n      ${f}\n\n      int d, m;\n      for (int dim = 0; dim < ${l}; ++dim) {\n        d = output_index / output_pitches[dim];\n        m = output_index - d * output_pitches[dim];\n        output_index = m;\n\n        if (scales[dim] != 1 && d > 0) {\n          int d2 = d / scales[dim];\n          m = d - d2 * scales[dim];\n          d = d2;\n        }\n        input_index += input_pitches[dim] * d;\n      }\n\n      return getInputFloat(input_index);\n    }`:4===l?`\n    ${d}\n    float process(int indices[4]) {\n      int input_index = 0;\n      int output_index = coordsToOffset(TexCoords, ${a}, ${u});\n\n      ${f}\n\n      int m;\n      int index_of_dim0, index_of_dim1, index_of_dim2, index_of_dim3;\n      index_of_dim0 = output_index / output_pitches[0];\n      m = output_index - index_of_dim0 * output_pitches[0];\n      index_of_dim1 = m / output_pitches[1];\n      m = m - index_of_dim1 * output_pitches[1];\n      index_of_dim2 = m / output_pitches[2];\n      m = m - index_of_dim2 * output_pitches[2];\n      index_of_dim3 = m;\n\n      int index_of_input_dim2, index_of_input_dim3, x_offset, y_offset;\n      index_of_input_dim2 = index_of_dim2 / scales[2];\n      y_offset = index_of_dim2 - index_of_input_dim2 * scales[2];\n      index_of_input_dim3 = index_of_dim3 / scales[3];\n      x_offset = index_of_dim3 - index_of_input_dim3 * scales[3];\n\n      input_index = index_of_dim0 * input_pitches[0] +\n            index_of_dim1 * input_pitches[1] +\n            index_of_input_dim2 * input_pitches[2] +\n            index_of_input_dim3;\n\n      float x00 = getInputFloat(input_index);\n      float x10, x01, x11;\n\n      bool end_of_dim2 = false;\n      if (index_of_input_dim2 == (${e[0].dims[2]} - 1)) {\n        // It's the end in dimension 2\n        x01 = x00;\n        end_of_dim2 = true;\n      } else {\n        x01 = getInputFloat(input_index + input_pitches[2]);\n      }\n\n      if (index_of_input_dim3 == (input_pitches[2] - 1)) {\n        // It's the end in dimension 3\n        x10 = x00;\n        x11 = x01;\n      }\n      else {\n        x10 = getInputFloat(input_index + 1);\n        x11 = end_of_dim2 ? x10 : getInputFloat(input_index + input_pitches[2] + 1);\n      }\n\n      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[2]);\n      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[2]);\n      return y0 + float(x_offset) * (y1 - y0) / float(scales[3]);\n    }`:`\n    ${d}\n    float process(int indices[2]) {\n      int input_index = 0;\n      int output_index = coordsToOffset(TexCoords, ${a}, ${u});\n\n      ${f}\n\n      int m;\n      int index_of_dim0, index_of_dim1;\n      index_of_dim0 = output_index / output_pitches[0];\n      m = output_index - index_of_dim0 * output_pitches[0];\n      index_of_dim1 = m;\n\n      int index_of_input_dim0, index_of_input_dim1, x_offset, y_offset;\n      index_of_input_dim0 = index_of_dim0 / scales[0];\n      y_offset = index_of_dim0 - index_of_input_dim0 * scales[0];\n      index_of_input_dim1 = index_of_dim1 / scales[1];\n      x_offset = index_of_dim1 - index_of_input_dim1 * scales[1];\n\n      input_index = index_of_input_dim0 * input_pitches[0] + index_of_input_dim1;\n\n      float x00 = getInputFloat(input_index);\n      float x10, x01, x11;\n\n      bool end_of_dim0 = false;\n      if (index_of_input_dim0 == (${e[0].dims[0]} - 1)) {\n        // It's the end in dimension 0\n        x01 = x00;\n        end_of_dim0 = true;\n      } else {\n        x01 = getInputFloat(input_index + input_pitches[0]);\n      }\n\n      if (index_of_input_dim1 == (input_pitches[0] - 1)) {\n        // It's the end in dimension 1\n        x10 = x00;\n        x11 = x01;\n      }\n      else {\n        x10 = getInputFloat(input_index + 1);\n        x11 = end_of_dim0 ? x10 : getInputFloat(input_index + input_pitches[0] + 1);\n      }\n\n      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[0]);\n      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[0]);\n      return y0 + float(x_offset) * (y1 - y0) / float(scales[1]);\n    }`;return{...yc,output:{dims:o,type:e[0].type,textureType:0},shaderSource:p,variables:[{name:"scales",type:"int",arrayLength:r.scales.length,data:r.scales.map((t=>Math.ceil(t)))}]}},Vi=(t,e)=>{if(!t||e.opset<9&&1!==t.length||e.opset>=9&&e.opset<11&&2!==t.length||e.opset>=11&&t.length<2)throw new Error("invalid inputs.");if(e.scales.length>0&&t[0].dims.length!==e.scales.length)throw new Error("Invalid input shape.");if("string"===t[0].type)throw new Error("Invalid input tensor types.")},go=(t,e,r)=>{if(r){for(let e of t)if(e<=0)throw new Error("Scale value should be greater than 0.")}else for(let e of t)if(e<1)throw new Error("Scale value should be greater than or equal to 1.");if(!("linear"!==e&&"cubic"!==e||2===t.length||4===t.length&&1===t[0]&&1===t[1]))throw new Error(`'Linear' mode and 'Cubic' mode only support 2-D inputs ('Bilinear', 'Bicubic')         or 4-D inputs with the corresponding outermost 2 scale values being 1         in the ${r?"Resize":"Upsample"} opeartor.`)}})),ji,qi,wc,vc,Cb,Fb,Bb,$b,_c=D((()=>{ve(),ae(),Rt(),Ir(),Hi(),ji={name:"Resize",inputNames:["A"],inputTypes:[2]},qi=(t,e,r)=>(Vi(e,r),[t.run({...ji,cacheHint:r.cacheKey,get:()=>Cb(t,e,r)},e)]),wc=t=>xn(t,10),vc=t=>xn(t,11),Cb=(t,e,r)=>{let n=Y(t.session.backend.glContext.version),[i,s]=Fb(e,r);if(i.every((t=>1===t))&&"tf_crop_and_resize"!==r.coordinateTransformMode)return{...ji,output:{dims:s,type:e[0].type,textureType:2},hasMain:!0,shaderSource:`void main() {\n                    vec4 v = ${n.texture2D}(X, TexCoords);\n                    ${n.output} = v;\n                }`};let o=s.length;if(o<2)throw new Error(`output dimension should be at least 2, but got ${o}`);let a=s[o-2],u=s[o-1],l=e[0].dims;if(o!==l.length)throw new Error(`output dimension should match input ${l.length}, but got ${o}`);let c=l[o-2],h=l[o-1],f=i[o-2],d=i[o-1],p="";if("linear"!==r.mode)throw new Error(`resize (packed) does not support mode: '${r.mode}'`);switch(r.coordinateTransformMode){case"asymmetric":p="\n                    vec4 getSourceFracIndex(ivec4 coords) {\n                        return vec4(coords) / scaleWHWH;\n                    }\n                ";break;case"half_pixel":p="\n                    vec4 getSourceFracIndex(ivec4 coords) {\n                        return (vec4(coords) + 0.5) / scaleWHWH - 0.5;\n                    }\n                ";break;case"pytorch_half_pixel":p=`\n                    vec4 getSourceFracIndex(ivec4 coords) {\n                        vec4 fcoords = vec4(coords);\n                        return vec4(\n                            ${u}.0 > 1.0 ? (fcoords.x + 0.5) / scaleWHWH.x - 0.5 : 0.0,\n                            ${a}.0 > 1.0 ? (fcoords.y + 0.5) / scaleWHWH.y - 0.5 : 0.0,\n                            ${u}.0 > 1.0 ? (fcoords.z + 0.5) / scaleWHWH.z - 0.5 : 0.0,\n                            ${a}.0 > 1.0 ? (fcoords.w + 0.5) / scaleWHWH.w - 0.5 : 0.0\n                          );\n                    }\n                `;break;case"align_corners":p=`\n                    vec4 getSourceFracIndex(ivec4 coords) {\n                        vec4 resized = vec4(${u}.0 - 1.0, ${a}.0 - 1.0, ${u}.0 - 1.0,\n                            ${a}.0 - 1.0);\n                        vec4 original = vec4(${h}.0 - 1.0, ${c}.0 - 1.0, ${h}.0 - 1.0,\n                            ${c}.0 - 1.0);\n                        vec4 new_scale = original / resized;\n                        return vec4(coords) * new_scale;\n                    }\n                `;break;default:throw new Error(`resize (packed) does not support coordinateTransformMode:                                 '${r.coordinateTransformMode}'`)}let v=Ke(o),y=`\n            const vec2 inputWH = vec2(${c}.0, ${h}.0);\n            const vec4 scaleWHWH = vec4(float(${f}), float(${d}), float(${f}), float(${d}));\n            ${Mt()}\n            ${p}\n            float getAValue(int x10, int r, int c, int d) {\n                return getChannel(getA(x10, r, c, d), vec2(c, d));\n            }\n            void main() {\n                ${v} rc = getOutputCoords();\n\n                int batch = rc[0];\n                int depth = rc[1];\n\n                // retrieve the 4 coordinates that is used in the 4 packed output values.\n                ivec4 coords = ivec4(rc.wz, rc.w + 1, rc.z + 1);\n\n                // calculate the source index in fraction\n                vec4 sourceFrac = getSourceFracIndex(coords);\n\n                // get the lower and upper bound of the 4 values that will be packed into one texel.\n                ivec4 x00 = ivec4(max(sourceFrac.xy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xy)));\n                ivec4 x01 = ivec4(max(sourceFrac.xw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xw)));\n                ivec4 x10 = ivec4(max(sourceFrac.zy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zy)));\n                ivec4 x11 = ivec4(max(sourceFrac.zw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zw)));\n\n                bool hasNextRow = rc.w < ${a-1};\n                bool hasNextCol = rc.z < ${u-1};\n\n                // pack x00, x01, x10, x11's top-left corner into one vec4 structure\n                vec4 topLeft = vec4(\n                    getAValue(batch, depth, x00.x, x00.y),\n                    hasNextCol ? getAValue(batch, depth, x01.x, x01.y) : 0.0,\n                    hasNextRow ? getAValue(batch, depth, x10.x, x10.y) : 0.0,\n                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.y) : 0.0);\n\n                // pack x00, x01, x10, x11's top-right corner into one vec4 structure\n                vec4 topRight = vec4(\n                    getAValue(batch, depth, x00.x, x00.w),\n                    hasNextCol ? getAValue(batch, depth, x01.x, x01.w) : 0.0,\n                    hasNextRow ? getAValue(batch, depth, x10.x, x10.w) : 0.0,\n                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.w) : 0.0);\n\n                // pack x00, x01, x10, x11's bottom-left corner into one vec4 structure\n                vec4 bottomLeft = vec4(\n                    getAValue(batch, depth, x00.z, x00.y),\n                    hasNextCol ? getAValue(batch, depth, x01.z, x01.y) : 0.0,\n                    hasNextRow ? getAValue(batch, depth, x10.z, x10.y) : 0.0,\n                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.y) : 0.0);\n\n                // pack x00, x01, x10, x11's bottom-right corner into one vec4 structure\n                vec4 bottomRight = vec4(\n                    getAValue(batch, depth, x00.z, x00.w),\n                    hasNextCol ? getAValue(batch, depth, x01.z, x01.w) : 0.0,\n                    hasNextRow ? getAValue(batch, depth, x10.z, x10.w) : 0.0,\n                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.w) : 0.0);\n\n                // calculate the interpolation fraction on u and v direction\n                vec4 frac = vec4(sourceFrac) - floor(sourceFrac);\n                vec4 clampFrac = clamp(frac, vec4(0.0), vec4(1.0));\n\n                vec4 top = mix(topLeft, topRight, clampFrac.ywyw);\n                vec4 bottom = mix(bottomLeft, bottomRight, clampFrac.ywyw);\n                vec4 newValue = mix(top, bottom, clampFrac.xxzz);\n\n                ${n.output} = vec4(newValue);\n            }\n        `;return{...ji,output:{dims:s,type:e[0].type,textureType:2},hasMain:!0,shaderSource:y}},Fb=(t,e)=>{let r,n=t[0].dims,i=e.scales;if(0===i.length){let s=t[e.scalesInputIdx];if(s&&0!==s.size){if(t[e.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");i=Bb(s,e.mode,e.isResize)}else{let s=t[e.sizesInputIdx];if(!s||0===s.size)throw new Error("Either scales or sizes MUST be provided as input.");r=Array.from(s.integerData),i=$b(r,n,e.mode,e.isResize)}}else if(t[e.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");let s=r||n.map(((t,e)=>Math.floor(t*i[e])));return[i,s]},Bb=(t,e,r)=>{let n=Array.from(t.floatData);return go(n,e,r),n},$b=(t,e,r,n)=>{let i=e.length,s=new Array(i);for(let r=0,n=i;r<n;r++)if(0===e[r]){if(0!==t[r])throw new Error("Input dim is zero but required output dim is non-zero.");s[r]=1}else s[r]=t[r]/e[r];return go(s,r,n),s}})),Oc,kb,Sc=D((()=>{Sr(),Oc=(t,e)=>(kb(e),[new Be([e[0].dims.length],"int32",void 0,void 0,new Int32Array(e[0].dims))]),kb=t=>{if(!t||1!==t.length)throw new Error("Shape requires 1 input.")}})),Yi,Ic,Ac,Ec,Nb,Pc,Rb,Mb,Dc=D((()=>{Me(),Tn(),fe(),ae(),Yi={name:"Slice",inputNames:["A"],inputTypes:[0]},Ic=(t,e,r)=>(Nb(e),[t.run({...Yi,cacheHint:r.cacheKey,get:()=>Ec(t,e[0],r)},e)]),Ac=t=>{let e=t.attributes.getInts("starts"),r=t.attributes.getInts("ends"),n=t.attributes.getInts("axes",[]);return re({starts:e,ends:r,axes:n})},Ec=(t,e,r)=>{let n=0===r.axes.length?e.dims.slice(0).map(((t,e)=>e)):r.axes,i=z.normalizeAxes(n,e.dims.length),s=r.starts.map(((t,r)=>t>e.dims[i[r]]-1?e.dims[i[r]]:z.normalizeAxis(t,e.dims[i[r]]))),o=r.ends.map(((t,r)=>t>e.dims[i[r]]-1?e.dims[i[r]]:z.normalizeAxis(t,e.dims[i[r]]))),a=e.dims.slice(),u=[];for(let t=0;t<i.length;t++)a[i[t]]=o[t]-s[t],s[t]>0&&u.push(`outputIdx[${i[t]}] += ${s[t]};`);let l=`\n      float process(int outputIdx[${a.length}]) {\n        ${u.join("\n      ")}\n        return _A(outputIdx);\n      }`;return{...Yi,output:{dims:a,type:e.type,textureType:0},shaderSource:l}},Nb=t=>{if(!t||1!==t.length)throw new Error("Slice requires 1 input.");if(-1===rr.indexOf(t[0].type))throw new Error("Invalid input type.")},Pc=(t,e)=>{Mb(e);let r=Rb(t,e);return[t.run({...Yi,cacheHint:r.cacheKey,get:()=>Ec(t,e[0],r)},[e[0]])]},Rb=(t,e)=>{if(!t.session.isInitializer(e[1].dataId)||!t.session.isInitializer(e[2].dataId)||e.length>=4&&!t.session.isInitializer(e[3].dataId)||e.length>=5&&!t.session.isInitializer(e[4].dataId))throw new Error("dynamic slice attributes are not allowed");if(e.length>=5&&e[4].integerData.some((t=>1!==t)))throw new Error("currently non-1 steps is not supported for Slice");let r=Array.from(e[1].integerData),n=Array.from(e[2].integerData),i=e.length>=4?Array.from(e[3].integerData):[];return{starts:r,ends:n,axes:i,cacheKey:`${i};${r};${n}`}},Mb=t=>{if(!t||t.length<3||t.length>5)throw new Error("Invalid input number.");if("int32"!==t[1].type||1!==t[1].dims.length)throw new Error("Invalid input type.");if("int32"!==t[2].type||1!==t[2].dims.length)throw new Error("Invalid input type.");if(t.length>=4&&("int32"!==t[3].type||1!==t[3].dims.length))throw new Error("Invalid input type.");if(t.length>=5&&("int32"!==t[4].type||1!==t[4].dims.length))throw new Error("Invalid input type.")}})),Lc,Cc,Fc,Bc,$c,kc,Nc,Rc,Gb,Ub,zb,Mc,Gc=D((()=>{Me(),fe(),ve(),ae(),ho(),Lc={name:"SoftmaxComputeMax",inputNames:["A"],inputTypes:[0]},Cc={name:"SoftmaxComputeScale",inputNames:["A","Max"],inputTypes:[0,0]},Fc={name:"SoftMax",inputNames:["A","Max","Norm"],inputTypes:[0,0,0]},Bc=(t,e,r)=>{Mc(e);let n=e[0].dims.slice(),i=z.normalizeAxis(r.axis,n.length),s=z.sizeToDimension(n,i),o=z.sizeFromDimension(n,i);return Rc(t,e,r,s,o)},$c=t=>re({axis:t.attributes.getInt("axis",1)}),kc=t=>re({axis:t.attributes.getInt("axis",-1)}),Nc=(t,e,r)=>{Mc(e);let n,i=e[0].dims.slice(),s=z.normalizeAxis(r.axis,i.length),o=i.length,a=s!==o-1,u=[],l=[],c=[];a&&(l=Array.from({length:o}).map(((t,e)=>e)),l[s]=o-1,l[o-1]=s,l.map((t=>u.push(i[t]))),n=re({perm:l}),c=Er(t,e,n));let h=a?z.sizeToDimension(u,o-1):z.sizeToDimension(i,o-1),f=a?z.sizeFromDimension(u,o-1):z.sizeFromDimension(i,o-1),d=Rc(t,a?c:e,r,h,f);return a?Er(t,d,n):d},Rc=(t,e,r,n,i)=>{let s=Gb(t,e[0],n,i,[n]),o=t.run({...Lc,cacheHint:r.cacheKey,get:()=>s},e),a=Ub(t,e[0],n,i,s.output.dims,[n]),u=t.run({...Cc,cacheHint:r.cacheKey,get:()=>a},[e[0],o]),l=zb(t,e[0],n,i,s.output.dims,a.output.dims);return[t.run({...Fc,cacheHint:r.cacheKey,get:()=>l},[e[0],o,u])]},Gb=(t,e,r,n,i)=>{let[s,o]=t.calculateTextureWidthAndHeight(e.dims,0),a=i.length;if(r<1||n<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(1!==i.length)throw new Error("Dimensionality of the output should be 1");if(i[0]!==r)throw new Error("Shape of the output should be equal to logical row count");let u=Y(t.session.backend.glContext.version),l=`\n      float process(int[${a}] indices) {\n        int logical_row_start_offset = indices[0] * ${n};\n\n        float max = getColorAsFloat(${u.texture2D}(A, offsetToCoords(logical_row_start_offset, ${s},\n        ${o} )));\n        for(int i=1; i<${n}; ++i)\n        {\n          float current = getColorAsFloat(${u.texture2D}(A, offsetToCoords(logical_row_start_offset + i,\n            ${s}, ${o})));\n          if(current > max)\n          max = current;\n        }\n\n        return max;\n      }`;return{...Lc,output:{dims:i,type:e.type,textureType:0},shaderSource:l}},Ub=(t,e,r,n,i,s)=>{let[o,a]=t.calculateTextureWidthAndHeight(e.dims,0),u=s.length;if(r<1||n<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(1!==s.length)throw new Error("Dimensionality of the output should be 1");if(s[0]!==r)throw new Error("Shape of the output should be equal to logical row count");if(1!==i.length)throw new Error("Dimensionality of the intermediate results should be 1");if(i[0]!==r)throw new Error("Shape of the intermediate results should be equal to logical row count");let l=`\n      float process(int[${u}] indices) {\n        int logical_row_start_offset = indices[0] * ${n};\n\n        float norm_factor = 0.0;\n        float max = _Max(indices);\n        for(int i=0; i<${n}; ++i)\n        {\n          norm_factor += exp(getColorAsFloat(${Y(t.session.backend.glContext.version).texture2D}(A, offsetToCoords(logical_row_start_offset + i,\n            ${o}, ${a}))) - max);\n        }\n\n        return norm_factor;\n      }`;return{...Cc,output:{dims:s,type:e.type,textureType:0},shaderSource:l}},zb=(t,e,r,n,i,s)=>{let[o,a]=t.calculateTextureWidthAndHeight(e.dims,0),u=e.dims.length;if(r<1||n<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(1!==i.length||1!==s.length)throw new Error("Dimensionality of the intermediate results should be 1");if(i[0]!==r||s[0]!==r)throw new Error("Shape of the intermediate results should be equal to logical row count");let l=`\n      float process(int[${u}] indices) {\n\n      // get offset of current logical tensor index from the 2-D texture coordinates (TexCoords)\n      int offset = coordsToOffset(TexCoords, ${o}, ${a});\n\n      //determine the logical row for this index\n      int logical_row_index[1];\n      logical_row_index[0] = offset / ${n};\n\n      float norm_factor = _Norm(logical_row_index);\n\n      // avoid possible division by 0\n      // if norm_facor is 0, all elements are zero\n      // if so, return 0\n      if(norm_factor == 0.0)\n        return 0.0;\n\n      return exp(_A(indices) - _Max(logical_row_index)) / norm_factor;\n    }`;return{...Fc,output:{dims:e.dims,type:e.type,textureType:0},shaderSource:l}},Mc=t=>{if(!t||1!==t.length)throw new Error("Softmax requires 1 input.");if("float32"!==t[0].type&&"float64"!==t[0].type)throw new Error("Invalid input type")}})),Uc,zc,Wc,Wb,Vb,Hb,Vc=D((()=>{Me(),fe(),ae(),Uc={name:"Split",inputNames:["A"],inputTypes:[0]},zc=(t,e,r)=>{Hb(e);let n=z.normalizeAxis(r.axis,e[0].dims.length),i=Wb(t,e,n,r),s=[];for(let o=0;o<i;++o)s.push(t.run({...Uc,cacheHint:`${r.cacheKey};${o}`,get:()=>Vb(t,e[0],r,n,o)},e));return s},Wc=t=>{let e=t.attributes.getInt("axis",0),r=t.attributes.getInts("split",[]),n=t.outputs.length;return re({axis:e,split:r,numOutputs:n})},Wb=(t,e,r,n)=>{let[,i]=dn.splitShape(e[0].dims,r,n.split,n.numOutputs);return i.length},Vb=(t,e,r,n,i)=>{let[s,o]=dn.splitShape(e.dims,n,r.split,r.numOutputs),a=o[i],u=s[i],l=`\n      float process(int indices[${u.length}]) {\n        indices[${n}] += ${a};\n        return _A(indices);\n      }\n    `;return{...Uc,cacheHint:`${r.cacheKey}:${i}`,output:{dims:u,type:e.type,textureType:0},shaderSource:l}},Hb=t=>{if(!t||1!==t.length)throw new Error("Split requires one input.");if("int8"!==t[0].type&&"uint8"!==t[0].type&&"int16"!==t[0].type&&"uint16"!==t[0].type&&"int32"!==t[0].type&&"uint32"!==t[0].type&&"float32"!==t[0].type&&"float64"!==t[0].type&&"bool"!==t[0].type)throw new Error("Invalid input type.")}})),Xi,Hc,jc,jb,qb,qc=D((()=>{fe(),Xi=(t,e,r)=>{jb(e);let n=z.squeezeShape(e[0].dims,r);return[t.reshapeUnpacked(e[0],n)]},Hc=(t,e)=>(qb(e),Xi(t,[e[0]],Array.from(e[1].integerData))),jc=t=>t.attributes.getInts("axes"),jb=t=>{if(!t||1!==t.length)throw new Error("Squeeze requires 1 input.");if("string"===t[0].type)throw new Error("invalid input tensor types.")},qb=t=>{if(!t||2!==t.length)throw new Error("Squeeze requires 2 inputs.");if("int32"!==t[1].type)throw new Error("Invalid input type.")}})),Yc,Yb,Xb,Xc=D((()=>{ve(),ae(),Yc=(t,e)=>{Xb(e);let r={name:"Sum",inputNames:e.map(((t,e)=>`X${e}`)),inputTypes:new Array(e.length).fill(0)};return[t.run({...r,get:()=>Yb(t,e,r)},e)]},Yb=(t,e,r)=>{let n=Y(t.session.backend.glContext.version),i=e[0].dims.slice(),s=`\n      void main() {\n        vec4 result = ${e.map(((t,e)=>`${n.texture2D}(X${e},TexCoords)`)).join(" + ")};\n        ${n.output} = result;\n      }\n    `;return{...r,output:{dims:i,type:e[0].type,textureType:0},hasMain:!0,shaderSource:s}},Xb=t=>{if(!t||0===t.length)throw new Error("Sum requires inputs.");let e=t[0].dims.length;for(let r=1;r<t.length;r++){if(e!==t[r].dims.length)throw new Error("Input shapes are mismatched.");for(let n=0;n<e;n++)if(t[0].dims[n]!==t[r].dims[n])throw new Error("Input shapes are not matched.")}if("float32"!==t[0].type&&"float64"!==t[0].type)throw new Error("Invalid input type.");for(let e=1;e<t.length;e++)if(t[0].type!==t[e].type)throw new Error("Input types are not matched.")}})),Kc,Kb,Jb,Jc=D((()=>{Tn(),ae(),Kc=(t,e)=>{Jb(e);let r={name:"Tile",inputNames:["A"],inputTypes:[0]};return[t.run({...r,get:()=>Kb(t,e,r)},e)]},Kb=(t,e,r)=>{let n=e[0].dims.slice(),i=new Array(n.length),s=[];for(let t=0;t<n.length;t++)i[t]=n[t]*e[1].numberData[t],s.push(`inputIdx[${t}] = int(mod(float(outputIdx[${t}]), ${n[t]}.));`);let o=i.length,a=`\n      float process(int outputIdx[${o}]) {\n        int inputIdx[${o}];\n        ${s.join("\n")}\n        return _A(inputIdx);\n      }\n    `;return{...r,output:{dims:i,type:e[0].type,textureType:0},shaderSource:a}},Jb=t=>{if(!t||2!==t.length)throw new Error("Tile requires 2 input.");if(1!==t[1].dims.length)throw new Error("The second input shape must 1 dimension.");if(t[1].dims[0]!==t[0].dims.length)throw new Error("Invalid input shape.");if(-1===rr.indexOf(t[0].type))throw new Error("Invalid input type.");if("int32"!==t[1].type&&"int16"!==t[1].type)throw new Error("Invalid repeat type.")}})),Ki,Zc,Qc,Zb,Qb,ep=D((()=>{fe(),Ki=(t,e,r)=>{Zb(e);let n=z.unsqueezeShape(e[0].dims,r);return[t.reshapeUnpacked(e[0],n)]},Zc=(t,e)=>(Qb(e),Ki(t,[e[0]],Array.from(e[1].integerData))),Qc=t=>t.attributes.getInts("axes"),Zb=t=>{if(!t||1!==t.length)throw new Error("Unsqueeze requires 1 input.");if("string"===t[0].type)throw new Error("invalid input tensor types.")},Qb=t=>{if(!t||2!==t.length)throw new Error("Unsqueeze requires 2 inputs.");if("int32"!==t[1].type)throw new Error("Invalid input type.")}})),tp,rp=D((()=>{cl(),Ol(),Al(),Fl(),fo(),gf(),_f(),If(),Pf(),Ff(),kf(),Gf(),Vf(),co(),Yf(),sc(),mc(),gc(),_c(),Sc(),Dc(),Gc(),Vc(),qc(),Xc(),Jc(),ho(),Fi(),ep(),Hi(),tp=[["Abs","","6+",Bl],["Acos","","7+",$l],["Add","","7+",pl],["And","","7+",dl],["Asin","","7+",kl],["Atan","","7+",Nl],["AveragePool","","7+",Kf,Jf],["BatchNormalization","","7+",ll,fl],["Cast","","6+",Sl,Il],["Ceil","","6+",Gl],["Clip","","6-10",Li,Rl],["Clip","","11+",Ml],["Concat","","4+",Dl,Cl],["Conv","","1+",Mi,Gi],["ConvTranspose","","1+",mf,bf],["Cos","","7+",Ul],["Div","","7+",hl],["Dropout","","7+",Ci],["DepthToSpace","","1+",wf,vf],["Equal","","7+",ml],["Elu","","6+",zl,Wl],["Exp","","6+",Vl],["Flatten","","1+",Of,Sf],["Floor","","6+",Hl],["FusedConv","com.microsoft","1+",Mi,Gi],["Gather","","1+",Af,Ef],["Gemm","","7-10",Ui,Lf],["Gemm","","11+",Ui,Cf],["GlobalAveragePool","","1+",Qf,ec],["GlobalMaxPool","","1+",ic],["Greater","","7+",bl],["Identity","","1+",Ci],["ImageScaler","","1+",Bf,$f],["InstanceNormalization","","6+",Rf,Mf],["LeakyRelu","","6+",jl,ql],["Less","","7+",gl],["LRN","","1+",Uf,zf],["Log","","6+",Yl],["MatMul","","1+",uf,lf],["MaxPool","","1+",tc,rc],["Mul","","7+",yl],["Neg","","6+",Xl],["Not","","1+",Kl],["Or","","7+",Tl],["Pad","","2-10",zi,Hf],["Pad","","11+",jf,qf],["Pow","","7+",xl],["PRelu","","7+",wl],["ReduceLogSum","","1+",dc,nr],["ReduceMax","","1+",fc,nr],["ReduceMean","","1+",lc,nr],["ReduceMin","","1+",cc,nr],["ReduceProd","","1+",pc,nr],["ReduceSum","","1-12",uc,nr],["ReduceSumSquare","","1+",hc,nr],["Relu","","6+",Jl],["Reshape","","5+",bc],["Resize","","10",qi,wc],["Resize","","11+",qi,vc],["Shape","","1+",Oc],["Sigmoid","","6+",Zl],["Sin","","7+",Ql],["Slice","","10+",Pc],["Slice","","1-9",Ic,Ac],["Softmax","","1-12",Bc,$c],["Softmax","","13+",Nc,kc],["Split","","2-12",zc,Wc],["Sqrt","","6+",ef],["Squeeze","","1-12",Xi,jc],["Squeeze","","13+",Hc],["Sub","","7+",vl],["Sum","","6+",Yc],["Tan","","7+",tf],["Tanh","","6+",rf],["Tile","","6+",Kc],["Transpose","","1+",Er,Tf],["Upsample","","7-8",Wi,Tc],["Upsample","","9",Wi,xc],["Unsqueeze","","1-12",Ki,Qc],["Unsqueeze","","13+",Zc],["Xor","","7+",_l]]}));function op(t){let e,r={};for(;null!==(e=np.exec(t));){let t=e[3].split(",").map((t=>{let e=t.trim().split(" ");return e&&2===e.length?{type:e[0],name:e[1]}:null})).filter((t=>null!==t));r[e[2]]={params:t,body:e[4]}}for(let n in r){let i=eg.replace("__FUNC__",n),s=new RegExp(i,"gm");for(;null!==(e=s.exec(t));){let i=e[1],s=e[2],o=e[3].split(","),a=i?`${i} ${s};`:"",u=r[n].body,l="";r[n].params.forEach(((t,e)=>{t&&(l+=`${t.type} ${t.name} = ${o[e]};\n`)})),u=`${l}\n ${u}`,u=u.replace("return",`${s} = `);let c=`\n      ${a}\n      {\n        ${u}\n      }\n      `;t=t.replace(e[0],c)}}return t=t.replace(np,"")}var np,eg,ip=D((()=>{np=/@inline[\s\n\r]+(\w+)[\s\n\r]+([0-9a-zA-Z_]+)\s*\(([^)]*)\)\s*{(([^}]|[\n\r])*)}/gm,eg="(\\w+)?\\s+([_0-9a-zA-Z]+)\\s+=\\s+__FUNC__\\((.*)\\)\\s*;"}));function Yr(t,e){let r=[],n=[],i=null!=e&&Array.isArray(e)&&0===e.length,s=null==e||i?null:tg(e,t).sort(),o=0;for(let e=0;e<t.length;++e){if(null!=s){if(s[o]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==s[o]||s[o]>e)&&1===t[e]&&(r.push(t[e]),n.push(e)),s[o]<=e&&o++}1!==t[e]&&(r.push(t[e]),n.push(e))}return{newShape:r,keptDims:n}}function tg(t,e){let r=e.length;return zr((t=null==t?e.map(((t,e)=>e)):[].concat(t)).every((t=>t>=-r&&t<r)),(()=>`All values in axis param must be in range [-${r}, ${r}) but got axis ${t}`)),zr(t.every(rg),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?r+t:t))}function rg(t){return t%1==0}function ng(t){if(0===t.length)return 1;let e=t[0];for(let r=1;r<t.length;r++)e*=t[r];return e}function ap(t){let e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}var yo,Ji=D((()=>{pt(),fe(),yo=class{constructor(t){this.maxTextureSize=t}computeTextureWH(t,e){let r=this.computeTexture(t,e);return e&&e.isPacked&&(r[0]/=2,r[1]/=2),e&&e.reverseWH?[r[1],r[0]]:r}computeTexture(t,e){let r=e&&e.isPacked;if(0===t.length)return r?[2,2]:[1,1];let n=this.maxTextureSize;if(e&&void 0!==e.breakAxis){let r=e.breakAxis>=t.length?1:t.slice(e.breakAxis).reduce(((t,e)=>t*e)),i=e.breakAxis<=0?1:t.slice(0,e.breakAxis).reduce(((t,e)=>t*e));if(!(r>n||i>n))return[r,i];pe.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${t}, breakAxis:${e.breakAxis}`)}let i=t.slice(0);r&&(n*=2,i=i.map(((t,e)=>e>=i.length-2?i[e]%2==0?i[e]:i[e]+1:i[e])),1===i.length&&(i=[2,i[0]])),2!==i.length&&(i=Yr(i).newShape);let s=ng(i);return i.length<=1&&s<=n?[1,s]:2===i.length&&i[0]<=n&&i[1]<=n?i:3===i.length&&i[0]*i[1]<=n&&i[2]<=n?[i[0]*i[1],i[2]]:3===i.length&&i[0]<=n&&i[1]*i[2]<=n?[i[0],i[1]*i[2]]:4===i.length&&i[0]*i[1]*i[2]<=n&&i[3]<=n?[i[0]*i[1]*i[2],i[3]]:4===i.length&&i[0]<=n&&i[1]*i[2]*i[3]<=n?[i[0],i[1]*i[2]*i[3]]:r?ap(s/4).map((t=>2*t)):ap(s)}}})),To,sp=D((()=>{fe(),Xt(),ve(),Ji(),Rt(),To=class extends bt{constructor(t){super(t)}getFunctions(){return{...this.offsetToCoords(),...this.coordsToOffset(),...this.toVec(),...this.valueFrom(),...this.getCommonUtilFuncs(),...this.getInputsSamplingSnippets(),...this.getOutputSamplingSnippet()}}getCustomTypes(){return{}}offsetToCoords(){return{offsetToCoords:new G("\n      vec2 offsetToCoords(int offset, int width, int height) {\n        int t = offset / width;\n        int s = offset - t*width;\n        vec2 coords = (vec2(s,t) + vec2(0.5,0.5)) / vec2(width, height);\n        return coords;\n      }\n      ")}}coordsToOffset(){return{coordsToOffset:new G("\n      int coordsToOffset(vec2 coords, int width, int height) {\n        float s = coords.s * float(width);\n        float t = coords.t * float(height);\n        int offset = int(t) * width + int(s);\n        return offset;\n      }\n      ")}}getOutputSamplingSnippet(){let t=this.context.outputTextureLayout;return t.isPacked?this.getPackedOutputSamplingSnippet(t):this.getUnpackedOutputSamplingSnippet(t)}getPackedOutputSamplingSnippet(t){let e=t.unpackedShape,r=[t.width,t.height],n={},i="getOutputCoords";switch(e.length){case 0:n[i]=this.getOutputScalarCoords();break;case 1:n[i]=this.getOutputPacked1DCoords(e,r);break;case 2:n[i]=this.getOutputPacked2DCoords(e,r);break;case 3:n[i]=this.getOutputPacked3DCoords(e,r);break;default:n[i]=this.getOutputPackedNDCoords(e,r)}let s=`\n      void setOutput(vec4 val) {\n        ${Y(this.context.glContext.version).output} = val;\n      }\n    `;return n.floatTextureSetRGBA=new G(s),n}getUnpackedOutputSamplingSnippet(t){let e=t.unpackedShape,r=[t.width,t.height],n={},i="getOutputCoords";switch(e.length){case 0:n[i]=this.getOutputScalarCoords();break;case 1:n[i]=this.getOutputUnpacked1DCoords(e,r);break;case 2:n[i]=this.getOutputUnpacked2DCoords(e,r);break;case 3:n[i]=this.getOutputUnpacked3DCoords(e,r);break;case 4:n[i]=this.getOutputUnpacked4DCoords(e,r);break;case 5:n[i]=this.getOutputUnpacked5DCoords(e,r);break;case 6:n[i]=this.getOutputUnpacked6DCoords(e,r);break;default:throw new Error(`Unsupported output dimensionality: ${e.length}`)}let s=`\n        void setOutput(float val) {\n          ${Y(this.context.glContext.version).output} = vec4(val, 0, 0, 0);\n        }\n    `;return n.floatTextureSetR=new G(s),n}getOutputScalarCoords(){return new G("\n      int getOutputCoords() {\n        return 0;\n      }\n    ")}getOutputPacked1DCoords(t,e){let r=e,n="";return 1===r[0]?(n=`\n          int getOutputCoords() {\n            return 2 * int(TexCoords.y * ${r[1]}.0);\n          }\n        `,new G(n)):1===r[1]?(n=`\n          int getOutputCoords() {\n            return 2 * int(TexCoords.x * ${r[0]}.0);\n          }\n        `,new G(n)):(n=`\n        int getOutputCoords() {\n          ivec2 resTexRC = ivec2(TexCoords.xy *\n                                 vec2(${r[0]}, ${r[1]}));\n          return 2 * (resTexRC.y * ${r[0]} + resTexRC.x);\n        }\n      `,new G(n))}getOutputPacked2DCoords(t,e){let r="";if(wr.arraysEqual(t,e))return r=`\n        ivec2 getOutputCoords() {\n          return 2 * ivec2(TexCoords.xy * vec2(${e[0]}, ${e[1]}));\n        }\n      `,new G(r);let n=e,i=Math.ceil(t[1]/2);return r=`\n        ivec2 getOutputCoords() {\n          ivec2 resTexRC = ivec2(TexCoords.xy *\n                                vec2(${n[0]}, ${n[1]}));\n\n          int index = resTexRC.y * ${n[0]} + resTexRC.x;\n\n          // reverse r and c order for packed texture\n          int r = imod(index, ${i}) * 2;\n          int c = 2 * (index / ${i});\n\n          return ivec2(r, c);\n        }\n      `,new G(r)}getOutputPacked3DCoords(t,e){let r=[e[0],e[1]],n=Math.ceil(t[2]/2),i=n*Math.ceil(t[1]/2);return new G(`\n        ivec3 getOutputCoords() {\n          ivec2 resTexRC = ivec2(TexCoords.xy *\n                                vec2(${r[0]}, ${r[1]}));\n          int index = resTexRC.y * ${r[0]} + resTexRC.x;\n\n          int b = index / ${i};\n          index -= b * ${i};\n\n          // reverse r and c order for packed texture\n          int r = imod(index, ${n}) * 2;\n          int c = 2 * (index / ${n});\n\n          return ivec3(b, r, c);\n        }\n      `)}getOutputPackedNDCoords(t,e){let r=[e[0],e[1]],n=Math.ceil(t[t.length-1]/2),i=n*Math.ceil(t[t.length-2]/2),s=i,o="",a="b, r, c";for(let e=2;e<t.length-1;e++)s*=t[t.length-e-1],o=`\n      int b${e} = index / ${s};\n      index -= b${e} * ${s};\n    `+o,a=`b${e}, `+a;let u=`\n      ivec${t.length} getOutputCoords() {\n        ivec2 resTexRC = ivec2(TexCoords.xy *\n                              vec2(${r[0]}, ${r[1]}));\n        int index = resTexRC.y * ${r[0]} + resTexRC.x;\n\n        ${o}\n\n        int b = index / ${i};\n        index -= b * ${i};\n\n        // reverse r and c order for packed texture\n        int r = imod(index, ${n}) * 2;\n        int c = 2 * (index / ${n});\n\n        return ivec${t.length}(${a});\n      }\n    `;return new G(u)}getOutputUnpacked1DCoords(t,e){let r=`\n        int getOutputCoords() {\n          ivec2 resTexRC = ivec2(TexCoords.xy *\n                                vec2(${e[0]}, ${e[1]}));\n          return resTexRC.y * ${e[0]} + resTexRC.x;\n        }\n      `;return new G(r)}getOutputUnpacked2DCoords(t,e){let r=`\n        ivec2 getOutputCoords() {\n          ivec2 resTexRC = ivec2(TexCoords.xy *\n                                vec2(${e[0]}, ${e[1]}));\n          int index = resTexRC.y * ${e[0]} + resTexRC.x;\n          int r = index / ${t[1]};\n          int c = index - r * ${t[1]};\n          return ivec2(r, c);\n        }\n      `;return new G(r)}getOutputUnpacked3DCoords(t,e){let r="",n=t.length,i=null;n<2&&(i=[]),i=new Array(n-1),i[n-2]=t[n-1];for(let e=n-3;e>=0;--e)i[e]=i[e+1]*t[e+1];let s=["r","c","d"],o=i.map(((t,e)=>`${`int ${s[e]} = index / ${t}`}; ${e===i.length-1?`int ${s[e+1]} = index - ${s[e]} * ${t}`:`index -= ${s[e]} * ${t}`};`)).join("");return r=`\n        ivec3 getOutputCoords() {\n          ivec2 resTexRC = ivec2(TexCoords.xy *\n                                vec2(${e[0]}, ${e[1]}));\n          int index = resTexRC.y * ${e[0]} + resTexRC.x;\n          ${o}\n          return ivec3(r, c, d);\n        }\n      `,new G(r)}getOutputUnpacked4DCoords(t,e){let r="",n=t.length,i=null;n<2&&(i=[]),i=new Array(n-1),i[n-2]=t[n-1];for(let e=n-3;e>=0;--e)i[e]=i[e+1]*t[e+1];let s=["r","c","d","d2"],o=i.map(((t,e)=>`${`int ${s[e]} = index / ${t}`}; ${e===i.length-1?`int ${s[e+1]} = index - ${s[e]} * ${t}`:`index -= ${s[e]} * ${t}`};`)).join("");return r=`\n      ivec4 getOutputCoords() {\n          ivec2 resTexRC = ivec2(TexCoords.xy *\n                                vec2(${e[0]}, ${e[1]}));\n          int index = resTexRC.y * ${e[0]} + resTexRC.x;\n          ${o}\n          return ivec4(r, c, d, d2);\n        }\n      `,new G(r)}getOutputUnpacked5DCoords(t,e){let r="",n=t.length,i=null;n<2&&(i=[]),i=new Array(n-1),i[n-2]=t[n-1];for(let e=n-3;e>=0;--e)i[e]=i[e+1]*t[e+1];let s=["r","c","d","d2","d3"],o=i.map(((t,e)=>`${`int ${s[e]} = index / ${t}`}; ${e===i.length-1?`int ${s[e+1]} = index - ${s[e]} * ${t}`:`index -= ${s[e]} * ${t}`};`)).join("");return r=`\n      ivec5 getOutputCoords() {\n          ivec2 resTexRC = ivec2(TexCoords.xy *\n                                vec2(${e[0]}, ${e[1]}));\n          int index = resTexRC.y * ${e[0]} + resTexRC.x;\n          ${o}\n          return ivec5(r, c, d, d2, d3);\n        }\n      `,new G(r)}getOutputUnpacked6DCoords(t,e){let r="",n=t.length,i=null;n<2&&(i=[]),i=new Array(n-1),i[n-2]=t[n-1];for(let e=n-3;e>=0;--e)i[e]=i[e+1]*t[e+1];let s=["r","c","d","d2","d3","d4"],o=i.map(((t,e)=>`${`int ${s[e]} = index / ${t}`}; ${e===i.length-1?`int ${s[e+1]} = index - ${s[e]} * ${t}`:`index -= ${s[e]} * ${t}`};`)).join("");return r=`\n     ivec6 getOutputCoords() {\n         ivec2 resTexRC = ivec2(TexCoords.xy *\n                               vec2(${e[0]}, ${e[1]}));\n         int index = resTexRC.y * ${e[0]} + resTexRC.x;\n         ${o}\n         return ivec6(r, c, d, d2, d3, d4);\n       }\n     `,new G(r)}getCommonUtilFuncs(){let t={},e="uvFromFlat";t[e]=new G("\n    vec2 uvFromFlat(int texNumR, int texNumC, int index) {\n      int texC = index / texNumR;\n      int texR = index - texC * texNumR;\n      // TODO: swap texR, texC order in following function so row is corresponding to u and column is corresponding to\n      //       v.\n      return (vec2(texR, texC) + halfCR) / vec2(texNumR, texNumC);\n    }\n    "),e="packedUVfrom1D",t[e]=new G("\n      vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n        int texelIndex = index / 2;\n        int texR = texelIndex / texNumC;\n        int texC = texelIndex - texR * texNumC;\n        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n      }\n      "),e="packedUVfrom2D",t[e]=new G("\n      vec2 packedUVfrom2D(int texNumR, int texNumC, int texelsInLogicalRow, int row, int col) {\n        int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n        int texR = texelIndex / texNumC;\n        int texC = texelIndex - texR * texNumC;\n        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n      }\n      "),e="packedUVfrom3D",t[e]=new G("\n      vec2 packedUVfrom3D(int texNumR, int texNumC,\n          int texelsInBatch, int texelsInLogicalRow, int b,\n          int row, int col) {\n        int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n        int texR = index / texNumC;\n        int texC = index - texR * texNumC;\n        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n      }\n      "),e="sampleTexture";let r=Y(this.context.glContext.version);return t[e]=new G(`\n        float sampleTexture(sampler2D textureSampler, vec2 uv) {\n            return ${r.texture2D}(textureSampler, uv).r;\n        }`),t}getInputsSamplingSnippets(){let t={},e=this.context.outputTextureLayout;return this.context.programInfo.inputNames.forEach(((r,n)=>{let i=this.context.inputTextureLayouts[n],s=no(r);i.isPacked?t[s]=this.getPackedSamplerFromInput(s,r,i):t[s]=this.getUnpackedSamplerFromInput(s,r,i);let o=qu(r);i.unpackedShape.length<=e.unpackedShape.length&&(i.isPacked?t[o]=this.getPackedSamplerAtOutputCoords(o,i,e,r):t[o]=this.getUnpackedSamplerAtOutputCoords(o,i,e,r))})),t}getPackedSamplerAtOutputCoords(t,e,r,n){let i,s=e.unpackedShape,o=r.unpackedShape,a=no(n),u=s.length,l=o.length,c=Xe.getBroadcastDims(s,o),h=Ke(l),f=l-u,d=Et();i=0===u?"":l<2&&c.length>=1?"coords = 0;":c.map((t=>`coords.${d[t+f]} = 0;`)).join("\n");let p="";p=l<2&&u>0?"coords":s.map(((t,e)=>`coords.${d[e+f]}`)).join(", ");let v="return outputValue;",y=1===z.size(s),b=1===z.size(o);if(1!==u||y||b){if(y&&!b)v=1===l?"\n          return vec4(outputValue.x, outputValue.x, 0., 0.);\n        ":"\n          return vec4(outputValue.x);\n        ";else if(c.length){let t=u-2,e=u-1;c.indexOf(t)>-1&&c.indexOf(e)>-1?v="return vec4(outputValue.x);":c.indexOf(t)>-1?v="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(e)>-1&&(v="return vec4(outputValue.xx, outputValue.zz);")}}else v="\n        return vec4(outputValue.xy, outputValue.xy);\n      ";let _=`\n        int lastDim = coords.${d[l-1]};\n        coords.${d[l-1]} = coords.${d[l-2]};\n        coords.${d[l-2]} = lastDim;\n      `;return new G(`\n      vec4 ${t}() {\n        ${h} coords = getOutputCoords();\n        ${_}\n        ${i}\n        vec4 outputValue = ${a}(${p});\n        ${v}\n      }\n    `,["coordinates.getOutputCoords"])}getUnpackedSamplerAtOutputCoords(t,e,r,n){let i=[r.width,r.height],s=[e.width,e.height],o=e.unpackedShape.length,a=r.unpackedShape.length,u=e.unpackedShape,l=r.unpackedShape,c=no(n);if(o===a&&wr.arraysEqual(s,i)){return new G(`\n          float ${t}() {\n            return sampleTexture(${n}, TexCoords);\n          }\n        `,["coordinates.sampleTexture"])}let h,f=Ke(a),d=Xe.getBroadcastDims(u,l),p=a-o,v=Et();h=0===o?"":a<2&&d.length>=1?"coords = 0;":d.map((t=>`coords.${v[t+p]} = 0;`)).join("\n");let y="";return y=a<2&&o>0?"coords":e.unpackedShape.map(((t,e)=>`coords.${v[e+p]}`)).join(", "),new G(`\n        float ${t}() {\n          ${f} coords = getOutputCoords();\n          ${h}\n          return ${c}(${y});\n        }\n      `,["coordinates.getOutputCoords"])}getPackedSamplerFromInput(t,e,r){switch(r.unpackedShape.length){case 0:return this.getPackedSamplerScalar(t,e);case 1:return this.getPackedSampler1D(t,e,r);case 2:return this.getPackedSampler2D(t,e,r);case 3:return this.getPackedSampler3D(t,e,r);default:return this.getPackedSamplerND(t,e,r)}}getUnpackedSamplerFromInput(t,e,r){let n=r.unpackedShape;switch(n.length){case 0:return this.getUnpackedSamplerScalar(t,e,r);case 1:return this.getUnpackedSampler1D(t,e,r);case 2:return this.getUnpackedSampler2D(t,e,r);case 3:return this.getUnpackedSampler3D(t,e,r);case 4:return this.getUnpackedSampler4D(t,e,r);case 5:return this.getUnpackedSampler5D(t,e,r);case 6:return this.getUnpackedSampler6D(t,e,r);default:throw new Error(`Unsupported dimension ${n.length}-D`)}}getPackedSamplerScalar(t,e){let r=`\n          vec4 ${t}() {\n            return ${Y(this.context.glContext.version).texture2D}(${e}, halfCR);\n          }\n        `;return new G(r)}getPackedSampler1D(t,e,r){let n=[r.width,r.height],i=[n[1],n[0]],s=Y(this.context.glContext.version),o=`vec4 ${t}(int index) {\n      vec2 uv = packedUVfrom1D(\n      ${i[0]}, ${i[1]}, index);\n      return ${s.texture2D}(${e}, uv);\n    }`;return new G(o,["coordinates.packedUVfrom1D"])}getPackedSampler2D(t,e,r){let n=r.unpackedShape,i=[r.width,r.height],s=Y(this.context.glContext.version),o=i[0],a=i[1];if(null!=i&&wr.arraysEqual(n,i)){let r=`vec4 ${t}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);\n        return ${s.texture2D}(${e}, uv);\n      }`;return new G(r)}let u=i,l=Math.ceil(n[1]/2),c=`vec4 ${t}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${u[1]}, ${u[0]}, ${l}, row, col);\n      return ${s.texture2D}(${e}, uv);\n    }`;return new G(c,["coordinates.packedUVfrom2D"])}getPackedSampler3D(t,e,r){let n=r.unpackedShape,i=[r.width,r.height],s=[i[0],i[1]],o=Y(this.context.glContext.version);if(1===n[0]){let i=n.slice(1),s=[1,2],o=Wr(n,i),a=["b","row","col"],u=JSON.parse(JSON.stringify(r));u.unpackedShape=o;let l=this.getPackedSamplerFromInput(t,e,u),c=`${l.routineBody}\n      vec4 ${t}(int b, int row, int col) {\n        return ${t}(${Vr(a,s)});\n      } `;return new G(c,l.dependencies)}let a=s[0],u=s[1],l=Math.ceil(n[2]/2),c=`vec4 ${t}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${u}, ${a}, ${l*Math.ceil(n[1]/2)}, ${l}, b, row, col);\n      return ${o.texture2D}(${e}, uv);}`;return new G(c,["coordinates.packedUVfrom3D"])}getPackedSamplerND(t,e,r){let n=r.unpackedShape,i=n.length,s=[r.width,r.height],o=Y(this.context.glContext.version),a=[s[0],s[1]],u=a[1],l=a[0],c=Math.ceil(n[i-1]/2),h=c*Math.ceil(n[i-2]/2),f="int b, int row, int col",d=`b * ${h} + (row / 2) * ${c} + (col / 2)`;for(let t=2;t<i-1;t++)f=`int b${t}, `+f,h*=n[i-t-1],d=`b${t} * ${h} + `+d;let p=`vec4 ${t}(${f}) {\n      int index = ${d};\n      int texR = index / ${l};\n      int texC = index - texR * ${l};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${u});\n      return ${o.texture2D}(${e}, uv);\n    }`;return new G(p)}getUnpackedSamplerScalar(t,e,r){let[n,i]=[r.width,r.height];if(1===n&&1===i){return new G(`\n          float ${t}() {\n            return sampleTexture(${e}, halfCR);\n          }\n        `,["coordinates.sampleTexture"])}return new G(`\n        float ${t}() {\n          int offset_${e} = coordsToOffset(TexCoords, ${n}, ${i});\n          vec2 uv = uvFromFlat(${n}, ${i}, offset_${e});\n          return sampleTexture(${e}, uv);\n        }\n      `,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler1D(t,e,r){let n=r.width,i=r.height;if(1===i&&1===n){return new G(`\n        float ${t}(int index) {\n          return sampleTexture(${e}, halfCR);\n        }\n      `,["coordinates.sampleTexture"])}if(1===i){return new G(`\n          float ${t}(int index) {\n            vec2 uv = vec2((float(index) + 0.5) / ${n}.0, 0.5);\n            return sampleTexture(${e}, uv);\n          }\n        `,["coordinates.sampleTexture"])}if(1===n){return new G(`\n          float ${t}(int index) {\n            vec2 uv = vec2(0.5, (float(index) + 0.5) / ${i}.0);\n            return sampleTexture(${e}, uv);\n          }\n        `,["coordinates.sampleTexture"])}return new G(`\n        float ${t}(int index) {\n          vec2 uv = uvFromFlat(${n}, ${i}, index);\n          return sampleTexture(${e}, uv);\n        }\n      `,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler2D(t,e,r){let n=r.unpackedShape,i=[r.height,r.width];if(null!=i&&wr.arraysEqual(n,i)){return new G(`\n          float ${t}(int row, int col) {\n            vec2 uv = (vec2(row, col) + halfCR) / vec2(${i[1]}.0, ${i[0]}.0);\n            return sampleTexture(${e}, uv);\n          }\n        `,["coordinates.sampleTexture"])}let{newShape:s,keptDims:o}=Yr(n),a=s;if(a.length<n.length){let i=Wr(n,a),s=JSON.parse(JSON.stringify(r));s.unpackedShape=i;let u=["col","row"],l=`\n          ${this.getUnpackedSamplerFromInput(t,e,s).routineBody}\n          float ${t}(int row, int col) {\n            return ${t}(${Vr(u,o)});\n          }\n        `;return new G(l,["coordinates.sampleTexture"])}let u=i[1],l=i[0];if(1===l){let r=`\n          float ${t}(int row, int col) {\n            int offset_${e} = coordsToOffset(TexCoords, ${u}, ${l});\n            float index = dot(vec3(row, col, offset_${e}), vec3(${n[1]}, 1, 1));\n            vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);\n            return sampleTexture(${e}, uv);\n          }\n        `;return new G(r,["coordinates.sampleTexture","coordinates.coordsToOffset"])}if(1===u){let r=`\n          float ${t}(int row, int col) {\n            int offset_${e} = coordsToOffset(TexCoords, ${u}, ${l});\n            float index = dot(vec3(row, col, offset_${e}), vec3(${n[1]}, 1, 1));\n            vec2 uv = vec2((index + 0.5) / ${l}.0, 0.5);\n            return sampleTexture(${e}, uv);\n          }\n        `;return new G(r,["coordinates.sampleTexture","coordinates.coordsToOffset"])}let c=`\n        float ${t}(int row, int col) {\n          int index = col * ${n[1]} + row;\n          vec2 uv = uvFromFlat(${u}, ${l}, index);\n          return sampleTexture(${e}, uv);\n        }\n      `;return new G(c,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler3D(t,e,r){let n=r.unpackedShape,i=n[1]*n[2],s=n[2],{newShape:o,keptDims:a}=Yr(n),u=o;if(u.length<n.length){let i=Wr(n,u),s=["batch","col","row"],o=JSON.parse(JSON.stringify(r));o.unpackedShape=i;let l=this.getUnpackedSamplerFromInput(t,e,o),c=a.reverse(),h=`\n          ${l.routineBody}\n          float ${t}(int batch, int row, int col) {\n            return ${t}(${Vr(s,c)});\n          }\n        `;return new G(h,l.dependencies)}let l=r.width,c=r.height;return new G(`\n          float ${t}(int depth, int row, int col) {\n            // Explicitly use integer operations as dot() only works on floats.\n            int index = depth * ${i} + col * ${s} + row;\n            vec2 uv = uvFromFlat(${l}, ${c}, index);\n            return sampleTexture(${e}, uv);\n          }\n      `,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler4D(t,e,r){let n=r.unpackedShape,i=n[3],s=n[2]*i,o=n[1]*s,a=r.width,u=r.height;return new G(`\n        float ${t}(int row, int col, int depth, int depth2) {\n          int index = row * ${o} + col * ${s} +\n              depth2 * ${i} + depth;\n          vec2 uv = uvFromFlat(${a}, ${u}, index);\n          return sampleTexture(${e}, uv);\n        }\n      `,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler5D(t,e,r){let n=r.unpackedShape,i=n[4],s=n[3]*i,o=n[2]*s,a=n[1]*o,{newShape:u,keptDims:l}=Yr(n);if(u.length<n.length){let i=Wr(n,u),s=["row","col","depth","depth2","depth3"],o=JSON.parse(JSON.stringify(r));o.unpackedShape=i;let a=`\n          ${this.getUnpackedSamplerFromInput(t,e,o).routineBody}\n          float ${t}(int row, int col, int depth, int depth2, int depth3) {\n            return ${t}(${Vr(s,l)});\n          }\n        `;return new G(a,["coordinates.sampleTexture","coordinates.uvFromFlat"])}let c=r.width,h=r.height;return new G(`\n        float ${t}(int row, int col, int depth, int depth2, int depth3) {\n          int index = row * ${a} + col * ${o} + depth * ${s} +\n          depth3 * ${i} + depth2;\n          vec2 uv = uvFromFlat(${c}, ${h}, index);\n          return sampleTexture(${e}, uv);\n        }\n      `,["coordinates.sampleTexture","coordinates.uvFromFlat"])}getUnpackedSampler6D(t,e,r){let n=r.unpackedShape,i=n[5],s=n[4]*i,o=n[3]*s,a=n[2]*o,u=n[1]*a,{newShape:l,keptDims:c}=Yr(n);if(l.length<n.length){let i=Wr(n,l),s=["row","col","depth","depth2","depth3","depth4"],o=JSON.parse(JSON.stringify(r));o.unpackedShape=i;let a=`\n            ${this.getUnpackedSamplerFromInput(t,e,o).routineBody}\n            float ${t}(int row, int col, int depth,\n              int depth2, int depth3, int depth4) {\n              return ${t}(${Vr(s,c)});\n            }\n          `;return new G(a,["coordinates.sampleTexture","coordinates.uvFromFlat"])}let h=r.width,f=r.height;return new G(`\n          float ${t}(int row, int col, int depth,\n            int depth2, int depth3, int depth4) {\n            int index = row * ${u} + col * ${a} + depth * ${o} +\n            depth2 * ${s} + depth3 * ${i} + depth4;\n            vec2 uv = uvFromFlat(${h}, ${f}, index);\n            return sampleTexture(${e}, uv);\n          }\n        `,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}toVec(){let t=this.context.outputTextureLayout,e=t.shape.length,r=t.strides,n=t.width,i=t.height,s=[];for(let t=0;t<e-1;++t)s.push(`\n        c[${t}] = offset / ${r[t]};`),s.push(`\n        offset -= c[${t}] * ${r[t]};`);s.push(`\n        c[${e-1}] = offset;`);let o=`\n      void toVec(vec2 texCoords, out int c[${e}]) {\n        int offset = coordsToOffset(texCoords, ${n}, ${i});\n        ${s.join("")}\n      }\n      void toVec(int offset, out int c[${e}]) {\n        ${s.join("")}\n      }\n    `;return{toVec:new G(o,["coordinates.coordsToOffset"])}}valueFrom(){let t={};return this.context.programInfo.inputNames.forEach(((e,r)=>{let n=this.context.inputTextureLayouts[r],i=(n.unpackedShape.length>0?n.unpackedShape:n.shape).length,s=`_${e}`;t[s]=new G(this.getValueFromSingle(e,i,n.width,n.height,!1),[`shapeUtils.indicesToOffset${s}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"]),s+="_T",t[s]=new G(this.getValueFromSingle(e,i,n.width,n.height,!0),[`shapeUtils.indicesToOffset${s}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"])})),t}getValueFromSingle(t,e,r,n,i){let s=`_${t}`;return i&&(s+="_T"),`\n        float ${s}(int m[${e}]) {\n          int offset = indicesToOffset${s}(m);\n          vec2 coords = offsetToCoords(offset, ${r}, ${n});\n          float value = getColorAsFloat(${Y(this.context.glContext.version).texture2D}(${t}, coords));\n          return value;\n        }\n        `}getPackedValueFrom(t,e,r,n,i){let s=`_${t}_Pack`;return i&&(s+="_T"),`\n        vec4 ${s}(int m[${e}]) {\n          int offset = indicesToOffset_${t}(m);\n          vec2 coords = offsetToCoords(offset, ${r}, ${n});\n          return ${Y(this.context.glContext.version).texture2D}(${t}, coords);\n        }\n        `}}})),xo,up=D((()=>{Xt(),xo=class t extends bt{constructor(t){super(t)}getFunctions(){return{...this.encodeFloat32(),...this.decodeFloat32()}}getCustomTypes(){return{}}encodeFloat32(){return{encode:new G("highp vec4 encode(highp float f) {\n        return vec4(f, 0.0, 0.0, 0.0);\n      }\n        ")}}decodeFloat32(){return{decode:new G("highp float decode(highp vec4 rgba) {\n        return rgba.r;\n      }\n        ")}}encodeUint8(){let e=t.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{encode:new G(`\n      highp vec4 encode(highp float f) {\n        highp float F = abs(f);\n        highp float Sign = step(0.0,-f);\n        highp float Exponent = floor(log2(F));\n        highp float Mantissa = (exp2(- Exponent) * F);\n        Exponent = floor(log2(F) + 127.0) + floor(log2(Mantissa));\n        highp vec4 rgba;\n        rgba[0] = 128.0 * Sign  + floor(Exponent*exp2(-1.0));\n        rgba[1] = 128.0 * mod(Exponent,2.0) + mod(floor(Mantissa*128.0),128.0);\n        rgba[2] = floor(mod(floor(Mantissa*exp2(23.0 -8.0)),exp2(8.0)));\n        rgba[3] = floor(exp2(23.0)*mod(Mantissa,exp2(-15.0)));\n        ${e}\n        rgba = rgba / 255.0; // values need to be normalized to [0,1]\n        return rgba;\n    }\n        `)}}decodeUint8(){let e=t.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{decode:new G(`\n        highp float decode(highp vec4 rgba) {\n          rgba = rgba * 255.0; // values need to be de-normalized from [0,1] to [0,255]\n          ${e}\n          highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;\n          highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;\n          highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);\n          highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));\n          return Result;\n      }\n        `)}}static isLittleEndian(){let t=new ArrayBuffer(4),e=new Uint32Array(t),r=new Uint8Array(t);if(e[0]=3735928559,239===r[0])return!0;if(222===r[0])return!1;throw new Error("unknown endianness")}}})),wo,lp=D((()=>{Xt(),ve(),wo=class extends bt{constructor(t){super(t)}getFunctions(){return{...this.setFragColor(),...this.getColorAsFloat()}}getCustomTypes(){return{}}setFragColor(){let t=Y(this.context.glContext.version);return{setFragColor:new G(`\n        void setFragColor(float value) {\n            ${t.output} = encode(value);\n        }\n        `,["encoding.encode"])}}getColorAsFloat(){return{getColorAsFloat:new G("\n        float getColorAsFloat(vec4 color) {\n            return decode(color);\n        }\n        ",["encoding.decode"])}}}})),vo,fp=D((()=>{Xt(),vo=class t extends bt{constructor(t){super(t)}getFunctions(){return{...this.bcastIndex(),...this.bcastMatmulIndex(),...this.offsetToIndices(),...this.indicesToOffset(),...this.incrementIndices()}}getCustomTypes(){return{}}bcastIndex(){let t=this.context.outputTextureLayout.shape.length,e={};return this.context.programInfo.inputNames.forEach(((r,n)=>{let i=this.context.inputTextureLayouts[n].unpackedShape;if(i.length<=t){let n=i.length,s=t-n,o=`bcastIndices_${r}`,a="";for(let t=0;t<n;++t)a+=`\n          realIndices[${t}] = int( mod(float(bcastedIndices[${s+t}]), ${i[t]}.0) );\n          `;let u=`\n        void ${o} (int bcastedIndices[${t}], out int realIndices[${n}]) {\n          ${a}\n        }\n        `;e[o]=new G(u)}})),e}bcastMatmulIndex(){let t=this.context.outputTextureLayout.shape.length,e={};return this.context.programInfo.inputNames.forEach(((r,n)=>{let i=this.context.inputTextureLayouts[n].shape;if(!(i.length<2||i.length>t)){let n=i.length,s=t-n,o=`bcastMatmulIndices_${r}`,a="";for(let t=0;t<n-2;++t)a+=`\n          realIndices[${t}] = int( mod(float(bcastedIndices[${s+t}]), ${i[t]}.0) );\n          `;let u=`\n        void ${o}(int bcastedIndices[${t}], out int realIndices[${n}]) {\n          ${a}\n          realIndices[${n-1}] = bcastedIndices[${t-1}];\n          realIndices[${n-2}] = bcastedIndices[${t-2}];\n        }\n        `;e[o]=new G(u)}})),e}indicesToOffset(){let e={};return this.context.programInfo.inputNames.forEach(((r,n)=>{let i=this.context.inputTextureLayouts[n].shape,s=this.context.inputTextureLayouts[n].strides,o=i.length,a=`indicesToOffset_${r}`;e[a]=new G(t.indexToOffsetSingle(a,o,s)),a=`indicesToOffset_${r}_T`,e[a]=new G(t.indexToOffsetSingle(a,o,s.slice().reverse()))})),e}static indexToOffsetSingle(t,e,r){let n="";for(let t=e-1;t>=0;--t)n+=`\n        offset += indices[${t}] * ${r[t]};\n        `;return`\n      int ${t}(int indices[${e}]) {\n        int offset = 0;\n        ${n}\n        return offset;\n      }\n      `}offsetToIndices(){let e={};return this.context.programInfo.inputNames.forEach(((r,n)=>{let i=this.context.inputTextureLayouts[n].shape,s=this.context.inputTextureLayouts[n].strides,o=i.length,a=`offsetToIndices_${r}`;e[a]=new G(t.offsetToIndicesSingle(a,o,s)),a=`offsetToIndices_${r}_T`,e[a]=new G(t.offsetToIndicesSingle(a,o,s.slice().reverse()))})),e}static offsetToIndicesSingle(t,e,r){let n=[];for(let t=0;t<e-1;++t)n.push(`\n      indices[${t}] = offset / ${r[t]};`),n.push(`\n        offset -= indices[${t}] * ${r[t]};`);return n.push(`\n      indices[${e-1}] = offset;`),`\n      void ${t}(int offset, out int indices[${e}]) {\n        ${n.join("")}\n      }\n      `}incrementIndices(){let t={};return this.context.programInfo.inputNames.forEach(((e,r)=>{let n=this.context.inputTextureLayouts[r].shape,i=n.length,s=`incrementIndices_${e}`,o="";for(let t=0;t<i;++t)o+=`\n        shape[${t}] = ${n[t]};`;let a=`\n        void ${s}(int axis, out int indices[${i}]) {\n          int shape[${i}];\n          ${o};\n          for(int i = ${i} -1 ; i >= 0; --i) {\n            if(i > axis) continue;\n            indices[i] += 1;\n            if(indices[i] < shape[i]) {\n              break;\n            }\n            indices[i] = 0;\n          }\n        }\n        `;t[s]=new G(a)})),t}}})),_o,cp=D((()=>{Xt(),_o=class extends bt{constructor(t){super(t)}getCustomTypes(){return{}}getFunctions(){return{...this.binaryVecFunctions(),...this.copyVec(),...this.setVecItem(),...this.getVecItem()}}binaryVecFunctions(){let t=this.context.outputTextureLayout.shape.length,e={add:"+=",sub:"-=",mul:"*=",div:"/="},r={};for(let n in e){let i=`${n}Vec`,s="";for(let r=0;r<t;++r)s+=`\n          dest[${r}] ${e[n]} src[${r}];\n          `;let o=`\n        void ${i}(int src[${t}], out int dest[${t}]) {\n          ${s}\n        }\n        `;r[i]=new G(o)}return r}copyVec(){let t=this.context.outputTextureLayout.shape.length,e="";for(let r=0;r<t;++r)e+=`\n        dest[${r}] = src[${r}];\n        `;return{copyVec:new G(`\n      void copyVec(int src[${t}], out int dest[${t}]) {\n        ${e}\n      }\n      `)}}setVecItem(){let t=this.context.outputTextureLayout.shape.length,e=`\n        if(index < 0)\n            index =${t} + index;\n        if (index == 0)\n            m[0] = value;\n        `;for(let r=1;r<t-1;++r)e+=`\n        else if (index == ${r})\n            m[${r}] = value;\n            `;return e+=`\n        else\n            m[${t-1}] = value;\n        `,{setVecItem:new G(`\n      void setVecItem(out int m[${t}], int index, int value) {\n        ${e}\n      }\n        `)}}getVecItem(){let t=this.context.outputTextureLayout.shape.length,e=`\n        if(index < 0)\n            index = ${t} + index;\n        if (index == 0)\n            return m[0];\n      `;for(let r=1;r<t-1;++r)e+=`\n        else if (index == ${r})\n            return m[${r}];\n      `;return e+=`\n        else\n            return m[${t-1}];\n        `,{getVecItem:new G(`\n      int getVecItem(int m[${t}], int index) {\n        ${e}\n      }\n    `)}}}})),Zi,pp=D((()=>{sp(),up(),lp(),fp(),cp(),Zi={encoding:xo,fragcolor:wo,vec:_o,shapeUtils:vo,coordinates:To}})),Oo,dp=D((()=>{Xt(),ip(),pp(),ve(),Oo=class{constructor(t,e,r,n){this.libs={},this.glslLibRoutineDependencyGraph={},this.context=new so(t,e,r,n),Object.keys(Zi).forEach((t=>{let e=new Zi[t](this.context);this.libs[t]=e}));let i=this.glslLibRoutineDependencyGraph;for(let t in this.libs){let e=this.libs[t].getFunctions();for(let r in e){let n,s=t+"."+r;i[s]?(n=i[s],n.routineBody=e[r].routineBody):(n=new yn(s,e[r].routineBody),i[s]=n);let o=e[r].dependencies;if(o)for(let t=0;t<o.length;++t)if(i[o[t]])n.addDependency(i[o[t]]);else{let e=new yn(o[t]);i[o[t]]=e,n.addDependency(e)}}}}preprocess(){let t=this.context.programInfo,e=t.shaderSource;return this.context.programInfo.hasMain||(e=`${e}\n      ${ju(this.context.glContext.version,this.context.outputTextureLayout.shape.length)}`),e=op(e),`${Hu(this.context.glContext.version)}\n    ${this.getUniforms(t.inputNames,t.variables)}\n    ${this.getImports(e)}\n    ${e}`}getImports(t){let e=this.selectGlslLibRoutinesToBeIncluded(t);if(0===e.length)return"";let r="";for(let t=0;t<e.length;++t){if(!e[t].routineBody)throw new Error(`Missing body for the Glsl Library routine: ${e[t].name}`);r+=e[t].routineBody+"\n"}return r}selectGlslLibRoutinesToBeIncluded(t){let e=[];return Object.keys(this.glslLibRoutineDependencyGraph).forEach((r=>{let n=r.split(".")[1];-1!==t.indexOf(n)&&e.push(this.glslLibRoutineDependencyGraph[r])})),uo.returnOrderedNodes(e)}getUniforms(t,e){let r=[];if(t)for(let e of t)r.push(`uniform sampler2D ${e};`);if(e)for(let t of e)r.push(`uniform ${t.type} ${t.name}${t.arrayLength?`[${t.arrayLength}]`:""};`);return r.join("\n")}}})),So,hp=D((()=>{_t(),pt(),dp(),ve(),So=class{constructor(t,e,r){this.profiler=t,this.glContext=e,this.textureLayoutStrategy=r,this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,e){this.repo.set(t,e)}run(t,e,r){this.profiler.event("op",`ProgramManager.run ${t.programInfo.name??"unknown kernel"}`,(()=>{let n=this.glContext.gl,i=t.program;n.useProgram(i);try{this.bindOutput(r),this.attributesBound||this.bindAttributes(t.attribLocations),this.bindUniforms(t.uniformLocations,t.programInfo.variables??[],e)}catch(e){throw pe.error("ProgramManager",t.programInfo.shaderSource),e}this.profiler.event("backend","GlContext.draw()",(()=>{this.glContext.draw()}))}),this.glContext)}dispose(){this.vertexShader&&this.glContext.deleteShader(this.vertexShader),this.repo.forEach((t=>this.glContext.deleteProgram(t.program)))}build(t,e,r){return this.profiler.event("backend","ProgramManager.build",(()=>{let n=new Oo(this.glContext,t,e,r),i=n.preprocess(),s=this.compile(i);return{programInfo:t,program:s,uniformLocations:this.getUniformLocations(s,n.context.programInfo.inputNames,n.context.programInfo.variables),attribLocations:this.getAttribLocations(s)}}))}compile(t){if(!this.vertexShader){pe.verbose("ProrgramManager","Compiling and caching Vertex shader for the first time");let t=Vu(this.glContext.version);this.vertexShader=this.glContext.compileShader(t,this.glContext.gl.VERTEX_SHADER)}ee.debug&&pe.verbose("ProrgramManager",`FragShader:\n${t}\n`);let e=this.glContext.compileShader(t,this.glContext.gl.FRAGMENT_SHADER),r=this.glContext.createProgram(this.vertexShader,e);return this.glContext.deleteShader(e),r}bindOutput(t){let e=t.width,r=t.height;pe.verbose("ProrgramManager",`Binding output texture to Framebuffer: w/h=${e}/${r}, shape=${t.shape}, type=${t.tensor.type}`),this.glContext.attachFramebuffer(t.texture,e,r)}bindAttributes(t){let e=t.position,r=t.textureCoord;this.glContext.setVertexAttributes(e,r),this.attributesBound=!0}bindUniforms(t,e,r){let n=this.glContext.gl,i=0;for(let{name:s,type:o,location:a,arrayLength:u}of t){let t=e.find((t=>t.name===s))?.data;if("sampler2D"!==o&&!t)throw new Error(`variable '${s}' does not have data defined in program info`);switch(o){case"sampler2D":this.bindTexture(r[i],a,i),i++;break;case"float":u?n.uniform1fv(a,t):n.uniform1f(a,t);break;case"int":u?n.uniform1iv(a,t):n.uniform1i(a,t);break;default:throw new Error(`Uniform not implemented: ${o}`)}}}bindTexture(t,e,r){this.glContext.bindTextureToUniform(t.texture,r,e)}getAttribLocations(t){return{position:this.getAttribLocation(t,"position"),textureCoord:this.getAttribLocation(t,"textureCoord")}}getUniformLocations(t,e,r){let n=[];if(e)for(let r of e)n.push({name:r,type:"sampler2D",location:this.getUniformLocation(t,r)});if(r)for(let e of r)n.push({...e,location:this.getUniformLocation(t,e.name)});return n}getUniformLocation(t,e){let r=this.glContext.gl.getUniformLocation(t,e);if(null===r)throw new Error(`Uniform ${e} not found.`);return r}getAttribLocation(t,e){return this.glContext.gl.getAttribLocation(t,e)}}})),Io,mp=D((()=>{pt(),bn(),Io=class{constructor(t,e,r,n){this.glContext=t,this.layoutStrategy=e,this.profiler=r,this.config=n,this.pendingRead=new Map,n.reuseTextures&&(this.inUseTextures=new Map,this.idleTextures=new Map,this.textureLookup=new Map)}createTextureFromLayout(t,e,r,n){let i=this.toEncoderType(t),s=this.glContext.getEncoder(i,e.channels||1,n);if(e.isPacked&&1===n)throw new Error("not implemented");let o,a,u=e.width,l=e.height;if(this.config.reuseTextures){o=`${u}x${l}_${s.format}_${s.internalFormat}_${s.textureType}`,a=this.inUseTextures.get(o),a||(a=[],this.inUseTextures.set(o,a));let e=this.idleTextures.get(o);if(e&&e.length>0){let i=e.pop();return a.push(i),1===n&&this.glContext.updateTexture(i,u,l,s,this.toTextureData(t,r)),i}}pe.verbose("TextureManager",`Creating new texture of size ${e.width}x${e.height}`);let c=this.glContext.allocateTexture(u,l,s,this.toTextureData(t,r));return this.config.reuseTextures&&(a.push(c),this.textureLookup.set(c,o)),c}readTexture(t,e,r){return r||(r=1),this.profiler.event("backend","TextureManager.readTexture",(()=>{let n=t.shape.reduce(((t,e)=>t*e))*r,i=this.glContext.readTexture(t.texture,t.width,t.height,n,this.toEncoderType(e),r);return this.toTensorData(e,i)}))}async readTextureAsync(t,e,r){let n=t.tensor.dataId;if(r||(r=1),this.pendingRead.has(n)){let t=this.pendingRead.get(n);return new Promise((e=>t?.push(e)))}return this.profiler.event("backend","TextureManager.readTextureAsync",(async()=>{this.pendingRead.set(n,[]);let i=t.shape.reduce(((t,e)=>t*e))*r;await this.glContext.createAndWaitForFence();let s=this.glContext.readTexture(t.texture,t.width,t.height,i,this.toEncoderType(e),r),o=this.toTensorData(e,s),a=this.pendingRead.get(n);return this.pendingRead.delete(n),a?.forEach((t=>t(o))),o}))}readUint8TextureAsFloat(t){return this.profiler.event("backend","TextureManager.readUint8TextureAsFloat",(()=>{let e=t.shape.reduce(((t,e)=>t*e)),r=this.glContext.readTexture(t.texture,t.width,t.height,4*e,"byte",4);return new Float32Array(r.buffer,r.byteOffset,e)}))}releaseTexture(t,e){let r;if(this.config.reuseTextures&&(r=this.textureLookup.get(t.texture),r)){e&&this.textureLookup.delete(r);let n=this.inUseTextures.get(r);if(n){let e=n.indexOf(t.texture);if(-1!==e){n.splice(e,1);let i=this.idleTextures.get(r);i||(i=[],this.idleTextures.set(r,i)),i.push(t.texture)}}}(!r||e)&&(pe.verbose("TextureManager",`Deleting texture of size ${t.width}x${t.height}`),this.glContext.deleteTexture(t.texture))}toTensorData(t,e){switch(t){case"int16":return e instanceof Int16Array?e:Int16Array.from(e);case"int32":return e instanceof Int32Array?e:Int32Array.from(e);case"int8":return e instanceof Int8Array?e:Int8Array.from(e);case"uint16":return e instanceof Uint16Array?e:Uint16Array.from(e);case"uint32":return e instanceof Uint32Array?e:Uint32Array.from(e);case"uint8":case"bool":return e instanceof Uint8Array?e:Uint8Array.from(e);case"float32":return e instanceof Float32Array?e:Float32Array.from(e);case"float64":return e instanceof Float64Array?e:Float64Array.from(e);default:throw new Error(`TensorData type ${t} is not supported`)}}toTextureData(t,e){if(e)return e instanceof Float32Array?e:new Float32Array(e)}toEncoderType(t){return"float"}clearActiveTextures(){this.glContext.clearActiveTextures()}}})),Ao,bp=D((()=>{pt(),Ds(),sl(),rp(),hp(),Ji(),mp(),Ao=class{constructor(t,e){this.backend=t,this.context=e,this.layoutStrategy=new yo(t.glContext.maxTextureSize),this.programManager=new So(this.context.profiler,t.glContext,this.layoutStrategy),this.textureManager=new Io(t.glContext,this.layoutStrategy,this.context.profiler,{reuseTextures:"full"===t.textureCacheMode}),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map,this.pack=t.pack,this.pack2unpackMap=new Map,this.unpack2packMap=new Map}createInferenceHandler(){return new ao(this)}onGraphInitialized(t){let e=t.getValues().filter((t=>-1===t.from&&t.tensor)).map((t=>t.tensor.dataId));this.initializers=new Set(e)}isInitializer(t){return!!this.initializers&&this.initializers.has(t)}addInitializer(t){this.initializers.add(t)}getTextureData(t,e){return e?this.packedTextureDataCache.get(t):this.unpackedTextureDataCache.get(t)}setTextureData(t,e,r=!1){pe.verbose("WebGLSessionHandler","Storing Texture data in cache"),r?this.packedTextureDataCache.set(t,e):this.unpackedTextureDataCache.set(t,e)}dispose(){this.programManager.dispose(),this.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach((t=>this.textureManager.releaseTexture(t,!0))),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach((t=>this.textureManager.releaseTexture(t,!0))),this.unpackedTextureDataCache=new Map}resolve(t,e,r){let n=Ps(t,e,tp);return{impl:n.opImpl,context:n.opInit?n.opInit(t,r):t}}}}));function og(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}var wn,gp=D((()=>{_t(),bn(),bn(),Rt(),wn=class{constructor(t,e){this.frameBufferBound=!1,this.itemsToPoll=[],this.gl=t,this.version=e,this.getExtensions(),this.vertexbuffer=this.createVertexbuffer(),this.framebuffer=this.createFramebuffer(),this.queryVitalParameters()}allocateTexture(t,e,r,n){let i=this.gl,s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);let o=n?r.encode(n,t*e):null;return i.texImage2D(i.TEXTURE_2D,0,r.internalFormat,t,e,0,r.format,r.textureType,o),this.checkError(),s}updateTexture(t,e,r,n,i){let s=this.gl;s.bindTexture(s.TEXTURE_2D,t);let o=n.encode(i,e*r);s.texSubImage2D(s.TEXTURE_2D,0,0,0,e,r,n.format,n.textureType,o),this.checkError()}attachFramebuffer(t,e,r){let n=this.gl;n.bindTexture(n.TEXTURE_2D,t),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.checkError(),n.viewport(0,0,e,r),n.scissor(0,0,e,r)}readTexture(t,e,r,n,i,s){let o=this.gl;s||(s=1),this.frameBufferBound||this.attachFramebuffer(t,e,r);let a=this.getEncoder(i,s),u=a.allocate(e*r);return o.bindTexture(o.TEXTURE_2D,t),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),o.readPixels(0,0,e,r,o.RGBA,a.textureType,u),this.checkError(),a.decode(u,n)}isFramebufferReady(){return!0}getActiveTexture(){let t=this.gl;return"TEXTURE"+(t.getParameter(this.gl.ACTIVE_TEXTURE)-t.TEXTURE0)}getTextureBinding(){return this.gl.getParameter(this.gl.TEXTURE_BINDING_2D)}getFramebufferBinding(){return this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING)}setVertexAttributes(t,e){let r=this.gl;r.vertexAttribPointer(t,3,r.FLOAT,!1,20,0),r.enableVertexAttribArray(t),-1!==e&&(r.vertexAttribPointer(e,2,r.FLOAT,!1,20,12),r.enableVertexAttribArray(e)),this.checkError()}createProgram(t,e){let r=this.gl,n=r.createProgram();return r.attachShader(n,t),r.attachShader(n,e),r.linkProgram(n),n}compileShader(t,e){let r=this.gl,n=r.createShader(e);if(!n)throw new Error(`createShader() returned null with type ${e}`);if(r.shaderSource(n,t),r.compileShader(n),!1===r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error(`Failed to compile shader: ${r.getShaderInfoLog(n)}\nShader source:\n${t}`);return n}deleteShader(t){this.gl.deleteShader(t)}bindTextureToUniform(t,e,r){let n=this.gl;n.activeTexture(n.TEXTURE0+e),this.checkError(),n.bindTexture(n.TEXTURE_2D,t),this.checkError(),n.uniform1i(r,e),this.checkError()}draw(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.checkError()}checkError(){if(ee.debug){let t=this.gl,e=t.getError(),r="";switch(e){case t.NO_ERROR:return;case t.INVALID_ENUM:r="INVALID_ENUM";break;case t.INVALID_VALUE:r="INVALID_VALUE";break;case t.INVALID_OPERATION:r="INVALID_OPERATION";break;case t.INVALID_FRAMEBUFFER_OPERATION:r="INVALID_FRAMEBUFFER_OPERATION";break;case t.OUT_OF_MEMORY:r="OUT_OF_MEMORY";break;case t.CONTEXT_LOST_WEBGL:r="CONTEXT_LOST_WEBGL";break;default:r=`Unknown WebGL Error: ${e.toString(16)}`}throw new Error(r)}}deleteTexture(t){this.gl.deleteTexture(t)}deleteProgram(t){this.gl.deleteProgram(t)}getEncoder(t,e,r=0){if(2===this.version)return new oo(this.gl,e);switch(t){case"float":return 1===r||this.isRenderFloat32Supported?new mn(this.gl,e):new mn(this.gl,e,this.textureHalfFloatExtension.HALF_FLOAT_OES);case"int":throw new Error("not implemented");case"byte":return new io(this.gl,e);default:throw new Error(`Invalid dataType: ${t}`)}}clearActiveTextures(){let t=this.gl;for(let e=0;e<this.maxTextureImageUnits;++e)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,null)}dispose(){if(this.disposed)return;let t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(this.framebuffer),t.bindBuffer(t.ARRAY_BUFFER,null),t.deleteBuffer(this.vertexbuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.finish(),this.disposed=!0}createDefaultGeometry(){return new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0])}createVertexbuffer(){let t=this.gl,e=t.createBuffer();if(!e)throw new Error("createBuffer() returned null");let r=this.createDefaultGeometry();return t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),this.checkError(),e}createFramebuffer(){let t=this.gl.createFramebuffer();if(!t)throw new Error("createFramebuffer returned null");return t}queryVitalParameters(){let t=this.gl;if(this.isFloatTextureAttachableToFrameBuffer=this.checkFloatTextureAttachableToFrameBuffer(),this.isRenderFloat32Supported=this.checkRenderFloat32(),this.isFloat32DownloadSupported=this.checkFloat32Download(),1===this.version&&!this.textureHalfFloatExtension&&!this.isRenderFloat32Supported)throw new Error("both float32 and float16 TextureType are not supported");this.isBlendSupported=!this.isRenderFloat32Supported||this.checkFloat32Blend(),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxTextureImageUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.version}getExtensions(){2===this.version?(this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float"),this.disjointTimerQueryWebgl2Extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")):(this.textureFloatExtension=this.gl.getExtension("OES_texture_float"),this.textureHalfFloatExtension=this.gl.getExtension("OES_texture_half_float"))}checkFloatTextureAttachableToFrameBuffer(){let t=this.gl,e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);let r=2===this.version?t.RGBA32F:t.RGBA;t.texImage2D(t.TEXTURE_2D,0,r,1,1,0,t.RGBA,t.FLOAT,null);let n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);let i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(n),i}checkRenderFloat32(){if(2===this.version){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension)return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Download(){if(2===this.version){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension||!this.gl.getExtension("WEBGL_color_buffer_float"))return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Blend(){let t,e,r,n,i,s=this.gl;try{t=s.createTexture(),e=s.createFramebuffer(),s.bindTexture(s.TEXTURE_2D,t);let o=2===this.version?s.RGBA32F:s.RGBA;return s.texImage2D(s.TEXTURE_2D,0,o,1,1,0,s.RGBA,s.FLOAT,null),s.bindFramebuffer(s.FRAMEBUFFER,e),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),s.enable(s.BLEND),r=s.createShader(s.VERTEX_SHADER),!!(r&&(s.shaderSource(r,"void main(){}"),s.compileShader(r),n=s.createShader(s.FRAGMENT_SHADER),n)&&(s.shaderSource(n,"precision highp float;void main(){gl_FragColor=vec4(0.5);}"),s.compileShader(n),i=s.createProgram(),i))&&(s.attachShader(i,r),s.attachShader(i,n),s.linkProgram(i),s.useProgram(i),s.drawArrays(s.POINTS,0,1),s.getError()===s.NO_ERROR)}finally{s.disable(s.BLEND),i&&s.deleteProgram(i),r&&s.deleteShader(r),n&&s.deleteShader(n),e&&(s.bindFramebuffer(s.FRAMEBUFFER,null),s.deleteFramebuffer(e)),t&&(s.bindTexture(s.TEXTURE_2D,null),s.deleteTexture(t))}}beginTimer(){if(2===this.version&&this.disjointTimerQueryWebgl2Extension){let t=this.gl,e=this.disjointTimerQueryWebgl2Extension,r=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,r),r}throw new Error("WebGL1 profiling currently not supported.")}endTimer(){if(2!==this.version||!this.disjointTimerQueryWebgl2Extension)throw new Error("WebGL1 profiling currently not supported");{let t=this.gl,e=this.disjointTimerQueryWebgl2Extension;t.endQuery(e.TIME_ELAPSED_EXT)}}isTimerResultAvailable(t){let e=!1,r=!1;if(2!==this.version||!this.disjointTimerQueryWebgl2Extension)throw new Error("WebGL1 profiling currently not supported");{let n=this.gl,i=this.disjointTimerQueryWebgl2Extension;e=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE),r=n.getParameter(i.GPU_DISJOINT_EXT)}return e&&!r}getTimerResult(t){let e=0;if(2!==this.version)throw new Error("WebGL1 profiling currently not supported");{let r=this.gl;e=r.getQueryParameter(t,r.QUERY_RESULT),r.deleteQuery(t)}return e/1e6}async waitForQueryAndGetTime(t){return await _i((()=>this.isTimerResultAvailable(t))),this.getTimerResult(t)}async createAndWaitForFence(){let t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,r=t,n=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);return t.flush(),e=null===n?()=>!0:()=>{let t=r.clientWaitSync(n,0,0);return t===r.ALREADY_SIGNALED||t===r.CONDITION_SATISFIED},{query:n,isFencePassed:e}}async pollFence(t){return new Promise((e=>{this.addItemToPoll((()=>t.isFencePassed()),(()=>e()))}))}pollItems(){let t=og(this.itemsToPoll.map((t=>t.isDoneFn)));for(let e=0;e<=t;++e){let{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}async addItemToPoll(t,e){this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),!(this.itemsToPoll.length>1)&&await _i((()=>(this.pollItems(),0===this.itemsToPoll.length)))}}}));function Qi(t){let e;if(t&&"webgl2"!==t||!("webgl2"in Xr)?(!t||"webgl"===t)&&"webgl"in Xr&&(e=Xr.webgl):e=Xr.webgl2,!e)try{e=yp(ag(),t)}catch{e=yp(ig(),t)}t=t||1===e.version?"webgl":"webgl2";let r=e.gl;return Xr[t]=e,r.isContextLost()?(delete Xr[t],Qi(t)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),e)}function yp(t,e){let r,n={alpha:!1,depth:!1,antialias:!1,stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1};if((!e||"webgl2"===e)&&(r=t.getContext("webgl2",n),r))try{return new wn(r,2)}catch(t){pe.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl2'. Error: ${t}`)}if((!e||"webgl"===e)&&(r=t.getContext("webgl",n)||t.getContext("experimental-webgl",n),r))try{return new wn(r,1)}catch(t){pe.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl' or 'experimental-webgl'. Error: ${t}`)}throw new Error("WebGL is not supported")}function ig(){if(typeof document>"u")throw new TypeError("failed to create canvas: document is not supported");let t=document.createElement("canvas");return t.width=1,t.height=1,t}function ag(){if(typeof OffscreenCanvas>"u")throw new TypeError("failed to create offscreen canvas: OffscreenCanvas is not supported");return new OffscreenCanvas(1,1)}var Xr,Tp=D((()=>{pt(),gp(),Xr={}})),Eo,xp=D((()=>{_t(),pt(),bp(),Tp(),Eo=class{get contextId(){return ee.webgl.contextId}set contextId(t){ee.webgl.contextId=t}get matmulMaxBatchSize(){return ee.webgl.matmulMaxBatchSize}set matmulMaxBatchSize(t){ee.webgl.matmulMaxBatchSize=t}get textureCacheMode(){return ee.webgl.textureCacheMode}set textureCacheMode(t){ee.webgl.textureCacheMode=t}get pack(){return ee.webgl.pack}set pack(t){ee.webgl.pack=t}get async(){return ee.webgl.async}set async(t){ee.webgl.async=t}initialize(){try{return this.glContext=Qi(this.contextId),"number"!=typeof this.matmulMaxBatchSize&&(this.matmulMaxBatchSize=16),"string"!=typeof this.textureCacheMode&&(this.textureCacheMode="full"),"boolean"!=typeof this.pack&&(this.pack=!1),"boolean"!=typeof this.async&&(this.async=!1),pe.setWithEnv(ee),ee.webgl.context||Object.defineProperty(ee.webgl,"context",{value:this.glContext.gl}),pe.verbose("WebGLBackend",`Created WebGLContext: ${typeof this.glContext} with matmulMaxBatchSize: ${this.matmulMaxBatchSize}; textureCacheMode: ${this.textureCacheMode}; pack: ${this.pack}; async: ${this.async}.`),!0}catch(t){return pe.warning("WebGLBackend",`Unable to initialize WebGLBackend. ${t}`),!1}}createSessionHandler(t){return new Ao(this,t)}dispose(){this.glContext.dispose()}}}));async function ea(t){if(!t)return ea(["webgl"]);{let e="string"==typeof t?[t]:t;for(let t of e){let e=wp.get(t);if(e)return e;let r=await ug(t);if(r)return r}}throw new Error("no available backend to use")}async function ug(t){let e=sg;if(typeof e[t]<"u"&&lg(e[t])){let r=e[t],n=r.initialize();if("object"==typeof n&&"then"in n&&(n=await n),n)return wp.set(t,r),r}}function lg(t){let e=t;return"initialize"in e&&"function"==typeof e.initialize&&"createSessionHandler"in e&&"function"==typeof e.createSessionHandler&&"dispose"in e&&"function"==typeof e.dispose}var wp,sg,vp=D((()=>{xp(),wp=new Map,sg={webgl:new Eo}})),ta,Po,_p=D((()=>{pt(),ta=class{constructor(t,e){this.op=t,this.node=e}},Po=class{constructor(t,e,r){this.graph=t,this.profiler=r,this.initialize(e)}initialize(t){this.profiler.event("session","ExecutionPlan.initialize",(()=>{let e=this.graph.getNodes();if(e.length!==t.length)throw new Error("The size of nodes and OPs do not match.");this._ops=t.map(((t,r)=>new ta(t,e[r]))),this.reset(),this._starter=[],this._ops.forEach(((t,e)=>{let r=!0;for(let e of t.node.inputs)if(!this._values[e]&&-1===this.graph.getInputIndices().indexOf(e)){r=!1;break}r&&this._starter.push(e)}))}))}reset(){this._values=this.graph.getValues().map((t=>t.tensor))}async execute(t,e){return this.profiler.event("session","ExecutionPlan.execute",(async()=>{this.reset();let r=t.createInferenceHandler(),n=this.graph.getInputIndices();if(e.length!==n.length)throw new Error(`number of input tensors don't match the number of inputs to the model: actual: ${e.length} expected: ${n.length}`);e.forEach(((t,e)=>{let r=n[e];this._values[r]=t}));let i=this._starter.slice(0),s=this.graph.getValues(),o=this.graph.getNodes(),a=0;for(;a<i.length;){let t=i[a++],e=this._ops[t],n=e.node.inputs.map((t=>this._values[t]));if(-1!==n.indexOf(void 0))throw new Error(`unresolved input detected: op: ${e.node}`);let u=n;pe.verbose("ExecPlan",`Runing op:${e.node.name} (${u.map(((t,r)=>`'${e.node.inputs[r]}': ${t.type}[${t.dims.join(",")}]`)).join(", ")})`);let l=await this.profiler.event("node",e.node.name,(async()=>e.op.impl(r,u,e.op.context)));if(l.length!==e.node.outputs.length)throw new Error("the size of output does not match model definition.");l.forEach(((t,r)=>{let n=e.node.outputs[r];if(this._values[n])throw new Error(`output [${n}] already has value: op:${e.node.name}`);this._values[n]=t}));let c=new Set;l.forEach(((t,r)=>{let n=e.node.outputs[r];for(let t of s[n].to){let e=o[t],r=!0;for(let t of e.inputs)if(!this._values[t]){r=!1;break}r&&c.add(t)}})),i.push(...c)}let u=[];for(let t=0;t<this.graph.getOutputIndices().length;t++){let e=this.graph.getOutputIndices()[t],r=this._values[e];if(void 0===r)throw new Error(`required output [${e}] does not have value`);0===e?await r.getData():r.data,u.push(r)}return pe.verbose("ExecPlan","disposing of inferenceHandler"),r.dispose(),u}))}}})),oe,Tt,vn,Op=D((()=>{ln(),oe=Nr(Ur()),Sr(),fe(),Tt=H.experimental.fbs,vn=class t{constructor(e){if(this._attributes=new Map,null!=e){for(let r of e)r instanceof oe.onnx.AttributeProto?this._attributes.set(r.name,[t.getValue(r),t.getType(r)]):r instanceof Tt.Attribute&&this._attributes.set(r.name(),[t.getValue(r),t.getType(r)]);if(this._attributes.size<e.length)throw new Error("duplicated attribute names")}}set(t,e,r){this._attributes.set(t,[r,e])}delete(t){this._attributes.delete(t)}getFloat(t,e){return this.get(t,"float",e)}getInt(t,e){return this.get(t,"int",e)}getString(t,e){return this.get(t,"string",e)}getTensor(t,e){return this.get(t,"tensor",e)}getFloats(t,e){return this.get(t,"floats",e)}getInts(t,e){return this.get(t,"ints",e)}getStrings(t,e){return this.get(t,"strings",e)}getTensors(t,e){return this.get(t,"tensors",e)}get(t,e,r){let n=this._attributes.get(t);if(void 0===n){if(void 0!==r)return r;throw new Error(`required attribute not found: ${t}`)}if(n[1]!==e)throw new Error(`type mismatch: expected ${e} but got ${n[1]}`);return n[0]}static getType(t){let e=t instanceof oe.onnx.AttributeProto?t.type:t.type();switch(e){case oe.onnx.AttributeProto.AttributeType.FLOAT:return"float";case oe.onnx.AttributeProto.AttributeType.INT:return"int";case oe.onnx.AttributeProto.AttributeType.STRING:return"string";case oe.onnx.AttributeProto.AttributeType.TENSOR:return"tensor";case oe.onnx.AttributeProto.AttributeType.FLOATS:return"floats";case oe.onnx.AttributeProto.AttributeType.INTS:return"ints";case oe.onnx.AttributeProto.AttributeType.STRINGS:return"strings";case oe.onnx.AttributeProto.AttributeType.TENSORS:return"tensors";default:throw new Error(`attribute type is not supported yet: ${oe.onnx.AttributeProto.AttributeType[e]}`)}}static getValue(t){let e=t instanceof oe.onnx.AttributeProto?t.type:t.type();if(e===oe.onnx.AttributeProto.AttributeType.GRAPH||e===oe.onnx.AttributeProto.AttributeType.GRAPHS)throw new Error("graph attribute is not supported yet");let r=this.getValueNoCheck(t);if(e===oe.onnx.AttributeProto.AttributeType.INT&&ot.isLong(r))return ot.longToNumber(r);if(e===oe.onnx.AttributeProto.AttributeType.INTS){let t=r,e=new Array(t.length);for(let r=0;r<t.length;r++){let n=t[r];e[r]=ot.longToNumber(n)}return e}if(e===oe.onnx.AttributeProto.AttributeType.TENSOR)return t instanceof oe.onnx.AttributeProto?Be.fromProto(r):Be.fromOrtTensor(r);if(e===oe.onnx.AttributeProto.AttributeType.TENSORS){if(t instanceof oe.onnx.AttributeProto)return r.map((t=>Be.fromProto(t)));if(t instanceof Tt.Attribute)return r.map((t=>Be.fromOrtTensor(t)))}return e===oe.onnx.AttributeProto.AttributeType.STRING&&t instanceof oe.onnx.AttributeProto?hn(r):e===oe.onnx.AttributeProto.AttributeType.STRINGS&&t instanceof oe.onnx.AttributeProto?r.map(hn):r}static getValueNoCheck(t){return t instanceof oe.onnx.AttributeProto?this.getValueNoCheckFromOnnxFormat(t):this.getValueNoCheckFromOrtFormat(t)}static getValueNoCheckFromOnnxFormat(t){switch(t.type){case oe.onnx.AttributeProto.AttributeType.FLOAT:return t.f;case oe.onnx.AttributeProto.AttributeType.INT:return t.i;case oe.onnx.AttributeProto.AttributeType.STRING:return t.s;case oe.onnx.AttributeProto.AttributeType.TENSOR:return t.t;case oe.onnx.AttributeProto.AttributeType.GRAPH:return t.g;case oe.onnx.AttributeProto.AttributeType.FLOATS:return t.floats;case oe.onnx.AttributeProto.AttributeType.INTS:return t.ints;case oe.onnx.AttributeProto.AttributeType.STRINGS:return t.strings;case oe.onnx.AttributeProto.AttributeType.TENSORS:return t.tensors;case oe.onnx.AttributeProto.AttributeType.GRAPHS:return t.graphs;default:throw new Error(`unsupported attribute type: ${oe.onnx.AttributeProto.AttributeType[t.type]}`)}}static getValueNoCheckFromOrtFormat(t){switch(t.type()){case Tt.AttributeType.FLOAT:return t.f();case Tt.AttributeType.INT:return t.i();case Tt.AttributeType.STRING:return t.s();case Tt.AttributeType.TENSOR:return t.t();case Tt.AttributeType.GRAPH:return t.g();case Tt.AttributeType.FLOATS:return t.floatsArray();case Tt.AttributeType.INTS:{let e=[];for(let r=0;r<t.intsLength();r++)e.push(t.ints(r));return e}case Tt.AttributeType.STRINGS:{let e=[];for(let r=0;r<t.stringsLength();r++)e.push(t.strings(r));return e}case Tt.AttributeType.TENSORS:{let e=[];for(let r=0;r<t.tensorsLength();r++)e.push(t.tensors(r));return e}default:throw new Error(`unsupported attribute type: ${Tt.AttributeType[t.type()]}`)}}}})),na,Do,oa,Ut,Lo,ra,Sp=D((()=>{Op(),ln(),na=Nr(Ur()),Sr(),fe(),Do=H.experimental.fbs,oa={from:(t,e)=>new ra(t,e)},Ut=class{constructor(t){this._from=void 0,this._to=[],this.tensor=void 0,this.type=void 0,t&&(this.type=Ve.tensorValueTypeFromProto(t.type.tensorType))}get from(){return this._from}get to(){return this._to}},Lo=class{constructor(t,e){t instanceof na.onnx.NodeProto?(this.name=t.name,this.opType=t.opType,this.attributes=new vn(t.attribute)):t instanceof Do.Node&&(this.name=e??t.name(),this.opType=t.opType(),this.attributes=new vn(Ve.tensorAttributesFromORTFormat(t))),this.inputs=[],this.outputs=[],this.executeNode=!0}},ra=class{constructor(t,e){if(!t)throw new TypeError("graph is empty");this.buildGraph(t),this.transformGraph(e),this.checkIsAcyclic()}getInputIndices(){return this._allInputIndices}getInputNames(){return this._allInputNames}getOutputIndices(){return this._allOutputIndices}getOutputNames(){return this._allOutputNames}getValues(){return this._allData}getNodes(){return this._nodes}buildGraph(t){if(t instanceof na.onnx.GraphProto)this.buildGraphFromOnnxFormat(t);else{if(!(t instanceof Do.Graph))throw new TypeError("Graph type is not supported.");this.buildGraphFromOrtFormat(t)}}buildGraphFromOnnxFormat(t){let e=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];let r=new Map;if(!t.input)throw new Error("missing information in graph: input");let n=[];for(let r of t.input){if(e.has(r.name))throw new Error(`duplicated input name: ${r.name}`);let t=this._allData.push(new Ut(r))-1;e.set(r.name,t),n.push(r.name)}if(!t.initializer)throw new Error("missing information in graph: initializer");for(let r of t.initializer){let t=e.get(r.name);if(void 0===t){let n=new Ut;n.type={shape:{dims:Ve.tensorDimsFromProto(r.dims)},tensorType:Ve.tensorDataTypeFromProto(r.dataType)},t=this._allData.push(n)-1,e.set(r.name,t)}this._allData[t]._from=-1,this._allData[t].tensor=Be.fromProto(r)}for(let t=0;t<this._allData.length;t++)this._allData[t].tensor||(this._allInputIndices.push(t),this._allInputNames.push(n[t]));if(!t.output)throw new Error("missing information in graph: output");for(let r of t.output){if(e.has(r.name))throw new Error(`duplicated output name: ${r.name}`);let t=this._allData.push(new Ut(r))-1;e.set(r.name,t),this._allOutputIndices.push(t),this._allOutputNames.push(r.name)}if(!t.node)throw new Error("missing information in graph: node");for(let e of t.node){if(!e.name)for(let t=0;;t++){let n=`unnamed_${e.opType}_${t}`;if(!r.has(n)){e.name=n;break}}if(r.has(e.name))throw new Error(`duplicated node name: ${e.name}`);let t=this._nodes.push(new Lo(e))-1;r.set(e.name,t)}for(let r=0;r<this._nodes.length;r++){let n=this._nodes[r],i=t.node[r];if(!i.output)throw new Error(`missing output for node: ${i.name}`);for(let t of i.output){let s=e.get(t);if(typeof s>"u"&&(s=this._allData.push(new Ut)-1,e.set(t,s)),n.outputs.push(s),void 0!==this._allData[s]._from)throw new Error(`multiple nodes output to one data value: ${s}`);if(this._allData[s]._from=r,"Constant"===i.opType){if(!i.attribute||1!==i.attribute.length||!i.attribute[0].t)throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(!i.output||1!==i.output.length)throw new Error("missing output or incorrect number of outputs for this Constant operator");n.outputs.pop(),n.executeNode=!1,this._allData[s]._from=-1,this._allData[s].tensor=Be.fromProto(i.attribute[0].t)}}}for(let r=0;r<this._nodes.length;r++){let n=this._nodes[r],i=t.node[r];if(!i.input)throw new Error(`missing input for node: ${i.name}`);for(let t of i.input){let s=e.get(t);if(typeof s>"u"){if(""===t&&(3===i.input.length||4===i.input.length)&&"Resize"===i.opType)continue;throw new Error(`unrecognized input '${t}' for node: ${i.name}`)}n.inputs.push(s),this._allData[s]._to.push(r)}}return!0}buildGraphFromOrtFormat(t){let e=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];let r=new Map,n=[];for(let r=0;r<t.inputsLength();r++){let i=t.inputs(r);if(e.has(i))throw new Error(`duplicated input name: ${i}`);for(let r=0;r<t.nodeArgsLength();r++)if(t.nodeArgs(r)?.name()===i){let s=new Ut;if(t.nodeArgs(r)?.type()?.valueType()!==Do.TypeInfoValue.tensor_type)throw new Error("Unexpected value type for the nodeArg.");let o=t.nodeArgs(r).type().value(new Do.TensorTypeAndShape),a=Ve.tensorDataTypeFromProto(o.elemType()),u=o.shape(),l=[];for(let t=0;t<u.dimLength();t++)l.push(ot.longToNumber(u.dim(t).value().dimValue()));s.type={shape:{dims:l},tensorType:a};let c=this._allData.push(s)-1;e.set(i,c),n.push(i)}}for(let r=0;r<t.initializersLength();r++){let n=t.initializers(r),i=e.get(n.name());if(void 0===i){let t=new Ut,r=Ve.tensorDimsFromORTFormat(n),s=Ve.tensorDataTypeFromProto(n.dataType());t.type={shape:{dims:r},tensorType:s},i=this._allData.push(t)-1,e.set(n.name(),i)}this._allData[i]._from=-1,this._allData[i].tensor=Be.fromOrtTensor(n)}for(let t=0;t<this._allData.length;t++)this._allData[t].tensor||(this._allInputIndices.push(t),this._allInputNames.push(n[t]));for(let r=0;r<t.outputsLength();r++){let n=t.outputs(r);if(e.has(n))throw new Error(`duplicated output name: ${n}`);let i=this._allData.push(new Ut)-1;e.set(n,i),this._allOutputIndices.push(i),this._allOutputNames.push(n)}if(!t.nodes)throw new Error("missing information in graph: node");for(let e=0;e<t.nodesLength();e++){let n=t.nodes(e),i=n.name();if(!i)for(let t=0;i=`unnamed_${n.opType()}_${t}`,r.has(i);t++);if(r.has(i))throw new Error(`duplicated node name: ${i}`);let s=this._nodes.push(new Lo(n,i))-1;r.set(i,s)}for(let r=0;r<this._nodes.length;r++){let n=this._nodes[r],i=t.nodes(r);if(null==i)throw new Error(`No node exists at index ${r}`);if(0===i?.outputsLength())throw new Error(`missing output for node: ${i.name}`);for(let t=0;t<i?.outputsLength();t++){let s=i?.outputs(t),o=e.get(s);if(typeof o>"u"&&(o=this._allData.push(new Ut)-1,e.set(s,o)),n.outputs.push(o),void 0!==this._allData[o]._from)throw new Error(`multiple nodes output to one data value: ${o}`);if(this._allData[o]._from=r,"Constant"===i.opType()){if(1!==i.attributesLength()||!i.attributes(0).t())throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(1!==i.outputsLength())throw new Error("missing output or incorrect number of outputs for this Constant operator");n.outputs.pop(),n.executeNode=!1,this._allData[o]._from=-1,this._allData[o].tensor=Be.fromOrtTensor(i.attributes(0).t())}}}for(let r=0;r<this._nodes.length;r++){let n=this._nodes[r],i=t.nodes(r);if(0===i.inputsLength())throw new Error(`missing input for node: ${i.name}`);for(let t=0;t<i.inputsLength();t++){let s=i.inputs(t),o=e.get(s);if(typeof o>"u")throw new Error(`unrecognized input '${s}' for node: ${i.name()}`);n.inputs.push(o),this._allData[o]._to.push(r)}}}checkIsAcyclic(){let t=new Set;this._allInputIndices.forEach((e=>{this._allData[e]._to.forEach((e=>{t.add(e)}))}));let e=Array.from(t),r=new Array(this._nodes.length).fill("white");for(;e.length>0;){let t=e.pop();"gray"===r[t]?r[t]="black":(e.push(t),r[t]="gray",this._nodes[t].outputs.forEach((n=>{let i=this._allData[n];if(typeof i.tensor<"u")throw new Error("node outputs should not be initialized");if(i._from!==t)throw new Error("from property of the Value object doesn't match index of Node being processed");i._to.forEach((t=>{if("gray"===r[t])throw new Error("model graph is cyclic");"white"===r[t]&&e.push(t)}))})))}}transformGraph(t){this.removeAllIdentityNodes(),this.removeAllDropoutNodes(),this.fuseConvActivationNodes(),t&&t.transformGraph(this),this.finalizeGraph()}finalizeGraph(){let t=0,e=new Array(this._nodes.length,0),r=0;for(let t=0;t<this._nodes.length;t++)e[t]=r,this._nodes[t].executeNode?(r!==t&&(this._nodes[r]=this._nodes[t]),r++):this._nodes[t].outputs.forEach((t=>{this._allData[t]._from=-2}));this._nodes.splice(r,this._nodes.length-r);for(let t=0;t<this._allData.length;t++){let r=this._allData[t];void 0!==r._from&&-1!==r._from&&-2!==r._from&&(r._from=e[r._from]);for(let t=0;t<r._to.length;t++){if(!(r._to[t]>=0))throw new Error("Trying to update a removed node");r._to[t]=e[r._to[t]]}}t=0;for(let e=0;e<this._allData.length;e++)if(-2!==this._allData[e].from||-1!==this._allOutputIndices.indexOf(e+t)){if(t>0){let r=-1;void 0!==this._allData[e].from&&-1!==this._allData[e].from?(r=this._nodes[this._allData[e].from].outputs.indexOf(e+t),-1!==r&&(this._nodes[this._allData[e].from].outputs[r]=e)):(r=this._allInputIndices.indexOf(e+t),-1!==r&&(this._allInputIndices[r]=e)),this._allData[e].to.forEach((n=>{r=this._nodes[n].inputs.indexOf(e+t),-1!==r&&(this._nodes[n].inputs[r]=e)})),0===this._allData[e].to.length&&(r=this._allOutputIndices.indexOf(e+t),-1!==r&&(this._allOutputIndices[r]=e))}}else t++,this._allData.splice(e,1),e--}deleteNode(t){let e=this._nodes[t];if(e.outputs.length>1)for(let t=1;t<e.outputs.length;t++)if(this._allData[e.outputs[t]].to.length>0)throw new Error("Node deletion with more than one output connected to other nodes is not supported. ");e.executeNode=!1;let r=e.inputs[0],n=e.outputs[0],i=this._allData[n].to;for(let r=0;r<e.inputs.length;r++){let n=this._allData[e.inputs[r]].to.indexOf(t);if(-1===n)throw new Error("The Value object doesn't have the current Node in it's 'to' property ");this._allData[e.inputs[r]].to.splice(n,1)}this._allData[n]._to=[];let s=this._allOutputIndices.indexOf(n);if(-1!==s&&(this._allOutputIndices[s]=r),i&&i.length>0)for(let t of i){let e=this._nodes[t].inputs.indexOf(n);if(-1===e)throw new Error("The Node object doesn't have the output Value in it's 'inputs' property ");this._nodes[t].inputs[e]=r,this._allData[r].to.push(t)}}removeAllDropoutNodes(){let t=0;for(let e of this._nodes){if("Dropout"===e.opType){if(1!==e.inputs.length)throw new Error("Dropout nodes should only contain one input. ");if(1!==e.outputs.length&&2!==e.outputs.length)throw new Error("Dropout nodes should contain either 1 or 2 output(s)");if(2===e.outputs.length&&0!==this._allData[e.outputs[1]]._to.length)throw new Error("Dropout nodes's second output should not be referenced by other nodes");this.deleteNode(t)}t++}}removeAllIdentityNodes(){let t=0;for(let e of this._nodes)"Identity"===e.opType&&this.deleteNode(t),t++}isActivation(t){switch(t.opType){case"Relu":case"Sigmoid":case"Clip":return!0;default:return!1}}fuseConvActivationNodes(){for(let t of this._nodes)if("Conv"===t.opType){let e=this._allData[t.outputs[0]]._to;if(1===e.length&&this.isActivation(this._nodes[e[0]])){let r=this._nodes[e[0]];if("Clip"===r.opType)if(1===r.inputs.length)try{t.attributes.set("activation_params","floats",[r.attributes.getFloat("min"),r.attributes.getFloat("max")])}catch{t.attributes.set("activation_params","floats",[_r,Or])}else{if(!(r.inputs.length>=3&&void 0!==this._allData[r.inputs[1]].tensor&&void 0!==this._allData[r.inputs[2]].tensor))continue;t.attributes.set("activation_params","floats",[this._allData[r.inputs[1]].tensor.floatData[0],this._allData[r.inputs[2]].tensor.floatData[0]])}t.attributes.set("activation","string",r.opType),this.deleteNode(e[0])}}}}})),Ip,fg,Co,Ap=D((()=>{Jn(),Sp(),ln(),Ip=Nr(Ur()),fe(),fg=H.experimental.fbs,Co=class{constructor(){}load(t,e,r){if(!r)try{return void this.loadFromOnnxFormat(t,e)}catch(t){if(void 0!==r)throw t}this.loadFromOrtFormat(t,e)}loadFromOnnxFormat(t,e){let r=Ip.onnx.ModelProto.decode(t);if(ot.longToNumber(r.irVersion)<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=r.opsetImport.map((t=>({domain:t.domain,version:ot.longToNumber(t.version)}))),this._graph=oa.from(r.graph,e)}loadFromOrtFormat(t,e){let r=new S.ByteBuffer(t),n=fg.InferenceSession.getRootAsInferenceSession(r).model();if(ot.longToNumber(n.irVersion())<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=[];for(let t=0;t<n.opsetImportLength();t++){let e=n.opsetImport(t);this._opsets.push({domain:e?.domain(),version:ot.longToNumber(e.version())})}this._graph=oa.from(n.graph(),e)}get graph(){return this._graph}get opsets(){return this._opsets}}})),Fo,Ep=D((()=>{vp(),_p(),pt(),Ap(),Fo=class{constructor(t={}){this._initialized=!1,this.backendHint=t.backendHint,this.profiler=Xn.create(t.profiler),this.context={profiler:this.profiler,graphInputTypes:[],graphInputDims:[]}}get inputNames(){return this._model.graph.getInputNames()}get outputNames(){return this._model.graph.getOutputNames()}startProfiling(){this.profiler.start()}endProfiling(){this.profiler.stop()}async loadModel(t,e,r){await this.profiler.event("session","Session.loadModel",(async()=>{let n=await ea(this.backendHint);if(this.sessionHandler=n.createSessionHandler(this.context),this._model=new Co,"string"==typeof t){let e=t.endsWith(".ort");if(typeof process<"u"&&process.versions&&process.versions.node){let r=await(void 0)(t);this.initialize(r,e)}else{let r=await(await fetch(t)).arrayBuffer();this.initialize(new Uint8Array(r),e)}}else if(ArrayBuffer.isView(t))this.initialize(t);else{let n=new Uint8Array(t,e||0,r||t.byteLength);this.initialize(n)}}))}initialize(t,e){if(this._initialized)throw new Error("already initialized");this.profiler.event("session","Session.initialize",(()=>{let r=this.sessionHandler.transformGraph?this.sessionHandler:void 0;this._model.load(t,r,e),this.sessionHandler.onGraphInitialized&&this.sessionHandler.onGraphInitialized(this._model.graph),this.initializeOps(this._model.graph),this._executionPlan=new Po(this._model.graph,this._ops,this.profiler)})),this._initialized=!0}async run(t){if(!this._initialized)throw new Error("session not initialized yet");return this.profiler.event("session","Session.run",(async()=>{let e=this.normalizeAndValidateInputs(t),r=await this._executionPlan.execute(this.sessionHandler,e);return this.createOutput(r)}))}normalizeAndValidateInputs(t){let e=this._model.graph.getInputNames();if(Array.isArray(t)){if(t.length!==e.length)throw new Error(`incorrect input array length: expected ${e.length} but got ${t.length}`)}else{if(t.size!==e.length)throw new Error(`incorrect input map size: expected ${e.length} but got ${t.size}`);let r=new Array(t.size),n=0;for(let i=0;i<e.length;++i){let s=t.get(e[i]);if(!s)throw new Error(`missing input tensor for: '${name}'`);r[n++]=s}t=r}if(this.context.graphInputTypes&&0!==this.context.graphInputTypes.length&&this.context.graphInputDims&&0!==this.context.graphInputDims.length)this.validateInputTensorDims(this.context.graphInputDims,t,!1);else{let e=this._model.graph.getInputIndices(),r=this._model.graph.getValues(),n=new Array(e.length);for(let i=0;i<e.length;++i){let s=r[e[i]];n[i]=s.type.shape.dims,this.context.graphInputTypes.push(s.type.tensorType),this.context.graphInputDims.push(t[i].dims)}this.validateInputTensorDims(n,t,!0)}return this.validateInputTensorTypes(this.context.graphInputTypes,t),t}validateInputTensorTypes(t,e){for(let r=0;r<e.length;r++){let n=t[r],i=e[r].type;if(n!==i)throw new Error(`input tensor[${r}] check failed: expected type '${n}' but got ${i}`)}}validateInputTensorDims(t,e,r){for(let n=0;n<e.length;n++){let i=t[n],s=e[n].dims;if(!this.compareTensorDims(i,s,r))throw new Error(`input tensor[${n}] check failed: expected shape '[${i.join(",")}]' but got [${s.join(",")}]`)}}compareTensorDims(t,e,r){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n]&&(!r||0!==t[n]))return!1;return!0}createOutput(t){let e=this._model.graph.getOutputNames();if(t.length!==e.length)throw new Error("expected number of outputs do not match number of generated outputs");let r=new Map;for(let n=0;n<e.length;++n)r.set(e[n],t[n]);return r}initializeOps(t){let e=t.getNodes();this._ops=new Array(e.length);for(let r=0;r<e.length;r++)this._ops[r]=this.sessionHandler.resolve(e[r],this._model.opsets,t)}}})),Bo,Pp=D((()=>{_t(),Sr(),Bo=class{constructor(t){this.session=t,this.inputNames=this.session.inputNames,this.outputNames=this.session.outputNames}async dispose(){}async run(t,e,r){let n=new Map;for(let e in t)if(Object.hasOwnProperty.call(t,e)){let r=t[e];n.set(e,new Be(r.dims,r.type,void 0,void 0,r.data))}let i=await this.session.run(n),s={};return i.forEach(((t,e)=>{s[e]=new Ne(t.type,t.data,t.dims)})),s}async configure(t){return""}async auth(t){return""}startProfiling(){this.session.startProfiling()}endProfiling(){this.session.endProfiling()}}})),Dp={};pr(Dp,{onnxjsBackend:()=>pg});var ia,pg,Lp=D((()=>{Ep(),Pp(),pg=new(ia=class{async init(){}async createInferenceSessionHandler(t,e){let r=new Fo(e);return await r.loadModel(t),new Bo(r)}})})),aa={};pr(aa,{createReadStream:()=>Cp,readFile:()=>dg,readFileSync:()=>hg});var dg,hg,Cp,sa=D((()=>{dg=void 0,hg=void 0,Cp=void 0})),ua={};pr(ua,{join:()=>mg});var mg,la=D((()=>{mg=void 0})),fa={};pr(fa,{crypto:()=>bg});var bg,ca=D((()=>{bg=void 0})),$p=ye(((t,e)=>{var r,n=(r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0,typeof __filename<"u"&&(r=r||__filename),function(t={}){var e,n,i=t;i.ready=new Promise(((t,r)=>{e=t,n=r}));var s,o,a,u=Object.assign({},i),l="./this.program",c="object"==typeof window,h="function"==typeof importScripts,f="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,d="";if(f){var p=(sa(),jt(aa)),v=(la(),jt(ua));d=h?v.dirname(d)+"/":__dirname+"/",s=(t,e)=>(t=D(t)?new URL(t):v.normalize(t),p.readFileSync(t,e?void 0:"utf8")),a=t=>((t=s(t,!0)).buffer||(t=new Uint8Array(t)),t),o=(t,e,r,n=!0)=>{t=D(t)?new URL(t):v.normalize(t),p.readFile(t,n?void 0:"utf8",((t,i)=>{t?r(t):e(n?i.buffer:i)}))},!i.thisProgram&&1<process.argv.length&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),i.inspect=()=>"[Emscripten Module object]"}else(c||h)&&(h?d=self.location.href:typeof document<"u"&&document.currentScript&&(d=document.currentScript.src),r&&(d=r),d=0!==d.indexOf("blob:")?d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):"",s=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},h&&(a=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),o=(t,e,r)=>{var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?e(n.response):r()},n.onerror=r,n.send(null)});var y=console.log.bind(console),b=console.error.bind(console);Object.assign(i,u),u=null,"object"!=typeof WebAssembly&&R("no native wasm support detected");var _,m,g,w,x,T,S=!1;function E(){var t=_.buffer;i.HEAP8=m=new Int8Array(t),i.HEAP16=new Int16Array(t),i.HEAPU8=g=new Uint8Array(t),i.HEAPU16=new Uint16Array(t),i.HEAP32=w=new Int32Array(t),i.HEAPU32=x=new Uint32Array(t),i.HEAPF32=new Float32Array(t),i.HEAPF64=T=new Float64Array(t)}var O=[],P=[],A=[],C=0,k=null,I=null;function R(t){throw b(t="Aborted("+t+")"),S=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),n(t),t}var $,M=t=>t.startsWith("data:application/octet-stream;base64,"),D=t=>t.startsWith("file://");if(!M($="ort-wasm.wasm")){var B=$;$=i.locateFile?i.locateFile(B,d):d+B}function L(t){if(a)return a(t);throw"both async and sync fetching of the wasm failed"}function N(t,e,r){return function(t){if(c||h){if("function"==typeof fetch&&!D(t))return fetch(t,{credentials:"same-origin"}).then((e=>{if(!e.ok)throw"failed to load wasm binary file at '"+t+"'";return e.arrayBuffer()})).catch((()=>L(t)));if(o)return new Promise(((e,r)=>{o(t,(t=>e(new Uint8Array(t))),r)}))}return Promise.resolve().then((()=>L(t)))}(t).then((t=>WebAssembly.instantiate(t,e))).then((t=>t)).then(r,(t=>{b(`failed to asynchronously prepare wasm: ${t}`),R(t)}))}var F,U={882208:(t,e,r,n)=>{if(typeof i>"u"||!i.Ga)return 1;if((t=H(t>>>0)).startsWith("./")&&(t=t.substring(2)),!(t=i.Ga.get(t)))return 2;if((e>>>=0)+(r>>>=0)>t.byteLength)return 3;try{return g.set(t.subarray(e,e+r),n>>>0>>>0),0}catch{return 4}}};function j(t){this.Da=t-24,this.Fa=function(t){x[this.Da+4>>>2>>>0]=t},this.Ea=function(t){x[this.Da+8>>>2>>>0]=t},this.La=function(t,e){this.Ma(),this.Fa(t),this.Ea(e)},this.Ma=function(){x[this.Da+16>>>2>>>0]=0}}var z,G=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,V=(t,e,r)=>{var n=(e>>>=0)+r;for(r=e;t[r]&&!(r>=n);)++r;if(16<r-e&&t.buffer&&G)return G.decode(t.subarray(e,r));for(n="";e<r;){var i=t[e++];if(128&i){var s=63&t[e++];if(192==(224&i))n+=String.fromCharCode((31&i)<<6|s);else{var o=63&t[e++];65536>(i=224==(240&i)?(15&i)<<12|s<<6|o:(7&i)<<18|s<<12|o<<6|63&t[e++])?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else n+=String.fromCharCode(i)}return n},H=(t,e)=>(t>>>=0)?V(g,t,e):"",W=t=>{for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);127>=n?e++:2047>=n?e+=2:55296<=n&&57343>=n?(e+=4,++r):e+=3}return e},q=(t,e,r,n)=>{if(!(0<n))return 0;var i=r>>>=0;n=r+n-1;for(var s=0;s<t.length;++s){var o=t.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++s)),127>=o){if(r>=n)break;e[r++>>>0]=o}else{if(2047>=o){if(r+1>=n)break;e[r++>>>0]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;e[r++>>>0]=224|o>>12}else{if(r+3>=n)break;e[r++>>>0]=240|o>>18,e[r++>>>0]=128|o>>12&63}e[r++>>>0]=128|o>>6&63}e[r++>>>0]=128|63&o}}return e[r>>>0]=0,r-i},Y=t=>t%4==0&&(t%100!=0||t%400==0),K=[0,31,60,91,121,152,182,213,244,274,305,335],X=[0,31,59,90,120,151,181,212,243,273,304,334],Z=t=>{var e=W(t)+1,r=pt(e);return r&&q(t,g,r,e),r},J=[],Q={},tt=()=>{if(!z){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(t in Q)void 0===Q[t]?delete e[t]:e[t]=Q[t];var r=[];for(t in e)r.push(`${t}=${e[t]}`);z=r}return z},et=[null,[],[]],rt=t=>(rt=(()=>{if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues)return t=>crypto.getRandomValues(t);if(f)try{var t=(ca(),jt(fa));if(t.randomFillSync)return e=>t.randomFillSync(e);var e=t.randomBytes;return t=>(t.set(e(t.byteLength)),t)}catch{}R("initRandomDevice")})())(t),nt=[31,29,31,30,31,30,31,31,30,31,30,31],it=[31,28,31,30,31,30,31,31,30,31,30,31];function st(t,e,r,n){function i(t,e,r){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=r[0]+t;return t}function s(t,e){return i(t,e,"0")}function o(t,e){function r(t){return 0>t?-1:0<t?1:0}var n;return 0===(n=r(t.getFullYear()-e.getFullYear()))&&0===(n=r(t.getMonth()-e.getMonth()))&&(n=r(t.getDate()-e.getDate())),n}function a(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function u(t){var e=t.ya;for(t=new Date(new Date(t.za+1900,0,1).getTime());0<e;){var r=t.getMonth(),n=(Y(t.getFullYear())?nt:it)[r];if(!(e>n-t.getDate())){t.setDate(t.getDate()+e);break}e-=n-t.getDate()+1,t.setDate(1),11>r?t.setMonth(r+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return r=new Date(t.getFullYear()+1,0,4),e=a(new Date(t.getFullYear(),0,4)),r=a(r),0>=o(e,t)?0>=o(r,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}t>>>=0,e>>>=0,r>>>=0;var l=x[40+(n>>>=0)>>>2>>>0];for(var c in n={Ja:w[n>>>2>>>0],Ia:w[n+4>>>2>>>0],Aa:w[n+8>>>2>>>0],Ca:w[n+12>>>2>>>0],Ba:w[n+16>>>2>>>0],za:w[n+20>>>2>>>0],xa:w[n+24>>>2>>>0],ya:w[n+28>>>2>>>0],Na:w[n+32>>>2>>>0],Ha:w[n+36>>>2>>>0],Ka:l?H(l):""},r=H(r),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})r=r.replace(new RegExp(c,"g"),l[c]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),f="January February March April May June July August September October November December".split(" ");for(c in l={"%a":t=>h[t.xa].substring(0,3),"%A":t=>h[t.xa],"%b":t=>f[t.Ba].substring(0,3),"%B":t=>f[t.Ba],"%C":t=>s((t.za+1900)/100|0,2),"%d":t=>s(t.Ca,2),"%e":t=>i(t.Ca,2," "),"%g":t=>u(t).toString().substring(2),"%G":t=>u(t),"%H":t=>s(t.Aa,2),"%I":t=>(0==(t=t.Aa)?t=12:12<t&&(t-=12),s(t,2)),"%j":t=>{for(var e=0,r=0;r<=t.Ba-1;e+=(Y(t.za+1900)?nt:it)[r++]);return s(t.Ca+e,3)},"%m":t=>s(t.Ba+1,2),"%M":t=>s(t.Ia,2),"%n":()=>"\n","%p":t=>0<=t.Aa&&12>t.Aa?"AM":"PM","%S":t=>s(t.Ja,2),"%t":()=>"\t","%u":t=>t.xa||7,"%U":t=>s(Math.floor((t.ya+7-t.xa)/7),2),"%V":t=>{var e=Math.floor((t.ya+7-(t.xa+6)%7)/7);if(2>=(t.xa+371-t.ya-2)%7&&e++,e)53==e&&(4==(r=(t.xa+371-t.ya)%7)||3==r&&Y(t.za)||(e=1));else{e=52;var r=(t.xa+7-t.ya-1)%7;(4==r||5==r&&Y(t.za%400-1))&&e++}return s(e,2)},"%w":t=>t.xa,"%W":t=>s(Math.floor((t.ya+7-(t.xa+6)%7)/7),2),"%y":t=>(t.za+1900).toString().substring(2),"%Y":t=>t.za+1900,"%z":t=>(0<=(t=t.Ha)?"+":"-")+("0000"+((t=Math.abs(t)/60)/60*100+t%60)).slice(-4),"%Z":t=>t.Ka,"%%":()=>"%"},r=r.replace(/%%/g,"\0\0"),l)r.includes(c)&&(r=r.replace(new RegExp(c,"g"),l[c](n)));return c=function(t){var e=Array(W(t)+1);return q(t,e,0,e.length),e}(r=r.replace(/\0\0/g,"%")),c.length>e?0:(m.set(c,t>>>0),c.length-1)}var ot,at,ut=[],lt=[],ct=(t,e)=>{if(!at){at=new WeakMap;var r=ot.length;if(at)for(var n=0;n<0+r;n++){var i=n,s=ut[i];s||(i>=ut.length&&(ut.length=i+1),ut[i]=s=ot.get(i)),(i=s)&&at.set(i,n)}}if(r=at.get(t)||0)return r;if(lt.length)r=lt.pop();else{try{ot.grow(1)}catch(t){throw t instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":t}r=ot.length-1}try{n=r,ot.set(n,t),ut[n]=ot.get(n)}catch(a){if(!(a instanceof TypeError))throw a;if("function"==typeof WebAssembly.Function){n=WebAssembly.Function,i={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},s={parameters:[],results:"v"==e[0]?[]:[i[e[0]]]};for(var o=1;o<e.length;++o)s.parameters.push(i[e[o]]);e=new n(s,t)}else{for(n=[1],i=e.slice(0,1),e=e.slice(1),s={i:127,p:127,j:126,f:125,d:124,e:111},n.push(96),128>(o=e.length)?n.push(o):n.push(o%128|128,o>>7),o=0;o<e.length;++o)n.push(s[e[o]]);"v"==i?n.push(0):n.push(1,s[i]),e=[0,97,115,109,1,0,0,0,1],128>(i=n.length)?e.push(i):e.push(i%128|128,i>>7),e.push.apply(e,n),e.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),e=new WebAssembly.Module(new Uint8Array(e)),e=new WebAssembly.Instance(e,{e:{f:t}}).exports.f}n=r,ot.set(n,e),ut[n]=ot.get(n)}return at.set(t,r),r},ht={a:function(t,e,r){throw new j(t>>>=0).La(e>>>0,r>>>0),t},e:function(){return 0},L:function(){},A:function(){},C:function(){},u:function(){return 0},J:function(){},E:function(){},I:function(){},k:function(){},B:function(){},y:function(){},K:function(){},z:function(){},l:()=>1,o:function(t,e,r){t=e+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*e:NaN,r>>>=0,t=new Date(1e3*t),w[r>>>2>>>0]=t.getUTCSeconds(),w[r+4>>>2>>>0]=t.getUTCMinutes(),w[r+8>>>2>>>0]=t.getUTCHours(),w[r+12>>>2>>>0]=t.getUTCDate(),w[r+16>>>2>>>0]=t.getUTCMonth(),w[r+20>>>2>>>0]=t.getUTCFullYear()-1900,w[r+24>>>2>>>0]=t.getUTCDay(),w[r+28>>>2>>>0]=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},p:function(t,e,r){t=e+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*e:NaN,r>>>=0,t=new Date(1e3*t),w[r>>>2>>>0]=t.getSeconds(),w[r+4>>>2>>>0]=t.getMinutes(),w[r+8>>>2>>>0]=t.getHours(),w[r+12>>>2>>>0]=t.getDate(),w[r+16>>>2>>>0]=t.getMonth(),w[r+20>>>2>>>0]=t.getFullYear()-1900,w[r+24>>>2>>>0]=t.getDay(),w[r+28>>>2>>>0]=(Y(t.getFullYear())?K:X)[t.getMonth()]+t.getDate()-1|0,w[r+36>>>2>>>0]=-60*t.getTimezoneOffset(),e=new Date(t.getFullYear(),6,1).getTimezoneOffset();var n=new Date(t.getFullYear(),0,1).getTimezoneOffset();w[r+32>>>2>>>0]=0|(e!=n&&t.getTimezoneOffset()==Math.min(n,e))},q:function(t){t>>>=0;var e=new Date(w[t+20>>>2>>>0]+1900,w[t+16>>>2>>>0],w[t+12>>>2>>>0],w[t+8>>>2>>>0],w[t+4>>>2>>>0],w[t>>>2>>>0],0),r=w[t+32>>>2>>>0],n=e.getTimezoneOffset(),i=new Date(e.getFullYear(),6,1).getTimezoneOffset(),s=new Date(e.getFullYear(),0,1).getTimezoneOffset(),o=Math.min(s,i);return 0>r?w[t+32>>>2>>>0]=+(i!=s&&o==n):0<r!=(o==n)&&(i=Math.max(s,i),e.setTime(e.getTime()+6e4*((0<r?o:i)-n))),w[t+24>>>2>>>0]=e.getDay(),w[t+28>>>2>>>0]=(Y(e.getFullYear())?K:X)[e.getMonth()]+e.getDate()-1|0,w[t>>>2>>>0]=e.getSeconds(),w[t+4>>>2>>>0]=e.getMinutes(),w[t+8>>>2>>>0]=e.getHours(),w[t+12>>>2>>>0]=e.getDate(),w[t+16>>>2>>>0]=e.getMonth(),w[t+20>>>2>>>0]=e.getYear(),t=e.getTime(),isNaN(t)?(w[dt()>>>2>>>0]=61,t=-1):t/=1e3,yt((F=t,1<=+Math.abs(F)?0<F?+Math.floor(F/4294967296)>>>0:~~+Math.ceil((F-+(~~F>>>0))/4294967296)>>>0:0)),t>>>0},m:function(){return-52},n:function(){},w:function(t,e,r){function n(t){return(t=t.toTimeString().match(/\(([A-Za-z ]+)\)$/))?t[1]:"GMT"}r>>>=0;var i=(new Date).getFullYear(),s=new Date(i,0,1),o=new Date(i,6,1);i=s.getTimezoneOffset();var a=o.getTimezoneOffset();x[t>>>0>>>2>>>0]=60*Math.max(i,a),w[e>>>0>>>2>>>0]=+(i!=a),t=n(s),e=n(o),t=Z(t),e=Z(e),a<i?(x[r>>>2>>>0]=t,x[r+4>>>2>>>0]=e):(x[r>>>2>>>0]=e,x[r+4>>>2>>>0]=t)},d:()=>{R("")},D:function(t,e,r){t>>>=0,e>>>=0,r>>>=0,J.length=0;for(var n;n=g[e++>>>0];){var i=105!=n;r+=(i&=112!=n)&&r%8?4:0,J.push(112==n?x[r>>>2>>>0]:105==n?w[r>>>2>>>0]:T[r>>>3>>>0]),r+=i?8:4}return U[t].apply(null,J)},g:()=>Date.now(),x:function(){return 4294901760},b:()=>performance.now(),H:function(t,e,r){return e>>>=0,g.copyWithin(t>>>0>>>0,e>>>0,e+(r>>>0)>>>0)},v:function(t){t>>>=0;var e=g.length;if(4294901760<t)return!1;for(var r=1;4>=r;r*=2){var n=e*(1+.2/r);n=Math.min(n,t+100663296);var i=Math;n=Math.max(t,n);t:{i=(i.min.call(i,4294901760,n+(65536-n%65536)%65536)-_.buffer.byteLength+65535)/65536;try{_.grow(i),E();var s=1;break t}catch{}s=void 0}if(s)return!0}return!1},F:function(t,e){t>>>=0,e>>>=0;var r=0;return tt().forEach(((n,i)=>{var s=e+r;for(i=x[t+4*i>>>2>>>0]=s,s=0;s<n.length;++s)m[i++>>>0>>>0]=n.charCodeAt(s);m[i>>>0>>>0]=0,r+=n.length+1})),0},G:function(t,e){t>>>=0,e>>>=0;var r=tt();x[t>>>2>>>0]=r.length;var n=0;return r.forEach((t=>n+=t.length+1)),x[e>>>2>>>0]=n,0},f:()=>52,j:function(){return 52},r:function(){return 70},i:function(t,e,r,n){e>>>=0,r>>>=0,n>>>=0;for(var i=0,s=0;s<r;s++){var o=x[e>>>2>>>0],a=x[e+4>>>2>>>0];e+=8;for(var u=0;u<a;u++){var l=g[o+u>>>0],c=et[t];0===l||10===l?((1===t?y:b)(V(c,0)),c.length=0):c.push(l)}i+=a}return x[n>>>2>>>0]=i,0},s:function(t,e){return t>>>=0,rt(g.subarray(t>>>0,t+(e>>>0)>>>0)),0},t:st,c:function(t,e,r,n){return st(t>>>0,e>>>0,r>>>0,n>>>0)},h:function(t,e,r,n){let i=ot.length;t=new Uint8Array(g.slice(t+e,t+r));try{var s,o=new WebAssembly.Module(t),a=new WebAssembly.Instance(o,{env:{memory:_}});for(s in a.exports)ct(a.exports[s]);return i<ot.length?i:n}catch(t){return console.log(t),n}}},ft=function(){function t(t){return ft=t.exports,ft=function(){var t=ft;t=Object.assign({},t);var e=t=>()=>t()>>>0,r=t=>e=>t(e)>>>0;return t.pa=e(t.pa),t.qa=r(t.qa),t.ua=e(t.ua),t.wa=r(t.wa),t}(),_=ft.M,E(),ot=ft.sa,P.unshift(ft.N),0==--C&&(null!==k&&(clearInterval(k),k=null),I&&(t=I,I=null,t())),ft}var e={a:ht};if(C++,i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(t){b(`Module.instantiateWasm callback failed with error: ${t}`),n(t)}return function(t,e){var r=$;return"function"!=typeof WebAssembly.instantiateStreaming||M(r)||D(r)||f||"function"!=typeof fetch?N(r,t,e):fetch(r,{credentials:"same-origin"}).then((n=>WebAssembly.instantiateStreaming(n,t).then(e,(function(n){return b(`wasm streaming compile failed: ${n}`),b("falling back to ArrayBuffer instantiation"),N(r,t,e)}))))}(e,(function(e){t(e.instance)})).catch(n),{}}();i._OrtInit=(t,e)=>(i._OrtInit=ft.O)(t,e),i._OrtGetLastError=(t,e)=>(i._OrtGetLastError=ft.P)(t,e),i._OrtCreateSessionOptions=(t,e,r,n,s,o,a,u,l,c)=>(i._OrtCreateSessionOptions=ft.Q)(t,e,r,n,s,o,a,u,l,c),i._OrtAppendExecutionProvider=(t,e)=>(i._OrtAppendExecutionProvider=ft.R)(t,e),i._OrtAddFreeDimensionOverride=(t,e,r)=>(i._OrtAddFreeDimensionOverride=ft.S)(t,e,r),i._OrtAddSessionConfigEntry=(t,e,r)=>(i._OrtAddSessionConfigEntry=ft.T)(t,e,r),i._OrtReleaseSessionOptions=t=>(i._OrtReleaseSessionOptions=ft.U)(t),i._OrtCreateSession=(t,e,r)=>(i._OrtCreateSession=ft.V)(t,e,r),i._OrtReleaseSession=t=>(i._OrtReleaseSession=ft.W)(t),i._OrtGetInputOutputCount=(t,e,r)=>(i._OrtGetInputOutputCount=ft.X)(t,e,r),i._OrtGetInputName=(t,e)=>(i._OrtGetInputName=ft.Y)(t,e),i._OrtGetOutputName=(t,e)=>(i._OrtGetOutputName=ft.Z)(t,e),i._OrtFree=t=>(i._OrtFree=ft._)(t),i._OrtCreateTensor=(t,e,r,n,s,o)=>(i._OrtCreateTensor=ft.$)(t,e,r,n,s,o),i._OrtGetTensorData=(t,e,r,n,s)=>(i._OrtGetTensorData=ft.aa)(t,e,r,n,s),i._OrtReleaseTensor=t=>(i._OrtReleaseTensor=ft.ba)(t),i._OrtCreateRunOptions=(t,e,r,n)=>(i._OrtCreateRunOptions=ft.ca)(t,e,r,n),i._OrtAddRunConfigEntry=(t,e,r)=>(i._OrtAddRunConfigEntry=ft.da)(t,e,r),i._OrtReleaseRunOptions=t=>(i._OrtReleaseRunOptions=ft.ea)(t),i._OrtCreateBinding=t=>(i._OrtCreateBinding=ft.fa)(t),i._OrtBindInput=(t,e,r)=>(i._OrtBindInput=ft.ga)(t,e,r),i._OrtBindOutput=(t,e,r,n)=>(i._OrtBindOutput=ft.ha)(t,e,r,n),i._OrtClearBoundOutputs=t=>(i._OrtClearBoundOutputs=ft.ia)(t),i._OrtReleaseBinding=t=>(i._OrtReleaseBinding=ft.ja)(t),i._OrtRunWithBinding=(t,e,r,n,s)=>(i._OrtRunWithBinding=ft.ka)(t,e,r,n,s),i._OrtRun=(t,e,r,n,s,o,a,u)=>(i._OrtRun=ft.la)(t,e,r,n,s,o,a,u),i._OrtEndProfiling=t=>(i._OrtEndProfiling=ft.ma)(t),i._OrtConfigure=(t,e)=>(i._OrtConfigure=ft.na)(t,e),i._OrtAuth=(t,e)=>(i._OrtAuth=ft.oa)(t,e);var dt=()=>(dt=ft.pa)(),pt=i._malloc=t=>(pt=i._malloc=ft.qa)(t);i._free=t=>(i._free=ft.ra)(t);var vt,yt=t=>(yt=ft.ta)(t),bt=()=>(bt=ft.ua)(),_t=t=>(_t=ft.va)(t),mt=t=>(mt=ft.wa)(t);function gt(){if(!(0<C)){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;){var t=i.preRun.shift();O.unshift(t)}for(;0<O.length;)O.shift()(i);if(!(0<C||vt||(vt=!0,i.calledRun=!0,S))){for(;0<P.length;)P.shift()(i);for(e(i);0<A.length;)A.shift()(i)}}}return i.___start_em_js=882709,i.___stop_em_js=883321,i.stackAlloc=mt,i.stackSave=bt,i.stackRestore=_t,i.addFunction=ct,i.UTF8ToString=H,i.stringToUTF8=(t,e,r)=>q(t,g,e,r),i.lengthBytesUTF8=W,I=function t(){vt||gt(),vt||(I=t)},gt(),t.ready});"object"==typeof t&&"object"==typeof e?e.exports=n:"function"==typeof define&&define.amd&&define([],(()=>n))})),kp=ye((()=>{})),Np=ye((()=>{})),Rp={};pr(Rp,{cpus:()=>gg});var gg,Mp=D((()=>{gg=void 0})),zp=ye(((t,e)=>{var r,n=(r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0,typeof __filename<"u"&&(r=r||__filename),function(t={}){function e(){return A.buffer!=I.buffer&&L(),I}function n(){return A.buffer!=I.buffer&&L(),R}function i(){return A.buffer!=I.buffer&&L(),$}function s(){return A.buffer!=I.buffer&&L(),M}function o(){return A.buffer!=I.buffer&&L(),D}var a,u,l=t;l.ready=new Promise(((t,e)=>{a=t,u=e}));var c,h,f,d=Object.assign({},l),p="./this.program",v=(t,e)=>{throw e},y="object"==typeof window,b="function"==typeof importScripts,_="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,m=l.ENVIRONMENT_IS_PTHREAD||!1,g="";function w(t){return l.locateFile?l.locateFile(t,g):g+t}if(_){var x=(sa(),jt(aa)),T=(la(),jt(ua));let t;g=b?T.dirname(g)+"/":__dirname+"/",c=(t,e)=>(t=K(t)?new URL(t):T.normalize(t),x.readFileSync(t,e?void 0:"utf8")),f=t=>((t=c(t,!0)).buffer||(t=new Uint8Array(t)),t),h=(t,e,r,n=!0)=>{t=K(t)?new URL(t):T.normalize(t),x.readFile(t,n?void 0:"utf8",((t,i)=>{t?r(t):e(n?i.buffer:i)}))},!l.thisProgram&&1<process.argv.length&&(p=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),v=(t,e)=>{throw process.exitCode=t,e},l.inspect=()=>"[Emscripten Module object]";try{t=kp()}catch(t){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),t}global.Worker=t.Worker}else(y||b)&&(b?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),typeof r<"u"&&r&&(g=r),g=0!==g.indexOf("blob:")?g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):"",_||(c=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},b&&(f=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),h=(t,e,r)=>{var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?e(n.response):r()},n.onerror=r,n.send(null)}));_&&typeof performance>"u"&&(global.performance=Np().performance);var S=console.log.bind(console),E=console.error.bind(console);_&&(S=(...t)=>x.writeSync(1,t.join(" ")+"\n"),E=(...t)=>x.writeSync(2,t.join(" ")+"\n"));var O=S,P=E;Object.assign(l,d),d=null,"object"!=typeof WebAssembly&&W("no native wasm support detected");var A,C,k,I,R,$,M,D,B=!1;function L(){var t=A.buffer;l.HEAP8=I=new Int8Array(t),l.HEAP16=new Int16Array(t),l.HEAPU8=R=new Uint8Array(t),l.HEAPU16=new Uint16Array(t),l.HEAP32=$=new Int32Array(t),l.HEAPU32=M=new Uint32Array(t),l.HEAPF32=new Float32Array(t),l.HEAPF64=D=new Float64Array(t)}var N=16777216;if(m)A=l.wasmMemory;else if(l.wasmMemory)A=l.wasmMemory;else if(!((A=new WebAssembly.Memory({initial:N/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw P("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),_&&P("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");L(),N=A.buffer.byteLength;var F=[],U=[],j=[],z=0,G=null,V=null;function H(){if(0==--z&&(null!==G&&(clearInterval(G),G=null),V)){var t=V;V=null,t()}}function W(t){throw P(t="Aborted("+t+")"),B=!0,k=1,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),u(t),t}var q,Y=t=>t.startsWith("data:application/octet-stream;base64,"),K=t=>t.startsWith("file://");function X(t){if(f)return f(t);throw"both async and sync fetching of the wasm failed"}function Z(t,e,r){return function(t){if(y||b){if("function"==typeof fetch&&!K(t))return fetch(t,{credentials:"same-origin"}).then((e=>{if(!e.ok)throw"failed to load wasm binary file at '"+t+"'";return e.arrayBuffer()})).catch((()=>X(t)));if(h)return new Promise(((e,r)=>{h(t,(t=>e(new Uint8Array(t))),r)}))}return Promise.resolve().then((()=>X(t)))}(t).then((t=>WebAssembly.instantiate(t,e))).then((t=>t)).then(r,(t=>{P(`failed to asynchronously prepare wasm: ${t}`),W(t)}))}Y(q="ort-wasm-threaded.wasm")||(q=w(q));var J,Q={886596:(t,e,r,i)=>{if(typeof l>"u"||!l.hb)return 1;if((t=ot(t>>>0)).startsWith("./")&&(t=t.substring(2)),!(t=l.hb.get(t)))return 2;if(i>>>=0,(e>>>=0)+(r>>>=0)>t.byteLength)return 3;try{return n().set(t.subarray(e,e+r),i>>>0),0}catch{return 4}}};function tt(t){this.name="ExitStatus",this.message=`Program terminated with exit(${t})`,this.status=t}var et=t=>{t.terminate(),t.onmessage=()=>{}},rt=t=>{0==ft.Ta.length&&(ht(),ft.bb(ft.Ta[0]));var e=ft.Ta.pop();if(!e)return 6;ft.Ua.push(e),ft.Qa[t.Sa]=e,e.Sa=t.Sa;var r={cmd:"run",start_routine:t.ob,arg:t.lb,pthread_ptr:t.Sa};return _&&e.unref(),e.postMessage(r,t.ub),0},nt=0,it=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,st=(t,e,r)=>{var n=(e>>>=0)+r;for(r=e;t[r]&&!(r>=n);)++r;if(16<r-e&&t.buffer&&it)return it.decode(t.buffer instanceof SharedArrayBuffer?t.slice(e,r):t.subarray(e,r));for(n="";e<r;){var i=t[e++];if(128&i){var s=63&t[e++];if(192==(224&i))n+=String.fromCharCode((31&i)<<6|s);else{var o=63&t[e++];65536>(i=224==(240&i)?(15&i)<<12|s<<6|o:(7&i)<<18|s<<12|o<<6|63&t[e++])?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else n+=String.fromCharCode(i)}return n},ot=(t,e)=>(t>>>=0)?st(n(),t,e):"";function at(t,e){var r=arguments.length-2,n=arguments;return(t=>{var e=Ee();return t=t(),Oe(e),t})((()=>{for(var i=Pe(8*r),s=i>>>3,a=0;a<r;a++){var u=n[2+a];o()[s+a>>>0]=u}return me(t,r,i,e)}))}function ut(t){if(m)return at(0,1,t);k=t,0<nt||(ft.pb(),l.onExit?.(t),B=!0),v(t,new tt(t))}var lt=t=>{if(k=t,m)throw pt(t),"unwind";ut(t)};function ct(){for(var t=l.numThreads;t--;)ht();F.unshift((()=>{z++,function(t){m?t():Promise.all(ft.Ta.map(ft.bb)).then(t)}((()=>H()))}))}function ht(){var t=w("ort-wasm-threaded.worker.js");t=new Worker(t),ft.Ta.push(t)}var ft={Ta:[],Ua:[],gb:[],Qa:{},$a(){m?(ft.receiveObjectTransfer=ft.nb,ft.threadInitTLS=ft.fb,ft.setExitStatus=ft.eb):ct()},eb:t=>k=t,xb:["$terminateWorker"],pb:()=>{for(var t of ft.Ua)et(t);for(t of ft.Ta)et(t);ft.Ta=[],ft.Ua=[],ft.Qa=[]},cb:t=>{var e=t.Sa;delete ft.Qa[e],ft.Ta.push(t),ft.Ua.splice(ft.Ua.indexOf(t),1),t.Sa=0,ge(e)},nb(){},fb(){ft.gb.forEach((t=>t()))},bb:t=>new Promise((e=>{t.onmessage=r=>{var n=(r=r.data).cmd;if(r.targetThread&&r.targetThread!=ve()){var i=ft.Qa[r.targetThread];i?i.postMessage(r,r.transferList):P(`Internal error! Worker sent a message "${n}" to target pthread ${r.targetThread}, but that thread no longer exists!`)}else"checkMailbox"===n?Nt():"spawnThread"===n?rt(r):"cleanupThread"===n?ft.cb(ft.Qa[r.thread]):"killThread"===n?(r=r.thread,n=ft.Qa[r],delete ft.Qa[r],et(n),ge(r),ft.Ua.splice(ft.Ua.indexOf(n),1),n.Sa=0):"cancelThread"===n?ft.Qa[r.thread].postMessage({cmd:"cancel"}):"loaded"===n?(t.loaded=!0,_&&!t.Sa&&t.unref(),e(t)):"alert"===n?alert(`Thread ${r.threadId}: ${r.text}`):"setimmediate"===r.target?t.postMessage(r):"callHandler"===n?l[r.handler](...r.args):n&&P(`worker sent an unknown command ${n}`)},t.onerror=t=>{throw P(`worker sent an error! ${t.filename}:${t.lineno}: ${t.message}`),t},_&&(t.on("message",(e=>t.onmessage({data:e}))),t.on("error",(e=>t.onerror(e))));var n,i=[];for(n of["onExit"])l.hasOwnProperty(n)&&i.push(n);t.postMessage({cmd:"load",handlers:i,urlOrBlob:l.mainScriptUrlOrBlob||r,wasmMemory:A,wasmModule:C})}))};l.PThread=ft;var dt=t=>{for(;0<t.length;)t.shift()(l)};function pt(t){if(m)return at(1,0,t);lt(t)}l.establishStackSpace=()=>{var t=ve(),e=s()[t+52>>>2>>>0];t=s()[t+56>>>2>>>0],Se(e,e-t),Oe(e)};var vt,yt=[],bt=t=>{var e=yt[t];return e||(t>=yt.length&&(yt.length=t+1),yt[t]=e=vt.get(t)),e};function _t(t){this.Za=t-24,this.kb=function(t){s()[this.Za+4>>>2>>>0]=t},this.jb=function(t){s()[this.Za+8>>>2>>>0]=t},this.$a=function(t,e){this.ib(),this.kb(t),this.jb(e)},this.ib=function(){s()[this.Za+16>>>2>>>0]=0}}function mt(t,e,r,n){return m?at(2,1,t,e,r,n):gt(t,e,r,n)}function gt(t,e,r,n){if(t>>>=0,e>>>=0,r>>>=0,n>>>=0,typeof SharedArrayBuffer>"u")return P("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var i=[];return m&&0===i.length?mt(t,e,r,n):(t={ob:r,Sa:t,lb:n,ub:i},m?(t.wb="spawnThread",postMessage(t,i),0):rt(t))}function wt(t,e,r){return m?at(3,1,t,e,r):0}function xt(t,e){if(m)return at(4,1,t,e)}l.invokeEntryPoint=(t,e)=>{t=bt(t)(e),0<nt?ft.eb(t):we(t)};var Tt=t=>{for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);127>=n?e++:2047>=n?e+=2:55296<=n&&57343>=n?(e+=4,++r):e+=3}return e},St=(t,e,r,n)=>{if(!(0<n))return 0;var i=r>>>=0;n=r+n-1;for(var s=0;s<t.length;++s){var o=t.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++s)),127>=o){if(r>=n)break;e[r++>>>0]=o}else{if(2047>=o){if(r+1>=n)break;e[r++>>>0]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;e[r++>>>0]=224|o>>12}else{if(r+3>=n)break;e[r++>>>0]=240|o>>18,e[r++>>>0]=128|o>>12&63}e[r++>>>0]=128|o>>6&63}e[r++>>>0]=128|63&o}}return e[r>>>0]=0,r-i},Et=(t,e,r)=>St(t,n(),e,r);function Ot(t,e){if(m)return at(5,1,t,e)}function Pt(t,e,r){if(m)return at(6,1,t,e,r)}function At(t,e,r){return m?at(7,1,t,e,r):0}function Ct(t,e){if(m)return at(8,1,t,e)}function kt(t,e,r){if(m)return at(9,1,t,e,r)}function It(t,e,r,n){if(m)return at(10,1,t,e,r,n)}function Rt(t,e,r,n){if(m)return at(11,1,t,e,r,n)}function $t(t,e,r,n){if(m)return at(12,1,t,e,r,n)}function Mt(t){if(m)return at(13,1,t)}function Dt(t,e){if(m)return at(14,1,t,e)}function Bt(t,e,r){if(m)return at(15,1,t,e,r)}function Lt(t){t>>>=0,"function"==typeof Atomics.vb&&(Atomics.vb(i(),t>>>2,t).value.then(Nt),t+=128,Atomics.store(i(),t>>>2,1))}l.__emscripten_thread_mailbox_await=Lt;var Nt=()=>{var t=ve();if(t&&(Lt(t),t=xe,!B))try{if(t(),!(0<nt))try{m?we(k):lt(k)}catch(t){t instanceof tt||"unwind"==t||v(1,t)}}catch(t){t instanceof tt||"unwind"==t||v(1,t)}};l.checkMailbox=Nt;var Ft=[],Ut=t=>t%4==0&&(t%100!=0||t%400==0),zt=[0,31,60,91,121,152,182,213,244,274,305,335],Gt=[0,31,59,90,120,151,181,212,243,273,304,334];function Vt(t,e,r,n,i,s,o,a){return m?at(16,1,t,e,r,n,i,s,o,a):-52}function Ht(t,e,r,n,i,s,o){if(m)return at(17,1,t,e,r,n,i,s,o)}var Wt,qt=t=>{var e=Tt(t)+1,r=ye(e);return r&&Et(t,r,e),r},Yt=[],Kt={},Xt=()=>{if(!Wt){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:p||"./this.program"};for(t in Kt)void 0===Kt[t]?delete e[t]:e[t]=Kt[t];var r=[];for(t in e)r.push(`${t}=${e[t]}`);Wt=r}return Wt};function Zt(t,r){if(m)return at(18,1,t,r);t>>>=0,r>>>=0;var n=0;return Xt().forEach(((i,o)=>{var a=r+n;for(o=s()[t+4*o>>>2>>>0]=a,a=0;a<i.length;++a)e()[o++>>>0>>>0]=i.charCodeAt(a);e()[o>>>0>>>0]=0,n+=i.length+1})),0}function Jt(t,e){if(m)return at(19,1,t,e);t>>>=0,e>>>=0;var r=Xt();s()[t>>>2>>>0]=r.length;var n=0;return r.forEach((t=>n+=t.length+1)),s()[e>>>2>>>0]=n,0}function Qt(t){return m?at(20,1,t):52}function te(t,e,r,n){return m?at(21,1,t,e,r,n):52}function ee(t,e,r,n,i){return m?at(22,1,t,e,r,n,i):70}var re=[null,[],[]];function ne(t,e,r,i){if(m)return at(23,1,t,e,r,i);e>>>=0,r>>>=0,i>>>=0;for(var o=0,a=0;a<r;a++){var u=s()[e>>>2>>>0],l=s()[e+4>>>2>>>0];e+=8;for(var c=0;c<l;c++){var h=n()[u+c>>>0],f=re[t];0===h||10===h?((1===t?O:P)(st(f,0)),f.length=0):f.push(h)}o+=l}return s()[i>>>2>>>0]=o,0}var ie=t=>(ie=(()=>{if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues)return t=>(t.set(crypto.getRandomValues(new Uint8Array(t.byteLength))),t);if(_)try{var t=(ca(),jt(fa));if(t.randomFillSync)return e=>t.randomFillSync(e);var e=t.randomBytes;return t=>(t.set(e(t.byteLength)),t)}catch{}W("initRandomDevice")})())(t),se=[31,29,31,30,31,30,31,31,30,31,30,31],oe=[31,28,31,30,31,30,31,31,30,31,30,31];function ae(t,r,n,o){function a(t,e,r){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=r[0]+t;return t}function u(t,e){return a(t,e,"0")}function l(t,e){function r(t){return 0>t?-1:0<t?1:0}var n;return 0===(n=r(t.getFullYear()-e.getFullYear()))&&0===(n=r(t.getMonth()-e.getMonth()))&&(n=r(t.getDate()-e.getDate())),n}function c(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function h(t){var e=t.Va;for(t=new Date(new Date(t.Wa+1900,0,1).getTime());0<e;){var r=t.getMonth(),n=(Ut(t.getFullYear())?se:oe)[r];if(!(e>n-t.getDate())){t.setDate(t.getDate()+e);break}e-=n-t.getDate()+1,t.setDate(1),11>r?t.setMonth(r+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return r=new Date(t.getFullYear()+1,0,4),e=c(new Date(t.getFullYear(),0,4)),r=c(r),0>=l(e,t)?0>=l(r,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}t>>>=0,r>>>=0,n>>>=0,o>>>=0;var f=s()[o+40>>>2>>>0];for(var d in o={sb:i()[o>>>2>>>0],rb:i()[o+4>>>2>>>0],Xa:i()[o+8>>>2>>>0],ab:i()[o+12>>>2>>>0],Ya:i()[o+16>>>2>>>0],Wa:i()[o+20>>>2>>>0],Ra:i()[o+24>>>2>>>0],Va:i()[o+28>>>2>>>0],yb:i()[o+32>>>2>>>0],qb:i()[o+36>>>2>>>0],tb:f?ot(f):""},n=ot(n),f={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(d,"g"),f[d]);var p="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),v="January February March April May June July August September October November December".split(" ");for(d in f={"%a":t=>p[t.Ra].substring(0,3),"%A":t=>p[t.Ra],"%b":t=>v[t.Ya].substring(0,3),"%B":t=>v[t.Ya],"%C":t=>u((t.Wa+1900)/100|0,2),"%d":t=>u(t.ab,2),"%e":t=>a(t.ab,2," "),"%g":t=>h(t).toString().substring(2),"%G":t=>h(t),"%H":t=>u(t.Xa,2),"%I":t=>(0==(t=t.Xa)?t=12:12<t&&(t-=12),u(t,2)),"%j":t=>{for(var e=0,r=0;r<=t.Ya-1;e+=(Ut(t.Wa+1900)?se:oe)[r++]);return u(t.ab+e,3)},"%m":t=>u(t.Ya+1,2),"%M":t=>u(t.rb,2),"%n":()=>"\n","%p":t=>0<=t.Xa&&12>t.Xa?"AM":"PM","%S":t=>u(t.sb,2),"%t":()=>"\t","%u":t=>t.Ra||7,"%U":t=>u(Math.floor((t.Va+7-t.Ra)/7),2),"%V":t=>{var e=Math.floor((t.Va+7-(t.Ra+6)%7)/7);if(2>=(t.Ra+371-t.Va-2)%7&&e++,e)53==e&&(4==(r=(t.Ra+371-t.Va)%7)||3==r&&Ut(t.Wa)||(e=1));else{e=52;var r=(t.Ra+7-t.Va-1)%7;(4==r||5==r&&Ut(t.Wa%400-1))&&e++}return u(e,2)},"%w":t=>t.Ra,"%W":t=>u(Math.floor((t.Va+7-(t.Ra+6)%7)/7),2),"%y":t=>(t.Wa+1900).toString().substring(2),"%Y":t=>t.Wa+1900,"%z":t=>(0<=(t=t.qb)?"+":"-")+("0000"+((t=Math.abs(t)/60)/60*100+t%60)).slice(-4),"%Z":t=>t.tb,"%%":()=>"%"},n=n.replace(/%%/g,"\0\0"),f)n.includes(d)&&(n=n.replace(new RegExp(d,"g"),f[d](o)));return d=function(t){var e=Array(Tt(t)+1);return St(t,e,0,e.length),e}(n=n.replace(/\0\0/g,"%")),d.length>r?0:(((t,r)=>{e().set(t,r>>>0)})(d,t),d.length-1)}var ue,le=[],ce=(t,e)=>{if(!ue){ue=new WeakMap;var r=vt.length;if(ue)for(var n=0;n<0+r;n++){var i=bt(n);i&&ue.set(i,n)}}if(r=ue.get(t)||0)return r;if(le.length)r=le.pop();else{try{vt.grow(1)}catch(t){throw t instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":t}r=vt.length-1}try{n=r,vt.set(n,t),yt[n]=vt.get(n)}catch(a){if(!(a instanceof TypeError))throw a;if("function"==typeof WebAssembly.Function){n=WebAssembly.Function,i={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"};for(var s={parameters:[],results:"v"==e[0]?[]:[i[e[0]]]},o=1;o<e.length;++o)s.parameters.push(i[e[o]]);e=new n(s,t)}else{for(n=[1],i=e.slice(0,1),e=e.slice(1),s={i:127,p:127,j:126,f:125,d:124,e:111},n.push(96),128>(o=e.length)?n.push(o):n.push(o%128|128,o>>7),o=0;o<e.length;++o)n.push(s[e[o]]);"v"==i?n.push(0):n.push(1,s[i]),e=[0,97,115,109,1,0,0,0,1],128>(i=n.length)?e.push(i):e.push(i%128|128,i>>7),e.push.apply(e,n),e.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),e=new WebAssembly.Module(new Uint8Array(e)),e=new WebAssembly.Instance(e,{e:{f:t}}).exports.f}n=r,vt.set(n,e),yt[n]=vt.get(n)}return ue.set(t,r),r};ft.$a();var he=[ut,pt,mt,wt,xt,Ot,Pt,At,Ct,kt,It,Rt,$t,Mt,Dt,Bt,Vt,Ht,Zt,Jt,Qt,te,ee,ne],fe={b:function(t,e,r){throw new _t(t>>>=0).$a(e>>>0,r>>>0),t},O:function(t){be(t>>>0,!b,1,!y,131072,!1),ft.fb()},m:function(t){t>>>=0,m?postMessage({cmd:"cleanupThread",thread:t}):ft.cb(ft.Qa[t])},J:gt,h:wt,U:xt,F:Ot,H:Pt,y:At,S:Ct,L:kt,R:It,o:Rt,G:$t,D:Mt,T:Dt,E:Bt,p:()=>1,B:function(t,e){(t>>>=0)==e>>>0?setTimeout((()=>Nt())):m?postMessage({targetThread:t,cmd:"checkMailbox"}):(t=ft.Qa[t])&&t.postMessage({cmd:"checkMailbox"})},K:function(t,e,r,n){e>>>=0,Ft.length=r,n=n>>>0>>>3;for(var i=0;i<r;i++)Ft[i]=o()[n+i>>>0];return t=0>t?Q[-t-1]:he[t],ft.mb=e,e=t.apply(null,Ft),ft.mb=0,e},M:Lt,W:function(t){_&&ft.Qa[t>>>0].ref()},s:function(t,e,r){t=e+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*e:NaN,r>>>=0,t=new Date(1e3*t),i()[r>>>2>>>0]=t.getUTCSeconds(),i()[r+4>>>2>>>0]=t.getUTCMinutes(),i()[r+8>>>2>>>0]=t.getUTCHours(),i()[r+12>>>2>>>0]=t.getUTCDate(),i()[r+16>>>2>>>0]=t.getUTCMonth(),i()[r+20>>>2>>>0]=t.getUTCFullYear()-1900,i()[r+24>>>2>>>0]=t.getUTCDay(),t=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,i()[r+28>>>2>>>0]=t},t:function(t,e,r){t=e+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*e:NaN,r>>>=0,t=new Date(1e3*t),i()[r>>>2>>>0]=t.getSeconds(),i()[r+4>>>2>>>0]=t.getMinutes(),i()[r+8>>>2>>>0]=t.getHours(),i()[r+12>>>2>>>0]=t.getDate(),i()[r+16>>>2>>>0]=t.getMonth(),i()[r+20>>>2>>>0]=t.getFullYear()-1900,i()[r+24>>>2>>>0]=t.getDay(),e=(Ut(t.getFullYear())?zt:Gt)[t.getMonth()]+t.getDate()-1|0,i()[r+28>>>2>>>0]=e,i()[r+36>>>2>>>0]=-60*t.getTimezoneOffset(),e=new Date(t.getFullYear(),6,1).getTimezoneOffset();var n=new Date(t.getFullYear(),0,1).getTimezoneOffset();t=0|(e!=n&&t.getTimezoneOffset()==Math.min(n,e)),i()[r+32>>>2>>>0]=t},u:function(t){t>>>=0;var e=new Date(i()[t+20>>>2>>>0]+1900,i()[t+16>>>2>>>0],i()[t+12>>>2>>>0],i()[t+8>>>2>>>0],i()[t+4>>>2>>>0],i()[t>>>2>>>0],0),r=i()[t+32>>>2>>>0],n=e.getTimezoneOffset(),s=new Date(e.getFullYear(),6,1).getTimezoneOffset(),o=new Date(e.getFullYear(),0,1).getTimezoneOffset(),a=Math.min(o,s);return 0>r?i()[t+32>>>2>>>0]=+(s!=o&&a==n):0<r!=(a==n)&&(s=Math.max(o,s),e.setTime(e.getTime()+6e4*((0<r?a:s)-n))),i()[t+24>>>2>>>0]=e.getDay(),r=(Ut(e.getFullYear())?zt:Gt)[e.getMonth()]+e.getDate()-1|0,i()[t+28>>>2>>>0]=r,i()[t>>>2>>>0]=e.getSeconds(),i()[t+4>>>2>>>0]=e.getMinutes(),i()[t+8>>>2>>>0]=e.getHours(),i()[t+12>>>2>>>0]=e.getDate(),i()[t+16>>>2>>>0]=e.getMonth(),i()[t+20>>>2>>>0]=e.getYear(),t=e.getTime(),isNaN(t)?(i()[pe()>>>2>>>0]=61,t=-1):t/=1e3,Te((J=t,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)),t>>>0},q:Vt,r:Ht,A:function(t,e,r){function n(t){return(t=t.toTimeString().match(/\(([A-Za-z ]+)\)$/))?t[1]:"GMT"}t>>>=0,e>>>=0,r>>>=0;var o=(new Date).getFullYear(),a=new Date(o,0,1),u=new Date(o,6,1);o=a.getTimezoneOffset();var l=u.getTimezoneOffset(),c=Math.max(o,l);s()[t>>>2>>>0]=60*c,i()[e>>>2>>>0]=+(o!=l),t=n(a),e=n(u),t=qt(t),e=qt(e),l<o?(s()[r>>>2>>>0]=t,s()[r+4>>>2>>>0]=e):(s()[r>>>2>>>0]=e,s()[r+4>>>2>>>0]=t)},c:()=>{W("")},N:function(t,e,r){t>>>=0,e>>>=0,r>>>=0,Yt.length=0;for(var a;a=n()[e++>>>0];){var u=105!=a;r+=(u&=112!=a)&&r%8?4:0,Yt.push(112==a?s()[r>>>2>>>0]:105==a?i()[r>>>2>>>0]:o()[r>>>3>>>0]),r+=u?8:4}return Q[t].apply(null,Yt)},n:()=>{},i:()=>Date.now(),V:()=>{throw nt+=1,"unwind"},C:function(){return 4294901760},e:()=>performance.timeOrigin+performance.now(),f:()=>_?(Mp(),jt(Rp)).cpus().length:navigator.hardwareConcurrency,z:function(t){t>>>=0;var e=n().length;if(t<=e||4294901760<t)return!1;for(var r=1;4>=r;r*=2){var i=e*(1+.2/r);i=Math.min(i,t+100663296);var s=Math;i=Math.max(t,i);t:{s=(s.min.call(s,4294901760,i+(65536-i%65536)%65536)-A.buffer.byteLength+65535)/65536;try{A.grow(s),L();var o=1;break t}catch{}o=void 0}if(o)return!0}return!1},P:Zt,Q:Jt,I:lt,g:Qt,l:te,v:ee,k:ne,w:function(t,e){return t>>>=0,e>>>=0,ie(n().subarray(t>>>0,t+e>>>0)),0},a:A||l.wasmMemory,x:ae,d:function(t,e,r,n){return ae(t>>>0,e>>>0,r>>>0,n>>>0)},j:function(t,e,r,i){let s=vt.length;t=new Uint8Array(n().slice(t+e,t+r));try{var o,a=new WebAssembly.Module(t),u=new WebAssembly.Instance(a,{env:{memory:A}});for(o in u.exports)ce(u.exports[o]);return s<vt.length?s:i}catch(t){return console.log(t),i}}},de=function(){function t(t,e){return de=t.exports,de=function(){var t=de;t=Object.assign({},t);var e=t=>()=>t()>>>0,r=t=>e=>t(e)>>>0;return t.za=e(t.za),t.Aa=e(t.Aa),t.Ba=r(t.Ba),t.emscripten_main_runtime_thread_id=e(t.emscripten_main_runtime_thread_id),t.Na=e(t.Na),t.Pa=r(t.Pa),t}(),ft.gb.push(de.Da),vt=de.Ea,U.unshift(de.X),C=e,H(),de}var e={a:fe};if(z++,l.instantiateWasm)try{return l.instantiateWasm(e,t)}catch(t){P(`Module.instantiateWasm callback failed with error: ${t}`),u(t)}return function(t,e){var r=q;return"function"!=typeof WebAssembly.instantiateStreaming||Y(r)||K(r)||_||"function"!=typeof fetch?Z(r,t,e):fetch(r,{credentials:"same-origin"}).then((n=>WebAssembly.instantiateStreaming(n,t).then(e,(function(n){return P(`wasm streaming compile failed: ${n}`),P("falling back to ArrayBuffer instantiation"),Z(r,t,e)}))))}(e,(function(e){t(e.instance,e.module)})).catch(u),{}}();l._OrtInit=(t,e)=>(l._OrtInit=de.Y)(t,e),l._OrtGetLastError=(t,e)=>(l._OrtGetLastError=de.Z)(t,e),l._OrtCreateSessionOptions=(t,e,r,n,i,s,o,a,u,c)=>(l._OrtCreateSessionOptions=de._)(t,e,r,n,i,s,o,a,u,c),l._OrtAppendExecutionProvider=(t,e)=>(l._OrtAppendExecutionProvider=de.$)(t,e),l._OrtAddFreeDimensionOverride=(t,e,r)=>(l._OrtAddFreeDimensionOverride=de.aa)(t,e,r),l._OrtAddSessionConfigEntry=(t,e,r)=>(l._OrtAddSessionConfigEntry=de.ba)(t,e,r),l._OrtReleaseSessionOptions=t=>(l._OrtReleaseSessionOptions=de.ca)(t),l._OrtCreateSession=(t,e,r)=>(l._OrtCreateSession=de.da)(t,e,r),l._OrtReleaseSession=t=>(l._OrtReleaseSession=de.ea)(t),l._OrtGetInputOutputCount=(t,e,r)=>(l._OrtGetInputOutputCount=de.fa)(t,e,r),l._OrtGetInputName=(t,e)=>(l._OrtGetInputName=de.ga)(t,e),l._OrtGetOutputName=(t,e)=>(l._OrtGetOutputName=de.ha)(t,e),l._OrtFree=t=>(l._OrtFree=de.ia)(t),l._OrtCreateTensor=(t,e,r,n,i,s)=>(l._OrtCreateTensor=de.ja)(t,e,r,n,i,s),l._OrtGetTensorData=(t,e,r,n,i)=>(l._OrtGetTensorData=de.ka)(t,e,r,n,i),l._OrtReleaseTensor=t=>(l._OrtReleaseTensor=de.la)(t),l._OrtCreateRunOptions=(t,e,r,n)=>(l._OrtCreateRunOptions=de.ma)(t,e,r,n),l._OrtAddRunConfigEntry=(t,e,r)=>(l._OrtAddRunConfigEntry=de.na)(t,e,r),l._OrtReleaseRunOptions=t=>(l._OrtReleaseRunOptions=de.oa)(t),l._OrtCreateBinding=t=>(l._OrtCreateBinding=de.pa)(t),l._OrtBindInput=(t,e,r)=>(l._OrtBindInput=de.qa)(t,e,r),l._OrtBindOutput=(t,e,r,n)=>(l._OrtBindOutput=de.ra)(t,e,r,n),l._OrtClearBoundOutputs=t=>(l._OrtClearBoundOutputs=de.sa)(t),l._OrtReleaseBinding=t=>(l._OrtReleaseBinding=de.ta)(t),l._OrtRunWithBinding=(t,e,r,n,i)=>(l._OrtRunWithBinding=de.ua)(t,e,r,n,i),l._OrtRun=(t,e,r,n,i,s,o,a)=>(l._OrtRun=de.va)(t,e,r,n,i,s,o,a),l._OrtEndProfiling=t=>(l._OrtEndProfiling=de.wa)(t),l._OrtConfigure=(t,e)=>(l._OrtConfigure=de.xa)(t,e),l._OrtAuth=(t,e)=>(l._OrtAuth=de.ya)(t,e);var pe=()=>(pe=de.za)(),ve=l._pthread_self=()=>(ve=l._pthread_self=de.Aa)(),ye=l._malloc=t=>(ye=l._malloc=de.Ba)(t);l._free=t=>(l._free=de.Ca)(t),l.__emscripten_tls_init=()=>(l.__emscripten_tls_init=de.Da)();var be=l.__emscripten_thread_init=(t,e,r,n,i,s)=>(be=l.__emscripten_thread_init=de.Fa)(t,e,r,n,i,s);l.__emscripten_thread_crashed=()=>(l.__emscripten_thread_crashed=de.Ga)();var _e,me=(t,e,r,n)=>(me=de.Ha)(t,e,r,n),ge=t=>(ge=de.Ia)(t),we=l.__emscripten_thread_exit=t=>(we=l.__emscripten_thread_exit=de.Ja)(t),xe=()=>(xe=de.Ka)(),Te=t=>(Te=de.La)(t),Se=(t,e)=>(Se=de.Ma)(t,e),Ee=()=>(Ee=de.Na)(),Oe=t=>(Oe=de.Oa)(t),Pe=t=>(Pe=de.Pa)(t);function Ae(){if(!(0<z))if(m)a(l),m||dt(U),startWorker(l);else{if(l.preRun)for("function"==typeof l.preRun&&(l.preRun=[l.preRun]);l.preRun.length;)F.unshift(l.preRun.shift());dt(F),0<z||_e||(_e=!0,l.calledRun=!0,B||(m||dt(U),a(l),m||dt(j)))}}return l.___start_em_js=887097,l.___stop_em_js=887709,l.wasmMemory=A,l.stackAlloc=Pe,l.stackSave=Ee,l.stackRestore=Oe,l.keepRuntimeAlive=()=>0<nt,l.addFunction=ce,l.UTF8ToString=ot,l.stringToUTF8=Et,l.lengthBytesUTF8=Tt,l.ExitStatus=tt,l.PThread=ft,V=function t(){_e||Ae(),_e||(V=t)},Ae(),t.ready});"object"==typeof t&&"object"==typeof e?e.exports=n:"function"==typeof define&&define.amd&&define([],(()=>n))})),Wp=ye(((t,e)=>{e.exports='"use strict";var Module={},ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads"),parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",e=>onmessage({data:e}));var fs=require("fs"),vm=require("vm");Object.assign(global,{self:global,require,Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:e=>vm.runInThisContext(fs.readFileSync(e,"utf8"),{filename:e}),postMessage:e=>parentPort.postMessage(e),performance:global.performance||{now:Date.now}})}var initializedJS=!1;function threadPrintErr(){var e=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,e+`\n`);return}console.error(e)}function threadAlert(){var e=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:e,threadId:Module._pthread_self()})}var err=threadPrintErr;self.alert=threadAlert,Module.instantiateWasm=(e,t)=>{var a=Module.wasmModule;Module.wasmModule=null;var r=new WebAssembly.Instance(a,e);return t(r)},self.onunhandledrejection=e=>{throw e.reason||e};function handleMessage(e){try{if(e.data.cmd==="load"){let a=[];self.onmessage=r=>a.push(r),self.startWorker=r=>{Module=r,postMessage({cmd:"loaded"});for(let s of a)handleMessage(s);self.onmessage=handleMessage},Module.wasmModule=e.data.wasmModule;for(const r of e.data.handlers)Module[r]=(...s)=>{postMessage({cmd:"callHandler",handler:r,args:s})};if(Module.wasmMemory=e.data.wasmMemory,Module.buffer=Module.wasmMemory.buffer,Module.ENVIRONMENT_IS_PTHREAD=!0,typeof e.data.urlOrBlob=="string")importScripts(e.data.urlOrBlob);else{var t=URL.createObjectURL(e.data.urlOrBlob);importScripts(t),URL.revokeObjectURL(t)}ortWasmThreaded(Module)}else if(e.data.cmd==="run"){Module.__emscripten_thread_init(e.data.pthread_ptr,0,0,1),Module.__emscripten_thread_mailbox_await(e.data.pthread_ptr),Module.establishStackSpace(),Module.PThread.receiveObjectTransfer(e.data),Module.PThread.threadInitTLS(),initializedJS||(initializedJS=!0);try{Module.invokeEntryPoint(e.data.start_routine,e.data.arg)}catch(a){if(a!="unwind")throw a}}else e.data.cmd==="cancel"?Module._pthread_self()&&Module.__emscripten_thread_exit(-1):e.data.target==="setimmediate"||(e.data.cmd==="checkMailbox"?initializedJS&&Module.checkMailbox():e.data.cmd&&(err(`worker.js received unknown command ${e.data.cmd}`),err(e.data)))}catch(a){throw Module.__emscripten_thread_crashed?.(),a}}self.onmessage=handleMessage;\n'})),Hp,Tg,ha,ma,$o,Vp,xg,wg,vg,jp,Se,Kr=D((()=>{Hp=$p(),Tg=zp(),ma=!1,$o=!1,Vp=!1,xg=t=>{if(1===t)return!1;if(typeof SharedArrayBuffer>"u")return typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+t+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),!1;typeof process<"u"&&process.versions&&process.versions.node&&console.warn("env.wasm.numThreads is set to "+t+", however, currently onnxruntime-web does not support multi-threads in Node.js. Please consider using onnxruntime-node for performance critical scenarios.");try{return typeof MessageChannel<"u"&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},wg=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},vg=(t,e)=>t?e?"ort-wasm-simd-threaded.wasm":"ort-wasm-simd.wasm":e?"ort-wasm-threaded.wasm":"ort-wasm.wasm",jp=async t=>{if(ma)return Promise.resolve();if($o)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Vp)throw new Error("previous call to 'initializeWebAssembly()' failed.");$o=!0;let e=t.initTimeout,r=t.numThreads,n=t.simd,i=xg(r),s=n&&wg(),o=t.wasmPaths,a="string"==typeof o?o:void 0,u=vg(s,i),l="object"==typeof o?o[u]:void 0,c=!1,h=[];if(e>0&&h.push(new Promise((t=>{setTimeout((()=>{c=!0,t()}),e)}))),h.push(new Promise(((t,e)=>{let n=i?Tg:Hp,s={locateFile:(t,e)=>i&&t.endsWith(".worker.js")&&typeof Blob<"u"?URL.createObjectURL(new Blob([Wp()],{type:"text/javascript"})):t.endsWith(".wasm")?l||(a??e)+u:e+t};if(i)if(s.numThreads=r,typeof Blob>"u")s.mainScriptUrlOrBlob=(void 0)(__dirname,"ort-wasm-threaded.js");else{let t=`var ortWasmThreaded=${n.toString()};`;s.mainScriptUrlOrBlob=new Blob([t],{type:"text/javascript"})}n(s).then((e=>{$o=!1,ma=!0,ha=e,t()}),(t=>{$o=!1,Vp=!0,e(t)}))}))),await Promise.race(h),c)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},Se=()=>{if(ma&&ha)return ha;throw new Error("WebAssembly is not initialized yet.")}})),Ie,_n,Ae,ko=D((()=>{Kr(),Ie=(t,e)=>{let r=Se(),n=r.lengthBytesUTF8(t)+1,i=r._malloc(n);return r.stringToUTF8(t,i,n),e.push(i),i},_n=(t,e,r,n)=>{if("object"==typeof t&&null!==t){if(r.has(t))throw new Error("Circular reference in options");r.add(t)}Object.entries(t).forEach((([t,i])=>{let s=e?e+t:t;if("object"==typeof i)_n(i,s+".",r,n);else if("string"==typeof i||"number"==typeof i)n(s,i.toString());else{if("boolean"!=typeof i)throw new Error("Can't handle extra config type: "+typeof i);n(s,i?"1":"0")}}))},Ae=t=>{let e=Se(),r=e.stackSave();try{let r=e.stackAlloc(8);e._OrtGetLastError(r,r+4);let n=e.HEAP32[r/4],i=e.HEAPU32[r/4+1],s=i?e.UTF8ToString(i):"";throw new Error(`${t} ERROR_CODE: ${n}, ERROR_MESSAGE: ${s}`)}finally{e.stackRestore(r)}}})),qp,Yp=D((()=>{Kr(),ko(),qp=t=>{let e=Se(),r=0,n=[],i=t||{};try{if(void 0===t?.logSeverityLevel)i.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===t?.logVerbosityLevel)i.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);void 0===t?.terminate&&(i.terminate=!1);let s=0;return void 0!==t?.tag&&(s=Ie(t.tag,n)),r=e._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,s),0===r&&Ae("Can't create run options."),void 0!==t?.extra&&_n(t.extra,"",new WeakSet,((t,i)=>{let s=Ie(t,n),o=Ie(i,n);0!==e._OrtAddRunConfigEntry(r,s,o)&&Ae(`Can't set a run config entry: ${t} - ${i}.`)})),[r,n]}catch(t){throw 0!==r&&e._OrtReleaseRunOptions(r),n.forEach((t=>e._free(t))),t}}})),_g,Og,Sg,Ig,Xp,Kp=D((()=>{Kr(),ko(),_g=t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}},Og=t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}},Sg=t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});let e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some((t=>"webgpu"===("string"==typeof t?t:t.name)))&&(t.enableMemPattern=!1)},Ig=(t,e,r)=>{for(let n of e){let e="string"==typeof n?n:n.name;switch(e){case"webnn":if(e="WEBNN","string"!=typeof n){let e=n;if(e?.deviceType){let n=Ie("deviceType",r),i=Ie(e.deviceType,r);0!==Se()._OrtAddSessionConfigEntry(t,n,i)&&Ae(`Can't set a session config entry: 'deviceType' - ${e.deviceType}.`)}if(e?.numThreads){let n=e.numThreads;("number"!=typeof n||!Number.isInteger(n)||n<0)&&(n=0);let i=Ie("numThreads",r),s=Ie(n.toString(),r);0!==Se()._OrtAddSessionConfigEntry(t,i,s)&&Ae(`Can't set a session config entry: 'numThreads' - ${e.numThreads}.`)}if(e?.powerPreference){let n=Ie("powerPreference",r),i=Ie(e.powerPreference,r);0!==Se()._OrtAddSessionConfigEntry(t,n,i)&&Ae(`Can't set a session config entry: 'powerPreference' - ${e.powerPreference}.`)}}break;case"webgpu":if(e="JS","string"!=typeof n){let e=n;if(e?.preferredLayout){if("NCHW"!==e.preferredLayout&&"NHWC"!==e.preferredLayout)throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${e.preferredLayout}`);let n=Ie("preferredLayout",r),i=Ie(e.preferredLayout,r);0!==Se()._OrtAddSessionConfigEntry(t,n,i)&&Ae(`Can't set a session config entry: 'preferredLayout' - ${e.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${e}`)}let i=Ie(e,r);0!==Se()._OrtAppendExecutionProvider(t,i)&&Ae(`Can't append execution provider: ${e}.`)}},Xp=t=>{let e=Se(),r=0,n=[],i=t||{};Sg(i);try{let t=_g(i.graphOptimizationLevel??"all"),s=Og(i.executionMode??"sequential"),o="string"==typeof i.logId?Ie(i.logId,n):0,a=i.logSeverityLevel??2;if(!Number.isInteger(a)||a<0||a>4)throw new Error(`log serverity level is not valid: ${a}`);let u=i.logVerbosityLevel??0;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log verbosity level is not valid: ${u}`);let l="string"==typeof i.optimizedModelFilePath?Ie(i.optimizedModelFilePath,n):0;if(r=e._OrtCreateSessionOptions(t,!!i.enableCpuMemArena,!!i.enableMemPattern,s,!!i.enableProfiling,0,o,a,u,l),0===r&&Ae("Can't create session options."),i.executionProviders&&Ig(r,i.executionProviders,n),void 0!==i.enableGraphCapture){if("boolean"!=typeof i.enableGraphCapture)throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);let t=Ie("enableGraphCapture",n),s=Ie(i.enableGraphCapture.toString(),n);0!==e._OrtAddSessionConfigEntry(r,t,s)&&Ae(`Can't set a session config entry: 'enableGraphCapture' - ${i.enableGraphCapture}.`)}if(i.freeDimensionOverrides)for(let[t,s]of Object.entries(i.freeDimensionOverrides)){if("string"!=typeof t)throw new Error(`free dimension override name must be a string: ${t}`);if("number"!=typeof s||!Number.isInteger(s)||s<0)throw new Error(`free dimension override value must be a non-negative integer: ${s}`);let i=Ie(t,n);0!==e._OrtAddFreeDimensionOverride(r,i,s)&&Ae(`Can't set a free dimension override: ${t} - ${s}.`)}return void 0!==i.extra&&_n(i.extra,"",new WeakSet,((t,i)=>{let s=Ie(t,n),o=Ie(i,n);0!==e._OrtAddSessionConfigEntry(r,s,o)&&Ae(`Can't set a session config entry: ${t} - ${i}.`)})),[r,n]}catch(t){throw 0!==r&&e._OrtReleaseSessionOptions(r),n.forEach((t=>e._free(t))),t}}})),ba,Jp,ga,Zp,Qp,No,ed,ya=D((()=>{ba=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${t}`)}},Jp=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${t}`)}},ga=t=>[void 0,4,1,1,2,2,4,8,void 0,1,2,8,4,8,void 0,void 0,void 0][t],Zp=t=>{switch(t){case"float16":case"uint16":return Uint16Array;case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}},Qp=t=>{switch(t){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${t}`)}},No=t=>"float32"===t||"int32"===t||"int64"===t||"bool"===t||"float16"===t||"uint32"===t,ed=t=>{switch(t){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;default:throw new Error(`unsupported data location: ${t}`)}}})),On,Ta=D((()=>{On=async t=>{if("string"!=typeof t)return t instanceof Blob?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:new Uint8Array(t);if(!(typeof process<"u"&&process.versions&&process.versions.node)){let e=await fetch(t);if(!e.ok)throw new Error(`failed to load external data file: ${t}`);let r=e.headers.get("Content-Length"),n=r?parseInt(r,10):0;if(n<1073741824)return new Uint8Array(await e.arrayBuffer());{if(!e.body)throw new Error(`failed to load external data file: ${t}, no response body.`);let r,i=e.body.getReader();try{r=new ArrayBuffer(n)}catch(t){if(!(t instanceof RangeError))throw t;{let t=Math.ceil(n/65536);r=new WebAssembly.Memory({initial:t,maximum:t}).buffer}}let s=0;for(;;){let{done:t,value:e}=await i.read();if(t)break;let n=e.byteLength;new Uint8Array(r,s,n).set(e),s+=n}return new Uint8Array(r,0,n)}}try{return new Uint8Array(await(void 0)(t))}catch(e){if("ERR_FS_FILE_TOO_LARGE"===e.code){let e=(void 0)(t),r=[];for await(let t of e)r.push(t);return new Uint8Array(Buffer.concat(r))}throw e}}})),Ag,rd,nd,Jr,Eg,xa,od,id,Pg,td,ad,sd,ud,ld,wa,fd=D((()=>{Yp(),Kp(),ya(),Kr(),ko(),Ta(),Ag=(t,e)=>{0!==Se()._OrtInit(t,e)&&Ae("Can't initialize onnxruntime.")},rd=async t=>{Ag(t.wasm.numThreads,Qp(t.logLevel))},nd=async(t,e)=>{},Jr=new Map,Eg=t=>{let e=Se(),r=e.stackSave();try{let r=e.stackAlloc(8);return 0!==e._OrtGetInputOutputCount(t,r,r+4)&&Ae("Can't get session input/output count."),[e.HEAP32[r/4],e.HEAP32[r/4+1]]}finally{e.stackRestore(r)}},xa=t=>{let e=Se(),r=e._malloc(t.byteLength);if(0===r)throw new Error(`Can't create a session. failed to allocate a buffer of size ${t.byteLength}.`);return e.HEAPU8.set(t,r),[r,t.byteLength]},od=async(t,e)=>{let r,n,i=Se();Array.isArray(t)?[r,n]=t:t.buffer===i.HEAPU8.buffer?[r,n]=[t.byteOffset,t.byteLength]:[r,n]=xa(t);let s=0,o=0,a=[],u=[],l=[];try{if([o,a]=Xp(e),e?.externalData&&i.mountExternalData){let t=[];for(let r of e.externalData){let e="string"==typeof r?r:r.path;t.push(On("string"==typeof r?r:r.data).then((t=>{i.mountExternalData(e,t)})))}await Promise.all(t)}s=i._OrtCreateSession(r,n,o),0===s&&Ae("Can't create a session.");let[t,c]=Eg(s),h=!!e?.enableGraphCapture,f=[],d=[];for(let e=0;e<t;e++){let t=i._OrtGetInputName(s,e);0===t&&Ae("Can't get an input name."),u.push(t),f.push(i.UTF8ToString(t))}for(let t=0;t<c;t++){let e=i._OrtGetOutputName(s,t);0===e&&Ae("Can't get an output name."),l.push(e);let r=i.UTF8ToString(e);d.push(r)}let p=null;return Jr.set(s,[s,u,l,p,h,!1]),[s,f,d]}catch(t){throw u.forEach((t=>i._OrtFree(t))),l.forEach((t=>i._OrtFree(t))),0!==s&&i._OrtReleaseSession(s),t}finally{i._free(r),0!==o&&i._OrtReleaseSessionOptions(o),a.forEach((t=>i._free(t))),i.unmountExternalData?.()}},id=t=>{let e=Se(),r=Jr.get(t);if(!r)throw new Error(`cannot release session. invalid session id: ${t}`);let[n,i,s,o,a]=r;o&&(a&&e._OrtClearBoundOutputs(o.handle),e._OrtReleaseBinding(o.handle)),e.jsepOnReleaseSession?.(t),i.forEach((t=>e._OrtFree(t))),s.forEach((t=>e._OrtFree(t))),e._OrtReleaseSession(n),Jr.delete(t)},Pg=(t,e,r)=>{if(null!==t&&t[0]===e){let e=t[2];if(e.length===r)return e}return new(Zp(e))(r)},td=(t,e,r,n,i,s=!1)=>{if(!t)return void e.push(0);let o,a,u=Se(),l=t[0],c=t[1],h=t[3];if("string"===l&&"gpu-buffer"===h)throw new Error("String tensor is not supported on GPU.");if(s&&"gpu-buffer"!==h)throw new Error(`External buffer must be provided for input/output index ${i} when enableGraphCapture is true.`);if("gpu-buffer"===h){let e=t[2].gpuBuffer,r=ga(ba(l));a=c.reduce(((t,e)=>t*e),1)*r,o=u.jsepRegisterBuffer(n,i,e,a)}else{let e=t[2];if(Array.isArray(e)){a=4*e.length,o=u._malloc(a),r.push(o);let t=o/4;for(let n=0;n<e.length;n++){if("string"!=typeof e[n])throw new TypeError(`tensor data at index ${n} is not a string`);u.HEAPU32[t++]=Ie(e[n],r)}}else a=e.byteLength,o=u._malloc(a),r.push(o),u.HEAPU8.set(new Uint8Array(e.buffer,e.byteOffset,a),o)}let f=u.stackSave(),d=u.stackAlloc(4*c.length);try{let t=d/4;c.forEach((e=>u.HEAP32[t++]=e));let r=u._OrtCreateTensor(ba(l),o,a,d,c.length,ed(h));0===r&&Ae(`Can't create tensor for input/output. session=${n}, index=${i}.`),e.push(r)}finally{u.stackRestore(f)}},ad=t=>{let e=(new TextEncoder).encode(t),r=Se(),n=r._malloc(e.byteLength);r.HEAPU8.set(e,n);let i=r._OrtConfigure(n,e.byteLength);if(0===i)throw new Error("Can't get an configure key");let s=r.UTF8ToString(i);return r._OrtFree(i),s},sd=t=>{let e=(new TextEncoder).encode(t),r=Se(),n=r._malloc(e.byteLength);r.HEAPU8.set(e,n);let i=r._OrtAuth(n,e.byteLength);if(0===i)throw new Error("Can't get an auth result");let s=r.UTF8ToString(i);return r._OrtFree(i),s},ud=async(t,e,r,n,i,s)=>{let o=Se(),a=Jr.get(t);if(!a)throw new Error(`cannot run inference. invalid session id: ${t}`);let u=a[0],l=a[1],c=a[2],h=a[3],f=a[4],d=(a[5],e.length),p=n.length,v=0,y=[],b=[],_=[],m=[],g=o.stackSave(),w=o.stackAlloc(4*d),x=o.stackAlloc(4*d),T=o.stackAlloc(4*p),S=o.stackAlloc(4*p);try{[v,y]=qp(s);for(let n=0;n<d;n++)td(r[n],b,m,t,e[n],f);for(let e=0;e<p;e++){let r=i[e];td("gpu-buffer"===(r?.[3]??"")?r:null,_,m,t,d+n[e],f)}let a,g=w/4,E=x/4,O=T/4,P=S/4;for(let t=0;t<d;t++)o.HEAPU32[g++]=b[t],o.HEAPU32[E++]=l[e[t]];for(let t=0;t<p;t++)o.HEAPU32[O++]=_[t],o.HEAPU32[P++]=c[n[t]];o.jsepOnRunStart?.(u),a=await o._OrtRun(u,x,w,d,S,p,T,v),0!==a&&Ae("failed to call OrtRun().");let A=[];for(let t=0;t<p;t++){let e=o.HEAPU32[T/4+t];if(e===_[t]){A.push(i[t]);continue}let r,s=o.stackSave(),a=o.stackAlloc(16),u=!1,l=0;try{0!==o._OrtGetTensorData(e,a,a+4,a+8,a+12)&&Ae(`Can't access output tensor data on index ${t}.`);let s=a/4,c=o.HEAPU32[s++];l=o.HEAPU32[s++];let f=o.HEAPU32[s++],d=o.HEAPU32[s++],p=[];for(let t=0;t<d;t++)p.push(o.HEAPU32[f/4+t]);o._OrtFree(f);let v=p.reduce(((t,e)=>t*e),1);r=Jp(c);let y=h?.outputPreferredLocations[n[t]];if("string"===r){if("gpu-buffer"===y)throw new Error("String tensor is not supported on GPU.");let t=[],e=l/4;for(let r=0;r<v;r++){let n=o.HEAPU32[e++],i=r===v-1?void 0:o.HEAPU32[e]-n;t.push(o.UTF8ToString(n,i))}A.push([r,p,t,"cpu"])}else if("gpu-buffer"===y&&v>0){let t=o.jsepGetBuffer(l),n=ga(c);if(void 0===n||!No(r))throw new Error(`Unsupported data type: ${r}`);u=!0,A.push([r,p,{gpuBuffer:t,download:o.jsepCreateDownloader(t,v*n,r),dispose:()=>{o._OrtReleaseTensor(e)}},"gpu-buffer"])}else{let e=Pg(i[t],r,v);new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(o.HEAPU8.subarray(l,l+e.byteLength)),A.push([r,p,e,"cpu"])}}finally{o.stackRestore(s),"string"===r&&l&&o._free(l),u||o._OrtReleaseTensor(e)}}return h&&!f&&(o._OrtClearBoundOutputs(h.handle),Jr.set(t,[u,l,c,h,f,!1])),A}finally{o.stackRestore(g),b.forEach((t=>o._OrtReleaseTensor(t))),_.forEach((t=>o._OrtReleaseTensor(t))),m.forEach((t=>o._free(t))),0!==v&&o._OrtReleaseRunOptions(v),y.forEach((t=>o._free(t)))}},ld=t=>{let e=Se(),r=Jr.get(t);if(!r)throw new Error("invalid session id");let n=r[0],i=e._OrtEndProfiling(n);0===i&&Ae("Can't get an profile file name."),e._OrtFree(i)},wa=t=>{let e=[];for(let r of t){let t=r[2];!Array.isArray(t)&&"buffer"in t&&e.push(t.buffer)}return e}})),cd=ye(((t,e)=>{e.exports='/*!\n * ONNX Runtime Web v1.17.0\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n"use strict";(()=>{var Dt=Object.defineProperty;var on=Object.getOwnPropertyDescriptor;var sn=Object.getOwnPropertyNames;var un=Object.prototype.hasOwnProperty;var Ot=(i,d)=>()=>(i&&(d=i(i=0)),d);var ut=(i,d)=>()=>(d||i((d={exports:{}}).exports,d),d.exports),vt=(i,d)=>{for(var o in d)Dt(i,o,{get:d[o],enumerable:!0})},fn=(i,d,o,p)=>{if(d&&typeof d=="object"||typeof d=="function")for(let l of sn(d))!un.call(i,l)&&l!==o&&Dt(i,l,{get:()=>d[l],enumerable:!(p=on(d,l))||p.enumerable});return i};var ze=i=>fn(Dt({},"__esModule",{value:!0}),i);var Ft={};vt(Ft,{createReadStream:()=>Or,readFile:()=>ln,readFileSync:()=>cn});var ln,cn,Or,Ut=Ot(()=>{ln=void 0,cn=void 0,Or=void 0});var Rt={};vt(Rt,{join:()=>dn});var dn,Lt=Ot(()=>{dn=void 0});var Pt={};vt(Pt,{crypto:()=>pn});var pn,Bt=Ot(()=>{pn=void 0});var Er=ut((_r,It)=>{"use strict";var vr=(()=>{var i=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(i=i||__filename),function(d={}){var o=d,p,l;o.ready=new Promise((r,a)=>{p=r,l=a});var O=Object.assign({},o),h="./this.program",u=typeof window=="object",A=typeof importScripts=="function",D=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",R="",U,L,te;if(D){var B=(Ut(),ze(Ft)),P=(Lt(),ze(Rt));R=A?P.dirname(R)+"/":__dirname+"/",U=(r,a)=>(r=we(r)?new URL(r):P.normalize(r),B.readFileSync(r,a?void 0:"utf8")),te=r=>(r=U(r,!0),r.buffer||(r=new Uint8Array(r)),r),L=(r,a,s,c=!0)=>{r=we(r)?new URL(r):P.normalize(r),B.readFile(r,c?void 0:"utf8",(w,E)=>{w?s(w):a(c?E.buffer:E)})},!o.thisProgram&&1<process.argv.length&&(h=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),o.inspect=()=>"[Emscripten Module object]"}else(u||A)&&(A?R=self.location.href:typeof document<"u"&&document.currentScript&&(R=document.currentScript.src),i&&(R=i),R.indexOf("blob:")!==0?R=R.substr(0,R.replace(/[?#].*/,"").lastIndexOf("/")+1):R="",U=r=>{var a=new XMLHttpRequest;return a.open("GET",r,!1),a.send(null),a.responseText},A&&(te=r=>{var a=new XMLHttpRequest;return a.open("GET",r,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),L=(r,a,s)=>{var c=new XMLHttpRequest;c.open("GET",r,!0),c.responseType="arraybuffer",c.onload=()=>{c.status==200||c.status==0&&c.response?a(c.response):s()},c.onerror=s,c.send(null)});var _=console.log.bind(console),N=console.error.bind(console);Object.assign(o,O),O=null,typeof WebAssembly!="object"&&F("no native wasm support detected");var G,$=!1,oe,ee,S,Y,Ue;function Ie(){var r=G.buffer;o.HEAP8=oe=new Int8Array(r),o.HEAP16=new Int16Array(r),o.HEAPU8=ee=new Uint8Array(r),o.HEAPU16=new Uint16Array(r),o.HEAP32=S=new Int32Array(r),o.HEAPU32=Y=new Uint32Array(r),o.HEAPF32=new Float32Array(r),o.HEAPF64=Ue=new Float64Array(r)}var ce=[],re=[],Z=[],Ae=0,_e=null,ne=null;function F(r){throw r="Aborted("+r+")",N(r),$=!0,r=new WebAssembly.RuntimeError(r+". Build with -sASSERTIONS for more info."),l(r),r}var de=r=>r.startsWith("data:application/octet-stream;base64,"),we=r=>r.startsWith("file://"),le;if(le="ort-wasm.wasm",!de(le)){var Te=le;le=o.locateFile?o.locateFile(Te,R):R+Te}function V(r){if(te)return te(r);throw"both async and sync fetching of the wasm failed"}function pe(r){if(u||A){if(typeof fetch=="function"&&!we(r))return fetch(r,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at \'"+r+"\'";return a.arrayBuffer()}).catch(()=>V(r));if(L)return new Promise((a,s)=>{L(r,c=>a(new Uint8Array(c)),s)})}return Promise.resolve().then(()=>V(r))}function Ne(r,a,s){return pe(r).then(c=>WebAssembly.instantiate(c,a)).then(c=>c).then(s,c=>{N(`failed to asynchronously prepare wasm: ${c}`),F(c)})}function Me(r,a){var s=le;return typeof WebAssembly.instantiateStreaming!="function"||de(s)||we(s)||D||typeof fetch!="function"?Ne(s,r,a):fetch(s,{credentials:"same-origin"}).then(c=>WebAssembly.instantiateStreaming(c,r).then(a,function(w){return N(`wasm streaming compile failed: ${w}`),N("falling back to ArrayBuffer instantiation"),Ne(s,r,a)}))}var Ee,Se={882208:(r,a,s,c)=>{if(typeof o>"u"||!o.Ga)return 1;if(r=se(r>>>0),r.startsWith("./")&&(r=r.substring(2)),r=o.Ga.get(r),!r)return 2;if(a>>>=0,s>>>=0,a+s>r.byteLength)return 3;try{return ee.set(r.subarray(a,a+s),c>>>0>>>0),0}catch{return 4}}};function He(r){this.Da=r-24,this.Fa=function(a){Y[this.Da+4>>>2>>>0]=a},this.Ea=function(a){Y[this.Da+8>>>2>>>0]=a},this.La=function(a,s){this.Ma(),this.Fa(a),this.Ea(s)},this.Ma=function(){Y[this.Da+16>>>2>>>0]=0}}var me=0,Ce=0,xe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,q=(r,a,s)=>{a>>>=0;var c=a+s;for(s=a;r[s]&&!(s>=c);)++s;if(16<s-a&&r.buffer&&xe)return xe.decode(r.subarray(a,s));for(c="";a<s;){var w=r[a++];if(w&128){var E=r[a++]&63;if((w&224)==192)c+=String.fromCharCode((w&31)<<6|E);else{var T=r[a++]&63;w=(w&240)==224?(w&15)<<12|E<<6|T:(w&7)<<18|E<<12|T<<6|r[a++]&63,65536>w?c+=String.fromCharCode(w):(w-=65536,c+=String.fromCharCode(55296|w>>10,56320|w&1023))}}else c+=String.fromCharCode(w)}return c},se=(r,a)=>(r>>>=0)?q(ee,r,a):"",ye=r=>{for(var a=0,s=0;s<r.length;++s){var c=r.charCodeAt(s);127>=c?a++:2047>=c?a+=2:55296<=c&&57343>=c?(a+=4,++s):a+=3}return a},Re=(r,a,s,c)=>{if(s>>>=0,!(0<c))return 0;var w=s;c=s+c-1;for(var E=0;E<r.length;++E){var T=r.charCodeAt(E);if(55296<=T&&57343>=T){var H=r.charCodeAt(++E);T=65536+((T&1023)<<10)|H&1023}if(127>=T){if(s>=c)break;a[s++>>>0]=T}else{if(2047>=T){if(s+1>=c)break;a[s++>>>0]=192|T>>6}else{if(65535>=T){if(s+2>=c)break;a[s++>>>0]=224|T>>12}else{if(s+3>=c)break;a[s++>>>0]=240|T>>18,a[s++>>>0]=128|T>>12&63}a[s++>>>0]=128|T>>6&63}a[s++>>>0]=128|T&63}}return a[s>>>0]=0,s-w},De=r=>r%4===0&&(r%100!==0||r%400===0),et=[0,31,60,91,121,152,182,213,244,274,305,335],lt=[0,31,59,90,120,151,181,212,243,273,304,334],Le=r=>{var a=ye(r)+1,s=ge(a);return s&&Re(r,ee,s,a),s},Ye=[],We={},Ve=()=>{if(!qe){var r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:h||"./this.program"},a;for(a in We)We[a]===void 0?delete r[a]:r[a]=We[a];var s=[];for(a in r)s.push(`${a}=${r[a]}`);qe=s}return qe},qe,ke=[null,[],[]],ct=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);if(D)try{var r=(Bt(),ze(Pt));if(r.randomFillSync)return s=>r.randomFillSync(s);var a=r.randomBytes;return s=>(s.set(a(s.byteLength)),s)}catch{}F("initRandomDevice")},tt=r=>(tt=ct())(r),Ge=[31,29,31,30,31,30,31,31,30,31,30,31],dt=[31,28,31,30,31,30,31,31,30,31,30,31];function j(r){var a=Array(ye(r)+1);return Re(r,a,0,a.length),a}function rt(r,a,s,c){function w(m,W,z){for(m=typeof m=="number"?m.toString():m||"";m.length<W;)m=z[0]+m;return m}function E(m,W){return w(m,W,"0")}function T(m,W){function z(Xe){return 0>Xe?-1:0<Xe?1:0}var Oe;return(Oe=z(m.getFullYear()-W.getFullYear()))===0&&(Oe=z(m.getMonth()-W.getMonth()))===0&&(Oe=z(m.getDate()-W.getDate())),Oe}function H(m){switch(m.getDay()){case 0:return new Date(m.getFullYear()-1,11,29);case 1:return m;case 2:return new Date(m.getFullYear(),0,3);case 3:return new Date(m.getFullYear(),0,2);case 4:return new Date(m.getFullYear(),0,1);case 5:return new Date(m.getFullYear()-1,11,31);case 6:return new Date(m.getFullYear()-1,11,30)}}function ie(m){var W=m.ya;for(m=new Date(new Date(m.za+1900,0,1).getTime());0<W;){var z=m.getMonth(),Oe=(De(m.getFullYear())?Ge:dt)[z];if(W>Oe-m.getDate())W-=Oe-m.getDate()+1,m.setDate(1),11>z?m.setMonth(z+1):(m.setMonth(0),m.setFullYear(m.getFullYear()+1));else{m.setDate(m.getDate()+W);break}}return z=new Date(m.getFullYear()+1,0,4),W=H(new Date(m.getFullYear(),0,4)),z=H(z),0>=T(W,m)?0>=T(z,m)?m.getFullYear()+1:m.getFullYear():m.getFullYear()-1}r>>>=0,a>>>=0,s>>>=0,c>>>=0;var ue=Y[c+40>>>2>>>0];c={Ja:S[c>>>2>>>0],Ia:S[c+4>>>2>>>0],Aa:S[c+8>>>2>>>0],Ca:S[c+12>>>2>>>0],Ba:S[c+16>>>2>>>0],za:S[c+20>>>2>>>0],xa:S[c+24>>>2>>>0],ya:S[c+28>>>2>>>0],Na:S[c+32>>>2>>>0],Ha:S[c+36>>>2>>>0],Ka:ue?se(ue):""},s=se(s),ue={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var fe in ue)s=s.replace(new RegExp(fe,"g"),ue[fe]);var st="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),it="January February March April May June July August September October November December".split(" ");ue={"%a":m=>st[m.xa].substring(0,3),"%A":m=>st[m.xa],"%b":m=>it[m.Ba].substring(0,3),"%B":m=>it[m.Ba],"%C":m=>E((m.za+1900)/100|0,2),"%d":m=>E(m.Ca,2),"%e":m=>w(m.Ca,2," "),"%g":m=>ie(m).toString().substring(2),"%G":m=>ie(m),"%H":m=>E(m.Aa,2),"%I":m=>(m=m.Aa,m==0?m=12:12<m&&(m-=12),E(m,2)),"%j":m=>{for(var W=0,z=0;z<=m.Ba-1;W+=(De(m.za+1900)?Ge:dt)[z++]);return E(m.Ca+W,3)},"%m":m=>E(m.Ba+1,2),"%M":m=>E(m.Ia,2),"%n":()=>`\n`,"%p":m=>0<=m.Aa&&12>m.Aa?"AM":"PM","%S":m=>E(m.Ja,2),"%t":()=>"\t","%u":m=>m.xa||7,"%U":m=>E(Math.floor((m.ya+7-m.xa)/7),2),"%V":m=>{var W=Math.floor((m.ya+7-(m.xa+6)%7)/7);if(2>=(m.xa+371-m.ya-2)%7&&W++,W)W==53&&(z=(m.xa+371-m.ya)%7,z==4||z==3&&De(m.za)||(W=1));else{W=52;var z=(m.xa+7-m.ya-1)%7;(z==4||z==5&&De(m.za%400-1))&&W++}return E(W,2)},"%w":m=>m.xa,"%W":m=>E(Math.floor((m.ya+7-(m.xa+6)%7)/7),2),"%y":m=>(m.za+1900).toString().substring(2),"%Y":m=>m.za+1900,"%z":m=>{m=m.Ha;var W=0<=m;return m=Math.abs(m)/60,(W?"+":"-")+("0000"+(m/60*100+m%60)).slice(-4)},"%Z":m=>m.Ka,"%%":()=>"%"},s=s.replace(/%%/g,"\\0\\0");for(fe in ue)s.includes(fe)&&(s=s.replace(new RegExp(fe,"g"),ue[fe](c)));return s=s.replace(/\\0\\0/g,"%"),fe=j(s),fe.length>a?0:(oe.set(fe,r>>>0),fe.length-1)}var Fe=[],be,Pe,pt=[],C=(r,a)=>{if(!Pe){Pe=new WeakMap;var s=be.length;if(Pe)for(var c=0;c<0+s;c++){var w=c,E=Fe[w];E||(w>=Fe.length&&(Fe.length=w+1),Fe[w]=E=be.get(w)),(w=E)&&Pe.set(w,c)}}if(s=Pe.get(r)||0)return s;if(pt.length)s=pt.pop();else{try{be.grow(1)}catch(H){throw H instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":H}s=be.length-1}try{c=s,be.set(c,r),Fe[c]=be.get(c)}catch(H){if(!(H instanceof TypeError))throw H;if(typeof WebAssembly.Function=="function"){c=WebAssembly.Function,w={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},E={parameters:[],results:a[0]=="v"?[]:[w[a[0]]]};for(var T=1;T<a.length;++T)E.parameters.push(w[a[T]]);a=new c(E,r)}else{for(c=[1],w=a.slice(0,1),a=a.slice(1),E={i:127,p:127,j:126,f:125,d:124,e:111},c.push(96),T=a.length,128>T?c.push(T):c.push(T%128|128,T>>7),T=0;T<a.length;++T)c.push(E[a[T]]);w=="v"?c.push(0):c.push(1,E[w]),a=[0,97,115,109,1,0,0,0,1],w=c.length,128>w?a.push(w):a.push(w%128|128,w>>7),a.push.apply(a,c),a.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),a=new WebAssembly.Module(new Uint8Array(a)),a=new WebAssembly.Instance(a,{e:{f:r}}).exports.f}c=s,be.set(c,a),Fe[c]=be.get(c)}return Pe.set(r,s),s},Je={a:function(r,a,s){throw r>>>=0,new He(r).La(a>>>0,s>>>0),me=r,Ce++,me},e:function(){return 0},L:function(){},A:function(){},C:function(){},u:function(){return 0},J:function(){},E:function(){},I:function(){},k:function(){},B:function(){},y:function(){},K:function(){},z:function(){},l:()=>1,o:function(r,a,s){r=a+2097152>>>0<4194305-!!r?(r>>>0)+4294967296*a:NaN,s>>>=0,r=new Date(1e3*r),S[s>>>2>>>0]=r.getUTCSeconds(),S[s+4>>>2>>>0]=r.getUTCMinutes(),S[s+8>>>2>>>0]=r.getUTCHours(),S[s+12>>>2>>>0]=r.getUTCDate(),S[s+16>>>2>>>0]=r.getUTCMonth(),S[s+20>>>2>>>0]=r.getUTCFullYear()-1900,S[s+24>>>2>>>0]=r.getUTCDay(),S[s+28>>>2>>>0]=(r.getTime()-Date.UTC(r.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},p:function(r,a,s){r=a+2097152>>>0<4194305-!!r?(r>>>0)+4294967296*a:NaN,s>>>=0,r=new Date(1e3*r),S[s>>>2>>>0]=r.getSeconds(),S[s+4>>>2>>>0]=r.getMinutes(),S[s+8>>>2>>>0]=r.getHours(),S[s+12>>>2>>>0]=r.getDate(),S[s+16>>>2>>>0]=r.getMonth(),S[s+20>>>2>>>0]=r.getFullYear()-1900,S[s+24>>>2>>>0]=r.getDay(),S[s+28>>>2>>>0]=(De(r.getFullYear())?et:lt)[r.getMonth()]+r.getDate()-1|0,S[s+36>>>2>>>0]=-(60*r.getTimezoneOffset()),a=new Date(r.getFullYear(),6,1).getTimezoneOffset();var c=new Date(r.getFullYear(),0,1).getTimezoneOffset();S[s+32>>>2>>>0]=(a!=c&&r.getTimezoneOffset()==Math.min(c,a))|0},q:function(r){r>>>=0;var a=new Date(S[r+20>>>2>>>0]+1900,S[r+16>>>2>>>0],S[r+12>>>2>>>0],S[r+8>>>2>>>0],S[r+4>>>2>>>0],S[r>>>2>>>0],0),s=S[r+32>>>2>>>0],c=a.getTimezoneOffset(),w=new Date(a.getFullYear(),6,1).getTimezoneOffset(),E=new Date(a.getFullYear(),0,1).getTimezoneOffset(),T=Math.min(E,w);return 0>s?S[r+32>>>2>>>0]=+(w!=E&&T==c):0<s!=(T==c)&&(w=Math.max(E,w),a.setTime(a.getTime()+6e4*((0<s?T:w)-c))),S[r+24>>>2>>>0]=a.getDay(),S[r+28>>>2>>>0]=(De(a.getFullYear())?et:lt)[a.getMonth()]+a.getDate()-1|0,S[r>>>2>>>0]=a.getSeconds(),S[r+4>>>2>>>0]=a.getMinutes(),S[r+8>>>2>>>0]=a.getHours(),S[r+12>>>2>>>0]=a.getDate(),S[r+16>>>2>>>0]=a.getMonth(),S[r+20>>>2>>>0]=a.getYear(),r=a.getTime(),isNaN(r)?(S[Be()>>>2>>>0]=61,r=-1):r/=1e3,nt((Ee=r,1<=+Math.abs(Ee)?0<Ee?+Math.floor(Ee/4294967296)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)),r>>>0},m:function(){return-52},n:function(){},w:function(r,a,s){function c(ie){return(ie=ie.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?ie[1]:"GMT"}s>>>=0;var w=new Date().getFullYear(),E=new Date(w,0,1),T=new Date(w,6,1);w=E.getTimezoneOffset();var H=T.getTimezoneOffset();Y[r>>>0>>>2>>>0]=60*Math.max(w,H),S[a>>>0>>>2>>>0]=+(w!=H),r=c(E),a=c(T),r=Le(r),a=Le(a),H<w?(Y[s>>>2>>>0]=r,Y[s+4>>>2>>>0]=a):(Y[s>>>2>>>0]=a,Y[s+4>>>2>>>0]=r)},d:()=>{F("")},D:function(r,a,s){r>>>=0,a>>>=0,s>>>=0,Ye.length=0;for(var c;c=ee[a++>>>0];){var w=c!=105;w&=c!=112,s+=w&&s%8?4:0,Ye.push(c==112?Y[s>>>2>>>0]:c==105?S[s>>>2>>>0]:Ue[s>>>3>>>0]),s+=w?8:4}return Se[r].apply(null,Ye)},g:()=>Date.now(),x:function(){return 4294901760},b:()=>performance.now(),H:function(r,a,s){return a>>>=0,ee.copyWithin(r>>>0>>>0,a>>>0,a+(s>>>0)>>>0)},v:function(r){r>>>=0;var a=ee.length;if(4294901760<r)return!1;for(var s=1;4>=s;s*=2){var c=a*(1+.2/s);c=Math.min(c,r+100663296);var w=Math;c=Math.max(r,c);e:{w=(w.min.call(w,4294901760,c+(65536-c%65536)%65536)-G.buffer.byteLength+65535)/65536;try{G.grow(w),Ie();var E=1;break e}catch{}E=void 0}if(E)return!0}return!1},F:function(r,a){r>>>=0,a>>>=0;var s=0;return Ve().forEach((c,w)=>{var E=a+s;for(w=Y[r+4*w>>>2>>>0]=E,E=0;E<c.length;++E)oe[w++>>>0>>>0]=c.charCodeAt(E);oe[w>>>0>>>0]=0,s+=c.length+1}),0},G:function(r,a){r>>>=0,a>>>=0;var s=Ve();Y[r>>>2>>>0]=s.length;var c=0;return s.forEach(w=>c+=w.length+1),Y[a>>>2>>>0]=c,0},f:()=>52,j:function(){return 52},r:function(){return 70},i:function(r,a,s,c){a>>>=0,s>>>=0,c>>>=0;for(var w=0,E=0;E<s;E++){var T=Y[a>>>2>>>0],H=Y[a+4>>>2>>>0];a+=8;for(var ie=0;ie<H;ie++){var ue=ee[T+ie>>>0],fe=ke[r];ue===0||ue===10?((r===1?_:N)(q(fe,0)),fe.length=0):fe.push(ue)}w+=H}return Y[c>>>2>>>0]=w,0},s:function(r,a){return r>>>=0,tt(ee.subarray(r>>>0,r+(a>>>0)>>>0)),0},t:rt,c:function(r,a,s,c){return rt(r>>>0,a>>>0,s>>>0,c>>>0)},h:function(r,a,s,c){let w=be.length;r=new Uint8Array(ee.slice(r+a,r+s));try{var E=new WebAssembly.Module(r),T=new WebAssembly.Instance(E,{env:{memory:G}}),H;for(H in T.exports)C(T.exports[H]);return w<be.length?w:c}catch(ie){return console.log(ie),c}}},x=function(){function r(s){return x=s.exports,x=ht(),G=x.M,Ie(),be=x.sa,re.unshift(x.N),Ae--,Ae==0&&(_e!==null&&(clearInterval(_e),_e=null),ne&&(s=ne,ne=null,s())),x}var a={a:Je};if(Ae++,o.instantiateWasm)try{return o.instantiateWasm(a,r)}catch(s){N(`Module.instantiateWasm callback failed with error: ${s}`),l(s)}return Me(a,function(s){r(s.instance)}).catch(l),{}}();o._OrtInit=(r,a)=>(o._OrtInit=x.O)(r,a),o._OrtGetLastError=(r,a)=>(o._OrtGetLastError=x.P)(r,a),o._OrtCreateSessionOptions=(r,a,s,c,w,E,T,H,ie,ue)=>(o._OrtCreateSessionOptions=x.Q)(r,a,s,c,w,E,T,H,ie,ue),o._OrtAppendExecutionProvider=(r,a)=>(o._OrtAppendExecutionProvider=x.R)(r,a),o._OrtAddFreeDimensionOverride=(r,a,s)=>(o._OrtAddFreeDimensionOverride=x.S)(r,a,s),o._OrtAddSessionConfigEntry=(r,a,s)=>(o._OrtAddSessionConfigEntry=x.T)(r,a,s),o._OrtReleaseSessionOptions=r=>(o._OrtReleaseSessionOptions=x.U)(r),o._OrtCreateSession=(r,a,s)=>(o._OrtCreateSession=x.V)(r,a,s),o._OrtReleaseSession=r=>(o._OrtReleaseSession=x.W)(r),o._OrtGetInputOutputCount=(r,a,s)=>(o._OrtGetInputOutputCount=x.X)(r,a,s),o._OrtGetInputName=(r,a)=>(o._OrtGetInputName=x.Y)(r,a),o._OrtGetOutputName=(r,a)=>(o._OrtGetOutputName=x.Z)(r,a),o._OrtFree=r=>(o._OrtFree=x._)(r),o._OrtCreateTensor=(r,a,s,c,w,E)=>(o._OrtCreateTensor=x.$)(r,a,s,c,w,E),o._OrtGetTensorData=(r,a,s,c,w)=>(o._OrtGetTensorData=x.aa)(r,a,s,c,w),o._OrtReleaseTensor=r=>(o._OrtReleaseTensor=x.ba)(r),o._OrtCreateRunOptions=(r,a,s,c)=>(o._OrtCreateRunOptions=x.ca)(r,a,s,c),o._OrtAddRunConfigEntry=(r,a,s)=>(o._OrtAddRunConfigEntry=x.da)(r,a,s),o._OrtReleaseRunOptions=r=>(o._OrtReleaseRunOptions=x.ea)(r),o._OrtCreateBinding=r=>(o._OrtCreateBinding=x.fa)(r),o._OrtBindInput=(r,a,s)=>(o._OrtBindInput=x.ga)(r,a,s),o._OrtBindOutput=(r,a,s,c)=>(o._OrtBindOutput=x.ha)(r,a,s,c),o._OrtClearBoundOutputs=r=>(o._OrtClearBoundOutputs=x.ia)(r),o._OrtReleaseBinding=r=>(o._OrtReleaseBinding=x.ja)(r),o._OrtRunWithBinding=(r,a,s,c,w)=>(o._OrtRunWithBinding=x.ka)(r,a,s,c,w),o._OrtRun=(r,a,s,c,w,E,T,H)=>(o._OrtRun=x.la)(r,a,s,c,w,E,T,H),o._OrtEndProfiling=r=>(o._OrtEndProfiling=x.ma)(r),o._OrtConfigure=(r,a)=>(o._OrtConfigure=x.na)(r,a),o._OrtAuth=(r,a)=>(o._OrtAuth=x.oa)(r,a);var Be=()=>(Be=x.pa)(),ge=o._malloc=r=>(ge=o._malloc=x.qa)(r);o._free=r=>(o._free=x.ra)(r);var nt=r=>(nt=x.ta)(r),mt=()=>(mt=x.ua)(),at=r=>(at=x.va)(r),gt=r=>(gt=x.wa)(r);o.___start_em_js=882709,o.___stop_em_js=883321;function ht(){var r=x;r=Object.assign({},r);var a=c=>()=>c()>>>0,s=c=>w=>c(w)>>>0;return r.pa=a(r.pa),r.qa=s(r.qa),r.ua=a(r.ua),r.wa=s(r.wa),r}o.stackAlloc=gt,o.stackSave=mt,o.stackRestore=at,o.addFunction=C,o.UTF8ToString=se,o.stringToUTF8=(r,a,s)=>Re(r,ee,a,s),o.lengthBytesUTF8=ye;var $e;ne=function r(){$e||ot(),$e||(ne=r)};function ot(){if(!(0<Ae)){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;){var r=o.preRun.shift();ce.unshift(r)}for(;0<ce.length;)ce.shift()(o);if(!(0<Ae||$e||($e=!0,o.calledRun=!0,$))){for(;0<re.length;)re.shift()(o);for(p(o);0<Z.length;)Z.shift()(o)}}}return ot(),d.ready}})();typeof _r=="object"&&typeof It=="object"?It.exports=vr:typeof define=="function"&&define.amd&&define([],()=>vr)});var Sr=ut(()=>{});var Ar=ut(()=>{});var Tr={};vt(Tr,{cpus:()=>mn});var mn,Mr=Ot(()=>{mn=void 0});var Dr=ut((xr,Wt)=>{"use strict";var Cr=(()=>{var i=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(i=i||__filename),function(d={}){function o(){return Z.buffer!=F.buffer&&V(),F}function p(){return Z.buffer!=F.buffer&&V(),de}function l(){return Z.buffer!=F.buffer&&V(),we}function O(){return Z.buffer!=F.buffer&&V(),le}function h(){return Z.buffer!=F.buffer&&V(),Te}var u=d,A,D;u.ready=new Promise((e,t)=>{A=e,D=t});var R=Object.assign({},u),U="./this.program",L=(e,t)=>{throw t},te=typeof window=="object",B=typeof importScripts=="function",P=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",_=u.ENVIRONMENT_IS_PTHREAD||!1,N="";function G(e){return u.locateFile?u.locateFile(e,N):N+e}var $,oe,ee;if(P){var S=(Ut(),ze(Ft)),Y=(Lt(),ze(Rt));N=B?Y.dirname(N)+"/":__dirname+"/",$=(t,n)=>(t=se(t)?new URL(t):Y.normalize(t),S.readFileSync(t,n?void 0:"utf8")),ee=t=>(t=$(t,!0),t.buffer||(t=new Uint8Array(t)),t),oe=(t,n,f,y=!0)=>{t=se(t)?new URL(t):Y.normalize(t),S.readFile(t,y?void 0:"utf8",(b,v)=>{b?f(b):n(y?v.buffer:v)})},!u.thisProgram&&1<process.argv.length&&(U=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),L=(t,n)=>{throw process.exitCode=t,n},u.inspect=()=>"[Emscripten Module object]";let e;try{e=Sr()}catch(t){throw console.error(\'The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?\'),t}global.Worker=e.Worker}else(te||B)&&(B?N=self.location.href:typeof document<"u"&&document.currentScript&&(N=document.currentScript.src),typeof i<"u"&&i&&(N=i),N.indexOf("blob:")!==0?N=N.substr(0,N.replace(/[?#].*/,"").lastIndexOf("/")+1):N="",P||($=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},B&&(ee=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),oe=(e,t,n)=>{var f=new XMLHttpRequest;f.open("GET",e,!0),f.responseType="arraybuffer",f.onload=()=>{f.status==200||f.status==0&&f.response?t(f.response):n()},f.onerror=n,f.send(null)}));P&&typeof performance>"u"&&(global.performance=Ar().performance);var Ue=console.log.bind(console),Ie=console.error.bind(console);P&&(Ue=(...e)=>S.writeSync(1,e.join(" ")+`\n`),Ie=(...e)=>S.writeSync(2,e.join(" ")+`\n`));var ce=Ue,re=Ie;Object.assign(u,R),R=null,typeof WebAssembly!="object"&&xe("no native wasm support detected");var Z,Ae,_e=!1,ne,F,de,we,le,Te;function V(){var e=Z.buffer;u.HEAP8=F=new Int8Array(e),u.HEAP16=new Int16Array(e),u.HEAPU8=de=new Uint8Array(e),u.HEAPU16=new Uint16Array(e),u.HEAP32=we=new Int32Array(e),u.HEAPU32=le=new Uint32Array(e),u.HEAPF32=new Float32Array(e),u.HEAPF64=Te=new Float64Array(e)}var pe=16777216;if(_)Z=u.wasmMemory;else if(u.wasmMemory)Z=u.wasmMemory;else if(Z=new WebAssembly.Memory({initial:pe/65536,maximum:65536,shared:!0}),!(Z.buffer instanceof SharedArrayBuffer))throw re("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),P&&re("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");V(),pe=Z.buffer.byteLength;var Ne=[],Me=[],Ee=[],Se=0,He=null,me=null;function Ce(){if(Se--,Se==0&&(He!==null&&(clearInterval(He),He=null),me)){var e=me;me=null,e()}}function xe(e){throw e="Aborted("+e+")",re(e),_e=!0,ne=1,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),D(e),e}var q=e=>e.startsWith("data:application/octet-stream;base64,"),se=e=>e.startsWith("file://"),ye;ye="ort-wasm-threaded.wasm",q(ye)||(ye=G(ye));function Re(e){if(ee)return ee(e);throw"both async and sync fetching of the wasm failed"}function De(e){if(te||B){if(typeof fetch=="function"&&!se(e))return fetch(e,{credentials:"same-origin"}).then(t=>{if(!t.ok)throw"failed to load wasm binary file at \'"+e+"\'";return t.arrayBuffer()}).catch(()=>Re(e));if(oe)return new Promise((t,n)=>{oe(e,f=>t(new Uint8Array(f)),n)})}return Promise.resolve().then(()=>Re(e))}function et(e,t,n){return De(e).then(f=>WebAssembly.instantiate(f,t)).then(f=>f).then(n,f=>{re(`failed to asynchronously prepare wasm: ${f}`),xe(f)})}function lt(e,t){var n=ye;return typeof WebAssembly.instantiateStreaming!="function"||q(n)||se(n)||P||typeof fetch!="function"?et(n,e,t):fetch(n,{credentials:"same-origin"}).then(f=>WebAssembly.instantiateStreaming(f,e).then(t,function(y){return re(`wasm streaming compile failed: ${y}`),re("falling back to ArrayBuffer instantiation"),et(n,e,t)}))}var Le,Ye={886596:(e,t,n,f)=>{if(typeof u>"u"||!u.hb)return 1;if(e=Ge(e>>>0),e.startsWith("./")&&(e=e.substring(2)),e=u.hb.get(e),!e)return 2;if(t>>>=0,n>>>=0,f>>>=0,t+n>e.byteLength)return 3;try{return p().set(e.subarray(t,t+n),f>>>0),0}catch{return 4}}};function We(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var Ve=e=>{e.terminate(),e.onmessage=()=>{}},qe=e=>{C.Ta.length==0&&(Pe(),C.bb(C.Ta[0]));var t=C.Ta.pop();if(!t)return 6;C.Ua.push(t),C.Qa[e.Sa]=t,t.Sa=e.Sa;var n={cmd:"run",start_routine:e.ob,arg:e.lb,pthread_ptr:e.Sa};return P&&t.unref(),t.postMessage(n,e.ub),0},ke=0,ct=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,tt=(e,t,n)=>{t>>>=0;var f=t+n;for(n=t;e[n]&&!(n>=f);)++n;if(16<n-t&&e.buffer&&ct)return ct.decode(e.buffer instanceof SharedArrayBuffer?e.slice(t,n):e.subarray(t,n));for(f="";t<n;){var y=e[t++];if(y&128){var b=e[t++]&63;if((y&224)==192)f+=String.fromCharCode((y&31)<<6|b);else{var v=e[t++]&63;y=(y&240)==224?(y&15)<<12|b<<6|v:(y&7)<<18|b<<12|v<<6|e[t++]&63,65536>y?f+=String.fromCharCode(y):(y-=65536,f+=String.fromCharCode(55296|y>>10,56320|y&1023))}}else f+=String.fromCharCode(y)}return f},Ge=(e,t)=>(e>>>=0)?tt(p(),e,t):"",dt=e=>{var t=Ct();return e=e(),bt(t),e};function j(e,t){var n=arguments.length-2,f=arguments;return dt(()=>{for(var y=xt(8*n),b=y>>>3,v=0;v<n;v++){var I=f[2+v];h()[b+v>>>0]=I}return dr(e,n,y,t)})}function rt(e){if(_)return j(0,1,e);ne=e,0<ke||(C.pb(),u.onExit?.(e),_e=!0),L(e,new We(e))}var Fe=e=>{if(ne=e,_)throw x(e),"unwind";rt(e)};function be(){for(var e=u.numThreads;e--;)Pe();Ne.unshift(()=>{Se++,pt(()=>Ce())})}function Pe(){var e=G("ort-wasm-threaded.worker.js");e=new Worker(e),C.Ta.push(e)}function pt(e){_?e():Promise.all(C.Ta.map(C.bb)).then(e)}var C={Ta:[],Ua:[],gb:[],Qa:{},$a(){_?(C.receiveObjectTransfer=C.nb,C.threadInitTLS=C.fb,C.setExitStatus=C.eb):be()},eb:e=>ne=e,xb:["$terminateWorker"],pb:()=>{for(var e of C.Ua)Ve(e);for(e of C.Ta)Ve(e);C.Ta=[],C.Ua=[],C.Qa=[]},cb:e=>{var t=e.Sa;delete C.Qa[t],C.Ta.push(e),C.Ua.splice(C.Ua.indexOf(e),1),e.Sa=0,Tt(t)},nb(){},fb(){C.gb.forEach(e=>e())},bb:e=>new Promise(t=>{e.onmessage=b=>{b=b.data;var v=b.cmd;if(b.targetThread&&b.targetThread!=yt()){var I=C.Qa[b.targetThread];I?I.postMessage(b,b.transferList):re(`Internal error! Worker sent a message "${v}" to target pthread ${b.targetThread}, but that thread no longer exists!`)}else v==="checkMailbox"?Oe():v==="spawnThread"?qe(b):v==="cleanupThread"?C.cb(C.Qa[b.thread]):v==="killThread"?(b=b.thread,v=C.Qa[b],delete C.Qa[b],Ve(v),Tt(b),C.Ua.splice(C.Ua.indexOf(v),1),v.Sa=0):v==="cancelThread"?C.Qa[b.thread].postMessage({cmd:"cancel"}):v==="loaded"?(e.loaded=!0,P&&!e.Sa&&e.unref(),t(e)):v==="alert"?alert(`Thread ${b.threadId}: ${b.text}`):b.target==="setimmediate"?e.postMessage(b):v==="callHandler"?u[b.handler](...b.args):v&&re(`worker sent an unknown command ${v}`)},e.onerror=b=>{throw re(`worker sent an error! ${b.filename}:${b.lineno}: ${b.message}`),b},P&&(e.on("message",b=>e.onmessage({data:b})),e.on("error",b=>e.onerror(b)));var n=[],f=["onExit"],y;for(y of f)u.hasOwnProperty(y)&&n.push(y);e.postMessage({cmd:"load",handlers:n,urlOrBlob:u.mainScriptUrlOrBlob||i,wasmMemory:Z,wasmModule:Ae})})};u.PThread=C;var Je=e=>{for(;0<e.length;)e.shift()(u)};u.establishStackSpace=()=>{var e=yt(),t=O()[e+52>>>2>>>0];e=O()[e+56>>>2>>>0],gr(t,t-e),bt(t)};function x(e){if(_)return j(1,0,e);Fe(e)}var Be=[],ge,nt=e=>{var t=Be[e];return t||(e>=Be.length&&(Be.length=e+1),Be[e]=t=ge.get(e)),t};u.invokeEntryPoint=(e,t)=>{e=nt(e)(t),0<ke?C.eb(e):Mt(e)};function mt(e){this.Za=e-24,this.kb=function(t){O()[this.Za+4>>>2>>>0]=t},this.jb=function(t){O()[this.Za+8>>>2>>>0]=t},this.$a=function(t,n){this.ib(),this.kb(t),this.jb(n)},this.ib=function(){O()[this.Za+16>>>2>>>0]=0}}var at=0,gt=0;function ht(e,t,n,f){return _?j(2,1,e,t,n,f):$e(e,t,n,f)}function $e(e,t,n,f){if(e>>>=0,t>>>=0,n>>>=0,f>>>=0,typeof SharedArrayBuffer>"u")return re("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var y=[];return _&&y.length===0?ht(e,t,n,f):(e={ob:n,Sa:e,lb:f,ub:y},_?(e.wb="spawnThread",postMessage(e,y),0):qe(e))}function ot(e,t,n){return _?j(3,1,e,t,n):0}function r(e,t){if(_)return j(4,1,e,t)}var a=e=>{for(var t=0,n=0;n<e.length;++n){var f=e.charCodeAt(n);127>=f?t++:2047>=f?t+=2:55296<=f&&57343>=f?(t+=4,++n):t+=3}return t},s=(e,t,n,f)=>{if(n>>>=0,!(0<f))return 0;var y=n;f=n+f-1;for(var b=0;b<e.length;++b){var v=e.charCodeAt(b);if(55296<=v&&57343>=v){var I=e.charCodeAt(++b);v=65536+((v&1023)<<10)|I&1023}if(127>=v){if(n>=f)break;t[n++>>>0]=v}else{if(2047>=v){if(n+1>=f)break;t[n++>>>0]=192|v>>6}else{if(65535>=v){if(n+2>=f)break;t[n++>>>0]=224|v>>12}else{if(n+3>=f)break;t[n++>>>0]=240|v>>18,t[n++>>>0]=128|v>>12&63}t[n++>>>0]=128|v>>6&63}t[n++>>>0]=128|v&63}}return t[n>>>0]=0,n-y},c=(e,t,n)=>s(e,p(),t,n);function w(e,t){if(_)return j(5,1,e,t)}function E(e,t,n){if(_)return j(6,1,e,t,n)}function T(e,t,n){return _?j(7,1,e,t,n):0}function H(e,t){if(_)return j(8,1,e,t)}function ie(e,t,n){if(_)return j(9,1,e,t,n)}function ue(e,t,n,f){if(_)return j(10,1,e,t,n,f)}function fe(e,t,n,f){if(_)return j(11,1,e,t,n,f)}function st(e,t,n,f){if(_)return j(12,1,e,t,n,f)}function it(e){if(_)return j(13,1,e)}function m(e,t){if(_)return j(14,1,e,t)}function W(e,t,n){if(_)return j(15,1,e,t,n)}function z(e){e>>>=0,typeof Atomics.vb=="function"&&(Atomics.vb(l(),e>>>2,e).value.then(Oe),e+=128,Atomics.store(l(),e>>>2,1))}u.__emscripten_thread_mailbox_await=z;var Oe=()=>{var e=yt();if(e&&(z(e),e=pr,!_e))try{if(e(),!(0<ke))try{_?Mt(ne):Fe(ne)}catch(t){t instanceof We||t=="unwind"||L(1,t)}}catch(t){t instanceof We||t=="unwind"||L(1,t)}};u.checkMailbox=Oe;var Xe=[],Qe=e=>e%4===0&&(e%100!==0||e%400===0),zt=[0,31,60,91,121,152,182,213,244,274,305,335],Yt=[0,31,59,90,120,151,181,212,243,273,304,334];function Vt(e,t,n,f,y,b,v,I){return _?j(16,1,e,t,n,f,y,b,v,I):-52}function qt(e,t,n,f,y,b,v){if(_)return j(17,1,e,t,n,f,y,b,v)}var Jt=e=>{var t=a(e)+1,n=lr(t);return n&&c(e,n,t),n},Et=[],St={},Xt=()=>{if(!At){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:U||"./this.program"},t;for(t in St)St[t]===void 0?delete e[t]:e[t]=St[t];var n=[];for(t in e)n.push(`${t}=${e[t]}`);At=n}return At},At;function Qt(e,t){if(_)return j(18,1,e,t);e>>>=0,t>>>=0;var n=0;return Xt().forEach((f,y)=>{var b=t+n;for(y=O()[e+4*y>>>2>>>0]=b,b=0;b<f.length;++b)o()[y++>>>0>>>0]=f.charCodeAt(b);o()[y>>>0>>>0]=0,n+=f.length+1}),0}function Zt(e,t){if(_)return j(19,1,e,t);e>>>=0,t>>>=0;var n=Xt();O()[e>>>2>>>0]=n.length;var f=0;return n.forEach(y=>f+=y.length+1),O()[t>>>2>>>0]=f,0}function Kt(e){return _?j(20,1,e):52}function er(e,t,n,f){return _?j(21,1,e,t,n,f):52}function tr(e,t,n,f,y){return _?j(22,1,e,t,n,f,y):70}var Zr=[null,[],[]];function rr(e,t,n,f){if(_)return j(23,1,e,t,n,f);t>>>=0,n>>>=0,f>>>=0;for(var y=0,b=0;b<n;b++){var v=O()[t>>>2>>>0],I=O()[t+4>>>2>>>0];t+=8;for(var ve=0;ve<I;ve++){var ae=p()[v+ve>>>0],he=Zr[e];ae===0||ae===10?((e===1?ce:re)(tt(he,0)),he.length=0):he.push(ae)}y+=I}return O()[f>>>2>>>0]=y,0}var Kr=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return n=>(n.set(crypto.getRandomValues(new Uint8Array(n.byteLength))),n);if(P)try{var e=(Bt(),ze(Pt));if(e.randomFillSync)return n=>e.randomFillSync(n);var t=e.randomBytes;return n=>(n.set(t(n.byteLength)),n)}catch{}xe("initRandomDevice")},nr=e=>(nr=Kr())(e),ar=[31,29,31,30,31,30,31,31,30,31,30,31],or=[31,28,31,30,31,30,31,31,30,31,30,31];function en(e){var t=Array(a(e)+1);return s(e,t,0,t.length),t}var tn=(e,t)=>{o().set(e,t>>>0)};function sr(e,t,n,f){function y(g,k,K){for(g=typeof g=="number"?g.toString():g||"";g.length<k;)g=K[0]+g;return g}function b(g,k){return y(g,k,"0")}function v(g,k){function K(wr){return 0>wr?-1:0<wr?1:0}var je;return(je=K(g.getFullYear()-k.getFullYear()))===0&&(je=K(g.getMonth()-k.getMonth()))===0&&(je=K(g.getDate()-k.getDate())),je}function I(g){switch(g.getDay()){case 0:return new Date(g.getFullYear()-1,11,29);case 1:return g;case 2:return new Date(g.getFullYear(),0,3);case 3:return new Date(g.getFullYear(),0,2);case 4:return new Date(g.getFullYear(),0,1);case 5:return new Date(g.getFullYear()-1,11,31);case 6:return new Date(g.getFullYear()-1,11,30)}}function ve(g){var k=g.Va;for(g=new Date(new Date(g.Wa+1900,0,1).getTime());0<k;){var K=g.getMonth(),je=(Qe(g.getFullYear())?ar:or)[K];if(k>je-g.getDate())k-=je-g.getDate()+1,g.setDate(1),11>K?g.setMonth(K+1):(g.setMonth(0),g.setFullYear(g.getFullYear()+1));else{g.setDate(g.getDate()+k);break}}return K=new Date(g.getFullYear()+1,0,4),k=I(new Date(g.getFullYear(),0,4)),K=I(K),0>=v(k,g)?0>=v(K,g)?g.getFullYear()+1:g.getFullYear():g.getFullYear()-1}e>>>=0,t>>>=0,n>>>=0,f>>>=0;var ae=O()[f+40>>>2>>>0];f={sb:l()[f>>>2>>>0],rb:l()[f+4>>>2>>>0],Xa:l()[f+8>>>2>>>0],ab:l()[f+12>>>2>>>0],Ya:l()[f+16>>>2>>>0],Wa:l()[f+20>>>2>>>0],Ra:l()[f+24>>>2>>>0],Va:l()[f+28>>>2>>>0],yb:l()[f+32>>>2>>>0],qb:l()[f+36>>>2>>>0],tb:ae?Ge(ae):""},n=Ge(n),ae={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var he in ae)n=n.replace(new RegExp(he,"g"),ae[he]);var yr="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),br="January February March April May June July August September October November December".split(" ");ae={"%a":g=>yr[g.Ra].substring(0,3),"%A":g=>yr[g.Ra],"%b":g=>br[g.Ya].substring(0,3),"%B":g=>br[g.Ya],"%C":g=>b((g.Wa+1900)/100|0,2),"%d":g=>b(g.ab,2),"%e":g=>y(g.ab,2," "),"%g":g=>ve(g).toString().substring(2),"%G":g=>ve(g),"%H":g=>b(g.Xa,2),"%I":g=>(g=g.Xa,g==0?g=12:12<g&&(g-=12),b(g,2)),"%j":g=>{for(var k=0,K=0;K<=g.Ya-1;k+=(Qe(g.Wa+1900)?ar:or)[K++]);return b(g.ab+k,3)},"%m":g=>b(g.Ya+1,2),"%M":g=>b(g.rb,2),"%n":()=>`\n`,"%p":g=>0<=g.Xa&&12>g.Xa?"AM":"PM","%S":g=>b(g.sb,2),"%t":()=>"\t","%u":g=>g.Ra||7,"%U":g=>b(Math.floor((g.Va+7-g.Ra)/7),2),"%V":g=>{var k=Math.floor((g.Va+7-(g.Ra+6)%7)/7);if(2>=(g.Ra+371-g.Va-2)%7&&k++,k)k==53&&(K=(g.Ra+371-g.Va)%7,K==4||K==3&&Qe(g.Wa)||(k=1));else{k=52;var K=(g.Ra+7-g.Va-1)%7;(K==4||K==5&&Qe(g.Wa%400-1))&&k++}return b(k,2)},"%w":g=>g.Ra,"%W":g=>b(Math.floor((g.Va+7-(g.Ra+6)%7)/7),2),"%y":g=>(g.Wa+1900).toString().substring(2),"%Y":g=>g.Wa+1900,"%z":g=>{g=g.qb;var k=0<=g;return g=Math.abs(g)/60,(k?"+":"-")+("0000"+(g/60*100+g%60)).slice(-4)},"%Z":g=>g.tb,"%%":()=>"%"},n=n.replace(/%%/g,"\\0\\0");for(he in ae)n.includes(he)&&(n=n.replace(new RegExp(he,"g"),ae[he](f)));return n=n.replace(/\\0\\0/g,"%"),he=en(n),he.length>t?0:(tn(he,e),he.length-1)}var Ze,ir=[],ur=(e,t)=>{if(!Ze){Ze=new WeakMap;var n=ge.length;if(Ze)for(var f=0;f<0+n;f++){var y=nt(f);y&&Ze.set(y,f)}}if(n=Ze.get(e)||0)return n;if(ir.length)n=ir.pop();else{try{ge.grow(1)}catch(I){throw I instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":I}n=ge.length-1}try{f=n,ge.set(f,e),Be[f]=ge.get(f)}catch(I){if(!(I instanceof TypeError))throw I;if(typeof WebAssembly.Function=="function"){f=WebAssembly.Function,y={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"};for(var b={parameters:[],results:t[0]=="v"?[]:[y[t[0]]]},v=1;v<t.length;++v)b.parameters.push(y[t[v]]);t=new f(b,e)}else{for(f=[1],y=t.slice(0,1),t=t.slice(1),b={i:127,p:127,j:126,f:125,d:124,e:111},f.push(96),v=t.length,128>v?f.push(v):f.push(v%128|128,v>>7),v=0;v<t.length;++v)f.push(b[t[v]]);y=="v"?f.push(0):f.push(1,b[y]),t=[0,97,115,109,1,0,0,0,1],y=f.length,128>y?t.push(y):t.push(y%128|128,y>>7),t.push.apply(t,f),t.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),t=new WebAssembly.Module(new Uint8Array(t)),t=new WebAssembly.Instance(t,{e:{f:e}}).exports.f}f=n,ge.set(f,t),Be[f]=ge.get(f)}return Ze.set(e,n),n};C.$a();var rn=[rt,x,ht,ot,r,w,E,T,H,ie,ue,fe,st,it,m,W,Vt,qt,Qt,Zt,Kt,er,tr,rr],nn={b:function(e,t,n){throw e>>>=0,new mt(e).$a(t>>>0,n>>>0),at=e,gt++,at},O:function(e){cr(e>>>0,!B,1,!te,131072,!1),C.fb()},m:function(e){e>>>=0,_?postMessage({cmd:"cleanupThread",thread:e}):C.cb(C.Qa[e])},J:$e,h:ot,U:r,F:w,H:E,y:T,S:H,L:ie,R:ue,o:fe,G:st,D:it,T:m,E:W,p:()=>1,B:function(e,t){e>>>=0,e==t>>>0?setTimeout(()=>Oe()):_?postMessage({targetThread:e,cmd:"checkMailbox"}):(e=C.Qa[e])&&e.postMessage({cmd:"checkMailbox"})},K:function(e,t,n,f){t>>>=0,Xe.length=n,f=f>>>0>>>3;for(var y=0;y<n;y++)Xe[y]=h()[f+y>>>0];return e=0>e?Ye[-e-1]:rn[e],C.mb=t,t=e.apply(null,Xe),C.mb=0,t},M:z,W:function(e){P&&C.Qa[e>>>0].ref()},s:function(e,t,n){e=t+2097152>>>0<4194305-!!e?(e>>>0)+4294967296*t:NaN,n>>>=0,e=new Date(1e3*e),l()[n>>>2>>>0]=e.getUTCSeconds(),l()[n+4>>>2>>>0]=e.getUTCMinutes(),l()[n+8>>>2>>>0]=e.getUTCHours(),l()[n+12>>>2>>>0]=e.getUTCDate(),l()[n+16>>>2>>>0]=e.getUTCMonth(),l()[n+20>>>2>>>0]=e.getUTCFullYear()-1900,l()[n+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,l()[n+28>>>2>>>0]=e},t:function(e,t,n){e=t+2097152>>>0<4194305-!!e?(e>>>0)+4294967296*t:NaN,n>>>=0,e=new Date(1e3*e),l()[n>>>2>>>0]=e.getSeconds(),l()[n+4>>>2>>>0]=e.getMinutes(),l()[n+8>>>2>>>0]=e.getHours(),l()[n+12>>>2>>>0]=e.getDate(),l()[n+16>>>2>>>0]=e.getMonth(),l()[n+20>>>2>>>0]=e.getFullYear()-1900,l()[n+24>>>2>>>0]=e.getDay(),t=(Qe(e.getFullYear())?zt:Yt)[e.getMonth()]+e.getDate()-1|0,l()[n+28>>>2>>>0]=t,l()[n+36>>>2>>>0]=-(60*e.getTimezoneOffset()),t=new Date(e.getFullYear(),6,1).getTimezoneOffset();var f=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=(t!=f&&e.getTimezoneOffset()==Math.min(f,t))|0,l()[n+32>>>2>>>0]=e},u:function(e){e>>>=0;var t=new Date(l()[e+20>>>2>>>0]+1900,l()[e+16>>>2>>>0],l()[e+12>>>2>>>0],l()[e+8>>>2>>>0],l()[e+4>>>2>>>0],l()[e>>>2>>>0],0),n=l()[e+32>>>2>>>0],f=t.getTimezoneOffset(),y=new Date(t.getFullYear(),6,1).getTimezoneOffset(),b=new Date(t.getFullYear(),0,1).getTimezoneOffset(),v=Math.min(b,y);return 0>n?l()[e+32>>>2>>>0]=+(y!=b&&v==f):0<n!=(v==f)&&(y=Math.max(b,y),t.setTime(t.getTime()+6e4*((0<n?v:y)-f))),l()[e+24>>>2>>>0]=t.getDay(),n=(Qe(t.getFullYear())?zt:Yt)[t.getMonth()]+t.getDate()-1|0,l()[e+28>>>2>>>0]=n,l()[e>>>2>>>0]=t.getSeconds(),l()[e+4>>>2>>>0]=t.getMinutes(),l()[e+8>>>2>>>0]=t.getHours(),l()[e+12>>>2>>>0]=t.getDate(),l()[e+16>>>2>>>0]=t.getMonth(),l()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),isNaN(e)?(l()[fr()>>>2>>>0]=61,e=-1):e/=1e3,mr((Le=e,1<=+Math.abs(Le)?0<Le?+Math.floor(Le/4294967296)>>>0:~~+Math.ceil((Le-+(~~Le>>>0))/4294967296)>>>0:0)),e>>>0},q:Vt,r:qt,A:function(e,t,n){function f(ae){return(ae=ae.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?ae[1]:"GMT"}e>>>=0,t>>>=0,n>>>=0;var y=new Date().getFullYear(),b=new Date(y,0,1),v=new Date(y,6,1);y=b.getTimezoneOffset();var I=v.getTimezoneOffset(),ve=Math.max(y,I);O()[e>>>2>>>0]=60*ve,l()[t>>>2>>>0]=+(y!=I),e=f(b),t=f(v),e=Jt(e),t=Jt(t),I<y?(O()[n>>>2>>>0]=e,O()[n+4>>>2>>>0]=t):(O()[n>>>2>>>0]=t,O()[n+4>>>2>>>0]=e)},c:()=>{xe("")},N:function(e,t,n){e>>>=0,t>>>=0,n>>>=0,Et.length=0;for(var f;f=p()[t++>>>0];){var y=f!=105;y&=f!=112,n+=y&&n%8?4:0,Et.push(f==112?O()[n>>>2>>>0]:f==105?l()[n>>>2>>>0]:h()[n>>>3>>>0]),n+=y?8:4}return Ye[e].apply(null,Et)},n:()=>{},i:()=>Date.now(),V:()=>{throw ke+=1,"unwind"},C:function(){return 4294901760},e:()=>performance.timeOrigin+performance.now(),f:()=>P?(Mr(),ze(Tr)).cpus().length:navigator.hardwareConcurrency,z:function(e){e>>>=0;var t=p().length;if(e<=t||4294901760<e)return!1;for(var n=1;4>=n;n*=2){var f=t*(1+.2/n);f=Math.min(f,e+100663296);var y=Math;f=Math.max(e,f);e:{y=(y.min.call(y,4294901760,f+(65536-f%65536)%65536)-Z.buffer.byteLength+65535)/65536;try{Z.grow(y),V();var b=1;break e}catch{}b=void 0}if(b)return!0}return!1},P:Qt,Q:Zt,I:Fe,g:Kt,l:er,v:tr,k:rr,w:function(e,t){return e>>>=0,t>>>=0,nr(p().subarray(e>>>0,e+t>>>0)),0},a:Z||u.wasmMemory,x:sr,d:function(e,t,n,f){return sr(e>>>0,t>>>0,n>>>0,f>>>0)},j:function(e,t,n,f){let y=ge.length;e=new Uint8Array(p().slice(e+t,e+n));try{var b=new WebAssembly.Module(e),v=new WebAssembly.Instance(b,{env:{memory:Z}}),I;for(I in v.exports)ur(v.exports[I]);return y<ge.length?y:f}catch(ve){return console.log(ve),f}}},M=function(){function e(n,f){return M=n.exports,M=an(),C.gb.push(M.Da),ge=M.Ea,Me.unshift(M.X),Ae=f,Ce(),M}var t={a:nn};if(Se++,u.instantiateWasm)try{return u.instantiateWasm(t,e)}catch(n){re(`Module.instantiateWasm callback failed with error: ${n}`),D(n)}return lt(t,function(n){e(n.instance,n.module)}).catch(D),{}}();u._OrtInit=(e,t)=>(u._OrtInit=M.Y)(e,t),u._OrtGetLastError=(e,t)=>(u._OrtGetLastError=M.Z)(e,t),u._OrtCreateSessionOptions=(e,t,n,f,y,b,v,I,ve,ae)=>(u._OrtCreateSessionOptions=M._)(e,t,n,f,y,b,v,I,ve,ae),u._OrtAppendExecutionProvider=(e,t)=>(u._OrtAppendExecutionProvider=M.$)(e,t),u._OrtAddFreeDimensionOverride=(e,t,n)=>(u._OrtAddFreeDimensionOverride=M.aa)(e,t,n),u._OrtAddSessionConfigEntry=(e,t,n)=>(u._OrtAddSessionConfigEntry=M.ba)(e,t,n),u._OrtReleaseSessionOptions=e=>(u._OrtReleaseSessionOptions=M.ca)(e),u._OrtCreateSession=(e,t,n)=>(u._OrtCreateSession=M.da)(e,t,n),u._OrtReleaseSession=e=>(u._OrtReleaseSession=M.ea)(e),u._OrtGetInputOutputCount=(e,t,n)=>(u._OrtGetInputOutputCount=M.fa)(e,t,n),u._OrtGetInputName=(e,t)=>(u._OrtGetInputName=M.ga)(e,t),u._OrtGetOutputName=(e,t)=>(u._OrtGetOutputName=M.ha)(e,t),u._OrtFree=e=>(u._OrtFree=M.ia)(e),u._OrtCreateTensor=(e,t,n,f,y,b)=>(u._OrtCreateTensor=M.ja)(e,t,n,f,y,b),u._OrtGetTensorData=(e,t,n,f,y)=>(u._OrtGetTensorData=M.ka)(e,t,n,f,y),u._OrtReleaseTensor=e=>(u._OrtReleaseTensor=M.la)(e),u._OrtCreateRunOptions=(e,t,n,f)=>(u._OrtCreateRunOptions=M.ma)(e,t,n,f),u._OrtAddRunConfigEntry=(e,t,n)=>(u._OrtAddRunConfigEntry=M.na)(e,t,n),u._OrtReleaseRunOptions=e=>(u._OrtReleaseRunOptions=M.oa)(e),u._OrtCreateBinding=e=>(u._OrtCreateBinding=M.pa)(e),u._OrtBindInput=(e,t,n)=>(u._OrtBindInput=M.qa)(e,t,n),u._OrtBindOutput=(e,t,n,f)=>(u._OrtBindOutput=M.ra)(e,t,n,f),u._OrtClearBoundOutputs=e=>(u._OrtClearBoundOutputs=M.sa)(e),u._OrtReleaseBinding=e=>(u._OrtReleaseBinding=M.ta)(e),u._OrtRunWithBinding=(e,t,n,f,y)=>(u._OrtRunWithBinding=M.ua)(e,t,n,f,y),u._OrtRun=(e,t,n,f,y,b,v,I)=>(u._OrtRun=M.va)(e,t,n,f,y,b,v,I),u._OrtEndProfiling=e=>(u._OrtEndProfiling=M.wa)(e),u._OrtConfigure=(e,t)=>(u._OrtConfigure=M.xa)(e,t),u._OrtAuth=(e,t)=>(u._OrtAuth=M.ya)(e,t);var fr=()=>(fr=M.za)(),yt=u._pthread_self=()=>(yt=u._pthread_self=M.Aa)(),lr=u._malloc=e=>(lr=u._malloc=M.Ba)(e);u._free=e=>(u._free=M.Ca)(e),u.__emscripten_tls_init=()=>(u.__emscripten_tls_init=M.Da)();var cr=u.__emscripten_thread_init=(e,t,n,f,y,b)=>(cr=u.__emscripten_thread_init=M.Fa)(e,t,n,f,y,b);u.__emscripten_thread_crashed=()=>(u.__emscripten_thread_crashed=M.Ga)();var dr=(e,t,n,f)=>(dr=M.Ha)(e,t,n,f),Tt=e=>(Tt=M.Ia)(e),Mt=u.__emscripten_thread_exit=e=>(Mt=u.__emscripten_thread_exit=M.Ja)(e),pr=()=>(pr=M.Ka)(),mr=e=>(mr=M.La)(e),gr=(e,t)=>(gr=M.Ma)(e,t),Ct=()=>(Ct=M.Na)(),bt=e=>(bt=M.Oa)(e),xt=e=>(xt=M.Pa)(e);u.___start_em_js=887097,u.___stop_em_js=887709;function an(){var e=M;e=Object.assign({},e);var t=f=>()=>f()>>>0,n=f=>y=>f(y)>>>0;return e.za=t(e.za),e.Aa=t(e.Aa),e.Ba=n(e.Ba),e.emscripten_main_runtime_thread_id=t(e.emscripten_main_runtime_thread_id),e.Na=t(e.Na),e.Pa=n(e.Pa),e}u.wasmMemory=Z,u.stackAlloc=xt,u.stackSave=Ct,u.stackRestore=bt,u.keepRuntimeAlive=()=>0<ke,u.addFunction=ur,u.UTF8ToString=Ge,u.stringToUTF8=c,u.lengthBytesUTF8=a,u.ExitStatus=We,u.PThread=C;var wt;me=function e(){wt||hr(),wt||(me=e)};function hr(){if(!(0<Se))if(_)A(u),_||Je(Me),startWorker(u);else{if(u.preRun)for(typeof u.preRun=="function"&&(u.preRun=[u.preRun]);u.preRun.length;)Ne.unshift(u.preRun.shift());Je(Ne),0<Se||wt||(wt=!0,u.calledRun=!0,_e||(_||Je(Me),A(u),_||Je(Ee)))}}return hr(),d.ready}})();typeof xr=="object"&&typeof Wt=="object"?Wt.exports=Cr:typeof define=="function"&&define.amd&&define([],()=>Cr)});var Fr=ut((Un,gn)=>{gn.exports=\'"use strict";var Module={},ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads"),parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",e=>onmessage({data:e}));var fs=require("fs"),vm=require("vm");Object.assign(global,{self:global,require,Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:e=>vm.runInThisContext(fs.readFileSync(e,"utf8"),{filename:e}),postMessage:e=>parentPort.postMessage(e),performance:global.performance||{now:Date.now}})}var initializedJS=!1;function threadPrintErr(){var e=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,e+`\\n`);return}console.error(e)}function threadAlert(){var e=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:e,threadId:Module._pthread_self()})}var err=threadPrintErr;self.alert=threadAlert,Module.instantiateWasm=(e,t)=>{var a=Module.wasmModule;Module.wasmModule=null;var r=new WebAssembly.Instance(a,e);return t(r)},self.onunhandledrejection=e=>{throw e.reason||e};function handleMessage(e){try{if(e.data.cmd==="load"){let a=[];self.onmessage=r=>a.push(r),self.startWorker=r=>{Module=r,postMessage({cmd:"loaded"});for(let s of a)handleMessage(s);self.onmessage=handleMessage},Module.wasmModule=e.data.wasmModule;for(const r of e.data.handlers)Module[r]=(...s)=>{postMessage({cmd:"callHandler",handler:r,args:s})};if(Module.wasmMemory=e.data.wasmMemory,Module.buffer=Module.wasmMemory.buffer,Module.ENVIRONMENT_IS_PTHREAD=!0,typeof e.data.urlOrBlob=="string")importScripts(e.data.urlOrBlob);else{var t=URL.createObjectURL(e.data.urlOrBlob);importScripts(t),URL.revokeObjectURL(t)}ortWasmThreaded(Module)}else if(e.data.cmd==="run"){Module.__emscripten_thread_init(e.data.pthread_ptr,0,0,1),Module.__emscripten_thread_mailbox_await(e.data.pthread_ptr),Module.establishStackSpace(),Module.PThread.receiveObjectTransfer(e.data),Module.PThread.threadInitTLS(),initializedJS||(initializedJS=!0);try{Module.invokeEntryPoint(e.data.start_routine,e.data.arg)}catch(a){if(a!="unwind")throw a}}else e.data.cmd==="cancel"?Module._pthread_self()&&Module.__emscripten_thread_exit(-1):e.data.target==="setimmediate"||(e.data.cmd==="checkMailbox"?initializedJS&&Module.checkMailbox():e.data.cmd&&(err(`worker.js received unknown command ${e.data.cmd}`),err(e.data)))}catch(a){throw Module.__emscripten_thread_crashed?.(),a}}self.onmessage=handleMessage;\\n\'});var Rr;Rr=Er();var hn=Dr(),Nt,Ht=!1,_t=!1,Ur=!1,yn=i=>{if(i===1)return!1;if(typeof SharedArrayBuffer>"u")return typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+i+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),!1;typeof process<"u"&&process.versions&&process.versions.node&&console.warn("env.wasm.numThreads is set to "+i+", however, currently onnxruntime-web does not support multi-threads in Node.js. Please consider using onnxruntime-node for performance critical scenarios.");try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},bn=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},wn=(i,d)=>i?d?"ort-wasm-simd-threaded.wasm":"ort-wasm-simd.wasm":d?"ort-wasm-threaded.wasm":"ort-wasm.wasm",Lr=async i=>{if(Ht)return Promise.resolve();if(_t)throw new Error("multiple calls to \'initializeWebAssembly()\' detected.");if(Ur)throw new Error("previous call to \'initializeWebAssembly()\' failed.");_t=!0;let d=i.initTimeout,o=i.numThreads,p=i.simd,l=yn(o),O=p&&bn(),h=i.wasmPaths,u=typeof h=="string"?h:void 0,A=wn(O,l),D=typeof h=="object"?h[A]:void 0,R=!1,U=[];if(d>0&&U.push(new Promise(L=>{setTimeout(()=>{R=!0,L()},d)})),U.push(new Promise((L,te)=>{let B=l?hn:Rr,P={locateFile:(_,N)=>l&&_.endsWith(".worker.js")&&typeof Blob<"u"?URL.createObjectURL(new Blob([Fr()],{type:"text/javascript"})):_.endsWith(".wasm")?D||(u??N)+A:N+_};if(l)if(P.numThreads=o,typeof Blob>"u")P.mainScriptUrlOrBlob=(void 0)(__dirname,"ort-wasm-threaded.js");else{let _=`var ortWasmThreaded=${B.toString()};`;P.mainScriptUrlOrBlob=new Blob([_],{type:"text/javascript"})}B(P).then(_=>{_t=!1,Ht=!0,Nt=_,L()},_=>{_t=!1,Ur=!0,te(_)})})),await Promise.race(U),R)throw new Error(`WebAssembly backend initializing failed due to timeout: ${d}ms`)},J=()=>{if(Ht&&Nt)return Nt;throw new Error("WebAssembly is not initialized yet.")};var X=(i,d)=>{let o=J(),p=o.lengthBytesUTF8(i)+1,l=o._malloc(p);return o.stringToUTF8(i,l,p),d.push(l),l},ft=(i,d,o,p)=>{if(typeof i=="object"&&i!==null){if(o.has(i))throw new Error("Circular reference in options");o.add(i)}Object.entries(i).forEach(([l,O])=>{let h=d?d+l:l;if(typeof O=="object")ft(O,h+".",o,p);else if(typeof O=="string"||typeof O=="number")p(h,O.toString());else if(typeof O=="boolean")p(h,O?"1":"0");else throw new Error(`Can\'t handle extra config type: ${typeof O}`)})},Q=i=>{let d=J(),o=d.stackSave();try{let p=d.stackAlloc(8);d._OrtGetLastError(p,p+4);let l=d.HEAP32[p/4],O=d.HEAPU32[p/4+1],h=O?d.UTF8ToString(O):"";throw new Error(`${i} ERROR_CODE: ${l}, ERROR_MESSAGE: ${h}`)}finally{d.stackRestore(o)}};var Pr=i=>{let d=J(),o=0,p=[],l=i||{};try{if(i?.logSeverityLevel===void 0)l.logSeverityLevel=2;else if(typeof i.logSeverityLevel!="number"||!Number.isInteger(i.logSeverityLevel)||i.logSeverityLevel<0||i.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${i.logSeverityLevel}`);if(i?.logVerbosityLevel===void 0)l.logVerbosityLevel=0;else if(typeof i.logVerbosityLevel!="number"||!Number.isInteger(i.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${i.logVerbosityLevel}`);i?.terminate===void 0&&(l.terminate=!1);let O=0;return i?.tag!==void 0&&(O=X(i.tag,p)),o=d._OrtCreateRunOptions(l.logSeverityLevel,l.logVerbosityLevel,!!l.terminate,O),o===0&&Q("Can\'t create run options."),i?.extra!==void 0&&ft(i.extra,"",new WeakSet,(h,u)=>{let A=X(h,p),D=X(u,p);d._OrtAddRunConfigEntry(o,A,D)!==0&&Q(`Can\'t set a run config entry: ${h} - ${u}.`)}),[o,p]}catch(O){throw o!==0&&d._OrtReleaseRunOptions(o),p.forEach(h=>d._free(h)),O}};var On=i=>{switch(i){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${i}`)}},vn=i=>{switch(i){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${i}`)}},_n=i=>{i.extra||(i.extra={}),i.extra.session||(i.extra.session={});let d=i.extra.session;d.use_ort_model_bytes_directly||(d.use_ort_model_bytes_directly="1"),i.executionProviders&&i.executionProviders.some(o=>(typeof o=="string"?o:o.name)==="webgpu")&&(i.enableMemPattern=!1)},En=(i,d,o)=>{for(let p of d){let l=typeof p=="string"?p:p.name;switch(l){case"webnn":if(l="WEBNN",typeof p!="string"){let h=p;if(h?.deviceType){let u=X("deviceType",o),A=X(h.deviceType,o);J()._OrtAddSessionConfigEntry(i,u,A)!==0&&Q(`Can\'t set a session config entry: \'deviceType\' - ${h.deviceType}.`)}if(h?.numThreads){let u=h.numThreads;(typeof u!="number"||!Number.isInteger(u)||u<0)&&(u=0);let A=X("numThreads",o),D=X(u.toString(),o);J()._OrtAddSessionConfigEntry(i,A,D)!==0&&Q(`Can\'t set a session config entry: \'numThreads\' - ${h.numThreads}.`)}if(h?.powerPreference){let u=X("powerPreference",o),A=X(h.powerPreference,o);J()._OrtAddSessionConfigEntry(i,u,A)!==0&&Q(`Can\'t set a session config entry: \'powerPreference\' - ${h.powerPreference}.`)}}break;case"webgpu":if(l="JS",typeof p!="string"){let h=p;if(h?.preferredLayout){if(h.preferredLayout!=="NCHW"&&h.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either \'NCHW\' or \'NHWC\': ${h.preferredLayout}`);let u=X("preferredLayout",o),A=X(h.preferredLayout,o);J()._OrtAddSessionConfigEntry(i,u,A)!==0&&Q(`Can\'t set a session config entry: \'preferredLayout\' - ${h.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${l}`)}let O=X(l,o);J()._OrtAppendExecutionProvider(i,O)!==0&&Q(`Can\'t append execution provider: ${l}.`)}},Br=i=>{let d=J(),o=0,p=[],l=i||{};_n(l);try{let O=On(l.graphOptimizationLevel??"all"),h=vn(l.executionMode??"sequential"),u=typeof l.logId=="string"?X(l.logId,p):0,A=l.logSeverityLevel??2;if(!Number.isInteger(A)||A<0||A>4)throw new Error(`log serverity level is not valid: ${A}`);let D=l.logVerbosityLevel??0;if(!Number.isInteger(D)||D<0||D>4)throw new Error(`log verbosity level is not valid: ${D}`);let R=typeof l.optimizedModelFilePath=="string"?X(l.optimizedModelFilePath,p):0;if(o=d._OrtCreateSessionOptions(O,!!l.enableCpuMemArena,!!l.enableMemPattern,h,!!l.enableProfiling,0,u,A,D,R),o===0&&Q("Can\'t create session options."),l.executionProviders&&En(o,l.executionProviders,p),l.enableGraphCapture!==void 0){if(typeof l.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${l.enableGraphCapture}`);let U=X("enableGraphCapture",p),L=X(l.enableGraphCapture.toString(),p);d._OrtAddSessionConfigEntry(o,U,L)!==0&&Q(`Can\'t set a session config entry: \'enableGraphCapture\' - ${l.enableGraphCapture}.`)}if(l.freeDimensionOverrides)for(let[U,L]of Object.entries(l.freeDimensionOverrides)){if(typeof U!="string")throw new Error(`free dimension override name must be a string: ${U}`);if(typeof L!="number"||!Number.isInteger(L)||L<0)throw new Error(`free dimension override value must be a non-negative integer: ${L}`);let te=X(U,p);d._OrtAddFreeDimensionOverride(o,te,L)!==0&&Q(`Can\'t set a free dimension override: ${U} - ${L}.`)}return l.extra!==void 0&&ft(l.extra,"",new WeakSet,(U,L)=>{let te=X(U,p),B=X(L,p);d._OrtAddSessionConfigEntry(o,te,B)!==0&&Q(`Can\'t set a session config entry: ${U} - ${L}.`)}),[o,p]}catch(O){throw o!==0&&d._OrtReleaseSessionOptions(o),p.forEach(h=>d._free(h)),O}};var kt=i=>{switch(i){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${i}`)}},Ir=i=>{switch(i){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${i}`)}},Gt=i=>[void 0,4,1,1,2,2,4,8,void 0,1,2,8,4,8,void 0,void 0,void 0][i],Wr=i=>{switch(i){case"float16":return Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${i}`)}},Nr=i=>{switch(i){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${i}`)}},Hr=i=>i==="float32"||i==="int32"||i==="int64"||i==="bool"||i==="float16"||i==="uint32",kr=i=>{switch(i){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;default:throw new Error(`unsupported data location: ${i}`)}};var Gr=async i=>{if(typeof i=="string")if(typeof process<"u"&&process.versions&&process.versions.node)try{return new Uint8Array(await(void 0)(i))}catch(d){if(d.code==="ERR_FS_FILE_TOO_LARGE"){let o=(void 0)(i),p=[];for await(let l of o)p.push(l);return new Uint8Array(Buffer.concat(p))}throw d}else{let d=await fetch(i);if(!d.ok)throw new Error(`failed to load external data file: ${i}`);let o=d.headers.get("Content-Length"),p=o?parseInt(o,10):0;if(p<1073741824)return new Uint8Array(await d.arrayBuffer());{if(!d.body)throw new Error(`failed to load external data file: ${i}, no response body.`);let l=d.body.getReader(),O;try{O=new ArrayBuffer(p)}catch(u){if(u instanceof RangeError){let A=Math.ceil(p/65536);O=new WebAssembly.Memory({initial:A,maximum:A}).buffer}else throw u}let h=0;for(;;){let{done:u,value:A}=await l.read();if(u)break;let D=A.byteLength;new Uint8Array(O,h,D).set(A),h+=D}return new Uint8Array(O,0,p)}}else return i instanceof Blob?new Uint8Array(await i.arrayBuffer()):i instanceof Uint8Array?i:new Uint8Array(i)};var Sn=(i,d)=>{J()._OrtInit(i,d)!==0&&Q("Can\'t initialize onnxruntime.")},jr=async i=>{Sn(i.wasm.numThreads,Nr(i.logLevel))},zr=async(i,d)=>{},Ke=new Map,An=i=>{let d=J(),o=d.stackSave();try{let p=d.stackAlloc(8);return d._OrtGetInputOutputCount(i,p,p+4)!==0&&Q("Can\'t get session input/output count."),[d.HEAP32[p/4],d.HEAP32[p/4+1]]}finally{d.stackRestore(o)}},$t=i=>{let d=J(),o=d._malloc(i.byteLength);if(o===0)throw new Error(`Can\'t create a session. failed to allocate a buffer of size ${i.byteLength}.`);return d.HEAPU8.set(i,o),[o,i.byteLength]},Yr=async(i,d)=>{let o,p,l=J();Array.isArray(i)?[o,p]=i:i.buffer===l.HEAPU8.buffer?[o,p]=[i.byteOffset,i.byteLength]:[o,p]=$t(i);let O=0,h=0,u=0,A=[],D=[],R=[];try{if([h,A]=Br(d),d?.externalData&&l.mountExternalData){let G=[];for(let $ of d.externalData){let oe=typeof $=="string"?$:$.path;G.push(Gr(typeof $=="string"?$:$.data).then(ee=>{l.mountExternalData(oe,ee)}))}await Promise.all(G)}O=l._OrtCreateSession(o,p,h),O===0&&Q("Can\'t create a session.");let[U,L]=An(O),te=!!d?.enableGraphCapture,B=[],P=[],_=[];for(let G=0;G<U;G++){let $=l._OrtGetInputName(O,G);$===0&&Q("Can\'t get an input name."),D.push($),B.push(l.UTF8ToString($))}for(let G=0;G<L;G++){let $=l._OrtGetOutputName(O,G);$===0&&Q("Can\'t get an output name."),R.push($);let oe=l.UTF8ToString($);P.push(oe)}let N=null;return Ke.set(O,[O,D,R,N,te,!1]),[O,B,P]}catch(U){throw D.forEach(L=>l._OrtFree(L)),R.forEach(L=>l._OrtFree(L)),u!==0&&l._OrtReleaseBinding(u),O!==0&&l._OrtReleaseSession(O),U}finally{l._free(o),h!==0&&l._OrtReleaseSessionOptions(h),A.forEach(U=>l._free(U)),l.unmountExternalData?.()}},Vr=i=>{let d=J(),o=Ke.get(i);if(!o)throw new Error(`cannot release session. invalid session id: ${i}`);let[p,l,O,h,u]=o;h&&(u&&d._OrtClearBoundOutputs(h.handle),d._OrtReleaseBinding(h.handle)),d.jsepOnReleaseSession?.(i),l.forEach(A=>d._OrtFree(A)),O.forEach(A=>d._OrtFree(A)),d._OrtReleaseSession(p),Ke.delete(i)},Tn=(i,d,o)=>{if(i!==null&&i[0]===d){let l=i[2];if(l.length===o)return l}let p=Wr(d);return new p(o)},$r=(i,d,o,p,l,O=!1)=>{if(!i){d.push(0);return}let h=J(),u=i[0],A=i[1],D=i[3],R,U;if(u==="string"&&D==="gpu-buffer")throw new Error("String tensor is not supported on GPU.");if(O&&D!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${l} when enableGraphCapture is true.`);if(D==="gpu-buffer"){let B=i[2].gpuBuffer,P=Gt(kt(u));U=A.reduce((_,N)=>_*N,1)*P,R=h.jsepRegisterBuffer(p,l,B,U)}else{let B=i[2];if(Array.isArray(B)){U=4*B.length,R=h._malloc(U),o.push(R);let P=R/4;for(let _=0;_<B.length;_++){if(typeof B[_]!="string")throw new TypeError(`tensor data at index ${_} is not a string`);h.HEAPU32[P++]=X(B[_],o)}}else U=B.byteLength,R=h._malloc(U),o.push(R),h.HEAPU8.set(new Uint8Array(B.buffer,B.byteOffset,U),R)}let L=h.stackSave(),te=h.stackAlloc(4*A.length);try{let B=te/4;A.forEach(_=>h.HEAP32[B++]=_);let P=h._OrtCreateTensor(kt(u),R,U,te,A.length,kr(D));P===0&&Q(`Can\'t create tensor for input/output. session=${p}, index=${l}.`),d.push(P)}finally{h.stackRestore(L)}},qr=i=>{let o=new TextEncoder().encode(i),p=J(),l=p._malloc(o.byteLength);p.HEAPU8.set(o,l);let O=p._OrtConfigure(l,o.byteLength);if(O===0)throw new Error("Can\'t get an configure key");let h=p.UTF8ToString(O);return p._OrtFree(O),h},Jr=i=>{let o=new TextEncoder().encode(i),p=J(),l=p._malloc(o.byteLength);p.HEAPU8.set(o,l);let O=p._OrtAuth(l,o.byteLength);if(O===0)throw new Error("Can\'t get an auth result");let h=p.UTF8ToString(O);return p._OrtFree(O),h},Xr=async(i,d,o,p,l,O)=>{let h=J(),u=Ke.get(i);if(!u)throw new Error(`cannot run inference. invalid session id: ${i}`);let A=u[0],D=u[1],R=u[2],U=u[3],L=u[4],te=u[5],B=d.length,P=p.length,_=0,N=[],G=[],$=[],oe=[],ee=h.stackSave(),S=h.stackAlloc(B*4),Y=h.stackAlloc(B*4),Ue=h.stackAlloc(P*4),Ie=h.stackAlloc(P*4);try{[_,N]=Pr(O);for(let F=0;F<B;F++)$r(o[F],G,oe,i,d[F],L);for(let F=0;F<P;F++){let de=l[F],we=de?.[3]??"";$r(we==="gpu-buffer"?de:null,$,oe,i,B+p[F],L)}let ce=S/4,re=Y/4,Z=Ue/4,Ae=Ie/4;for(let F=0;F<B;F++)h.HEAPU32[ce++]=G[F],h.HEAPU32[re++]=D[d[F]];for(let F=0;F<P;F++)h.HEAPU32[Z++]=$[F],h.HEAPU32[Ae++]=R[p[F]];let _e;h.jsepOnRunStart?.(A),_e=await h._OrtRun(A,Y,S,B,Ie,P,Ue,_),_e!==0&&Q("failed to call OrtRun().");let ne=[];for(let F=0;F<P;F++){let de=h.HEAPU32[Ue/4+F];if(de===$[F]){ne.push(l[F]);continue}let we=h.stackSave(),le=h.stackAlloc(4*4),Te=!1,V,pe=0;try{h._OrtGetTensorData(de,le,le+4,le+8,le+12)!==0&&Q(`Can\'t access output tensor data on index ${F}.`);let Me=le/4,Ee=h.HEAPU32[Me++];pe=h.HEAPU32[Me++];let Se=h.HEAPU32[Me++],He=h.HEAPU32[Me++],me=[];for(let q=0;q<He;q++)me.push(h.HEAPU32[Se/4+q]);h._OrtFree(Se);let Ce=me.reduce((q,se)=>q*se,1);V=Ir(Ee);let xe=U?.outputPreferredLocations[p[F]];if(V==="string"){if(xe==="gpu-buffer")throw new Error("String tensor is not supported on GPU.");let q=[],se=pe/4;for(let ye=0;ye<Ce;ye++){let Re=h.HEAPU32[se++],De=ye===Ce-1?void 0:h.HEAPU32[se]-Re;q.push(h.UTF8ToString(Re,De))}ne.push([V,me,q,"cpu"])}else if(xe==="gpu-buffer"&&Ce>0){let q=h.jsepGetBuffer(pe),se=Gt(Ee);if(se===void 0||!Hr(V))throw new Error(`Unsupported data type: ${V}`);Te=!0,ne.push([V,me,{gpuBuffer:q,download:h.jsepCreateDownloader(q,Ce*se,V),dispose:()=>{h._OrtReleaseTensor(de)}},"gpu-buffer"])}else{let q=Tn(l[F],V,Ce);new Uint8Array(q.buffer,q.byteOffset,q.byteLength).set(h.HEAPU8.subarray(pe,pe+q.byteLength)),ne.push([V,me,q,"cpu"])}}finally{h.stackRestore(we),V==="string"&&pe&&h._free(pe),Te||h._OrtReleaseTensor(de)}}return U&&!L&&(h._OrtClearBoundOutputs(U.handle),Ke.set(i,[A,D,R,U,L,!1])),ne}finally{h.stackRestore(ee),G.forEach(ce=>h._OrtReleaseTensor(ce)),$.forEach(ce=>h._OrtReleaseTensor(ce)),oe.forEach(ce=>h._free(ce)),_!==0&&h._OrtReleaseRunOptions(_),N.forEach(ce=>h._free(ce))}},Qr=i=>{let d=J(),o=Ke.get(i);if(!o)throw new Error("invalid session id");let p=o[0],l=d._OrtEndProfiling(p);l===0&&Q("Can\'t get an profile file name."),d._OrtFree(l)},jt=i=>{let d=[];for(let o of i){let p=o[2];!Array.isArray(p)&&"buffer"in p&&d.push(p.buffer)}return d};self.onmessage=i=>{let{type:d,in:o}=i.data;try{switch(d){case"init-wasm":Lr(o.wasm).then(()=>{jr(o).then(()=>{postMessage({type:d})},p=>{postMessage({type:d,err:p})})},p=>{postMessage({type:d,err:p})});break;case"init-ep":{let{epName:p,env:l}=o;zr(l,p).then(()=>{postMessage({type:d})},O=>{postMessage({type:d,err:O})});break}case"copy-from":{let{buffer:p}=o,l=$t(p);postMessage({type:d,out:l});break}case"create":{let{model:p,options:l}=o;Yr(p,l).then(O=>{postMessage({type:d,out:O})},O=>{postMessage({type:d,err:O})});break}case"release":Vr(o),postMessage({type:d});break;case"run":{let{sessionId:p,inputIndices:l,inputs:O,outputIndices:h,options:u}=o,A=i.data.prealloc??[];for(;A.length<h.length;)A.push(null);Xr(p,l,O,h,A,u).then(D=>{D.some(R=>R[3]!=="cpu")?postMessage({type:d,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:d,out:D,inputsBack:O},jt(D).concat(jt(O)))},D=>{postMessage({type:d,err:D})});break}case"configure":try{let p=qr(i.data.in);postMessage({type:"configure",out:p})}catch(p){postMessage({type:"configure",err:p})}break;case"auth":try{let p=Jr(i.data.in);postMessage({type:"auth",out:p})}catch(p){postMessage({type:"auth",err:p})}break;case"end-profiling":Qr(o),postMessage({type:d});break;default:}}catch(p){postMessage({type:d,err:p})}};})();\n'})),Kt,it,Sn,Mo,Go,va,Uo,or,ir,Cg,Ro,Fg,pd,dd,hd,md,bd,gd,yd,Td,xd,_a=D((()=>{_t(),fd(),Kr(),Kt=()=>!!ee.wasm.proxy&&typeof document<"u",Sn=!1,Mo=!1,Go=!1,Uo=new Map,or=(t,e)=>{let r=Uo.get(t);r?r.push(e):Uo.set(t,[e])},ir=()=>{if(Sn||!Mo||Go||!it)throw new Error("worker not ready")},Cg=t=>{switch(t.data.type){case"init-wasm":Sn=!1,t.data.err?(Go=!0,va[1](t.data.err)):(Mo=!0,va[0]());break;case"init-ep":case"copy-from":case"create":case"configure":case"auth":case"release":case"end-profiling":{let e=Uo.get(t.data.type);t.data.err?e.shift()[1](t.data.err):e.shift()[0](t.data.out);break}case"run":{let e=Uo.get(t.data.type);t.data.err?e.shift()[1](t.data.err):e.shift()[0](t.data.out.concat(t.data.inputsBack));break}}},Ro=typeof document<"u"?document?.currentScript?.src:void 0,Fg=t=>{let e=[];for(var r=0;r<t.length;++r){let n=t[r];null!==n&&e.push(n)}return e},pd=async()=>{if(!Mo){if(Sn)throw new Error("multiple calls to 'initWasm()' detected.");if(Go)throw new Error("previous call to 'initWasm()' failed.");if(Sn=!0,Kt())return void 0===ee.wasm.wasmPaths&&Ro&&0!==Ro.indexOf("blob:")&&(ee.wasm.wasmPaths=Ro.substr(0,+Ro.lastIndexOf("/")+1)),new Promise(((t,e)=>{it?.terminate();let r=URL.createObjectURL(new Blob([cd()],{type:"text/javascript"}));(it=new Worker(r,{name:"ort-wasm-proxy-worker"})).onerror=t=>e(t),it.onmessage=Cg,URL.revokeObjectURL(r),va=[t,e];let n={type:"init-wasm",in:ee};it.postMessage(n)}));try{await jp(ee.wasm),await rd(ee),Mo=!0}catch(t){throw Go=!0,t}finally{Sn=!1}}},dd=async t=>{if(Kt())return ir(),new Promise(((e,r)=>{or("init-ep",[e,r]);let n={type:"init-ep",in:{epName:t,env:ee}};it.postMessage(n)}));await nd(ee,t)},hd=async t=>Kt()?(ir(),new Promise(((e,r)=>{or("copy-from",[e,r]);let n={type:"copy-from",in:{buffer:t}};it.postMessage(n,[t.buffer])}))):xa(t),md=async(t,e)=>{if(Kt()){if(e?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return ir(),new Promise(((r,n)=>{or("create",[r,n]);let i={type:"create",in:{model:t,options:e}},s=[];t instanceof Uint8Array&&s.push(t.buffer),it.postMessage(i,s)}))}return od(t,e)},bd=async t=>{if(Kt())return ir(),new Promise(((e,r)=>{or("release",[e,r]);let n={type:"release",in:t};it.postMessage(n)}));id(t)},gd=async t=>Kt()?(ir(),new Promise(((e,r)=>{or("configure",[e,r]);let n={type:"configure",in:t};it.postMessage(n)}))):ad(t),yd=async t=>Kt()?(ir(),new Promise(((e,r)=>{or("auth",[e,r]);let n={type:"auth",in:t};it.postMessage(n)}))):sd(t),Td=async(t,e,r,n,i,s)=>{if(Kt()){if(r.some((t=>"cpu"!==t[3])))throw new Error("input tensor on GPU is not supported for proxy.");return ir(),new Promise(((o,a)=>{or("run",[o,a]);let u=r,l={type:"run",in:{sessionId:t,inputIndices:e,inputs:u,outputIndices:n,options:s},prealloc:i};it.postMessage(l,wa(u).concat(wa(Fg(i))))}))}return ud(t,e,r,n,i,s).then((t=>t.concat(r)))},xd=async t=>{if(Kt())return ir(),new Promise(((e,r)=>{or("end-profiling",[e,r]);let n={type:"end-profiling",in:t};it.postMessage(n)}));ld(t)}})),wd,vd,zo,_d=D((()=>{_t(),_a(),ya(),Ta(),wd=(t,e)=>{switch(t.location){case"cpu":return[t.type,t.dims,t.data,"cpu"];case"gpu-buffer":return[t.type,t.dims,{gpuBuffer:t.gpuBuffer},"gpu-buffer"];default:throw new Error(`invalid data location: ${t.location} for ${e()}`)}},vd=t=>{switch(t[3]){case"cpu":return new Ne(t[0],t[2],t[1]);case"gpu-buffer":{let e=t[0];if(!No(e))throw new Error(`not supported data type: ${e} for deserializing GPU tensor`);let{gpuBuffer:r,download:n,dispose:i}=t[2];return Ne.fromGpuBuffer(r,{dataType:e,dims:t[1],download:n,dispose:i})}default:throw new Error(`invalid data location: ${t[3]}`)}},zo=class{async fetchModelAndCopyToWasmMemory(t){return hd(await On(t))}async loadModel(t,e){let r;br(),r="string"==typeof t?typeof process<"u"&&process.versions&&process.versions.node?await On(t):await this.fetchModelAndCopyToWasmMemory(t):t,[this.sessionId,this.inputNames,this.outputNames]=await md(r,e),gr()}async dispose(){return bd(this.sessionId)}async configure(t){return gd(t)}async auth(t){return yd(t)}async run(t,e,r){br();let n=[],i=[];Object.entries(t).forEach((t=>{let e=t[0],r=t[1],s=this.inputNames.indexOf(e);if(-1===s)throw new Error(`invalid input '${e}'`);n.push(r),i.push(s)}));let s=[],o=[],a=t=>null!==t&&"gpu-buffer"===t.location?t:null;Object.entries(e).forEach((t=>{let e=t[0],r=t[1],n=this.outputNames.indexOf(e);if(-1===n)throw new Error(`invalid output '${e}'`);s.push(r),o.push(n)}));let u=n.map(((t,e)=>wd(t,(()=>`input "${this.inputNames[i[e]]}"`)))),l=s.map(((t,e)=>t?wd(t,(()=>`output "${this.outputNames[o[e]]}"`)):null)),c=await Td(this.sessionId,i,u,o,l,r),h={},f=[];for(let t=0;t<c.length;t++)t>=o.length?f.push(vd(c[t])):h[this.outputNames[o[t]]]=a(s[t])??vd(c[t]);return f.length>0&&(h.inputBack=f[0]),gr(),h}startProfiling(){}endProfiling(){xd(this.sessionId)}}})),Bg,Wo,Od=D((()=>{_t(),_a(),_d(),Bg=()=>{if(("number"!=typeof ee.wasm.initTimeout||ee.wasm.initTimeout<0)&&(ee.wasm.initTimeout=0),"boolean"!=typeof ee.wasm.simd&&(ee.wasm.simd=!0),"boolean"!=typeof ee.wasm.proxy&&(ee.wasm.proxy=!1),"boolean"!=typeof ee.wasm.trace&&(ee.wasm.trace=!1),"number"!=typeof ee.wasm.numThreads||!Number.isInteger(ee.wasm.numThreads)||ee.wasm.numThreads<=0){(typeof self<"u"&&!self.crossOriginIsolated||typeof process<"u"&&process.versions&&process.versions.node)&&(ee.wasm.numThreads=1);let t=typeof navigator>"u"?(void 0)().length:navigator.hardwareConcurrency;ee.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},Wo=class{async init(t){Bg(),await pd(),await dd(t)}async createInferenceSessionHandler(t,e){let r=new zo;return await r.loadModel(t,e),Promise.resolve(r)}}})),Sd={};pr(Sd,{wasmBackend:()=>$g});var $g,Id=D((()=>{Od(),$g=new Wo}));_t(),_t(),_t();var Is="1.17.0",nS=ei;{let t=(Lp(),jt(Dp)).onnxjsBackend;hr("webgl",t,-10)}{let t=(Id(),jt(Sd)).wasmBackend;hr("cpu",t,10),hr("wasm",t,10),hr("webnn",t,9)}Object.defineProperty(ee.versions,"web",{value:Is,enumerable:!0})}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var r=__webpack_module_cache__[t]={id:t,loaded:!1,exports:{}};return __webpack_modules__[t].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var r in e)__webpack_require__.o(e,r)&&!__webpack_require__.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var __webpack_exports__={};__webpack_require__.d(__webpack_exports__,{o:()=>tsvb_tsvb});var tsvb_utils_lib_namespaceObject={};__webpack_require__.r(tsvb_utils_lib_namespaceObject),__webpack_require__.d(tsvb_utils_lib_namespaceObject,{BaseTextureCache:()=>tsvb_BaseTextureCache,BoundingBox:()=>src_tsvb_BoundingBox,CanvasRenderTarget:()=>tsvb_CanvasRenderTarget,DATA_URI:()=>tsvb_DATA_URI,EventEmitter:()=>tsvb_utils_node_modules_eventemitter3,ProgramCache:()=>tsvb_ProgramCache,TextureCache:()=>tsvb_TextureCache,clearTextureCache:()=>tsvb_clearTextureCache,correctBlendMode:()=>tsvb_correctBlendMode,createIndicesForQuads:()=>tsvb_createIndicesForQuads,decomposeDataUri:()=>tsvb_decomposeDataUri,deprecation:()=>tsvb_deprecation,destroyTextureCache:()=>tsvb_destroyTextureCache,detectVideoAlphaMode:()=>tsvb_detectVideoAlphaMode,determineCrossOrigin:()=>tsvb_determineCrossOrigin,earcut:()=>tsvb_earcut,getBufferType:()=>tsvb_getBufferType,getCanvasBoundingBox:()=>tsvb_getCanvasBoundingBox,getResolutionOfUrl:()=>tsvb_getResolutionOfUrl,hex2rgb:()=>tsvb_hex2rgb,hex2string:()=>tsvb_hex2string,interleaveTypedArrays:()=>tsvb_interleaveTypedArrays,isMobile:()=>tsvb_isMobile_isMobile,isPow2:()=>tsvb_isPow2,isWebGLSupported:()=>tsvb_isWebGLSupported,log2:()=>tsvb_log2,nextPow2:()=>tsvb_nextPow2,path:()=>tsvb_path,premultiplyBlendMode:()=>tsvb_premultiplyBlendMode,premultiplyRgba:()=>tsvb_premultiplyRgba,premultiplyTint:()=>tsvb_premultiplyTint,premultiplyTintToRgba:()=>tsvb_premultiplyTintToRgba,removeItems:()=>tsvb_removeItems,rgb2hex:()=>tsvb_rgb2hex,sayHello:()=>tsvb_sayHello,sign:()=>tsvb_sign,skipHello:()=>tsvb_skipHello,string2hex:()=>tsvb_string2hex,trimCanvas:()=>tsvb_trimCanvas,uid:()=>tsvb_uid,url:()=>tsvb_url_url});var tsvb_pixi_js_lib_namespaceObject={};__webpack_require__.r(tsvb_pixi_js_lib_namespaceObject),__webpack_require__.d(tsvb_pixi_js_lib_namespaceObject,{ALPHA_MODES:()=>tsvb_ALPHA_MODES,AbstractMultiResource:()=>tsvb_AbstractMultiResource,AccessibilityManager:()=>tsvb_AccessibilityManager,AlphaFilter:()=>tsvb_AlphaFilter,AnimatedSprite:()=>tsvb_AnimatedSprite,Application:()=>src_tsvb_Application,ArrayResource:()=>tsvb_ArrayResource,Assets:()=>tsvb_Assets,AssetsClass:()=>tsvb_AssetsClass,Attribute:()=>tsvb_Attribute,BLEND_MODES:()=>tsvb_BLEND_MODES,BUFFER_BITS:()=>tsvb_BUFFER_BITS,BUFFER_TYPE:()=>tsvb_BUFFER_TYPE,BackgroundSystem:()=>tsvb_BackgroundSystem,BaseImageResource:()=>tsvb_BaseImageResource,BasePrepare:()=>src_tsvb_BasePrepare,BaseRenderTexture:()=>tsvb_BaseRenderTexture,BaseTexture:()=>src_tsvb_BaseTexture,BatchDrawCall:()=>tsvb_BatchDrawCall,BatchGeometry:()=>tsvb_BatchGeometry,BatchRenderer:()=>src_tsvb_BatchRenderer,BatchShaderGenerator:()=>tsvb_BatchShaderGenerator,BatchSystem:()=>tsvb_BatchSystem,BatchTextureArray:()=>tsvb_BatchTextureArray,BitmapFont:()=>src_tsvb_BitmapFont,BitmapFontData:()=>tsvb_BitmapFontData,BitmapText:()=>src_tsvb_BitmapText,BlobResource:()=>tsvb_BlobResource,BlurFilter:()=>tsvb_BlurFilter,BlurFilterPass:()=>tsvb_BlurFilterPass,Bounds:()=>tsvb_Bounds,BrowserAdapter:()=>tsvb_BrowserAdapter,Buffer:()=>tsvb_Buffer,BufferResource:()=>tsvb_BufferResource,BufferSystem:()=>tsvb_BufferSystem,CLEAR_MODES:()=>tsvb_CLEAR_MODES,COLOR_MASK_BITS:()=>tsvb_COLOR_MASK_BITS,Cache:()=>tsvb_Cache,CanvasResource:()=>tsvb_CanvasResource,Circle:()=>tsvb_Circle,Color:()=>src_tsvb_Color,ColorMatrixFilter:()=>tsvb_ColorMatrixFilter,CompressedTextureResource:()=>tsvb_CompressedTextureResource,Container:()=>src_tsvb_Container,ContextSystem:()=>tsvb_ContextSystem,CountLimiter:()=>tsvb_CountLimiter,CubeResource:()=>src_tsvb_CubeResource,DEG_TO_RAD:()=>tsvb_DEG_TO_RAD,DRAW_MODES:()=>tsvb_DRAW_MODES,DisplacementFilter:()=>tsvb_DisplacementFilter,DisplayObject:()=>tsvb_DisplayObject,ENV:()=>tsvb_ENV,Ellipse:()=>tsvb_Ellipse,EventBoundary:()=>tsvb_EventBoundary,EventSystem:()=>src_tsvb_EventSystem,ExtensionType:()=>tsvb_ExtensionType,Extract:()=>src_tsvb_Extract,FORMATS:()=>tsvb_FORMATS,FORMATS_TO_COMPONENTS:()=>tsvb_FORMATS_TO_COMPONENTS,FXAAFilter:()=>tsvb_FXAAFilter,FederatedDisplayObject:()=>tsvb_FederatedDisplayObject,FederatedEvent:()=>tsvb_FederatedEvent,FederatedMouseEvent:()=>tsvb_FederatedMouseEvent,FederatedPointerEvent:()=>tsvb_FederatedPointerEvent,FederatedWheelEvent:()=>tsvb_FederatedWheelEvent,FillStyle:()=>tsvb_FillStyle,Filter:()=>src_tsvb_Filter,FilterState:()=>tsvb_FilterState,FilterSystem:()=>tsvb_FilterSystem,Framebuffer:()=>tsvb_Framebuffer,FramebufferSystem:()=>tsvb_FramebufferSystem,GC_MODES:()=>tsvb_GC_MODES,GLFramebuffer:()=>tsvb_GLFramebuffer,GLProgram:()=>tsvb_GLProgram,GLTexture:()=>tsvb_GLTexture,GRAPHICS_CURVES:()=>tsvb_GRAPHICS_CURVES,GenerateTextureSystem:()=>tsvb_GenerateTextureSystem,Geometry:()=>tsvb_Geometry,GeometrySystem:()=>tsvb_GeometrySystem,Graphics:()=>src_tsvb_Graphics,GraphicsData:()=>tsvb_GraphicsData,GraphicsGeometry:()=>src_tsvb_GraphicsGeometry,HTMLText:()=>src_tsvb_HTMLText,HTMLTextStyle:()=>src_tsvb_HTMLTextStyle,IGLUniformData:()=>tsvb_IGLUniformData,INSTALLED:()=>tsvb_INSTALLED,INTERNAL_FORMATS:()=>tsvb_INTERNAL_FORMATS,INTERNAL_FORMAT_TO_BYTES_PER_PIXEL:()=>tsvb_INTERNAL_FORMAT_TO_BYTES_PER_PIXEL,ImageBitmapResource:()=>tsvb_ImageBitmapResource,ImageResource:()=>tsvb_ImageResource,LINE_CAP:()=>tsvb_LINE_CAP,LINE_JOIN:()=>tsvb_LINE_JOIN,LineStyle:()=>tsvb_LineStyle,LoaderParserPriority:()=>tsvb_LoaderParserPriority,MASK_TYPES:()=>tsvb_MASK_TYPES,MIPMAP_MODES:()=>tsvb_MIPMAP_MODES,MSAA_QUALITY:()=>tsvb_MSAA_QUALITY,MaskData:()=>tsvb_MaskData,MaskSystem:()=>tsvb_MaskSystem,Matrix:()=>tsvb_Matrix,Mesh:()=>src_tsvb_Mesh,MeshBatchUvs:()=>tsvb_MeshBatchUvs,MeshGeometry:()=>tsvb_MeshGeometry,MeshMaterial:()=>tsvb_MeshMaterial,MultisampleSystem:()=>tsvb_MultisampleSystem,NineSlicePlane:()=>tsvb_NineSlicePlane,NoiseFilter:()=>tsvb_NoiseFilter,ObjectRenderer:()=>tsvb_ObjectRenderer,ObjectRendererSystem:()=>tsvb_ObjectRendererSystem,ObservablePoint:()=>tsvb_ObservablePoint,PI_2:()=>tsvb_PI_2,PRECISION:()=>tsvb_PRECISION,ParticleContainer:()=>tsvb_ParticleContainer,ParticleRenderer:()=>tsvb_ParticleRenderer,PlaneGeometry:()=>tsvb_PlaneGeometry,PluginSystem:()=>tsvb_PluginSystem,Point:()=>tsvb_Point,Polygon:()=>tsvb_Polygon,Prepare:()=>tsvb_Prepare,Program:()=>src_tsvb_Program,ProjectionSystem:()=>tsvb_ProjectionSystem,Quad:()=>tsvb_Quad,QuadUv:()=>tsvb_QuadUv,RAD_TO_DEG:()=>tsvb_RAD_TO_DEG,RENDERER_TYPE:()=>tsvb_RENDERER_TYPE,Rectangle:()=>tsvb_Rectangle,RenderTexture:()=>tsvb_RenderTexture,RenderTexturePool:()=>tsvb_RenderTexturePool,RenderTextureSystem:()=>tsvb_RenderTextureSystem,Renderer:()=>src_tsvb_Renderer,ResizePlugin:()=>tsvb_ResizePlugin,Resource:()=>tsvb_Resource,RopeGeometry:()=>tsvb_RopeGeometry,RoundedRectangle:()=>tsvb_RoundedRectangle,Runner:()=>tsvb_Runner,SAMPLER_TYPES:()=>tsvb_SAMPLER_TYPES,SCALE_MODES:()=>tsvb_SCALE_MODES,SHAPES:()=>tsvb_SHAPES,SVGResource:()=>src_tsvb_SVGResource,ScissorSystem:()=>src_tsvb_ScissorSystem,Shader:()=>tsvb_Shader,ShaderSystem:()=>tsvb_ShaderSystem,SimpleMesh:()=>tsvb_SimpleMesh,SimplePlane:()=>tsvb_SimplePlane,SimpleRope:()=>tsvb_SimpleRope,Sprite:()=>tsvb_Sprite,SpriteMaskFilter:()=>tsvb_SpriteMaskFilter,Spritesheet:()=>src_tsvb_Spritesheet,StartupSystem:()=>tsvb_StartupSystem,State:()=>tsvb_State,StateSystem:()=>src_tsvb_StateSystem,StencilSystem:()=>tsvb_StencilSystem,SystemManager:()=>tsvb_SystemManager,TARGETS:()=>tsvb_TARGETS,TEXT_GRADIENT:()=>tsvb_TEXT_GRADIENT,TYPES:()=>tsvb_TYPES,TYPES_TO_BYTES_PER_COMPONENT:()=>tsvb_TYPES_TO_BYTES_PER_COMPONENT,TYPES_TO_BYTES_PER_PIXEL:()=>tsvb_TYPES_TO_BYTES_PER_PIXEL,TemporaryDisplayObject:()=>tsvb_TemporaryDisplayObject,Text:()=>src_tsvb_Text,TextFormat:()=>tsvb_TextFormat,TextMetrics:()=>src_tsvb_TextMetrics,TextStyle:()=>src_tsvb_TextStyle,Texture:()=>tsvb_Texture_Texture,TextureGCSystem:()=>src_tsvb_TextureGCSystem,TextureMatrix:()=>tsvb_TextureMatrix,TextureSystem:()=>tsvb_TextureSystem,TextureUvs:()=>tsvb_TextureUvs,Ticker:()=>src_tsvb_Ticker,TickerPlugin:()=>tsvb_TickerPlugin,TilingSprite:()=>tsvb_TilingSprite,TilingSpriteRenderer:()=>tsvb_TilingSpriteRenderer,TimeLimiter:()=>tsvb_TimeLimiter,Transform:()=>src_tsvb_Transform,TransformFeedback:()=>tsvb_TransformFeedback,TransformFeedbackSystem:()=>tsvb_TransformFeedbackSystem,UPDATE_PRIORITY:()=>tsvb_UPDATE_PRIORITY,UniformGroup:()=>tsvb_UniformGroup,VERSION:()=>tsvb_VERSION,VideoResource:()=>src_tsvb_VideoResource,ViewSystem:()=>tsvb_ViewSystem,ViewableBuffer:()=>tsvb_ViewableBuffer,WRAP_MODES:()=>tsvb_WRAP_MODES,XMLFormat:()=>tsvb_XMLFormat,XMLStringFormat:()=>tsvb_XMLStringFormat,accessibleTarget:()=>tsvb_accessibleTarget,autoDetectFormat:()=>tsvb_autoDetectFormat,autoDetectRenderer:()=>tsvb_autoDetectRenderer,autoDetectResource:()=>tsvb_autoDetectResource,cacheTextureArray:()=>tsvb_cacheTextureArray,checkDataUrl:()=>tsvb_checkDataUrl,checkExtension:()=>tsvb_checkExtension,checkMaxIfStatementsInShader:()=>tsvb_checkMaxIfStatementsInShader,convertToList:()=>tsvb_convertToList,copySearchParams:()=>tsvb_copySearchParams,createStringVariations:()=>tsvb_createStringVariations,createTexture:()=>tsvb_createTexture,createUBOElements:()=>tsvb_createUBOElements,curves:()=>tsvb_curves,defaultFilterVertex:()=>tsvb_defaultFilterVertex,defaultVertex:()=>tsvb_fragments_defaultVertex,detectAvif:()=>tsvb_detectAvif,detectCompressedTextures:()=>tsvb_detectCompressedTextures,detectDefaults:()=>tsvb_detectDefaults,detectMp4:()=>tsvb_detectMp4,detectOgv:()=>tsvb_detectOgv,detectWebm:()=>tsvb_detectWebm,detectWebp:()=>tsvb_detectWebp,extensions:()=>tsvb_extensions,filters:()=>tsvb_filters,generateProgram:()=>tsvb_generateProgram,generateUniformBufferSync:()=>tsvb_generateUniformBufferSync,getFontFamilyName:()=>tsvb_getFontFamilyName,getTestContext:()=>tsvb_getTestContext,getUBOData:()=>tsvb_getUBOData,graphicsUtils:()=>tsvb_graphicsUtils,groupD8:()=>tsvb_groupD8,isMobile:()=>tsvb_isMobile_isMobile,isSingleItem:()=>tsvb_isSingleItem,loadBitmapFont:()=>tsvb_loadBitmapFont,loadDDS:()=>tsvb_loadDDS,loadImageBitmap:()=>tsvb_loadImageBitmap,loadJson:()=>tsvb_loadJson,loadKTX:()=>tsvb_loadKTX,loadSVG:()=>tsvb_loadSVG,loadTextures:()=>tsvb_loadTextures,loadTxt:()=>tsvb_loadTxt,loadVideo:()=>tsvb_loadVideo,loadWebFont:()=>tsvb_loadWebFont,parseDDS:()=>tsvb_parseDDS,parseKTX:()=>tsvb_parseKTX,resolveCompressedTextureUrl:()=>tsvb_resolveCompressedTextureUrl,resolveTextureUrl:()=>tsvb_resolveTextureUrl,settings:()=>tsvb_settings,spritesheetAsset:()=>tsvb_spritesheetAsset,uniformParsers:()=>tsvb_uniformParsers,unsafeEvalSupported:()=>tsvb_unsafeEvalSupported,utils:()=>tsvb_utils_lib_namespaceObject});var tsvb_errorBus=__webpack_require__(9672),tsvb_eventemitter3=__webpack_require__(228);const tsvb_node_modules_eventemitter3=null;function src_tsvb_typeof(t){return src_tsvb_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},src_tsvb_typeof(t)}function src_tsvb_regeneratorRuntime(){src_tsvb_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==src_tsvb_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(src_tsvb_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function src_tsvb_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function src_tsvb_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){src_tsvb_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){src_tsvb_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function src_tsvb_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function src_tsvb_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,src_tsvb_toPropertyKey(n.key),n)}}function src_tsvb_createClass(t,e,r){return e&&src_tsvb_defineProperties(t.prototype,e),r&&src_tsvb_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function src_tsvb_toPropertyKey(t){var e=src_tsvb_toPrimitive(t,"string");return"symbol"==src_tsvb_typeof(e)?e:e+""}function src_tsvb_toPrimitive(t,e){if("object"!=src_tsvb_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=src_tsvb_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_callSuper(t,e,r){return e=tsvb_getPrototypeOf(e),tsvb_possibleConstructorReturn(t,tsvb_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_possibleConstructorReturn(t,e){if(e&&("object"==src_tsvb_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_assertThisInitialized(t)}function tsvb_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_isNativeReflectConstruct=function(){return!!t})()}function tsvb_getPrototypeOf(t){return tsvb_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_getPrototypeOf(t)}function tsvb_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_setPrototypeOf(t,e)}function tsvb_setPrototypeOf(t,e){return tsvb_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_setPrototypeOf(t,e)}var src_tsvb_classPrivateFieldSet=function(t,e,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(t,r):i?i.value=r:e.set(t,r),r},src_tsvb_classPrivateFieldGet=function(t,e,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(t):n?n.value:e.get(t)},tsvb_VideoTrack_track,tsvb_VideoTrack_skip,tsvb_VideoTrack_counter,tsvb_VideoTrack=function(t){function e(){var t;return src_tsvb_classCallCheck(this,e),t=tsvb_callSuper(this,e),tsvb_VideoTrack_track.set(t,void 0),tsvb_VideoTrack_skip.set(t,2),tsvb_VideoTrack_counter.set(t,0),t.width=0,t.height=0,t}return tsvb_inherits(e,tsvb_eventemitter3),src_tsvb_createClass(e,[{key:"setSkipCount",value:function(t){src_tsvb_classPrivateFieldSet(this,tsvb_VideoTrack_skip,t,"f")}},{key:"set",value:function(t){var e=this;t instanceof MediaStream?src_tsvb_classPrivateFieldSet(this,tsvb_VideoTrack_track,t.getVideoTracks()[0],"f"):src_tsvb_classPrivateFieldSet(this,tsvb_VideoTrack_track,t,"f"),null!=src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").getSettings().width&&(this.width=src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").getSettings().width),null!=src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").getSettings().height&&(this.height=src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").getSettings().height),src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").onended&&(src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").onended=function(){return e.emit("ended",e)})}},{key:"stop",value:function(){src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f")&&src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").stop()}},{key:"update",value:function(t,e){var r;if(src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f")&&(src_tsvb_classPrivateFieldSet(this,tsvb_VideoTrack_counter,(r=src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_counter,"f"),++r),"f"),!(src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_counter,"f")%src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_skip,"f")))){var n=!1;if(!t&&!e){var i=src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").getSettings();i.width,i.height}this.width!=t&&(n=!0,this.width=t),this.height!=e&&(n=!0,this.height=e),n&&this.emit("update",this)}}},{key:"getSettings",value:function(t){return src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f"),t||(t={width:this.width,height:this.height,aspectRatio:this.width/this.height}),Object.assign(src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").getSettings(),t)}},{key:"getConstraints",value:function(t){return src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f"),t||(t={width:this.width,height:this.height}),Object.assign(src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").getConstraints(),t)}},{key:"getCapabilities",value:function(t){return src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f"),Object.assign(src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").getCapabilities(),t)}},{key:"applyConstraints",value:(r=src_tsvb_asyncToGenerator(src_tsvb_regeneratorRuntime().mark((function t(e){return src_tsvb_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f")){t.next=2;break}return t.abrupt("return");case 2:src_tsvb_classPrivateFieldGet(this,tsvb_VideoTrack_track,"f").applyConstraints(e);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})}]);var r}();function tsvb_utils_typeof(t){return tsvb_utils_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_utils_typeof(t)}function tsvb_utils_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_utils_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_utils_toPropertyKey(n.key),n)}}function tsvb_utils_createClass(t,e,r){return e&&tsvb_utils_defineProperties(t.prototype,e),r&&tsvb_utils_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_utils_toPropertyKey(t){var e=tsvb_utils_toPrimitive(t,"string");return"symbol"==tsvb_utils_typeof(e)?e:e+""}function tsvb_utils_toPrimitive(t,e){if("object"!=tsvb_utils_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_utils_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}tsvb_VideoTrack_track=new WeakMap,tsvb_VideoTrack_skip=new WeakMap,tsvb_VideoTrack_counter=new WeakMap;var tsvb_FrameTimer=function(){return tsvb_utils_createClass((function t(){tsvb_utils_classCallCheck(this,t),this.frame_count=30,this.frames=[1]}),[{key:"start",value:function(){this.t0=performance.now()}},{key:"finish",value:function(){var t=performance.now()-this.t0;this.frames.push(t),this.frames.length>this.frame_count&&this.frames.shift()}},{key:"getFrameFps",value:function(){var t=this.frames.reduce((function(t,e){return t+e}),0);return 0==t||isNaN(t)?1:Math.round(1e3/(t/this.frame_count))}},{key:"getFrameDuration",value:function(){return Math.round(1e6/this.getFrameFps())}},{key:"getFrameTime",value:function(){return Math.round(this.frames.reduce((function(t,e){return t+e}),0)/this.frame_count)}}])}(),tsvb_FrameStatistics=function(){return tsvb_utils_createClass((function t(){tsvb_utils_classCallCheck(this,t),this.pattern="Output FPS: {{output_fps}}\nFrame Draw Time: {{frame_time}}ms\nInference Time: {{inference_time}}ms",this.stats=new Map}),[{key:"updateStats",value:function(t,e){return this.stats.set(t,e),!0}},{key:"getText",value:function(){var t=this.pattern;return this.stats.forEach((function(e,r){t=t.replaceAll("{{"+r+"}}",e.toString())})),t}}])}();function tsvb_stream_processor_typeof(t){return tsvb_stream_processor_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_stream_processor_typeof(t)}function tsvb_stream_processor_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_stream_processor_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_stream_processor_toPropertyKey(n.key),n)}}function tsvb_stream_processor_createClass(t,e,r){return e&&tsvb_stream_processor_defineProperties(t.prototype,e),r&&tsvb_stream_processor_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_stream_processor_toPropertyKey(t){var e=tsvb_stream_processor_toPrimitive(t,"string");return"symbol"==tsvb_stream_processor_typeof(e)?e:e+""}function tsvb_stream_processor_toPrimitive(t,e){if("object"!=tsvb_stream_processor_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_stream_processor_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_StreamProcessor=function(){return tsvb_stream_processor_createClass((function t(e){tsvb_stream_processor_classCallCheck(this,t),this.video=null,this.stream=null,this.videoTrack=null,this.audioTrack=null,this.transformFrame=null,this.updateVideoTrack=null,this.toCanvas=null,this.lastFrameTime=0,this.fpsLimit=30,this.timestamp=0,this.isRunning=!1,this.isPaused=!1,this.sdkOptions=e,this.outputCanvas=document.createElement("canvas"),this.outputCanvas.width=this.sdkOptions.width,this.outputCanvas.height=this.sdkOptions.height,this.bufferCanvas=document.createElement("canvas"),this.bufferCanvas.width=this.sdkOptions.width,this.bufferCanvas.height=this.sdkOptions.height,this.frameTimer=new tsvb_FrameTimer,this.frameTime=0,this.fps=0,this.enableFps=!1,this.frame_count=0,this.videoTrackWrapper=new tsvb_VideoTrack,this.videoTrackWrapper.on("update",this.onTrackUpdate,this)}),[{key:"onTrackUpdate",value:function(){this.sdkOptions.setSize(this.videoTrackWrapper.width,this.videoTrackWrapper.height),"function"==typeof this.changeInputResolutionFuncition&&this.changeInputResolutionFuncition()}},{key:"clearBuffers",value:function(){}},{key:"onChangeInputResolution",value:function(t){var e="function"==typeof t;this.changeInputResolutionFuncition=e?t:void 0}},{key:"onFrameDraw",value:function(t){var e="function"==typeof t;this.frameDrawFunction=e?t:void 0}},{key:"setOutputResolution",value:function(t,e){this.sdkOptions.setCustomSize(t,e)}},{key:"clearOutputResolution",value:function(){this.sdkOptions.customSize=!1,this.sdkOptions.setSize(this.videoTrackWrapper.width,this.videoTrackWrapper.height)}},{key:"useEffectProcessor",value:function(t){this.effectProcessor=t}},{key:"pause",value:function(){this.isPaused=!0}},{key:"unpause",value:function(){this.isPaused=!1}},{key:"setRenderer",value:function(t){this.renderer=t}},{key:"destroy",value:function(){this.videoTrackWrapper.off("update",this.onTrackUpdate,this)}},{key:"setFpsLimit",value:function(t){var e;this.fpsLimit=t,null===(e=this.getInputVideoTrack())||void 0===e||e.applyConstraints({frameRate:this.fpsLimit})}},{key:"useStream",value:function(t){this.stream=t,this.useVideoTrack(this.stream.getVideoTracks()[0])}},{key:"useVideoTrack",value:function(t){this.videoTrack=t,this.videoTrackWrapper.set(this.videoTrack)}},{key:"getInputStream",value:function(){return this.stream?this.stream:null}},{key:"getInputVideoTrack",value:function(){return this.videoTrack?this.videoTrack:null}},{key:"showFps",value:function(){this.enableFps=!0}},{key:"hideFps",value:function(){this.enableFps=!1,this.renderer.hideStatistics()}},{key:"drawFps",value:function(){this.enableFps&&this.frame_count%30==0&&(this.renderer.updateStatistics("output_fps",this.frameTimer.getFrameFps()),this.renderer.drawStatistics())}},{key:"process",value:function(){this.transformFrame&&this.transformFrame()}},{key:"clearTransformCallback",value:function(){this.transformFrame=null}},{key:"transformCallback",value:function(t){this.transformFrame=t}},{key:"renderToCanvas",value:function(t){this.toCanvas=t}},{key:"getCanvas",value:function(){return this.outputCanvas}},{key:"getStream",value:function(){return this.stream}}])}(),tsvb_ENV=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(tsvb_ENV||{}),tsvb_RENDERER_TYPE=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(tsvb_RENDERER_TYPE||{}),tsvb_BUFFER_BITS=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(tsvb_BUFFER_BITS||{}),tsvb_BLEND_MODES=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(tsvb_BLEND_MODES||{}),tsvb_DRAW_MODES=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(tsvb_DRAW_MODES||{}),tsvb_FORMATS=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(tsvb_FORMATS||{}),tsvb_TARGETS=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(tsvb_TARGETS||{}),tsvb_TYPES=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(tsvb_TYPES||{}),tsvb_SAMPLER_TYPES=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(tsvb_SAMPLER_TYPES||{}),tsvb_SCALE_MODES=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(tsvb_SCALE_MODES||{}),tsvb_WRAP_MODES=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(tsvb_WRAP_MODES||{}),tsvb_MIPMAP_MODES=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(tsvb_MIPMAP_MODES||{}),tsvb_ALPHA_MODES=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(tsvb_ALPHA_MODES||{}),tsvb_CLEAR_MODES=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(tsvb_CLEAR_MODES||{}),tsvb_GC_MODES=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(tsvb_GC_MODES||{}),tsvb_PRECISION=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(tsvb_PRECISION||{}),tsvb_MASK_TYPES=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(tsvb_MASK_TYPES||{}),tsvb_COLOR_MASK_BITS=(t=>(t[t.RED=1]="RED",t[t.GREEN=2]="GREEN",t[t.BLUE=4]="BLUE",t[t.ALPHA=8]="ALPHA",t))(tsvb_COLOR_MASK_BITS||{}),tsvb_MSAA_QUALITY=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(tsvb_MSAA_QUALITY||{}),tsvb_BUFFER_TYPE=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(tsvb_BUFFER_TYPE||{});const tsvb_BrowserAdapter={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},tsvb_settings={ADAPTER:tsvb_BrowserAdapter,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var tsvb_appleIphone=/iPhone/i,tsvb_appleIpod=/iPod/i,tsvb_appleTablet=/iPad/i,tsvb_appleUniversal=/\biOS-universal(?:.+)Mac\b/i,tsvb_androidPhone=/\bAndroid(?:.+)Mobile\b/i,tsvb_androidTablet=/Android/i,tsvb_amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,tsvb_amazonTablet=/Silk/i,tsvb_windowsPhone=/Windows Phone/i,tsvb_windowsTablet=/\bWindows(?:.+)ARM\b/i,tsvb_otherBlackBerry=/BlackBerry/i,tsvb_otherBlackBerry10=/BB10/i,tsvb_otherOpera=/Opera Mini/i,tsvb_otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,tsvb_otherFirefox=/Mobile(?:.+)Firefox\b/i,tsvb_isAppleTabletOnIos13=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function tsvb_createMatch(t){return function(e){return e.test(t)}}function tsvb_isMobile(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,n=r.split("[FBAN");void 0!==n[1]&&(r=n[0]),void 0!==(n=r.split("Twitter"))[1]&&(r=n[0]);var i=tsvb_createMatch(r),s={apple:{phone:i(tsvb_appleIphone)&&!i(tsvb_windowsPhone),ipod:i(tsvb_appleIpod),tablet:!i(tsvb_appleIphone)&&(i(tsvb_appleTablet)||tsvb_isAppleTabletOnIos13(e))&&!i(tsvb_windowsPhone),universal:i(tsvb_appleUniversal),device:(i(tsvb_appleIphone)||i(tsvb_appleIpod)||i(tsvb_appleTablet)||i(tsvb_appleUniversal)||tsvb_isAppleTabletOnIos13(e))&&!i(tsvb_windowsPhone)},amazon:{phone:i(tsvb_amazonPhone),tablet:!i(tsvb_amazonPhone)&&i(tsvb_amazonTablet),device:i(tsvb_amazonPhone)||i(tsvb_amazonTablet)},android:{phone:!i(tsvb_windowsPhone)&&i(tsvb_amazonPhone)||!i(tsvb_windowsPhone)&&i(tsvb_androidPhone),tablet:!i(tsvb_windowsPhone)&&!i(tsvb_amazonPhone)&&!i(tsvb_androidPhone)&&(i(tsvb_amazonTablet)||i(tsvb_androidTablet)),device:!i(tsvb_windowsPhone)&&(i(tsvb_amazonPhone)||i(tsvb_amazonTablet)||i(tsvb_androidPhone)||i(tsvb_androidTablet))||i(/\bokhttp\b/i)},windows:{phone:i(tsvb_windowsPhone),tablet:i(tsvb_windowsTablet),device:i(tsvb_windowsPhone)||i(tsvb_windowsTablet)},other:{blackberry:i(tsvb_otherBlackBerry),blackberry10:i(tsvb_otherBlackBerry10),opera:i(tsvb_otherOpera),firefox:i(tsvb_otherFirefox),chrome:i(tsvb_otherChrome),device:i(tsvb_otherBlackBerry)||i(tsvb_otherBlackBerry10)||i(tsvb_otherOpera)||i(tsvb_otherFirefox)||i(tsvb_otherChrome)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const tsvb_isMobileCall=tsvb_isMobile.default??tsvb_isMobile,tsvb_isMobile_isMobile=tsvb_isMobileCall(globalThis.navigator);tsvb_settings.RETINA_PREFIX=/@([0-9\.]+)x/,tsvb_settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var tsvb_utils_node_modules_eventemitter3=__webpack_require__(9452),tsvb_earcut=__webpack_require__(6570),tsvb_url=__webpack_require__(8835);const tsvb_warnings={};function tsvb_deprecation(t,e,r=3){if(tsvb_warnings[e])return;let n=(new Error).stack;typeof n>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(n=n.split("\n").splice(r).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(n))),tsvb_warnings[e]=!0}const tsvb_url_url={get parse(){return tsvb_deprecation("7.3.0","utils.url.parse is deprecated, use native URL API instead."),tsvb_url.qg},get format(){return tsvb_deprecation("7.3.0","utils.url.format is deprecated, use native URL API instead."),tsvb_url.GP},get resolve(){return tsvb_deprecation("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),tsvb_url.hd}};function tsvb_assertPath(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function tsvb_removeUrlParams(t){return t.split("?")[0].split("#")[0]}function tsvb_escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function tsvb_replaceAll(t,e,r){return t.replace(new RegExp(tsvb_escapeRegExp(e),"g"),r)}function tsvb_normalizeStringPosix(t,e){let r="",n=0,i=-1,s=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(i!==a-1&&1!==s)if(i!==a-1&&2===s){if(r.length<2||2!==n||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){const t=r.lastIndexOf("/");if(t!==r.length-1){-1===t?(r="",n=0):(r=r.slice(0,t),n=r.length-1-r.lastIndexOf("/")),i=a,s=0;continue}}else if(2===r.length||1===r.length){r="",n=0,i=a,s=0;continue}e&&(r.length>0?r+="/..":r="..",n=2)}else r.length>0?r+=`/${t.slice(i+1,a)}`:r=t.slice(i+1,a),n=a-i-1;i=a,s=0}else 46===o&&-1!==s?++s:s=-1}return r}const tsvb_path={toPosix:t=>tsvb_replaceAll(t,"\\","/"),isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),isBlobUrl:t=>t.startsWith("blob:"),hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){tsvb_assertPath(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const r=/^[^/:]+:\/{0,2}/.exec(t);return r?r[0]:""},toAbsolute(t,e,r){if(tsvb_assertPath(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const n=tsvb_removeUrlParams(this.toPosix(e??tsvb_settings.ADAPTER.getBaseUrl())),i=tsvb_removeUrlParams(this.toPosix(r??this.rootname(n)));return(t=this.toPosix(t)).startsWith("/")?tsvb_path.join(i,t.slice(1)):this.isAbsolute(t)?t:this.join(n,t)},normalize(t){if(tsvb_assertPath(t),0===t.length)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;let e="";const r=(t=this.toPosix(t)).startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const n=t.endsWith("/");return(t=tsvb_normalizeStringPosix(t,!1)).length>0&&n&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return tsvb_assertPath(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let r=0;r<t.length;++r){const n=t[r];if(tsvb_assertPath(n),n.length>0)if(void 0===e)e=n;else{const i=t[r-1]??"";this.joinExtensions.includes(this.extname(i).toLowerCase())?e+=`/../${n}`:e+=`/${n}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(tsvb_assertPath(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const r=47===e;let n=-1,i=!0;const s=this.getProtocol(t),o=t;for(let r=(t=t.slice(s.length)).length-1;r>=1;--r)if(e=t.charCodeAt(r),47===e){if(!i){n=r;break}}else i=!1;return-1===n?r?"/":this.isUrl(o)?s+t:s:r&&1===n?"//":s+t.slice(0,n)},rootname(t){tsvb_assertPath(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);e=-1!==r?t.slice(0,r):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){tsvb_assertPath(t),e&&tsvb_assertPath(e),t=tsvb_removeUrlParams(this.toPosix(t));let r,n=0,i=-1,s=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(r=t.length-1;r>=0;--r){const u=t.charCodeAt(r);if(47===u){if(!s){n=r+1;break}}else-1===a&&(s=!1,a=r+1),o>=0&&(u===e.charCodeAt(o)?-1==--o&&(i=r):(o=-1,i=a))}return n===i?i=a:-1===i&&(i=t.length),t.slice(n,i)}for(r=t.length-1;r>=0;--r)if(47===t.charCodeAt(r)){if(!s){n=r+1;break}}else-1===i&&(s=!1,i=r+1);return-1===i?"":t.slice(n,i)},extname(t){tsvb_assertPath(t);let e=-1,r=0,n=-1,i=!0,s=0;for(let o=(t=tsvb_removeUrlParams(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===n&&(i=!1,n=o+1),46===a?-1===e?e=o:1!==s&&(s=1):-1!==e&&(s=-1);else if(!i){r=o+1;break}}return-1===e||-1===n||0===s||1===s&&e===n-1&&e===r+1?"":t.slice(e,n)},parse(t){tsvb_assertPath(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let r=(t=tsvb_removeUrlParams(this.toPosix(t))).charCodeAt(0);const n=this.isAbsolute(t);let i;e.root=this.rootname(t),i=n||this.hasProtocol(t)?1:0;let s=-1,o=0,a=-1,u=!0,l=t.length-1,c=0;for(;l>=i;--l)if(r=t.charCodeAt(l),47!==r)-1===a&&(u=!1,a=l+1),46===r?-1===s?s=l:1!==c&&(c=1):-1!==s&&(c=-1);else if(!u){o=l+1;break}return-1===s||-1===a||0===c||1===c&&s===a-1&&s===o+1?-1!==a&&(e.base=e.name=0===o&&n?t.slice(1,a):t.slice(o,a)):(0===o&&n?(e.name=t.slice(1,s),e.base=t.slice(1,a)):(e.name=t.slice(o,s),e.base=t.slice(o,a)),e.ext=t.slice(s,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":",joinExtensions:[".html"]};let tsvb_promise,tsvb_supported;async function tsvb_detectVideoAlphaMode(){return tsvb_promise??(tsvb_promise=(async()=>{const t=document.createElement("canvas").getContext("webgl");if(!t)return tsvb_ALPHA_MODES.UNPACK;const e=await new Promise((t=>{const e=document.createElement("video");e.onloadeddata=()=>t(e),e.onerror=()=>t(null),e.autoplay=!1,e.crossOrigin="anonymous",e.preload="auto",e.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",e.load()}));if(!e)return tsvb_ALPHA_MODES.UNPACK;const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const i=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,i),t.deleteFramebuffer(n),t.deleteTexture(r),t.getExtension("WEBGL_lose_context")?.loseContext(),i[0]<=i[3]?tsvb_ALPHA_MODES.PMA:tsvb_ALPHA_MODES.UNPACK})()),tsvb_promise}function tsvb_skipHello(){tsvb_deprecation("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function tsvb_sayHello(){tsvb_deprecation("7.0.0",'sayHello is deprecated, please use Renderer\'s "hello" option')}function tsvb_isWebGLSupported(){return typeof tsvb_supported>"u"&&(tsvb_supported=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:tsvb_settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!tsvb_settings.ADAPTER.getWebGLRenderingContext())return!1;const e=tsvb_settings.ADAPTER.createCanvas();let r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const n=!!r?.getContextAttributes()?.stencil;if(r){const t=r.getExtension("WEBGL_lose_context");t&&t.loseContext()}return r=null,n}catch{return!1}}()),tsvb_supported}var tsvb_r={grad:.9,turn:360,rad:360/(2*Math.PI)},tsvb_t=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},tsvb_n=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},tsvb_e=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),t>r?r:t>e?t:e},tsvb_u=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},tsvb_a=function(t){return{r:tsvb_e(t.r,0,255),g:tsvb_e(t.g,0,255),b:tsvb_e(t.b,0,255),a:tsvb_e(t.a)}},tsvb_o=function(t){return{r:tsvb_n(t.r),g:tsvb_n(t.g),b:tsvb_n(t.b),a:tsvb_n(t.a,3)}},tsvb_i=/^#([0-9a-f]{3,8})$/i,tsvb_s=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},tsvb_h=function(t){var e=t.r,r=t.g,n=t.b,i=t.a,s=Math.max(e,r,n),o=s-Math.min(e,r,n),a=o?s===e?(r-n)/o:s===r?2+(n-e)/o:4+(e-r)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:i}},tsvb_b=function(t){var e=t.h,r=t.s,n=t.v,i=t.a;e=e/360*6,r/=100,n/=100;var s=Math.floor(e),o=n*(1-r),a=n*(1-(e-s)*r),u=n*(1-(1-e+s)*r),l=s%6;return{r:255*[n,a,o,o,u,n][l],g:255*[u,n,n,a,o,o][l],b:255*[o,o,u,n,n,a][l],a:i}},tsvb_g=function(t){return{h:tsvb_u(t.h),s:tsvb_e(t.s,0,100),l:tsvb_e(t.l,0,100),a:tsvb_e(t.a)}},tsvb_d=function(t){return{h:tsvb_n(t.h),s:tsvb_n(t.s),l:tsvb_n(t.l),a:tsvb_n(t.a,3)}},tsvb_f=function(t){return tsvb_b((r=(e=t).s,{h:e.h,s:(r*=((n=e.l)<50?n:100-n)/100)>0?2*r/(n+r)*100:0,v:n+r,a:e.a}));var e,r,n},tsvb_c=function(t){return{h:(e=tsvb_h(t)).h,s:(i=(200-(r=e.s))*(n=e.v)/100)>0&&i<200?r*n/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,r,n,i},tsvb_l=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,tsvb_p=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,tsvb_v=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,tsvb_m=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,tsvb_y={string:[[function(t){var e=tsvb_i.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?tsvb_n(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?tsvb_n(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=tsvb_v.exec(t)||tsvb_m.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:tsvb_a({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=tsvb_l.exec(t)||tsvb_p.exec(t);if(!e)return null;var r,n,i=tsvb_g({h:(r=e[1],n=e[2],void 0===n&&(n="deg"),Number(r)*(tsvb_r[n]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return tsvb_f(i)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,n=t.b,i=t.a,s=void 0===i?1:i;return tsvb_t(e)&&tsvb_t(r)&&tsvb_t(n)?tsvb_a({r:Number(e),g:Number(r),b:Number(n),a:Number(s)}):null},"rgb"],[function(t){var e=t.h,r=t.s,n=t.l,i=t.a,s=void 0===i?1:i;if(!tsvb_t(e)||!tsvb_t(r)||!tsvb_t(n))return null;var o=tsvb_g({h:Number(e),s:Number(r),l:Number(n),a:Number(s)});return tsvb_f(o)},"hsl"],[function(t){var e=t.h,r=t.s,n=t.v,i=t.a,s=void 0===i?1:i;if(!tsvb_t(e)||!tsvb_t(r)||!tsvb_t(n))return null;var o=function(t){return{h:tsvb_u(t.h),s:tsvb_e(t.s,0,100),v:tsvb_e(t.v,0,100),a:tsvb_e(t.a)}}({h:Number(e),s:Number(r),v:Number(n),a:Number(s)});return tsvb_b(o)},"hsv"]]},tsvb_N=function(t,e){for(var r=0;r<e.length;r++){var n=e[r][0](t);if(n)return[n,e[r][1]]}return[null,void 0]},tsvb_x=function(t){return"string"==typeof t?tsvb_N(t.trim(),tsvb_y.string):"object"==typeof t&&null!==t?tsvb_N(t,tsvb_y.object):[null,void 0]},tsvb_I=function(t){return tsvb_x(t)[1]},tsvb_M=function(t,e){var r=tsvb_c(t);return{h:r.h,s:tsvb_e(r.s+100*e,0,100),l:r.l,a:r.a}},tsvb_H=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},tsvb_$=function(t,e){var r=tsvb_c(t);return{h:r.h,s:r.s,l:tsvb_e(r.l+100*e,0,100),a:r.a}},tsvb_j=function(){function t(t){this.parsed=tsvb_x(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return tsvb_n(tsvb_H(this.rgba),2)},t.prototype.isDark=function(){return tsvb_H(this.rgba)<.5},t.prototype.isLight=function(){return tsvb_H(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=tsvb_o(this.rgba)).r,r=t.g,n=t.b,s=(i=t.a)<1?tsvb_s(tsvb_n(255*i)):"","#"+tsvb_s(e)+tsvb_s(r)+tsvb_s(n)+s;var t,e,r,n,i,s},t.prototype.toRgb=function(){return tsvb_o(this.rgba)},t.prototype.toRgbString=function(){return e=(t=tsvb_o(this.rgba)).r,r=t.g,n=t.b,(i=t.a)<1?"rgba("+e+", "+r+", "+n+", "+i+")":"rgb("+e+", "+r+", "+n+")";var t,e,r,n,i},t.prototype.toHsl=function(){return tsvb_d(tsvb_c(this.rgba))},t.prototype.toHslString=function(){return e=(t=tsvb_d(tsvb_c(this.rgba))).h,r=t.s,n=t.l,(i=t.a)<1?"hsla("+e+", "+r+"%, "+n+"%, "+i+")":"hsl("+e+", "+r+"%, "+n+"%)";var t,e,r,n,i},t.prototype.toHsv=function(){return t=tsvb_h(this.rgba),{h:tsvb_n(t.h),s:tsvb_n(t.s),v:tsvb_n(t.v),a:tsvb_n(t.a,3)};var t},t.prototype.invert=function(){return tsvb_w({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),tsvb_w(tsvb_M(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),tsvb_w(tsvb_M(this.rgba,-t))},t.prototype.grayscale=function(){return tsvb_w(tsvb_M(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),tsvb_w(tsvb_$(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),tsvb_w(tsvb_$(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?tsvb_w({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):tsvb_n(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=tsvb_c(this.rgba);return"number"==typeof t?tsvb_w({h:t,s:e.s,l:e.l,a:e.a}):tsvb_n(e.h)},t.prototype.isEqual=function(t){return this.toHex()===tsvb_w(t).toHex()},t}(),tsvb_w=function(t){return t instanceof tsvb_j?t:new tsvb_j(t)},tsvb_S=[],tsvb_k=function(t){t.forEach((function(t){tsvb_S.indexOf(t)<0&&(t(tsvb_j,tsvb_y),tsvb_S.push(t))}))},tsvb_E=function(){return new tsvb_j({r:255*Math.random(),g:255*Math.random(),b:255*Math.random()})};function tsvb_names(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var i in r)n[r[i]]=i;var s={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var i,o,a=n[this.toHex()];if(a)return a;if(null==e?void 0:e.closest){var u=this.toRgb(),l=1/0,c="black";if(!s.length)for(var h in r)s[h]=new t(r[h]).toRgb();for(var f in r){var d=(i=u,o=s[f],Math.pow(i.r-o.r,2)+Math.pow(i.g-o.g,2)+Math.pow(i.b-o.b,2));d<l&&(l=d,c=f)}return c}},e.string.push([function(e){var n=e.toLowerCase(),i="transparent"===n?"#0000":r[n];return i?new t(i).toRgb():null},"name"])}tsvb_k([tsvb_names]);const tsvb_Color=class t{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(e){if(e instanceof t)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(null===e)throw new Error("Cannot set PIXI.Color#value to null");(null===this._value||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if("number"===r||"string"===r||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,r)=>t===e[r]));if(null!==t&&null!==e){const r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every((r=>t[r]===e[r]))}return t===e}toRgba(){const[t,e,r,n]=this._components;return{r:t,g:e,b:r,a:n}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,n]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*r),t[2]=Math.round(255*n),t}toRgbArray(t){t=t??[];const[e,r,n]=this._components;return t[0]=e,t[1]=r,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(e){const[r,n,i,s]=t.temp.setValue(e)._components;return this._components[0]*=r,this._components[1]*=n,this._components[2]*=i,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let r=this._int>>16&255,n=this._int>>8&255,i=255&this._int;return e&&(r=r*t+.5|0,n=n*t+.5|0,i=i*t+.5|0),(255*t<<24)+(r<<16)+(n<<8)+i}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,n,i]=this._components;return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}normalize(e){let r,n,i,s;if(("number"==typeof e||e instanceof Number)&&e>=0&&e<=16777215){r=(e>>16&255)/255,n=(e>>8&255)/255,i=(255&e)/255,s=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[r,n,i,s=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[r,n,i,s=255]=e,r/=255,n/=255,i/=255,s/=255;else if("string"==typeof e||"object"==typeof e){if("string"==typeof e){const r=t.HEX_PATTERN.exec(e);r&&(e=`#${r[2]}`)}const o=tsvb_w(e);o.isValid()&&(({r,g:n,b:i,a:s}=o.rgba),r/=255,n/=255,i/=255)}if(void 0===r)throw new Error(`Unable to convert color ${e}`);this._components[0]=r,this._components[1]=n,this._components[2]=i,this._components[3]=s,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*r|0)}_clamp(t,e=0,r=1){return"number"==typeof t?Math.min(Math.max(t,e),r):(t.forEach(((n,i)=>{t[i]=Math.min(Math.max(n,e),r)})),t)}};tsvb_Color.shared=new tsvb_Color,tsvb_Color.temp=new tsvb_Color,tsvb_Color.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let src_tsvb_Color=tsvb_Color;function tsvb_hex2rgb(t,e=[]){return tsvb_deprecation("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),src_tsvb_Color.shared.setValue(t).toRgbArray(e)}function tsvb_hex2string(t){return tsvb_deprecation("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),src_tsvb_Color.shared.setValue(t).toHex()}function tsvb_string2hex(t){return tsvb_deprecation("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),src_tsvb_Color.shared.setValue(t).toNumber()}function tsvb_rgb2hex(t){return tsvb_deprecation("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),src_tsvb_Color.shared.setValue(t).toNumber()}function tsvb_mapPremultipliedBlendModes(){const t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[tsvb_BLEND_MODES.NORMAL_NPM]=tsvb_BLEND_MODES.NORMAL,t[tsvb_BLEND_MODES.ADD_NPM]=tsvb_BLEND_MODES.ADD,t[tsvb_BLEND_MODES.SCREEN_NPM]=tsvb_BLEND_MODES.SCREEN,e[tsvb_BLEND_MODES.NORMAL]=tsvb_BLEND_MODES.NORMAL_NPM,e[tsvb_BLEND_MODES.ADD]=tsvb_BLEND_MODES.ADD_NPM,e[tsvb_BLEND_MODES.SCREEN]=tsvb_BLEND_MODES.SCREEN_NPM;const r=[];return r.push(e),r.push(t),r}const tsvb_premultiplyBlendMode=tsvb_mapPremultipliedBlendModes();function tsvb_correctBlendMode(t,e){return tsvb_premultiplyBlendMode[e?1:0][t]}function tsvb_premultiplyRgba(t,e,r,n=!0){return tsvb_deprecation("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),src_tsvb_Color.shared.setValue(t).premultiply(e,n).toArray(r??new Float32Array(4))}function tsvb_premultiplyTint(t,e){return tsvb_deprecation("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),src_tsvb_Color.shared.setValue(t).toPremultiplied(e)}function tsvb_premultiplyTintToRgba(t,e,r,n=!0){return tsvb_deprecation("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),src_tsvb_Color.shared.setValue(t).premultiply(e,n).toArray(r??new Float32Array(4))}const tsvb_DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function tsvb_createIndicesForQuads(t,e=null){const r=6*t;if((e=e||new Uint16Array(r)).length!==r)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${r}`);for(let t=0,n=0;t<r;t+=6,n+=4)e[t+0]=n+0,e[t+1]=n+1,e[t+2]=n+2,e[t+3]=n+0,e[t+4]=n+2,e[t+5]=n+3;return e}function tsvb_getBufferType(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}const tsvb_map={Float32Array,Uint32Array,Int32Array,Uint8Array};function tsvb_interleaveTypedArrays(t,e){let r=0,n=0;const i={};for(let i=0;i<t.length;i++)n+=e[i],r+=t[i].length;const s=new ArrayBuffer(4*r);let o=null,a=0;for(let r=0;r<t.length;r++){const u=e[r],l=t[r],c=tsvb_getBufferType(l);i[c]||(i[c]=new tsvb_map[c](s)),o=i[c];for(let t=0;t<l.length;t++){o[(t/u|0)*n+a+t%u]=l[t]}a+=u}return new Float32Array(s)}function tsvb_nextPow2(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function tsvb_isPow2(t){return!(t&t-1||!t)}function tsvb_log2(t){let e=(t>65535?1:0)<<4,r=((t>>>=e)>255?1:0)<<3;return e|=r,r=((t>>>=r)>15?1:0)<<2,e|=r,r=((t>>>=r)>3?1:0)<<1,e|=r,e|(t>>>=r)>>1}function tsvb_removeItems(t,e,r){const n=t.length;let i;if(e>=n||0===r)return;const s=n-(r=e+r>n?n-e:r);for(i=e;i<s;++i)t[i]=t[i+r];t.length=s}function tsvb_sign(t){return 0===t?0:t<0?-1:1}let tsvb_nextUid=0;function tsvb_uid(){return++tsvb_nextUid}const tsvb_BoundingBox=class{constructor(t,e,r,n){this.left=t,this.top=e,this.right=r,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};tsvb_BoundingBox.EMPTY=new tsvb_BoundingBox(0,0,0,0);let src_tsvb_BoundingBox=tsvb_BoundingBox;const tsvb_ProgramCache={},tsvb_TextureCache=Object.create(null),tsvb_BaseTextureCache=Object.create(null);function tsvb_destroyTextureCache(){let t;for(t in tsvb_TextureCache)tsvb_TextureCache[t].destroy();for(t in tsvb_BaseTextureCache)tsvb_BaseTextureCache[t].destroy()}function tsvb_clearTextureCache(){let t;for(t in tsvb_TextureCache)delete tsvb_TextureCache[t];for(t in tsvb_BaseTextureCache)delete tsvb_BaseTextureCache[t]}class tsvb_CanvasRenderTarget{constructor(t,e,r){this._canvas=tsvb_settings.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||tsvb_settings.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function tsvb_checkRow(t,e,r){for(let n=0,i=4*r*e;n<e;++n,i+=4)if(0!==t[i+3])return!1;return!0}function tsvb_checkColumn(t,e,r,n,i){const s=4*e;for(let e=n,o=n*s+4*r;e<=i;++e,o+=s)if(0!==t[o+3])return!1;return!0}function tsvb_getCanvasBoundingBox(t){const{width:e,height:r}=t,n=t.getContext("2d",{willReadFrequently:!0});if(null===n)throw new TypeError("Failed to get canvas 2D context");const i=n.getImageData(0,0,e,r).data;let s=0,o=0,a=e-1,u=r-1;for(;o<r&&tsvb_checkRow(i,e,o);)++o;if(o===r)return src_tsvb_BoundingBox.EMPTY;for(;tsvb_checkRow(i,e,u);)--u;for(;tsvb_checkColumn(i,e,s,o,u);)++s;for(;tsvb_checkColumn(i,e,a,o,u);)--a;return++a,++u,new src_tsvb_BoundingBox(s,o,a,u)}function tsvb_trimCanvas(t){const e=tsvb_getCanvasBoundingBox(t),{width:r,height:n}=e;let i=null;if(!e.isEmpty()){const s=t.getContext("2d");if(null===s)throw new TypeError("Failed to get canvas 2D context");i=s.getImageData(e.left,e.top,r,n)}return{width:r,height:n,data:i}}function tsvb_decomposeDataUri(t){const e=tsvb_DATA_URI.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}function tsvb_determineCrossOrigin(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location;const r=new URL(t,document.baseURI);return r.hostname!==e.hostname||r.port!==e.port||r.protocol!==e.protocol?"anonymous":""}function tsvb_getResolutionOfUrl(t,e=1){const r=tsvb_settings.RETINA_PREFIX?.exec(t);return r?parseFloat(r[1]):e}var tsvb_ExtensionType=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(tsvb_ExtensionType||{});const tsvb_normalizeExtension=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},tsvb_normalizePriority=(t,e)=>tsvb_normalizeExtension(t).priority??e,tsvb_extensions={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(tsvb_normalizeExtension).forEach((t=>{t.type.forEach((e=>this._removeHandlers[e]?.(t)))})),this},add(...t){return t.map(tsvb_normalizeExtension).forEach((t=>{t.type.forEach((e=>{const r=this._addHandlers,n=this._queue;r[e]?r[e]?.(t):(n[e]=n[e]||[],n[e]?.push(t))}))})),this},handle(t,e,r){const n=this._addHandlers,i=this._removeHandlers;if(n[t]||i[t])throw new Error(`Extension type ${t} already has a handler`);n[t]=e,i[t]=r;const s=this._queue;return s[t]&&(s[t]?.forEach((t=>e(t))),delete s[t]),this},handleByMap(t,e){return this.handle(t,(t=>{t.name&&(e[t.name]=t.ref)}),(t=>{t.name&&delete e[t.name]}))},handleByList(t,e,r=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>tsvb_normalizePriority(e,r)-tsvb_normalizePriority(t,r))))}),(t=>{const r=e.indexOf(t.ref);-1!==r&&e.splice(r,1)}))}};class tsvb_ViewableBuffer{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const tsvb_fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function tsvb_generateIfTestSrc(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}function tsvb_checkMaxIfStatementsInShader(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);for(;;){const n=tsvb_fragTemplate.replace(/%forloop%/gi,tsvb_generateIfTestSrc(t));if(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}const tsvb_BLEND=0,tsvb_OFFSET=1,tsvb_CULLING=2,tsvb_DEPTH_TEST=3,tsvb_WINDING=4,tsvb_DEPTH_MASK=5;class tsvb_State{constructor(){this.data=0,this.blendMode=tsvb_BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<tsvb_BLEND)}set blend(t){!!(this.data&1<<tsvb_BLEND)!==t&&(this.data^=1<<tsvb_BLEND)}get offsets(){return!!(this.data&1<<tsvb_OFFSET)}set offsets(t){!!(this.data&1<<tsvb_OFFSET)!==t&&(this.data^=1<<tsvb_OFFSET)}get culling(){return!!(this.data&1<<tsvb_CULLING)}set culling(t){!!(this.data&1<<tsvb_CULLING)!==t&&(this.data^=1<<tsvb_CULLING)}get depthTest(){return!!(this.data&1<<tsvb_DEPTH_TEST)}set depthTest(t){!!(this.data&1<<tsvb_DEPTH_TEST)!==t&&(this.data^=1<<tsvb_DEPTH_TEST)}get depthMask(){return!!(this.data&1<<tsvb_DEPTH_MASK)}set depthMask(t){!!(this.data&1<<tsvb_DEPTH_MASK)!==t&&(this.data^=1<<tsvb_DEPTH_MASK)}get clockwiseFrontFace(){return!!(this.data&1<<tsvb_WINDING)}set clockwiseFrontFace(t){!!(this.data&1<<tsvb_WINDING)!==t&&(this.data^=1<<tsvb_WINDING)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==tsvb_BLEND_MODES.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new tsvb_State;return t.depthTest=!1,t.blend=!0,t}}tsvb_State.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const tsvb_INSTALLED=[];function tsvb_autoDetectResource(t,e){if(!t)return null;let r="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(r=e[1].toLowerCase())}for(let n=tsvb_INSTALLED.length-1;n>=0;--n){const i=tsvb_INSTALLED[n];if(i.test&&i.test(t,r))return new i(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class tsvb_Runner{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,n,i,s,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:u,items:l}=this;this._aliasCount++;for(let c=0,h=l.length;c<h;c++)l[c][u](t,e,r,n,i,s,o,a);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(tsvb_Runner.prototype,{dispatch:{value:tsvb_Runner.prototype.emit},run:{value:tsvb_Runner.prototype.emit}});class tsvb_Resource{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new tsvb_Runner("setRealSize"),this.onUpdate=new tsvb_Runner("update"),this.onError=new tsvb_Runner("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class tsvb_BufferResource extends tsvb_Resource{constructor(t,e){const{width:r,height:n}=e||{};if(!r||!n)throw new Error("BufferResource width or height invalid");super(r,n),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===tsvb_ALPHA_MODES.UNPACK);const i=e.realWidth,s=e.realHeight;return r.width===i&&r.height===s?n.texSubImage2D(e.target,0,0,0,i,s,e.format,r.type,this.data):(r.width=i,r.height=s,n.texImage2D(e.target,0,r.internalFormat,i,s,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return null===t||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const tsvb_defaultBufferOptions={scaleMode:tsvb_SCALE_MODES.NEAREST,alphaMode:tsvb_ALPHA_MODES.NPM},tsvb_BaseTexture=class t extends tsvb_utils_node_modules_eventemitter3{constructor(e=null,r=null){super(),r=Object.assign({},t.defaultOptions,r);const{alphaMode:n,mipmap:i,anisotropicLevel:s,scaleMode:o,width:a,height:u,wrapMode:l,format:c,type:h,target:f,resolution:d,resourceOptions:p}=r;e&&!(e instanceof tsvb_Resource)&&((e=tsvb_autoDetectResource(e,p)).internal=!0),this.resolution=d||tsvb_settings.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((u||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=o,this.format=c,this.type=h,this.target=f,this.alphaMode=n,this.uid=tsvb_uid(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&u>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=tsvb_isPow2(this.realWidth)&&tsvb_isPow2(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete tsvb_BaseTextureCache[this.cacheId],delete tsvb_TextureCache[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,r,n=tsvb_settings.STRICT_TEXTURE_CACHE){const i="string"==typeof e;let s=null;if(i)s=e;else{if(!e._pixiId){const t=r?.pixiIdPrefix||"pixiid";e._pixiId=`${t}_${tsvb_uid()}`}s=e._pixiId}let o=tsvb_BaseTextureCache[s];if(i&&n&&!o)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return o||(o=new t(e,r),o.cacheId=s,t.addToCache(o,s)),o}static fromBuffer(e,r,n,i){e=e||new Float32Array(r*n*4);const s=new tsvb_BufferResource(e,{width:r,height:n,...i?.resourceOptions});let o,a;return e instanceof Float32Array?(o=tsvb_FORMATS.RGBA,a=tsvb_TYPES.FLOAT):e instanceof Int32Array?(o=tsvb_FORMATS.RGBA_INTEGER,a=tsvb_TYPES.INT):e instanceof Uint32Array?(o=tsvb_FORMATS.RGBA_INTEGER,a=tsvb_TYPES.UNSIGNED_INT):e instanceof Int16Array?(o=tsvb_FORMATS.RGBA_INTEGER,a=tsvb_TYPES.SHORT):e instanceof Uint16Array?(o=tsvb_FORMATS.RGBA_INTEGER,a=tsvb_TYPES.UNSIGNED_SHORT):e instanceof Int8Array?(o=tsvb_FORMATS.RGBA,a=tsvb_TYPES.BYTE):(o=tsvb_FORMATS.RGBA,a=tsvb_TYPES.UNSIGNED_BYTE),s.internal=!0,new t(s,Object.assign({},tsvb_defaultBufferOptions,{type:a,format:o},i))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),tsvb_BaseTextureCache[e]&&tsvb_BaseTextureCache[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),tsvb_BaseTextureCache[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=tsvb_BaseTextureCache[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete tsvb_BaseTextureCache[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete tsvb_BaseTextureCache[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};tsvb_BaseTexture.defaultOptions={mipmap:tsvb_MIPMAP_MODES.POW2,anisotropicLevel:0,scaleMode:tsvb_SCALE_MODES.LINEAR,wrapMode:tsvb_WRAP_MODES.CLAMP,alphaMode:tsvb_ALPHA_MODES.UNPACK,target:tsvb_TARGETS.TEXTURE_2D,format:tsvb_FORMATS.RGBA,type:tsvb_TYPES.UNSIGNED_BYTE},tsvb_BaseTexture._globalBatch=0;let src_tsvb_BaseTexture=tsvb_BaseTexture;class tsvb_BatchDrawCall{constructor(){this.texArray=null,this.blend=0,this.type=tsvb_DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}}let tsvb_UID=0;class tsvb_Buffer{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=tsvb_UID++,this.disposeRunner=new tsvb_Runner("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?tsvb_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:tsvb_BUFFER_TYPE.ARRAY_BUFFER}get index(){return this.type===tsvb_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new tsvb_Buffer(t)}}class tsvb_Attribute{constructor(t,e=0,r=!1,n=tsvb_TYPES.FLOAT,i,s,o,a=1){this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=i,this.start=s,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,r,n,i){return new tsvb_Attribute(t,e,r,n,i)}}const tsvb_interleaveTypedArrays_map={Float32Array,Uint32Array,Int32Array,Uint8Array};function tsvb_interleaveTypedArrays_interleaveTypedArrays(t,e){let r=0,n=0;const i={};for(let i=0;i<t.length;i++)n+=e[i],r+=t[i].length;const s=new ArrayBuffer(4*r);let o=null,a=0;for(let r=0;r<t.length;r++){const u=e[r],l=t[r],c=tsvb_getBufferType(l);i[c]||(i[c]=new tsvb_interleaveTypedArrays_map[c](s)),o=i[c];for(let t=0;t<l.length;t++){o[(t/u|0)*n+a+t%u]=l[t]}a+=u}return new Float32Array(s)}const tsvb_byteSizeMap={5126:4,5123:2,5121:1};let tsvb_Geometry_UID=0;const tsvb_Geometry_map={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class tsvb_Geometry{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=tsvb_Geometry_UID++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new tsvb_Runner("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,n=!1,i,s,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof tsvb_Buffer||(e instanceof Array&&(e=new Float32Array(e)),e=new tsvb_Buffer(e));const u=t.split("|");if(u.length>1){for(let t=0;t<u.length;t++)this.addAttribute(u[t],e,r,n,i);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new tsvb_Attribute(l,r,n,i,s,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof tsvb_Buffer||(t instanceof Array&&(t=new Uint16Array(t)),t=new tsvb_Buffer(t)),t.type=tsvb_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],r=new tsvb_Buffer;let n;for(n in this.attributes){const r=this.attributes[n],i=this.buffers[r.buffer];t.push(i.data),e.push(r.size*tsvb_byteSizeMap[r.type]/4),r.buffer=0}for(r.data=tsvb_interleaveTypedArrays_interleaveTypedArrays(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new tsvb_Geometry;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new tsvb_Buffer(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new tsvb_Attribute(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=tsvb_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new tsvb_Geometry,r=[],n=[],i=[];let s;for(let e=0;e<t.length;e++){s=t[e];for(let t=0;t<s.buffers.length;t++)n[t]=n[t]||0,n[t]+=s.buffers[t].data.length,i[t]=0}for(let t=0;t<s.buffers.length;t++)r[t]=new(tsvb_Geometry_map[tsvb_getBufferType(s.buffers[t].data)])(n[t]),e.buffers[t]=new tsvb_Buffer(r[t]);for(let e=0;e<t.length;e++){s=t[e];for(let t=0;t<s.buffers.length;t++)r[t].set(s.buffers[t].data,i[t]),i[t]+=s.buffers[t].data.length}if(e.attributes=s.attributes,s.indexBuffer){e.indexBuffer=e.buffers[s.buffers.indexOf(s.indexBuffer)],e.indexBuffer.type=tsvb_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;let r=0,n=0,i=0,o=0;for(let t=0;t<s.buffers.length;t++)if(s.buffers[t]!==s.indexBuffer){o=t;break}for(const t in s.attributes){const e=s.attributes[t];(0|e.buffer)===o&&(n+=e.size*tsvb_byteSizeMap[e.type]/4)}for(let s=0;s<t.length;s++){const a=t[s].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+i]+=r;r+=t[s].buffers[o].data.length/n,i+=a.length}}return e}}class tsvb_BatchGeometry extends tsvb_Geometry{constructor(t=!1){super(),this._buffer=new tsvb_Buffer(null,t,!1),this._indexBuffer=new tsvb_Buffer(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,tsvb_TYPES.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,tsvb_TYPES.FLOAT).addAttribute("aColor",this._buffer,4,!0,tsvb_TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,tsvb_TYPES.FLOAT).addIndex(this._indexBuffer)}}const tsvb_PI_2=2*Math.PI,tsvb_RAD_TO_DEG=180/Math.PI,tsvb_DEG_TO_RAD=Math.PI/180;var tsvb_SHAPES=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(tsvb_SHAPES||{});class tsvb_Point{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new tsvb_Point(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}tsvb_Point.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const tsvb_tempPoints=[new tsvb_Point,new tsvb_Point,new tsvb_Point,new tsvb_Point];class tsvb_Rectangle{constructor(t=0,e=0,r=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n),this.type=tsvb_SHAPES.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new tsvb_Rectangle(0,0,0,0)}clone(){return new tsvb_Rectangle(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const r=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>r}const r=this.left,n=this.right,i=this.top,s=this.bottom;if(n<=r||s<=i)return!1;const o=tsvb_tempPoints[0].set(t.left,t.top),a=tsvb_tempPoints[1].set(t.left,t.bottom),u=tsvb_tempPoints[2].set(t.right,t.top),l=tsvb_tempPoints[3].set(t.right,t.bottom);if(u.x<=o.x||a.y<=o.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(0===c||(e.apply(o,o),e.apply(a,a),e.apply(u,u),e.apply(l,l),Math.max(o.x,a.x,u.x,l.x)<=r||Math.min(o.x,a.x,u.x,l.x)>=n||Math.max(o.y,a.y,u.y,l.y)<=i||Math.min(o.y,a.y,u.y,l.y)>=s))return!1;const h=c*(a.y-o.y),f=c*(o.x-a.x),d=h*r+f*i,p=h*n+f*i,v=h*r+f*s,y=h*n+f*s;if(Math.max(d,p,v,y)<=h*o.x+f*o.y||Math.min(d,p,v,y)>=h*l.x+f*l.y)return!1;const b=c*(o.y-u.y),_=c*(u.x-o.x),m=b*r+_*i,g=b*n+_*i,w=b*r+_*s,x=b*n+_*s;return!(Math.max(m,g,w,x)<=b*o.x+_*o.y||Math.min(m,g,w,x)>=b*l.x+_*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),i=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(i-n,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=i-n,this}}tsvb_Rectangle.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class tsvb_Circle{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=tsvb_SHAPES.CIRC}clone(){return new tsvb_Circle(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-t,i=this.y-e;return n*=n,i*=i,n+i<=r}getBounds(){return new tsvb_Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}tsvb_Circle.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class tsvb_Ellipse{constructor(t=0,e=0,r=0,n=0){this.x=t,this.y=e,this.width=r,this.height=n,this.type=tsvb_SHAPES.ELIP}clone(){return new tsvb_Ellipse(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,n=(e-this.y)/this.height;return r*=r,n*=n,r+n<=1}getBounds(){return new tsvb_Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)}}tsvb_Ellipse.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class tsvb_Polygon{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let r=0,n=e.length;r<n;r++)t.push(e[r].x,e[r].y);e=t}this.points=e,this.type=tsvb_SHAPES.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new tsvb_Polygon(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const n=this.points.length/2;for(let i=0,s=n-1;i<n;s=i++){const n=this.points[2*i],o=this.points[2*i+1],a=this.points[2*s],u=this.points[2*s+1];o>e!=u>e&&t<(e-o)/(u-o)*(a-n)+n&&(r=!r)}return r}}tsvb_Polygon.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`};class tsvb_RoundedRectangle{constructor(t=0,e=0,r=0,n=0,i=20){this.x=t,this.y=e,this.width=r,this.height=n,this.radius=i,this.type=tsvb_SHAPES.RREC}clone(){return new tsvb_RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let n=t-(this.x+r),i=e-(this.y+r);const s=r*r;if(n*n+i*i<=s||(n=t-(this.x+this.width-r),n*n+i*i<=s)||(i=e-(this.y+this.height-r),n*n+i*i<=s)||(n=t-(this.x+r),n*n+i*i<=s))return!0}return!1}}tsvb_RoundedRectangle.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class tsvb_Matrix{constructor(t=1,e=0,r=0,n=1,i=0,s=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=s}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,n,i,s){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=s,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new tsvb_Point;const r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e}applyInverse(t,e){e=e||new tsvb_Point;const r=1/(this.a*this.d+this.c*-this.b),n=t.x,i=t.y;return e.x=this.d*r*n+-this.c*r*i+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*i+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.a,i=this.c,s=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=i*e-this.d*r,this.d=i*r+this.d*e,this.tx=s*e-this.ty*r,this.ty=s*r+this.ty*e,this}append(t){const e=this.a,r=this.b,n=this.c,i=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*i,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*i,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*i+this.ty,this}setTransform(t,e,r,n,i,s,o,a,u){return this.a=Math.cos(o+u)*i,this.b=Math.sin(o+u)*i,this.c=-Math.sin(o-a)*s,this.d=Math.cos(o-a)*s,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,r=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,n=this.c,i=this.d,s=t.pivot,o=-Math.atan2(-n,i),a=Math.atan2(r,e),u=Math.abs(o+a);return u<1e-5||Math.abs(tsvb_PI_2-u)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+i*i),t.position.x=this.tx+(s.x*e+s.y*n),t.position.y=this.ty+(s.x*r+s.y*i),t}invert(){const t=this.a,e=this.b,r=this.c,n=this.d,i=this.tx,s=t*n-e*r;return this.a=n/s,this.b=-e/s,this.c=-r/s,this.d=t/s,this.tx=(r*this.ty-n*i)/s,this.ty=-(t*this.ty-e*i)/s,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new tsvb_Matrix;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new tsvb_Matrix}static get TEMP_MATRIX(){return new tsvb_Matrix}}tsvb_Matrix.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const tsvb_ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],tsvb_uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],tsvb_vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],tsvb_vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],tsvb_rotationCayley=[],tsvb_rotationMatrices=[],tsvb_signum=Math.sign;function tsvb_init(){for(let t=0;t<16;t++){const e=[];tsvb_rotationCayley.push(e);for(let r=0;r<16;r++){const n=tsvb_signum(tsvb_ux[t]*tsvb_ux[r]+tsvb_vx[t]*tsvb_uy[r]),i=tsvb_signum(tsvb_uy[t]*tsvb_ux[r]+tsvb_vy[t]*tsvb_uy[r]),s=tsvb_signum(tsvb_ux[t]*tsvb_vx[r]+tsvb_vx[t]*tsvb_vy[r]),o=tsvb_signum(tsvb_uy[t]*tsvb_vx[r]+tsvb_vy[t]*tsvb_vy[r]);for(let t=0;t<16;t++)if(tsvb_ux[t]===n&&tsvb_uy[t]===i&&tsvb_vx[t]===s&&tsvb_vy[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new tsvb_Matrix;e.set(tsvb_ux[t],tsvb_uy[t],tsvb_vx[t],tsvb_vy[t],0,0),tsvb_rotationMatrices.push(e)}}tsvb_init();const tsvb_groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>tsvb_ux[t],uY:t=>tsvb_uy[t],vX:t=>tsvb_vx[t],vY:t=>tsvb_vy[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>tsvb_rotationCayley[t][e],sub:(t,e)=>tsvb_rotationCayley[t][tsvb_groupD8.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?tsvb_groupD8.S:tsvb_groupD8.N:2*Math.abs(e)<=Math.abs(t)?t>0?tsvb_groupD8.E:tsvb_groupD8.W:e>0?t>0?tsvb_groupD8.SE:tsvb_groupD8.SW:t>0?tsvb_groupD8.NE:tsvb_groupD8.NW,matrixAppendRotationInv:(t,e,r=0,n=0)=>{const i=tsvb_rotationMatrices[tsvb_groupD8.inv(e)];i.tx=r,i.ty=n,t.append(i)}};class tsvb_ObservablePoint{constructor(t,e,r=0,n=0){this._x=r,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new tsvb_ObservablePoint(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}tsvb_ObservablePoint.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const tsvb_Transform=class{constructor(){this.worldTransform=new tsvb_Matrix,this.localTransform=new tsvb_Matrix,this.position=new tsvb_ObservablePoint(this.onChange,this,0,0),this.scale=new tsvb_ObservablePoint(this.onChange,this,1,1),this.pivot=new tsvb_ObservablePoint(this.onChange,this,0,0),this.skew=new tsvb_ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const r=t.worldTransform,n=this.worldTransform;n.a=e.a*r.a+e.b*r.c,n.b=e.a*r.b+e.b*r.d,n.c=e.c*r.a+e.d*r.c,n.d=e.c*r.b+e.d*r.d,n.tx=e.tx*r.a+e.ty*r.c+r.tx,n.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};tsvb_Transform.IDENTITY=new tsvb_Transform;let src_tsvb_Transform=tsvb_Transform;src_tsvb_Transform.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var tsvb_defaultFragment="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}",tsvb_defaultVertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n";const tsvb_uniformParsers=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],tsvb_GLSL_TO_SINGLE_SETTERS_CACHED={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},tsvb_GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function tsvb_generateUniformsSync(t,e){const r=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const n in t.uniforms){const i=e[n];if(!i){!0===t.uniforms[n]?.group&&(t.uniforms[n].ubo?r.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');\n                    `):r.push(`\n                        renderer.shader.syncUniformGroup(uv.${n}, syncData);\n                    `));continue}const s=t.uniforms[n];let o=!1;for(let t=0;t<tsvb_uniformParsers.length;t++)if(tsvb_uniformParsers[t].test(i,s)){r.push(tsvb_uniformParsers[t].code(n,s)),o=!0;break}if(!o){const t=(1!==i.size||i.isArray?tsvb_GLSL_TO_ARRAY_SETTERS:tsvb_GLSL_TO_SINGLE_SETTERS_CACHED)[i.type].replace("location",`ud["${n}"].location`);r.push(`\n            cu = ud["${n}"];\n            cv = cu.value;\n            v = uv["${n}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",r.join("\n"))}const tsvb_unknownContext={};let tsvb_context=tsvb_unknownContext,tsvb_maxFragmentPrecision;function tsvb_getTestContext(){if(tsvb_context===tsvb_unknownContext||tsvb_context?.isContextLost()){const t=tsvb_settings.ADAPTER.createCanvas();let e;tsvb_settings.PREFER_ENV>=tsvb_ENV.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),tsvb_context=e}return tsvb_context}function tsvb_getMaxFragmentPrecision(){if(!tsvb_maxFragmentPrecision){tsvb_maxFragmentPrecision=tsvb_PRECISION.MEDIUM;const t=tsvb_getTestContext();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);e&&(tsvb_maxFragmentPrecision=e.precision?tsvb_PRECISION.HIGH:tsvb_PRECISION.MEDIUM)}}return tsvb_maxFragmentPrecision}const tsvb_GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function tsvb_mapSize(t){return tsvb_GLSL_TO_SIZE[t]}let tsvb_GL_TABLE=null;const tsvb_GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function tsvb_mapType(t,e){if(!tsvb_GL_TABLE){const e=Object.keys(tsvb_GL_TO_GLSL_TYPES);tsvb_GL_TABLE={};for(let r=0;r<e.length;++r){const n=e[r];tsvb_GL_TABLE[t[n]]=tsvb_GL_TO_GLSL_TYPES[n]}}return tsvb_GL_TABLE[e]}function tsvb_setPrecision(t,e,r){if("precision"!==t.substring(0,9)){let n=e;return e===tsvb_PRECISION.HIGH&&r!==tsvb_PRECISION.HIGH&&(n=tsvb_PRECISION.MEDIUM),`precision ${n} float;\n${t}`}return r!==tsvb_PRECISION.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let tsvb_Program_UID=0;const tsvb_nameCache={},tsvb_Program=class t{constructor(e,r,n="pixi-shader",i={}){this.extra={},this.id=tsvb_Program_UID++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=r||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),tsvb_nameCache[n]?(tsvb_nameCache[n]++,n+=`-${tsvb_nameCache[n]}`):tsvb_nameCache[n]=1,this.vertexSrc=`#define SHADER_NAME ${n}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${n}\n${this.fragmentSrc}`,this.vertexSrc=tsvb_setPrecision(this.vertexSrc,t.defaultVertexPrecision,tsvb_PRECISION.HIGH),this.fragmentSrc=tsvb_setPrecision(this.fragmentSrc,t.defaultFragmentPrecision,tsvb_getMaxFragmentPrecision())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return tsvb_defaultVertex}static get defaultFragmentSrc(){return tsvb_defaultFragment}static from(e,r,n){const i=e+r;let s=tsvb_ProgramCache[i];return s||(tsvb_ProgramCache[i]=s=new t(e,r,n)),s}};tsvb_Program.defaultVertexPrecision=tsvb_PRECISION.HIGH,tsvb_Program.defaultFragmentPrecision=tsvb_isMobile_isMobile.apple.device?tsvb_PRECISION.HIGH:tsvb_PRECISION.MEDIUM;let src_tsvb_Program=tsvb_Program,tsvb_UniformGroup_UID=0;class tsvb_UniformGroup{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=tsvb_UniformGroup_UID++,this.static=!!e,this.ubo=!!r,t instanceof tsvb_Buffer?(this.buffer=t,this.buffer.type=tsvb_BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new tsvb_Buffer(new Float32Array(1)),this.buffer.type=tsvb_BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new tsvb_UniformGroup(e,r)}static from(t,e,r){return new tsvb_UniformGroup(t,e,r)}static uboFrom(t,e){return new tsvb_UniformGroup(t,e??!0,!0)}}class tsvb_Shader{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof tsvb_UniformGroup?e:new tsvb_UniformGroup(e):new tsvb_UniformGroup({}),this.disposeRunner=new tsvb_Runner("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const n=e.uniforms[r];if(!0===n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const n=src_tsvb_Program.from(t,e);return new tsvb_Shader(n,r)}}class tsvb_BatchShaderGenerator{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=tsvb_UniformGroup.from({uSamplers:e},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new src_tsvb_Program(this.vertexSrc,r)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new tsvb_Matrix,default:this.defaultGroupCache[t]};return new tsvb_Shader(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${r}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class tsvb_BatchTextureArray{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function tsvb_canUploadSameBuffer(){return!tsvb_isMobile_isMobile.apple.device}function tsvb_maxRecommendedTextures(t){let e=!0;const r=tsvb_settings.ADAPTER.getNavigator();if(tsvb_isMobile_isMobile.tablet||tsvb_isMobile_isMobile.phone){if(tsvb_isMobile_isMobile.apple.device){const t=r.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(tsvb_isMobile_isMobile.android.device){const t=r.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}class tsvb_ObjectRenderer{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var tsvb_texture_frag_defaultFragment="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",tsvb_texture_vert_defaultVertex="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n";const tsvb_BatchRenderer=class t extends tsvb_ObjectRenderer{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=tsvb_BatchGeometry,this.vertexSize=6,this.state=tsvb_State.for2d(),this.size=4*t.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??tsvb_maxRecommendedTextures(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??tsvb_canUploadSameBuffer(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return tsvb_deprecation("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return tsvb_texture_vert_defaultVertex}static get defaultFragmentTemplate(){return tsvb_texture_frag_defaultFragment}setShaderGenerator({vertex:e=t.defaultVertexSrc,fragment:r=t.defaultFragmentTemplate}={}){this.shaderGenerator=new tsvb_BatchShaderGenerator(e,r)}contextChange(){const e=this.renderer.gl;tsvb_settings.PREFER_ENV===tsvb_ENV.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),t.defaultMaxTextures),this.maxTextures=tsvb_checkMaxIfStatementsInShader(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:r}=t,n=this.size/4,i=Math.floor(n/this.maxTextures)+1;for(;e.length<n;)e.push(new tsvb_BatchDrawCall);for(;r.length<i;)r.push(new tsvb_BatchTextureArray);for(let t=0;t<this.maxTextures;t++)this._tempBoundTextures[t]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:r}=this,n=t._textureArrayPool,i=this.renderer.batch,s=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++src_tsvb_BaseTexture._globalBatch,u=0,l=n[0],c=0;i.copyBoundTextures(s,r);for(let t=0;t<this._bufferSize;++t){const h=e[t];e[t]=null,h._batchEnabled!==a&&(l.count>=r&&(i.boundArray(l,s,a,r),this.buildDrawCalls(l,c,t),c=t,l=n[++u],++a),h._batchEnabled=a,h.touched=o,l.elements[l.count++]=h)}l.count>0&&(i.boundArray(l,s,a,r),this.buildDrawCalls(l,c,this._bufferSize),++u,++a);for(let t=0;t<s.length;t++)s[t]=null;src_tsvb_BaseTexture._globalBatch=a}buildDrawCalls(e,r,n){const{_bufferedElements:i,_attributeBuffer:s,_indexBuffer:o,vertexSize:a}=this,u=t._drawCallPool;let l=this._dcIndex,c=this._aIndex,h=this._iIndex,f=u[l];f.start=this._iIndex,f.texArray=e;for(let t=r;t<n;++t){const n=i[t],d=n._texture.baseTexture,p=tsvb_premultiplyBlendMode[d.alphaMode?1:0][n.blendMode];i[t]=null,r<t&&f.blend!==p&&(f.size=h-f.start,r=t,f=u[++l],f.texArray=e,f.start=h),this.packInterleavedGeometry(n,s,o,c,h),c+=n.vertexData.length/2*a,h+=n.indices.length,f.blend=p}r<n&&(f.size=h-f.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=h}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:r,_indexBuffer:n}=this;t.canUploadSameBuffer?(e[this._flushId]._buffer.update(r.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(r.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:r,state:n}=this.renderer,i=t._drawCallPool;let s=null;for(let t=0;t<e;t++){const{texArray:e,type:o,size:a,start:u,blend:l}=i[t];s!==e&&(s=e,this.bindAndClearTexArray(e)),this.state.blendMode=l,n.set(this.state),r.drawElements(o,a,r.UNSIGNED_SHORT,2*u)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),t.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=tsvb_nextPow2(Math.ceil(t/8)),r=tsvb_log2(e),n=8*e;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let i=this._aBuffers[n];return i||(this._aBuffers[n]=i=new tsvb_ViewableBuffer(n*this.vertexSize*4)),i}getIndexBuffer(t){const e=tsvb_nextPow2(Math.ceil(t/12)),r=tsvb_log2(e),n=12*e;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let i=this._iBuffers[r];return i||(this._iBuffers[r]=i=new Uint16Array(n)),i}packInterleavedGeometry(t,e,r,n,i){const{uint32View:s,float32View:o}=e,a=n/this.vertexSize,u=t.uvs,l=t.indices,c=t.vertexData,h=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),d=src_tsvb_Color.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let t=0;t<c.length;t+=2)o[n++]=c[t],o[n++]=c[t+1],o[n++]=u[t],o[n++]=u[t+1],s[n++]=d,o[n++]=h;for(let t=0;t<l.length;t++)r[i++]=a+l[t]}};tsvb_BatchRenderer.defaultBatchSize=4096,tsvb_BatchRenderer.extension={name:"batch",type:tsvb_ExtensionType.RendererPlugin},tsvb_BatchRenderer._drawCallPool=[],tsvb_BatchRenderer._textureArrayPool=[];let src_tsvb_BatchRenderer=tsvb_BatchRenderer;tsvb_extensions.add(src_tsvb_BatchRenderer);var tsvb_defaultFilter_frag_defaultFragment="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n",tsvb_defaultFilter_vert_defaultVertex="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";const tsvb_Filter=class t extends tsvb_Shader{constructor(e,r,n){super(src_tsvb_Program.from(e||t.defaultVertexSrc,r||t.defaultFragmentSrc),n),this.padding=0,this.resolution=t.defaultResolution,this.multisample=t.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new tsvb_State}apply(t,e,r,n,i){t.applyFilter(this,e,r,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return tsvb_defaultFilter_vert_defaultVertex}static get defaultFragmentSrc(){return tsvb_defaultFilter_frag_defaultFragment}};tsvb_Filter.defaultResolution=1,tsvb_Filter.defaultMultisample=tsvb_MSAA_QUALITY.NONE;let src_tsvb_Filter=tsvb_Filter;class tsvb_BackgroundSystem{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new src_tsvb_Color(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:n}=t,i=r??e;void 0!==i&&(this.color=i),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}tsvb_BackgroundSystem.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},tsvb_BackgroundSystem.extension={type:[tsvb_ExtensionType.RendererSystem,tsvb_ExtensionType.CanvasRendererSystem],name:"background"},tsvb_extensions.add(tsvb_BackgroundSystem);class tsvb_BatchSystem{constructor(t){this.renderer=t,this.emptyRenderer=new tsvb_ObjectRenderer(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,r,n){const{elements:i,ids:s,count:o}=t;let a=0;for(let t=0;t<o;t++){const o=i[t],u=o._batchLocation;if(u>=0&&u<n&&e[u]===o)s[t]=u;else for(;a<n;){const n=e[a];if(!n||n._batchEnabled!==r||n._batchLocation!==a){s[t]=a,o._batchLocation=a,e[a]=o;break}a++}}}destroy(){this.renderer=null}}tsvb_BatchSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"batch"},tsvb_extensions.add(tsvb_BatchSystem);let tsvb_CONTEXT_UID_COUNTER=0;class tsvb_ContextSystem{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=tsvb_CONTEXT_UID_COUNTER++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=tsvb_CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(tsvb_settings.PREFER_ENV>=tsvb_ENV.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}tsvb_ContextSystem.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},tsvb_ContextSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"context"},tsvb_extensions.add(tsvb_ContextSystem);class tsvb_Framebuffer{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new tsvb_Runner("disposeFramebuffer"),this.multisample=tsvb_MSAA_QUALITY.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new src_tsvb_BaseTexture(null,{scaleMode:tsvb_SCALE_MODES.NEAREST,resolution:1,mipmap:tsvb_MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new src_tsvb_BaseTexture(null,{scaleMode:tsvb_SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:tsvb_MIPMAP_MODES.OFF,format:tsvb_FORMATS.DEPTH_COMPONENT,type:tsvb_TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const n=this.colorTextures[r],i=n.resolution;n.setSize(t/i,e/i)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class tsvb_BaseRenderTexture extends src_tsvb_BaseTexture{constructor(t={}){if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=tsvb_MSAA_QUALITY.NONE),super(null,t),this.mipmap=tsvb_MIPMAP_MODES.OFF,this.valid=!0,this._clear=new src_tsvb_Color([0,0,0,0]),this.framebuffer=new tsvb_Framebuffer(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class tsvb_BaseImageResource extends tsvb_Resource{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.displayWidth||e.width,e.naturalHeight||e.videoHeight||e.displayHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){void 0!==r||e.startsWith("data:")?!1!==r&&(t.crossOrigin="string"==typeof r?r:"anonymous"):t.crossOrigin=tsvb_determineCrossOrigin(e)}upload(t,e,r,n){const i=t.gl,s=e.realWidth,o=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||0===n.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===tsvb_ALPHA_MODES.UNPACK),this.noSubImage||e.target!==i.TEXTURE_2D||r.width!==s||r.height!==o?(r.width=s,r.height=o,i.texImage2D(e.target,0,r.internalFormat,e.format,r.type,n)):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e.format,r.type,n),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class tsvb_ImageResource extends tsvb_BaseImageResource{constructor(t,e){if(e=e||{},"string"==typeof t){const r=new Image;tsvb_BaseImageResource.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??tsvb_settings.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const r=this.source;this.url=r.src;const n=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};r.complete&&r.src?n():(r.onload=n,r.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then((t=>t.blob())).then((r=>e(r,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===tsvb_ALPHA_MODES.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,r){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let t=!0;const n=e._glTextures;for(const i in n){const s=n[i];if(s!==r&&s.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&("string"==typeof t||t instanceof HTMLImageElement)}}class tsvb_TextureUvs{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const n=e.width,i=e.height;if(r){const e=t.width/2/n,s=t.height/2/i,o=t.x/n+e,a=t.y/i+s;r=tsvb_groupD8.add(r,tsvb_groupD8.NW),this.x0=o+e*tsvb_groupD8.uX(r),this.y0=a+s*tsvb_groupD8.uY(r),r=tsvb_groupD8.add(r,2),this.x1=o+e*tsvb_groupD8.uX(r),this.y1=a+s*tsvb_groupD8.uY(r),r=tsvb_groupD8.add(r,2),this.x2=o+e*tsvb_groupD8.uX(r),this.y2=a+s*tsvb_groupD8.uY(r),r=tsvb_groupD8.add(r,2),this.x3=o+e*tsvb_groupD8.uX(r),this.y3=a+s*tsvb_groupD8.uY(r)}else this.x0=t.x/n,this.y0=t.y/i,this.x1=(t.x+t.width)/n,this.y1=t.y/i,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/i,this.x3=t.x/n,this.y3=(t.y+t.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}tsvb_TextureUvs.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const tsvb_DEFAULT_UVS=new tsvb_TextureUvs;function tsvb_removeAllHandlers(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class tsvb_Texture_Texture extends tsvb_utils_node_modules_eventemitter3{constructor(t,e,r,n,i,s,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new tsvb_Rectangle(0,0,1,1)),t instanceof tsvb_Texture_Texture&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=tsvb_DEFAULT_UVS,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(i||0),!0===i)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=s?new tsvb_Point(s.x,s.y):new tsvb_Point(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;t?.url&&tsvb_TextureCache[t.url]&&tsvb_Texture_Texture.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,tsvb_Texture_Texture.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new tsvb_Texture_Texture(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===tsvb_DEFAULT_UVS&&(this._uvs=new tsvb_TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=tsvb_settings.STRICT_TEXTURE_CACHE){const n="string"==typeof t;let i=null;if(n)i=t;else if(t instanceof src_tsvb_BaseTexture){if(!t.cacheId){const r=e?.pixiIdPrefix||"pixiid";t.cacheId=`${r}-${tsvb_uid()}`,src_tsvb_BaseTexture.addToCache(t,t.cacheId)}i=t.cacheId}else{if(!t._pixiId){const r=e?.pixiIdPrefix||"pixiid";t._pixiId=`${r}_${tsvb_uid()}`}i=t._pixiId}let s=tsvb_TextureCache[i];if(n&&r&&!s)throw new Error(`The cacheId "${i}" does not exist in TextureCache.`);return s||t instanceof src_tsvb_BaseTexture?!s&&t instanceof src_tsvb_BaseTexture&&(s=new tsvb_Texture_Texture(t),tsvb_Texture_Texture.addToCache(s,i)):(e.resolution||(e.resolution=tsvb_getResolutionOfUrl(t)),s=new tsvb_Texture_Texture(new src_tsvb_BaseTexture(t,e)),s.baseTexture.cacheId=i,src_tsvb_BaseTexture.addToCache(s.baseTexture,i),tsvb_Texture_Texture.addToCache(s,i)),s}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e?.resourceOptions),n=tsvb_Texture_Texture.from(t,Object.assign({resourceOptions:r},e),!1),i=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):i.load().then((()=>Promise.resolve(n)))}static fromBuffer(t,e,r,n){return new tsvb_Texture_Texture(src_tsvb_BaseTexture.fromBuffer(t,e,r,n))}static fromLoader(t,e,r,n){const i=new src_tsvb_BaseTexture(t,Object.assign({scaleMode:src_tsvb_BaseTexture.defaultOptions.scaleMode,resolution:tsvb_getResolutionOfUrl(e)},n)),{resource:s}=i;s instanceof tsvb_ImageResource&&(s.url=e);const o=new tsvb_Texture_Texture(i);return r||(r=e),src_tsvb_BaseTexture.addToCache(o.baseTexture,r),tsvb_Texture_Texture.addToCache(o,r),r!==e&&(src_tsvb_BaseTexture.addToCache(o.baseTexture,e),tsvb_Texture_Texture.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),tsvb_TextureCache[e]&&tsvb_TextureCache[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),tsvb_TextureCache[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=tsvb_TextureCache[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete tsvb_TextureCache[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)tsvb_TextureCache[t.textureCacheIds[e]]===t&&delete tsvb_TextureCache[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:n,height:i}=t,s=e+n>this.baseTexture.width,o=r+i>this.baseTexture.height;if(s||o){const t=s&&o?"and":"or",a=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,u=`Y: ${r} + ${i} = ${r+i} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${u}`)}this.valid=n&&i&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return tsvb_Texture_Texture._EMPTY||(tsvb_Texture_Texture._EMPTY=new tsvb_Texture_Texture(new src_tsvb_BaseTexture),tsvb_removeAllHandlers(tsvb_Texture_Texture._EMPTY),tsvb_removeAllHandlers(tsvb_Texture_Texture._EMPTY.baseTexture)),tsvb_Texture_Texture._EMPTY}static get WHITE(){if(!tsvb_Texture_Texture._WHITE){const t=tsvb_settings.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),tsvb_Texture_Texture._WHITE=new tsvb_Texture_Texture(src_tsvb_BaseTexture.from(t)),tsvb_removeAllHandlers(tsvb_Texture_Texture._WHITE),tsvb_removeAllHandlers(tsvb_Texture_Texture._WHITE.baseTexture)}return tsvb_Texture_Texture._WHITE}}class tsvb_RenderTexture extends tsvb_Texture_Texture{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const n=this.baseTexture.resolution,i=Math.round(t*n)/n,s=Math.round(e*n)/n;this.valid=i>0&&s>0,this._frame.width=this.orig.width=i,this._frame.height=this.orig.height=s,r&&this.baseTexture.resize(i,s),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new tsvb_RenderTexture(new tsvb_BaseRenderTexture(t))}}class tsvb_RenderTexturePool{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=tsvb_MSAA_QUALITY.NONE){const n=new tsvb_BaseRenderTexture(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new tsvb_RenderTexture(n)}getOptimalTexture(t,e,r=1,n=tsvb_MSAA_QUALITY.NONE){let i;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?i=n>1?-n:-1:(i=((65535&(t=tsvb_nextPow2(t)))<<16|65535&(e=tsvb_nextPow2(e)))>>>0,n>1&&(i+=4294967296*n)),this.texturePool[i]||(this.texturePool[i]=[]);let s=this.texturePool[i].pop();return s||(s=this.createTexture(t,e,n)),s.filterPoolKey=i,s.setResolution(r),s}getFilterTexture(t,e,r){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||tsvb_MSAA_QUALITY.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}tsvb_RenderTexturePool.SCREEN_KEY=-1;class tsvb_Quad extends tsvb_Geometry{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class tsvb_QuadUv extends tsvb_Geometry{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new tsvb_Buffer(this.vertices),this.uvBuffer=new tsvb_Buffer(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,r=e.x,n=e.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class tsvb_FilterState{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=tsvb_MSAA_QUALITY.NONE,this.sourceFrame=new tsvb_Rectangle,this.destinationFrame=new tsvb_Rectangle,this.bindingSourceFrame=new tsvb_Rectangle,this.bindingDestinationFrame=new tsvb_Rectangle,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const tsvb_FilterSystem_tempPoints=[new tsvb_Point,new tsvb_Point,new tsvb_Point,new tsvb_Point],tsvb_tempMatrix=new tsvb_Matrix;class tsvb_FilterSystem{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new tsvb_RenderTexturePool,this.statePool=[],this.quad=new tsvb_Quad,this.quadUv=new tsvb_QuadUv,this.tempRect=new tsvb_Rectangle,this.activeState={},this.globalUniforms=new tsvb_UniformGroup({outputFrame:new tsvb_Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,n=this.defaultFilterStack,i=this.statePool.pop()||new tsvb_FilterState,s=r.renderTexture;let o,a;if(s.current){const t=s.current;o=t.resolution,a=t.multisample}else o=r.resolution,a=r.multisample;let u=e[0].resolution||o,l=e[0].multisample??a,c=e[0].padding,h=e[0].autoFit,f=e[0].legacy??!0;for(let t=1;t<e.length;t++){const r=e[t];u=Math.min(u,r.resolution||o),l=Math.min(l,r.multisample??a),c=this.useMaxPadding?Math.max(c,r.padding):c+r.padding,h=h&&r.autoFit,f=f||(r.legacy??!0)}1===n.length&&(this.defaultFilterStack[0].renderTexture=s.current),n.push(i),i.resolution=u,i.multisample=l,i.legacy=f,i.target=t,i.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),i.sourceFrame.pad(c);const d=this.tempRect.copyFrom(s.sourceFrame);r.projection.transform&&this.transformAABB(tsvb_tempMatrix.copyFrom(r.projection.transform).invert(),d),h?(i.sourceFrame.fit(d),(i.sourceFrame.width<=0||i.sourceFrame.height<=0)&&(i.sourceFrame.width=0,i.sourceFrame.height=0)):i.sourceFrame.intersects(d)||(i.sourceFrame.width=0,i.sourceFrame.height=0),this.roundFrame(i.sourceFrame,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,u,l),i.filters=e,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height;const p=this.tempRect;p.x=0,p.y=0,p.width=i.sourceFrame.width,p.height=i.sourceFrame.height,i.renderTexture.filterFrame=i.sourceFrame,i.bindingSourceFrame.copyFrom(s.sourceFrame),i.bindingDestinationFrame.copyFrom(s.destinationFrame),i.transform=r.projection.transform,r.projection.transform=null,s.bind(i.renderTexture,i.sourceFrame,p),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const i=n.inputSize,s=n.inputPixel,o=n.inputClamp;if(i[0]=e.destinationFrame.width,i[1]=e.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],s[0]=Math.round(i[0]*e.resolution),s[1]=Math.round(i[1]*e.resolution),s[2]=1/s[0],s[3]=1/s[1],o[0]=.5*s[2],o[1]=.5*s[3],o[2]=e.sourceFrame.width*i[2]-.5*s[2],o[3]=e.sourceFrame.height*i[3]-.5*s[3],e.legacy){const t=n.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===r.length)r[0].apply(this,e.renderTexture,a.renderTexture,tsvb_CLEAR_MODES.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,n=this.getOptimalFilterTexture(t.width,t.height,e.resolution);n.filterFrame=t.filterFrame;let i=0;for(i=0;i<r.length-1;++i){1===i&&e.multisample>1&&(n=this.getOptimalFilterTexture(t.width,t.height,e.resolution),n.filterFrame=t.filterFrame),r[i].apply(this,t,n,tsvb_CLEAR_MODES.CLEAR,e);const s=t;t=n,n=s}r[i].apply(this,t,a.renderTexture,tsvb_CLEAR_MODES.BLEND,e),i>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(n)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=tsvb_CLEAR_MODES.CLEAR){const{renderTexture:r,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,r.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const i=1&n.stateId||this.forceClear;(e===tsvb_CLEAR_MODES.CLEAR||e===tsvb_CLEAR_MODES.BLIT&&i)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,n){const i=this.renderer;i.state.set(t.state),this.bindAndClear(r,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,i.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(tsvb_DRAW_MODES.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(tsvb_DRAW_MODES.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:n}=this.activeState,{orig:i}=e._texture,s=t.set(n.width,0,0,n.height,r.x,r.y),o=e.worldTransform.copyTo(tsvb_Matrix.TEMP_MATRIX);return o.invert(),s.prepend(o),s.scale(1/i.width,1/i.height),s.translate(e.anchor.x,e.anchor.y),s}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,n=tsvb_MSAA_QUALITY.NONE){return this.texturePool.getOptimalTexture(t,e,r,n)}getFilterTexture(t,e,r){if("number"==typeof t){const r=t;t=e,e=r}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||tsvb_MSAA_QUALITY.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=tsvb_FilterSystem_tempPoints[0],n=tsvb_FilterSystem_tempPoints[1],i=tsvb_FilterSystem_tempPoints[2],s=tsvb_FilterSystem_tempPoints[3];r.set(e.left,e.top),n.set(e.left,e.bottom),i.set(e.right,e.top),s.set(e.right,e.bottom),t.apply(r,r),t.apply(n,n),t.apply(i,i),t.apply(s,s);const o=Math.min(r.x,n.x,i.x,s.x),a=Math.min(r.y,n.y,i.y,s.y),u=Math.max(r.x,n.x,i.x,s.x),l=Math.max(r.y,n.y,i.y,s.y);e.x=o,e.y=a,e.width=u-o,e.height=l-a}roundFrame(t,e,r,n,i){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(i){const{a:t,b:e,c:r,d:n}=i;if((Math.abs(e)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4))return}(i=i?tsvb_tempMatrix.copyFrom(i):tsvb_tempMatrix.identity()).translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(i,t),t.ceil(e),this.transformAABB(i.invert(),t)}}}tsvb_FilterSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"filter"},tsvb_extensions.add(tsvb_FilterSystem);class tsvb_GLFramebuffer{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=tsvb_MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const tsvb_tempRectangle=new tsvb_Rectangle;class tsvb_FramebufferSystem{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new tsvb_Framebuffer(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new tsvb_Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;tsvb_settings.PREFER_ENV===tsvb_ENV.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:n}=this;if(t){const i=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,i.framebuffer)),i.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,i.mipLevel=r),i.dirtyId!==t.dirtyId&&(i.dirtyId=t.dirtyId,i.dirtyFormat!==t.dirtyFormat?(i.dirtyFormat=t.dirtyFormat,i.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):i.dirtySize!==t.dirtySize&&(i.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const r=t.colorTextures[e];this.renderer.texture.unbind(r.parentTextureArray||r)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>r,n=e.height>>r,i=t/e.width;this.setViewport(e.x*i,e.y*i,t,n)}else{const e=t.width>>r,n=t.height>>r;this.setViewport(0,0,e,n)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,n){const i=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),(i.width!==r||i.height!==n||i.x!==t||i.y!==e)&&(i.x=t,i.y=e,i.width=r,i.height=n,this.gl.viewport(t,e,r,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,n,i=tsvb_BUFFER_BITS.COLOR|tsvb_BUFFER_BITS.DEPTH){const{gl:s}=this;s.clearColor(t,e,r,n),s.clear(i)}initFramebuffer(t){const{gl:e}=this,r=new tsvb_GLFramebuffer(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){let n;e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),n=1===this.renderer.context.webGLVersion?e.DEPTH_STENCIL:t.depth&&t.stencil?e.DEPTH24_STENCIL8:t.depth?e.DEPTH_COMPONENT24:e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,n,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,n,t.width,t.height)}const n=t.colorTextures;let i=n.length;e.drawBuffers||(i=Math.min(i,1));for(let s=0;s<i;s++){const i=n[s],o=i.parentTextureArray||i;this.renderer.texture.bind(o,0),0===s&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID],i=t.colorTextures;let s=i.length;r.drawBuffers||(s=Math.min(s,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer():n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const o=[];for(let a=0;a<s;a++){const s=i[a],u=s.parentTextureArray||s;this.renderer.texture.bind(u,0),0===a&&n.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+a,s.target,u._glTextures[this.CONTEXT_UID].texture,e),o.push(r.COLOR_ATTACHMENT0+a))}if(o.length>1&&r.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const n=t.depthTexture;this.renderer.texture.bind(n,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n._glTextures[this.CONTEXT_UID].texture,e)}if(!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture)n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null);else{let e,i;n.stencil=n.stencil||r.createRenderbuffer(),1===this.renderer.context.webGLVersion?(e=r.DEPTH_STENCIL_ATTACHMENT,i=r.DEPTH_STENCIL):t.depth&&t.stencil?(e=r.DEPTH_STENCIL_ATTACHMENT,i=r.DEPTH24_STENCIL8):t.depth?(e=r.DEPTH_ATTACHMENT,i=r.DEPTH_COMPONENT24):(e=r.STENCIL_ATTACHMENT,i=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,i,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,i,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,e,r.RENDERBUFFER,n.stencil)}}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=tsvb_MSAA_QUALITY.NONE;if(t<=1||null===e)return r;for(let n=0;n<e.length;n++)if(e[n]<=t){r=e[n];break}return 1===r&&(r=tsvb_MSAA_QUALITY.NONE),r}blit(t,e,r){const{current:n,renderer:i,gl:s,CONTEXT_UID:o}=this;if(2!==i.context.webGLVersion||!n)return;const a=n.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=n.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new tsvb_Framebuffer(n.width,n.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||((e=tsvb_tempRectangle).width=n.width,e.height=n.height),r||(r=e);const u=e.width===r.width&&e.height===r.height;this.bind(t),s.bindFramebuffer(s.READ_FRAMEBUFFER,a.framebuffer),s.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,s.COLOR_BUFFER_BIT,u?s.NEAREST:s.LINEAR),s.bindFramebuffer(s.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const i=this.managedFramebuffers.indexOf(t);i>=0&&this.managedFramebuffers.splice(i,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,n=t.height,i=this.gl,s=e.stencil=i.createRenderbuffer();let o,a;i.bindRenderbuffer(i.RENDERBUFFER,s),1===this.renderer.context.webGLVersion?(o=i.DEPTH_STENCIL_ATTACHMENT,a=i.DEPTH_STENCIL):t.depth?(o=i.DEPTH_STENCIL_ATTACHMENT,a=i.DEPTH24_STENCIL8):(o=i.STENCIL_ATTACHMENT,a=i.STENCIL_INDEX8),e.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,e.multisample,a,r,n):i.renderbufferStorage(i.RENDERBUFFER,a,r,n),i.framebufferRenderbuffer(i.FRAMEBUFFER,o,i.RENDERBUFFER,s)}reset(){this.current=this.unknownFramebuffer,this.viewport=new tsvb_Rectangle}destroy(){this.renderer=null}}tsvb_FramebufferSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"framebuffer"},tsvb_extensions.add(tsvb_FramebufferSystem);const tsvb_GeometrySystem_byteSizeMap={5126:4,5123:2,5121:1};class tsvb_GeometrySystem{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;tsvb_settings.PREFER_ENV===tsvb_ENV.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,r)=>e.vertexAttribDivisorANGLE(t,r),t.drawElementsInstanced=(t,r,n,i,s)=>e.drawElementsInstancedANGLE(t,r,n,i,s),t.drawArraysInstanced=(t,r,n,i)=>e.drawArraysInstancedANGLE(t,r,n,i)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],i=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},i=!0);const s=n[e.program.id]||this.initGeometryVao(t,e,i);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?r.bindVertexArray(s):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];e.update(n)}}checkCompatibility(t,e){const r=t.attributes,n=e.attributeData;for(const t in n)if(!r[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,e){const r=t.attributes,n=e.attributeData,i=["g",t.id];for(const t in r)n[t]&&i.push(t,n[t].location);return i.join("-")}initGeometryVao(t,e,r=!0){const n=this.gl,i=this.CONTEXT_UID,s=this.renderer.buffer,o=e.program;o.glPrograms[i]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),u=t.glVertexArrayObjects[this.CONTEXT_UID];let l=u[a];if(l)return u[o.id]=l,l;const c=t.buffers,h=t.attributes,f={},d={};for(const t in c)f[t]=0,d[t]=0;for(const t in h)!h[t].size&&o.attributeData[t]?h[t].size=o.attributeData[t].size:h[t].size||console.warn(`PIXI Geometry attribute '${t}' size cannot be determined (likely the bound shader does not have the attribute)`),f[h[t].buffer]+=h[t].size*tsvb_GeometrySystem_byteSizeMap[h[t].type];for(const t in h){const e=h[t],r=e.size;void 0===e.stride&&(f[e.buffer]===r*tsvb_GeometrySystem_byteSizeMap[e.type]?e.stride=0:e.stride=f[e.buffer]),void 0===e.start&&(e.start=d[e.buffer],d[e.buffer]+=r*tsvb_GeometrySystem_byteSizeMap[e.type])}l=n.createVertexArray(),n.bindVertexArray(l);for(let t=0;t<c.length;t++){const e=c[t];s.bind(e),r&&e._glBuffers[i].refCount++}return this.activateVao(t,o),u[o.id]=l,u[a]=l,n.bindVertexArray(null),s.unbind(tsvb_BUFFER_TYPE.ARRAY_BUFFER),l}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,i=t.buffers,s=this.renderer?.buffer;if(t.disposeRunner.remove(this),r){if(s)for(let t=0;t<i.length;t++){const r=i[t]._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0===r.refCount&&!e&&s.dispose(i[t],e))}if(!e)for(const t in r)if("g"===t[0]){const e=r[t];this._activeVao===e&&this.unbind(),n.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,n=this.CONTEXT_UID,i=this.renderer.buffer,s=t.buffers,o=t.attributes;t.indexBuffer&&i.bind(t.indexBuffer);let a=null;for(const t in o){const u=o[t],l=s[u.buffer],c=l._glBuffers[n];if(e.attributeData[t]){a!==c&&(i.bind(l),a=c);const n=e.attributeData[t].location;if(r.enableVertexAttribArray(n),r.vertexAttribPointer(n,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(n,u.divisor)}}}}draw(t,e,r,n){const{gl:i}=this,s=this._activeGeometry;if(s.indexBuffer){const o=s.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?i.UNSIGNED_SHORT:i.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?s.instanced?i.drawElementsInstanced(t,e||s.indexBuffer.data.length,a,(r||0)*o,n||1):i.drawElements(t,e||s.indexBuffer.data.length,a,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else s.instanced?i.drawArraysInstanced(t,r,e||s.getSize(),n||1):i.drawArrays(t,r,e||s.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}tsvb_GeometrySystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"geometry"},tsvb_extensions.add(tsvb_GeometrySystem);const tsvb_tempMat=new tsvb_Matrix;class tsvb_TextureMatrix{constructor(t,e){this._texture=t,this.mapCoord=new tsvb_Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const r=this.mapCoord;for(let n=0;n<t.length;n+=2){const i=t[n],s=t[n+1];e[n]=i*r.a+s*r.c+r.tx,e[n+1]=i*r.b+s*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=e.orig,i=e.trim;i&&(tsvb_tempMat.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(tsvb_tempMat));const s=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/s.resolution,u=this.clampOffset;return o[0]=(e._frame.x+a+u)/s.width,o[1]=(e._frame.y+a+u)/s.height,o[2]=(e._frame.x+e._frame.width-a+u)/s.width,o[3]=(e._frame.y+e._frame.height-a+u)/s.height,this.uClampOffset[0]=u/s.realWidth,this.uClampOffset[1]=u/s.realHeight,this.isSimple=e._frame.width===s.width&&e._frame.height===s.height&&0===e.rotate,!0}}var tsvb_fragment="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",tsvb_vertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n";class tsvb_SpriteMaskFilter extends src_tsvb_Filter{constructor(t,e,r){let n=null;"string"!=typeof t&&void 0===e&&void 0===r&&(n=t,t=void 0,e=void 0,r=void 0),super(t||tsvb_vertex,e||tsvb_fragment,r),this.maskSprite=n,this.maskMatrix=new tsvb_Matrix}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,n){const i=this._maskSprite,s=i._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new tsvb_TextureMatrix(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,i).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,t.applyFilter(this,e,r,n))}}class tsvb_MaskData{constructor(t=null){this.type=tsvb_MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=src_tsvb_Filter.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=tsvb_MASK_TYPES.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class tsvb_MaskSystem{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const t=this.maskDataPool.pop()||new tsvb_MaskData;t.pooled=!0,t.maskObject=e,r=t}const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(n),r._colorMask=n?n._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==tsvb_MASK_TYPES.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case tsvb_MASK_TYPES.SCISSOR:this.renderer.scissor.push(r);break;case tsvb_MASK_TYPES.STENCIL:this.renderer.stencil.push(r);break;case tsvb_MASK_TYPES.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case tsvb_MASK_TYPES.COLOR:this.pushColorMask(r)}r.type===tsvb_MASK_TYPES.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case tsvb_MASK_TYPES.SCISSOR:this.renderer.scissor.pop(e);break;case tsvb_MASK_TYPES.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case tsvb_MASK_TYPES.SPRITE:this.popSpriteMask(e);break;case tsvb_MASK_TYPES.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===tsvb_MASK_TYPES.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=tsvb_MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=tsvb_MASK_TYPES.SCISSOR:t.type=tsvb_MASK_TYPES.STENCIL:t.type=tsvb_MASK_TYPES.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new tsvb_SpriteMaskFilter])),n[0].resolution=t.resolution,n[0].multisample=t.multisample,n[0].maskSprite=e;const i=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,n),r.filterArea=i,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))}destroy(){this.renderer=null}}tsvb_MaskSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"mask"},tsvb_extensions.add(tsvb_MaskSystem);class tsvb_AbstractMaskSystem{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==r&&(0===n?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const tsvb_ScissorSystem_tempMatrix=new tsvb_Matrix,tsvb_rectPool=[],tsvb_ScissorSystem=class t extends tsvb_AbstractMaskSystem{constructor(t){super(t),this.glConst=tsvb_settings.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:n}=this,i=n.renderTexture,s=r.getBounds(!0,tsvb_rectPool.pop()??new tsvb_Rectangle);this.roundFrameToPixels(s,i.current?i.current.resolution:n.resolution,i.sourceFrame,i.destinationFrame,n.projection.transform),e&&s.fit(e),t._scissorRectLocal=s}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:n,d:i}=t;return(Math.abs(r)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(i)>1e-4)}testScissor(e){const{maskObject:r}=e;if(!r.isFastRect||!r.isFastRect()||t.isMatrixRotated(r.worldTransform)||t.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const n=e._scissorRectLocal;return n.width>0&&n.height>0}roundFrameToPixels(e,r,n,i,s){t.isMatrixRotated(s)||((s=s?tsvb_ScissorSystem_tempMatrix.copyFrom(s):tsvb_ScissorSystem_tempMatrix.identity()).translate(-n.x,-n.y).scale(i.width/n.width,i.height/n.height).translate(i.x,i.y),this.renderer.filter.transformAABB(s,e),e.fit(i),e.x=Math.round(e.x*r),e.y=Math.round(e.y*r),e.width=Math.round(e.width*r),e.height=Math.round(e.height*r))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&tsvb_rectPool.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};tsvb_ScissorSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"scissor"};let src_tsvb_ScissorSystem=tsvb_ScissorSystem;tsvb_extensions.add(src_tsvb_ScissorSystem);class tsvb_StencilSystem extends tsvb_AbstractMaskSystem{constructor(t){super(t),this.glConst=tsvb_settings.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,n=t._stencilCounter;0===n&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const i=t._colorMask;0!==i&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==i&&(t._colorMask=i,r.colorMask(!!(1&i),!!(2&i),!!(4&i),!!(8&i))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;0!==n&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==n&&(r._colorMask=n,e.colorMask(!!(1&n),!!(2&n),!!(4&n),!!(8&n))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}tsvb_StencilSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"stencil"},tsvb_extensions.add(tsvb_StencilSystem);class tsvb_PluginSystem{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(tsvb_deprecation("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(tsvb_deprecation("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(tsvb_deprecation("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}tsvb_PluginSystem.extension={type:[tsvb_ExtensionType.RendererSystem,tsvb_ExtensionType.CanvasRendererSystem],name:"_plugin"},tsvb_extensions.add(tsvb_PluginSystem);class tsvb_ProjectionSystem{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new tsvb_Matrix,this.transform=null}update(t,e,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);const i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)}calculateProjection(t,e,r,n){const i=this.projectionMatrix,s=n?-1:1;i.identity(),i.a=1/e.width*2,i.d=s*(1/e.height*2),i.tx=-1-e.x*i.a,i.ty=-s-e.y*i.d}setTransform(t){}destroy(){this.renderer=null}}tsvb_ProjectionSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"projection"},tsvb_extensions.add(tsvb_ProjectionSystem);const tsvb_tempTransform=new src_tsvb_Transform,tsvb_tempRect=new tsvb_Rectangle;class tsvb_GenerateTextureSystem{constructor(t){this.renderer=t,this._tempMatrix=new tsvb_Matrix}generateTexture(t,e){const{region:r,...n}=e||{},i=r?.copyTo(tsvb_tempRect)||t.getLocalBounds(tsvb_tempRect,!0),s=n.resolution||this.renderer.resolution;i.width=Math.max(i.width,1/s),i.height=Math.max(i.height,1/s),n.width=i.width,n.height=i.height,n.resolution=s,n.multisample??(n.multisample=this.renderer.multisample);const o=tsvb_RenderTexture.create(n);this._tempMatrix.tx=-i.x,this._tempMatrix.ty=-i.y;const a=t.transform;return t.transform=tsvb_tempTransform,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,o}destroy(){}}tsvb_GenerateTextureSystem.extension={type:[tsvb_ExtensionType.RendererSystem,tsvb_ExtensionType.CanvasRendererSystem],name:"textureGenerator"},tsvb_extensions.add(tsvb_GenerateTextureSystem);const tsvb_RenderTextureSystem_tempRect=new tsvb_Rectangle,tsvb_tempRect2=new tsvb_Rectangle;class tsvb_RenderTextureSystem{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new tsvb_Rectangle,this.destinationFrame=new tsvb_Rectangle,this.viewportFrame=new tsvb_Rectangle}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const n=this.renderer;let i,s,o;this.current=t,t?(i=t.baseTexture,o=i.resolution,e||(tsvb_RenderTextureSystem_tempRect.width=t.frame.width,tsvb_RenderTextureSystem_tempRect.height=t.frame.height,e=tsvb_RenderTextureSystem_tempRect),r||(tsvb_tempRect2.x=t.frame.x,tsvb_tempRect2.y=t.frame.y,tsvb_tempRect2.width=e.width,tsvb_tempRect2.height=e.height,r=tsvb_tempRect2),s=i.framebuffer):(o=n.resolution,e||(tsvb_RenderTextureSystem_tempRect.width=n._view.screen.width,tsvb_RenderTextureSystem_tempRect.height=n._view.screen.height,e=tsvb_RenderTextureSystem_tempRect),r||((r=tsvb_RenderTextureSystem_tempRect).width=e.width,r.height=e.height));const a=this.viewportFrame;a.x=r.x*o,a.y=r.y*o,a.width=r.width*o,a.height=r.height*o,t||(a.y=n.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(s,a),this.renderer.projection.update(r,e,o,!s),t?this.renderer.mask.setMaskStack(i.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=src_tsvb_Color.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const i=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,o=i.width!==s.width||i.height!==s.height;if(o){let{x:t,y:e,width:r,height:n}=this.viewportFrame;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,r,n)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}tsvb_RenderTextureSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"renderTexture"},tsvb_extensions.add(tsvb_RenderTextureSystem);class tsvb_IGLUniformData{}class tsvb_GLProgram{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function tsvb_compileShader(t,e,r){const n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),n}function tsvb_booleanArray(t){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=!1;return e}function tsvb_defaultValue(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return tsvb_booleanArray(2*e);case"bvec3":return tsvb_booleanArray(3*e);case"bvec4":return tsvb_booleanArray(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function tsvb_getAttributeData(t,e){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const n=e.getActiveAttrib(t,i);if(n.name.startsWith("gl_"))continue;const s=tsvb_mapType(e,n.type),o={type:s,name:n.name,size:tsvb_mapSize(s),location:e.getAttribLocation(t,n.name)};r[n.name]=o}return r}function tsvb_getUniformData(t,e){const r={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;i++){const n=e.getActiveUniform(t,i),s=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),a=tsvb_mapType(e,n.type);r[s]={name:s,index:i,type:a,size:n.size,isArray:o,value:tsvb_defaultValue(a,n.size)}}return r}function tsvb_logPrettyShaderError(t,e){const r=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),n=t.getShaderInfoLog(e),i=n.split("\n"),s={},o=i.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||s[t])&&(s[t]=!0,!0))),a=[""];o.forEach((t=>{r[t-1]=`%c${r[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const u=r.join("\n");a[0]=u,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function tsvb_logProgramError(t,e,r,n){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(r,t.COMPILE_STATUS)||tsvb_logPrettyShaderError(t,r),t.getShaderParameter(n,t.COMPILE_STATUS)||tsvb_logPrettyShaderError(t,n),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}function tsvb_generateProgram(t,e){const r=tsvb_compileShader(t,t.VERTEX_SHADER,e.vertexSrc),n=tsvb_compileShader(t,t.FRAGMENT_SHADER,e.fragmentSrc),i=t.createProgram();t.attachShader(i,r),t.attachShader(i,n);const s=e.extra?.transformFeedbackVaryings;if(s&&("function"!=typeof t.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(i,s.names,"separate"===s.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||tsvb_logProgramError(t,i,r,n),e.attributeData=tsvb_getAttributeData(i,t),e.uniformData=tsvb_getUniformData(i,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const r=Object.keys(e.attributeData);r.sort(((t,e)=>t>e?1:-1));for(let n=0;n<r.length;n++)e.attributeData[r[n]].location=n,t.bindAttribLocation(i,n,r[n]);t.linkProgram(i)}t.deleteShader(r),t.deleteShader(n);const o={};for(const r in e.uniformData){const n=e.uniformData[r];o[r]={location:t.getUniformLocation(i,r),value:tsvb_defaultValue(n.type,n.size)}}return new tsvb_GLProgram(i,o)}function tsvb_uboUpdate(t,e,r,n,i){r.buffer.update(i)}const tsvb_UBO_TO_SINGLE_SETTERS={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},tsvb_GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function tsvb_createUBOElements(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let r=0,n=0,i=0;for(let t=0;t<e.length;t++){const s=e[t];if(r=tsvb_GLSL_TO_STD40_SIZE[s.data.type],s.data.size>1&&(r=Math.max(r,16)*s.data.size),s.dataLen=r,n%r!=0&&n<16){const t=n%r%16;n+=t,i+=t}n+r>16?(i=16*Math.ceil(i/16),s.offset=i,i+=r,n=r):(s.offset=i,n+=r,i+=r)}return i=16*Math.ceil(i/16),{uboElements:e,size:i}}function tsvb_getUBOData(t,e){const r=[];for(const n in t)e[n]&&r.push(e[n]);return r.sort(((t,e)=>t.index-e.index)),r}function tsvb_generateUniformBufferSync(t,e){if(!t.autoManage)return{size:0,syncFunc:tsvb_uboUpdate};const r=tsvb_getUBOData(t.uniforms,e),{uboElements:n,size:i}=tsvb_createUBOElements(r),s=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let e=0;e<n.length;e++){const r=n[e],i=t.uniforms[r.data.name],o=r.data.name;let a=!1;for(let t=0;t<tsvb_uniformParsers.length;t++){const e=tsvb_uniformParsers[t];if(e.codeUbo&&e.test(r.data,i)){s.push(`offset = ${r.offset/4};`,tsvb_uniformParsers[t].codeUbo(r.data.name,i)),a=!0;break}}if(!a)if(r.data.size>1){const t=tsvb_mapSize(r.data.type),e=Math.max(tsvb_GLSL_TO_STD40_SIZE[r.data.type]/16,1),n=t/e,i=(4-n%4)%4;s.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${r.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${r.data.size*e}; i++)\n                {\n                    for(var j = 0; j < ${n}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${i};\n                }\n\n                `)}else{const t=tsvb_UBO_TO_SINGLE_SETTERS[r.data.type];s.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${r.offset/4};\n                ${t};\n                `)}}return s.push("\n       renderer.buffer.update(buffer);\n    "),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join("\n"))}}let tsvb_unsafeEval;function tsvb_unsafeEvalSupported(){if("boolean"==typeof tsvb_unsafeEval)return tsvb_unsafeEval;try{tsvb_unsafeEval=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{tsvb_unsafeEval=!1}return tsvb_unsafeEval}let tsvb_ShaderSystem_UID=0;const tsvb_defaultSyncData={textureCount:0,uboCount:0};class tsvb_ShaderSystem{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=tsvb_ShaderSystem_UID++}systemCheck(){if(!tsvb_unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),e||(tsvb_defaultSyncData.textureCount=0,tsvb_defaultSyncData.uboCount=0,this.syncUniformGroup(t.uniformGroup,tsvb_defaultSyncData)),n}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=tsvb_generateUniformsSync(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||0!==t.dirtyId||!r.uniformGroups[t.id]){t.dirtyId=0;const n=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),n(r.uniformData,t.uniforms,this.renderer,tsvb_defaultSyncData,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const i=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,i,this.shader.uniformBindCount),this.shader.uniformBindCount++;const s=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[s];if(o||(o=this._uboCache[s]=tsvb_generateUniformBufferSync(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const n=t.uniforms,i=[`${r}-`];for(const t in n)i.push(t),e[t]&&i.push(e[t].type);return i.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,n=tsvb_generateProgram(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}tsvb_ShaderSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"shader"},tsvb_extensions.add(tsvb_ShaderSystem);class tsvb_StartupSystem{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}function tsvb_mapWebGLBlendModesToPixi(t,e=[]){return e[tsvb_BLEND_MODES.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.ADD]=[t.ONE,t.ONE],e[tsvb_BLEND_MODES.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.NONE]=[0,0],e[tsvb_BLEND_MODES.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[tsvb_BLEND_MODES.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[tsvb_BLEND_MODES.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[tsvb_BLEND_MODES.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[tsvb_BLEND_MODES.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[tsvb_BLEND_MODES.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[tsvb_BLEND_MODES.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[tsvb_BLEND_MODES.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}tsvb_StartupSystem.defaultOptions={hello:!1},tsvb_StartupSystem.extension={type:[tsvb_ExtensionType.RendererSystem,tsvb_ExtensionType.CanvasRendererSystem],name:"startup"},tsvb_extensions.add(tsvb_StartupSystem);const tsvb_StateSystem_BLEND=0,tsvb_StateSystem_OFFSET=1,tsvb_StateSystem_CULLING=2,tsvb_StateSystem_DEPTH_TEST=3,tsvb_StateSystem_WINDING=4,tsvb_StateSystem_DEPTH_MASK=5,tsvb_StateSystem=class t{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=tsvb_BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[tsvb_StateSystem_BLEND]=this.setBlend,this.map[tsvb_StateSystem_OFFSET]=this.setOffset,this.map[tsvb_StateSystem_CULLING]=this.setCullFace,this.map[tsvb_StateSystem_DEPTH_TEST]=this.setDepthTest,this.map[tsvb_StateSystem_WINDING]=this.setFrontFace,this.map[tsvb_StateSystem_DEPTH_MASK]=this.setDepthMask,this.checks=[],this.defaultState=new tsvb_State,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=tsvb_mapWebGLBlendModesToPixi(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)1&e&&this.map[r].call(this,!!(t.data&1<<r)),e>>=1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;2===e.length?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&-1===r?this.checks.push(t):!e&&-1!==r&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};tsvb_StateSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"state"};let src_tsvb_StateSystem=tsvb_StateSystem;tsvb_extensions.add(src_tsvb_StateSystem);class tsvb_SystemManager extends tsvb_utils_node_modules_eventemitter3{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),r=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const e of r)this.addSystem(t.systems[e],e)}addRunners(...t){t.forEach((t=>{this.runners[t]=new tsvb_Runner(t)}))}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const t in this.runners)this.runners[t].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach((n=>{const i=r.find((t=>this._systemsHash[t]===n));n[t.name](e[i])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const tsvb_TextureGCSystem=class t{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=t.defaultMaxIdle,this.checkCountMax=t.defaultCheckCountMax,this.mode=t.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==tsvb_GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let n=0;n<e.length;n++){const i=e[n];i.resource&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[n]=null,r=!0)}if(r){let t=0;for(let r=0;r<e.length;r++)null!==e[r]&&(e[t++]=e[r]);e.length=t}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let e=t.children.length-1;e>=0;e--)this.unload(t.children[e])}destroy(){this.renderer=null}};tsvb_TextureGCSystem.defaultMode=tsvb_GC_MODES.AUTO,tsvb_TextureGCSystem.defaultMaxIdle=3600,tsvb_TextureGCSystem.defaultCheckCountMax=600,tsvb_TextureGCSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"textureGC"};let src_tsvb_TextureGCSystem=tsvb_TextureGCSystem;tsvb_extensions.add(src_tsvb_TextureGCSystem);class tsvb_GLTexture{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=tsvb_TYPES.UNSIGNED_BYTE,this.internalFormat=tsvb_FORMATS.RGBA,this.samplerType=0}}function tsvb_mapInternalFormatToSamplerType(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[t.RGB]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGBA]:tsvb_SAMPLER_TYPES.FLOAT,[t.ALPHA]:tsvb_SAMPLER_TYPES.FLOAT,[t.LUMINANCE]:tsvb_SAMPLER_TYPES.FLOAT,[t.LUMINANCE_ALPHA]:tsvb_SAMPLER_TYPES.FLOAT,[t.R8]:tsvb_SAMPLER_TYPES.FLOAT,[t.R8_SNORM]:tsvb_SAMPLER_TYPES.FLOAT,[t.RG8]:tsvb_SAMPLER_TYPES.FLOAT,[t.RG8_SNORM]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGB8]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGB8_SNORM]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGB565]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGBA4]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGB5_A1]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGBA8]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGBA8_SNORM]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGB10_A2]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGB10_A2UI]:tsvb_SAMPLER_TYPES.FLOAT,[t.SRGB8]:tsvb_SAMPLER_TYPES.FLOAT,[t.SRGB8_ALPHA8]:tsvb_SAMPLER_TYPES.FLOAT,[t.R16F]:tsvb_SAMPLER_TYPES.FLOAT,[t.RG16F]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGB16F]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGBA16F]:tsvb_SAMPLER_TYPES.FLOAT,[t.R32F]:tsvb_SAMPLER_TYPES.FLOAT,[t.RG32F]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGB32F]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGBA32F]:tsvb_SAMPLER_TYPES.FLOAT,[t.R11F_G11F_B10F]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGB9_E5]:tsvb_SAMPLER_TYPES.FLOAT,[t.R8I]:tsvb_SAMPLER_TYPES.INT,[t.R8UI]:tsvb_SAMPLER_TYPES.UINT,[t.R16I]:tsvb_SAMPLER_TYPES.INT,[t.R16UI]:tsvb_SAMPLER_TYPES.UINT,[t.R32I]:tsvb_SAMPLER_TYPES.INT,[t.R32UI]:tsvb_SAMPLER_TYPES.UINT,[t.RG8I]:tsvb_SAMPLER_TYPES.INT,[t.RG8UI]:tsvb_SAMPLER_TYPES.UINT,[t.RG16I]:tsvb_SAMPLER_TYPES.INT,[t.RG16UI]:tsvb_SAMPLER_TYPES.UINT,[t.RG32I]:tsvb_SAMPLER_TYPES.INT,[t.RG32UI]:tsvb_SAMPLER_TYPES.UINT,[t.RGB8I]:tsvb_SAMPLER_TYPES.INT,[t.RGB8UI]:tsvb_SAMPLER_TYPES.UINT,[t.RGB16I]:tsvb_SAMPLER_TYPES.INT,[t.RGB16UI]:tsvb_SAMPLER_TYPES.UINT,[t.RGB32I]:tsvb_SAMPLER_TYPES.INT,[t.RGB32UI]:tsvb_SAMPLER_TYPES.UINT,[t.RGBA8I]:tsvb_SAMPLER_TYPES.INT,[t.RGBA8UI]:tsvb_SAMPLER_TYPES.UINT,[t.RGBA16I]:tsvb_SAMPLER_TYPES.INT,[t.RGBA16UI]:tsvb_SAMPLER_TYPES.UINT,[t.RGBA32I]:tsvb_SAMPLER_TYPES.INT,[t.RGBA32UI]:tsvb_SAMPLER_TYPES.UINT,[t.DEPTH_COMPONENT16]:tsvb_SAMPLER_TYPES.FLOAT,[t.DEPTH_COMPONENT24]:tsvb_SAMPLER_TYPES.FLOAT,[t.DEPTH_COMPONENT32F]:tsvb_SAMPLER_TYPES.FLOAT,[t.DEPTH_STENCIL]:tsvb_SAMPLER_TYPES.FLOAT,[t.DEPTH24_STENCIL8]:tsvb_SAMPLER_TYPES.FLOAT,[t.DEPTH32F_STENCIL8]:tsvb_SAMPLER_TYPES.FLOAT}:{[t.RGB]:tsvb_SAMPLER_TYPES.FLOAT,[t.RGBA]:tsvb_SAMPLER_TYPES.FLOAT,[t.ALPHA]:tsvb_SAMPLER_TYPES.FLOAT,[t.LUMINANCE]:tsvb_SAMPLER_TYPES.FLOAT,[t.LUMINANCE_ALPHA]:tsvb_SAMPLER_TYPES.FLOAT,[t.DEPTH_STENCIL]:tsvb_SAMPLER_TYPES.FLOAT},e}function tsvb_mapTypeAndFormatToInternalFormat(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[tsvb_TYPES.UNSIGNED_BYTE]:{[tsvb_FORMATS.RGBA]:t.RGBA8,[tsvb_FORMATS.RGB]:t.RGB8,[tsvb_FORMATS.RG]:t.RG8,[tsvb_FORMATS.RED]:t.R8,[tsvb_FORMATS.RGBA_INTEGER]:t.RGBA8UI,[tsvb_FORMATS.RGB_INTEGER]:t.RGB8UI,[tsvb_FORMATS.RG_INTEGER]:t.RG8UI,[tsvb_FORMATS.RED_INTEGER]:t.R8UI,[tsvb_FORMATS.ALPHA]:t.ALPHA,[tsvb_FORMATS.LUMINANCE]:t.LUMINANCE,[tsvb_FORMATS.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[tsvb_TYPES.BYTE]:{[tsvb_FORMATS.RGBA]:t.RGBA8_SNORM,[tsvb_FORMATS.RGB]:t.RGB8_SNORM,[tsvb_FORMATS.RG]:t.RG8_SNORM,[tsvb_FORMATS.RED]:t.R8_SNORM,[tsvb_FORMATS.RGBA_INTEGER]:t.RGBA8I,[tsvb_FORMATS.RGB_INTEGER]:t.RGB8I,[tsvb_FORMATS.RG_INTEGER]:t.RG8I,[tsvb_FORMATS.RED_INTEGER]:t.R8I},[tsvb_TYPES.UNSIGNED_SHORT]:{[tsvb_FORMATS.RGBA_INTEGER]:t.RGBA16UI,[tsvb_FORMATS.RGB_INTEGER]:t.RGB16UI,[tsvb_FORMATS.RG_INTEGER]:t.RG16UI,[tsvb_FORMATS.RED_INTEGER]:t.R16UI,[tsvb_FORMATS.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[tsvb_TYPES.SHORT]:{[tsvb_FORMATS.RGBA_INTEGER]:t.RGBA16I,[tsvb_FORMATS.RGB_INTEGER]:t.RGB16I,[tsvb_FORMATS.RG_INTEGER]:t.RG16I,[tsvb_FORMATS.RED_INTEGER]:t.R16I},[tsvb_TYPES.UNSIGNED_INT]:{[tsvb_FORMATS.RGBA_INTEGER]:t.RGBA32UI,[tsvb_FORMATS.RGB_INTEGER]:t.RGB32UI,[tsvb_FORMATS.RG_INTEGER]:t.RG32UI,[tsvb_FORMATS.RED_INTEGER]:t.R32UI,[tsvb_FORMATS.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[tsvb_TYPES.INT]:{[tsvb_FORMATS.RGBA_INTEGER]:t.RGBA32I,[tsvb_FORMATS.RGB_INTEGER]:t.RGB32I,[tsvb_FORMATS.RG_INTEGER]:t.RG32I,[tsvb_FORMATS.RED_INTEGER]:t.R32I},[tsvb_TYPES.FLOAT]:{[tsvb_FORMATS.RGBA]:t.RGBA32F,[tsvb_FORMATS.RGB]:t.RGB32F,[tsvb_FORMATS.RG]:t.RG32F,[tsvb_FORMATS.RED]:t.R32F,[tsvb_FORMATS.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[tsvb_TYPES.HALF_FLOAT]:{[tsvb_FORMATS.RGBA]:t.RGBA16F,[tsvb_FORMATS.RGB]:t.RGB16F,[tsvb_FORMATS.RG]:t.RG16F,[tsvb_FORMATS.RED]:t.R16F},[tsvb_TYPES.UNSIGNED_SHORT_5_6_5]:{[tsvb_FORMATS.RGB]:t.RGB565},[tsvb_TYPES.UNSIGNED_SHORT_4_4_4_4]:{[tsvb_FORMATS.RGBA]:t.RGBA4},[tsvb_TYPES.UNSIGNED_SHORT_5_5_5_1]:{[tsvb_FORMATS.RGBA]:t.RGB5_A1},[tsvb_TYPES.UNSIGNED_INT_2_10_10_10_REV]:{[tsvb_FORMATS.RGBA]:t.RGB10_A2,[tsvb_FORMATS.RGBA_INTEGER]:t.RGB10_A2UI},[tsvb_TYPES.UNSIGNED_INT_10F_11F_11F_REV]:{[tsvb_FORMATS.RGB]:t.R11F_G11F_B10F},[tsvb_TYPES.UNSIGNED_INT_5_9_9_9_REV]:{[tsvb_FORMATS.RGB]:t.RGB9_E5},[tsvb_TYPES.UNSIGNED_INT_24_8]:{[tsvb_FORMATS.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[tsvb_TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[tsvb_FORMATS.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[tsvb_TYPES.UNSIGNED_BYTE]:{[tsvb_FORMATS.RGBA]:t.RGBA,[tsvb_FORMATS.RGB]:t.RGB,[tsvb_FORMATS.ALPHA]:t.ALPHA,[tsvb_FORMATS.LUMINANCE]:t.LUMINANCE,[tsvb_FORMATS.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[tsvb_TYPES.UNSIGNED_SHORT_5_6_5]:{[tsvb_FORMATS.RGB]:t.RGB},[tsvb_TYPES.UNSIGNED_SHORT_4_4_4_4]:{[tsvb_FORMATS.RGBA]:t.RGBA},[tsvb_TYPES.UNSIGNED_SHORT_5_5_5_1]:{[tsvb_FORMATS.RGBA]:t.RGBA}},e}class tsvb_TextureSystem{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new src_tsvb_BaseTexture,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=tsvb_mapTypeAndFormatToInternalFormat(t),this.samplerTypes=tsvb_mapInternalFormatToSamplerType(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let t=0;t<e;t++)this.boundTextures[t]=null;this.emptyTextures={};const r=new tsvb_GLTexture(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new tsvb_GLTexture(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let e=0;e<6;e++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let t=0;t<this.boundTextures.length;t++)this.bind(null,t)}bind(t,e=0){const{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<r.length;t++)r[t]===this.unknownTexture&&this.bind(null,t)}for(let n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:n}=this;if(r)for(let r=t-1;r>=0;--r){const t=e[r];t&&t._glTextures[n].samplerType!==tsvb_SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(t)}}initTexture(t){const e=new tsvb_GLTexture(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??tsvb_SAMPLER_TYPES.FLOAT,2===this.webGLVersion&&t.type===tsvb_TYPES.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==tsvb_SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,i=t.realHeight,s=r.gl;(e.width!==n||e.height!==i||e.dirtyId<0)&&(e.width=n,e.height=i,s.texImage2D(t.target,0,e.internalFormat,n,i,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&tsvb_removeItems(this.managedTextures,e,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==tsvb_MIPMAP_MODES.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=tsvb_WRAP_MODES.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==tsvb_MIPMAP_MODES.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===tsvb_SCALE_MODES.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===tsvb_SCALE_MODES.LINEAR){const n=Math.min(t.anisotropicLevel,r.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===tsvb_SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===tsvb_SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}tsvb_TextureSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"texture"},tsvb_extensions.add(tsvb_TextureSystem);class tsvb_TransformFeedbackSystem{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:n}=this;e&&n.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:n}=this,i=e.createTransformFeedback();t._glTransformFeedbacks[n]=i,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,i);for(let i=0;i<t.buffers.length;i++){const s=t.buffers[i];s&&(r.buffer.update(s),s._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,i,s._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),i}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const i=this.renderer.buffer;if(i)for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];if(!n)continue;const s=n._glBuffers[this.CONTEXT_UID];s&&(s.refCount--,0===s.refCount&&!e&&i.dispose(n,e))}r&&(e||n.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}tsvb_TransformFeedbackSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"transformFeedback"},tsvb_extensions.add(tsvb_TransformFeedbackSystem);class tsvb_ViewSystem{constructor(t){this.renderer=t}init(t){this.screen=new tsvb_Rectangle(0,0,t.width,t.height),this.element=t.view||tsvb_settings.ADAPTER.createCanvas(),this.resolution=t.resolution||tsvb_settings.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",r,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}tsvb_ViewSystem.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},tsvb_ViewSystem.extension={type:[tsvb_ExtensionType.RendererSystem,tsvb_ExtensionType.CanvasRendererSystem],name:"_view"},tsvb_extensions.add(tsvb_ViewSystem),tsvb_settings.PREFER_ENV=tsvb_ENV.WEBGL2,tsvb_settings.STRICT_TEXTURE_CACHE=!1,tsvb_settings.RENDER_OPTIONS={...tsvb_ContextSystem.defaultOptions,...tsvb_BackgroundSystem.defaultOptions,...tsvb_ViewSystem.defaultOptions,...tsvb_StartupSystem.defaultOptions},Object.defineProperties(tsvb_settings,{WRAP_MODE:{get:()=>src_tsvb_BaseTexture.defaultOptions.wrapMode,set(t){tsvb_deprecation("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),src_tsvb_BaseTexture.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>src_tsvb_BaseTexture.defaultOptions.scaleMode,set(t){tsvb_deprecation("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),src_tsvb_BaseTexture.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>src_tsvb_BaseTexture.defaultOptions.mipmap,set(t){tsvb_deprecation("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),src_tsvb_BaseTexture.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>src_tsvb_BaseTexture.defaultOptions.anisotropicLevel,set(t){tsvb_deprecation("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),src_tsvb_BaseTexture.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(tsvb_deprecation("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),src_tsvb_Filter.defaultResolution),set(t){src_tsvb_Filter.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(tsvb_deprecation("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),src_tsvb_Filter.defaultMultisample),set(t){src_tsvb_Filter.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>src_tsvb_BatchRenderer.defaultMaxTextures,set(t){tsvb_deprecation("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),src_tsvb_BatchRenderer.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>src_tsvb_BatchRenderer.defaultBatchSize,set(t){tsvb_deprecation("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),src_tsvb_BatchRenderer.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>src_tsvb_BatchRenderer.canUploadSameBuffer,set(t){tsvb_deprecation("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),src_tsvb_BatchRenderer.canUploadSameBuffer=t}},GC_MODE:{get:()=>src_tsvb_TextureGCSystem.defaultMode,set(t){tsvb_deprecation("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),src_tsvb_TextureGCSystem.defaultMode=t}},GC_MAX_IDLE:{get:()=>src_tsvb_TextureGCSystem.defaultMaxIdle,set(t){tsvb_deprecation("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),src_tsvb_TextureGCSystem.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>src_tsvb_TextureGCSystem.defaultCheckCountMax,set(t){tsvb_deprecation("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),src_tsvb_TextureGCSystem.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>src_tsvb_Program.defaultVertexPrecision,set(t){tsvb_deprecation("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),src_tsvb_Program.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>src_tsvb_Program.defaultFragmentPrecision,set(t){tsvb_deprecation("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),src_tsvb_Program.defaultFragmentPrecision=t}}});var tsvb_UPDATE_PRIORITY=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(tsvb_UPDATE_PRIORITY||{});class tsvb_TickerListener{constructor(t,e=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const tsvb_Ticker=class t{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new tsvb_TickerListener(null,null,1/0),this.deltaMS=1/t.targetFPMS,this.elapsedMS=1/t.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=tsvb_UPDATE_PRIORITY.NORMAL){return this._addListener(new tsvb_TickerListener(t,e,r))}addOnce(t,e,r=tsvb_UPDATE_PRIORITY.NORMAL){return this._addListener(new tsvb_TickerListener(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let r;if(e>this.lastTime){if(r=this.elapsedMS=e-this.lastTime,r>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){const t=e-this._lastFrame|0;if(t<this._minElapsedMS)return;this._lastFrame=e-t%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*t.targetFPMS;const n=this._head;let i=n.next;for(;i;)i=i.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const r=Math.min(this.maxFPS,e),n=Math.min(Math.max(0,r)/1e3,t.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!t._shared){const e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared}static get system(){if(!t._system){const e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system}};tsvb_Ticker.targetFPMS=.06;let src_tsvb_Ticker=tsvb_Ticker;Object.defineProperties(tsvb_settings,{TARGET_FPMS:{get:()=>src_tsvb_Ticker.targetFPMS,set(t){tsvb_deprecation("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),src_tsvb_Ticker.targetFPMS=t}}});class tsvb_TickerPlugin{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,tsvb_UPDATE_PRIORITY.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?src_tsvb_Ticker.shared:new src_tsvb_Ticker,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}tsvb_TickerPlugin.extension=tsvb_ExtensionType.Application,tsvb_extensions.add(tsvb_TickerPlugin);const tsvb_renderers=[];function tsvb_autoDetectRenderer(t){for(const e of tsvb_renderers)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}tsvb_extensions.handleByList(tsvb_ExtensionType.Renderer,tsvb_renderers);var tsvb_$defaultVertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",tsvb_$defaultFilterVertex="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";const tsvb_fragments_defaultVertex=tsvb_$defaultVertex,tsvb_defaultFilterVertex=tsvb_$defaultFilterVertex;class tsvb_MultisampleSystem{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=tsvb_MSAA_QUALITY.HIGH?this.multisample=tsvb_MSAA_QUALITY.HIGH:e>=tsvb_MSAA_QUALITY.MEDIUM?this.multisample=tsvb_MSAA_QUALITY.MEDIUM:e>=tsvb_MSAA_QUALITY.LOW?this.multisample=tsvb_MSAA_QUALITY.LOW:this.multisample=tsvb_MSAA_QUALITY.NONE}destroy(){}}tsvb_MultisampleSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"_multisample"},tsvb_extensions.add(tsvb_MultisampleSystem);class tsvb_GLBuffer{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class tsvb_BufferSystem{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const i=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,i.buffer)}}bindBufferRange(t,e,r){const{gl:n,CONTEXT_UID:i}=this;r=r||0;const s=t._glBuffers[i]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,s.buffer,256*r,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const r=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(e||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new tsvb_GLBuffer(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}tsvb_BufferSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"buffer"},tsvb_extensions.add(tsvb_BufferSystem);class tsvb_ObjectRendererSystem{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let n,i,s,o;if(e&&(n=e.renderTexture,i=e.clear,s=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!n,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=s,!r.context.isLost){if(n||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}r.renderTexture.bind(n),r.batch.currentRenderer.start(),(i??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),n&&(e.blit&&r.framebuffer.blit(),n.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}tsvb_ObjectRendererSystem.extension={type:tsvb_ExtensionType.RendererSystem,name:"objectRenderer"},tsvb_extensions.add(tsvb_ObjectRendererSystem);const tsvb_Renderer=class t extends tsvb_SystemManager{constructor(e){super(),this.type=tsvb_RENDERER_TYPE.WEBGL,e=Object.assign({},tsvb_settings.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new tsvb_UniformGroup({projectionMatrix:new tsvb_Matrix},!0);const r={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:t.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(r),"useContextAlpha"in e&&(tsvb_deprecation("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&"notMultiplied"!==e.useContextAlpha,e.backgroundAlpha=!1===e.useContextAlpha?1:e.backgroundAlpha),this._plugin.rendererPlugins=t.__plugins,this.options=e,this.startup.run(this.options)}static test(t){return!t?.forceCanvas&&tsvb_isWebGLSupported()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return tsvb_deprecation("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return tsvb_deprecation("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return tsvb_deprecation("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return tsvb_deprecation("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){tsvb_deprecation("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return tsvb_deprecation("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){tsvb_deprecation("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return tsvb_deprecation("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};tsvb_Renderer.extension={type:tsvb_ExtensionType.Renderer,priority:1},tsvb_Renderer.__plugins={},tsvb_Renderer.__systems={};let src_tsvb_Renderer=tsvb_Renderer;tsvb_extensions.handleByMap(tsvb_ExtensionType.RendererPlugin,src_tsvb_Renderer.__plugins),tsvb_extensions.handleByMap(tsvb_ExtensionType.RendererSystem,src_tsvb_Renderer.__systems),tsvb_extensions.add(src_tsvb_Renderer);class tsvb_AbstractMultiResource extends tsvb_Resource{constructor(t,e){const{width:r,height:n}=e||{};super(r,n),this.items=[],this.itemDirtyIds=[];for(let e=0;e<t;e++){const t=new src_tsvb_BaseTexture;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof tsvb_Resource?this.addResourceAt(t[r],r):this.addResourceAt(tsvb_autoDetectResource(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),this.update(),Promise.resolve(this)})),this._load}}class tsvb_ArrayResource extends tsvb_AbstractMultiResource{constructor(t,e){const{width:r,height:n}=e||{};let i,s;Array.isArray(t)?(i=t,s=t.length):s=t,super(s,{width:r,height:n}),i&&this.initFromArray(i,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=tsvb_TARGETS.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:n,itemDirtyIds:i,items:s}=this,{gl:o}=t;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,n,0,e.format,r.type,null);for(let t=0;t<n;t++){const n=s[t];i[t]<n.dirtyId&&(i[t]=n.dirtyId,n.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,t,n.resource.width,n.resource.height,1,e.format,r.type,n.resource.source))}return!0}}class tsvb_CanvasResource extends tsvb_BaseImageResource{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const tsvb_CubeResource=class t extends tsvb_AbstractMultiResource{constructor(e,r){const{width:n,height:i,autoLoad:s,linkBaseTexture:o}=r||{};if(e&&e.length!==t.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:n,height:i});for(let e=0;e<t.SIDES;e++)this.items[e].target=tsvb_TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+e;this.linkBaseTexture=!1!==o,e&&this.initFromArray(e,r),!1!==s&&this.load()}bind(t){super.bind(t),t.target=tsvb_TARGETS.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(void 0===r&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=tsvb_TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(e,r,n){const i=this.itemDirtyIds;for(let s=0;s<t.SIDES;s++){const t=this.items[s];(i[s]<t.dirtyId||n.dirtyId<r.dirtyId)&&(t.valid&&t.resource?(t.resource.upload(e,t,n),i[s]=t.dirtyId):i[s]<-1&&(e.gl.texImage2D(t.target,0,n.internalFormat,r.realWidth,r.realHeight,0,r.format,n.type,null),i[s]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===t.SIDES}};tsvb_CubeResource.SIDES=6;let src_tsvb_CubeResource=tsvb_CubeResource;class tsvb_ImageBitmapResource extends tsvb_BaseImageResource{constructor(t,e){let r,n,i;e=e||{},"string"==typeof t?(r=tsvb_ImageBitmapResource.EMPTY,n=t,i=!0):(r=t,n=null,i=!1),super(r),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??i,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await tsvb_settings.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await e.blob();if(this.destroyed)return;const n=await createImageBitmap(r,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===tsvb_ALPHA_MODES.UNPACK?"premultiply":"none"});if(this.destroyed)return void n.close();this.source=n,this.update(),t(this)}catch(t){if(this.destroyed)return;e(t),this.onError.emit(t)}else t(this)}))),this._load}upload(t,e,r){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return tsvb_ImageBitmapResource._EMPTY=tsvb_ImageBitmapResource._EMPTY??tsvb_settings.ADAPTER.createCanvas(0,0),tsvb_ImageBitmapResource._EMPTY}}const tsvb_SVGResource=class t extends tsvb_BaseImageResource{constructor(t,e){e=e||{},super(tsvb_settings.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((e=>{if(this._resolve=()=>{this.update(),e(this)},t.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;tsvb_BaseImageResource.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,i=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/r*e,i=this._overrideHeight||this._overrideWidth/e*r),n=Math.round(n),i=Math.round(i);const s=this.source;s.width=n,s.height=i,s._pixiId=`canvas_${tsvb_uid()}`,s.getContext("2d").drawImage(t,0,0,e,r,0,0,n,i),this._resolve(),this._resolve=null}}static getSize(e){const r=t.SVG_SIZE.exec(e),n={};return r&&(n[r[1]]=Math.round(parseFloat(r[3])),n[r[5]]=Math.round(parseFloat(r[7]))),n}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,r){return"svg"===r||"string"==typeof e&&e.startsWith("data:image/svg+xml")||"string"==typeof e&&t.SVG_XML.test(e)}};tsvb_SVGResource.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,tsvb_SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let src_tsvb_SVGResource=tsvb_SVGResource;class tsvb_VideoFrameResource extends tsvb_BaseImageResource{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const tsvb_VideoResource=class t extends tsvb_BaseImageResource{constructor(e,r){if(r=r||{},!(e instanceof HTMLVideoElement)){const n=document.createElement("video");!1!==r.autoLoad&&n.setAttribute("preload","auto"),!1!==r.playsinline&&(n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline","")),!0===r.muted&&(n.setAttribute("muted",""),n.muted=!0),!0===r.loop&&n.setAttribute("loop",""),!1!==r.autoPlay&&n.setAttribute("autoplay",""),"string"==typeof e&&(e=[e]);const i=e[0].src||e[0];tsvb_BaseImageResource.crossOrigin(n,i,r.crossorigin);for(let r=0;r<e.length;++r){const i=document.createElement("source");let{src:s,mime:o}=e[r];if(s=s||e[r],s.startsWith("data:"))o=s.slice(5,s.indexOf(";"));else if(!s.startsWith("blob:")){const e=s.split("?").shift().toLowerCase(),r=e.slice(e.lastIndexOf(".")+1);o=o||t.MIME_TYPES[r]||`video/${r}`}i.src=s,o&&(i.type=o),n.appendChild(i)}e=n}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=r.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==r.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==r.autoLoad&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const t=src_tsvb_Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(src_tsvb_Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(src_tsvb_Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(src_tsvb_Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,r){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||t.TYPES.includes(r)}};tsvb_VideoResource.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],tsvb_VideoResource.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let src_tsvb_VideoResource=tsvb_VideoResource;tsvb_INSTALLED.push(tsvb_ImageBitmapResource,tsvb_ImageResource,tsvb_CanvasResource,src_tsvb_VideoResource,tsvb_VideoFrameResource,src_tsvb_SVGResource,tsvb_BufferResource,src_tsvb_CubeResource,tsvb_ArrayResource);class tsvb_TransformFeedback{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new tsvb_Runner("disposeTransformFeedback")}bindBuffer(t,e){this.buffers[t]=e}destroy(){this.disposeRunner.emit(this,!1)}}const tsvb_VERSION="7.4.2";class tsvb_Bounds{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?tsvb_Rectangle.EMPTY:((t=t||new tsvb_Rectangle(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:n,c:i,d:s,tx:o,ty:a}=t,u=r*e.x+i*e.y+o,l=n*e.x+s*e.y+a;this.minX=Math.min(this.minX,u),this.maxX=Math.max(this.maxX,u),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,r=this.minY,n=this.maxX,i=this.maxY,s=t[0],o=t[1];e=s<e?s:e,r=o<r?o:r,n=s>n?s:n,i=o>i?o:i,s=t[2],o=t[3],e=s<e?s:e,r=o<r?o:r,n=s>n?s:n,i=o>i?o:i,s=t[4],o=t[5],e=s<e?s:e,r=o<r?o:r,n=s>n?s:n,i=o>i?o:i,s=t[6],o=t[7],e=s<e?s:e,r=o<r?o:r,n=s>n?s:n,i=o>i?o:i,this.minX=e,this.minY=r,this.maxX=n,this.maxY=i}addFrame(t,e,r,n,i){this.addFrameMatrix(t.worldTransform,e,r,n,i)}addFrameMatrix(t,e,r,n,i){const s=t.a,o=t.b,a=t.c,u=t.d,l=t.tx,c=t.ty;let h=this.minX,f=this.minY,d=this.maxX,p=this.maxY,v=s*e+a*r+l,y=o*e+u*r+c;h=v<h?v:h,f=y<f?y:f,d=v>d?v:d,p=y>p?y:p,v=s*n+a*r+l,y=o*n+u*r+c,h=v<h?v:h,f=y<f?y:f,d=v>d?v:d,p=y>p?y:p,v=s*e+a*i+l,y=o*e+u*i+c,h=v<h?v:h,f=y<f?y:f,d=v>d?v:d,p=y>p?y:p,v=s*n+a*i+l,y=o*n+u*i+c,h=v<h?v:h,f=y<f?y:f,d=v>d?v:d,p=y>p?y:p,this.minX=h,this.minY=f,this.maxX=d,this.maxY=p}addVertexData(t,e,r){let n=this.minX,i=this.minY,s=this.maxX,o=this.maxY;for(let a=e;a<r;a+=2){const e=t[a],r=t[a+1];n=e<n?e:n,i=r<i?r:i,s=e>s?e:s,o=r>o?r:o}this.minX=n,this.minY=i,this.maxX=s,this.maxY=o}addVertices(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)}addVerticesMatrix(t,e,r,n,i=0,s=i){const o=t.a,a=t.b,u=t.c,l=t.d,c=t.tx,h=t.ty;let f=this.minX,d=this.minY,p=this.maxX,v=this.maxY;for(let t=r;t<n;t+=2){const r=e[t],n=e[t+1],y=o*r+u*n+c,b=l*n+a*r+h;f=Math.min(f,y-i),p=Math.max(p,y+i),d=Math.min(d,b-s),v=Math.max(v,b+s)}this.minX=f,this.minY=d,this.maxX=p,this.maxY=v}addBounds(t){const e=this.minX,r=this.minY,n=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>i?t.maxY:i}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,s=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=i&&n<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=r<t?r:t,this.minY=n<e?n:e,this.maxX=i>o?i:o,this.maxY=s>a?s:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,s=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=i&&n<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=r<t?r:t,this.minY=n<e?n:e,this.maxX=i>o?i:o,this.maxY=s>a?s:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,n,i,s){t-=i,e-=s,r+=i,n+=s,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class tsvb_DisplayObject extends tsvb_utils_node_modules_eventemitter3{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new src_tsvb_Transform,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new tsvb_Bounds,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const n=e[r];Object.defineProperty(tsvb_DisplayObject.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new tsvb_Rectangle),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new tsvb_Rectangle),t=this._localBoundsRect),this._localBounds||(this._localBounds=new tsvb_Bounds);const e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=r?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,i=this._boundsID;this._bounds=this._localBounds;const s=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-i,s}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,n=1,i=0,s=0,o=0,a=0,u=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=i,this.skew.x=s,this.skew.y=o,this.pivot.x=a,this.pivot.y=u,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new tsvb_TemporaryDisplayObject),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*tsvb_RAD_TO_DEG}set angle(t){this.transform.rotation=t*tsvb_DEG_TO_RAD}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class tsvb_TemporaryDisplayObject extends tsvb_DisplayObject{constructor(){super(...arguments),this.sortDirty=null}}tsvb_DisplayObject.prototype.displayObjectUpdateTransform=tsvb_DisplayObject.prototype.updateTransform;const tsvb_Container_tempMatrix=new tsvb_Matrix;function tsvb_sortChildren(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const tsvb_Container=class t extends tsvb_DisplayObject{constructor(){super(),this.children=[],this.sortableChildren=t.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);tsvb_removeItems(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(-1===r)return null;e.parent=null,e.transform._parentID=-1,tsvb_removeItems(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,tsvb_removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,n=e-r;let i;if(n>0&&n<=e){i=this.children.splice(r,n);for(let t=0;t<i.length;++t)i[t].parent=null,i[t].transform&&(i[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<i.length;++t)i[t].emit("removed",this),this.emit("childRemoved",i[t],this,t);return i}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const r=this.children[e];r._lastSortedIndex=e,!t&&0!==r.zIndex&&(t=!0)}t&&this.children.length>1&&this.children.sort(tsvb_sortChildren),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const r=e.renderTexture.sourceFrame;if(!(r.width>0&&r.height>0))return;let n,i;this.cullArea?(n=this.cullArea,i=this.worldTransform):this._render!==t.prototype._render&&(n=this.getBounds(!0));const s=e.projection.transform;if(s&&(i?(i=tsvb_Container_tempMatrix.copyFrom(i),i.prepend(s)):i=s),n&&r.intersects(n,i))this._render(e);else if(this.cullArea)return;for(let t=0,r=this.children.length;t<r;++t){const r=this.children[t],n=r.cullable;r.cullable=n||!this.cullArea,r.render(e),r.cullable=n}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<e.length;t++)e[t].enabled&&this._enabledFilters.push(e[t])}const n=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==tsvb_MASK_TYPES.NONE));if(n&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}n&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let e=0;e<r.length;++e)r[e].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};tsvb_Container.defaultSortableChildren=!1;let src_tsvb_Container=tsvb_Container;src_tsvb_Container.prototype.containerUpdateTransform=src_tsvb_Container.prototype.updateTransform,Object.defineProperties(tsvb_settings,{SORTABLE_CHILDREN:{get:()=>src_tsvb_Container.defaultSortableChildren,set(t){tsvb_deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),src_tsvb_Container.defaultSortableChildren=t}}});const tsvb_tempPoint=new tsvb_Point,tsvb_indices=new Uint16Array([0,1,2,0,2,3]);class tsvb_Sprite extends src_tsvb_Container{constructor(t){super(),this._anchor=new tsvb_ObservablePoint(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new src_tsvb_Color(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=tsvb_BLEND_MODES.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||tsvb_Texture_Texture.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=tsvb_indices,this.pluginName="batch",this.isSprite=!0,this._roundPixels=tsvb_settings.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=tsvb_sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=tsvb_sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,n=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,u=this.vertexData,l=t.trim,c=t.orig,h=this._anchor;let f=0,d=0,p=0,v=0;if(l?(d=l.x-h._x*c.width,f=d+l.width,v=l.y-h._y*c.height,p=v+l.height):(d=-h._x*c.width,f=d+c.width,v=-h._y*c.height,p=v+c.height),u[0]=r*d+i*v+o,u[1]=s*v+n*d+a,u[2]=r*f+i*v+o,u[3]=s*v+n*f+a,u[4]=r*f+i*p+o,u[5]=s*p+n*f+a,u[6]=r*d+i*p+o,u[7]=s*p+n*d+a,this._roundPixels){const t=tsvb_settings.RESOLUTION;for(let e=0;e<u.length;++e)u[e]=Math.round(u[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,n=this._anchor,i=this.transform.worldTransform,s=i.a,o=i.b,a=i.c,u=i.d,l=i.tx,c=i.ty,h=-n._x*r.width,f=h+r.width,d=-n._y*r.height,p=d+r.height;if(e[0]=s*h+a*d+l,e[1]=u*d+o*h+c,e[2]=s*f+a*d+l,e[3]=u*d+o*f+c,e[4]=s*f+a*p+l,e[5]=u*p+o*f+c,e[6]=s*h+a*p+l,e[7]=u*p+o*h+c,this._roundPixels){const t=tsvb_settings.RESOLUTION;for(let r=0;r<e.length;++r)e[r]=Math.round(e[r]*t)/t}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new tsvb_Bounds),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new tsvb_Rectangle),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,tsvb_tempPoint);const e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x;let i=0;return tsvb_tempPoint.x>=n&&tsvb_tempPoint.x<n+e&&(i=-r*this.anchor.y,tsvb_tempPoint.y>=i&&tsvb_tempPoint.y<i+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof tsvb_Texture_Texture?t:tsvb_Texture_Texture.from(t,e);return new tsvb_Sprite(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=tsvb_sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=tsvb_sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||tsvb_Texture_Texture.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const src_tsvb_tempMatrix=new tsvb_Matrix;tsvb_DisplayObject.prototype._cacheAsBitmap=!1,tsvb_DisplayObject.prototype._cacheData=null,tsvb_DisplayObject.prototype._cacheAsBitmapResolution=null,tsvb_DisplayObject.prototype._cacheAsBitmapMultisample=null;class tsvb_CacheData{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(tsvb_DisplayObject.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new tsvb_CacheData),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),tsvb_DisplayObject.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},tsvb_DisplayObject.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const r=this.getLocalBounds(new tsvb_Rectangle,!0);if(this.filters?.length){const t=this.filters[0].padding;r.pad(t)}const n=this.cacheAsBitmapResolution||t.resolution;r.ceil(n),r.width=Math.max(r.width,1/n),r.height=Math.max(r.height,1/n);const i=t.renderTexture.current,s=t.renderTexture.sourceFrame.clone(),o=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,u=tsvb_RenderTexture.create({width:r.width,height:r.height,resolution:n,multisample:this.cacheAsBitmapMultisample??t.multisample}),l=`cacheAsBitmap_${tsvb_uid()}`;this._cacheData.textureCacheId=l,src_tsvb_BaseTexture.addToCache(u.baseTexture,l),tsvb_Texture_Texture.addToCache(u,l);const c=this.transform.localTransform.copyTo(src_tsvb_tempMatrix).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:u,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(i,s,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const h=new tsvb_Sprite(u);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-r.x/r.width,h.anchor.y=-r.y/r.height,h.alpha=e,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=h.containsPoint.bind(h)},tsvb_DisplayObject.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},tsvb_DisplayObject.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(new tsvb_Rectangle,!0),r=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,i=t._projTransform,s=this.cacheAsBitmapResolution||t.resolution;e.ceil(s),e.width=Math.max(e.width,1/s),e.height=Math.max(e.height,1/s);const o=tsvb_RenderTexture.create({width:e.width,height:e.height,resolution:s}),a=`cacheAsBitmap_${tsvb_uid()}`;this._cacheData.textureCacheId=a,src_tsvb_BaseTexture.addToCache(o.baseTexture,a),tsvb_Texture_Texture.addToCache(o,a);const u=src_tsvb_tempMatrix;this.transform.localTransform.copyTo(u),u.invert(),u.tx-=e.x,u.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:u,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=i,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const l=new tsvb_Sprite(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-e.x/e.width,l.anchor.y=-e.y/e.height,l.alpha=r,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)},tsvb_DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},tsvb_DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},tsvb_DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,src_tsvb_BaseTexture.removeFromCache(this._cacheData.textureCacheId),tsvb_Texture_Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},tsvb_DisplayObject.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},tsvb_DisplayObject.prototype.name=null,src_tsvb_Container.prototype.getChildByName=function(t,e){for(let e=0,r=this.children.length;e<r;e++)if(this.children[e].name===t)return this.children[e];if(e)for(let e=0,r=this.children.length;e<r;e++){const r=this.children[e];if(!r.getChildByName)continue;const n=r.getChildByName(t,!0);if(n)return n}return null},tsvb_DisplayObject.prototype.getGlobalPosition=function(t=new tsvb_Point,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var tsvb_alpha_frag_fragment="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n";class tsvb_AlphaFilter extends src_tsvb_Filter{constructor(t=1){super(tsvb_fragments_defaultVertex,tsvb_alpha_frag_fragment,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const tsvb_GAUSSIAN_VALUES={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},tsvb_generateBlurFragSource_fragTemplate=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");function tsvb_generateBlurFragSource(t){const e=tsvb_GAUSSIAN_VALUES[t],r=e.length;let n=tsvb_generateBlurFragSource_fragTemplate,i="";let s;for(let n=0;n<t;n++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",n.toString());s=n,n>=r&&(s=t-n-1),o=o.replace("%value%",e[s].toString()),i+=o,i+="\n"}return n=n.replace("%blur%",i),n=n.replace("%size%",t.toString()),n}const tsvb_vertTemplate="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }";function tsvb_generateBlurVertSource(t,e){const r=Math.ceil(t/2);let n,i=tsvb_vertTemplate,s="";n=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let e=0;e<t;e++){let t=n.replace("%index%",e.toString());t=t.replace("%sampleIndex%",e-(r-1)+".0"),s+=t,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",t.toString()),i}class tsvb_BlurFilterPass extends src_tsvb_Filter{constructor(t,e=8,r=4,n=src_tsvb_Filter.defaultResolution,i=5){super(tsvb_generateBlurVertSource(i,t),tsvb_generateBlurFragSource(i)),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,n){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,n);else{const i=t.getFilterTexture(),s=t.renderer;let o=e,a=i;this.state.blend=!1,t.applyFilter(this,o,a,tsvb_CLEAR_MODES.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,tsvb_CLEAR_MODES.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,s.shader.bind(this),s.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,r,n),t.returnFilterTexture(i)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class tsvb_BlurFilter extends src_tsvb_Filter{constructor(t=8,e=4,r=src_tsvb_Filter.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new tsvb_BlurFilterPass(!0,t,e,r,n),this.blurYFilter=new tsvb_BlurFilterPass(!1,t,e,r,n),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,n){const i=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(i&&s){const i=t.getFilterTexture();this.blurXFilter.apply(t,e,i,tsvb_CLEAR_MODES.CLEAR),this.blurYFilter.apply(t,i,r,n),t.returnFilterTexture(i)}else s?this.blurYFilter.apply(t,e,r,n):this.blurXFilter.apply(t,e,r,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var tsvb_colorMatrix_frag_fragment="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n";class tsvb_ColorMatrixFilter extends src_tsvb_Filter{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(tsvb_defaultFilterVertex,tsvb_colorMatrix_frag_fragment,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,n,i]=src_tsvb_Color.shared.setValue(t).toArray(),s=[r,0,0,0,0,0,n,0,0,0,0,0,i,0,0,0,0,0,1,0];this._loadMatrix(s,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),n=Math.sin(t),i=1/3,s=(0,Math.sqrt)(i),o=[r+(1-r)*i,i*(1-r)-s*n,i*(1-r)+s*n,0,0,i*(1-r)+s*n,r+i*(1-r),i*(1-r)-s*n,0,0,i*(1-r)-s*n,i*(1-r)+s*n,r+i*(1-r),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const r=(t||0)+1,n=-.5*(r-1),i=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(i,e)}saturate(t=0,e){const r=2*t/3+1,n=-.5*(r-1),i=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(i,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,r,n,i){t=t||.2,e=e||.15,r=r||16770432,n=n||3375104;const s=src_tsvb_Color.shared,[o,a,u]=s.setValue(r).toArray(),[l,c,h]=s.setValue(n).toArray(),f=[.3,.59,.11,0,0,o,a,u,t,0,l,c,h,e,0,o-l,a-c,u-h,0,0];this._loadMatrix(f,i)}night(t,e){const r=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}tsvb_ColorMatrixFilter.prototype.grayscale=tsvb_ColorMatrixFilter.prototype.greyscale;var tsvb_displacement_frag_fragment="varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",tsvb_displacement_vert_vertex="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n";class tsvb_DisplacementFilter extends src_tsvb_Filter{constructor(t,e){const r=new tsvb_Matrix;t.renderable=!1,super(tsvb_displacement_vert_vertex,tsvb_displacement_frag_fragment,{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,null==e&&(e=20),this.scale=new tsvb_Point(e,e)}apply(t,e,r,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const i=this.maskSprite.worldTransform,s=Math.sqrt(i.a*i.a+i.b*i.b),o=Math.sqrt(i.c*i.c+i.d*i.d);0!==s&&0!==o&&(this.uniforms.rotation[0]=i.a/s,this.uniforms.rotation[1]=i.b/s,this.uniforms.rotation[2]=i.c/o,this.uniforms.rotation[3]=i.d/o),t.applyFilter(this,e,r,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var tsvb_fxaa_frag_fragment='varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n',tsvb_fxaa_vert_vertex="\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n";class tsvb_FXAAFilter extends src_tsvb_Filter{constructor(){super(tsvb_fxaa_vert_vertex,tsvb_fxaa_frag_fragment)}}var tsvb_noise_frag_fragment="precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n";class tsvb_NoiseFilter extends src_tsvb_Filter{constructor(t=.5,e=Math.random()){super(tsvb_defaultFilterVertex,tsvb_noise_frag_fragment,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const tsvb_filters={AlphaFilter:tsvb_AlphaFilter,BlurFilter:tsvb_BlurFilter,BlurFilterPass:tsvb_BlurFilterPass,ColorMatrixFilter:tsvb_ColorMatrixFilter,DisplacementFilter:tsvb_DisplacementFilter,FXAAFilter:tsvb_FXAAFilter,NoiseFilter:tsvb_NoiseFilter};Object.entries(tsvb_filters).forEach((([t,e])=>{Object.defineProperty(tsvb_filters,t,{get:()=>(tsvb_deprecation("7.1.0",`filters.${t} has moved to ${t}`),e)})}));class tsvb_EventsTickerClass{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(src_tsvb_Ticker.system.add(this.tickerUpdate,this,tsvb_UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(src_tsvb_Ticker.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const tsvb_EventsTicker=new tsvb_EventsTickerClass;class tsvb_FederatedEvent{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=tsvb_FederatedEvent.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new tsvb_Point,this.page=new tsvb_Point,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,n,i){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class tsvb_FederatedMouseEvent extends tsvb_FederatedEvent{constructor(){super(...arguments),this.client=new tsvb_Point,this.movement=new tsvb_Point,this.offset=new tsvb_Point,this.global=new tsvb_Point,this.screen=new tsvb_Point}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,n,i,s,o,a,u,l,c,h,f,d,p){throw new Error("Method not implemented.")}}class tsvb_FederatedPointerEvent extends tsvb_FederatedMouseEvent{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class tsvb_FederatedWheelEvent extends tsvb_FederatedMouseEvent{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}tsvb_FederatedWheelEvent.DOM_DELTA_PIXEL=0,tsvb_FederatedWheelEvent.DOM_DELTA_LINE=1,tsvb_FederatedWheelEvent.DOM_DELTA_PAGE=2;const tsvb_PROPAGATION_LIMIT=2048,tsvb_tempHitLocation=new tsvb_Point,tsvb_tempLocalMapping=new tsvb_Point;class tsvb_EventBoundary{constructor(t){this.dispatch=new tsvb_utils_node_modules_eventemitter3,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,n=e.length;r<n;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){tsvb_EventsTicker.pauseUpdate=!0;const r=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,tsvb_tempHitLocation.set(t,e),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,i=r.length-1;n<i;n++)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=r.length-2;n>=0;n--)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(0===r.length)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let e=r.length-1;e>=0;e--)n.forEach((n=>{t.currentTarget=r[e],this.notifyTarget(t,n)}))}propagationPath(t){const e=[t];for(let r=0;r<tsvb_PROPAGATION_LIMIT&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,n,i,s=!1){let o=!1;if(this._interactivePrune(t))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(tsvb_EventsTicker.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let u=a.length-1;u>=0;u--){const l=a[u],c=this.hitTestMoveRecursive(l,this._isInteractive(e)?e:l.eventMode,r,n,i,s||i(t,r));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const e=t.isInteractive();(c.length>0||e)&&(e&&this._allInteractiveElements.push(t),c.push(t)),0===this._hitElements.length&&(this._hitElements=c),o=!0}}}const a=this._isInteractive(e),u=t.isInteractive();return a&&u&&this._allInteractiveElements.push(t),s||this._hitElements.length>0?null:o?this._hitElements:a&&!i(t,r)&&n(t,r)?u?[t]:[]:null}hitTestRecursive(t,e,r,n,i){if(this._interactivePrune(t)||i(t,r))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(tsvb_EventsTicker.pauseUpdate=!1),t.interactiveChildren&&t.children){const s=t.children;for(let o=s.length-1;o>=0;o--){const a=s[o],u=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,r,n,i);if(u){if(u.length>0&&!u[u.length-1].parent)continue;const e=t.isInteractive();return(u.length>0||e)&&u.push(t),u}}}const s=this._isInteractive(e),o=t.isInteractive();return s&&n(t,r)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable&&"none"!==t.eventMode&&("passive"!==t.eventMode||t.interactiveChildren)&&!t.isMask)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,tsvb_tempLocalMapping),!t.hitArea.contains(tsvb_tempLocalMapping.x,tsvb_tempLocalMapping.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!r.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){const r=`on${e=e??t.type}`;t.currentTarget[r]?.(t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof tsvb_FederatedPointerEvent))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof tsvb_FederatedPointerEvent))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r="mouse"===e.pointerType||"pen"===e.pointerType,n=this.trackingData(t.pointerId),i=this.findMountedTarget(n.overTargets);if(n.overTargets?.length>0&&i!==e.target){const n="mousemove"===t.type?"mouseout":"pointerout",s=this.createPointerEvent(t,n,i);if(this.dispatchEvent(s,"pointerout"),r&&this.dispatchEvent(s,"mouseout"),!e.composedPath().includes(i)){const n=this.createPointerEvent(t,"pointerleave",i);for(n.eventPhase=n.AT_TARGET;n.target&&!e.composedPath().includes(n.target);)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;this.freeEvent(n)}this.freeEvent(s)}if(i!==e.target){const n="mousemove"===t.type?"mouseover":"pointerover",s=this.clonePointerEvent(e,n);this.dispatchEvent(s,"pointerover"),r&&this.dispatchEvent(s,"mouseover");let o=i?.parent;for(;o&&o!==this.rootTarget.parent&&o!==e.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==i&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),r&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(s)}const s=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?s.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&s.push("globalpointermove"),"touch"===e.pointerType&&(this.moveOnAll?s.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&s.push("globaltouchmove")),r&&(this.moveOnAll?s.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&s.push("globalmousemove"),this.cursor=e.target?.cursor),s.length>0&&this.all(e,s),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof tsvb_FederatedPointerEvent))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),n="mouse"===r.pointerType||"pen"===r.pointerType;this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursor=r.target?.cursor);const i=this.clonePointerEvent(r,"pointerenter");for(i.eventPhase=i.AT_TARGET;i.target&&i.target!==this.rootTarget.parent;)i.currentTarget=i.target,this.notifyTarget(i),n&&this.notifyTarget(i,"mouseenter"),i.target=i.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(i)}mapPointerOut(t){if(!(t instanceof tsvb_FederatedPointerEvent))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const r="mouse"===t.pointerType||"pen"===t.pointerType,n=this.findMountedTarget(e.overTargets),i=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(i),r&&this.dispatchEvent(i,"mouseout");const s=this.createPointerEvent(t,"pointerleave",n);for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),r&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;e.overTargets=null,this.freeEvent(i),this.freeEvent(s)}this.cursor=null}mapPointerUp(t){if(!(t instanceof tsvb_FederatedPointerEvent))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),"touch"===r.pointerType)this.dispatchEvent(r,"touchend");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.dispatchEvent(r,t?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),i=this.findMountedTarget(n.pressTargetsByButton[t.button]);let s=i;if(i&&!r.composedPath().includes(i)){let e=i;for(;e&&!r.composedPath().includes(e);){if(r.currentTarget=e,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType)this.notifyTarget(r,"touchendoutside");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.notifyTarget(r,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete n.pressTargetsByButton[t.button],s=e}if(s){const i=this.clonePointerEvent(r,"click");i.target=s,i.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:i.target,timeStamp:e});const o=n.clicksByButton[t.button];if(o.target===i.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=i.target,o.timeStamp=e,i.detail=o.clickCount,"mouse"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightclick":"click")}else"touch"===i.pointerType&&this.dispatchEvent(i,"tap");this.dispatchEvent(i,"pointertap"),this.freeEvent(i)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof tsvb_FederatedPointerEvent))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(r){let i=r;for(;i;)n.currentTarget=i,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):("mouse"===n.pointerType||"pen"===n.pointerType)&&this.notifyTarget(n,2===n.button?"rightupoutside":"mouseupoutside"),i=i.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof tsvb_FederatedWheelEvent))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const n=this.allocateEvent(tsvb_FederatedPointerEvent);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=r??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],"string"==typeof e&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(tsvb_FederatedWheelEvent);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(tsvb_FederatedPointerEvent);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof tsvb_FederatedPointerEvent&&e instanceof tsvb_FederatedPointerEvent&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof tsvb_FederatedMouseEvent&&e instanceof tsvb_FederatedMouseEvent&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let n=0,i=r.length;n<i&&!t.propagationImmediatelyStopped;n++)r[n].once&&t.currentTarget.removeListener(e,r[n].fn,void 0,!0),r[n].fn.call(r[n].context,t)}}const tsvb_MOUSE_POINTER_ID=1,tsvb_TOUCH_TO_POINTER={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},tsvb_EventSystem=class t{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new tsvb_EventBoundary(null),tsvb_EventsTicker.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new tsvb_FederatedPointerEvent(null),this.rootWheelEvent=new tsvb_FederatedWheelEvent(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...t.defaultEventFeatures},{set:(t,e,r)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=r),t[e]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:r,resolution:n}=this.renderer;this.setTargetElement(r),this.resolution=n,t._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,r=e.length;t<r;t++){const r=e[t],n=this.bootstrapEvent(this.rootPointerEvent,r);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,tsvb_EventsTicker.pointerMoved();const e=this.normalizeToPointerData(t);for(let t=0,r=e.length;t<r;t++){const r=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let t=0,e=n.length;t<e;t++){const e=this.bootstrapEvent(this.rootPointerEvent,n[t]);e.type+=r,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let t=0,r=e.length;t<r;t++){const r=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,tsvb_EventsTicker.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;tsvb_EventsTicker.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;tsvb_EventsTicker.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},i=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*i,t.y=(r-n.top)*(this.domElement.height/n.height)*i}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,n=t.changedTouches.length;r<n;r++){const n=t.changedTouches[r];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=tsvb_MOUSE_POINTER_ID),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=tsvb_TOUCH_TO_POINTER[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};tsvb_EventSystem.extension={name:"events",type:[tsvb_ExtensionType.RendererSystem,tsvb_ExtensionType.CanvasRendererSystem]},tsvb_EventSystem.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let src_tsvb_EventSystem=tsvb_EventSystem;function tsvb_convertEventModeToInteractiveMode(t){return"dynamic"===t||"static"===t}tsvb_extensions.add(src_tsvb_EventSystem);const tsvb_FederatedDisplayObject={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??tsvb_convertEventModeToInteractiveMode(src_tsvb_EventSystem.defaultEventMode)},set interactive(t){tsvb_deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??src_tsvb_EventSystem.defaultEventMode},set eventMode(t){this._internalInteractive=tsvb_convertEventModeToInteractiveMode(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,r){const n="boolean"==typeof r&&r||"object"==typeof r&&r.capture,i="object"==typeof r?r.signal:void 0,s="object"==typeof r&&!0===r.once,o="function"==typeof e?void 0:e;t=n?`${t}capture`:t;const a="function"==typeof e?e:e.handleEvent,u=this;i&&i.addEventListener("abort",(()=>{u.off(t,a,o)})),s?u.once(t,a,o):u.on(t,a,o)},removeEventListener(t,e,r){const n="function"==typeof e?void 0:e;t="boolean"==typeof r&&r||"object"==typeof r&&r.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,n)},dispatchEvent(t){if(!(t instanceof tsvb_FederatedEvent))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};tsvb_DisplayObject.mixin(tsvb_FederatedDisplayObject);const tsvb_accessibleTarget={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};tsvb_DisplayObject.mixin(tsvb_accessibleTarget);const tsvb_KEY_CODE_TAB=9,tsvb_DIV_TOUCH_SIZE=100,tsvb_DIV_TOUCH_POS_X=0,tsvb_DIV_TOUCH_POS_Y=0,tsvb_DIV_TOUCH_ZINDEX=2,tsvb_DIV_HOOK_SIZE=1,tsvb_DIV_HOOK_POS_X=-1e3,tsvb_DIV_HOOK_POS_Y=-1e3,tsvb_DIV_HOOK_ZINDEX=2;class tsvb_AccessibilityManager{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(tsvb_isMobile_isMobile.tablet||tsvb_isMobile_isMobile.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${tsvb_DIV_TOUCH_SIZE}px`,e.style.height=`${tsvb_DIV_TOUCH_SIZE}px`,e.style.position="absolute",e.style.top=`${tsvb_DIV_TOUCH_POS_X}px`,e.style.left=`${tsvb_DIV_TOUCH_POS_Y}px`,e.style.zIndex=tsvb_DIV_TOUCH_ZINDEX.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${tsvb_DIV_HOOK_SIZE}px`,t.style.height=`${tsvb_DIV_HOOK_SIZE}px`,t.style.position="absolute",t.style.top=`${tsvb_DIV_HOOK_POS_X}px`,t.style.left=`${tsvb_DIV_HOOK_POS_Y}px`,t.style.zIndex=tsvb_DIV_HOOK_ZINDEX.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this.updateAccessibleObjects(e[t])}update(){const t=performance.now();if(tsvb_isMobile_isMobile.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:n,height:i}=this.renderer.view.getBoundingClientRect(),{width:s,height:o,resolution:a}=this.renderer,u=n/s*a,l=i/o*a;let c=this.div;c.style.left=`${e}px`,c.style.top=`${r}px`,c.style.width=`${s}px`,c.style.height=`${o}px`;for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.renderId!==this.renderId)e._accessibleActive=!1,tsvb_removeItems(this.children,t,1),this.div.removeChild(e._accessibleDiv),this.pool.push(e._accessibleDiv),e._accessibleDiv=null,t--;else{c=e._accessibleDiv;let t=e.hitArea;const r=e.worldTransform;e.hitArea?(c.style.left=(r.tx+t.x*r.a)*u+"px",c.style.top=(r.ty+t.y*r.d)*l+"px",c.style.width=t.width*r.a*u+"px",c.style.height=t.height*r.d*l+"px"):(t=e.getBounds(),this.capHitArea(t),c.style.left=t.x*u+"px",c.style.top=t.y*l+"px",c.style.width=t.width*u+"px",c.style.height=t.height*l+"px",c.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(c.title=e.accessibleTitle),c.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&c.setAttribute("aria-label",e.accessibleHint)),(e.accessibleTitle!==c.title||e.tabIndex!==c.tabIndex)&&(c.title=e.accessibleTitle,c.tabIndex=e.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${tsvb_DIV_TOUCH_SIZE}px`,e.style.height=`${tsvb_DIV_TOUCH_SIZE}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=tsvb_DIV_TOUCH_ZINDEX.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:(!t.accessibleHint||null===t.accessibleHint)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,n=this.renderer.events.rootBoundary,i=Object.assign(new tsvb_FederatedEvent(n),{target:r});n.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>n.dispatchEvent(i,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===tsvb_KEY_CODE_TAB&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}tsvb_AccessibilityManager.extension={name:"accessibility",type:[tsvb_ExtensionType.RendererPlugin,tsvb_ExtensionType.CanvasRendererPlugin]},tsvb_extensions.add(tsvb_AccessibilityManager);const tsvb_Application=class t{constructor(e){this.stage=new src_tsvb_Container,e=Object.assign({forceCanvas:!1},e),this.renderer=tsvb_autoDetectRenderer(e),t._plugins.forEach((t=>{t.init.call(this,e)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(e,r){const n=t._plugins.slice(0);n.reverse(),n.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null}};tsvb_Application._plugins=[];let src_tsvb_Application=tsvb_Application;tsvb_extensions.handleByList(tsvb_ExtensionType.Application,src_tsvb_Application._plugins);class tsvb_ResizePlugin{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:n}=this._resizeTo;t=r,e=n}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}tsvb_ResizePlugin.extension=tsvb_ExtensionType.Application,tsvb_extensions.add(tsvb_ResizePlugin);const tsvb_assetKeyMap={loader:tsvb_ExtensionType.LoadParser,resolver:tsvb_ExtensionType.ResolveParser,cache:tsvb_ExtensionType.CacheParser,detection:tsvb_ExtensionType.DetectionParser};tsvb_extensions.handle(tsvb_ExtensionType.Asset,(t=>{const e=t.ref;Object.entries(tsvb_assetKeyMap).filter((([t])=>!!e[t])).forEach((([t,r])=>tsvb_extensions.add(Object.assign(e[t],{extension:e[t].extension??r}))))}),(t=>{const e=t.ref;Object.keys(tsvb_assetKeyMap).filter((t=>!!e[t])).forEach((t=>tsvb_extensions.remove(e[t])))}));class tsvb_BackgroundLoader{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function tsvb_checkExtension(t,e){const r=t.split("?")[0],n=tsvb_path.extname(r).toLowerCase();return Array.isArray(e)?e.includes(n):n===e}const tsvb_convertToList=(t,e,r=!1)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t||r?e(t):t)):t);class tsvb_CacheClass{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=tsvb_convertToList(t);let n;for(let t=0;t<this.parsers.length;t++){const i=this.parsers[t];if(i.test(e)){n=i.getCacheableAssets(r,e);break}}n||(n={},r.forEach((t=>{n[t]=e})));const i=Object.keys(n),s={cacheKeys:i,keys:r};if(r.forEach((t=>{this._cacheMap.set(t,s)})),i.forEach((t=>{this._cache.has(t)&&this._cache.get(t)!==e&&console.warn("[Cache] already has key:",t),this._cache.set(t,n[t])})),e instanceof tsvb_Texture_Texture){const t=e;r.forEach((e=>{t.baseTexture!==tsvb_Texture_Texture.EMPTY.baseTexture&&src_tsvb_BaseTexture.addToCache(t.baseTexture,e),tsvb_Texture_Texture.addToCache(t,e)}))}}remove(t){if(!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}}const tsvb_Cache=new tsvb_CacheClass,tsvb_isSingleItem=t=>!Array.isArray(t);class tsvb_Loader{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{let n=null,i=null;if(e.loadParser&&(i=this._parserHash[e.loadParser],i||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!i){for(let r=0;r<this.parsers.length;r++){const n=this.parsers[r];if(n.load&&n.test?.(t,e,this)){i=n;break}}if(!i)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await i.load(t,e,this),r.parser=i;for(let t=0;t<this.parsers.length;t++){const i=this.parsers[t];i.parse&&i.parse&&await(i.testParse?.(n,e,this))&&(n=await i.parse(n,e,this)||n,r.parser=i)}return n})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const n={},i=tsvb_isSingleItem(t),s=tsvb_convertToList(t,(t=>({alias:[t],src:t}))),o=s.length,a=s.map((async t=>{const i=tsvb_path.toAbsolute(t.src);if(!n[t.src])try{this.promiseCache[i]||(this.promiseCache[i]=this._getLoadPromiseAndParser(i,t)),n[t.src]=await this.promiseCache[i].promise,e&&e(++r/o)}catch(e){throw delete this.promiseCache[i],delete n[t.src],new Error(`[Loader.load] Failed to load ${i}.\n${e}`)}}));return await Promise.all(a),i?n[s[0].src]:n}async unload(t){const e=tsvb_convertToList(t,(t=>({alias:[t],src:t}))).map((async t=>{const e=tsvb_path.toAbsolute(t.src),r=this.promiseCache[e];if(r){const n=await r.promise;delete this.promiseCache[e],r.parser?.unload?.(n,t,this)}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e})),{})}}var tsvb_LoaderParserPriority=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(tsvb_LoaderParserPriority||{});function tsvb_checkDataUrl(t,e){if(Array.isArray(e)){for(const r of e)if(t.startsWith(`data:${r}`))return!0;return!1}return t.startsWith(`data:${e}`)}const tsvb_validJSONExtension=".json",tsvb_validJSONMIME="application/json",tsvb_loadJson={extension:{type:tsvb_ExtensionType.LoadParser,priority:tsvb_LoaderParserPriority.Low},name:"loadJson",test:t=>tsvb_checkDataUrl(t,tsvb_validJSONMIME)||tsvb_checkExtension(t,tsvb_validJSONExtension),load:async t=>await(await tsvb_settings.ADAPTER.fetch(t)).json()};tsvb_extensions.add(tsvb_loadJson);const tsvb_validTXTExtension=".txt",tsvb_validTXTMIME="text/plain",tsvb_loadTxt={name:"loadTxt",extension:{type:tsvb_ExtensionType.LoadParser,priority:tsvb_LoaderParserPriority.Low},test:t=>tsvb_checkDataUrl(t,tsvb_validTXTMIME)||tsvb_checkExtension(t,tsvb_validTXTExtension),load:async t=>await(await tsvb_settings.ADAPTER.fetch(t)).text()};tsvb_extensions.add(tsvb_loadTxt);const tsvb_validWeights=["normal","bold","100","200","300","400","500","600","700","800","900"],tsvb_validFontExtensions=[".ttf",".otf",".woff",".woff2"],tsvb_validFontMIMEs=["font/ttf","font/otf","font/woff","font/woff2"],tsvb_CSS_IDENT_TOKEN_REGEX=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function tsvb_getFontFamilyName(t){const e=tsvb_path.extname(t),r=tsvb_path.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let n=r.length>0;for(const t of r)if(!t.match(tsvb_CSS_IDENT_TOKEN_REGEX)){n=!1;break}let i=r.join(" ");return n||(i=`"${i.replace(/[\\"]/g,"\\$&")}"`),i}const tsvb_validURICharactersRegex=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function tsvb_encodeURIWhenNeeded(t){return tsvb_validURICharactersRegex.test(t)?t:encodeURI(t)}const tsvb_loadWebFont={extension:{type:tsvb_ExtensionType.LoadParser,priority:tsvb_LoaderParserPriority.Low},name:"loadWebFont",test:t=>tsvb_checkDataUrl(t,tsvb_validFontMIMEs)||tsvb_checkExtension(t,tsvb_validFontExtensions),async load(t,e){const r=tsvb_settings.ADAPTER.getFontFaceSet();if(r){const n=[],i=e.data?.family??tsvb_getFontFamilyName(t),s=e.data?.weights?.filter((t=>tsvb_validWeights.includes(t)))??["normal"],o=e.data??{};for(let e=0;e<s.length;e++){const a=s[e],u=new FontFace(i,`url(${tsvb_encodeURIWhenNeeded(t)})`,{...o,weight:a});await u.load(),r.add(u),n.push(u)}return 1===n.length?n[0]:n}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>tsvb_settings.ADAPTER.getFontFaceSet().delete(t)))}};tsvb_extensions.add(tsvb_loadWebFont);const tsvb_WORKER_CODE='(function() {\n  "use strict";\n  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";\n  async function checkImageBitmap() {\n    try {\n      if (typeof createImageBitmap != "function")\n        return !1;\n      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);\n      return imageBitmap.width === 1 && imageBitmap.height === 1;\n    } catch {\n      return !1;\n    }\n  }\n  checkImageBitmap().then((result) => {\n    self.postMessage(result);\n  });\n})();\n';let tsvb_WORKER_URL=null;class tsvb_WorkerInstance{constructor(){tsvb_WORKER_URL||(tsvb_WORKER_URL=URL.createObjectURL(new Blob([tsvb_WORKER_CODE],{type:"application/javascript"}))),this.worker=new Worker(tsvb_WORKER_URL)}}tsvb_WorkerInstance.revokeObjectURL=function(){tsvb_WORKER_URL&&(URL.revokeObjectURL(tsvb_WORKER_URL),tsvb_WORKER_URL=null)};const tsvb_loadImageBitmap_worker_WORKER_CODE='(function() {\n  "use strict";\n  async function loadImageBitmap(url) {\n    const response = await fetch(url);\n    if (!response.ok)\n      throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n    const imageBlob = await response.blob();\n    return await createImageBitmap(imageBlob);\n  }\n  self.onmessage = async (event) => {\n    try {\n      const imageBitmap = await loadImageBitmap(event.data.data[0]);\n      self.postMessage({\n        data: imageBitmap,\n        uuid: event.data.uuid,\n        id: event.data.id\n      }, [imageBitmap]);\n    } catch (e) {\n      self.postMessage({\n        error: e,\n        uuid: event.data.uuid,\n        id: event.data.id\n      });\n    }\n  };\n})();\n';let tsvb_loadImageBitmap_worker_WORKER_URL=null;class tsvb_loadImageBitmap_worker_WorkerInstance{constructor(){tsvb_loadImageBitmap_worker_WORKER_URL||(tsvb_loadImageBitmap_worker_WORKER_URL=URL.createObjectURL(new Blob([tsvb_loadImageBitmap_worker_WORKER_CODE],{type:"application/javascript"}))),this.worker=new Worker(tsvb_loadImageBitmap_worker_WORKER_URL)}}tsvb_loadImageBitmap_worker_WorkerInstance.revokeObjectURL=function(){tsvb_loadImageBitmap_worker_WORKER_URL&&(URL.revokeObjectURL(tsvb_loadImageBitmap_worker_WORKER_URL),tsvb_loadImageBitmap_worker_WORKER_URL=null)};let tsvb_UUID=0,tsvb_MAX_WORKERS;class tsvb_WorkerManagerClass{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const{worker:e}=new tsvb_WorkerInstance;e.addEventListener("message",(r=>{e.terminate(),tsvb_WorkerInstance.revokeObjectURL(),t(r.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===tsvb_MAX_WORKERS&&(tsvb_MAX_WORKERS=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<tsvb_MAX_WORKERS&&(this._createdWorkers++,t=(new tsvb_loadImageBitmap_worker_WorkerInstance).worker,t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise(((r,n)=>{this.queue.push({id:t,arguments:e,resolve:r,reject:n})}));return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[tsvb_UUID]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:tsvb_UUID++,id:r})}}const tsvb_WorkerManager=new tsvb_WorkerManagerClass;function tsvb_createTexture(t,e,r){t.resource.internal=!0;const n=new tsvb_Texture_Texture(t),i=()=>{delete e.promiseCache[r],tsvb_Cache.has(r)&&tsvb_Cache.remove(r)};return n.baseTexture.once("destroyed",(()=>{r in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),i())})),n.once("destroyed",(()=>{t.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),i())})),n}const tsvb_validImageExtensions=[".jpeg",".jpg",".png",".webp",".avif"],tsvb_validImageMIMEs=["image/jpeg","image/png","image/webp","image/avif"];async function tsvb_loadImageBitmap(t){const e=await tsvb_settings.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const r=await e.blob();return await createImageBitmap(r)}const tsvb_loadTextures={name:"loadTextures",extension:{type:tsvb_ExtensionType.LoadParser,priority:tsvb_LoaderParserPriority.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>tsvb_checkDataUrl(t,tsvb_validImageMIMEs)||tsvb_checkExtension(t,tsvb_validImageExtensions),async load(t,e,r){const n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let i;i=n?this.config.preferWorkers&&await tsvb_WorkerManager.isImageBitmapSupported()?await tsvb_WorkerManager.loadImageBitmap(t):await tsvb_loadImageBitmap(t):await new Promise(((e,r)=>{const n=new Image;n.crossOrigin=this.config.crossOrigin,n.src=t,n.complete?e(n):(n.onload=()=>e(n),n.onerror=t=>r(t))}));const s={...e.data};s.resolution??(s.resolution=tsvb_getResolutionOfUrl(t)),n&&void 0===s.resourceOptions?.ownsImageBitmap&&(s.resourceOptions={...s.resourceOptions},s.resourceOptions.ownsImageBitmap=!0);const o=new src_tsvb_BaseTexture(i,s);return o.resource.src=t,tsvb_createTexture(o,r,t)},unload(t){t.destroy(!0)}};tsvb_extensions.add(tsvb_loadTextures);const tsvb_validSVGExtension=".svg",tsvb_validSVGMIME="image/svg+xml",tsvb_loadSVG={extension:{type:tsvb_ExtensionType.LoadParser,priority:tsvb_LoaderParserPriority.High},name:"loadSVG",test:t=>tsvb_checkDataUrl(t,tsvb_validSVGMIME)||tsvb_checkExtension(t,tsvb_validSVGExtension),testParse:async t=>src_tsvb_SVGResource.test(t),async parse(t,e,r){const n=new src_tsvb_SVGResource(t,e?.data?.resourceOptions);await n.load();const i=new src_tsvb_BaseTexture(n,{resolution:tsvb_getResolutionOfUrl(t),...e?.data});return i.resource.src=e.src,tsvb_createTexture(i,r,e.src)},load:async(t,e)=>(await tsvb_settings.ADAPTER.fetch(t)).text(),unload:tsvb_loadTextures.unload};tsvb_extensions.add(tsvb_loadSVG);const tsvb_validVideoExtensions=[".mp4",".m4v",".webm",".ogv"],tsvb_validVideoMIMEs=["video/mp4","video/webm","video/ogg"],tsvb_loadVideo={name:"loadVideo",extension:{type:tsvb_ExtensionType.LoadParser,priority:tsvb_LoaderParserPriority.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test:t=>tsvb_checkDataUrl(t,tsvb_validVideoMIMEs)||tsvb_checkExtension(t,tsvb_validVideoExtensions),async load(t,e,r){let n;const i=await(await tsvb_settings.ADAPTER.fetch(t)).blob(),s=URL.createObjectURL(i);try{const i={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...e?.data?.resourceOptions,autoLoad:!0},o=new src_tsvb_VideoResource(s,i);await o.load();const a=new src_tsvb_BaseTexture(o,{alphaMode:await tsvb_detectVideoAlphaMode(),resolution:tsvb_getResolutionOfUrl(t),...e?.data});a.resource.src=t,n=tsvb_createTexture(a,r,t),n.baseTexture.once("destroyed",(()=>{URL.revokeObjectURL(s)}))}catch(t){throw URL.revokeObjectURL(s),t}return n},unload(t){t.destroy(!0)}};function tsvb_processX(t,e,r,n,i){const s=e[r];for(let o=0;o<s.length;o++){const a=s[o];r<e.length-1?tsvb_processX(t.replace(n[r],a),e,r+1,n,i):i.push(t.replace(n[r],a))}}function tsvb_createStringVariations(t){const e=t.match(/\{(.*?)\}/g),r=[];if(e){const n=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");n.push(e)})),tsvb_processX(t,n,0,e,r)}else r.push(t);return r}tsvb_extensions.add(tsvb_loadVideo);class tsvb_Resolver{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}getAlias(t){const{alias:e,name:r,src:n,srcs:i}=t;return tsvb_convertToList(e||r||n||i,(t=>"string"==typeof t?t:Array.isArray(t)?t.map((t=>t?.src??t?.srcs??t)):t?.src||t?.srcs?t.src??t.srcs:t),!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach((e=>{const n=e.src??e.srcs,i=e.alias??e.name;let s;if("string"==typeof i){const e=this._createBundleAssetId(t,i);r.push(e),s=[i,e]}else{const e=i.map((e=>this._createBundleAssetId(t,e)));r.push(...e),s=[...i,...e]}this.add({...e,alias:s,src:n})})):Object.keys(e).forEach((n=>{const i=[n,this._createBundleAssetId(t,n)];if("string"==typeof e[n])this.add({alias:i,src:e[n]});else if(Array.isArray(e[n]))this.add({alias:i,src:e[n]});else{const t=e[n],r=t.src??t.srcs;this.add({...t,alias:i,src:Array.isArray(r)?r:[r]})}r.push(...i)})),this._bundles[t]=r}add(t,e,r,n,i){const s=[];let o;"string"==typeof t||Array.isArray(t)&&"string"==typeof t[0]?(tsvb_deprecation("7.2.0","Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead."),s.push({alias:t,src:e,data:r,format:n,loadParser:i})):Array.isArray(t)?s.push(...t):s.push(t),o=t=>{this.hasKey(t)&&console.warn(`[Resolver] already has key: ${t} overwriting`)},tsvb_convertToList(s).forEach((t=>{const{src:e,srcs:r}=t;let{data:n,format:i,loadParser:s}=t;const a=tsvb_convertToList(e||r).map((t=>"string"==typeof t?tsvb_createStringVariations(t):Array.isArray(t)?t:[t])),u=this.getAlias(t);Array.isArray(u)?u.forEach(o):o(u);const l=[];a.forEach((t=>{t.forEach((t=>{let e={};if("object"!=typeof t){e.src=t;for(let r=0;r<this._parsers.length;r++){const n=this._parsers[r];if(n.test(t)){e=n.parse(t);break}}}else n=t.data??n,i=t.format??i,s=t.loadParser??s,e={...e,...t};if(!u)throw new Error(`[Resolver] alias is undefined for this asset: ${e.src}`);e=this.buildResolvedAsset(e,{aliases:u,data:n,format:i,loadParser:s}),l.push(e)}))})),u.forEach((t=>{this._assetMap[t]=l}))}))}resolveBundle(t){const e=tsvb_isSingleItem(t);t=tsvb_convertToList(t);const r={};return t.forEach((t=>{const e=this._bundles[t];if(e){const n=this.resolve(e),i={};for(const e in n){const r=n[e];i[this._extractAssetIdFromBundle(t,e)]=r}r[t]=i}})),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const r in e)t[r]=e[r].src;return t}return e.src}resolve(t){const e=tsvb_isSingleItem(t);t=tsvb_convertToList(t);const r={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const r=e[0],n=this._getPreferredOrder(e);n?.priority.forEach((t=>{n.params[t].forEach((r=>{const n=e.filter((e=>!!e[t]&&e[t]===r));n.length&&(e=n)}))})),this._resolverHash[t]=e[0]??r}else this._resolverHash[t]=this.buildResolvedAsset({alias:[t],src:t},{});r[t]=this._resolverHash[t]})),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],r=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:r,data:n,loadParser:i,format:s}=e;return(this._basePath||this._rootPath)&&(t.src=tsvb_path.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=r??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=i??t.loadParser,t.format=s??t.format??tsvb_path.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class tsvb_AssetsClass{constructor(){this._detections=[],this._initialized=!1,this.resolver=new tsvb_Resolver,this.loader=new tsvb_Loader,this.cache=tsvb_Cache,this._backgroundLoader=new tsvb_BackgroundLoader(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const e=t.texturePreference?.resolution??1,r="number"==typeof e?[e]:e,n=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r,n,i){this.resolver.add(t,e,r,n,i)}async load(t,e){this._initialized||await this.init();const r=tsvb_isSingleItem(t),n=tsvb_convertToList(t).map((t=>{if("string"!=typeof t){const e=this.resolver.getAlias(t);return e.some((t=>!this.resolver.hasKey(t)))&&this.add(t),Array.isArray(e)?e[0]:e}return this.resolver.hasKey(t)||this.add({alias:t,src:t}),t})),i=this.resolver.resolve(n),s=await this._mapLoadToResolve(i,e);return r?s[n[0]]:s}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;"string"==typeof t&&(r=!0,t=[t]);const n=this.resolver.resolveBundle(t),i={},s=Object.keys(n);let o=0,a=0;const u=()=>{e?.(++o/a)},l=s.map((t=>{const e=n[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,u).then((e=>{i[t]=e}))}));return await Promise.all(l),r?i[t[0]]:i}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return tsvb_Cache.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=tsvb_Cache.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const i=await this.loader.load(r,e);this._backgroundLoader.active=!0;const s={};return r.forEach(((t,e)=>{const r=i[t.src],o=[t.src];t.alias&&o.push(...t.alias),s[n[e]]=r,tsvb_Cache.set(o,r)})),s}async unload(t){this._initialized||await this.init();const e=tsvb_convertToList(t).map((t=>"string"!=typeof t?t.src:t)),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=tsvb_convertToList(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{tsvb_Cache.remove(t.src)})),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter(((t,r)=>e.indexOf(t)===r)),e}get detections(){return this._detections}get preferWorkers(){return tsvb_loadTextures.config.preferWorkers}set preferWorkers(t){tsvb_deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((r=>{e.config[r]=t[r]}))}))}}const tsvb_Assets=new tsvb_AssetsClass;tsvb_extensions.handleByList(tsvb_ExtensionType.LoadParser,tsvb_Assets.loader.parsers).handleByList(tsvb_ExtensionType.ResolveParser,tsvb_Assets.resolver.parsers).handleByList(tsvb_ExtensionType.CacheParser,tsvb_Assets.cache.parsers).handleByList(tsvb_ExtensionType.DetectionParser,tsvb_Assets.detections);const tsvb_cacheTextureArray={extension:tsvb_ExtensionType.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof tsvb_Texture_Texture)),getCacheableAssets:(t,e)=>{const r={};return t.forEach((t=>{e.forEach(((e,n)=>{r[t+(0===n?"":n+1)]=e}))})),r}};async function tsvb_testImageFormat(t){if("Image"in globalThis)return new Promise((e=>{const r=new Image;r.onload=()=>{e(!0)},r.onerror=()=>{e(!1)},r.src=t}));if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}tsvb_extensions.add(tsvb_cacheTextureArray);const tsvb_detectAvif={extension:{type:tsvb_ExtensionType.DetectionParser,priority:1},test:async()=>tsvb_testImageFormat("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};tsvb_extensions.add(tsvb_detectAvif);const tsvb_detectWebp={extension:{type:tsvb_ExtensionType.DetectionParser,priority:0},test:async()=>tsvb_testImageFormat("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};tsvb_extensions.add(tsvb_detectWebp);const tsvb_imageFormats=["png","jpg","jpeg"],tsvb_detectDefaults={extension:{type:tsvb_ExtensionType.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...tsvb_imageFormats],remove:async t=>t.filter((t=>!tsvb_imageFormats.includes(t)))};tsvb_extensions.add(tsvb_detectDefaults);const tsvb_inWorker="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function tsvb_testVideoFormat(t){return!tsvb_inWorker&&""!==document.createElement("video").canPlayType(t)}const tsvb_detectWebm={extension:{type:tsvb_ExtensionType.DetectionParser,priority:0},test:async()=>tsvb_testVideoFormat("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter((t=>"webm"!==t))};tsvb_extensions.add(tsvb_detectWebm);const tsvb_detectMp4={extension:{type:tsvb_ExtensionType.DetectionParser,priority:0},test:async()=>tsvb_testVideoFormat("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter((t=>"mp4"!==t&&"m4v"!==t))};tsvb_extensions.add(tsvb_detectMp4);const tsvb_detectOgv={extension:{type:tsvb_ExtensionType.DetectionParser,priority:0},test:async()=>tsvb_testVideoFormat("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter((t=>"ogv"!==t))};tsvb_extensions.add(tsvb_detectOgv);const tsvb_resolveTextureUrl={extension:tsvb_ExtensionType.ResolveParser,test:tsvb_loadTextures.test,parse:t=>({resolution:parseFloat(tsvb_settings.RETINA_PREFIX.exec(t)?.[1]??"1"),format:tsvb_path.extname(t).slice(1),src:t})};tsvb_extensions.add(tsvb_resolveTextureUrl);const tsvb_copySearchParams=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t};var tsvb_INTERNAL_FORMATS=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t))(tsvb_INTERNAL_FORMATS||{});const tsvb_INTERNAL_FORMAT_TO_BYTES_PER_PIXEL={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let tsvb_storedGl,tsvb_detectCompressedTextures_extensions;function tsvb_getCompressedTextureExtensions(){tsvb_detectCompressedTextures_extensions={bptc:tsvb_storedGl.getExtension("EXT_texture_compression_bptc"),astc:tsvb_storedGl.getExtension("WEBGL_compressed_texture_astc"),etc:tsvb_storedGl.getExtension("WEBGL_compressed_texture_etc"),s3tc:tsvb_storedGl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:tsvb_storedGl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:tsvb_storedGl.getExtension("WEBGL_compressed_texture_pvrtc")||tsvb_storedGl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:tsvb_storedGl.getExtension("WEBGL_compressed_texture_etc1"),atc:tsvb_storedGl.getExtension("WEBGL_compressed_texture_atc")}}const tsvb_detectCompressedTextures={extension:{type:tsvb_ExtensionType.DetectionParser,priority:2},test:async()=>{const t=tsvb_settings.ADAPTER.createCanvas().getContext("webgl");return t?(tsvb_storedGl=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async t=>{tsvb_detectCompressedTextures_extensions||tsvb_getCompressedTextureExtensions();const e=[];for(const t in tsvb_detectCompressedTextures_extensions)tsvb_detectCompressedTextures_extensions[t]&&e.push(t);return[...e,...t]},remove:async t=>(tsvb_detectCompressedTextures_extensions||tsvb_getCompressedTextureExtensions(),t.filter((t=>!(t in tsvb_detectCompressedTextures_extensions))))};tsvb_extensions.add(tsvb_detectCompressedTextures);class tsvb_BlobResource extends tsvb_BufferResource{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,n;"string"==typeof t?(r=t,n=new Uint8Array):(r=null,n=t),super(n,e),this.origin=r,this.buffer=n?new tsvb_ViewableBuffer(n):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new tsvb_ViewableBuffer(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class tsvb_CompressedTextureResource extends tsvb_BlobResource{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=tsvb_CompressedTextureResource._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||tsvb_CompressedTextureResource._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let t=0,e=this.levels;t<e;t++){const{levelID:e,levelWidth:r,levelHeight:i,levelBuffer:s}=this._levelBuffers[t];n.compressedTexImage2D(n.TEXTURE_2D,e,this.format,r,i,0,s)}return!0}onBlobLoaded(){this._levelBuffers=tsvb_CompressedTextureResource._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(36196===t)return"etc1";if(35986===t||35987===t||34798===t)return"atc";if(t>=36492&&t<=36495)return"bptc";if(37808===t)return"astc";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,r,n,i,s,o){const a=new Array(r);let u=t.byteOffset,l=s,c=o,h=l+n-1&~(n-1),f=c+i-1&~(i-1),d=h*f*tsvb_INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[e];for(let s=0;s<r;s++)a[s]={levelID:s,levelWidth:r>1?l:h,levelHeight:r>1?c:f,levelBuffer:new Uint8Array(t.buffer,u,d)},u+=d,l=l>>1||1,c=c>>1||1,h=l+n-1&~(n-1),f=c+i-1&~(i-1),d=h*f*tsvb_INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[e];return a}}const tsvb_DDS_MAGIC_SIZE=4,tsvb_DDS_HEADER_SIZE=124,tsvb_DDS_HEADER_PF_SIZE=32,tsvb_DDS_HEADER_DX10_SIZE=20,tsvb_DDS_MAGIC=542327876,tsvb_DDS_FIELDS={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},tsvb_DDS_PF_FIELDS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},tsvb_DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},tsvb_PF_FLAGS=1,tsvb_DDPF_ALPHA=2,tsvb_DDPF_FOURCC=4,tsvb_DDPF_RGB=64,tsvb_DDPF_YUV=512,tsvb_DDPF_LUMINANCE=131072,tsvb_FOURCC_DXT1=827611204,tsvb_FOURCC_DXT3=861165636,tsvb_FOURCC_DXT5=894720068,tsvb_FOURCC_DX10=808540228,tsvb_DDS_RESOURCE_MISC_TEXTURECUBE=4,tsvb_FOURCC_TO_FORMAT={[tsvb_FOURCC_DXT1]:tsvb_INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,[tsvb_FOURCC_DXT3]:tsvb_INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,[tsvb_FOURCC_DXT5]:tsvb_INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT},tsvb_DXGI_TO_FORMAT={70:tsvb_INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:tsvb_INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:tsvb_INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:tsvb_INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:tsvb_INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:tsvb_INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:tsvb_INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:tsvb_INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:tsvb_INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:tsvb_INTERNAL_FORMATS.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:tsvb_INTERNAL_FORMATS.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:tsvb_INTERNAL_FORMATS.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:tsvb_INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function tsvb_parseDDS(t){const e=new Uint32Array(t);if(e[0]!==tsvb_DDS_MAGIC)throw new Error("Invalid DDS file magic word");const r=new Uint32Array(t,0,tsvb_DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),n=r[tsvb_DDS_FIELDS.HEIGHT],i=r[tsvb_DDS_FIELDS.WIDTH],s=r[tsvb_DDS_FIELDS.MIPMAP_COUNT],o=new Uint32Array(t,tsvb_DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,tsvb_DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),a=o[tsvb_PF_FLAGS];if(a&tsvb_DDPF_FOURCC){const r=o[tsvb_DDS_PF_FIELDS.FOURCC];if(r!==tsvb_FOURCC_DX10){const e=tsvb_FOURCC_TO_FORMAT[r],o=new Uint8Array(t,tsvb_DDS_MAGIC_SIZE+tsvb_DDS_HEADER_SIZE);return[new tsvb_CompressedTextureResource(o,{format:e,width:i,height:n,levels:s})]}const a=tsvb_DDS_MAGIC_SIZE+tsvb_DDS_HEADER_SIZE,u=new Uint32Array(e.buffer,a,tsvb_DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),l=u[tsvb_DDS_DX10_FIELDS.DXGI_FORMAT],c=u[tsvb_DDS_DX10_FIELDS.RESOURCE_DIMENSION],h=u[tsvb_DDS_DX10_FIELDS.MISC_FLAG],f=u[tsvb_DDS_DX10_FIELDS.ARRAY_SIZE],d=tsvb_DXGI_TO_FORMAT[l];if(void 0===d)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(h===tsvb_DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,v=tsvb_DDS_MAGIC_SIZE+tsvb_DDS_HEADER_SIZE+tsvb_DDS_HEADER_DX10_SIZE;if(1===f)p.push(new Uint8Array(t,v));else{const e=tsvb_INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[d];let r=0,o=i,a=n;for(let t=0;t<s;t++){r+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1}let u=v;for(let e=0;e<f;e++)p.push(new Uint8Array(t,u,r)),u+=r}return p.map((t=>new tsvb_CompressedTextureResource(t,{format:d,width:i,height:n,levels:s})))}throw a&tsvb_DDPF_RGB?new Error("DDSParser does not support uncompressed texture data."):a&tsvb_DDPF_YUV?new Error("DDSParser does not supported YUV uncompressed texture data."):a&tsvb_DDPF_LUMINANCE?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&tsvb_DDPF_ALPHA?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const tsvb_FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],tsvb_ENDIANNESS=67305985,tsvb_KTX_FIELDS={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},tsvb_FILE_HEADER_SIZE=64,tsvb_TYPES_TO_BYTES_PER_COMPONENT={[tsvb_TYPES.UNSIGNED_BYTE]:1,[tsvb_TYPES.UNSIGNED_SHORT]:2,[tsvb_TYPES.INT]:4,[tsvb_TYPES.UNSIGNED_INT]:4,[tsvb_TYPES.FLOAT]:4,[tsvb_TYPES.HALF_FLOAT]:8},tsvb_FORMATS_TO_COMPONENTS={[tsvb_FORMATS.RGBA]:4,[tsvb_FORMATS.RGB]:3,[tsvb_FORMATS.RG]:2,[tsvb_FORMATS.RED]:1,[tsvb_FORMATS.LUMINANCE]:1,[tsvb_FORMATS.LUMINANCE_ALPHA]:2,[tsvb_FORMATS.ALPHA]:1},tsvb_TYPES_TO_BYTES_PER_PIXEL={[tsvb_TYPES.UNSIGNED_SHORT_4_4_4_4]:2,[tsvb_TYPES.UNSIGNED_SHORT_5_5_5_1]:2,[tsvb_TYPES.UNSIGNED_SHORT_5_6_5]:2};function tsvb_parseKTX(t,e,r=!1){const n=new DataView(e);if(!tsvb_validate(t,n))return null;const i=n.getUint32(tsvb_KTX_FIELDS.ENDIANNESS,!0)===tsvb_ENDIANNESS,s=n.getUint32(tsvb_KTX_FIELDS.GL_TYPE,i),o=n.getUint32(tsvb_KTX_FIELDS.GL_FORMAT,i),a=n.getUint32(tsvb_KTX_FIELDS.GL_INTERNAL_FORMAT,i),u=n.getUint32(tsvb_KTX_FIELDS.PIXEL_WIDTH,i),l=n.getUint32(tsvb_KTX_FIELDS.PIXEL_HEIGHT,i)||1,c=n.getUint32(tsvb_KTX_FIELDS.PIXEL_DEPTH,i)||1,h=n.getUint32(tsvb_KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,i)||1,f=n.getUint32(tsvb_KTX_FIELDS.NUMBER_OF_FACES,i),d=n.getUint32(tsvb_KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,i),p=n.getUint32(tsvb_KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,i);if(0===l||1!==c)throw new Error("Only 2D textures are supported");if(1!==f)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==h)throw new Error("WebGL does not support array textures");const v=u+3&-4,y=l+3&-4,b=new Array(h);let _,m=u*l;if(0===s&&(m=v*y),_=0!==s?tsvb_TYPES_TO_BYTES_PER_COMPONENT[s]?tsvb_TYPES_TO_BYTES_PER_COMPONENT[s]*tsvb_FORMATS_TO_COMPONENTS[o]:tsvb_TYPES_TO_BYTES_PER_PIXEL[s]:tsvb_INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[a],void 0===_)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const g=r?tsvb_parseKvData(n,p,i):null;let w=m*_,x=u,T=l,S=v,E=y,O=tsvb_FILE_HEADER_SIZE+p;for(let t=0;t<d;t++){const r=n.getUint32(O,i);let o=O+4;for(let r=0;r<h;r++){let n=b[r];n||(n=b[r]=new Array(d)),n[t]={levelID:t,levelWidth:d>1||0!==s?x:S,levelHeight:d>1||0!==s?T:E,levelBuffer:new Uint8Array(e,o,w)},o+=w}O+=r+4,O=O%4!=0?O+4-O%4:O,x=x>>1||1,T=T>>1||1,S=x+4-1&-4,E=T+4-1&-4,w=S*E*_}return 0!==s?{uncompressed:b.map((t=>{let e=t[0].levelBuffer,r=!1;return s===tsvb_TYPES.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):s===tsvb_TYPES.UNSIGNED_INT?(r=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):s===tsvb_TYPES.INT&&(r=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new tsvb_BufferResource(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:s,format:r?tsvb_convertFormatToInteger(o):o}})),kvData:g}:{compressed:b.map((t=>new tsvb_CompressedTextureResource(null,{format:a,width:u,height:l,levels:d,levelBuffers:t}))),kvData:g}}function tsvb_validate(t,e){for(let r=0;r<tsvb_FILE_IDENTIFIER.length;r++)if(e.getUint8(r)!==tsvb_FILE_IDENTIFIER[r])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}function tsvb_convertFormatToInteger(t){switch(t){case tsvb_FORMATS.RGBA:return tsvb_FORMATS.RGBA_INTEGER;case tsvb_FORMATS.RGB:return tsvb_FORMATS.RGB_INTEGER;case tsvb_FORMATS.RG:return tsvb_FORMATS.RG_INTEGER;case tsvb_FORMATS.RED:return tsvb_FORMATS.RED_INTEGER;default:return t}}function tsvb_parseKvData(t,e,r){const n=new Map;let i=0;for(;i<e;){const s=t.getUint32(tsvb_FILE_HEADER_SIZE+i,r),o=tsvb_FILE_HEADER_SIZE+i+4,a=3-(s+3)%4;if(0===s||s>e-i){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let u=0;for(;u<s&&0!==t.getUint8(o+u);u++);if(-1===u){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(t.buffer,o,u)),c=new DataView(t.buffer,o+u+1,s-u-1);n.set(l,c),i+=4+s+a}return n}const tsvb_loadDDS={extension:{type:tsvb_ExtensionType.LoadParser,priority:tsvb_LoaderParserPriority.High},name:"loadDDS",test:t=>tsvb_checkExtension(t,".dds"),async load(t,e,r){const n=tsvb_parseDDS(await(await tsvb_settings.ADAPTER.fetch(t)).arrayBuffer()).map((n=>tsvb_createTexture(new src_tsvb_BaseTexture(n,{mipmap:tsvb_MIPMAP_MODES.OFF,alphaMode:tsvb_ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:tsvb_getResolutionOfUrl(t),...e.data}),r,t)));return 1===n.length?n[0]:n},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};tsvb_extensions.add(tsvb_loadDDS);const tsvb_loadKTX={extension:{type:tsvb_ExtensionType.LoadParser,priority:tsvb_LoaderParserPriority.High},name:"loadKTX",test:t=>tsvb_checkExtension(t,".ktx"),async load(t,e,r){const n=await(await tsvb_settings.ADAPTER.fetch(t)).arrayBuffer(),{compressed:i,uncompressed:s,kvData:o}=tsvb_parseKTX(t,n),a=i??s,u={mipmap:tsvb_MIPMAP_MODES.OFF,alphaMode:tsvb_ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:tsvb_getResolutionOfUrl(t),...e.data},l=a.map((e=>{a===s&&Object.assign(u,{type:e.type,format:e.format});const n=e.resource??e,i=new src_tsvb_BaseTexture(n,u);return i.ktxKeyValueData=o,tsvb_createTexture(i,r,t)}));return 1===l.length?l[0]:l},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};tsvb_extensions.add(tsvb_loadKTX);const tsvb_knownFormats=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],tsvb_resolveCompressedTextureUrl={extension:tsvb_ExtensionType.ResolveParser,test:t=>{const e=tsvb_path.extname(t).slice(1);return["basis","ktx","dds"].includes(e)},parse:t=>{const e=t.split("."),r=e.pop();if(["ktx","dds"].includes(r)){const r=e.pop();if(tsvb_knownFormats.includes(r))return{resolution:parseFloat(tsvb_settings.RETINA_PREFIX.exec(t)?.[1]??"1"),format:r,src:t}}return{resolution:parseFloat(tsvb_settings.RETINA_PREFIX.exec(t)?.[1]??"1"),format:r,src:t}}};tsvb_extensions.add(tsvb_resolveCompressedTextureUrl);const tsvb_TEMP_RECT=new tsvb_Rectangle,tsvb_BYTES_PER_PIXEL=4,tsvb_Extract=class t{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,r,n){const i=new Image;return i.src=await this.base64(t,e,r,n),i}async base64(t,e,r,n){const i=this.canvas(t,n);if(void 0!==i.toBlob)return new Promise(((t,n)=>{i.toBlob((e=>{if(!e)return void n(new Error("ICanvas.toBlob failed!"));const r=new FileReader;r.onload=()=>t(r.result),r.onerror=n,r.readAsDataURL(e)}),e,r)}));if(void 0!==i.toDataURL)return i.toDataURL(e,r);if(void 0!==i.convertToBlob){const t=await i.convertToBlob({type:e,quality:r});return new Promise(((e,r)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=r,n.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,r){const{pixels:n,width:i,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,r);o&&t._flipY(n,i,s),a&&t._unpremultiplyAlpha(n);const u=new tsvb_CanvasRenderTarget(i,s,1),l=new ImageData(new Uint8ClampedArray(n.buffer),i,s);return u.context.putImageData(l,0,0),u.canvas}pixels(e,r){const{pixels:n,width:i,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,r);return o&&t._flipY(n,i,s),a&&t._unpremultiplyAlpha(n),n}_rawPixels(t,e){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let n,i,s=!1,o=!1,a=!1;t&&(t instanceof tsvb_RenderTexture?i=t:(i=r.generateTexture(t,{region:e,resolution:r.resolution,multisample:r.multisample}),a=!0,e&&(tsvb_TEMP_RECT.width=e.width,tsvb_TEMP_RECT.height=e.height,e=tsvb_TEMP_RECT)));const u=r.gl;if(i){if(n=i.baseTexture.resolution,e=e??i.frame,s=!1,o=i.baseTexture.alphaMode>0&&i.baseTexture.format===tsvb_FORMATS.RGBA,!a){r.renderTexture.bind(i);const t=i.framebuffer.glFramebuffers[r.CONTEXT_UID];t.blitFramebuffer&&r.framebuffer.bind(t.blitFramebuffer)}}else n=r.resolution,e||((e=tsvb_TEMP_RECT).width=r.width/n,e.height=r.height/n),s=!0,o=this._rendererPremultipliedAlpha,r.renderTexture.bind();const l=Math.max(Math.round(e.width*n),1),c=Math.max(Math.round(e.height*n),1),h=new Uint8Array(tsvb_BYTES_PER_PIXEL*l*c);return u.readPixels(Math.round(e.x*n),Math.round(e.y*n),l,c,u.RGBA,u.UNSIGNED_BYTE,h),a&&i?.destroy(!0),{pixels:h,width:l,height:c,flipY:s,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,r){const n=e<<2,i=r>>1,s=new Uint8Array(n);for(let e=0;e<i;e++){const i=e*n,o=(r-e-1)*n;s.set(t.subarray(i,i+n)),t.copyWithin(i,o,o+n),t.set(s,o)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const e=t[r+3];if(0!==e){const n=255.001/e;t[r]=t[r]*n+.5,t[r+1]=t[r+1]*n+.5,t[r+2]=t[r+2]*n+.5}}}};tsvb_Extract.extension={name:"extract",type:tsvb_ExtensionType.RendererSystem};let src_tsvb_Extract=tsvb_Extract;tsvb_extensions.add(src_tsvb_Extract);const tsvb_buildCircle={build(t){const e=t.points;let r,n,i,s,o,a;if(t.type===tsvb_SHAPES.CIRC){const e=t.shape;r=e.x,n=e.y,o=a=e.radius,i=s=0}else if(t.type===tsvb_SHAPES.ELIP){const e=t.shape;r=e.x,n=e.y,o=e.width,a=e.height,i=s=0}else{const e=t.shape,u=e.width/2,l=e.height/2;r=e.x+u,n=e.y+l,o=a=Math.max(0,Math.min(e.radius,Math.min(u,l))),i=u-o,s=l-a}if(!(o>=0&&a>=0&&i>=0&&s>=0))return void(e.length=0);const u=Math.ceil(2.3*Math.sqrt(o+a)),l=8*u+(i?4:0)+(s?4:0);if(e.length=l,0===l)return;if(0===u)return e.length=8,e[0]=e[6]=r+i,e[1]=e[3]=n+s,e[2]=e[4]=r-i,void(e[5]=e[7]=n-s);let c=0,h=4*u+(i?2:0)+2,f=h,d=l;{const t=i+o,a=s,u=r+t,l=r-t,p=n+a;if(e[c++]=u,e[c++]=p,e[--h]=p,e[--h]=l,s){const t=n-a;e[f++]=l,e[f++]=t,e[--d]=t,e[--d]=u}}for(let t=1;t<u;t++){const l=Math.PI/2*(t/u),p=i+Math.cos(l)*o,v=s+Math.sin(l)*a,y=r+p,b=r-p,_=n+v,m=n-v;e[c++]=y,e[c++]=_,e[--h]=_,e[--h]=b,e[f++]=b,e[f++]=m,e[--d]=m,e[--d]=y}{const t=s+a,o=r+i,u=r-i,l=n+t,h=n-t;e[c++]=o,e[c++]=l,e[--d]=h,e[--d]=o,i&&(e[c++]=u,e[c++]=l,e[--d]=h,e[--d]=u)}},triangulate(t,e){const r=t.points,n=e.points,i=e.indices;if(0===r.length)return;let s=n.length/2;const o=s;let a,u;if(t.type!==tsvb_SHAPES.RREC){const e=t.shape;a=e.x,u=e.y}else{const e=t.shape;a=e.x+e.width/2,u=e.y+e.height/2}const l=t.matrix;n.push(t.matrix?l.a*a+l.c*u+l.tx:a,t.matrix?l.b*a+l.d*u+l.ty:u),s++,n.push(r[0],r[1]);for(let t=2;t<r.length;t+=2)n.push(r[t],r[t+1]),i.push(s++,o,s);i.push(o+1,o,s)}};function tsvb_fixOrientation(t,e=!1){const r=t.length;if(r<6)return;let n=0;for(let e=0,i=t[r-2],s=t[r-1];e<r;e+=2){const r=t[e],o=t[e+1];n+=(r-i)*(o+s),i=r,s=o}if(!e&&n>0||e&&n<=0){const e=r/2;for(let n=e+e%2;n<r;n+=2){const e=r-n-2,i=r-n-1,s=n,o=n+1;[t[e],t[s]]=[t[s],t[e]],[t[i],t[o]]=[t[o],t[i]]}}}const tsvb_buildPoly={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let r=t.points;const n=t.holes,i=e.points,s=e.indices;if(r.length>=6){tsvb_fixOrientation(r,!1);const t=[];for(let e=0;e<n.length;e++){const i=n[e];tsvb_fixOrientation(i.points,!0),t.push(r.length/2),r=r.concat(i.points)}const e=tsvb_earcut(r,t,2);if(!e)return;const o=i.length/2;for(let t=0;t<e.length;t+=3)s.push(e[t]+o),s.push(e[t+1]+o),s.push(e[t+2]+o);for(let t=0;t<r.length;t++)i.push(r[t])}}},tsvb_buildRectangle={build(t){const e=t.shape,r=e.x,n=e.y,i=e.width,s=e.height,o=t.points;o.length=0,i>=0&&s>=0&&o.push(r,n,r+i,n,r+i,n+s,r,n+s)},triangulate(t,e){const r=t.points,n=e.points;if(0===r.length)return;const i=n.length/2;n.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},tsvb_buildRoundedRectangle={build(t){tsvb_buildCircle.build(t)},triangulate(t,e){tsvb_buildCircle.triangulate(t,e)}};var tsvb_LINE_JOIN=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(tsvb_LINE_JOIN||{}),tsvb_LINE_CAP=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(tsvb_LINE_CAP||{});const tsvb_curves={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let r=Math.ceil(t/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}},tsvb_GRAPHICS_CURVES=tsvb_curves;class tsvb_ArcUtils{static curveTo(t,e,r,n,i,s){const o=s[s.length-2],a=s[s.length-1]-e,u=o-t,l=n-e,c=r-t,h=Math.abs(a*c-u*l);if(h<1e-8||0===i)return(s[s.length-2]!==t||s[s.length-1]!==e)&&s.push(t,e),null;const f=a*a+u*u,d=l*l+c*c,p=a*l+u*c,v=i*Math.sqrt(f)/h,y=i*Math.sqrt(d)/h,b=v*p/f,_=y*p/d,m=v*c+y*u,g=v*l+y*a,w=u*(y+b),x=a*(y+b),T=c*(v+_),S=l*(v+_);return{cx:m+t,cy:g+e,radius:i,startAngle:Math.atan2(x-g,w-m),endAngle:Math.atan2(S-g,T-m),anticlockwise:u*l>c*a}}static arc(t,e,r,n,i,s,o,a,u){const l=o-s,c=tsvb_curves._segmentsCount(Math.abs(l)*i,40*Math.ceil(Math.abs(l)/tsvb_PI_2)),h=l/(2*c),f=2*h,d=Math.cos(h),p=Math.sin(h),v=c-1,y=v%1/v;for(let t=0;t<=v;++t){const e=h+s+f*(t+y*t),o=Math.cos(e),a=-Math.sin(e);u.push((d*o+p*a)*i+r,(d*-a+p*o)*i+n)}}}class tsvb_BezierUtils{static curveLength(t,e,r,n,i,s,o,a){let u=0,l=0,c=0,h=0,f=0,d=0,p=0,v=0,y=0,b=0,_=0,m=t,g=e;for(let w=1;w<=10;++w)l=w/10,c=l*l,h=c*l,f=1-l,d=f*f,p=d*f,v=p*t+3*d*l*r+3*f*c*i+h*o,y=p*e+3*d*l*n+3*f*c*s+h*a,b=m-v,_=g-y,m=v,g=y,u+=Math.sqrt(b*b+_*_);return u}static curveTo(t,e,r,n,i,s,o){const a=o[o.length-2],u=o[o.length-1];o.length-=2;const l=tsvb_curves._segmentsCount(tsvb_BezierUtils.curveLength(a,u,t,e,r,n,i,s));let c=0,h=0,f=0,d=0,p=0;o.push(a,u);for(let v=1,y=0;v<=l;++v)y=v/l,c=1-y,h=c*c,f=h*c,d=y*y,p=d*y,o.push(f*a+3*h*y*t+3*c*d*r+p*i,f*u+3*h*y*e+3*c*d*n+p*s)}}function tsvb_square(t,e,r,n,i,s,o,a){let u,l;o?(u=n,l=-r):(u=-n,l=r);const c=t-r*i+u,h=e-n*i+l,f=t+r*s+u,d=e+n*s+l;return a.push(c,h,f,d),2}function tsvb_round(t,e,r,n,i,s,o,a){const u=r-t,l=n-e;let c=Math.atan2(u,l),h=Math.atan2(i-t,s-e);a&&c<h?c+=2*Math.PI:!a&&c>h&&(h+=2*Math.PI);let f=c;const d=h-c,p=Math.abs(d),v=Math.sqrt(u*u+l*l),y=1+(15*p*Math.sqrt(v)/Math.PI|0),b=d/y;if(f+=b,a){o.push(t,e,r,n);for(let r=1,n=f;r<y;r++,n+=b)o.push(t,e,t+Math.sin(n)*v,e+Math.cos(n)*v);o.push(t,e,i,s)}else{o.push(r,n,t,e);for(let r=1,n=f;r<y;r++,n+=b)o.push(t+Math.sin(n)*v,e+Math.cos(n)*v,t,e);o.push(i,s,t,e)}return 2*y}function tsvb_buildNonNativeLine(t,e){const r=t.shape;let n=t.points||r.points.slice();const i=e.closePointEps;if(0===n.length)return;const s=t.lineStyle,o=new tsvb_Point(n[0],n[1]),a=new tsvb_Point(n[n.length-2],n[n.length-1]),u=r.type!==tsvb_SHAPES.POLY||r.closeStroke,l=Math.abs(o.x-a.x)<i&&Math.abs(o.y-a.y)<i;if(u){n=n.slice(),l&&(n.pop(),n.pop(),a.set(n[n.length-2],n[n.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);n.unshift(t,e),n.push(t,e)}const c=e.points,h=n.length/2;let f=n.length;const d=c.length/2,p=s.width/2,v=p*p,y=s.miterLimit*s.miterLimit;let b=n[0],_=n[1],m=n[2],g=n[3],w=0,x=0,T=-(_-g),S=b-m,E=0,O=0,P=Math.sqrt(T*T+S*S);T/=P,S/=P,T*=p,S*=p;const A=s.alignment,C=2*(1-A),k=2*A;u||(s.cap===tsvb_LINE_CAP.ROUND?f+=tsvb_round(b-T*(C-k)*.5,_-S*(C-k)*.5,b-T*C,_-S*C,b+T*k,_+S*k,c,!0)+2:s.cap===tsvb_LINE_CAP.SQUARE&&(f+=tsvb_square(b,_,T,S,C,k,!0,c))),c.push(b-T*C,_-S*C,b+T*k,_+S*k);for(let t=1;t<h-1;++t){b=n[2*(t-1)],_=n[2*(t-1)+1],m=n[2*t],g=n[2*t+1],w=n[2*(t+1)],x=n[2*(t+1)+1],T=-(_-g),S=b-m,P=Math.sqrt(T*T+S*S),T/=P,S/=P,T*=p,S*=p,E=-(g-x),O=m-w,P=Math.sqrt(E*E+O*O),E/=P,O/=P,E*=p,O*=p;const e=m-b,r=_-g,i=m-w,o=x-g,a=e*i+r*o,u=r*i-o*e,l=u<0;if(Math.abs(u)<.001*Math.abs(a)){c.push(m-T*C,g-S*C,m+T*k,g+S*k),a>=0&&(s.join===tsvb_LINE_JOIN.ROUND?f+=tsvb_round(m,g,m-T*C,g-S*C,m-E*C,g-O*C,c,!1)+4:f+=2,c.push(m-E*k,g-O*k,m+E*C,g+O*C));continue}const h=(-T+b)*(-S+g)-(-T+m)*(-S+_),d=(-E+w)*(-O+g)-(-E+m)*(-O+x),A=(e*d-i*h)/u,I=(o*h-r*d)/u,R=(A-m)*(A-m)+(I-g)*(I-g),$=m+(A-m)*C,M=g+(I-g)*C,D=m-(A-m)*k,B=g-(I-g)*k,L=l?C:k,N=R<=Math.min(e*e+r*r,i*i+o*o)+L*L*v;let F=s.join;if(F===tsvb_LINE_JOIN.MITER&&R/v>y&&(F=tsvb_LINE_JOIN.BEVEL),N)switch(F){case tsvb_LINE_JOIN.MITER:c.push($,M,D,B);break;case tsvb_LINE_JOIN.BEVEL:l?c.push($,M,m+T*k,g+S*k,$,M,m+E*k,g+O*k):c.push(m-T*C,g-S*C,D,B,m-E*C,g-O*C,D,B),f+=2;break;case tsvb_LINE_JOIN.ROUND:l?(c.push($,M,m+T*k,g+S*k),f+=tsvb_round(m,g,m+T*k,g+S*k,m+E*k,g+O*k,c,!0)+4,c.push($,M,m+E*k,g+O*k)):(c.push(m-T*C,g-S*C,D,B),f+=tsvb_round(m,g,m-T*C,g-S*C,m-E*C,g-O*C,c,!1)+4,c.push(m-E*C,g-O*C,D,B))}else{switch(c.push(m-T*C,g-S*C,m+T*k,g+S*k),F){case tsvb_LINE_JOIN.MITER:l?c.push(D,B,D,B):c.push($,M,$,M),f+=2;break;case tsvb_LINE_JOIN.ROUND:f+=l?tsvb_round(m,g,m+T*k,g+S*k,m+E*k,g+O*k,c,!0)+2:tsvb_round(m,g,m-T*C,g-S*C,m-E*C,g-O*C,c,!1)+2}c.push(m-E*C,g-O*C,m+E*k,g+O*k),f+=2}}b=n[2*(h-2)],_=n[2*(h-2)+1],m=n[2*(h-1)],g=n[2*(h-1)+1],T=-(_-g),S=b-m,P=Math.sqrt(T*T+S*S),T/=P,S/=P,T*=p,S*=p,c.push(m-T*C,g-S*C,m+T*k,g+S*k),u||(s.cap===tsvb_LINE_CAP.ROUND?f+=tsvb_round(m-T*(C-k)*.5,g-S*(C-k)*.5,m-T*C,g-S*C,m+T*k,g+S*k,c,!1)+2:s.cap===tsvb_LINE_CAP.SQUARE&&(f+=tsvb_square(m,g,T,S,C,k,!1,c)));const I=e.indices,R=tsvb_curves.epsilon*tsvb_curves.epsilon;for(let t=d;t<f+d-2;++t)b=c[2*t],_=c[2*t+1],m=c[2*(t+1)],g=c[2*(t+1)+1],w=c[2*(t+2)],x=c[2*(t+2)+1],!(Math.abs(b*(g-x)+m*(x-_)+w*(_-g))<R)&&I.push(t,t+1,t+2)}function tsvb_buildNativeLine(t,e){let r=0;const n=t.shape,i=t.points||n.points,s=n.type!==tsvb_SHAPES.POLY||n.closeStroke;if(0===i.length)return;const o=e.points,a=e.indices,u=i.length/2,l=o.length/2;let c=l;for(o.push(i[0],i[1]),r=1;r<u;r++)o.push(i[2*r],i[2*r+1]),a.push(c,c+1),c++;s&&a.push(c,l)}function tsvb_buildLine(t,e){t.lineStyle.native?tsvb_buildNativeLine(t,e):tsvb_buildNonNativeLine(t,e)}class tsvb_QuadraticUtils{static curveLength(t,e,r,n,i,s){const o=t-2*r+i,a=e-2*n+s,u=2*r-2*t,l=2*n-2*e,c=4*(o*o+a*a),h=4*(o*u+a*l),f=u*u+l*l,d=2*Math.sqrt(c+h+f),p=Math.sqrt(c),v=2*c*p,y=2*Math.sqrt(f),b=h/p;return(v*d+p*h*(d-y)+(4*f*c-h*h)*Math.log((2*p+b+d)/(b+y)))/(4*v)}static curveTo(t,e,r,n,i){const s=i[i.length-2],o=i[i.length-1],a=tsvb_curves._segmentsCount(tsvb_QuadraticUtils.curveLength(s,o,t,e,r,n));let u=0,l=0;for(let c=1;c<=a;++c){const h=c/a;u=s+(t-s)*h,l=o+(e-o)*h,i.push(u+(t+(r-t)*h-u)*h,l+(e+(n-e)*h-l)*h)}}}const tsvb_FILL_COMMANDS={[tsvb_SHAPES.POLY]:tsvb_buildPoly,[tsvb_SHAPES.CIRC]:tsvb_buildCircle,[tsvb_SHAPES.ELIP]:tsvb_buildCircle,[tsvb_SHAPES.RECT]:tsvb_buildRectangle,[tsvb_SHAPES.RREC]:tsvb_buildRoundedRectangle},tsvb_BATCH_POOL=[],tsvb_DRAW_CALL_POOL=[];class tsvb_GraphicsData{constructor(t,e=null,r=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new tsvb_GraphicsData(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class tsvb_BatchPart{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const tsvb_tmpPoint=new tsvb_Point,tsvb_GraphicsGeometry=class t extends tsvb_BatchGeometry{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new tsvb_Bounds,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),tsvb_DRAW_CALL_POOL.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),tsvb_BATCH_POOL.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,n=null){const i=new tsvb_GraphicsData(t,e,r,n);return this.graphicsData.push(i),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const r=new tsvb_GraphicsData(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let r=0;r<e.length;++r){const n=e[r];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(t,tsvb_tmpPoint):tsvb_tmpPoint.copyFrom(t),n.shape.contains(tsvb_tmpPoint.x,tsvb_tmpPoint.y))){let t=!1;if(n.holes)for(let e=0;e<n.holes.length;e++)if(n.holes[e].shape.contains(tsvb_tmpPoint.x,tsvb_tmpPoint.y)){t=!0;break}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let r=null,n=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],n=r.style);for(let i=this.shapeIndex;i<e.length;i++){this.shapeIndex++;const s=e[i],o=s.fillStyle,a=s.lineStyle;tsvb_FILL_COMMANDS[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix),(o.visible||a.visible)&&this.processHoles(s.holes);for(let e=0;e<2;e++){const i=0===e?o:a;if(!i.visible)continue;const u=i.texture.baseTexture,l=this.indices.length,c=this.points.length/2;u.wrapMode=tsvb_WRAP_MODES.REPEAT,0===e?this.processFill(s):this.processLine(s);const h=this.points.length/2-c;0!==h&&(r&&!this._compareStyles(n,i)&&(r.end(l,c),r=null),r||(r=tsvb_BATCH_POOL.pop()||new tsvb_BatchPart,r.begin(i,l,c),this.batches.push(r),n=i),this.addUvs(this.points,t,i.texture,c,h,i.matrix))}}const i=this.indices.length,s=this.points.length/2;if(r&&r.end(i,s),0===this.batches.length)return void(this.batchable=!0);const o=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],r=e.fillStyle,n=e.lineStyle;if(r&&!r.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,r=t.length;e<r;e++){const r=t[e];for(let t=0;t<r.size;t++){const e=r.start+t;this.indicesUint16[e]=this.indicesUint16[e]-r.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<2*t.BATCHABLE_SIZE}buildDrawCalls(){let t=++src_tsvb_BaseTexture._globalBatch;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),tsvb_DRAW_CALL_POOL.push(this.drawCalls[t]);this.drawCalls.length=0;const e=this.colors,r=this.textureIds;let n=tsvb_DRAW_CALL_POOL.pop();n||(n=new tsvb_BatchDrawCall,n.texArray=new tsvb_BatchTextureArray),n.texArray.count=0,n.start=0,n.size=0,n.type=tsvb_DRAW_MODES.TRIANGLES;let i=0,s=null,o=0,a=!1,u=tsvb_DRAW_MODES.TRIANGLES,l=0;this.drawCalls.push(n);for(let c=0;c<this.batches.length;c++){const h=this.batches[c],f=8,d=h.style,p=d.texture.baseTexture;a!==!!d.native&&(a=!!d.native,u=a?tsvb_DRAW_MODES.LINES:tsvb_DRAW_MODES.TRIANGLES,s=null,i=f,t++),s!==p&&(s=p,p._batchEnabled!==t&&(i===f&&(t++,i=0,n.size>0&&(n=tsvb_DRAW_CALL_POOL.pop(),n||(n=new tsvb_BatchDrawCall,n.texArray=new tsvb_BatchTextureArray),this.drawCalls.push(n)),n.start=l,n.size=0,n.texArray.count=0,n.type=u),p.touched=1,p._batchEnabled=t,p._batchLocation=i,p.wrapMode=tsvb_WRAP_MODES.REPEAT,n.texArray.elements[n.texArray.count++]=p,i++)),n.size+=h.size,l+=h.size,o=p._batchLocation,this.addColors(e,d.color,d.alpha,h.attribSize,h.attribStart),this.addTextureIds(r,o,h.attribSize,h.attribStart)}src_tsvb_BaseTexture._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,r=this.colors,n=this.textureIds,i=new ArrayBuffer(3*t.length*4),s=new Float32Array(i),o=new Uint32Array(i);let a=0;for(let i=0;i<t.length/2;i++)s[a++]=t[2*i],s[a++]=t[2*i+1],s[a++]=e[2*i],s[a++]=e[2*i+1],o[a++]=r[i],s[a++]=n[i];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?tsvb_buildPoly.triangulate(t,this):tsvb_FILL_COMMANDS[t.type].triangulate(t,this)}processLine(t){tsvb_buildLine(t,this);for(let e=0;e<t.holes.length;e++)tsvb_buildLine(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const r=t[e];tsvb_FILL_COMMANDS[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){const n=t[2*r],i=t[2*r+1];t[2*r]=e.a*n+e.c*i+e.tx,t[2*r+1]=e.b*n+e.d*i+e.ty}}addColors(t,e,r,n,i=0){const s=src_tsvb_Color.shared.setValue(e).toLittleEndianNumber(),o=src_tsvb_Color.shared.setValue(s).toPremultiplied(r);t.length=Math.max(t.length,i+n);for(let e=0;e<n;e++)t[i+e]=o}addTextureIds(t,e,r,n=0){t.length=Math.max(t.length,n+r);for(let i=0;i<r;i++)t[n+i]=e}addUvs(t,e,r,n,i,s=null){let o=0;const a=e.length,u=r.frame;for(;o<i;){let r=t[2*(n+o)],i=t[2*(n+o)+1];if(s){const t=s.a*r+s.c*i+s.tx;i=s.b*r+s.d*i+s.ty,r=t}o++,e.push(r/u.width,i/u.height)}const l=r.baseTexture;(u.width<l.width||u.height<l.height)&&this.adjustUvs(e,r,a,i)}adjustUvs(t,e,r,n){const i=e.baseTexture,s=1e-6,o=r+2*n,a=e.frame,u=a.width/i.width,l=a.height/i.height;let c=a.x/a.width,h=a.y/a.height,f=Math.floor(t[r]+s),d=Math.floor(t[r+1]+s);for(let e=r+2;e<o;e+=2)f=Math.min(f,Math.floor(t[e]+s)),d=Math.min(d,Math.floor(t[e+1]+s));c-=f,h-=d;for(let e=r;e<o;e+=2)t[e]=(t[e]+c)*u,t[e+1]=(t[e+1]+h)*l}};tsvb_GraphicsGeometry.BATCHABLE_SIZE=100;let src_tsvb_GraphicsGeometry=tsvb_GraphicsGeometry;class tsvb_FillStyle{constructor(){this.color=16777215,this.alpha=1,this.texture=tsvb_Texture_Texture.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new tsvb_FillStyle;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=tsvb_Texture_Texture.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class tsvb_LineStyle extends tsvb_FillStyle{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=tsvb_LINE_CAP.BUTT,this.join=tsvb_LINE_JOIN.MITER,this.miterLimit=10}clone(){const t=new tsvb_LineStyle;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=tsvb_LINE_CAP.BUTT,this.join=tsvb_LINE_JOIN.MITER,this.miterLimit=10}}const tsvb_DEFAULT_SHADERS={},tsvb_Graphics=class t extends src_tsvb_Container{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new tsvb_FillStyle,this._lineStyle=new tsvb_LineStyle,this._matrix=null,this._holeMode=!1,this.state=tsvb_State.for2d(),this._geometry=t||new src_tsvb_GraphicsGeometry,this._geometry.refCount++,this._transformID=-1,this._tintColor=new src_tsvb_Color(16777215),this.blendMode=tsvb_BLEND_MODES.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new t(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,n=.5,i=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:r,alignment:n,native:i}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:tsvb_Texture_Texture.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:tsvb_LINE_CAP.BUTT,join:tsvb_LINE_JOIN.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new tsvb_Polygon,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new tsvb_Polygon,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,n=r[r.length-2],i=r[r.length-1];return(n!==t||i!==e)&&r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,n){this._initCurve();const i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),tsvb_QuadraticUtils.curveTo(t,e,r,n,i),this}bezierCurveTo(t,e,r,n,i,s){return this._initCurve(),tsvb_BezierUtils.curveTo(t,e,r,n,i,s,this.currentPath.points),this}arcTo(t,e,r,n,i){this._initCurve(t,e);const s=this.currentPath.points,o=tsvb_ArcUtils.curveTo(t,e,r,n,i,s);if(o){const{cx:t,cy:e,radius:r,startAngle:n,endAngle:i,anticlockwise:s}=o;this.arc(t,e,r,n,i,s)}return this}arc(t,e,r,n,i,s=!1){if(n===i)return this;if(!s&&i<=n?i+=tsvb_PI_2:s&&n<=i&&(n+=tsvb_PI_2),i-n==0)return this;const o=t+Math.cos(n)*r,a=e+Math.sin(n)*r,u=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-o),e=Math.abs(l[l.length-1]-a);t<u&&e<u||l.push(o,a)}else this.moveTo(o,a),l=this.currentPath.points;return tsvb_ArcUtils.arc(o,a,t,e,r,n,i,s,l),this}beginFill(t=0,e){return this.beginTextureFill({texture:tsvb_Texture_Texture.WHITE,color:t,alpha:e})}normalizeColor(t){const e=src_tsvb_Color.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:tsvb_Texture_Texture.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,n){return this.drawShape(new tsvb_Rectangle(t,e,r,n))}drawRoundedRect(t,e,r,n,i){return this.drawShape(new tsvb_RoundedRectangle(t,e,r,n,i))}drawCircle(t,e,r){return this.drawShape(new tsvb_Circle(t,e,r))}drawEllipse(t,e,r,n){return this.drawShape(new tsvb_Ellipse(t,e,r,n))}drawPolygon(...t){let e,r=!0;const n=t[0];n.points?(r=n.closeStroke,e=n.points):e=Array.isArray(t[0])?t[0]:t;const i=new tsvb_Polygon(e);return i.closeStroke=r,this.drawShape(i),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==tsvb_SHAPES.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let n=0;n<r;n++){const r=t.batches[n],i=r.style.color,s=new Float32Array(this.vertexData.buffer,4*r.attribStart*2,2*r.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*r.attribStart*2,2*r.attribSize),a={vertexData:s,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*r.start,r.size),uvs:o,_batchRGB:src_tsvb_Color.shared.setValue(i).toRgbArray(),_tintRGB:i,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[n]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){const r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}}_renderDirect(t){const e=this._resolveDirectShader(t),r=this._geometry,n=this.worldAlpha,i=e.uniforms,s=r.drawCalls;i.translationMatrix=this.transform.worldTransform,src_tsvb_Color.shared.setValue(this._tintColor).premultiply(n).toArray(i.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let e=0,n=s.length;e<n;e++)this._renderDrawCallDirect(t,r.drawCalls[e])}_renderDrawCallDirect(t,e){const{texArray:r,type:n,size:i,start:s}=e,o=r.count;for(let e=0;e<o;e++)t.texture.bind(r.elements[e],e);t.geometry.draw(n,i,s)}_resolveDirectShader(t){let e=this.shader;const r=this.pluginName;if(!e){if(!tsvb_DEFAULT_SHADERS[r]){const{maxTextures:e}=t.plugins[r],n=new Int32Array(e);for(let t=0;t<e;t++)n[t]=t;const i={tint:new Float32Array([1,1,1,1]),translationMatrix:new tsvb_Matrix,default:tsvb_UniformGroup.from({uSamplers:n},!0)},s=t.plugins[r]._shader.program;tsvb_DEFAULT_SHADERS[r]=new tsvb_Shader(s,i)}e=tsvb_DEFAULT_SHADERS[r]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:r,maxX:n,maxY:i}=t.bounds;this._bounds.addFrame(this.transform,e,r,n,i)}containsPoint(e){return this.worldTransform.applyInverse(e,t._TEMP_POINT),this._geometry.containsPoint(t._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=src_tsvb_Color.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,r=e.a,n=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,u=this._geometry.points,l=this.vertexData;let c=0;for(let t=0;t<u.length;t+=2){const e=u[t],h=u[t+1];l[c++]=r*e+i*h+o,l[c++]=s*h+n*e+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};tsvb_Graphics.curves=tsvb_curves,tsvb_Graphics._TEMP_POINT=new tsvb_Point;let src_tsvb_Graphics=tsvb_Graphics;const tsvb_graphicsUtils={buildPoly:tsvb_buildPoly,buildCircle:tsvb_buildCircle,buildRectangle:tsvb_buildRectangle,buildRoundedRectangle:tsvb_buildRoundedRectangle,buildLine:tsvb_buildLine,ArcUtils:tsvb_ArcUtils,BezierUtils:tsvb_BezierUtils,QuadraticUtils:tsvb_QuadraticUtils,BatchPart:tsvb_BatchPart,FILL_COMMANDS:tsvb_FILL_COMMANDS,BATCH_POOL:tsvb_BATCH_POOL,DRAW_CALL_POOL:tsvb_DRAW_CALL_POOL};class tsvb_MeshBatchUvs{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const tsvb_Mesh_tempPoint=new tsvb_Point,tsvb_tempPolygon=new tsvb_Polygon,tsvb_Mesh=class t extends src_tsvb_Container{constructor(t,e,r,n=tsvb_DRAW_MODES.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||tsvb_State.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=tsvb_settings.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(e){const r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===tsvb_DRAW_MODES.TRIANGLES&&r.length<2*t.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,i=n.a,s=n.b,o=n.c,a=n.d,u=n.tx,l=n.ty,c=this.vertexData;for(let t=0;t<c.length/2;t++){const r=e[2*t],n=e[2*t+1];c[2*t]=i*r+o*n+u,c[2*t+1]=s*r+a*n+l}if(this._roundPixels){const t=tsvb_settings.RESOLUTION;for(let e=0;e<c.length;++e)c[e]=Math.round(c[e]*t)/t}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new tsvb_MeshBatchUvs(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,tsvb_Mesh_tempPoint);const e=this.geometry.getBuffer("aVertexPosition").data,r=tsvb_tempPolygon.points,n=this.geometry.getIndex().data,i=n.length,s=4===this.drawMode?3:1;for(let t=0;t+2<i;t+=s){const i=2*n[t],s=2*n[t+1],o=2*n[t+2];if(r[0]=e[i],r[1]=e[i+1],r[2]=e[s],r[3]=e[s+1],r[4]=e[o],r[5]=e[o+1],tsvb_tempPolygon.contains(tsvb_Mesh_tempPoint.x,tsvb_Mesh_tempPoint.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};tsvb_Mesh.BATCHABLE_SIZE=100;let src_tsvb_Mesh=tsvb_Mesh;class tsvb_MeshGeometry extends tsvb_Geometry{constructor(t,e,r){super();const n=new tsvb_Buffer(t),i=new tsvb_Buffer(e,!0),s=new tsvb_Buffer(r,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,tsvb_TYPES.FLOAT).addAttribute("aTextureCoord",i,2,!1,tsvb_TYPES.FLOAT).addIndex(s),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var tsvb_mesh_frag_fragment="varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n",tsvb_mesh_vert_vertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n";class tsvb_MeshMaterial extends tsvb_Shader{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:tsvb_Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(r,e.uniforms),super(e.program||src_tsvb_Program.from(tsvb_mesh_vert_vertex,tsvb_mesh_frag_fragment),r),this._colorDirty=!1,this.uvMatrix=new tsvb_TextureMatrix(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new src_tsvb_Color(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;src_tsvb_Color.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class tsvb_PlaneGeometry extends tsvb_MeshGeometry{constructor(t=100,e=100,r=10,n=10){super(),this.segWidth=r,this.segHeight=n,this.width=t,this.height=e,this.build()}build(){const t=this.segWidth*this.segHeight,e=[],r=[],n=[],i=this.segWidth-1,s=this.segHeight-1,o=this.width/i,a=this.height/s;for(let n=0;n<t;n++){const t=n%this.segWidth,u=n/this.segWidth|0;e.push(t*o,u*a),r.push(t/i,u/s)}const u=i*s;for(let t=0;t<u;t++){const e=t%i,r=t/i|0,s=r*this.segWidth+e,o=r*this.segWidth+e+1,a=(r+1)*this.segWidth+e,u=(r+1)*this.segWidth+e+1;n.push(s,o,a,o,u,a)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class tsvb_RopeGeometry extends tsvb_MeshGeometry{constructor(t=200,e,r=0){super(new Float32Array(4*e.length),new Float32Array(4*e.length),new Uint16Array(6*(e.length-1))),this.points=e,this._width=t,this.textureScale=r,this.build()}get width(){return this._width}build(){const t=this.points;if(!t)return;const e=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),n=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),r.data=new Float32Array(4*t.length),n.data=new Uint16Array(6*(t.length-1)));const i=r.data,s=n.data;i[0]=0,i[1]=0,i[2]=0,i[3]=1;let o=0,a=t[0];const u=this._width*this.textureScale,l=t.length;for(let e=0;e<l;e++){const r=4*e;if(this.textureScale>0){const r=a.x-t[e].x,n=a.y-t[e].y,i=Math.sqrt(r*r+n*n);a=t[e],o+=i/u}else o=e/(l-1);i[r]=o,i[r+1]=0,i[r+2]=o,i[r+3]=1}let c=0;for(let t=0;t<l-1;t++){const e=2*t;s[c++]=e,s[c++]=e+1,s[c++]=e+2,s[c++]=e+2,s[c++]=e+1,s[c++]=e+3}r.update(),n.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let e,r=t[0],n=0,i=0;const s=this.buffers[0].data,o=t.length,a=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let u=0;u<o;u++){const l=t[u],c=4*u;e=u<t.length-1?t[u+1]:l,i=-(e.x-r.x),n=e.y-r.y;let h=10*(1-u/(o-1));h>1&&(h=1);const f=Math.sqrt(n*n+i*i);f<1e-6?(n=0,i=0):(n/=f,i/=f,n*=a,i*=a),s[c]=l.x+n,s[c+1]=l.y+i,s[c+2]=l.x-n,s[c+3]=l.y-i,r=l}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class tsvb_SimplePlane extends src_tsvb_Mesh{constructor(t,e,r){super(new tsvb_PlaneGeometry(t.width,t.height,e,r),new tsvb_MeshMaterial(tsvb_Texture_Texture.WHITE)),this.texture=t,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const t=this.geometry,{width:e,height:r}=this.shader.texture;this.autoResize&&(t.width!==e||t.height!==r)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())}set texture(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(t)}destroy(t){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(t)}}const tsvb_DEFAULT_BORDER_SIZE=10;class tsvb_NineSlicePlane extends tsvb_SimplePlane{constructor(t,e,r,n,i){super(tsvb_Texture_Texture.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=e??t.defaultBorders?.left??tsvb_DEFAULT_BORDER_SIZE,this._rightWidth=n??t.defaultBorders?.right??tsvb_DEFAULT_BORDER_SIZE,this._topHeight=r??t.defaultBorders?.top??tsvb_DEFAULT_BORDER_SIZE,this._bottomHeight=i??t.defaultBorders?.bottom??tsvb_DEFAULT_BORDER_SIZE,this.texture=t}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}updateHorizontalVertices(){const t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){const t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width}_getMinScale(){const t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,r=this._topHeight+this._bottomHeight,n=this._height>r?1:this._height/r;return Math.min(e,n)}get width(){return this._width}set width(t){this._width=t,this._refresh()}get height(){return this._height}set height(t){this._height=t,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this._refresh()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this._refresh()}_refresh(){const t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;const r=1/this._origWidth,n=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=n*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-n*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class tsvb_SimpleMesh extends src_tsvb_Mesh{constructor(t=tsvb_Texture_Texture.EMPTY,e,r,n,i){const s=new tsvb_MeshGeometry(e,r,n);s.getBuffer("aVertexPosition").static=!1;super(s,new tsvb_MeshMaterial(t),null,i),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}class tsvb_SimpleRope extends src_tsvb_Mesh{constructor(t,e,r=0){const n=new tsvb_RopeGeometry(t.height,e,r),i=new tsvb_MeshMaterial(t);r>0&&(t.baseTexture.wrapMode=tsvb_WRAP_MODES.REPEAT),super(n,i),this.autoUpdate=!0}_render(t){const e=this.geometry;(this.autoUpdate||e._width!==this.shader.texture.height)&&(e._width=this.shader.texture.height,e.update()),super._render(t)}}class tsvb_ParticleContainer extends src_tsvb_Container{constructor(t=1500,e,r=16384,n=!1){super();r>16384&&(r=16384),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=r,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=tsvb_BLEND_MODES.NORMAL,this.autoResize=n,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e),this._tintColor=new src_tsvb_Color(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintColor.toRgbArray(this.tintRgb)}render(t){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(()=>this.onChildrenChange(0)))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const e=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class tsvb_ParticleBuffer{constructor(t,e,r){this.geometry=new tsvb_Geometry,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let n=t[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||tsvb_TYPES.FLOAT,offset:n.offset},e[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new tsvb_Buffer(tsvb_createIndicesForQuads(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let t=0;t<this.dynamicProperties.length;++t){const r=this.dynamicProperties[t];r.offset=e,e+=r.size,this.dynamicStride+=r.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new tsvb_Buffer(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let t=0;t<this.staticProperties.length;++t){const e=this.staticProperties[t];e.offset=n,n+=e.size,this.staticStride+=e.size}const i=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(i),this.staticDataUint32=new Uint32Array(i),this.staticBuffer=new tsvb_Buffer(this.staticData,!0,!1);for(let e=0;e<this.dynamicProperties.length;++e){const r=this.dynamicProperties[e];t.addAttribute(r.attributeName,this.dynamicBuffer,0,r.type===tsvb_TYPES.UNSIGNED_BYTE,r.type,4*this.dynamicStride,4*r.offset)}for(let e=0;e<this.staticProperties.length;++e){const r=this.staticProperties[e];t.addAttribute(r.attributeName,this.staticBuffer,0,r.type===tsvb_TYPES.UNSIGNED_BYTE,r.type,4*this.staticStride,4*r.offset)}}uploadDynamic(t,e,r){for(let n=0;n<this.dynamicProperties.length;n++){const i=this.dynamicProperties[n];i.uploadFunction(t,e,r,i.type===tsvb_TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let n=0;n<this.staticProperties.length;n++){const i=this.staticProperties[n];i.uploadFunction(t,e,r,i.type===tsvb_TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var tsvb_particles_frag_fragment="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",tsvb_particles_vert_vertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n";class tsvb_ParticleRenderer extends tsvb_ObjectRenderer{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new tsvb_Matrix,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:tsvb_TYPES.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=tsvb_Shader.from(tsvb_particles_vert_vertex,tsvb_particles_frag_fragment,{}),this.state=tsvb_State.for2d()}render(t){const e=t.children,r=t._maxSize,n=t._batchSize,i=this.renderer;let s=e.length;if(0===s)return;s>r&&!t.autoResize&&(s=r);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,u=a.alphaMode>0;this.state.blendMode=tsvb_correctBlendMode(t.blendMode,u),i.state.set(this.state);const l=i.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=src_tsvb_Color.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,u).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let h=!1;for(let r=0,a=0;r<s;r+=n,a+=1){let u=s-r;u>n&&(u=n),a>=o.length&&o.push(this._generateOneMoreBuffer(t));const c=o[a];c.uploadDynamic(e,r,u);const f=t._bufferUpdateIDs[a]||0;h=h||c._updateID<f,h&&(c._updateID=t._updateID,c.uploadStatic(e,r,u)),i.geometry.bind(c.geometry),l.drawElements(l.TRIANGLES,6*u,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,n=t._batchSize,i=t._properties;for(let t=0;t<r;t+=n)e.push(new tsvb_ParticleBuffer(this.properties,i,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new tsvb_ParticleBuffer(this.properties,r,e)}uploadVertices(t,e,r,n,i,s){let o=0,a=0,u=0,l=0;for(let c=0;c<r;++c){const r=t[e+c],h=r._texture,f=r.scale.x,d=r.scale.y,p=h.trim,v=h.orig;p?(a=p.x-r.anchor.x*v.width,o=a+p.width,l=p.y-r.anchor.y*v.height,u=l+p.height):(o=v.width*(1-r.anchor.x),a=v.width*-r.anchor.x,u=v.height*(1-r.anchor.y),l=v.height*-r.anchor.y),n[s]=a*f,n[s+1]=l*d,n[s+i]=o*f,n[s+i+1]=l*d,n[s+2*i]=o*f,n[s+2*i+1]=u*d,n[s+3*i]=a*f,n[s+3*i+1]=u*d,s+=4*i}}uploadPosition(t,e,r,n,i,s){for(let o=0;o<r;o++){const r=t[e+o].position;n[s]=r.x,n[s+1]=r.y,n[s+i]=r.x,n[s+i+1]=r.y,n[s+2*i]=r.x,n[s+2*i+1]=r.y,n[s+3*i]=r.x,n[s+3*i+1]=r.y,s+=4*i}}uploadRotation(t,e,r,n,i,s){for(let o=0;o<r;o++){const r=t[e+o].rotation;n[s]=r,n[s+i]=r,n[s+2*i]=r,n[s+3*i]=r,s+=4*i}}uploadUvs(t,e,r,n,i,s){for(let o=0;o<r;++o){const r=t[e+o]._texture._uvs;r?(n[s]=r.x0,n[s+1]=r.y0,n[s+i]=r.x1,n[s+i+1]=r.y1,n[s+2*i]=r.x2,n[s+2*i+1]=r.y2,n[s+3*i]=r.x3,n[s+3*i+1]=r.y3,s+=4*i):(n[s]=0,n[s+1]=0,n[s+i]=0,n[s+i+1]=0,n[s+2*i]=0,n[s+2*i+1]=0,n[s+3*i]=0,n[s+3*i+1]=0,s+=4*i)}}uploadTint(t,e,r,n,i,s){for(let o=0;o<r;++o){const r=t[e+o],a=src_tsvb_Color.shared.setValue(r._tintRGB).toPremultiplied(r.alpha,r.texture.baseTexture.alphaMode>0);n[s]=a,n[s+i]=a,n[s+2*i]=a,n[s+3*i]=a,s+=4*i}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}tsvb_ParticleRenderer.extension={name:"particle",type:tsvb_ExtensionType.RendererPlugin},tsvb_extensions.add(tsvb_ParticleRenderer);var tsvb_TEXT_GRADIENT=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(tsvb_TEXT_GRADIENT||{});const tsvb_contextSettings={willReadFrequently:!0},tsvb_TextMetrics=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0!==e){const r=tsvb_settings.ADAPTER.getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return e}constructor(t,e,r,n,i,s,o,a,u){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=i,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=u}static measureText(e,r,n,i=t._canvas){n=n??r.wordWrap;const s=r.toFontString(),o=t.measureFont(s);0===o.fontSize&&(o.fontSize=r.fontSize,o.ascent=r.fontSize);const a=i.getContext("2d",tsvb_contextSettings);a.font=s;const u=(n?t.wordWrap(e,r,i):e).split(/(?:\r\n|\r|\n)/),l=new Array(u.length);let c=0;for(let e=0;e<u.length;e++){const n=t._measureText(u[e],r.letterSpacing,a);l[e]=n,c=Math.max(c,n)}let h=c+r.strokeThickness;r.dropShadow&&(h+=r.dropShadowDistance);const f=r.lineHeight||o.fontSize+r.strokeThickness;let d=Math.max(f,o.fontSize+2*r.strokeThickness)+r.leading+(u.length-1)*(f+r.leading);return r.dropShadow&&(d+=r.dropShadowDistance),new t(e,r,h,d,u,l,f+r.leading,c,o)}static _measureText(e,r,n){let i=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(n.letterSpacing=`${r}px`,n.textLetterSpacing=`${r}px`,i=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let s=n.measureText(e).width;return s>0&&(i?s-=r:s+=(t.graphemeSegmenter(e).length-1)*r),s}static wordWrap(e,r,n=t._canvas){const i=n.getContext("2d",tsvb_contextSettings);let s=0,o="",a="";const u=Object.create(null),{letterSpacing:l,whiteSpace:c}=r,h=t.collapseSpaces(c),f=t.collapseNewlines(c);let d=!h;const p=r.wordWrapWidth+l,v=t.tokenize(e);for(let e=0;e<v.length;e++){let n=v[e];if(t.isNewline(n)){if(!f){a+=t.addLine(o),d=!h,o="",s=0;continue}n=" "}if(h){const e=t.isBreakingSpace(n),r=t.isBreakingSpace(o[o.length-1]);if(e&&r)continue}const c=t.getFromCache(n,l,u,i);if(c>p)if(""!==o&&(a+=t.addLine(o),o="",s=0),t.canBreakWords(n,r.breakWords)){const e=t.wordWrapSplit(n);for(let c=0;c<e.length;c++){let h=e[c],f=h,v=1;for(;e[c+v];){const i=e[c+v];if(t.canBreakChars(f,i,n,c,r.breakWords))break;h+=i,f=i,v++}c+=v-1;const y=t.getFromCache(h,l,u,i);y+s>p&&(a+=t.addLine(o),d=!1,o="",s=0),o+=h,s+=y}}else{o.length>0&&(a+=t.addLine(o),o="",s=0);const r=e===v.length-1;a+=t.addLine(n,!r),d=!1,o="",s=0}else c+s>p&&(d=!1,a+=t.addLine(o),o="",s=0),(o.length>0||!t.isBreakingSpace(n)||d)&&(o+=n,s+=c)}return a+=t.addLine(o,!1),a}static addLine(e,r=!0){return e=t.trimRight(e),e=r?`${e}\n`:e}static getFromCache(e,r,n,i){let s=n[e];return"number"!=typeof s&&(s=t._measureText(e,r,i)+r,n[e]=s),s}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(e){if("string"!=typeof e)return"";for(let r=e.length-1;r>=0;r--){const n=e[r];if(!t.isBreakingSpace(n))break;e=e.slice(0,-1)}return e}static isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,r){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const r=[];let n="";if("string"!=typeof e)return r;for(let i=0;i<e.length;i++){const s=e[i],o=e[i+1];t.isBreakingSpace(s,o)||t.isNewline(s)?(""!==n&&(r.push(n),n=""),r.push(s)):n+=s}return""!==n&&r.push(n),r}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,i){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const r={ascent:0,descent:0,fontSize:0},n=t._canvas,i=t._context;i.font=e;const s=t.METRICS_STRING+t.BASELINE_SYMBOL,o=Math.ceil(i.measureText(s).width);let a=Math.ceil(i.measureText(t.BASELINE_SYMBOL).width);const u=Math.ceil(t.HEIGHT_MULTIPLIER*a);if(a=a*t.BASELINE_MULTIPLIER|0,0===o||0===u)return t._fonts[e]=r,r;n.width=o,n.height=u,i.fillStyle="#f00",i.fillRect(0,0,o,u),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(s,0,a);const l=i.getImageData(0,0,o,u).data,c=l.length,h=4*o;let f=0,d=0,p=!1;for(f=0;f<a;++f){for(let t=0;t<h;t+=4)if(255!==l[d+t]){p=!0;break}if(p)break;d+=h}for(r.ascent=a-f,d=c-h,p=!1,f=u;f>a;--f){for(let t=0;t<h;t+=4)if(255!==l[d+t]){p=!0;break}if(p)break;d-=h}return r.descent=f-a,r.fontSize=r.ascent+r.descent,t._fonts[e]=r,r}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let e;try{const r=new OffscreenCanvas(0,0);if(r.getContext("2d",tsvb_contextSettings)?.measureText)return t.__canvas=r,r;e=tsvb_settings.ADAPTER.createCanvas()}catch{e=tsvb_settings.ADAPTER.createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",tsvb_contextSettings)),t.__context}};tsvb_TextMetrics.METRICS_STRING="|q",tsvb_TextMetrics.BASELINE_SYMBOL="M",tsvb_TextMetrics.BASELINE_MULTIPLIER=1.4,tsvb_TextMetrics.HEIGHT_MULTIPLIER=2,tsvb_TextMetrics.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),tsvb_TextMetrics.experimentalLetterSpacing=!1,tsvb_TextMetrics._fonts={},tsvb_TextMetrics._newlines=[10,13],tsvb_TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let src_tsvb_TextMetrics=tsvb_TextMetrics;const tsvb_genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],tsvb_TextStyle=class t{constructor(t){this.styleID=0,this.reset(),tsvb_deepCopyProperties(this,t,t)}clone(){const e={};return tsvb_deepCopyProperties(e,this,t.defaultStyle),new t(e)}reset(){tsvb_deepCopyProperties(this,t.defaultStyle,t.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=tsvb_getColor(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=tsvb_getColor(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){tsvb_areArraysEqual(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=tsvb_getColor(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let t=e.length-1;t>=0;t--){let r=e[t].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!tsvb_genericFontFamilies.includes(r)&&(r=`"${r}"`),e[t]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};tsvb_TextStyle.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:tsvb_TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let src_tsvb_TextStyle=tsvb_TextStyle;function tsvb_getColor(t){const e=src_tsvb_Color.shared,r=t=>{const r=e.setValue(t);return 1===r.alpha?r.toHex():r.toRgbaString()};return Array.isArray(t)?t.map(r):r(t)}function tsvb_areArraysEqual(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}function tsvb_deepCopyProperties(t,e,r){for(const n in r)Array.isArray(e[n])?t[n]=e[n].slice():t[n]=e[n]}const tsvb_defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},tsvb_Text=class t extends tsvb_Sprite{constructor(e,r,n){let i=!1;n||(n=tsvb_settings.ADAPTER.createCanvas(),i=!0),n.width=3,n.height=3;const s=tsvb_Texture_Texture.from(n);s.orig=new tsvb_Rectangle,s.trim=new tsvb_Rectangle,super(s),this._ownCanvas=i,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=t.defaultResolution??tsvb_settings.RESOLUTION,this._autoResolution=t.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=r,this.localStyleID=-1}static get experimentalLetterSpacing(){return src_tsvb_TextMetrics.experimentalLetterSpacing}static set experimentalLetterSpacing(t){tsvb_deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),src_tsvb_TextMetrics.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const r=this.context,n=src_tsvb_TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),i=n.width,s=n.height,o=n.lines,a=n.lineHeight,u=n.lineWidths,l=n.maxLineWidth,c=n.fontProperties;let h,f;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,i)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;const d=e.dropShadow?2:1;for(let t=0;t<d;++t){const i=e.dropShadow&&0===t,d=i?Math.ceil(Math.max(1,s)+2*e.padding):0,p=d*this._resolution;if(i){r.fillStyle="black",r.strokeStyle="black";const t=e.dropShadowColor,n=e.dropShadowBlur*this._resolution,i=e.dropShadowDistance*this._resolution;r.shadowColor=src_tsvb_Color.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=n,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*i,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*i+p}else r.fillStyle=this._generateFillStyle(e,o,n),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let v=(a-c.fontSize)/2;a-c.fontSize<0&&(v=0);for(let t=0;t<o.length;t++)h=e.strokeThickness/2,f=e.strokeThickness/2+t*a+c.ascent+v,"right"===e.align?h+=l-u[t]:"center"===e.align&&(h+=(l-u[t])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[t],h+e.padding,f+e.padding-d,!0),e.fill&&this.drawLetterSpacing(o[t],h+e.padding,f+e.padding-d)}this.updateTexture()}drawLetterSpacing(t,e,r,n=!1){const i=this._style.letterSpacing;let s=!1;if(src_tsvb_TextMetrics.experimentalLetterSpacingSupported&&(src_tsvb_TextMetrics.experimentalLetterSpacing?(this.context.letterSpacing=`${i}px`,this.context.textLetterSpacing=`${i}px`,s=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===i||s)return void(n?this.context.strokeText(t,e,r):this.context.fillText(t,e,r));let o=e;const a=src_tsvb_TextMetrics.graphemeSegmenter(t);let u=this.context.measureText(t).width,l=0;for(let t=0;t<a.length;++t){const e=a[t];n?this.context.strokeText(e,o,r):this.context.fillText(e,o,r);let s="";for(let e=t+1;e<a.length;++e)s+=a[e];l=this.context.measureText(s).width,o+=u-l+i,u=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=tsvb_trimCanvas(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,r=this._style,n=r.trim?0:r.padding,i=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-2*n,e.orig.height=e._frame.height-2*n,this._onTextureUpdate(),i.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){const n=t.fill;if(!Array.isArray(n))return n;if(1===n.length)return n[0];let i;const s=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-s-2*o,u=this.canvas.height/this._resolution-s-2*o,l=n.slice(),c=t.fillGradientStops.slice();if(!c.length){const t=l.length+1;for(let e=1;e<t;++e)c.push(e/t)}if(l.unshift(n[0]),c.unshift(0),l.push(n[n.length-1]),c.push(1),t.fillGradientType===tsvb_TEXT_GRADIENT.LINEAR_VERTICAL){i=this.context.createLinearGradient(a/2,o,a/2,u+o);const n=r.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const s=r.lineHeight*(t-1)+n,o=r.lineHeight*t;let a=o;t>0&&s>o&&(a=(o+s)/2);const h=o+n,f=r.lineHeight*(t+1);let d=h;t+1<e.length&&f<h&&(d=(h+f)/2);const p=(d-a)/u;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof c[t]?c[t]:t/l.length;let r=Math.min(1,Math.max(0,a/u+e*p));r=Number(r.toFixed(5)),i.addColorStop(r,l[t])}}}else{i=this.context.createLinearGradient(o,u/2,a+o,u/2);const t=l.length+1;let e=1;for(let r=0;r<l.length;r++){let n;n="number"==typeof c[r]?c[r]:e/t,i.addColorStop(n,l[r]),e++}}return i}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},tsvb_defaultDestroyOptions,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=tsvb_sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=tsvb_sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof src_tsvb_TextStyle?t:new src_tsvb_TextStyle(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};tsvb_Text.defaultAutoResolution=!0;let src_tsvb_Text=tsvb_Text;class tsvb_CountLimiter{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function tsvb_findMultipleBaseTextures(t,e){let r=!1;if(t?._textures?.length)for(let n=0;n<t._textures.length;n++)if(t._textures[n]instanceof tsvb_Texture_Texture){const i=t._textures[n].baseTexture;e.includes(i)||(e.push(i),r=!0)}return r}function tsvb_findBaseTexture(t,e){if(t.baseTexture instanceof src_tsvb_BaseTexture){const r=t.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function tsvb_findTexture(t,e){if(t._texture&&t._texture instanceof tsvb_Texture_Texture){const r=t._texture.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function tsvb_drawText(t,e){return e instanceof src_tsvb_Text&&(e.updateText(!0),!0)}function tsvb_calculateTextStyle(t,e){if(e instanceof src_tsvb_TextStyle){const t=e.toFontString();return src_tsvb_TextMetrics.measureFont(t),!0}return!1}function tsvb_findText(t,e){if(t instanceof src_tsvb_Text){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const r=t._texture.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function tsvb_findTextStyle(t,e){return t instanceof src_tsvb_TextStyle&&(e.includes(t)||e.push(t),!0)}const tsvb_BasePrepare=class t{constructor(e){this.limiter=new tsvb_CountLimiter(t.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(tsvb_findText),this.registerFindHook(tsvb_findTextStyle),this.registerFindHook(tsvb_findMultipleBaseTextures),this.registerFindHook(tsvb_findBaseTexture),this.registerFindHook(tsvb_findTexture),this.registerUploadHook(tsvb_drawText),this.registerUploadHook(tsvb_calculateTextStyle)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,src_tsvb_Ticker.system.addOnce(this.tick,this,tsvb_UPDATE_PRIORITY.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)src_tsvb_Ticker.system.addOnce(this.tick,this,tsvb_UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof src_tsvb_Container)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&src_tsvb_Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};tsvb_BasePrepare.uploadsPerFrame=4;let src_tsvb_BasePrepare=tsvb_BasePrepare;function tsvb_uploadBaseTextures(t,e){return e instanceof src_tsvb_BaseTexture&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function tsvb_uploadGraphics(t,e){if(!(e instanceof src_tsvb_Graphics))return!1;const{geometry:r}=e;e.finishPoly(),r.updateBatches();const{batches:n}=r;for(let e=0;e<n.length;e++){const{texture:r}=n[e].style;r&&tsvb_uploadBaseTextures(t,r.baseTexture)}return r.batchable||t.geometry.bind(r,e._resolveDirectShader(t)),!0}function tsvb_findGraphics(t,e){return t instanceof src_tsvb_Graphics&&(e.push(t),!0)}Object.defineProperties(tsvb_settings,{UPLOADS_PER_FRAME:{get:()=>src_tsvb_BasePrepare.uploadsPerFrame,set(t){tsvb_deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),src_tsvb_BasePrepare.uploadsPerFrame=t}}});class tsvb_Prepare extends src_tsvb_BasePrepare{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(tsvb_findGraphics),this.registerUploadHook(tsvb_uploadBaseTextures),this.registerUploadHook(tsvb_uploadGraphics)}}tsvb_Prepare.extension={name:"prepare",type:tsvb_ExtensionType.RendererSystem},tsvb_extensions.add(tsvb_Prepare);class tsvb_TimeLimiter{constructor(t){this.maxMilliseconds=t,this.frameStart=0}beginFrame(){this.frameStart=Date.now()}allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds}}class tsvb_AnimatedSprite extends tsvb_Sprite{constructor(t,e=!0){super(t[0]instanceof tsvb_Texture_Texture?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(src_tsvb_Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(src_tsvb_Ticker.shared.add(this.update,this,tsvb_UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,r=this.currentFrame;if(null!==this._durations){let r=this._currentTime%1*this._durations[this.currentFrame];for(r+=e/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];const n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r||this.animationSpeed<0&&this.currentFrame>r)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let r=0;r<t.length;++r)e.push(tsvb_Texture_Texture.from(t[r]));return new tsvb_AnimatedSprite(e)}static fromImages(t){const e=[];for(let r=0;r<t.length;++r)e.push(tsvb_Texture_Texture.from(t[r]));return new tsvb_AnimatedSprite(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof tsvb_Texture_Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(src_tsvb_Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(src_tsvb_Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const tsvb_TilingSprite_tempPoint=new tsvb_Point;class tsvb_TilingSprite extends tsvb_Sprite{constructor(t,e=100,r=100){super(t),this.tileTransform=new src_tsvb_Transform,this._width=e,this._height=r,this.uvMatrix=this.texture.uvMatrix||new tsvb_TextureMatrix(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){const e=this._texture;!e||!e.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){const t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,r,n)}getLocalBounds(t){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new tsvb_Rectangle),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,tsvb_TilingSprite_tempPoint);const e=this._width,r=this._height,n=-e*this.anchor._x;if(tsvb_TilingSprite_tempPoint.x>=n&&tsvb_TilingSprite_tempPoint.x<n+e){const t=-r*this.anchor._y;if(tsvb_TilingSprite_tempPoint.y>=t&&tsvb_TilingSprite_tempPoint.y<t+r)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,e){const r=t instanceof tsvb_Texture_Texture?t:tsvb_Texture_Texture.from(t,e);return new tsvb_TilingSprite(r,e.width,e.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}}var tsvb_gl2FragmentSrc="#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",tsvb_gl2VertexSrc="#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",tsvb_gl1FragmentSrc="#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",tsvb_gl1VertexSrc="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",tsvb_fragmentSimpleSrc="#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n";const tsvb_TilingSpriteRenderer_tempMat=new tsvb_Matrix;class tsvb_TilingSpriteRenderer extends tsvb_ObjectRenderer{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new tsvb_QuadUv,this.state=tsvb_State.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=tsvb_Shader.from(tsvb_gl1VertexSrc,tsvb_fragmentSimpleSrc,e),this.shader=t.context.webGLVersion>1?tsvb_Shader.from(tsvb_gl2VertexSrc,tsvb_gl2FragmentSrc,e):tsvb_Shader.from(tsvb_gl1VertexSrc,tsvb_gl1FragmentSrc,e)}render(t){const e=this.renderer,r=this.quad;let n=r.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const i=t.uvRespectAnchor?t.anchor.x:0,s=t.uvRespectAnchor?t.anchor.y:0;n=r.uvs,n[0]=n[6]=-i,n[1]=n[3]=-s,n[2]=n[4]=1-i,n[5]=n[7]=1-s,r.invalidate();const o=t._texture,a=o.baseTexture,u=a.alphaMode>0,l=t.tileTransform.localTransform,c=t.uvMatrix;let h=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;h&&(a._glTextures[e.CONTEXT_UID]?h=a.wrapMode!==tsvb_WRAP_MODES.CLAMP:a.wrapMode===tsvb_WRAP_MODES.CLAMP&&(a.wrapMode=tsvb_WRAP_MODES.REPEAT));const f=h?this.simpleShader:this.shader,d=o.width,p=o.height,v=t._width,y=t._height;tsvb_TilingSpriteRenderer_tempMat.set(l.a*d/v,l.b*d/y,l.c*p/v,l.d*p/y,l.tx/v,l.ty/y),tsvb_TilingSpriteRenderer_tempMat.invert(),h?tsvb_TilingSpriteRenderer_tempMat.prepend(c.mapCoord):(f.uniforms.uMapCoord=c.mapCoord.toArray(!0),f.uniforms.uClampFrame=c.uClampFrame,f.uniforms.uClampOffset=c.uClampOffset),f.uniforms.uTransform=tsvb_TilingSpriteRenderer_tempMat.toArray(!0),f.uniforms.uColor=src_tsvb_Color.shared.setValue(t.tint).premultiply(t.worldAlpha,u).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=o,e.shader.bind(f),e.geometry.bind(r),this.state.blendMode=tsvb_correctBlendMode(t.blendMode,u),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}tsvb_TilingSpriteRenderer.extension={name:"tilingSprite",type:tsvb_ExtensionType.RendererPlugin},tsvb_extensions.add(tsvb_TilingSpriteRenderer);const tsvb_Spritesheet=class t{constructor(t,e,r){this.linkedSheets=[],(t instanceof src_tsvb_BaseTexture||t instanceof tsvb_Texture_Texture)&&(t={texture:t,data:e,resolutionFilename:r});const{texture:n,data:i,resolutionFilename:s=null,cachePrefix:o=""}=t;this.cachePrefix=o,this._texture=n instanceof tsvb_Texture_Texture?n:null,this.baseTexture=n instanceof src_tsvb_BaseTexture?n:this._texture.baseTexture,this.textures={},this.animations={},this.data=i;const a=this.baseTexture.resource;this.resolution=this._updateResolution(s||(a?a.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let r=tsvb_getResolutionOfUrl(t,null);return null===r&&(r="number"==typeof e?e:parseFloat(e??"1")),1!==r&&this.baseTexture.setResolution(r),r}parse(){return new Promise((e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(e){let r=e;const n=t.BATCH_SIZE;for(;r-e<n&&r<this._frameKeys.length;){const t=this._frameKeys[r],e=this._frames[t],n=e.frame;if(n){let r=null,i=null;const s=!1!==e.trimmed&&e.sourceSize?e.sourceSize:e.frame,o=new tsvb_Rectangle(0,0,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution);r=e.rotated?new tsvb_Rectangle(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):new tsvb_Rectangle(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),!1!==e.trimmed&&e.spriteSourceSize&&(i=new tsvb_Rectangle(Math.floor(e.spriteSourceSize.x)/this.resolution,Math.floor(e.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[t]=new tsvb_Texture_Texture(this.baseTexture,r,o,i,e.rotated?2:0,e.anchor,e.borders),tsvb_Texture_Texture.addToCache(this.textures[t],this.cachePrefix+t.toString())}r++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const n=t[e][r];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*t.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};tsvb_Spritesheet.BATCH_SIZE=1e3;let src_tsvb_Spritesheet=tsvb_Spritesheet;const tsvb_validImages=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function tsvb_getCacheableAssets(t,e,r){const n={};if(t.forEach((t=>{n[t]=e})),Object.keys(e.textures).forEach((t=>{n[`${e.cachePrefix}${t}`]=e.textures[t]})),!r){const r=tsvb_path.dirname(t[0]);e.linkedSheets.forEach(((t,i)=>{Object.assign(n,tsvb_getCacheableAssets([`${r}/${e.data.meta.related_multi_packs[i]}`],t,!0))}))}return n}const tsvb_spritesheetAsset={extension:tsvb_ExtensionType.Asset,cache:{test:t=>t instanceof src_tsvb_Spritesheet,getCacheableAssets:(t,e)=>tsvb_getCacheableAssets(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),r=e.pop(),n=e.pop();return"json"===r&&tsvb_validImages.includes(n)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(tsvb_settings.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:tsvb_ExtensionType.LoadParser,priority:tsvb_LoaderParserPriority.Normal},testParse:async(t,e)=>".json"===tsvb_path.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,r){const{texture:n,imageFilename:i,cachePrefix:s}=e?.data??{};let o,a=tsvb_path.dirname(e.src);if(a&&a.lastIndexOf("/")!==a.length-1&&(a+="/"),n&&n.baseTexture)o=n;else{const n=tsvb_copySearchParams(a+(i??t.meta.image),e.src);o=(await r.load([n]))[n]}const u=new src_tsvb_Spritesheet({texture:o.baseTexture,data:t,resolutionFilename:e.src,cachePrefix:s});await u.parse();const l=t?.meta?.related_multi_packs;if(Array.isArray(l)){const t=[];for(const n of l){if("string"!=typeof n)continue;let i=a+n;e.data?.ignoreMultiPack||(i=tsvb_copySearchParams(i,e.src),t.push(r.load({src:i,data:{ignoreMultiPack:!0}})))}const n=await Promise.all(t);u.linkedSheets=n,n.forEach((t=>{t.linkedSheets=[u].concat(u.linkedSheets.filter((e=>e!==t)))}))}return u},unload(t){t.destroy(!0)}}};tsvb_extensions.add(tsvb_spritesheetAsset);class tsvb_BitmapFontData{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class tsvb_TextFormat{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const t in e){const n=e[t].match(/^[a-z]+/gm)[0],i=e[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(const t in i){const e=i[t].split("="),r=e[0],n=e[1].replace(/"/gm,""),o=parseFloat(n),a=isNaN(o)?n:o;s[r]=a}r[n].push(s)}const n=new tsvb_BitmapFontData;return r.info.forEach((t=>n.info.push({face:t.face,size:parseInt(t.size,10)}))),r.common.forEach((t=>n.common.push({lineHeight:parseInt(t.lineHeight,10)}))),r.page.forEach((t=>n.page.push({id:parseInt(t.id,10),file:t.file}))),r.char.forEach((t=>n.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),r.kerning.forEach((t=>n.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),r.distanceField.forEach((t=>n.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),n}}class tsvb_XMLFormat{static test(t){const e=t;return"string"!=typeof t&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new tsvb_BitmapFontData,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),i=t.getElementsByTagName("page"),s=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let t=0;t<r.length;t++)e.info.push({face:r[t].getAttribute("face"),size:parseInt(r[t].getAttribute("size"),10)});for(let t=0;t<n.length;t++)e.common.push({lineHeight:parseInt(n[t].getAttribute("lineHeight"),10)});for(let t=0;t<i.length;t++)e.page.push({id:parseInt(i[t].getAttribute("id"),10)||0,file:i[t].getAttribute("file")});for(let t=0;t<s.length;t++){const r=s[t];e.char.push({id:parseInt(r.getAttribute("id"),10),page:parseInt(r.getAttribute("page"),10)||0,x:parseInt(r.getAttribute("x"),10),y:parseInt(r.getAttribute("y"),10),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10),xoffset:parseInt(r.getAttribute("xoffset"),10),yoffset:parseInt(r.getAttribute("yoffset"),10),xadvance:parseInt(r.getAttribute("xadvance"),10)})}for(let t=0;t<o.length;t++)e.kerning.push({first:parseInt(o[t].getAttribute("first"),10),second:parseInt(o[t].getAttribute("second"),10),amount:parseInt(o[t].getAttribute("amount"),10)});for(let t=0;t<a.length;t++)e.distanceField.push({fieldType:a[t].getAttribute("fieldType"),distanceRange:parseInt(a[t].getAttribute("distanceRange"),10)});return e}}class tsvb_XMLStringFormat{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&tsvb_XMLFormat.test(tsvb_settings.ADAPTER.parseXML(t))}static parse(t){return tsvb_XMLFormat.parse(tsvb_settings.ADAPTER.parseXML(t))}}const tsvb_formats=[tsvb_TextFormat,tsvb_XMLFormat,tsvb_XMLStringFormat];function tsvb_autoDetectFormat(t){for(let e=0;e<tsvb_formats.length;e++)if(tsvb_formats[e].test(t))return tsvb_formats[e];return null}function tsvb_generateFillStyle(t,e,r,n,i,s){const o=r.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const u=r.dropShadow?r.dropShadowDistance:0,l=r.padding||0,c=t.width/n-u-2*l,h=t.height/n-u-2*l,f=o.slice(),d=r.fillGradientStops.slice();if(!d.length){const t=f.length+1;for(let e=1;e<t;++e)d.push(e/t)}if(f.unshift(o[0]),d.unshift(0),f.push(o[o.length-1]),d.push(1),r.fillGradientType===tsvb_TEXT_GRADIENT.LINEAR_VERTICAL){a=e.createLinearGradient(c/2,l,c/2,h+l);let t=0;const n=(s.fontProperties.fontSize+r.strokeThickness)/h;for(let e=0;e<i.length;e++){const r=s.lineHeight*e;for(let e=0;e<f.length;e++){let i=0;i="number"==typeof d[e]?d[e]:e/f.length;const s=r/h+i*n;let o=Math.max(t,s);o=Math.min(o,1),a.addColorStop(o,f[e]),t=o}}}else{a=e.createLinearGradient(l,h/2,c+l,h/2);const t=f.length+1;let r=1;for(let e=0;e<f.length;e++){let n;n="number"==typeof d[e]?d[e]:r/t,a.addColorStop(n,f[e]),r++}}return a}function tsvb_drawGlyph(t,e,r,n,i,s,o){const a=r.text,u=r.fontProperties;e.translate(n,i),e.scale(s,s);const l=o.strokeThickness/2,c=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=tsvb_generateFillStyle(t,e,o,s,[a],r),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,r=o.dropShadowBlur*s,n=o.dropShadowDistance*s;e.shadowColor=src_tsvb_Color.shared.setValue(t).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=r,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*n,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*n}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,l,c+r.lineHeight-u.descent),o.fill&&e.fillText(a,l,c+r.lineHeight-u.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function tsvb_splitTextToCharacters(t){return Array.from?Array.from(t):t.split("")}function tsvb_resolveCharacters(t){"string"==typeof t&&(t=[t]);const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];if(Array.isArray(n)){if(2!==n.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const t=n[0].charCodeAt(0),r=n[1].charCodeAt(0);if(r<t)throw new Error("[BitmapFont]: Invalid character range.");for(let n=t,i=r;n<=i;n++)e.push(String.fromCharCode(n))}else e.push(...tsvb_splitTextToCharacters(n))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}function tsvb_extractCharCode(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}const tsvb_BitmapFont=class t{constructor(t,e,r){const[n]=t.info,[i]=t.common,[s]=t.page,[o]=t.distanceField,a=tsvb_getResolutionOfUrl(s.file),u={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=i.lineHeight/a,this.chars={},this.pageTextures=u;for(let r=0;r<t.page.length;r++){const{id:n,file:i}=t.page[r];u[n]=e instanceof Array?e[r]:e[i],o?.fieldType&&"none"!==o.fieldType&&(u[n].baseTexture.alphaMode=tsvb_ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,u[n].baseTexture.mipmap=tsvb_MIPMAP_MODES.OFF)}for(let e=0;e<t.char.length;e++){const{id:r,page:n}=t.char[e];let{x:i,y:s,width:o,height:l,xoffset:c,yoffset:h,xadvance:f}=t.char[e];i/=a,s/=a,o/=a,l/=a,c/=a,h/=a,f/=a;const d=new tsvb_Rectangle(i+u[n].frame.x/a,s+u[n].frame.y/a,o,l);this.chars[r]={xOffset:c,yOffset:h,xAdvance:f,kerning:{},texture:new tsvb_Texture_Texture(u[n].baseTexture,d),page:n}}for(let e=0;e<t.kerning.length;e++){let{first:r,second:n,amount:i}=t.kerning[e];r/=a,n/=a,i/=a,this.chars[n]&&(this.chars[n].kerning[r]=i)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(e,r,n){let i;if(e instanceof tsvb_BitmapFontData)i=e;else{const t=tsvb_autoDetectFormat(e);if(!t)throw new Error("Unrecognized data format for font.");i=t.parse(e)}r instanceof tsvb_Texture_Texture&&(r=[r]);const s=new t(i,r,n);return t.available[s.font]=s,s}static uninstall(e){const r=t.available[e];if(!r)throw new Error(`No font found named '${e}'`);r.destroy(),delete t.available[e]}static from(e,r,n){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:s,resolution:o,textureWidth:a,textureHeight:u,...l}=Object.assign({},t.defaultOptions,n),c=tsvb_resolveCharacters(i),h=r instanceof src_tsvb_TextStyle?r:new src_tsvb_TextStyle(r),f=a,d=new tsvb_BitmapFontData;d.info[0]={face:h.fontFamily,size:h.fontSize},d.common[0]={lineHeight:h.fontSize};let p,v,y,b=0,_=0,m=0;const g=[],w=[];for(let t=0;t<c.length;t++){p||(p=tsvb_settings.ADAPTER.createCanvas(),p.width=a,p.height=u,v=p.getContext("2d"),y=new src_tsvb_BaseTexture(p,{resolution:o,...l}),g.push(y),w.push(new tsvb_Texture_Texture(y)),d.page.push({id:w.length-1,file:""}));const e=c[t],r=src_tsvb_TextMetrics.measureText(e,h,!1,p),n=r.width,i=Math.ceil(r.height),x=Math.ceil(("italic"===h.fontStyle?2:1)*n);if(_>=u-i*o){if(0===_)throw new Error(`[BitmapFont] textureHeight ${u}px is too small (fontFamily: '${h.fontFamily}', fontSize: ${h.fontSize}px, char: '${e}')`);--t,p=null,v=null,y=null,_=0,b=0,m=0;continue}if(m=Math.max(i+r.fontProperties.descent,m),x*o+b>=f){if(0===b)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${h.fontFamily}', fontSize: ${h.fontSize}px, char: '${e}')`);--t,_+=m*o,_=Math.ceil(_),b=0,m=0;continue}tsvb_drawGlyph(p,v,r,b,_,o,h);const T=tsvb_extractCharCode(r.text);d.char.push({id:T,page:w.length-1,x:b/o,y:_/o,width:x,height:i,xoffset:0,yoffset:0,xadvance:n-(h.dropShadow?h.dropShadowDistance:0)-(h.stroke?h.strokeThickness:0)}),b+=(x+2*s)*o,b=Math.ceil(b)}if(!n?.skipKerning)for(let t=0,e=c.length;t<e;t++){const r=c[t];for(let t=0;t<e;t++){const e=c[t],n=v.measureText(r).width,i=v.measureText(e).width,s=v.measureText(r+e).width-(n+i);s&&d.kerning.push({first:tsvb_extractCharCode(r),second:tsvb_extractCharCode(e),amount:s})}}const x=new t(d,w,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=x,x}};tsvb_BitmapFont.ALPHA=[["a","z"],["A","Z"]," "],tsvb_BitmapFont.NUMERIC=[["0","9"]],tsvb_BitmapFont.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],tsvb_BitmapFont.ASCII=[[" ","~"]],tsvb_BitmapFont.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:tsvb_BitmapFont.ALPHANUMERIC},tsvb_BitmapFont.available={};let src_tsvb_BitmapFont=tsvb_BitmapFont;var tsvb_msdfFrag="// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n",tsvb_msdfVert="// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n";const tsvb_pageMeshDataDefaultPageMeshData=[],tsvb_pageMeshDataMSDFPageMeshData=[],tsvb_charRenderDataPool=[],tsvb_BitmapText=class t extends src_tsvb_Container{constructor(e,r={}){super();const{align:n,tint:i,maxWidth:s,letterSpacing:o,fontName:a,fontSize:u}=Object.assign({},t.styleDefaults,r);if(!src_tsvb_BitmapFont.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=n,this._tintColor=new src_tsvb_Color(i),this._font=void 0,this._fontName=a,this._fontSize=u,this.text=e,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new tsvb_ObservablePoint((()=>{this.dirty=!0}),this,0,0),this._roundPixels=tsvb_settings.ROUND_PIXELS,this.dirty=!0,this._resolution=tsvb_settings.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=src_tsvb_BitmapFont.available[this._fontName],e=this.fontSize,r=e/t.size,n=new tsvb_Point,i=[],s=[],o=[],a=tsvb_splitTextToCharacters(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),u=this._maxWidth*t.size/e,l="none"===t.distanceFieldType?tsvb_pageMeshDataDefaultPageMeshData:tsvb_pageMeshDataMSDFPageMeshData;let c=null,h=0,f=0,d=0,p=-1,v=0,y=0,b=0,_=0;for(let e=0;e<a.length;e++){const r=a[e],l=tsvb_extractCharCode(r);if(/(?:\s)/.test(r)&&(p=e,v=h,_++),"\r"===r||"\n"===r){s.push(h),o.push(-1),f=Math.max(f,h),++d,++y,n.x=0,n.y+=t.lineHeight,c=null,_=0;continue}const m=t.chars[l];if(!m)continue;c&&m.kerning[c]&&(n.x+=m.kerning[c]);const g=tsvb_charRenderDataPool.pop()||{texture:tsvb_Texture_Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new tsvb_Point};g.texture=m.texture,g.line=d,g.charCode=l,g.position.x=Math.round(n.x+m.xOffset+this._letterSpacing/2),g.position.y=Math.round(n.y+m.yOffset),g.prevSpaces=_,i.push(g),h=g.position.x+Math.max(m.xAdvance-m.xOffset,m.texture.orig.width),n.x+=m.xAdvance+this._letterSpacing,b=Math.max(b,m.yOffset+m.texture.height),c=l,-1!==p&&u>0&&n.x>u&&(++y,tsvb_removeItems(i,1+p-y,1+e-p),e=p,p=-1,s.push(v),o.push(i.length>0?i[i.length-1].prevSpaces:0),f=Math.max(f,v),d++,n.x=0,n.y+=t.lineHeight,c=null,_=0)}const m=a[a.length-1];"\r"!==m&&"\n"!==m&&(/(?:\s)/.test(m)&&(h=v),s.push(h),f=Math.max(f,h),o.push(-1));const g=[];for(let t=0;t<=d;t++){let e=0;"right"===this._align?e=f-s[t]:"center"===this._align?e=(f-s[t])/2:"justify"===this._align&&(e=o[t]<0?0:(f-s[t])/o[t]),g.push(e)}const w=i.length,x={},T=[],S=this._activePagesMeshData;l.push(...S);for(let e=0;e<w;e++){const r=i[e].texture,n=r.baseTexture.uid;if(!x[n]){let e=l.pop();if(!e){const r=new tsvb_MeshGeometry;let n,i;"none"===t.distanceFieldType?(n=new tsvb_MeshMaterial(tsvb_Texture_Texture.EMPTY),i=tsvb_BLEND_MODES.NORMAL):(n=new tsvb_MeshMaterial(tsvb_Texture_Texture.EMPTY,{program:src_tsvb_Program.from(tsvb_msdfVert,tsvb_msdfFrag),uniforms:{uFWidth:0}}),i=tsvb_BLEND_MODES.NORMAL_NPM);const s=new src_tsvb_Mesh(r,n);s.blendMode=i,e={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:s,vertices:null,uvs:null,indices:null}}e.index=0,e.indexCount=0,e.vertexCount=0,e.uvsCount=0,e.total=0;const{_textureCache:i}=this;i[n]=i[n]||new tsvb_Texture_Texture(r.baseTexture),e.mesh.texture=i[n],e.mesh.tint=this._tintColor.value,T.push(e),x[n]=e}x[n].total++}for(let t=0;t<S.length;t++)T.includes(S[t])||this.removeChild(S[t].mesh);for(let t=0;t<T.length;t++)T[t].mesh.parent!==this&&this.addChild(T[t].mesh);this._activePagesMeshData=T;for(const t in x){const e=x[t],r=e.total;if(!(e.indices?.length>6*r)||e.vertices.length<2*src_tsvb_Mesh.BATCHABLE_SIZE)e.vertices=new Float32Array(8*r),e.uvs=new Float32Array(8*r),e.indices=new Uint16Array(6*r);else{const t=e.total,r=e.vertices;for(let e=4*t*2;e<r.length;e++)r[e]=0}e.mesh.size=6*r}for(let t=0;t<w;t++){const e=i[t];let n=e.position.x+g[e.line]*("justify"===this._align?e.prevSpaces:1);this._roundPixels&&(n=Math.round(n));const s=n*r,o=e.position.y*r,a=e.texture,u=x[a.baseTexture.uid],l=a.frame,c=a._uvs,h=u.index++;u.indices[6*h+0]=0+4*h,u.indices[6*h+1]=1+4*h,u.indices[6*h+2]=2+4*h,u.indices[6*h+3]=0+4*h,u.indices[6*h+4]=2+4*h,u.indices[6*h+5]=3+4*h,u.vertices[8*h+0]=s,u.vertices[8*h+1]=o,u.vertices[8*h+2]=s+l.width*r,u.vertices[8*h+3]=o,u.vertices[8*h+4]=s+l.width*r,u.vertices[8*h+5]=o+l.height*r,u.vertices[8*h+6]=s,u.vertices[8*h+7]=o+l.height*r,u.uvs[8*h+0]=c.x0,u.uvs[8*h+1]=c.y0,u.uvs[8*h+2]=c.x1,u.uvs[8*h+3]=c.y1,u.uvs[8*h+4]=c.x2,u.uvs[8*h+5]=c.y2,u.uvs[8*h+6]=c.x3,u.uvs[8*h+7]=c.y3}this._textWidth=f*r,this._textHeight=(n.y+t.lineHeight)*r;for(const t in x){const e=x[t];if(0!==this.anchor.x||0!==this.anchor.y){let t=0;const r=this._textWidth*this.anchor.x,n=this._textHeight*this.anchor.y;for(let i=0;i<e.total;i++)e.vertices[t++]-=r,e.vertices[t++]-=n,e.vertices[t++]-=r,e.vertices[t++]-=n,e.vertices[t++]-=r,e.vertices[t++]-=n,e.vertices[t++]-=r,e.vertices[t++]-=n}this._maxLineHeight=b*r;const n=e.mesh.geometry.getBuffer("aVertexPosition"),i=e.mesh.geometry.getBuffer("aTextureCoord"),s=e.mesh.geometry.getIndex();n.data=e.vertices,i.data=e.uvs,s.data=e.indices,n.update(),i.update(),s.update()}for(let t=0;t<i.length;t++)tsvb_charRenderDataPool.push(i[t]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:r,size:n}=src_tsvb_BitmapFont.available[this._fontName];if("none"!==r){const{a:r,b:i,c:s,d:o}=this.worldTransform,a=Math.sqrt(r*r+i*i),u=Math.sqrt(s*s+o*o),l=(Math.abs(a)+Math.abs(u))/2,c=this.fontSize/n,h=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*c*h}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=src_tsvb_BitmapFont.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!src_tsvb_BitmapFont.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??src_tsvb_BitmapFont.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r="none"===src_tsvb_BitmapFont.available[this._fontName].distanceFieldType?tsvb_pageMeshDataDefaultPageMeshData:tsvb_pageMeshDataMSDFPageMeshData;r.push(...this._activePagesMeshData);for(const t of this._activePagesMeshData)this.removeChild(t.mesh);this._activePagesMeshData=[],r.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=tsvb_Texture_Texture.EMPTY}));for(const t in e)e[t].destroy(),delete e[t];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};tsvb_BitmapText.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};let src_tsvb_BitmapText=tsvb_BitmapText;const tsvb_validExtensions=[".xml",".fnt"],tsvb_loadBitmapFont={extension:{type:tsvb_ExtensionType.LoadParser,priority:tsvb_LoaderParserPriority.Normal},name:"loadBitmapFont",test:t=>tsvb_validExtensions.includes(tsvb_path.extname(t).toLowerCase()),testParse:async t=>tsvb_TextFormat.test(t)||tsvb_XMLStringFormat.test(t),async parse(t,e,r){const n=tsvb_TextFormat.test(t)?tsvb_TextFormat.parse(t):tsvb_XMLStringFormat.parse(t),{src:i}=e,{page:s}=n,o=[];for(let t=0;t<s.length;++t){const e=s[t].file;let r=tsvb_path.join(tsvb_path.dirname(i),e);r=tsvb_copySearchParams(r,i),o.push(r)}const a=await r.load(o),u=o.map((t=>a[t]));return src_tsvb_BitmapFont.install(n,u,!0)},load:async(t,e)=>(await tsvb_settings.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};tsvb_extensions.add(tsvb_loadBitmapFont);const tsvb_HTMLTextStyle=class t extends src_tsvb_TextStyle{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new t(Object.keys(t.defaultOptions).reduce(((t,r)=>({...t,[r]:e[r]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((e=>{URL.revokeObjectURL(e.src),e.refs--,0===e.refs&&(e.fontFace&&document.fonts.delete(e.fontFace),delete t.availableFonts[e.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,r={}){const{availableFonts:n}=t;if(n[e]){const t=n[e];return this._fonts.push(t),t.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return tsvb_settings.ADAPTER.fetch(e).then((t=>t.blob())).then((async t=>new Promise(((e,r)=>{const n=URL.createObjectURL(t),i=new FileReader;i.onload=()=>e([n,i.result]),i.onerror=r,i.readAsDataURL(t)})))).then((async([t,i])=>{const s=Object.assign({family:tsvb_path.basename(e,tsvb_path.extname(e)),weight:"normal",style:"normal",display:"auto",src:t,dataSrc:i,refs:1,originalUrl:e,fontFace:null},r);n[e]=s,this._fonts.push(s),this.styleID++;const o=new FontFace(s.family,`url(${s.src})`,{weight:s.weight,style:s.style,display:s.display});s.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style};\n                font-display: ${e.display};\n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=tsvb_rgb2hex(t)),"number"==typeof t?tsvb_hex2string(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const i=`${r}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${i} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${i} ${t}`}reset(){Object.assign(this,t.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=tsvb_settings.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};tsvb_HTMLTextStyle.availableFonts={},tsvb_HTMLTextStyle.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let src_tsvb_HTMLTextStyle=tsvb_HTMLTextStyle;const tsvb_HTMLText=class t extends tsvb_Sprite{constructor(e="",r={}){super(tsvb_Texture_Texture.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const n=new Image,i=tsvb_Texture_Texture.from(n,{scaleMode:tsvb_settings.SCALE_MODE,resourceOptions:{autoLoad:!1}});i.orig=new tsvb_Rectangle,i.trim=new tsvb_Rectangle,this.texture=i;const s="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(s,"svg"),u=document.createElementNS(s,"foreignObject"),l=document.createElementNS(o,"div"),c=document.createElementNS(o,"style");u.setAttribute("width","10000"),u.setAttribute("height","10000"),u.style.overflow="hidden",a.appendChild(u),this.maxWidth=t.defaultMaxWidth,this.maxHeight=t.defaultMaxHeight,this._domElement=l,this._styleElement=c,this._svgRoot=a,this._foreignObject=u,this._foreignObject.appendChild(c),this._foreignObject.appendChild(l),this._image=n,this._loadImage=new Image,this._autoResolution=t.defaultAutoResolution,this._resolution=t.defaultResolution??tsvb_settings.RESOLUTION,this.text=e,this.style=r}measureText(t){const{text:e,style:r,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:r.toCSS(n)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const i=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:s,height:o}=i;(s>this.maxWidth||o>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const a=Math.min(this.maxWidth,Math.ceil(s)),u=Math.min(this.maxHeight,Math.ceil(o));return this._svgRoot.setAttribute("width",a.toString()),this._svgRoot.setAttribute("height",u.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(n)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:a+2*r.padding,height:u+2*r.padding}}async updateText(t=!0){const{style:e,_image:r,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:i,height:s}=this.measureText();r.width=n.width=Math.ceil(Math.max(1,i)),r.height=n.height=Math.ceil(Math.max(1,s)),this._updateID++;const o=this._updateID;await new Promise((t=>{n.onload=async()=>{o<this._updateID||(await e.onBeforeDraw(),r.src=n.src,n.onload=null,n.src="",this.updateTexture()),t()};const i=(new XMLSerializer).serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(i)}`}))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:r,resolution:n}=this,{padding:i}=t,{baseTexture:s}=e;e.trim.width=e._frame.width=r.width/n,e.trim.height=e._frame.height=r.height/n,e.trim.x=-i,e.trim.y=-i,e.orig.width=e._frame.width-2*i,e.orig.height=e._frame.height-2*i,this._onTextureUpdate(),s.setRealSize(r.width,r.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},t.defaultDestroyOptions,e),super.destroy(e);const r=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=r,this._svgRoot?.remove(),this._svgRoot=r,this._domElement?.remove(),this._domElement=r,this._foreignObject?.remove(),this._foreignObject=r,this._styleElement?.remove(),this._styleElement=r,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=r,this._image.src="",this._image=r}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=tsvb_sign(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=tsvb_sign(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof src_tsvb_HTMLTextStyle?(this.ownsStyle=!1,this._style=t):t instanceof src_tsvb_TextStyle?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=src_tsvb_HTMLTextStyle.from(t)):(this.ownsStyle=!0,this._style=new src_tsvb_HTMLTextStyle(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};tsvb_HTMLText.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},tsvb_HTMLText.defaultMaxWidth=2024,tsvb_HTMLText.defaultMaxHeight=2024,tsvb_HTMLText.defaultAutoResolution=!0;let src_tsvb_HTMLText=tsvb_HTMLText;var tsvb_bundle=__webpack_require__(8389),tsvb_isCallNotification=function(t){return void 0!==t.method&&"call"===t.method},tsvb_isClearResponse=function(t){return"number"==typeof t.id&&"boolean"==typeof t.result};function tsvb_worker_timers_broker_typeof(t){return tsvb_worker_timers_broker_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_worker_timers_broker_typeof(t)}var tsvb_load=function(t){var e=new Map([[0,function(){}]]),r=new Map([[0,function(){}]]),n=new Map,i=new Worker(t);i.addEventListener("message",(function(t){var i=t.data;if(tsvb_isCallNotification(i)){var s=i.params,o=s.timerId,a=s.timerType;if("interval"===a){var u=e.get(o);if(void 0===tsvb_worker_timers_broker_typeof(u)&&tsvb_errorBus.bv.notify({message:"The timer is in an undefined state.",emitter:tsvb_errorBus.JK.WORKER_TIMERS}),"number"==typeof u){var l=n.get(u);void 0!==l&&l.timerId===o&&l.timerType===a||tsvb_errorBus.bv.notify({message:"The timer is in an undefined state.",emitter:tsvb_errorBus.JK.WORKER_TIMERS})}else"function"==typeof u&&u()}else if("timeout"===a){var c=r.get(o);if(void 0===tsvb_worker_timers_broker_typeof(c)&&tsvb_errorBus.bv.notify({message:"The timer is in an undefined state.",emitter:tsvb_errorBus.JK.WORKER_TIMERS}),"number"==typeof c){var h=n.get(c);void 0!==h&&h.timerId===o&&h.timerType===a||tsvb_errorBus.bv.notify({message:"The timer is in an undefined state.",emitter:tsvb_errorBus.JK.WORKER_TIMERS})}else"function"==typeof c&&(c(),r.delete(o))}}else if(tsvb_isClearResponse(i)){var f=i.id,d=n.get(f);void 0===d&&tsvb_errorBus.bv.notify({message:"The timer is in an undefined state.",emitter:tsvb_errorBus.JK.WORKER_TIMERS});var p=d.timerId,v=d.timerType;n.delete(f),"interval"===v?e.delete(p):r.delete(p)}else{var y=i.error.message;tsvb_errorBus.bv.notify({message:y,emitter:tsvb_errorBus.JK.WORKER_TIMERS})}}));return{clearInterval:function(t){if("function"==typeof e.get(t)){var r=(0,tsvb_bundle.generateUniqueNumber)(n);n.set(r,{timerId:t,timerType:"interval"}),e.set(t,r),i.postMessage({id:r,method:"clear",params:{timerId:t,timerType:"interval"}})}},clearTimeout:function(t){if("function"==typeof r.get(t)){var e=(0,tsvb_bundle.generateUniqueNumber)(n);n.set(e,{timerId:t,timerType:"timeout"}),r.set(t,e),i.postMessage({id:e,method:"clear",params:{timerId:t,timerType:"timeout"}})}},setInterval:function(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o];var a=(0,tsvb_bundle.generateUniqueNumber)(e);return e.set(a,(function(){t.apply(void 0,s),"function"==typeof e.get(a)&&i.postMessage({id:null,method:"set",params:{delay:r,now:performance.timeOrigin+performance.now(),timerId:a,timerType:"interval"}})})),i.postMessage({id:null,method:"set",params:{delay:r,now:performance.timeOrigin+performance.now(),timerId:a,timerType:"interval"}}),a},setTimeout:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o];var a=(0,tsvb_bundle.generateUniqueNumber)(r);return r.set(a,(function(){return t.apply(void 0,s)})),i.postMessage({id:null,method:"set",params:{delay:e,now:performance.timeOrigin+performance.now(),timerId:a,timerType:"timeout"}}),a}}},tsvb_createLoadOrReturnBroker=function(t,e){var r=null;return function(){if(null!==r)return r;var n=new Blob([e],{type:"application/javascript; charset=utf-8"}),i=URL.createObjectURL(n);return r=t(i),setTimeout((function(){return URL.revokeObjectURL(i)})),r}},tsvb_worker='(()=>{"use strict";const e=new Map,t=new Map,r=t=>{const r=e.get(t);return void 0!==r&&(clearTimeout(r),e.delete(t),!0)},s=e=>{const r=t.get(e);return void 0!==r&&(clearTimeout(r),t.delete(e),!0)},o=(e,t)=>{const r=performance.now(),s=e+t-r-performance.timeOrigin;return{expected:r+s,remainingDelay:s}},i=(e,t,r,s)=>{const o=r-performance.now();o>0?e.set(t,setTimeout(i,o,e,t,r,s)):(e.delete(t),postMessage({id:null,method:"call",params:{timerId:t,timerType:s}}))};addEventListener("message",(({data:n})=>{try{if("clear"===n.method){const{id:e,params:{timerId:t,timerType:o}}=n;if("interval"===o)postMessage({id:e,result:r(t)});else{if("timeout"!==o)throw new Error(\'The given type "\'.concat(o,\'" is not supported\'));postMessage({id:e,result:s(t)})}}else{if("set"!==n.method)throw new Error(\'The given method "\'.concat(n.method,\'" is not supported\'));{const{params:{delay:r,now:s,timerId:a,timerType:m}}=n;if("interval"===m)((t,r,s)=>{const{expected:n,remainingDelay:a}=o(t,s);e.set(r,setTimeout(i,a,e,r,n,"interval"))})(r,a,s);else{if("timeout"!==m)throw new Error(\'The given type "\'.concat(m,\'" is not supported\'));((e,r,s)=>{const{expected:n,remainingDelay:a}=o(e,s);t.set(r,setTimeout(i,a,t,r,n,"timeout"))})(r,a,s)}}}}catch(e){postMessage({error:{message:e.message},id:n.id,result:null})}}))})();',tsvb_loadOrReturnBroker=tsvb_createLoadOrReturnBroker(tsvb_load,tsvb_worker),tsvb_worker_timers_clearInterval=function(t){return tsvb_loadOrReturnBroker().clearInterval(t)},tsvb_worker_timers_clearTimeout=function(t){return tsvb_loadOrReturnBroker().clearTimeout(t)},tsvb_worker_timers_setInterval=function(){var t;return(t=tsvb_loadOrReturnBroker()).setInterval.apply(t,arguments)},tsvb_worker_timers_setTimeout=function(){var t;return(t=tsvb_loadOrReturnBroker()).setTimeout.apply(t,arguments)};function tsvb_Texture_typeof(t){return tsvb_Texture_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_Texture_typeof(t)}function tsvb_Texture_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_Texture_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_Texture_toPropertyKey(n.key),n)}}function tsvb_Texture_createClass(t,e,r){return e&&tsvb_Texture_defineProperties(t.prototype,e),r&&tsvb_Texture_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_Texture_toPropertyKey(t){var e=tsvb_Texture_toPrimitive(t,"string");return"symbol"==tsvb_Texture_typeof(e)?e:e+""}function tsvb_Texture_toPrimitive(t,e){if("object"!=tsvb_Texture_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_Texture_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_Texture_callSuper(t,e,r){return e=tsvb_Texture_getPrototypeOf(e),tsvb_Texture_possibleConstructorReturn(t,tsvb_Texture_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_Texture_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_Texture_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_Texture_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_Texture_assertThisInitialized(t)}function tsvb_Texture_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_Texture_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_Texture_isNativeReflectConstruct=function(){return!!t})()}function tsvb_Texture_getPrototypeOf(t){return tsvb_Texture_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_Texture_getPrototypeOf(t)}function tsvb_Texture_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_Texture_setPrototypeOf(t,e)}function tsvb_Texture_setPrototypeOf(t,e){return tsvb_Texture_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_Texture_setPrototypeOf(t,e)}var tsvb_Texture=function(t){function e(t){var r;return tsvb_Texture_classCallCheck(this,e),(r=tsvb_Texture_callSuper(this,e)).shouldBeDestroed=!0,t?(r.texture=t instanceof tsvb_Texture_Texture?t:tsvb_Texture_Texture.from(t),r):(r.texture=new tsvb_Texture_Texture(new src_tsvb_BaseTexture),tsvb_Texture_possibleConstructorReturn(r))}return tsvb_Texture_inherits(e,tsvb_eventemitter3),tsvb_Texture_createClass(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return this.texture.update(),void this.emit("update",this);this.texture&&this.shouldBeDestroed&&this.texture.destroy(!0),this.texture=t instanceof tsvb_Texture_Texture?t:tsvb_Texture_Texture.from(t),this.shouldBeDestroed=e,this.emit("replace",this)}},{key:"destroy",value:function(){this.texture&&this.texture.destroy(!0),this.removeAllListeners()}}])}();function tsvb_Frame_typeof(t){return tsvb_Frame_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_Frame_typeof(t)}function tsvb_Frame_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_Frame_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_Frame_toPropertyKey(n.key),n)}}function tsvb_Frame_createClass(t,e,r){return e&&tsvb_Frame_defineProperties(t.prototype,e),r&&tsvb_Frame_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_Frame_toPropertyKey(t){var e=tsvb_Frame_toPrimitive(t,"string");return"symbol"==tsvb_Frame_typeof(e)?e:e+""}function tsvb_Frame_toPrimitive(t,e){if("object"!=tsvb_Frame_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_Frame_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_Frame_callSuper(t,e,r){return e=tsvb_Frame_getPrototypeOf(e),tsvb_Frame_possibleConstructorReturn(t,tsvb_Frame_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_Frame_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_Frame_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_Frame_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_Frame_assertThisInitialized(t)}function tsvb_Frame_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_Frame_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_Frame_isNativeReflectConstruct=function(){return!!t})()}function tsvb_Frame_getPrototypeOf(t){return tsvb_Frame_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_Frame_getPrototypeOf(t)}function tsvb_Frame_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_Frame_setPrototypeOf(t,e)}function tsvb_Frame_setPrototypeOf(t,e){return tsvb_Frame_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_Frame_setPrototypeOf(t,e)}var tsvb_Frame=function(t){function e(t,r){var n;return tsvb_Frame_classCallCheck(this,e),(n=tsvb_Frame_callSuper(this,e)).active="origin",n.textures=new Map,n.buffers=new Map,t instanceof tsvb_Texture?(n.frame=new tsvb_Sprite(t.get()),n.textures.set("origin",t.get()),t.on("replace",n.onReplace,n)):(n.frame=new tsvb_Sprite(t),n.textures.set("origin",t)),n.frame.width=r.width,n.frame.height=r.height,n}return tsvb_Frame_inherits(e,tsvb_eventemitter3),tsvb_Frame_createClass(e,[{key:"onReplace",value:function(t){this.textures.set("origin",t.get()),"origin"==this.active&&(this.frame.texture=t.get())}},{key:"addTexture",value:function(t,e){var r,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.textures.has(t)&&(n&&(null===(r=this.textures.get(t))||void 0===r||r.destroy(!0)),this.textures.delete(t)),this.textures.set(t,e),!0}},{key:"getTexture",value:function(t){if(this.textures.has(t))return this.textures.get(t);throw new Error("There is no such texture")}},{key:"addBuffer",value:function(t){var e,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.buffers.has(t)&&(r&&(null===(e=this.buffers.get(t))||void 0===e||e.destroy(!0)),this.buffers.delete(t)),this.buffers.set(t,tsvb_RenderTexture.create({width:this.frame.width,height:this.frame.height})),!0}},{key:"getBuffer",value:function(t){if(this.buffers.has(t))return this.buffers.get(t);throw new Error("There is no such buffer")}},{key:"resize",value:function(t,e){this.frame.width=t,this.frame.height=e,this.buffers.forEach((function(r,n){r.resize(t,e)}))}},{key:"activateBuffer",value:function(t){this.buffers.has(t)&&(this.frame.texture=this.buffers.get(t),this.active=t)}},{key:"activateTexture",value:function(t){this.textures.has(t)&&(this.frame.texture=this.textures.get(t),this.active=t)}}])}();function tsvb_deferred_typeof(t){return tsvb_deferred_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_deferred_typeof(t)}function tsvb_deferred_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_deferred_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_deferred_toPropertyKey(n.key),n)}}function tsvb_deferred_createClass(t,e,r){return e&&tsvb_deferred_defineProperties(t.prototype,e),r&&tsvb_deferred_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_deferred_toPropertyKey(t){var e=tsvb_deferred_toPrimitive(t,"string");return"symbol"==tsvb_deferred_typeof(e)?e:e+""}function tsvb_deferred_toPrimitive(t,e){if("object"!=tsvb_deferred_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_deferred_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}tsvb_Frame.defaultOptions={width:100,height:100};var tsvb_Deferred=function(){return tsvb_deferred_createClass((function t(){var e=this;tsvb_deferred_classCallCheck(this,t),this.state="pending",this.fate="unresolved",this.promise=new Promise((function(t,r){e._resolve=t,e._reject=r})),this.promise.then((function(){return e.state="fulfilled"}),(function(){return e.state="rejected"}))}),[{key:"resolve",value:function(t){if("resolved"===this.fate)throw"Deferred cannot be resolved twice";this.fate="resolved",this._resolve(t)}},{key:"reject",value:function(t){if("resolved"===this.fate)throw"Deferred cannot be resolved twice";this.fate="resolved",this._reject(t)}},{key:"isResolved",value:function(){return"resolved"===this.fate}},{key:"isPending",value:function(){return"pending"===this.state}},{key:"isFulfilled",value:function(){return"fulfilled"===this.state}},{key:"isRejected",value:function(){return"rejected"===this.state}}])}();function tsvb_frame_callback_typeof(t){return tsvb_frame_callback_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_frame_callback_typeof(t)}function tsvb_frame_callback_regeneratorRuntime(){tsvb_frame_callback_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_frame_callback_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_frame_callback_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_frame_callback_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_frame_callback_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_frame_callback_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_frame_callback_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_frame_callback_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_frame_callback_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_frame_callback_toPropertyKey(n.key),n)}}function tsvb_frame_callback_createClass(t,e,r){return e&&tsvb_frame_callback_defineProperties(t.prototype,e),r&&tsvb_frame_callback_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_frame_callback_toPropertyKey(t){var e=tsvb_frame_callback_toPrimitive(t,"string");return"symbol"==tsvb_frame_callback_typeof(e)?e:e+""}function tsvb_frame_callback_toPrimitive(t,e){if("object"!=tsvb_frame_callback_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_frame_callback_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_frame_callback_callSuper(t,e,r){return e=tsvb_frame_callback_getPrototypeOf(e),tsvb_frame_callback_possibleConstructorReturn(t,tsvb_frame_callback_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_frame_callback_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_frame_callback_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_frame_callback_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_frame_callback_assertThisInitialized(t)}function tsvb_frame_callback_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_frame_callback_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_frame_callback_isNativeReflectConstruct=function(){return!!t})()}function tsvb_superPropGet(t,e,r,n){var i=tsvb_get(tsvb_frame_callback_getPrototypeOf(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof i?function(t){return i.apply(r,t)}:i}function tsvb_get(){return tsvb_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=tsvb_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tsvb_get.apply(null,arguments)}function tsvb_superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tsvb_frame_callback_getPrototypeOf(t)););return t}function tsvb_frame_callback_getPrototypeOf(t){return tsvb_frame_callback_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_frame_callback_getPrototypeOf(t)}function tsvb_frame_callback_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_frame_callback_setPrototypeOf(t,e)}function tsvb_frame_callback_setPrototypeOf(t,e){return tsvb_frame_callback_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_frame_callback_setPrototypeOf(t,e)}var tsvb_FrameCallbackStreamProcessor=function(t){function e(t){var r;return tsvb_frame_callback_classCallCheck(this,e),(r=tsvb_frame_callback_callSuper(this,e,[t])).inprocess=!1,r.duration=30,r.textures=[],r.inputVideo=document.createElement("video"),r.duration=1e3/r.fpsLimit,r}return tsvb_frame_callback_inherits(e,tsvb_StreamProcessor),tsvb_frame_callback_createClass(e,[{key:"onTrackUpdate",value:function(){tsvb_superPropGet(e,"onTrackUpdate",this,3)([]),this.videoFrame&&this.videoFrame.resize(this.sdkOptions.width,this.sdkOptions.height)}},{key:"setFpsLimit",value:function(t){var e=this;this.fpsLimit=t,this.duration=1e3/this.fpsLimit;try{this.gatherFramesInterval&&(tsvb_worker_timers_clearInterval(this.gatherFramesInterval),this.gatherFramesInterval=0,this.gatherFramesInterval=tsvb_worker_timers_setInterval((function(){e.gatherByTimers()}),this.duration))}catch(t){}}},{key:"setRenderer",value:function(t){this.renderer=t}},{key:"destroy",value:function(){this.stopTimers()}},{key:"clearBuffers",value:function(){this.effectProcessor.clearBuffers()}},{key:"stopTimers",value:function(){try{this.gatherFramesTimeout&&(tsvb_worker_timers_clearTimeout(this.gatherFramesTimeout),this.gatherFramesTimeout=0),this.handleFramesTimeout&&(tsvb_worker_timers_clearTimeout(this.handleFramesTimeout),this.handleFramesTimeout=0),this.gatherFramesInterval&&(tsvb_worker_timers_clearInterval(this.gatherFramesInterval),this.gatherFramesInterval=0)}catch(t){}}},{key:"startTimers",value:function(){var t=this;try{this.gatherFramesInterval=tsvb_worker_timers_setInterval((function(){t.gatherByTimers()}),this.duration)}catch(t){}this.gatherByCallback(),this.handleFrames()}},{key:"gatherByCallback",value:(o=tsvb_frame_callback_asyncToGenerator(tsvb_frame_callback_regeneratorRuntime().mark((function t(){return tsvb_frame_callback_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(){return o.apply(this,arguments)})},{key:"gatherByTimers",value:(s=tsvb_frame_callback_asyncToGenerator(tsvb_frame_callback_regeneratorRuntime().mark((function t(){return tsvb_frame_callback_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:document.hidden&&this.gatherFrames();case 1:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"gatherFrames",value:(i=tsvb_frame_callback_asyncToGenerator(tsvb_frame_callback_regeneratorRuntime().mark((function t(){var e,r;return tsvb_frame_callback_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.textures.length>3&&(null==(e=this.textures.shift())||e.destroy(!0)),this.videoTexture&&(this.videoTexture.update(),r=tsvb_RenderTexture.create({width:this.sdkOptions.width,height:this.sdkOptions.height}),this.renderer.renderTo(this.videoFrame.frame,r),this.textures.push(r));case 2:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"nextTick",value:(n=tsvb_frame_callback_asyncToGenerator(tsvb_frame_callback_regeneratorRuntime().mark((function t(){var e,r;return tsvb_frame_callback_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null===(e=this.frameDrawFunction)||void 0===e||e.call(this),this.frame_count++,this.videoTrackWrapper.update(this.inputVideo.videoWidth,this.inputVideo.videoHeight),this.lastFrameTime=performance.now(),this.frameTimer.finish(),this.frameTimer.start(),t.next=8,this.effectProcessor.process();case 8:this.drawFps(),this.toCanvas&&(null===(r=this.toCanvas.getContext("2d"))||void 0===r||r.drawImage(this.renderer.renderer.view,0,0,this.toCanvas.width,this.toCanvas.height));case 10:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"handleFrames",value:(r=tsvb_frame_callback_asyncToGenerator(tsvb_frame_callback_regeneratorRuntime().mark((function t(){var e,r,n,i=this;return tsvb_frame_callback_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.textures.length){t.next=2;break}return t.abrupt("return",this.handleFramesTimeout=tsvb_worker_timers_setTimeout((function(){i.handleFrames()}),10));case 2:if(this.inputVideo.paused&&this.inputVideo.play(),r=performance.now(),this.isRunning&&!this.isPaused&&this.effectProcessor){t.next=12;break}return this.textures.forEach((function(t){return t.destroy(!0)})),this.textures=[],this.renderer.addToEffects(this.videoFrame.frame),this.renderer.render(),this.renderer.removeFromEffects(this.videoFrame.frame),this.toCanvas&&(null===(e=this.toCanvas.getContext("2d"))||void 0===e||e.drawImage(this.renderer.renderer.view,0,0,this.toCanvas.width,this.toCanvas.height)),t.abrupt("return",this.handleFramesTimeout=tsvb_worker_timers_setTimeout((function(){i.handleFrames()}),Math.max(0,this.duration-(performance.now()-r))));case 12:if(n=this.textures.shift(),this.effectProcessor.nextFrame(new tsvb_Texture(n)),!this.onProcessPromise||!this.onProcessPromise.isPending()){t.next=17;break}return t.next=17,this.onProcessPromise.promise;case 17:return this.onProcessPromise=new tsvb_Deferred,this.nextTick().then((function(){i.onProcessPromise.resolve()})),t.abrupt("return",this.handleFramesTimeout=tsvb_worker_timers_setTimeout((function(){i.handleFrames()}),0));case 20:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"process",value:function(){var t=this;if(this.stopTimers(),this.getInputVideoTrack()){var e=this.getInputVideoStream();e&&(this.inputVideo.srcObject=e,this.inputVideo.muted=!0,this.inputVideo.setAttribute("playsinline",!0),this.inputVideo.playsInline=!0,this.inputVideo.play().then((function(){t.videoTexture=new tsvb_Texture(t.inputVideo),t.videoFrame=new tsvb_Frame(t.videoTexture,{width:t.sdkOptions.width,height:t.sdkOptions.height})}))),this.startTimers()}else tsvb_errorBus.bv.notify({message:"there is no videoTrack to process",emitter:tsvb_errorBus.JK.SRTEAM_PROCESSOR})}},{key:"getInputVideoStream",value:function(){return this.stream?this.stream:null}},{key:"getStream",value:function(){var t=this;return this.outputStream||(this.outputStream=this.renderer.renderer.view.captureStream(30),this.outputStream.getVideoTracks()[0].getSettings=function(){return t.videoTrackWrapper.getSettings()},this.outputStream.getVideoTracks()[0].getConstraints=function(){return t.videoTrackWrapper.getConstraints()},this.outputStream.getVideoTracks()[0].getCapabilities=function(){return t.videoTrackWrapper.getCapabilities()},this.outputStream.getVideoTracks()[0].applyConstraints=function(e){return t.videoTrackWrapper.applyConstraints(e)},this.stream&&this.stream.getAudioTracks().forEach((function(e,r){t.outputStream.addTrack(e)}))),this.outputStream}}]);var r,n,i,s,o}();function tsvb_animation_callback_typeof(t){return tsvb_animation_callback_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_animation_callback_typeof(t)}function tsvb_animation_callback_regeneratorRuntime(){tsvb_animation_callback_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_animation_callback_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_animation_callback_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_animation_callback_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_animation_callback_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_animation_callback_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_animation_callback_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_animation_callback_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_animation_callback_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_animation_callback_toPropertyKey(n.key),n)}}function tsvb_animation_callback_createClass(t,e,r){return e&&tsvb_animation_callback_defineProperties(t.prototype,e),r&&tsvb_animation_callback_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_animation_callback_toPropertyKey(t){var e=tsvb_animation_callback_toPrimitive(t,"string");return"symbol"==tsvb_animation_callback_typeof(e)?e:e+""}function tsvb_animation_callback_toPrimitive(t,e){if("object"!=tsvb_animation_callback_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_animation_callback_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_animation_callback_callSuper(t,e,r){return e=tsvb_animation_callback_getPrototypeOf(e),tsvb_animation_callback_possibleConstructorReturn(t,tsvb_animation_callback_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_animation_callback_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_animation_callback_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_animation_callback_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_animation_callback_assertThisInitialized(t)}function tsvb_animation_callback_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_animation_callback_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_animation_callback_isNativeReflectConstruct=function(){return!!t})()}function tsvb_animation_callback_superPropGet(t,e,r,n){var i=tsvb_animation_callback_get(tsvb_animation_callback_getPrototypeOf(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof i?function(t){return i.apply(r,t)}:i}function tsvb_animation_callback_get(){return tsvb_animation_callback_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=tsvb_animation_callback_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tsvb_animation_callback_get.apply(null,arguments)}function tsvb_animation_callback_superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tsvb_animation_callback_getPrototypeOf(t)););return t}function tsvb_animation_callback_getPrototypeOf(t){return tsvb_animation_callback_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_animation_callback_getPrototypeOf(t)}function tsvb_animation_callback_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_animation_callback_setPrototypeOf(t,e)}function tsvb_animation_callback_setPrototypeOf(t,e){return tsvb_animation_callback_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_animation_callback_setPrototypeOf(t,e)}var tsvb_AnimationCallbackStreamProcessor=function(t){function e(t){var r;return tsvb_animation_callback_classCallCheck(this,e),(r=tsvb_animation_callback_callSuper(this,e,[t])).timing=performance.now(),r}return tsvb_animation_callback_inherits(e,tsvb_FrameCallbackStreamProcessor),tsvb_animation_callback_createClass(e,[{key:"gatherByCallback",value:(r=tsvb_animation_callback_asyncToGenerator(tsvb_animation_callback_regeneratorRuntime().mark((function t(){var e=this;return tsvb_animation_callback_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!document.hidden){t.next=3;break}return this.requestAnimationFrameID=window.requestAnimationFrame((function(){return e.gatherByCallback()})),t.abrupt("return");case 3:performance.now()-this.timing>.85*this.duration&&(this.gatherFrames(),this.timing=performance.now()),this.requestAnimationFrameID=window.requestAnimationFrame((function(){return e.gatherByCallback()}));case 6:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"stopTimers",value:function(){if(tsvb_animation_callback_superPropGet(e,"stopTimers",this,3)([]),this.requestAnimationFrameID)try{cancelAnimationFrame(this.requestAnimationFrameID),this.requestAnimationFrameID=0}catch(t){}}}]);var r}();function tsvb_transform_typeof(t){return tsvb_transform_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_transform_typeof(t)}function tsvb_transform_regeneratorRuntime(){tsvb_transform_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_transform_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_transform_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_transform_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_transform_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_transform_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_transform_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_transform_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_transform_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_transform_toPropertyKey(n.key),n)}}function tsvb_transform_createClass(t,e,r){return e&&tsvb_transform_defineProperties(t.prototype,e),r&&tsvb_transform_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_transform_toPropertyKey(t){var e=tsvb_transform_toPrimitive(t,"string");return"symbol"==tsvb_transform_typeof(e)?e:e+""}function tsvb_transform_toPrimitive(t,e){if("object"!=tsvb_transform_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_transform_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_transform_callSuper(t,e,r){return e=tsvb_transform_getPrototypeOf(e),tsvb_transform_possibleConstructorReturn(t,tsvb_transform_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_transform_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_transform_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_transform_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_transform_assertThisInitialized(t)}function tsvb_transform_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_transform_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_transform_isNativeReflectConstruct=function(){return!!t})()}function tsvb_transform_getPrototypeOf(t){return tsvb_transform_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_transform_getPrototypeOf(t)}function tsvb_transform_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_transform_setPrototypeOf(t,e)}function tsvb_transform_setPrototypeOf(t,e){return tsvb_transform_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_transform_setPrototypeOf(t,e)}var tsvb_TransformStreamProcessor=function(t){function e(t){var r;return tsvb_transform_classCallCheck(this,e),(r=tsvb_transform_callSuper(this,e,[t])).frameTimes=[],r.aborter=new AbortController,r}return tsvb_transform_inherits(e,tsvb_StreamProcessor),tsvb_transform_createClass(e,[{key:"clearBuffers",value:function(){this.effectProcessor.clearBuffers()}},{key:"destroy",value:function(){this.outputStream&&this.outputStream.getTracks().forEach((function(t){t.stop()})),this.aborter.abort("stream_processor is destroyed")}},{key:"nextTick",value:(n=tsvb_transform_asyncToGenerator(tsvb_transform_regeneratorRuntime().mark((function t(e,r){var n,i,s,o,a,u,l,c;return tsvb_transform_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null===(n=this.frameDrawFunction)||void 0===n||n.call(this),this.videoTrackWrapper.update(e.displayWidth,e.displayHeight),this.frame_count++,this.lastFrameTime=performance.now(),this.frameTimer.finish(),this.frameTimer.start(),t.next=8,this.effectProcessor.process();case 8:this.drawFps();try{l=this.renderer.getVideoFrameSettings(),c=this.renderer.getVideoFrameData(),u=new VideoFrame(c,Object.assign({duration:this.frameTimer.getFrameDuration(),timestamp:e.timestamp},l)),e.close();try{r.enqueue(u)}catch(t){tsvb_errorBus.bv.notify({message:null!==(i=t.message)&&void 0!==i?i:t,emitter:tsvb_errorBus.JK.SRTEAM_PROCESSOR,cause:t}),u.close()}this.toCanvas&&(null===(s=this.toCanvas.getContext("2d"))||void 0===s||s.clearRect(0,0,this.toCanvas.width,this.toCanvas.height),null===(o=this.toCanvas.getContext("2d"))||void 0===o||o.drawImage(this.renderer.renderer.view,0,0,this.toCanvas.width,this.toCanvas.height))}catch(t){tsvb_errorBus.bv.notify({message:null!==(a=t.message)&&void 0!==a?a:t,emitter:tsvb_errorBus.JK.SRTEAM_PROCESSOR,cause:t}),e.close()}case 10:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"handleFrames",value:(r=tsvb_transform_asyncToGenerator(tsvb_transform_regeneratorRuntime().mark((function t(e,r){var n,i=this;return tsvb_transform_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isRunning&&!this.isPaused&&this.effectProcessor){t.next=3;break}try{r.enqueue(e),this.toCanvas&&(null===(n=this.toCanvas.getContext("2d"))||void 0===n||n.drawImage(e,0,0,this.toCanvas.width,this.toCanvas.height))}catch(t){e.close()}return t.abrupt("return");case 3:if(this.effectProcessor.nextFrame(new tsvb_Texture(e)),!this.onProcessPromise||!this.onProcessPromise.isPending()){t.next=7;break}return t.next=7,this.onProcessPromise.promise;case 7:this.onProcessPromise=new tsvb_Deferred,this.nextTick(e,r).then((function(){i.onProcessPromise.resolve()}));case 9:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"process",value:function(){var t=this,e=this.getInputVideoTrack();if(e){this.outputVideoTrack=new MediaStreamTrackGenerator({kind:"video"}),this.outputVideoTrack.getSettings=function(){return t.videoTrackWrapper.getSettings()},this.outputVideoTrack.getConstraints=function(){return t.videoTrackWrapper.getConstraints()},this.outputVideoTrack.getCapabilities=function(){return t.videoTrackWrapper.getCapabilities()},this.outputVideoTrack.applyConstraints=function(e){return t.videoTrackWrapper.applyConstraints(e)},this.outputStream&&this.outputStream.getTracks().forEach((function(t){t.stop()})),this.outputStream=new MediaStream([this.outputVideoTrack]),this.stream&&this.stream.getAudioTracks().forEach((function(e,r){t.outputStream.addTrack(e)})),this.trackProcessor=new MediaStreamTrackProcessor({track:e}),this.timestamp=performance.now();var r=this,n=new TransformStream({transform:function(t,e){return tsvb_transform_asyncToGenerator(tsvb_transform_regeneratorRuntime().mark((function n(){return tsvb_transform_regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.handleFrames(t,e);case 2:case"end":return n.stop()}}),n)})))()}});this.trackProcessor.readable.pipeThrough(n,{signal:this.aborter.signal}).pipeTo(this.outputVideoTrack.writable).catch((function(t){var e;tsvb_errorBus.bv.notify({message:null!==(e=t.message)&&void 0!==e?e:t,emitter:tsvb_errorBus.JK.SRTEAM_PROCESSOR,cause:t})}))}else tsvb_errorBus.bv.notify({message:"there is no videoTrack to process",emitter:tsvb_errorBus.JK.SRTEAM_PROCESSOR})}},{key:"getStream",value:function(){return this.outputStream}}]);var r,n}();function tsvb_video_callback_typeof(t){return tsvb_video_callback_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_video_callback_typeof(t)}function tsvb_video_callback_regeneratorRuntime(){tsvb_video_callback_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_video_callback_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_video_callback_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_video_callback_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_video_callback_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_video_callback_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_video_callback_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_video_callback_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_video_callback_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_video_callback_toPropertyKey(n.key),n)}}function tsvb_video_callback_createClass(t,e,r){return e&&tsvb_video_callback_defineProperties(t.prototype,e),r&&tsvb_video_callback_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_video_callback_toPropertyKey(t){var e=tsvb_video_callback_toPrimitive(t,"string");return"symbol"==tsvb_video_callback_typeof(e)?e:e+""}function tsvb_video_callback_toPrimitive(t,e){if("object"!=tsvb_video_callback_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_video_callback_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_video_callback_callSuper(t,e,r){return e=tsvb_video_callback_getPrototypeOf(e),tsvb_video_callback_possibleConstructorReturn(t,tsvb_video_callback_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_video_callback_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_video_callback_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_video_callback_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_video_callback_assertThisInitialized(t)}function tsvb_video_callback_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_video_callback_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_video_callback_isNativeReflectConstruct=function(){return!!t})()}function tsvb_video_callback_superPropGet(t,e,r,n){var i=tsvb_video_callback_get(tsvb_video_callback_getPrototypeOf(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof i?function(t){return i.apply(r,t)}:i}function tsvb_video_callback_get(){return tsvb_video_callback_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=tsvb_video_callback_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tsvb_video_callback_get.apply(null,arguments)}function tsvb_video_callback_superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tsvb_video_callback_getPrototypeOf(t)););return t}function tsvb_video_callback_getPrototypeOf(t){return tsvb_video_callback_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_video_callback_getPrototypeOf(t)}function tsvb_video_callback_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_video_callback_setPrototypeOf(t,e)}function tsvb_video_callback_setPrototypeOf(t,e){return tsvb_video_callback_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_video_callback_setPrototypeOf(t,e)}var tsvb_VideoCallbackStreamProcessor=function(t){function e(t){var r;return tsvb_video_callback_classCallCheck(this,e),(r=tsvb_video_callback_callSuper(this,e,[t])).timing=performance.now(),r}return tsvb_video_callback_inherits(e,tsvb_FrameCallbackStreamProcessor),tsvb_video_callback_createClass(e,[{key:"gatherByCallback",value:(r=tsvb_video_callback_asyncToGenerator(tsvb_video_callback_regeneratorRuntime().mark((function t(){var e=this;return tsvb_video_callback_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!document.hidden){t.next=3;break}return this.gatherFramesTimeout=setTimeout((function(){e.inputVideo.requestVideoFrameCallback((function(){return e.gatherByCallback()}))}),0),t.abrupt("return");case 3:performance.now()-this.timing>.85*this.duration&&(this.gatherFrames(),this.timing=performance.now()),this.gatherFramesTimeout=setTimeout((function(){e.inputVideo.requestVideoFrameCallback((function(){return e.gatherByCallback()}))}),0);case 6:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"stopTimers",value:function(){if(tsvb_video_callback_superPropGet(e,"stopTimers",this,3)([]),this.requestVideoFrameID)try{this.inputVideo.cancelVideoFrameCallback(this.requestVideoFrameID),this.requestVideoFrameID=0}catch(t){}}}]);var r}();function tsvb_factory_typeof(t){return tsvb_factory_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_factory_typeof(t)}function tsvb_factory_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_factory_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_factory_toPropertyKey(n.key),n)}}function tsvb_factory_createClass(t,e,r){return e&&tsvb_factory_defineProperties(t.prototype,e),r&&tsvb_factory_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_factory_toPropertyKey(t){var e=tsvb_factory_toPrimitive(t,"string");return"symbol"==tsvb_factory_typeof(e)?e:e+""}function tsvb_factory_toPrimitive(t,e){if("object"!=tsvb_factory_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_factory_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_streamProcessorMap={transform:tsvb_TransformStreamProcessor,videocallback:tsvb_VideoCallbackStreamProcessor,animationcallback:tsvb_AnimationCallbackStreamProcessor},tsvb_StreamProcessorFactory=function(){return tsvb_factory_createClass((function t(){tsvb_factory_classCallCheck(this,t)}),null,[{key:"getStreamProcessor",value:function(t,e){return new tsvb_streamProcessorMap[t](e)}}])}();function tsvb_sequentialExecutor_typeof(t){return tsvb_sequentialExecutor_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_sequentialExecutor_typeof(t)}function tsvb_sequentialExecutor_regeneratorRuntime(){tsvb_sequentialExecutor_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_sequentialExecutor_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_sequentialExecutor_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_sequentialExecutor_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_sequentialExecutor_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_sequentialExecutor_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_sequentialExecutor_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_sequentialExecutor_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_sequentialExecutor_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_sequentialExecutor_toPropertyKey(n.key),n)}}function tsvb_sequentialExecutor_createClass(t,e,r){return e&&tsvb_sequentialExecutor_defineProperties(t.prototype,e),r&&tsvb_sequentialExecutor_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_sequentialExecutor_toPropertyKey(t){var e=tsvb_sequentialExecutor_toPrimitive(t,"string");return"symbol"==tsvb_sequentialExecutor_typeof(e)?e:e+""}function tsvb_sequentialExecutor_toPrimitive(t,e){if("object"!=tsvb_sequentialExecutor_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_sequentialExecutor_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_SequentialExecutor=function(){return tsvb_sequentialExecutor_createClass((function t(){tsvb_sequentialExecutor_classCallCheck(this,t),this.queue=[],this.isExecuting=!1}),[{key:"enqueue",value:function(t){var e=this;return new Promise((function(r,n){var i=function(){var e=tsvb_sequentialExecutor_asyncToGenerator(tsvb_sequentialExecutor_regeneratorRuntime().mark((function e(){var i;return tsvb_sequentialExecutor_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t();case 3:i=e.sent,r(i),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e.queue.push(i),e.processQueue()}))}},{key:"processQueue",value:(t=tsvb_sequentialExecutor_asyncToGenerator(tsvb_sequentialExecutor_regeneratorRuntime().mark((function t(){var e;return tsvb_sequentialExecutor_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isExecuting){t.next=2;break}return t.abrupt("return");case 2:this.isExecuting=!0;case 3:if(!(this.queue.length>0)){t.next=10;break}if(!(e=this.queue.shift())){t.next=8;break}return t.next=8,e();case 8:t.next=3;break;case 10:this.isExecuting=!1;case 11:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})}]);var t}(),tsvb_ort_min=__webpack_require__(7734),tsvb_process=__webpack_require__(5606),tsvb_ort_webgpu_min_Buffer=__webpack_require__(8287).hp,tsvb_Xn=Object.defineProperty,tsvb_id=Object.getOwnPropertyDescriptor,tsvb_od=Object.getOwnPropertyNames,tsvb_sd=Object.prototype.hasOwnProperty,tsvb_q=(t,e)=>()=>(t&&(e=t(t=0)),e),tsvb_cr=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),tsvb_Kt=(t,e)=>{for(var r in e)tsvb_Xn(t,r,{get:e[r],enumerable:!0})},tsvb_ud=(t,e,r,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of tsvb_od(e))!tsvb_sd.call(t,i)&&i!==r&&tsvb_Xn(t,i,{get:()=>e[i],enumerable:!(n=tsvb_id(e,i))||n.enumerable});return t},tsvb_Rt=t=>tsvb_ud(tsvb_Xn({},"__esModule",{value:!0}),t),tsvb_nn,tsvb_Yt,tsvb_pr,tsvb_an,tsvb_on=tsvb_q((()=>{tsvb_nn=new Map,tsvb_Yt=[],tsvb_pr=(t,e,r)=>{if(!e||"function"!=typeof e.init||"function"!=typeof e.createInferenceSessionHandler)throw new TypeError("not a valid backend");{let n=tsvb_nn.get(t);if(void 0===n)tsvb_nn.set(t,{backend:e,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==e)throw new Error(`cannot register backend "${t}" using priority ${r}`)}if(r>=0){let e=tsvb_Yt.indexOf(t);-1!==e&&tsvb_Yt.splice(e,1);for(let e=0;e<tsvb_Yt.length;e++)if(tsvb_nn.get(tsvb_Yt[e]).priority<=r)return void tsvb_Yt.splice(e,0,t);tsvb_Yt.push(t)}}},tsvb_an=async t=>{let e=0===t.length?tsvb_Yt:t,r=[];for(let t of e){let e=tsvb_nn.get(t);if(e){if(e.initialized)return e.backend;if(e.aborted)continue;let n=!!e.initPromise;try{return n||(e.initPromise=e.backend.init(t)),await e.initPromise,e.initialized=!0,e.backend}catch(i){n||r.push({name:t,err:i}),e.aborted=!0}finally{delete e.initPromise}}}throw new Error(`no available backend found. ERR: ${r.map((t=>`[${t.name}] ${t.err}`)).join(", ")}`)}})),tsvb_ci=tsvb_q((()=>{tsvb_on()})),tsvb_pi,tsvb_mi=tsvb_q((()=>{tsvb_pi="1.17.0"})),tsvb_fi,tsvb_Zt,tsvb_Jn=tsvb_q((()=>{tsvb_mi(),tsvb_fi="warning",tsvb_Zt={wasm:{},webgl:{},webgpu:{},versions:{common:tsvb_pi},set logLevel(t){if(void 0!==t){if("string"!=typeof t||-1===["verbose","info","warning","error","fatal"].indexOf(t))throw new Error(`Unsupported logging level: ${t}`);tsvb_fi=t}},get logLevel(){return tsvb_fi}},Object.defineProperty(tsvb_Zt,"logLevel",{enumerable:!0})})),tsvb_Te,tsvb_hi=tsvb_q((()=>{tsvb_Jn(),tsvb_Te=tsvb_Zt})),tsvb_gi,tsvb_yi,tsvb_bi=tsvb_q((()=>{tsvb_gi=(t,e)=>{let r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=t.dims[3],r.height=t.dims[2];let n=r.getContext("2d");if(null!=n){let i,s;void 0!==e?.tensorLayout&&"NHWC"===e.tensorLayout?(i=t.dims[2],s=t.dims[3]):(i=t.dims[3],s=t.dims[2]);let o,a,u=void 0!==e?.format?e.format:"RGB",l=e?.norm;void 0===l||void 0===l.mean?o=[255,255,255,255]:"number"==typeof l.mean?o=[l.mean,l.mean,l.mean,l.mean]:(o=[l.mean[0],l.mean[1],l.mean[2],0],void 0!==l.mean[3]&&(o[3]=l.mean[3])),void 0===l||void 0===l.bias?a=[0,0,0,0]:"number"==typeof l.bias?a=[l.bias,l.bias,l.bias,l.bias]:(a=[l.bias[0],l.bias[1],l.bias[2],0],void 0!==l.bias[3]&&(a[3]=l.bias[3]));let c=s*i,h=0,f=c,d=2*c,p=-1;"RGBA"===u?(h=0,f=c,d=2*c,p=3*c):"RGB"===u?(h=0,f=c,d=2*c):"RBG"===u&&(h=0,d=c,f=2*c);for(let e=0;e<s;e++)for(let r=0;r<i;r++){let i=(t.data[h++]-a[0])*o[0],s=(t.data[f++]-a[1])*o[1],u=(t.data[d++]-a[2])*o[2],l=-1===p?255:(t.data[p++]-a[3])*o[3];n.fillStyle="rgba("+i+","+s+","+u+","+l+")",n.fillRect(r,e,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}throw new Error("Can not access image data")},tsvb_yi=(t,e)=>{let r,n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");if(null==n)throw new Error("Can not access image data");{let i,s,o;void 0!==e?.tensorLayout&&"NHWC"===e.tensorLayout?(i=t.dims[2],s=t.dims[1],o=t.dims[3]):(i=t.dims[3],s=t.dims[2],o=t.dims[1]);let a,u,l=void 0!==e&&void 0!==e.format?e.format:"RGB",c=e?.norm;void 0===c||void 0===c.mean?a=[255,255,255,255]:"number"==typeof c.mean?a=[c.mean,c.mean,c.mean,c.mean]:(a=[c.mean[0],c.mean[1],c.mean[2],255],void 0!==c.mean[3]&&(a[3]=c.mean[3])),void 0===c||void 0===c.bias?u=[0,0,0,0]:"number"==typeof c.bias?u=[c.bias,c.bias,c.bias,c.bias]:(u=[c.bias[0],c.bias[1],c.bias[2],0],void 0!==c.bias[3]&&(u[3]=c.bias[3]));let h=s*i;if(void 0!==e&&(void 0!==e.format&&4===o&&"RGBA"!==e.format||3===o&&"RGB"!==e.format&&"BGR"!==e.format))throw new Error("Tensor format doesn't match input tensor dims");let f=4,d=0,p=1,v=2,y=3,b=0,_=h,m=2*h,g=-1;"RGBA"===l?(b=0,_=h,m=2*h,g=3*h):"RGB"===l?(b=0,_=h,m=2*h):"RBG"===l&&(b=0,m=h,_=2*h),r=n.createImageData(i,s);for(let e=0;e<s*i;d+=f,p+=f,v+=f,y+=f,e++)r.data[d]=(t.data[b++]-u[0])*a[0],r.data[p]=(t.data[_++]-u[1])*a[1],r.data[v]=(t.data[m++]-u[2])*a[2],r.data[y]=-1===g?255:(t.data[g++]-u[3])*a[3]}return r}})),tsvb_ea,tsvb_wi,tsvb_vi,tsvb_$i,src_tsvb_i,tsvb_xi=tsvb_q((()=>{tsvb_sn(),tsvb_ea=(t,e)=>{if(void 0===t)throw new Error("Image buffer must be defined");if(void 0===e.height||void 0===e.width)throw new Error("Image height and width must be defined");if("NHWC"===e.tensorLayout)throw new Error("NHWC Tensor layout is not supported yet");let r,n,{height:i,width:s}=e,o=e.norm??{mean:255,bias:0};r="number"==typeof o.mean?[o.mean,o.mean,o.mean,o.mean]:[o.mean[0],o.mean[1],o.mean[2],o.mean[3]??255],n="number"==typeof o.bias?[o.bias,o.bias,o.bias,o.bias]:[o.bias[0],o.bias[1],o.bias[2],o.bias[3]??0];let a=void 0!==e.format?e.format:"RGBA",u=void 0!==e.tensorFormat&&void 0!==e.tensorFormat?e.tensorFormat:"RGB",l=i*s,c="RGBA"===u?new Float32Array(4*l):new Float32Array(3*l),h=4,f=0,d=1,p=2,v=3,y=0,b=l,_=2*l,m=-1;"RGB"===a&&(h=3,f=0,d=1,p=2,v=-1),"RGBA"===u?m=3*l:"RBG"===u?(y=0,_=l,b=2*l):"BGR"===u&&(_=0,b=l,y=2*l);for(let e=0;e<l;e++,f+=h,p+=h,d+=h,v+=h)c[y++]=(t[f]+n[0])/r[0],c[b++]=(t[d]+n[1])/r[1],c[_++]=(t[p]+n[2])/r[2],-1!==m&&-1!==v&&(c[m++]=(t[v]+n[3])/r[3]);return new tsvb_rt("float32",c,"RGBA"===u?[1,4,i,s]:[1,3,i,s])},tsvb_wi=async(t,e)=>{let r,n=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,i=typeof ImageData<"u"&&t instanceof ImageData,s=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,o="string"==typeof t,a=e??{},u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},l=t=>t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas?t.getContext("2d"):null;if(n){let n=u();n.width=t.width,n.height=t.height;let i=l(n);if(null==i)throw new Error("Can not access image data");{let n=t.height,s=t.width;if(void 0!==e&&void 0!==e.resizedHeight&&void 0!==e.resizedWidth&&(n=e.resizedHeight,s=e.resizedWidth),void 0!==e){if(a=e,void 0!==e.tensorFormat)throw new Error("Image input config format must be RGBA for HTMLImageElement");a.tensorFormat="RGBA",a.height=n,a.width=s}else a.tensorFormat="RGBA",a.height=n,a.width=s;i.drawImage(t,0,0),r=i.getImageData(0,0,s,n).data}}else{if(!i){if(s){if(void 0===e)throw new Error("Please provide image config with format for Imagebitmap");let n=u();n.width=t.width,n.height=t.height;let i=l(n);if(null!=i){let e=t.height,n=t.width;return i.drawImage(t,0,0,n,e),r=i.getImageData(0,0,n,e).data,a.height=e,a.width=n,tsvb_ea(r,a)}throw new Error("Can not access image data")}if(o)return new Promise(((e,r)=>{let n=u(),i=l(n);if(!t||!i)return r();let s=new Image;s.crossOrigin="Anonymous",s.src=t,s.onload=()=>{n.width=s.width,n.height=s.height,i.drawImage(s,0,0,n.width,n.height);let t=i.getImageData(0,0,n.width,n.height);a.height=n.height,a.width=n.width,e(tsvb_ea(t.data,a))}}));throw new Error("Input data provided is not supported - aborted tensor creation")}{let n,i;if(void 0!==e&&void 0!==e.resizedWidth&&void 0!==e.resizedHeight?(n=e.resizedHeight,i=e.resizedWidth):(n=t.height,i=t.width),void 0!==e&&(a=e),a.format="RGBA",a.height=n,a.width=i,void 0!==e){let e=u();e.width=i,e.height=n;let s=l(e);if(null==s)throw new Error("Can not access image data");s.putImageData(t,0,0),r=s.getImageData(0,0,i,n).data}else r=t.data}}if(void 0!==r)return tsvb_ea(r,a);throw new Error("Input data provided is not supported - aborted tensor creation")},tsvb_vi=(t,e)=>{let{width:r,height:n,download:i,dispose:s}=e;return new tsvb_rt({location:"texture",type:"float32",texture:t,dims:[1,n,r,4],download:i,dispose:s})},tsvb_$i=(t,e)=>{let{dataType:r,dims:n,download:i,dispose:s}=e;return new tsvb_rt({location:"gpu-buffer",type:r??"float32",gpuBuffer:t,dims:n,download:i,dispose:s})},src_tsvb_i=(t,e,r)=>new tsvb_rt({location:"cpu-pinned",type:t,data:e,dims:r??[e.length]})})),tsvb_Pr,tsvb_un,tsvb_Si,tsvb_Ii,tsvb_Ci=tsvb_q((()=>{tsvb_Pr=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["float16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),tsvb_un=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),tsvb_Si=!1,tsvb_Ii=()=>{if(!tsvb_Si){tsvb_Si=!0;let t=typeof BigInt64Array<"u"&&"function"==typeof BigInt64Array.from,e=typeof BigUint64Array<"u"&&"function"==typeof BigUint64Array.from;t&&(tsvb_Pr.set("int64",BigInt64Array),tsvb_un.set(BigInt64Array,"int64")),e&&(tsvb_Pr.set("uint64",BigUint64Array),tsvb_un.set(BigUint64Array,"uint64"))}}})),tsvb_Ai,tsvb_Ti,tsvb_Ei=tsvb_q((()=>{tsvb_sn(),tsvb_Ai=t=>{let e=1;for(let r=0;r<t.length;r++){let n=t[r];if("number"!=typeof n||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);e*=n}return e},tsvb_Ti=(t,e)=>{switch(t.location){case"cpu":return new tsvb_rt(t.type,t.data,e);case"cpu-pinned":return new tsvb_rt({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case"texture":return new tsvb_rt({location:"texture",texture:t.texture,type:t.type,dims:e});case"gpu-buffer":return new tsvb_rt({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}}})),tsvb_rt,tsvb_sn=tsvb_q((()=>{tsvb_bi(),tsvb_xi(),tsvb_Ci(),tsvb_Ei(),tsvb_rt=class{constructor(t,e,r){let n,i;if(tsvb_Ii(),"object"==typeof t&&"location"in t)switch(this.dataLocation=t.location,n=t.type,i=t.dims,t.location){case"cpu-pinned":{let e=tsvb_Pr.get(n);if(!e)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(t.data instanceof e))throw new TypeError(`buffer should be of type ${e.name}`);this.cpuData=t.data;break}case"texture":if("float32"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break;case"gpu-buffer":if("float32"!==n&&"float16"!==n&&"int32"!==n&&"int64"!==n&&"uint32"!==n&&"bool"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break;default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let s,o;if("string"==typeof t)if(n=t,o=r,"string"===t){if(!Array.isArray(e))throw new TypeError("A string tensor's data must be a string array.");s=e}else{let r=tsvb_Pr.get(t);if(void 0===r)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(e)){if("float16"===t)throw new TypeError("Creating a float16 tensor from number array is not supported. Please use Uint16Array as data.");s="uint64"===t||"int64"===t?r.from(e,BigInt):r.from(e)}else{if(!(e instanceof r))throw new TypeError(`A ${n} tensor's data must be type of ${r}`);s=e}}else if(o=e,Array.isArray(t)){if(0===t.length)throw new TypeError("Tensor type cannot be inferred from an empty array.");let e=typeof t[0];if("string"===e)n="string",s=t;else{if("boolean"!==e)throw new TypeError(`Invalid element type of data array: ${e}.`);n="bool",s=Uint8Array.from(t)}}else{let e=tsvb_un.get(t.constructor);if(void 0===e)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);n=e,s=t}if(void 0===o)o=[s.length];else if(!Array.isArray(o))throw new TypeError("A tensor's dims must be a number array");i=o,this.cpuData=s,this.dataLocation="cpu"}let s=tsvb_Ai(i);if(this.cpuData&&s!==this.cpuData.length)throw new Error(`Tensor's size(${s}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=i,this.size=s}static async fromImage(t,e){return tsvb_wi(t,e)}static fromTexture(t,e){return tsvb_vi(t,e)}static fromGpuBuffer(t,e){return tsvb_$i(t,e)}static fromPinnedBuffer(t,e,r){return src_tsvb_i(t,e,r)}toDataURL(t){return tsvb_gi(this,t)}toImageData(t){return tsvb_yi(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let e=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=e,t&&this.disposer&&(this.disposer(),this.disposer=void 0),e}finally{this.isDownloading=!1}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return tsvb_Ti(this,t)}}})),tsvb_Xe,tsvb_ln=tsvb_q((()=>{tsvb_sn(),tsvb_Xe=tsvb_rt})),tsvb_dn,tsvb_Oi,tsvb_lt,tsvb_dt,tsvb_ta=tsvb_q((()=>{tsvb_Jn(),tsvb_dn=(t,e)=>{tsvb_Zt.wasm.trace&&console.timeStamp(`${t}::ORT::${e}`)},tsvb_Oi=(t,e)=>{let r=(new Error).stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let i=0;i<r.length;i++){if(n&&!r[i].includes("TRACE_FUNC")){let n=`FUNC_${t}::${r[i].trim().split(" ")[1]}`;return e&&(n+=`::${e}`),void tsvb_dn("CPU",n)}r[i].includes("TRACE_FUNC")&&(n=!0)}},tsvb_lt=t=>{tsvb_Zt.wasm.trace&&tsvb_Oi("BEGIN",t)},tsvb_dt=t=>{tsvb_Zt.wasm.trace&&tsvb_Oi("END",t)}})),tsvb_cn,tsvb_ki=tsvb_q((()=>{tsvb_on(),tsvb_ln(),tsvb_ta(),tsvb_cn=class t{constructor(t){this.handler=t}async run(t,e,r){tsvb_lt();let n={},i={};if("object"!=typeof t||null===t||t instanceof tsvb_Xe||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let s=!0;if("object"==typeof e){if(null===e)throw new TypeError("Unexpected argument[1]: cannot be null.");if(e instanceof tsvb_Xe)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(e)){if(0===e.length)throw new TypeError("'fetches' cannot be an empty array.");s=!1;for(let t of e){if("string"!=typeof t)throw new TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(t))throw new RangeError(`'fetches' contains invalid output name: ${t}.`);n[t]=null}if("object"==typeof r&&null!==r)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{let t=!1,o=Object.getOwnPropertyNames(e);for(let r of this.outputNames)if(-1!==o.indexOf(r)){let i=e[r];(null===i||i instanceof tsvb_Xe)&&(t=!0,s=!1,n[r]=i)}if(t){if("object"==typeof r&&null!==r)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else i=e}}else if(typeof e<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let e of this.inputNames)if(typeof t[e]>"u")throw new Error(`input '${e}' is missing in 'feeds'.`);if(s)for(let t of this.outputNames)n[t]=null;let o=await this.handler.run(t,n,i),a={};for(let t in o)if(Object.hasOwnProperty.call(o,t)){let e=o[t];a[t]=e instanceof tsvb_Xe?e:new tsvb_Xe(e.type,e.data,e.dims)}return tsvb_dt(),a}async release(){return this.handler.dispose()}async configure(t){return await this.handler.configure(t)}async auth(t){return await this.handler.auth(t)}static async create(e,r,n,i){tsvb_lt();let s,o={};if("string"==typeof e){if(s=e,"object"==typeof r&&null!==r)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(s=e,"object"==typeof r&&null!==r)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{if(!(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer))throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");{let t=e,a=0,u=e.byteLength;if("object"==typeof r&&null!==r)o=r;else if("number"==typeof r){if(a=r,!Number.isSafeInteger(a))throw new RangeError("'byteOffset' must be an integer.");if(a<0||a>=t.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${t.byteLength}).`);if(u=e.byteLength-a,"number"==typeof n){if(u=n,!Number.isSafeInteger(u))throw new RangeError("'byteLength' must be an integer.");if(u<=0||a+u>t.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${t.byteLength-a}].`);if("object"==typeof i&&null!==i)o=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");s=new Uint8Array(t,a,u)}}let a=(o.executionProviders||[]).map((t=>"string"==typeof t?t:t.name)),u=await(await tsvb_an(a)).createInferenceSessionHandler(s,o);return tsvb_dt(),new t(u)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}})),tsvb_ld,tsvb_Bi=tsvb_q((()=>{tsvb_ki(),tsvb_ld=tsvb_cn})),tsvb_Pi=tsvb_q((()=>{})),tsvb_dd,tsvb_pn,tsvb_Ri=tsvb_q((()=>{tsvb_on(),tsvb_ln(),tsvb_dd="Training backend could not be resolved. Make sure you're using the correct configuration & WebAssembly files.",tsvb_pn=class t{constructor(t,e,r){this.handler=t,this.hasOptimizerModel=e,this.hasEvalModel=r}get trainingInputNames(){return this.handler.inputNames}get trainingOutputNames(){return this.handler.outputNames}get evalInputNames(){if(this.hasEvalModel)return this.handler.evalInputNames;throw new Error("This training session has no evalModel loaded.")}get evalOutputNames(){if(this.hasEvalModel)return this.handler.evalOutputNames;throw new Error("This training session has no evalModel loaded.")}static async create(e,r){let n=e.evalModel||"",i=e.optimizerModel||"",s=r||{},o=(s.executionProviders||[]).map((t=>"string"==typeof t?t:t.name)),a=await tsvb_an(o);if(a.createTrainingSessionHandler){let r=await a.createTrainingSessionHandler(e.checkpointState,e.trainModel,n,i,s);return new t(r,!!e.optimizerModel,!!e.evalModel)}throw new Error(tsvb_dd)}typeNarrowingForRunStep(t,e,r,n,i){let s={},o={};if("object"!=typeof r||null===r||r instanceof tsvb_Xe||Array.isArray(r))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if("object"==typeof n){if(null===n)throw new TypeError("Unexpected argument[1]: cannot be null.");if(n instanceof tsvb_Xe)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(n)){if(0===n.length)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let t of n){if("string"!=typeof t)throw new TypeError("'fetches' must be a string array or an object.");if(-1===e.indexOf(t))throw new RangeError(`'fetches' contains invalid output name: ${t}.`);s[t]=null}if("object"==typeof i&&null!==i)o=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else{let t=!1,r=Object.getOwnPropertyNames(n);for(let i of e)if(-1!==r.indexOf(i)){let e=n[i];(null===e||e instanceof tsvb_Xe)&&(t=!0,a=!1,s[i]=e)}if(t){if("object"==typeof i&&null!==i)o=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else o=n}}else if(typeof n<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let e of t)if(typeof r[e]>"u")throw new Error(`input '${e}' is missing in 'feeds'.`);if(a)for(let t of e)s[t]=null;return[s,o]}convertHandlerReturnTypeToMapOfTensors(t){let e={};for(let r in t)if(Object.hasOwnProperty.call(t,r)){let n=t[r];e[r]=n instanceof tsvb_Xe?n:new tsvb_Xe(n.type,n.data,n.dims)}return e}async lazyResetGrad(){await this.handler.lazyResetGrad()}async runTrainStep(t,e,r){let[n,i]=this.typeNarrowingForRunStep(this.trainingInputNames,this.trainingOutputNames,t,e,r),s=await this.handler.runTrainStep(t,n,i);return this.convertHandlerReturnTypeToMapOfTensors(s)}async runOptimizerStep(t){if(!this.hasOptimizerModel)throw new Error("This TrainingSession has no OptimizerModel loaded.");await this.handler.runOptimizerStep(t||{})}async runEvalStep(t,e,r){if(this.hasEvalModel){let[n,i]=this.typeNarrowingForRunStep(this.evalInputNames,this.evalOutputNames,t,e,r),s=await this.handler.runEvalStep(t,n,i);return this.convertHandlerReturnTypeToMapOfTensors(s)}throw new Error("This TrainingSession has no EvalModel loaded.")}async getParametersSize(t=!0){return this.handler.getParametersSize(t)}async loadParametersBuffer(t,e=!0){let r=await this.getParametersSize(e);if(t.length!==4*r)throw new Error("Size of the buffer passed into loadParametersBuffer must match the number of parameters in the model. Please use getParametersSize method to check.");return this.handler.loadParametersBuffer(t,e)}async getContiguousParameters(t=!0){return this.handler.getContiguousParameters(t)}async release(){return this.handler.dispose()}}})),tsvb_cd,tsvb_Di=tsvb_q((()=>{tsvb_Ri(),tsvb_cd=tsvb_pn})),tsvb_ra={};tsvb_Kt(tsvb_ra,{InferenceSession:()=>tsvb_ld,TRACE:()=>tsvb_dn,TRACE_FUNC_BEGIN:()=>tsvb_lt,TRACE_FUNC_END:()=>tsvb_dt,Tensor:()=>tsvb_Xe,TrainingSession:()=>tsvb_cd,env:()=>tsvb_Te,registerBackend:()=>tsvb_pr});var tsvb_pt=tsvb_q((()=>{tsvb_ci(),tsvb_hi(),tsvb_Bi(),tsvb_ln(),tsvb_ta(),tsvb_Pi(),tsvb_Di()})),tsvb_na={};tsvb_Kt(tsvb_na,{createReadStream:()=>tsvb_zi,readFile:()=>tsvb_pd,readFileSync:()=>tsvb_md});var tsvb_pd,tsvb_md,tsvb_zi,tsvb_aa=tsvb_q((()=>{tsvb_pd=void 0,tsvb_md=void 0,tsvb_zi=void 0})),tsvb_ia={};tsvb_Kt(tsvb_ia,{join:()=>tsvb_fd});var tsvb_fd,tsvb_oa=tsvb_q((()=>{tsvb_fd=void 0})),tsvb_sa={};tsvb_Kt(tsvb_sa,{crypto:()=>tsvb_hd});var tsvb_hd,tsvb_ua=tsvb_q((()=>{tsvb_hd=void 0})),tsvb_Wi=tsvb_cr(((t,e)=>{var r,n=(r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0,typeof __filename<"u"&&(r=r||__filename),function(t={}){var e,n,i=t;i.ready=new Promise(((t,r)=>{e=t,n=r})),i.mountExternalData=(t,e)=>{(i.Ka||(i.Ka=new Map)).set(t,e)},i.unmountExternalData=()=>{delete i.Ka},i.jsepInit=(t,e,r,n,s,o,a,u,l,c,h)=>{i.jb=t,i.Wa=e,i.$a=r,i.Qa=n,i.Za=s,i.Ba=o,i.ab=a,i.cb=u,i.Xa=l,i.Ya=c,i.bb=h,e=(t,e,r)=>(...n)=>{let i=dt,s=e?.();n=t(...n);let o=e?.();return s!==o&&(t=o,r(s),e=r=null),dt!=i?new Promise(((t,e)=>{mt={resolve:t,reject:e}})):n},r=e=>async(...r)=>{try{if(i.Ja)throw Error("Session already started");let n=i.Ja={eb:r[0],errors:[]},s=await e(...r);if(i.Ja!==n)throw Error("Session mismatch");t.flush();let o=n.errors;if(0<o.length){let t=await Promise.all(o);if(t=t.filter((t=>t)),0<t.length)throw Error(t.join("\n"))}return s}finally{i.Ja=null}},i._OrtRun=r(e(i._OrtRun,(()=>i._OrtRun),(t=>i._OrtRun=t))),i._OrtRunWithBinding=r(e(i._OrtRunWithBinding,(()=>i._OrtRunWithBinding),(t=>i._OrtRunWithBinding=t))),i._OrtBindInput=e(i._OrtBindInput,(()=>i._OrtBindInput),(t=>i._OrtBindInput=t)),i.jsepRegisterBuffer=(e,r,n,i)=>t.registerBuffer(e,r,n,i),i.jsepGetBuffer=e=>t.getBuffer(e),i.jsepCreateDownloader=(e,r,n)=>t.createDownloader(e,r,n),i.jsepOnReleaseSession=e=>{t.onReleaseSession(e)},i.jsepOnRunStart=e=>t.onRunStart(e)};var s,o,a,u=Object.assign({},i),l="./this.program",c=(t,e)=>{throw e},h="object"==typeof window,f="function"==typeof importScripts,d="object"==typeof tsvb_process&&"object"==typeof tsvb_process.versions&&"string"==typeof tsvb_process.versions.node,p="";if(d){var v=(tsvb_aa(),tsvb_Rt(tsvb_na)),y=(tsvb_oa(),tsvb_Rt(tsvb_ia));p=f?y.dirname(p)+"/":__dirname+"/",s=(t,e)=>(t=N(t)?new URL(t):y.normalize(t),v.readFileSync(t,e?void 0:"utf8")),a=t=>((t=s(t,!0)).buffer||(t=new Uint8Array(t)),t),o=(t,e,r,n=!0)=>{t=N(t)?new URL(t):y.normalize(t),v.readFile(t,n?void 0:"utf8",((t,i)=>{t?r(t):e(n?i.buffer:i)}))},!i.thisProgram&&1<tsvb_process.argv.length&&(l=tsvb_process.argv[1].replace(/\\/g,"/")),tsvb_process.argv.slice(2),c=(t,e)=>{throw tsvb_process.exitCode=t,e},i.inspect=()=>"[Emscripten Module object]"}else(h||f)&&(f?p=self.location.href:typeof document<"u"&&document.currentScript&&(p=document.currentScript.src),r&&(p=r),p=0!==p.indexOf("blob:")?p.substr(0,p.replace(/[?#].*/,"").lastIndexOf("/")+1):"",s=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},f&&(a=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),o=(t,e,r)=>{var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?e(n.response):r()},n.onerror=r,n.send(null)});var b=console.log.bind(console),_=console.error.bind(console);Object.assign(i,u),u=null,"object"!=typeof WebAssembly&&D("no native wasm support detected");var m,g,w,x,T,S,E,O,P=!1;function A(){var t=m.buffer;i.HEAP8=w=new Int8Array(t),i.HEAP16=new Int16Array(t),i.HEAPU8=x=new Uint8Array(t),i.HEAPU16=new Uint16Array(t),i.HEAP32=T=new Int32Array(t),i.HEAPU32=S=new Uint32Array(t),i.HEAPF32=E=new Float32Array(t),i.HEAPF64=O=new Float64Array(t)}var C=[],k=[],I=[],R=0,$=null,M=null;function D(t){throw _(t="Aborted("+t+")"),P=!0,g=1,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),n(t),t}var B,L=t=>t.startsWith("data:application/octet-stream;base64,"),N=t=>t.startsWith("file://");if(!L(B="ort-wasm-simd.wasm")){var F=B;B=i.locateFile?i.locateFile(F,p):p+F}function U(t){if(a)return a(t);throw"both async and sync fetching of the wasm failed"}function j(t,e,r){return function(t){if(h||f){if("function"==typeof fetch&&!N(t))return fetch(t,{credentials:"same-origin"}).then((e=>{if(!e.ok)throw"failed to load wasm binary file at '"+t+"'";return e.arrayBuffer()})).catch((()=>U(t)));if(o)return new Promise(((e,r)=>{o(t,(t=>e(new Uint8Array(t))),r)}))}return Promise.resolve().then((()=>U(t)))}(t).then((t=>WebAssembly.instantiate(t,e))).then((t=>t)).then(r,(t=>{_(`failed to asynchronously prepare wasm: ${t}`),D(t)}))}var z,G={898320:(t,e,r,n)=>{if(typeof i>"u"||!i.Ka)return 1;if((t=K(t>>>0)).startsWith("./")&&(t=t.substring(2)),!(t=i.Ka.get(t)))return 2;if((e>>>=0)+(r>>>=0)>t.byteLength)return 3;try{return x.set(t.subarray(e,e+r),n>>>0>>>0),0}catch{return 4}},898821:()=>{i.Xa()},898852:()=>{i.Ya()},898881:()=>{i.bb()},898906:t=>i.Wa(t),898939:t=>i.$a(t),898971:(t,e,r)=>{i.Qa(t,e,r,!0)},899010:(t,e,r)=>{i.Qa(t,e,r)},899043:t=>{i.Ba("Abs",t,void 0)},899094:t=>{i.Ba("Neg",t,void 0)},899145:t=>{i.Ba("Floor",t,void 0)},899198:t=>{i.Ba("Ceil",t,void 0)},899250:t=>{i.Ba("Reciprocal",t,void 0)},899308:t=>{i.Ba("Sqrt",t,void 0)},899360:t=>{i.Ba("Exp",t,void 0)},899411:t=>{i.Ba("Erf",t,void 0)},899462:t=>{i.Ba("Sigmoid",t,void 0)},899517:t=>{i.Ba("Log",t,void 0)},899568:t=>{i.Ba("Sin",t,void 0)},899619:t=>{i.Ba("Cos",t,void 0)},899670:t=>{i.Ba("Tan",t,void 0)},899721:t=>{i.Ba("Asin",t,void 0)},899773:t=>{i.Ba("Acos",t,void 0)},899825:t=>{i.Ba("Atan",t,void 0)},899877:t=>{i.Ba("Sinh",t,void 0)},899929:t=>{i.Ba("Cosh",t,void 0)},899981:t=>{i.Ba("Asinh",t,void 0)},900034:t=>{i.Ba("Acosh",t,void 0)},900087:t=>{i.Ba("Atanh",t,void 0)},900140:t=>{i.Ba("Tanh",t,void 0)},900192:t=>{i.Ba("Not",t,void 0)},900243:(t,e,r)=>{i.Ba("Clip",t,{min:e,max:r})},900312:t=>{i.Ba("Clip",t,void 0)},900364:(t,e)=>{i.Ba("Elu",t,{alpha:e})},900422:t=>{i.Ba("Relu",t,void 0)},900474:(t,e)=>{i.Ba("LeakyRelu",t,{alpha:e})},900538:(t,e)=>{i.Ba("ThresholdedRelu",t,{alpha:e})},900608:(t,e)=>{i.Ba("Cast",t,{to:e})},900666:t=>{i.Ba("Add",t,void 0)},900717:t=>{i.Ba("Sub",t,void 0)},900768:t=>{i.Ba("Mul",t,void 0)},900819:t=>{i.Ba("Div",t,void 0)},900870:t=>{i.Ba("Pow",t,void 0)},900921:t=>{i.Ba("Equal",t,void 0)},900974:t=>{i.Ba("Greater",t,void 0)},901029:t=>{i.Ba("GreaterOrEqual",t,void 0)},901091:t=>{i.Ba("Less",t,void 0)},901143:t=>{i.Ba("LessOrEqual",t,void 0)},901202:(t,e,r,n,s)=>{i.Ba("ReduceMean",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},901361:(t,e,r,n,s)=>{i.Ba("ReduceMax",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},901519:(t,e,r,n,s)=>{i.Ba("ReduceMin",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},901677:(t,e,r,n,s)=>{i.Ba("ReduceProd",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},901836:(t,e,r,n,s)=>{i.Ba("ReduceSum",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},901994:(t,e,r,n,s)=>{i.Ba("ReduceL1",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},902151:(t,e,r,n,s)=>{i.Ba("ReduceL2",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},902308:(t,e,r,n,s)=>{i.Ba("ReduceLogSum",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},902469:(t,e,r,n,s)=>{i.Ba("ReduceSumSquare",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},902633:(t,e,r,n,s)=>{i.Ba("ReduceLogSumExp",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},902797:t=>{i.Ba("Where",t,void 0)},902850:(t,e,r)=>{i.Ba("Transpose",t,{perm:e?Array.from(T.subarray(e>>>0,r>>>0)):[]})},902958:(t,e,r,n,s,o,a,u,l,c,h,f,d,p,v)=>{i.Ba("ConvTranspose",t,{format:l?"NHWC":"NCHW",autoPad:e,dilations:[r],group:n,kernel_shape:[s],pads:[o,a],strides:[u],wIsConst:()=>!!w[c>>>0],outputPadding:h?Array.from(T.subarray(h>>>0,f>>>0)):[],outputShape:d?Array.from(T.subarray(d>>>0,p>>>0)):[],activation:K(v)})},903360:(t,e,r,n,s,o,a,u,l,c,h,f,d,p)=>{i.Ba("ConvTranspose",t,{format:u?"NHWC":"NCHW",autoPad:e,dilations:Array.from(T.subarray(r>>>0,2+(r>>>0)>>>0)),group:n,kernelShape:Array.from(T.subarray(s>>>0,2+(s>>>0)>>>0)),pads:Array.from(T.subarray(o>>>0,4+(o>>>0)>>>0)),strides:Array.from(T.subarray(a>>>0,2+(a>>>0)>>>0)),wIsConst:()=>!!w[l>>>0],outputPadding:c?Array.from(T.subarray(c>>>0,h>>>0)):[],outputShape:f?Array.from(T.subarray(f>>>0,d>>>0)):[],activation:K(p)})},903925:(t,e,r,n,s,o,a,u,l,c,h,f,d,p,v)=>{i.Ba("ConvTranspose",t,{format:l?"NHWC":"NCHW",autoPad:e,dilations:[r],group:n,kernel_shape:[s],pads:[o,a],strides:[u],wIsConst:()=>!!w[c>>>0],outputPadding:h?Array.from(T.subarray(h>>>0,f>>>0)):[],outputShape:d?Array.from(T.subarray(d>>>0,p>>>0)):[],activation:K(v)})},904327:(t,e,r,n,s,o,a,u,l,c,h,f,d,p)=>{i.Ba("ConvTranspose",t,{format:u?"NHWC":"NCHW",autoPad:e,dilations:Array.from(T.subarray(r>>>0,2+(r>>>0)>>>0)),group:n,kernelShape:Array.from(T.subarray(s>>>0,2+(s>>>0)>>>0)),pads:Array.from(T.subarray(o>>>0,4+(o>>>0)>>>0)),strides:Array.from(T.subarray(a>>>0,2+(a>>>0)>>>0)),wIsConst:()=>!!w[l>>>0],outputPadding:c?Array.from(T.subarray(c>>>0,h>>>0)):[],outputShape:f?Array.from(T.subarray(f>>>0,d>>>0)):[],activation:K(p)})},904892:(t,e)=>{i.Ba("GlobalAveragePool",t,{format:e?"NHWC":"NCHW"})},904983:(t,e,r,n,s,o,a,u,l,c,h,f,d,p,v,y)=>{i.Ba("AveragePool",t,{format:y?"NHWC":"NCHW",auto_pad:e,ceil_mode:r,count_include_pad:n,storage_order:s,dilations:[o,a],kernel_shape:[u,l],pads:[c,h,f,d],strides:[p,v]})},905267:(t,e)=>{i.Ba("GlobalAveragePool",t,{format:e?"NHWC":"NCHW"})},905358:(t,e,r,n,s,o,a,u,l,c,h,f,d,p,v,y)=>{i.Ba("AveragePool",t,{format:y?"NHWC":"NCHW",auto_pad:e,ceil_mode:r,count_include_pad:n,storage_order:s,dilations:[o,a],kernel_shape:[u,l],pads:[c,h,f,d],strides:[p,v]})},905642:(t,e)=>{i.Ba("GlobalMaxPool",t,{format:e?"NHWC":"NCHW"})},905729:(t,e,r,n,s,o,a,u,l,c,h,f,d,p,v,y)=>{i.Ba("MaxPool",t,{format:y?"NHWC":"NCHW",auto_pad:e,ceil_mode:r,count_include_pad:n,storage_order:s,dilations:[o,a],kernel_shape:[u,l],pads:[c,h,f,d],strides:[p,v]})},906009:(t,e)=>{i.Ba("GlobalMaxPool",t,{format:e?"NHWC":"NCHW"})},906096:(t,e,r,n,s,o,a,u,l,c,h,f,d,p,v,y)=>{i.Ba("MaxPool",t,{format:y?"NHWC":"NCHW",auto_pad:e,ceil_mode:r,count_include_pad:n,storage_order:s,dilations:[o,a],kernel_shape:[u,l],pads:[c,h,f,d],strides:[p,v]})},906376:(t,e,r,n,s)=>{i.Ba("Gemm",t,{alpha:e,beta:r,transA:n,transB:s})},906480:t=>{i.Ba("MatMul",t,void 0)},906534:(t,e,r,n)=>{i.Ba("ArgMax",t,{keepDims:!!e,selectLastIndex:!!r,axis:n})},906642:(t,e,r,n)=>{i.Ba("ArgMin",t,{keepDims:!!e,selectLastIndex:!!r,axis:n})},906750:(t,e)=>{i.Ba("Softmax",t,{axis:e})},906813:(t,e)=>{i.Ba("Concat",t,{axis:e})},906873:(t,e,r,n,s)=>{i.Ba("Split",t,{axis:e,numOutputs:r,splitSizes:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},907013:t=>{i.Ba("Expand",t,void 0)},907067:(t,e)=>{i.Ba("Gather",t,{axis:Number(e)})},907138:(t,e)=>{i.Ba("GatherElements",t,{axis:Number(e)})},907217:(t,e,r,n,s,o,a,u,l,c,h)=>{i.Ba("Resize",t,{antialias:e,axes:r?Array.from(T.subarray(r>>>0,n>>>0)):[],coordinateTransformMode:K(s),cubicCoeffA:o,excludeOutside:a,extrapolationValue:u,keepAspectRatioPolicy:K(l),mode:K(c),nearestMode:K(h)})},907563:(t,e,r,n,s,o,a)=>{i.Ba("Slice",t,{starts:e?Array.from(T.subarray(e>>>0,r>>>0)):[],ends:n?Array.from(T.subarray(n>>>0,s>>>0)):[],axes:o?Array.from(T.subarray(o>>>0,a>>>0)):[]})},907779:t=>{i.Ba("Tile",t,void 0)},907831:(t,e,r)=>{i.Ba("LayerNormalization",t,{axis:Number(e),epsilon:Number(r)})},907938:(t,e,r)=>{i.Ba("InstanceNormalization",t,{epsilon:e,format:r?"NHWC":"NCHW"})},908052:(t,e,r)=>{i.Ba("InstanceNormalization",t,{epsilon:e,format:r?"NHWC":"NCHW"})},908166:t=>{i.Ba("Range",t,void 0)},908219:(t,e)=>{i.Ba("Einsum",t,{equation:K(e)})},908300:(t,e,r,n,s)=>{i.Ba("Pad",t,{mode:e,value:r,pads:n?Array.from(T.subarray(n>>>0,s>>>0)):[]})},908427:(t,e,r,n,s,o)=>{i.Ba("BatchNormalization",t,{epsilon:e,momentum:r,spatial:!!s,trainingMode:!!n,format:o?"NHWC":"NCHW"})},908596:(t,e,r,n,s,o)=>{i.Ba("BatchNormalization",t,{epsilon:e,momentum:r,spatial:!!s,trainingMode:!!n,format:o?"NHWC":"NCHW"})},908765:(t,e,r)=>{i.Ba("CumSum",t,{exclusive:Number(e),reverse:Number(r)})},908862:(t,e,r,n,s,o,a,u,l)=>{i.Ba("Attention",t,{numHeads:e,isUnidirectional:r,maskFilterValue:n,scale:s,doRotary:o,qkvHiddenSizes:a?Array.from(T.subarray(Number(u)>>>0,Number(u)+a>>>0)):[],pastPresentShareBuffer:!!l})},909134:t=>{i.Ba("Gelu",t,void 0)},909186:(t,e,r,n,s,o)=>{i.Ba("MultiHeadAttention",t,{numHeads:e,isUnidirectional:r,maskFilterValue:n,scale:s,doRotary:o})},909345:t=>{i.Ba("BiasAdd",t,void 0)},909400:t=>{i.Ba("BiasSplitGelu",t,void 0)},909461:(t,e)=>{i.Ba("SkipLayerNormalization",t,{epsilon:e})},909542:(t,e,r,n,s,o,a,u,l,c,h,f,d)=>{i.Ba("Conv",t,{format:l?"NHWC":"NCHW",auto_pad:e,dilations:[r],group:n,kernel_shape:[s],pads:o?Array.from(T.subarray(o>>>0,a>>>0)):[],strides:[u],w_is_const:()=>!!w[c>>>0],activation:K(h),activation_params:f?Array.from(E.subarray(f>>>0,d>>>0)):[]})},909912:(t,e,r,n,s,o,a,u,l,c,h,f,d,p,v,y)=>{i.Ba("Conv",t,{format:f?"NHWC":"NCHW",auto_pad:e,dilations:[r,n],group:s,kernel_shape:[o,a],pads:u?Array.from(T.subarray(u>>>0,l>>>0)):[],strides:[c,h],w_is_const:()=>!!w[d>>>0],activation:K(p),activation_params:v?Array.from(E.subarray(v>>>0,y>>>0)):[]})},910303:t=>{i.ab(t)},910337:(t,e)=>i.cb(t,e,i.Ja.eb,i.Ja.errors)};function V(t){this.name="ExitStatus",this.message=`Program terminated with exit(${t})`,this.status=t}function H(t){this.Na=t-24,this.Ua=function(t){S[this.Na+4>>>2>>>0]=t},this.Ta=function(t){S[this.Na+8>>>2>>>0]=t},this.Ra=function(t,e){this.Sa(),this.Ua(t),this.Ta(e)},this.Sa=function(){S[this.Na+16>>>2>>>0]=0}}var W,q=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Y=(t,e,r)=>{var n=(e>>>=0)+r;for(r=e;t[r]&&!(r>=n);)++r;if(16<r-e&&t.buffer&&q)return q.decode(t.subarray(e,r));for(n="";e<r;){var i=t[e++];if(128&i){var s=63&t[e++];if(192==(224&i))n+=String.fromCharCode((31&i)<<6|s);else{var o=63&t[e++];65536>(i=224==(240&i)?(15&i)<<12|s<<6|o:(7&i)<<18|s<<12|o<<6|63&t[e++])?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else n+=String.fromCharCode(i)}return n},K=(t,e)=>(t>>>=0)?Y(x,t,e):"",X=t=>{for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);127>=n?e++:2047>=n?e+=2:55296<=n&&57343>=n?(e+=4,++r):e+=3}return e},Z=(t,e,r,n)=>{if(!(0<n))return 0;var i=r>>>=0;n=r+n-1;for(var s=0;s<t.length;++s){var o=t.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++s)),127>=o){if(r>=n)break;e[r++>>>0]=o}else{if(2047>=o){if(r+1>=n)break;e[r++>>>0]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;e[r++>>>0]=224|o>>12}else{if(r+3>=n)break;e[r++>>>0]=240|o>>18,e[r++>>>0]=128|o>>12&63}e[r++>>>0]=128|o>>6&63}e[r++>>>0]=128|63&o}}return e[r>>>0]=0,r-i},J=t=>t%4==0&&(t%100!=0||t%400==0),Q=[0,31,60,91,121,152,182,213,244,274,305,335],tt=[0,31,59,90,120,151,181,212,243,273,304,334],et=t=>{var e=X(t)+1,r=It(e);return r&&Z(t,x,r,e),r},rt=[],nt=(t,e)=>{rt.length=0;for(var r;r=x[t++>>>0];){var n=105!=r;e+=(n&=112!=r)&&e%8?4:0,rt.push(112==r?S[e>>>2>>>0]:105==r?T[e>>>2>>>0]:O[e>>>3>>>0]),e+=n?8:4}return rt},it={},st=()=>{if(!W){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(t in it)void 0===it[t]?delete e[t]:e[t]=it[t];var r=[];for(t in e)r.push(`${t}=${e[t]}`);W=r}return W},ot=[null,[],[]],at=t=>(at=(()=>{if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues)return t=>crypto.getRandomValues(t);if(d)try{var t=(tsvb_ua(),tsvb_Rt(tsvb_sa));if(t.randomFillSync)return e=>t.randomFillSync(e);var e=t.randomBytes;return t=>(t.set(e(t.byteLength)),t)}catch{}D("initRandomDevice")})())(t),ut=[31,29,31,30,31,30,31,31,30,31,30,31],lt=[31,28,31,30,31,30,31,31,30,31,30,31];function ct(t,e,r,n){function i(t,e,r){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=r[0]+t;return t}function s(t,e){return i(t,e,"0")}function o(t,e){function r(t){return 0>t?-1:0<t?1:0}var n;return 0===(n=r(t.getFullYear()-e.getFullYear()))&&0===(n=r(t.getMonth()-e.getMonth()))&&(n=r(t.getDate()-e.getDate())),n}function a(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function u(t){var e=t.Ha;for(t=new Date(new Date(t.Ia+1900,0,1).getTime());0<e;){var r=t.getMonth(),n=(J(t.getFullYear())?ut:lt)[r];if(!(e>n-t.getDate())){t.setDate(t.getDate()+e);break}e-=n-t.getDate()+1,t.setDate(1),11>r?t.setMonth(r+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return r=new Date(t.getFullYear()+1,0,4),e=a(new Date(t.getFullYear(),0,4)),r=a(r),0>=o(e,t)?0>=o(r,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}t>>>=0,e>>>=0,r>>>=0;var l=S[40+(n>>>=0)>>>2>>>0];for(var c in n={hb:T[n>>>2>>>0],gb:T[n+4>>>2>>>0],La:T[n+8>>>2>>>0],Pa:T[n+12>>>2>>>0],Ma:T[n+16>>>2>>>0],Ia:T[n+20>>>2>>>0],Ga:T[n+24>>>2>>>0],Ha:T[n+28>>>2>>>0],kb:T[n+32>>>2>>>0],fb:T[n+36>>>2>>>0],ib:l?K(l):""},r=K(r),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})r=r.replace(new RegExp(c,"g"),l[c]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),f="January February March April May June July August September October November December".split(" ");for(c in l={"%a":t=>h[t.Ga].substring(0,3),"%A":t=>h[t.Ga],"%b":t=>f[t.Ma].substring(0,3),"%B":t=>f[t.Ma],"%C":t=>s((t.Ia+1900)/100|0,2),"%d":t=>s(t.Pa,2),"%e":t=>i(t.Pa,2," "),"%g":t=>u(t).toString().substring(2),"%G":t=>u(t),"%H":t=>s(t.La,2),"%I":t=>(0==(t=t.La)?t=12:12<t&&(t-=12),s(t,2)),"%j":t=>{for(var e=0,r=0;r<=t.Ma-1;e+=(J(t.Ia+1900)?ut:lt)[r++]);return s(t.Pa+e,3)},"%m":t=>s(t.Ma+1,2),"%M":t=>s(t.gb,2),"%n":()=>"\n","%p":t=>0<=t.La&&12>t.La?"AM":"PM","%S":t=>s(t.hb,2),"%t":()=>"\t","%u":t=>t.Ga||7,"%U":t=>s(Math.floor((t.Ha+7-t.Ga)/7),2),"%V":t=>{var e=Math.floor((t.Ha+7-(t.Ga+6)%7)/7);if(2>=(t.Ga+371-t.Ha-2)%7&&e++,e)53==e&&(4==(r=(t.Ga+371-t.Ha)%7)||3==r&&J(t.Ia)||(e=1));else{e=52;var r=(t.Ga+7-t.Ha-1)%7;(4==r||5==r&&J(t.Ia%400-1))&&e++}return s(e,2)},"%w":t=>t.Ga,"%W":t=>s(Math.floor((t.Ha+7-(t.Ga+6)%7)/7),2),"%y":t=>(t.Ia+1900).toString().substring(2),"%Y":t=>t.Ia+1900,"%z":t=>(0<=(t=t.fb)?"+":"-")+("0000"+((t=Math.abs(t)/60)/60*100+t%60)).slice(-4),"%Z":t=>t.ib,"%%":()=>"%"},r=r.replace(/%%/g,"\0\0"),l)r.includes(c)&&(r=r.replace(new RegExp(c,"g"),l[c](n)));return c=function(t){var e=Array(X(t)+1);return Z(t,e,0,e.length),e}(r=r.replace(/\0\0/g,"%")),c.length>e?0:(w.set(c,t>>>0),c.length-1)}var ht=t=>{try{t()}catch(t){D(t)}},ft=0,dt=null,pt=0,vt=[],yt={},bt={},_t=0,mt=null,gt=[];function wt(t){if(!P){if(0===ft){var e=!1,r=!1;t(((t=0)=>{if(!P&&(pt=t,e=!0,r)){ft=2,ht((()=>Ft(dt))),typeof Browser<"u"&&Browser.Oa.Va&&Browser.Oa.resume(),t=!1;try{var n=(0,At[bt[T[dt+8>>>2>>>0]]])()}catch(e){n=e,t=!0}var i=!1;if(!dt){var s=mt;s&&(mt=null,(t?s.reject:s.resolve)(n),i=!0)}if(t&&!i)throw n}})),r=!0,e||(ft=1,dt=function(){var t=It(65548),e=t+12;S[t>>>2>>>0]=e,S[t+4>>>2>>>0]=e+65536,e=vt[0];var r=yt[e];return void 0===r&&(r=_t++,yt[e]=r,bt[r]=e),T[t+8>>>2>>>0]=r,t}(),typeof Browser<"u"&&Browser.Oa.Va&&Browser.Oa.pause(),ht((()=>Lt(dt))))}else 2===ft?(ft=0,ht(Ut),Rt(dt),dt=null,gt.forEach((t=>{if(!P)try{t();try{g=g=t=g,i.onExit?.(t),P=!0,c(t,new V(t))}catch(t){t instanceof V||"unwind"==t||c(1,t)}}catch(t){t instanceof V||"unwind"==t||c(1,t)}}))):D(`invalid state: ${ft}`);return pt}}var xt,Tt,St=[],Et=[],Ot=(t,e)=>{if(!Tt){Tt=new WeakMap;var r=xt.length;if(Tt)for(var n=0;n<0+r;n++){var i=n,s=St[i];s||(i>=St.length&&(St.length=i+1),St[i]=s=xt.get(i)),(i=s)&&Tt.set(i,n)}}if(r=Tt.get(t)||0)return r;if(Et.length)r=Et.pop();else{try{xt.grow(1)}catch(t){throw t instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":t}r=xt.length-1}try{n=r,xt.set(n,t),St[n]=xt.get(n)}catch(a){if(!(a instanceof TypeError))throw a;if("function"==typeof WebAssembly.Function){n=WebAssembly.Function,i={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},s={parameters:[],results:"v"==e[0]?[]:[i[e[0]]]};for(var o=1;o<e.length;++o)s.parameters.push(i[e[o]]);e=new n(s,t)}else{for(n=[1],i=e.slice(0,1),e=e.slice(1),s={i:127,p:127,j:126,f:125,d:124,e:111},n.push(96),128>(o=e.length)?n.push(o):n.push(o%128|128,o>>7),o=0;o<e.length;++o)n.push(s[e[o]]);"v"==i?n.push(0):n.push(1,s[i]),e=[0,97,115,109,1,0,0,0,1],128>(i=n.length)?e.push(i):e.push(i%128|128,i>>7),e.push.apply(e,n),e.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),e=new WebAssembly.Module(new Uint8Array(e)),e=new WebAssembly.Instance(e,{e:{f:t}}).exports.f}n=r,xt.set(n,e),St[n]=xt.get(n)}return Tt.set(t,r),r},Pt={n:function(t,e,r){return function(t){return wt((e=>{t().then(e)}))}((async()=>{await i.Za(t,e,r)}))},a:function(t,e,r){throw new H(t>>>=0).Ra(e>>>0,r>>>0),t},g:function(){return 0},M:function(){},C:function(){},E:function(){},v:function(){return 0},K:function(){},F:function(){},J:function(){},m:function(){},D:function(){},A:function(){},L:function(){},B:function(){},N:()=>1,q:function(t,e,r){t=e+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*e:NaN,r>>>=0,t=new Date(1e3*t),T[r>>>2>>>0]=t.getUTCSeconds(),T[r+4>>>2>>>0]=t.getUTCMinutes(),T[r+8>>>2>>>0]=t.getUTCHours(),T[r+12>>>2>>>0]=t.getUTCDate(),T[r+16>>>2>>>0]=t.getUTCMonth(),T[r+20>>>2>>>0]=t.getUTCFullYear()-1900,T[r+24>>>2>>>0]=t.getUTCDay(),T[r+28>>>2>>>0]=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},r:function(t,e,r){t=e+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*e:NaN,r>>>=0,t=new Date(1e3*t),T[r>>>2>>>0]=t.getSeconds(),T[r+4>>>2>>>0]=t.getMinutes(),T[r+8>>>2>>>0]=t.getHours(),T[r+12>>>2>>>0]=t.getDate(),T[r+16>>>2>>>0]=t.getMonth(),T[r+20>>>2>>>0]=t.getFullYear()-1900,T[r+24>>>2>>>0]=t.getDay(),T[r+28>>>2>>>0]=(J(t.getFullYear())?Q:tt)[t.getMonth()]+t.getDate()-1|0,T[r+36>>>2>>>0]=-60*t.getTimezoneOffset(),e=new Date(t.getFullYear(),6,1).getTimezoneOffset();var n=new Date(t.getFullYear(),0,1).getTimezoneOffset();T[r+32>>>2>>>0]=0|(e!=n&&t.getTimezoneOffset()==Math.min(n,e))},s:function(t){t>>>=0;var e=new Date(T[t+20>>>2>>>0]+1900,T[t+16>>>2>>>0],T[t+12>>>2>>>0],T[t+8>>>2>>>0],T[t+4>>>2>>>0],T[t>>>2>>>0],0),r=T[t+32>>>2>>>0],n=e.getTimezoneOffset(),i=new Date(e.getFullYear(),6,1).getTimezoneOffset(),s=new Date(e.getFullYear(),0,1).getTimezoneOffset(),o=Math.min(s,i);return 0>r?T[t+32>>>2>>>0]=+(i!=s&&o==n):0<r!=(o==n)&&(i=Math.max(s,i),e.setTime(e.getTime()+6e4*((0<r?o:i)-n))),T[t+24>>>2>>>0]=e.getDay(),T[t+28>>>2>>>0]=(J(e.getFullYear())?Q:tt)[e.getMonth()]+e.getDate()-1|0,T[t>>>2>>>0]=e.getSeconds(),T[t+4>>>2>>>0]=e.getMinutes(),T[t+8>>>2>>>0]=e.getHours(),T[t+12>>>2>>>0]=e.getDate(),T[t+16>>>2>>>0]=e.getMonth(),T[t+20>>>2>>>0]=e.getYear(),t=e.getTime(),isNaN(t)?(T[kt()>>>2>>>0]=61,t=-1):t/=1e3,$t((z=t,1<=+Math.abs(z)?0<z?+Math.floor(z/4294967296)>>>0:~~+Math.ceil((z-+(~~z>>>0))/4294967296)>>>0:0)),t>>>0},o:function(){return-52},p:function(){},y:function(t,e,r){function n(t){return(t=t.toTimeString().match(/\(([A-Za-z ]+)\)$/))?t[1]:"GMT"}r>>>=0;var i=(new Date).getFullYear(),s=new Date(i,0,1),o=new Date(i,6,1);i=s.getTimezoneOffset();var a=o.getTimezoneOffset();S[t>>>0>>>2>>>0]=60*Math.max(i,a),T[e>>>0>>>2>>>0]=+(i!=a),t=n(s),e=n(o),t=et(t),e=et(e),a<i?(S[r>>>2>>>0]=t,S[r+4>>>2>>>0]=e):(S[r>>>2>>>0]=e,S[r+4>>>2>>>0]=t)},e:()=>{D("")},b:function(t,e,r){return t>>>=0,e=nt(e>>>0,r>>>0),G[t].apply(null,e)},j:function(t,e,r){return t>>>=0,e=nt(e>>>0,r>>>0),G[t].apply(null,e)},h:()=>Date.now(),z:function(){return 4294901760},c:()=>performance.now(),I:function(t,e,r){return e>>>=0,x.copyWithin(t>>>0>>>0,e>>>0,e+(r>>>0)>>>0)},w:function(t){t>>>=0;var e=x.length;if(4294901760<t)return!1;for(var r=1;4>=r;r*=2){var n=e*(1+.2/r);n=Math.min(n,t+100663296);var i=Math;n=Math.max(t,n);t:{i=(i.min.call(i,4294901760,n+(65536-n%65536)%65536)-m.buffer.byteLength+65535)/65536;try{m.grow(i),A();var s=1;break t}catch{}s=void 0}if(s)return!0}return!1},G:function(t,e){t>>>=0,e>>>=0;var r=0;return st().forEach(((n,i)=>{var s=e+r;for(i=S[t+4*i>>>2>>>0]=s,s=0;s<n.length;++s)w[i++>>>0>>>0]=n.charCodeAt(s);w[i>>>0>>>0]=0,r+=n.length+1})),0},H:function(t,e){t>>>=0,e>>>=0;var r=st();S[t>>>2>>>0]=r.length;var n=0;return r.forEach((t=>n+=t.length+1)),S[e>>>2>>>0]=n,0},f:()=>52,l:function(){return 52},t:function(){return 70},k:function(t,e,r,n){e>>>=0,r>>>=0,n>>>=0;for(var i=0,s=0;s<r;s++){var o=S[e>>>2>>>0],a=S[e+4>>>2>>>0];e+=8;for(var u=0;u<a;u++){var l=x[o+u>>>0],c=ot[t];0===l||10===l?((1===t?b:_)(Y(c,0)),c.length=0):c.push(l)}i+=a}return S[n>>>2>>>0]=i,0},u:function(t,e){return t>>>=0,at(x.subarray(t>>>0,t+(e>>>0)>>>0)),0},x:ct,d:function(t,e,r,n){return ct(t>>>0,e>>>0,r>>>0,n>>>0)},i:function(t,e,r,n){let i=xt.length;t=new Uint8Array(x.slice(t+e,t+r));try{var s,o=new WebAssembly.Module(t),a=new WebAssembly.Instance(o,{env:{memory:m}});for(s in a.exports)Ot(a.exports[s]);return i<xt.length?i:n}catch(t){return console.log(t),n}}},At=function(){function t(t){return At=t.exports,At=function(){var t=At,e={};for(let[r,n]of Object.entries(t))e[r]="function"==typeof n?function(){vt.push(r);try{return n.apply(null,arguments)}finally{P||(vt.pop(),dt&&1===ft&&0===vt.length&&(ft=0,ht(Nt),typeof Fibers<"u"&&Fibers.lb()))}}:n;return e}(),At=function(){var t=At;t=Object.assign({},t);var e=t=>()=>t()>>>0,r=t=>e=>t(e)>>>0;return t.ta=e(t.ta),t.ua=r(t.ua),t.ya=e(t.ya),t.Aa=r(t.Aa),t}(),m=At.O,A(),xt=At.wa,k.unshift(At.P),0==--R&&(null!==$&&(clearInterval($),$=null),M&&(t=M,M=null,t())),At}var e={a:Pt};if(R++,i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(t){_(`Module.instantiateWasm callback failed with error: ${t}`),n(t)}return function(t,e){var r=B;return"function"!=typeof WebAssembly.instantiateStreaming||L(r)||N(r)||d||"function"!=typeof fetch?j(r,t,e):fetch(r,{credentials:"same-origin"}).then((n=>WebAssembly.instantiateStreaming(n,t).then(e,(function(n){return _(`wasm streaming compile failed: ${n}`),_("falling back to ArrayBuffer instantiation"),j(r,t,e)}))))}(e,(function(e){t(e.instance)})).catch(n),{}}();i._OrtInit=(t,e)=>(i._OrtInit=At.Q)(t,e),i._OrtGetLastError=(t,e)=>(i._OrtGetLastError=At.R)(t,e),i._OrtCreateSessionOptions=(t,e,r,n,s,o,a,u,l,c)=>(i._OrtCreateSessionOptions=At.S)(t,e,r,n,s,o,a,u,l,c),i._OrtAppendExecutionProvider=(t,e)=>(i._OrtAppendExecutionProvider=At.T)(t,e),i._OrtAddFreeDimensionOverride=(t,e,r)=>(i._OrtAddFreeDimensionOverride=At.U)(t,e,r),i._OrtAddSessionConfigEntry=(t,e,r)=>(i._OrtAddSessionConfigEntry=At.V)(t,e,r),i._OrtReleaseSessionOptions=t=>(i._OrtReleaseSessionOptions=At.W)(t),i._OrtCreateSession=(t,e,r)=>(i._OrtCreateSession=At.X)(t,e,r),i._OrtReleaseSession=t=>(i._OrtReleaseSession=At.Y)(t),i._OrtGetInputOutputCount=(t,e,r)=>(i._OrtGetInputOutputCount=At.Z)(t,e,r),i._OrtGetInputName=(t,e)=>(i._OrtGetInputName=At._)(t,e),i._OrtGetOutputName=(t,e)=>(i._OrtGetOutputName=At.$)(t,e),i._OrtFree=t=>(i._OrtFree=At.aa)(t),i._OrtCreateTensor=(t,e,r,n,s,o)=>(i._OrtCreateTensor=At.ba)(t,e,r,n,s,o),i._OrtGetTensorData=(t,e,r,n,s)=>(i._OrtGetTensorData=At.ca)(t,e,r,n,s),i._OrtReleaseTensor=t=>(i._OrtReleaseTensor=At.da)(t),i._OrtCreateRunOptions=(t,e,r,n)=>(i._OrtCreateRunOptions=At.ea)(t,e,r,n),i._OrtAddRunConfigEntry=(t,e,r)=>(i._OrtAddRunConfigEntry=At.fa)(t,e,r),i._OrtReleaseRunOptions=t=>(i._OrtReleaseRunOptions=At.ga)(t),i._OrtCreateBinding=t=>(i._OrtCreateBinding=At.ha)(t),i._OrtBindInput=(t,e,r)=>(i._OrtBindInput=At.ia)(t,e,r),i._OrtBindOutput=(t,e,r,n)=>(i._OrtBindOutput=At.ja)(t,e,r,n),i._OrtClearBoundOutputs=t=>(i._OrtClearBoundOutputs=At.ka)(t),i._OrtReleaseBinding=t=>(i._OrtReleaseBinding=At.la)(t),i._OrtRunWithBinding=(t,e,r,n,s)=>(i._OrtRunWithBinding=At.ma)(t,e,r,n,s),i._OrtRun=(t,e,r,n,s,o,a,u)=>(i._OrtRun=At.na)(t,e,r,n,s,o,a,u),i._OrtEndProfiling=t=>(i._OrtEndProfiling=At.oa)(t),i._OrtConfigure=(t,e)=>(i._OrtConfigure=At.pa)(t,e),i._OrtAuth=(t,e)=>(i._OrtAuth=At.qa)(t,e),i._JsepOutput=(t,e,r)=>(i._JsepOutput=At.ra)(t,e,r),i._JsepGetNodeName=t=>(i._JsepGetNodeName=At.sa)(t);var Ct,kt=()=>(kt=At.ta)(),It=i._malloc=t=>(It=i._malloc=At.ua)(t),Rt=i._free=t=>(Rt=i._free=At.va)(t),$t=t=>($t=At.xa)(t),Mt=()=>(Mt=At.ya)(),Dt=t=>(Dt=At.za)(t),Bt=t=>(Bt=At.Aa)(t),Lt=t=>(Lt=At.Ca)(t),Nt=()=>(Nt=At.Da)(),Ft=t=>(Ft=At.Ea)(t),Ut=()=>(Ut=At.Fa)();function jt(){if(!(0<R)){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;){var t=i.preRun.shift();C.unshift(t)}for(;0<C.length;)C.shift()(i);if(!(0<R||Ct||(Ct=!0,i.calledRun=!0,P))){for(;0<k.length;)k.shift()(i);for(e(i);0<I.length;)I.shift()(i)}}}return i.___start_em_js=910449,i.___stop_em_js=911222,i.stackAlloc=Bt,i.stackSave=Mt,i.stackRestore=Dt,i.addFunction=Ot,i.UTF8ToString=K,i.stringToUTF8=(t,e,r)=>Z(t,x,e,r),i.lengthBytesUTF8=X,M=function t(){Ct||jt(),Ct||(M=t)},jt(),t.ready});"object"==typeof t&&"object"==typeof e?e.exports=n:"function"==typeof define&&define.amd&&define([],(()=>n))})),tsvb_Vi=tsvb_cr((()=>{})),tsvb_Gi=tsvb_cr((()=>{})),tsvb_Li={};tsvb_Kt(tsvb_Li,{cpus:()=>tsvb_gd});var tsvb_gd,tsvb_Hi=tsvb_q((()=>{tsvb_gd=void 0})),tsvb_ji=tsvb_cr(((t,e)=>{var r,n=(r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0,typeof __filename<"u"&&(r=r||__filename),function(t={}){function e(){return C.buffer!=R.buffer&&F(),R}function n(){return C.buffer!=R.buffer&&F(),$}function i(){return C.buffer!=R.buffer&&F(),M}function s(){return C.buffer!=R.buffer&&F(),D}function o(){return C.buffer!=R.buffer&&F(),B}function a(){return C.buffer!=R.buffer&&F(),L}var u,l,c=t;c.ready=new Promise(((t,e)=>{u=t,l=e})),c.mountExternalData=(t,e)=>{(c.ib||(c.ib=new Map)).set(t,e)},c.unmountExternalData=()=>{delete c.ib},c.jsepInit=(t,e,r,n,i,s,o,a,u,l,h)=>{c.Ub=t,c.Bb=e,c.Fb=r,c.pb=n,c.Eb=i,c.Ua=s,c.Gb=o,c.Ib=a,c.Cb=u,c.Db=l,c.Hb=h,e=(t,e,r)=>(...n)=>{let i=he,s=e?.();n=t(...n);let o=e?.();return s!==o&&(t=o,r(s),e=r=null),he!=i?new Promise(((t,e)=>{be={resolve:t,reject:e}})):n},r=e=>async(...r)=>{try{if(c.hb)throw Error("Session already started");let n=c.hb={Kb:r[0],errors:[]},i=await e(...r);if(c.hb!==n)throw Error("Session mismatch");t.flush();let s=n.errors;if(0<s.length){let t=await Promise.all(s);if(t=t.filter((t=>t)),0<t.length)throw Error(t.join("\n"))}return i}finally{c.hb=null}},c._OrtRun=r(e(c._OrtRun,(()=>c._OrtRun),(t=>c._OrtRun=t))),c._OrtRunWithBinding=r(e(c._OrtRunWithBinding,(()=>c._OrtRunWithBinding),(t=>c._OrtRunWithBinding=t))),c._OrtBindInput=e(c._OrtBindInput,(()=>c._OrtBindInput),(t=>c._OrtBindInput=t)),c.jsepRegisterBuffer=(e,r,n,i)=>t.registerBuffer(e,r,n,i),c.jsepGetBuffer=e=>t.getBuffer(e),c.jsepCreateDownloader=(e,r,n)=>t.createDownloader(e,r,n),c.jsepOnReleaseSession=e=>{t.onReleaseSession(e)},c.jsepOnRunStart=e=>t.onRunStart(e)};var h,f,d,p=Object.assign({},c),v="./this.program",y=(t,e)=>{throw e},b="object"==typeof window,_="function"==typeof importScripts,m="object"==typeof tsvb_process&&"object"==typeof tsvb_process.versions&&"string"==typeof tsvb_process.versions.node,g=c.ENVIRONMENT_IS_PTHREAD||!1,w="";function x(t){return c.locateFile?c.locateFile(t,w):w+t}if(m){var T=(tsvb_aa(),tsvb_Rt(tsvb_na)),S=(tsvb_oa(),tsvb_Rt(tsvb_ia));let t;w=_?S.dirname(w)+"/":__dirname+"/",h=(t,e)=>(t=Z(t)?new URL(t):S.normalize(t),T.readFileSync(t,e?void 0:"utf8")),d=t=>((t=h(t,!0)).buffer||(t=new Uint8Array(t)),t),f=(t,e,r,n=!0)=>{t=Z(t)?new URL(t):S.normalize(t),T.readFile(t,n?void 0:"utf8",((t,i)=>{t?r(t):e(n?i.buffer:i)}))},!c.thisProgram&&1<tsvb_process.argv.length&&(v=tsvb_process.argv[1].replace(/\\/g,"/")),tsvb_process.argv.slice(2),y=(t,e)=>{throw tsvb_process.exitCode=t,e},c.inspect=()=>"[Emscripten Module object]";try{t=tsvb_Vi()}catch(t){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),t}global.Worker=t.Worker}else(b||_)&&(_?w=self.location.href:typeof document<"u"&&document.currentScript&&(w=document.currentScript.src),typeof r<"u"&&r&&(w=r),w=0!==w.indexOf("blob:")?w.substr(0,w.replace(/[?#].*/,"").lastIndexOf("/")+1):"",m||(h=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},_&&(d=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),f=(t,e,r)=>{var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?e(n.response):r()},n.onerror=r,n.send(null)}));m&&typeof performance>"u"&&(global.performance=tsvb_Gi().performance);var E=console.log.bind(console),O=console.error.bind(console);m&&(E=(...t)=>T.writeSync(1,t.join(" ")+"\n"),O=(...t)=>T.writeSync(2,t.join(" ")+"\n"));var P=E,A=O;Object.assign(c,p),p=null,"object"!=typeof WebAssembly&&Y("no native wasm support detected");var C,k,I,R,$,M,D,B,L,N=!1;function F(){var t=C.buffer;c.HEAP8=R=new Int8Array(t),c.HEAP16=new Int16Array(t),c.HEAPU8=$=new Uint8Array(t),c.HEAPU16=new Uint16Array(t),c.HEAP32=M=new Int32Array(t),c.HEAPU32=D=new Uint32Array(t),c.HEAPF32=B=new Float32Array(t),c.HEAPF64=L=new Float64Array(t)}var U=16777216;if(g)C=c.wasmMemory;else if(c.wasmMemory)C=c.wasmMemory;else if(!((C=new WebAssembly.Memory({initial:U/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw A("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),m&&A("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");F(),U=C.buffer.byteLength;var j=[],z=[],G=[],V=0,H=null,W=null;function q(){if(0==--V&&(null!==H&&(clearInterval(H),H=null),W)){var t=W;W=null,t()}}function Y(t){throw A(t="Aborted("+t+")"),N=!0,I=1,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),l(t),t}var K,X=t=>t.startsWith("data:application/octet-stream;base64,"),Z=t=>t.startsWith("file://");function J(t){if(d)return d(t);throw"both async and sync fetching of the wasm failed"}function Q(t,e,r){return function(t){if(b||_){if("function"==typeof fetch&&!Z(t))return fetch(t,{credentials:"same-origin"}).then((e=>{if(!e.ok)throw"failed to load wasm binary file at '"+t+"'";return e.arrayBuffer()})).catch((()=>J(t)));if(f)return new Promise(((e,r)=>{f(t,(t=>e(new Uint8Array(t))),r)}))}return Promise.resolve().then((()=>J(t)))}(t).then((t=>WebAssembly.instantiate(t,e))).then((t=>t)).then(r,(t=>{A(`failed to asynchronously prepare wasm: ${t}`),Y(t)}))}X(K="ort-wasm-simd-threaded.wasm")||(K=x(K));var tt,et={902852:(t,e,r,i)=>{if(typeof c>"u"||!c.ib)return 1;if((t=ut(t>>>0)).startsWith("./")&&(t=t.substring(2)),!(t=c.ib.get(t)))return 2;if(i>>>=0,(e>>>=0)+(r>>>=0)>t.byteLength)return 3;try{return n().set(t.subarray(e,e+r),i>>>0),0}catch{return 4}},903353:()=>{c.Cb()},903384:()=>{c.Db()},903413:()=>{c.Hb()},903438:t=>c.Bb(t),903471:t=>c.Fb(t),903503:(t,e,r)=>{c.pb(t,e,r,!0)},903542:(t,e,r)=>{c.pb(t,e,r)},903575:t=>{c.Ua("Abs",t,void 0)},903626:t=>{c.Ua("Neg",t,void 0)},903677:t=>{c.Ua("Floor",t,void 0)},903730:t=>{c.Ua("Ceil",t,void 0)},903782:t=>{c.Ua("Reciprocal",t,void 0)},903840:t=>{c.Ua("Sqrt",t,void 0)},903892:t=>{c.Ua("Exp",t,void 0)},903943:t=>{c.Ua("Erf",t,void 0)},903994:t=>{c.Ua("Sigmoid",t,void 0)},904049:t=>{c.Ua("Log",t,void 0)},904100:t=>{c.Ua("Sin",t,void 0)},904151:t=>{c.Ua("Cos",t,void 0)},904202:t=>{c.Ua("Tan",t,void 0)},904253:t=>{c.Ua("Asin",t,void 0)},904305:t=>{c.Ua("Acos",t,void 0)},904357:t=>{c.Ua("Atan",t,void 0)},904409:t=>{c.Ua("Sinh",t,void 0)},904461:t=>{c.Ua("Cosh",t,void 0)},904513:t=>{c.Ua("Asinh",t,void 0)},904566:t=>{c.Ua("Acosh",t,void 0)},904619:t=>{c.Ua("Atanh",t,void 0)},904672:t=>{c.Ua("Tanh",t,void 0)},904724:t=>{c.Ua("Not",t,void 0)},904775:(t,e,r)=>{c.Ua("Clip",t,{min:e,max:r})},904844:t=>{c.Ua("Clip",t,void 0)},904896:(t,e)=>{c.Ua("Elu",t,{alpha:e})},904954:t=>{c.Ua("Relu",t,void 0)},905006:(t,e)=>{c.Ua("LeakyRelu",t,{alpha:e})},905070:(t,e)=>{c.Ua("ThresholdedRelu",t,{alpha:e})},905140:(t,e)=>{c.Ua("Cast",t,{to:e})},905198:t=>{c.Ua("Add",t,void 0)},905249:t=>{c.Ua("Sub",t,void 0)},905300:t=>{c.Ua("Mul",t,void 0)},905351:t=>{c.Ua("Div",t,void 0)},905402:t=>{c.Ua("Pow",t,void 0)},905453:t=>{c.Ua("Equal",t,void 0)},905506:t=>{c.Ua("Greater",t,void 0)},905561:t=>{c.Ua("GreaterOrEqual",t,void 0)},905623:t=>{c.Ua("Less",t,void 0)},905675:t=>{c.Ua("LessOrEqual",t,void 0)},905734:(t,e,r,n,s)=>{c.Ua("ReduceMean",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},905893:(t,e,r,n,s)=>{c.Ua("ReduceMax",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},906051:(t,e,r,n,s)=>{c.Ua("ReduceMin",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},906209:(t,e,r,n,s)=>{c.Ua("ReduceProd",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},906368:(t,e,r,n,s)=>{c.Ua("ReduceSum",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},906526:(t,e,r,n,s)=>{c.Ua("ReduceL1",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},906683:(t,e,r,n,s)=>{c.Ua("ReduceL2",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},906840:(t,e,r,n,s)=>{c.Ua("ReduceLogSum",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},907001:(t,e,r,n,s)=>{c.Ua("ReduceSumSquare",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},907165:(t,e,r,n,s)=>{c.Ua("ReduceLogSumExp",t,{keepDims:!!e,noopWithEmptyAxes:!!r,axes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},907329:t=>{c.Ua("Where",t,void 0)},907382:(t,e,r)=>{c.Ua("Transpose",t,{perm:e?Array.from(i().subarray(e>>>0,r>>>0)):[]})},907490:(t,r,n,s,o,a,u,l,h,f,d,p,v,y,b)=>{c.Ua("ConvTranspose",t,{format:h?"NHWC":"NCHW",autoPad:r,dilations:[n],group:s,kernel_shape:[o],pads:[a,u],strides:[l],wIsConst:()=>!!e()[f>>>0],outputPadding:d?Array.from(i().subarray(d>>>0,p>>>0)):[],outputShape:v?Array.from(i().subarray(v>>>0,y>>>0)):[],activation:ut(b)})},907892:(t,r,n,s,o,a,u,l,h,f,d,p,v,y)=>{c.Ua("ConvTranspose",t,{format:l?"NHWC":"NCHW",autoPad:r,dilations:Array.from(i().subarray(n>>>0,2+(n>>>0)>>>0)),group:s,kernelShape:Array.from(i().subarray(o>>>0,2+(o>>>0)>>>0)),pads:Array.from(i().subarray(a>>>0,4+(a>>>0)>>>0)),strides:Array.from(i().subarray(u>>>0,2+(u>>>0)>>>0)),wIsConst:()=>!!e()[h>>>0],outputPadding:f?Array.from(i().subarray(f>>>0,d>>>0)):[],outputShape:p?Array.from(i().subarray(p>>>0,v>>>0)):[],activation:ut(y)})},908457:(t,r,n,s,o,a,u,l,h,f,d,p,v,y,b)=>{c.Ua("ConvTranspose",t,{format:h?"NHWC":"NCHW",autoPad:r,dilations:[n],group:s,kernel_shape:[o],pads:[a,u],strides:[l],wIsConst:()=>!!e()[f>>>0],outputPadding:d?Array.from(i().subarray(d>>>0,p>>>0)):[],outputShape:v?Array.from(i().subarray(v>>>0,y>>>0)):[],activation:ut(b)})},908859:(t,r,n,s,o,a,u,l,h,f,d,p,v,y)=>{c.Ua("ConvTranspose",t,{format:l?"NHWC":"NCHW",autoPad:r,dilations:Array.from(i().subarray(n>>>0,2+(n>>>0)>>>0)),group:s,kernelShape:Array.from(i().subarray(o>>>0,2+(o>>>0)>>>0)),pads:Array.from(i().subarray(a>>>0,4+(a>>>0)>>>0)),strides:Array.from(i().subarray(u>>>0,2+(u>>>0)>>>0)),wIsConst:()=>!!e()[h>>>0],outputPadding:f?Array.from(i().subarray(f>>>0,d>>>0)):[],outputShape:p?Array.from(i().subarray(p>>>0,v>>>0)):[],activation:ut(y)})},909424:(t,e)=>{c.Ua("GlobalAveragePool",t,{format:e?"NHWC":"NCHW"})},909515:(t,e,r,n,i,s,o,a,u,l,h,f,d,p,v,y)=>{c.Ua("AveragePool",t,{format:y?"NHWC":"NCHW",auto_pad:e,ceil_mode:r,count_include_pad:n,storage_order:i,dilations:[s,o],kernel_shape:[a,u],pads:[l,h,f,d],strides:[p,v]})},909799:(t,e)=>{c.Ua("GlobalAveragePool",t,{format:e?"NHWC":"NCHW"})},909890:(t,e,r,n,i,s,o,a,u,l,h,f,d,p,v,y)=>{c.Ua("AveragePool",t,{format:y?"NHWC":"NCHW",auto_pad:e,ceil_mode:r,count_include_pad:n,storage_order:i,dilations:[s,o],kernel_shape:[a,u],pads:[l,h,f,d],strides:[p,v]})},910174:(t,e)=>{c.Ua("GlobalMaxPool",t,{format:e?"NHWC":"NCHW"})},910261:(t,e,r,n,i,s,o,a,u,l,h,f,d,p,v,y)=>{c.Ua("MaxPool",t,{format:y?"NHWC":"NCHW",auto_pad:e,ceil_mode:r,count_include_pad:n,storage_order:i,dilations:[s,o],kernel_shape:[a,u],pads:[l,h,f,d],strides:[p,v]})},910541:(t,e)=>{c.Ua("GlobalMaxPool",t,{format:e?"NHWC":"NCHW"})},910628:(t,e,r,n,i,s,o,a,u,l,h,f,d,p,v,y)=>{c.Ua("MaxPool",t,{format:y?"NHWC":"NCHW",auto_pad:e,ceil_mode:r,count_include_pad:n,storage_order:i,dilations:[s,o],kernel_shape:[a,u],pads:[l,h,f,d],strides:[p,v]})},910908:(t,e,r,n,i)=>{c.Ua("Gemm",t,{alpha:e,beta:r,transA:n,transB:i})},911012:t=>{c.Ua("MatMul",t,void 0)},911066:(t,e,r,n)=>{c.Ua("ArgMax",t,{keepDims:!!e,selectLastIndex:!!r,axis:n})},911174:(t,e,r,n)=>{c.Ua("ArgMin",t,{keepDims:!!e,selectLastIndex:!!r,axis:n})},911282:(t,e)=>{c.Ua("Softmax",t,{axis:e})},911345:(t,e)=>{c.Ua("Concat",t,{axis:e})},911405:(t,e,r,n,s)=>{c.Ua("Split",t,{axis:e,numOutputs:r,splitSizes:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},911545:t=>{c.Ua("Expand",t,void 0)},911599:(t,e)=>{c.Ua("Gather",t,{axis:Number(e)})},911670:(t,e)=>{c.Ua("GatherElements",t,{axis:Number(e)})},911749:(t,e,r,n,s,o,a,u,l,h,f)=>{c.Ua("Resize",t,{antialias:e,axes:r?Array.from(i().subarray(r>>>0,n>>>0)):[],coordinateTransformMode:ut(s),cubicCoeffA:o,excludeOutside:a,extrapolationValue:u,keepAspectRatioPolicy:ut(l),mode:ut(h),nearestMode:ut(f)})},912095:(t,e,r,n,s,o,a)=>{c.Ua("Slice",t,{starts:e?Array.from(i().subarray(e>>>0,r>>>0)):[],ends:n?Array.from(i().subarray(n>>>0,s>>>0)):[],axes:o?Array.from(i().subarray(o>>>0,a>>>0)):[]})},912311:t=>{c.Ua("Tile",t,void 0)},912363:(t,e,r)=>{c.Ua("LayerNormalization",t,{axis:Number(e),epsilon:Number(r)})},912470:(t,e,r)=>{c.Ua("InstanceNormalization",t,{epsilon:e,format:r?"NHWC":"NCHW"})},912584:(t,e,r)=>{c.Ua("InstanceNormalization",t,{epsilon:e,format:r?"NHWC":"NCHW"})},912698:t=>{c.Ua("Range",t,void 0)},912751:(t,e)=>{c.Ua("Einsum",t,{equation:ut(e)})},912832:(t,e,r,n,s)=>{c.Ua("Pad",t,{mode:e,value:r,pads:n?Array.from(i().subarray(n>>>0,s>>>0)):[]})},912959:(t,e,r,n,i,s)=>{c.Ua("BatchNormalization",t,{epsilon:e,momentum:r,spatial:!!i,trainingMode:!!n,format:s?"NHWC":"NCHW"})},913128:(t,e,r,n,i,s)=>{c.Ua("BatchNormalization",t,{epsilon:e,momentum:r,spatial:!!i,trainingMode:!!n,format:s?"NHWC":"NCHW"})},913297:(t,e,r)=>{c.Ua("CumSum",t,{exclusive:Number(e),reverse:Number(r)})},913394:(t,e,r,n,s,o,a,u,l)=>{c.Ua("Attention",t,{numHeads:e,isUnidirectional:r,maskFilterValue:n,scale:s,doRotary:o,qkvHiddenSizes:a?Array.from(i().subarray(Number(u)>>>0,Number(u)+a>>>0)):[],pastPresentShareBuffer:!!l})},913666:t=>{c.Ua("Gelu",t,void 0)},913718:(t,e,r,n,i,s)=>{c.Ua("MultiHeadAttention",t,{numHeads:e,isUnidirectional:r,maskFilterValue:n,scale:i,doRotary:s})},913877:t=>{c.Ua("BiasAdd",t,void 0)},913932:t=>{c.Ua("BiasSplitGelu",t,void 0)},913993:(t,e)=>{c.Ua("SkipLayerNormalization",t,{epsilon:e})},914074:(t,r,n,s,a,u,l,h,f,d,p,v,y)=>{c.Ua("Conv",t,{format:f?"NHWC":"NCHW",auto_pad:r,dilations:[n],group:s,kernel_shape:[a],pads:u?Array.from(i().subarray(u>>>0,l>>>0)):[],strides:[h],w_is_const:()=>!!e()[d>>>0],activation:ut(p),activation_params:v?Array.from(o().subarray(v>>>0,y>>>0)):[]})},914444:(t,r,n,s,a,u,l,h,f,d,p,v,y,b,_,m)=>{c.Ua("Conv",t,{format:v?"NHWC":"NCHW",auto_pad:r,dilations:[n,s],group:a,kernel_shape:[u,l],pads:h?Array.from(i().subarray(h>>>0,f>>>0)):[],strides:[d,p],w_is_const:()=>!!e()[y>>>0],activation:ut(b),activation_params:_?Array.from(o().subarray(_>>>0,m>>>0)):[]})},914835:t=>{c.Gb(t)},914869:(t,e)=>c.Ib(t,e,c.hb.Kb,c.hb.errors)};function rt(t){this.name="ExitStatus",this.message=`Program terminated with exit(${t})`,this.status=t}var nt=t=>{t.terminate(),t.onmessage=()=>{}},it=t=>{0==vt.cb.length&&(pt(),vt.qb(vt.cb[0]));var e=vt.cb.pop();if(!e)return 6;vt.eb.push(e),vt.$a[t.bb]=e,e.bb=t.bb;var r={cmd:"run",start_routine:t.Lb,arg:t.xb,pthread_ptr:t.bb};return m&&e.unref(),e.postMessage(r,t.Rb),0},st=0,ot=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,at=(t,e,r)=>{var n=(e>>>=0)+r;for(r=e;t[r]&&!(r>=n);)++r;if(16<r-e&&t.buffer&&ot)return ot.decode(t.buffer instanceof SharedArrayBuffer?t.slice(e,r):t.subarray(e,r));for(n="";e<r;){var i=t[e++];if(128&i){var s=63&t[e++];if(192==(224&i))n+=String.fromCharCode((31&i)<<6|s);else{var o=63&t[e++];65536>(i=224==(240&i)?(15&i)<<12|s<<6|o:(7&i)<<18|s<<12|o<<6|63&t[e++])?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else n+=String.fromCharCode(i)}return n},ut=(t,e)=>(t>>>=0)?at(n(),t,e):"";function lt(t,e){var r=arguments.length-2,n=arguments;return(t=>{var e=Ue();return t=t(),je(e),t})((()=>{for(var i=ze(8*r),s=i>>>3,o=0;o<r;o++){var u=n[2+o];a()[s+o>>>0]=u}return Me(t,r,i,e)}))}function ct(t){if(g)return lt(0,1,t);I=t,0<st||(vt.Mb(),c.onExit?.(t),N=!0),y(t,new rt(t))}var ht=t=>{if(I=t,g)throw bt(t),"unwind";ct(t)},ft=t=>{t instanceof rt||"unwind"==t||y(1,t)};function dt(){for(var t=c.numThreads;t--;)pt();j.unshift((()=>{V++,function(t){g?t():Promise.all(vt.cb.map(vt.qb)).then(t)}((()=>q()))}))}function pt(){var t=x("ort-wasm-simd-threaded.worker.js");t=new Worker(t),vt.cb.push(t)}var vt={cb:[],eb:[],ub:[],$a:{},mb(){g?(vt.receiveObjectTransfer=vt.Jb,vt.threadInitTLS=vt.tb,vt.setExitStatus=vt.sb):dt()},sb:t=>I=t,Vb:["$terminateWorker"],Mb:()=>{for(var t of vt.eb)nt(t);for(t of vt.cb)nt(t);vt.cb=[],vt.eb=[],vt.$a=[]},rb:t=>{var e=t.bb;delete vt.$a[e],vt.cb.push(t),vt.eb.splice(vt.eb.indexOf(t),1),t.bb=0,De(e)},Jb(){},tb(){vt.ub.forEach((t=>t()))},qb:t=>new Promise((e=>{t.onmessage=r=>{var n=(r=r.data).cmd;if(r.targetThread&&r.targetThread!=Ce()){var i=vt.$a[r.targetThread];i?i.postMessage(r,r.transferList):A(`Internal error! Worker sent a message "${n}" to target pthread ${r.targetThread}, but that thread no longer exists!`)}else"checkMailbox"===n?Ft():"spawnThread"===n?it(r):"cleanupThread"===n?vt.rb(vt.$a[r.thread]):"killThread"===n?(r=r.thread,n=vt.$a[r],delete vt.$a[r],nt(n),De(r),vt.eb.splice(vt.eb.indexOf(n),1),n.bb=0):"cancelThread"===n?vt.$a[r.thread].postMessage({cmd:"cancel"}):"loaded"===n?(t.loaded=!0,m&&!t.bb&&t.unref(),e(t)):"alert"===n?alert(`Thread ${r.threadId}: ${r.text}`):"setimmediate"===r.target?t.postMessage(r):"callHandler"===n?c[r.handler](...r.args):n&&A(`worker sent an unknown command ${n}`)},t.onerror=t=>{throw A(`worker sent an error! ${t.filename}:${t.lineno}: ${t.message}`),t},m&&(t.on("message",(e=>t.onmessage({data:e}))),t.on("error",(e=>t.onerror(e))));var n,i=[];for(n of["onExit"])c.hasOwnProperty(n)&&i.push(n);t.postMessage({cmd:"load",handlers:i,urlOrBlob:c.mainScriptUrlOrBlob||r,wasmMemory:C,wasmModule:k})}))};c.PThread=vt;var yt=t=>{for(;0<t.length;)t.shift()(c)};function bt(t){if(g)return lt(1,0,t);ht(t)}function _t(t){this.lb=t-24,this.yb=function(t){s()[this.lb+4>>>2>>>0]=t},this.wb=function(t){s()[this.lb+8>>>2>>>0]=t},this.mb=function(t,e){this.vb(),this.yb(t),this.wb(e)},this.vb=function(){s()[this.lb+16>>>2>>>0]=0}}function mt(t,e,r,n){return g?lt(2,1,t,e,r,n):gt(t,e,r,n)}function gt(t,e,r,n){if(t>>>=0,e>>>=0,r>>>=0,n>>>=0,typeof SharedArrayBuffer>"u")return A("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var i=[];return g&&0===i.length?mt(t,e,r,n):(t={Lb:r,bb:t,xb:n,Rb:i},g?(t.Tb="spawnThread",postMessage(t,i),0):it(t))}function wt(t,e,r){return g?lt(3,1,t,e,r):0}function xt(t,e){if(g)return lt(4,1,t,e)}c.establishStackSpace=()=>{var t=Ce(),e=s()[t+52>>>2>>>0];t=s()[t+56>>>2>>>0],Fe(e,e-t),je(e)},c.invokeEntryPoint=(t,e)=>{t=Ge.apply(null,[t,e]),0<st?vt.sb(t):Be(t)};var Tt=t=>{for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);127>=n?e++:2047>=n?e+=2:55296<=n&&57343>=n?(e+=4,++r):e+=3}return e},St=(t,e,r,n)=>{if(!(0<n))return 0;var i=r>>>=0;n=r+n-1;for(var s=0;s<t.length;++s){var o=t.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++s)),127>=o){if(r>=n)break;e[r++>>>0]=o}else{if(2047>=o){if(r+1>=n)break;e[r++>>>0]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;e[r++>>>0]=224|o>>12}else{if(r+3>=n)break;e[r++>>>0]=240|o>>18,e[r++>>>0]=128|o>>12&63}e[r++>>>0]=128|o>>6&63}e[r++>>>0]=128|63&o}}return e[r>>>0]=0,r-i},Et=(t,e,r)=>St(t,n(),e,r);function Ot(t,e){if(g)return lt(5,1,t,e)}function Pt(t,e,r){if(g)return lt(6,1,t,e,r)}function At(t,e,r){return g?lt(7,1,t,e,r):0}function Ct(t,e){if(g)return lt(8,1,t,e)}function kt(t,e,r){if(g)return lt(9,1,t,e,r)}function It(t,e,r,n){if(g)return lt(10,1,t,e,r,n)}function Rt(t,e,r,n){if(g)return lt(11,1,t,e,r,n)}function $t(t,e,r,n){if(g)return lt(12,1,t,e,r,n)}function Mt(t){if(g)return lt(13,1,t)}function Dt(t,e){if(g)return lt(14,1,t,e)}function Bt(t,e,r){if(g)return lt(15,1,t,e,r)}var Lt=()=>{if(!(0<st))try{g?Be(I):ht(I)}catch(t){ft(t)}};function Nt(t){t>>>=0,"function"==typeof Atomics.Sb&&(Atomics.Sb(i(),t>>>2,t).value.then(Ft),t+=128,Atomics.store(i(),t>>>2,1))}c.__emscripten_thread_mailbox_await=Nt;var Ft=()=>{var t=Ce();if(t&&(Nt(t),!N))try{Le(),Lt()}catch(t){ft(t)}};c.checkMailbox=Ft;var Ut=[],jt=t=>t%4==0&&(t%100!=0||t%400==0),zt=[0,31,60,91,121,152,182,213,244,274,305,335],Gt=[0,31,59,90,120,151,181,212,243,273,304,334];function Vt(t,e,r,n,i,s,o,a){return g?lt(16,1,t,e,r,n,i,s,o,a):-52}function Ht(t,e,r,n,i,s,o){if(g)return lt(17,1,t,e,r,n,i,s,o)}var Wt,qt=t=>{var e=Tt(t)+1,r=ke(e);return r&&Et(t,r,e),r},Yt=[],Kt=(t,e)=>{Yt.length=0;for(var r;r=n()[t++>>>0];){var o=105!=r;e+=(o&=112!=r)&&e%8?4:0,Yt.push(112==r?s()[e>>>2>>>0]:105==r?i()[e>>>2>>>0]:a()[e>>>3>>>0]),e+=o?8:4}return Yt},Xt={},Zt=()=>{if(!Wt){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:v||"./this.program"};for(t in Xt)void 0===Xt[t]?delete e[t]:e[t]=Xt[t];var r=[];for(t in e)r.push(`${t}=${e[t]}`);Wt=r}return Wt};function Jt(t,r){if(g)return lt(18,1,t,r);t>>>=0,r>>>=0;var n=0;return Zt().forEach(((i,o)=>{var a=r+n;for(o=s()[t+4*o>>>2>>>0]=a,a=0;a<i.length;++a)e()[o++>>>0>>>0]=i.charCodeAt(a);e()[o>>>0>>>0]=0,n+=i.length+1})),0}function Qt(t,e){if(g)return lt(19,1,t,e);t>>>=0,e>>>=0;var r=Zt();s()[t>>>2>>>0]=r.length;var n=0;return r.forEach((t=>n+=t.length+1)),s()[e>>>2>>>0]=n,0}function te(t){return g?lt(20,1,t):52}function ee(t,e,r,n){return g?lt(21,1,t,e,r,n):52}function re(t,e,r,n,i){return g?lt(22,1,t,e,r,n,i):70}var ne=[null,[],[]];function ie(t,e,r,i){if(g)return lt(23,1,t,e,r,i);e>>>=0,r>>>=0,i>>>=0;for(var o=0,a=0;a<r;a++){var u=s()[e>>>2>>>0],l=s()[e+4>>>2>>>0];e+=8;for(var c=0;c<l;c++){var h=n()[u+c>>>0],f=ne[t];0===h||10===h?((1===t?P:A)(at(f,0)),f.length=0):f.push(h)}o+=l}return s()[i>>>2>>>0]=o,0}var se=t=>(se=(()=>{if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues)return t=>(t.set(crypto.getRandomValues(new Uint8Array(t.byteLength))),t);if(m)try{var t=(tsvb_ua(),tsvb_Rt(tsvb_sa));if(t.randomFillSync)return e=>t.randomFillSync(e);var e=t.randomBytes;return t=>(t.set(e(t.byteLength)),t)}catch{}Y("initRandomDevice")})())(t),oe=[31,29,31,30,31,30,31,31,30,31,30,31],ae=[31,28,31,30,31,30,31,31,30,31,30,31];function ue(t,r,n,o){function a(t,e,r){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=r[0]+t;return t}function u(t,e){return a(t,e,"0")}function l(t,e){function r(t){return 0>t?-1:0<t?1:0}var n;return 0===(n=r(t.getFullYear()-e.getFullYear()))&&0===(n=r(t.getMonth()-e.getMonth()))&&(n=r(t.getDate()-e.getDate())),n}function c(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function h(t){var e=t.fb;for(t=new Date(new Date(t.gb+1900,0,1).getTime());0<e;){var r=t.getMonth(),n=(jt(t.getFullYear())?oe:ae)[r];if(!(e>n-t.getDate())){t.setDate(t.getDate()+e);break}e-=n-t.getDate()+1,t.setDate(1),11>r?t.setMonth(r+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return r=new Date(t.getFullYear()+1,0,4),e=c(new Date(t.getFullYear(),0,4)),r=c(r),0>=l(e,t)?0>=l(r,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}t>>>=0,r>>>=0,n>>>=0,o>>>=0;var f=s()[o+40>>>2>>>0];for(var d in o={Pb:i()[o>>>2>>>0],Ob:i()[o+4>>>2>>>0],jb:i()[o+8>>>2>>>0],ob:i()[o+12>>>2>>>0],kb:i()[o+16>>>2>>>0],gb:i()[o+20>>>2>>>0],ab:i()[o+24>>>2>>>0],fb:i()[o+28>>>2>>>0],Wb:i()[o+32>>>2>>>0],Nb:i()[o+36>>>2>>>0],Qb:f?ut(f):""},n=ut(n),f={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(d,"g"),f[d]);var p="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),v="January February March April May June July August September October November December".split(" ");for(d in f={"%a":t=>p[t.ab].substring(0,3),"%A":t=>p[t.ab],"%b":t=>v[t.kb].substring(0,3),"%B":t=>v[t.kb],"%C":t=>u((t.gb+1900)/100|0,2),"%d":t=>u(t.ob,2),"%e":t=>a(t.ob,2," "),"%g":t=>h(t).toString().substring(2),"%G":t=>h(t),"%H":t=>u(t.jb,2),"%I":t=>(0==(t=t.jb)?t=12:12<t&&(t-=12),u(t,2)),"%j":t=>{for(var e=0,r=0;r<=t.kb-1;e+=(jt(t.gb+1900)?oe:ae)[r++]);return u(t.ob+e,3)},"%m":t=>u(t.kb+1,2),"%M":t=>u(t.Ob,2),"%n":()=>"\n","%p":t=>0<=t.jb&&12>t.jb?"AM":"PM","%S":t=>u(t.Pb,2),"%t":()=>"\t","%u":t=>t.ab||7,"%U":t=>u(Math.floor((t.fb+7-t.ab)/7),2),"%V":t=>{var e=Math.floor((t.fb+7-(t.ab+6)%7)/7);if(2>=(t.ab+371-t.fb-2)%7&&e++,e)53==e&&(4==(r=(t.ab+371-t.fb)%7)||3==r&&jt(t.gb)||(e=1));else{e=52;var r=(t.ab+7-t.fb-1)%7;(4==r||5==r&&jt(t.gb%400-1))&&e++}return u(e,2)},"%w":t=>t.ab,"%W":t=>u(Math.floor((t.fb+7-(t.ab+6)%7)/7),2),"%y":t=>(t.gb+1900).toString().substring(2),"%Y":t=>t.gb+1900,"%z":t=>(0<=(t=t.Nb)?"+":"-")+("0000"+((t=Math.abs(t)/60)/60*100+t%60)).slice(-4),"%Z":t=>t.Qb,"%%":()=>"%"},n=n.replace(/%%/g,"\0\0"),f)n.includes(d)&&(n=n.replace(new RegExp(d,"g"),f[d](o)));return d=function(t){var e=Array(Tt(t)+1);return St(t,e,0,e.length),e}(n=n.replace(/\0\0/g,"%")),d.length>r?0:(((t,r)=>{e().set(t,r>>>0)})(d,t),d.length-1)}var le=t=>{try{t()}catch(t){Y(t)}},ce=0,he=null,fe=0,de=[],pe={},ve={},ye=0,be=null,_e=[];function me(t){if(!N){if(0===ce){var e=!1,r=!1;t(((t=0)=>{if(!N&&(fe=t,e=!0,r)){ce=2,le((()=>We(he))),typeof Browser<"u"&&Browser.nb.Ab&&Browser.nb.resume(),t=!1;try{var n=function(){var t=i()[he+8>>>2>>>0];return t=Pe[ve[t]],--st,t()}()}catch(e){n=e,t=!0}var s=!1;if(!he){var o=be;o&&(be=null,(t?o.reject:o.resolve)(n),s=!0)}if(t&&!s)throw n}})),r=!0,e||(ce=1,he=function(){var t=ke(65548),e=t+12;s()[t>>>2>>>0]=e,s()[t+4>>>2>>>0]=e+65536,e=de[0];var r=pe[e];return void 0===r&&(r=ye++,pe[e]=r,ve[r]=e),e=r,i()[t+8>>>2>>>0]=e,t}(),typeof Browser<"u"&&Browser.nb.Ab&&Browser.nb.pause(),le((()=>Ve(he))))}else 2===ce?(ce=0,le(qe),Ie(he),he=null,_e.forEach((t=>{if(!N)try{t(),Lt()}catch(t){ft(t)}}))):Y(`invalid state: ${ce}`);return fe}}var ge,we,xe=[],Te=[],Se=(t,e)=>{if(!we){we=new WeakMap;var r=ge.length;if(we)for(var n=0;n<0+r;n++){var i=n,s=xe[i];s||(i>=xe.length&&(xe.length=i+1),xe[i]=s=ge.get(i)),(i=s)&&we.set(i,n)}}if(r=we.get(t)||0)return r;if(Te.length)r=Te.pop();else{try{ge.grow(1)}catch(t){throw t instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":t}r=ge.length-1}try{n=r,ge.set(n,t),xe[n]=ge.get(n)}catch(a){if(!(a instanceof TypeError))throw a;if("function"==typeof WebAssembly.Function){n=WebAssembly.Function,i={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},s={parameters:[],results:"v"==e[0]?[]:[i[e[0]]]};for(var o=1;o<e.length;++o)s.parameters.push(i[e[o]]);e=new n(s,t)}else{for(n=[1],i=e.slice(0,1),e=e.slice(1),s={i:127,p:127,j:126,f:125,d:124,e:111},n.push(96),128>(o=e.length)?n.push(o):n.push(o%128|128,o>>7),o=0;o<e.length;++o)n.push(s[e[o]]);"v"==i?n.push(0):n.push(1,s[i]),e=[0,97,115,109,1,0,0,0,1],128>(i=n.length)?e.push(i):e.push(i%128|128,i>>7),e.push.apply(e,n),e.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),e=new WebAssembly.Module(new Uint8Array(e)),e=new WebAssembly.Instance(e,{e:{f:t}}).exports.f}n=r,ge.set(n,e),xe[n]=ge.get(n)}return we.set(t,r),r};vt.mb();var Ee=[ct,bt,mt,wt,xt,Ot,Pt,At,Ct,kt,It,Rt,$t,Mt,Dt,Bt,Vt,Ht,Jt,Qt,te,ee,re,ie],Oe={r:function(t,e,r){return function(t){return me((e=>{t().then(e)}))}((async()=>{await c.Eb(t,e,r)}))},b:function(t,e,r){throw new _t(t>>>=0).mb(e>>>0,r>>>0),t},P:function(t){Re(t>>>0,!_,1,!b,131072,!1),vt.tb()},n:function(t){t>>>=0,g?postMessage({cmd:"cleanupThread",thread:t}):vt.rb(vt.$a[t])},L:gt,i:wt,V:xt,H:Ot,J:Pt,z:At,T:Ct,N:kt,S:It,p:Rt,I:$t,F:Mt,U:Dt,G:Bt,Y:()=>1,D:function(t,e){(t>>>=0)==e>>>0?setTimeout((()=>Ft())):g?postMessage({targetThread:t,cmd:"checkMailbox"}):(t=vt.$a[t])&&t.postMessage({cmd:"checkMailbox"})},M:function(t,e,r,n){e>>>=0,Ut.length=r,n=n>>>0>>>3;for(var i=0;i<r;i++)Ut[i]=a()[n+i>>>0];return t=0>t?et[-t-1]:Ee[t],vt.zb=e,e=t.apply(null,Ut),vt.zb=0,e},O:Nt,X:function(t){m&&vt.$a[t>>>0].ref()},u:function(t,e,r){t=e+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*e:NaN,r>>>=0,t=new Date(1e3*t),i()[r>>>2>>>0]=t.getUTCSeconds(),i()[r+4>>>2>>>0]=t.getUTCMinutes(),i()[r+8>>>2>>>0]=t.getUTCHours(),i()[r+12>>>2>>>0]=t.getUTCDate(),i()[r+16>>>2>>>0]=t.getUTCMonth(),i()[r+20>>>2>>>0]=t.getUTCFullYear()-1900,i()[r+24>>>2>>>0]=t.getUTCDay(),t=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,i()[r+28>>>2>>>0]=t},v:function(t,e,r){t=e+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*e:NaN,r>>>=0,t=new Date(1e3*t),i()[r>>>2>>>0]=t.getSeconds(),i()[r+4>>>2>>>0]=t.getMinutes(),i()[r+8>>>2>>>0]=t.getHours(),i()[r+12>>>2>>>0]=t.getDate(),i()[r+16>>>2>>>0]=t.getMonth(),i()[r+20>>>2>>>0]=t.getFullYear()-1900,i()[r+24>>>2>>>0]=t.getDay(),e=(jt(t.getFullYear())?zt:Gt)[t.getMonth()]+t.getDate()-1|0,i()[r+28>>>2>>>0]=e,i()[r+36>>>2>>>0]=-60*t.getTimezoneOffset(),e=new Date(t.getFullYear(),6,1).getTimezoneOffset();var n=new Date(t.getFullYear(),0,1).getTimezoneOffset();t=0|(e!=n&&t.getTimezoneOffset()==Math.min(n,e)),i()[r+32>>>2>>>0]=t},w:function(t){t>>>=0;var e=new Date(i()[t+20>>>2>>>0]+1900,i()[t+16>>>2>>>0],i()[t+12>>>2>>>0],i()[t+8>>>2>>>0],i()[t+4>>>2>>>0],i()[t>>>2>>>0],0),r=i()[t+32>>>2>>>0],n=e.getTimezoneOffset(),s=new Date(e.getFullYear(),6,1).getTimezoneOffset(),o=new Date(e.getFullYear(),0,1).getTimezoneOffset(),a=Math.min(o,s);return 0>r?i()[t+32>>>2>>>0]=+(s!=o&&a==n):0<r!=(a==n)&&(s=Math.max(o,s),e.setTime(e.getTime()+6e4*((0<r?a:s)-n))),i()[t+24>>>2>>>0]=e.getDay(),r=(jt(e.getFullYear())?zt:Gt)[e.getMonth()]+e.getDate()-1|0,i()[t+28>>>2>>>0]=r,i()[t>>>2>>>0]=e.getSeconds(),i()[t+4>>>2>>>0]=e.getMinutes(),i()[t+8>>>2>>>0]=e.getHours(),i()[t+12>>>2>>>0]=e.getDate(),i()[t+16>>>2>>>0]=e.getMonth(),i()[t+20>>>2>>>0]=e.getYear(),t=e.getTime(),isNaN(t)?(i()[Ae()>>>2>>>0]=61,t=-1):t/=1e3,Ne((tt=t,1<=+Math.abs(tt)?0<tt?+Math.floor(tt/4294967296)>>>0:~~+Math.ceil((tt-+(~~tt>>>0))/4294967296)>>>0:0)),t>>>0},s:Vt,t:Ht,C:function(t,e,r){function n(t){return(t=t.toTimeString().match(/\(([A-Za-z ]+)\)$/))?t[1]:"GMT"}t>>>=0,e>>>=0,r>>>=0;var o=(new Date).getFullYear(),a=new Date(o,0,1),u=new Date(o,6,1);o=a.getTimezoneOffset();var l=u.getTimezoneOffset(),c=Math.max(o,l);s()[t>>>2>>>0]=60*c,i()[e>>>2>>>0]=+(o!=l),t=n(a),e=n(u),t=qt(t),e=qt(e),l<o?(s()[r>>>2>>>0]=t,s()[r+4>>>2>>>0]=e):(s()[r>>>2>>>0]=e,s()[r+4>>>2>>>0]=t)},d:()=>{Y("")},c:function(t,e,r){return t>>>=0,e=Kt(e>>>0,r>>>0),et[t].apply(null,e)},k:function(t,e,r){return t>>>=0,e=Kt(e>>>0,r>>>0),et[t].apply(null,e)},o:()=>{},q:()=>Date.now(),W:()=>{throw st+=1,"unwind"},E:function(){return 4294901760},f:()=>performance.timeOrigin+performance.now(),g:()=>m?(tsvb_Hi(),tsvb_Rt(tsvb_Li)).cpus().length:navigator.hardwareConcurrency,A:function(t){t>>>=0;var e=n().length;if(t<=e||4294901760<t)return!1;for(var r=1;4>=r;r*=2){var i=e*(1+.2/r);i=Math.min(i,t+100663296);var s=Math;i=Math.max(t,i);t:{s=(s.min.call(s,4294901760,i+(65536-i%65536)%65536)-C.buffer.byteLength+65535)/65536;try{C.grow(s),F();var o=1;break t}catch{}o=void 0}if(o)return!0}return!1},Q:Jt,R:Qt,K:ht,h:te,m:ee,x:re,l:ie,y:function(t,e){return t>>>=0,e>>>=0,se(n().subarray(t>>>0,t+e>>>0)),0},a:C||c.wasmMemory,B:ue,e:function(t,e,r,n){return ue(t>>>0,e>>>0,r>>>0,n>>>0)},j:function(t,e,r,i){let s=ge.length;t=new Uint8Array(n().slice(t+e,t+r));try{var o,a=new WebAssembly.Module(t),u=new WebAssembly.Instance(a,{env:{memory:C}});for(o in u.exports)Se(u.exports[o]);return s<ge.length?s:i}catch(t){return console.log(t),i}}},Pe=function(){function t(t,e){return Pe=t.exports,Pe=function(){var t=Pe,e={};for(let[r,n]of Object.entries(t))e[r]="function"==typeof n?function(){de.push(r);try{return n.apply(null,arguments)}finally{N||(de.pop(),he&&1===ce&&0===de.length&&(ce=0,st+=1,le(He),typeof Fibers<"u"&&Fibers.Xb()))}}:n;return e}(),Pe=function(){var t=Pe;t=Object.assign({},t);var e=t=>()=>t()>>>0,r=t=>e=>t(e)>>>0;return t.Da=e(t.Da),t.Ea=e(t.Ea),t.Fa=r(t.Fa),t.emscripten_main_runtime_thread_id=e(t.emscripten_main_runtime_thread_id),t.Ra=e(t.Ra),t.Ta=r(t.Ta),t}(),vt.ub.push(Pe.Ha),ge=Pe.Ia,z.unshift(Pe.Z),k=e,q(),Pe}var e={a:Oe};if(V++,c.instantiateWasm)try{return c.instantiateWasm(e,t)}catch(t){A(`Module.instantiateWasm callback failed with error: ${t}`),l(t)}return function(t,e){var r=K;return"function"!=typeof WebAssembly.instantiateStreaming||X(r)||Z(r)||m||"function"!=typeof fetch?Q(r,t,e):fetch(r,{credentials:"same-origin"}).then((n=>WebAssembly.instantiateStreaming(n,t).then(e,(function(n){return A(`wasm streaming compile failed: ${n}`),A("falling back to ArrayBuffer instantiation"),Q(r,t,e)}))))}(e,(function(e){t(e.instance,e.module)})).catch(l),{}}();c._OrtInit=(t,e)=>(c._OrtInit=Pe._)(t,e),c._OrtGetLastError=(t,e)=>(c._OrtGetLastError=Pe.$)(t,e),c._OrtCreateSessionOptions=(t,e,r,n,i,s,o,a,u,l)=>(c._OrtCreateSessionOptions=Pe.aa)(t,e,r,n,i,s,o,a,u,l),c._OrtAppendExecutionProvider=(t,e)=>(c._OrtAppendExecutionProvider=Pe.ba)(t,e),c._OrtAddFreeDimensionOverride=(t,e,r)=>(c._OrtAddFreeDimensionOverride=Pe.ca)(t,e,r),c._OrtAddSessionConfigEntry=(t,e,r)=>(c._OrtAddSessionConfigEntry=Pe.da)(t,e,r),c._OrtReleaseSessionOptions=t=>(c._OrtReleaseSessionOptions=Pe.ea)(t),c._OrtCreateSession=(t,e,r)=>(c._OrtCreateSession=Pe.fa)(t,e,r),c._OrtReleaseSession=t=>(c._OrtReleaseSession=Pe.ga)(t),c._OrtGetInputOutputCount=(t,e,r)=>(c._OrtGetInputOutputCount=Pe.ha)(t,e,r),c._OrtGetInputName=(t,e)=>(c._OrtGetInputName=Pe.ia)(t,e),c._OrtGetOutputName=(t,e)=>(c._OrtGetOutputName=Pe.ja)(t,e),c._OrtFree=t=>(c._OrtFree=Pe.ka)(t),c._OrtCreateTensor=(t,e,r,n,i,s)=>(c._OrtCreateTensor=Pe.la)(t,e,r,n,i,s),c._OrtGetTensorData=(t,e,r,n,i)=>(c._OrtGetTensorData=Pe.ma)(t,e,r,n,i),c._OrtReleaseTensor=t=>(c._OrtReleaseTensor=Pe.na)(t),c._OrtCreateRunOptions=(t,e,r,n)=>(c._OrtCreateRunOptions=Pe.oa)(t,e,r,n),c._OrtAddRunConfigEntry=(t,e,r)=>(c._OrtAddRunConfigEntry=Pe.pa)(t,e,r),c._OrtReleaseRunOptions=t=>(c._OrtReleaseRunOptions=Pe.qa)(t),c._OrtCreateBinding=t=>(c._OrtCreateBinding=Pe.ra)(t),c._OrtBindInput=(t,e,r)=>(c._OrtBindInput=Pe.sa)(t,e,r),c._OrtBindOutput=(t,e,r,n)=>(c._OrtBindOutput=Pe.ta)(t,e,r,n),c._OrtClearBoundOutputs=t=>(c._OrtClearBoundOutputs=Pe.ua)(t),c._OrtReleaseBinding=t=>(c._OrtReleaseBinding=Pe.va)(t),c._OrtRunWithBinding=(t,e,r,n,i)=>(c._OrtRunWithBinding=Pe.wa)(t,e,r,n,i),c._OrtRun=(t,e,r,n,i,s,o,a)=>(c._OrtRun=Pe.xa)(t,e,r,n,i,s,o,a),c._OrtEndProfiling=t=>(c._OrtEndProfiling=Pe.ya)(t),c._OrtConfigure=(t,e)=>(c._OrtConfigure=Pe.za)(t,e),c._OrtAuth=(t,e)=>(c._OrtAuth=Pe.Aa)(t,e),c._JsepOutput=(t,e,r)=>(c._JsepOutput=Pe.Ba)(t,e,r),c._JsepGetNodeName=t=>(c._JsepGetNodeName=Pe.Ca)(t);var Ae=()=>(Ae=Pe.Da)(),Ce=c._pthread_self=()=>(Ce=c._pthread_self=Pe.Ea)(),ke=c._malloc=t=>(ke=c._malloc=Pe.Fa)(t),Ie=c._free=t=>(Ie=c._free=Pe.Ga)(t);c.__emscripten_tls_init=()=>(c.__emscripten_tls_init=Pe.Ha)();var Re=c.__emscripten_thread_init=(t,e,r,n,i,s)=>(Re=c.__emscripten_thread_init=Pe.Ja)(t,e,r,n,i,s);c.__emscripten_thread_crashed=()=>(c.__emscripten_thread_crashed=Pe.Ka)();var $e,Me=(t,e,r,n)=>(Me=Pe.La)(t,e,r,n),De=t=>(De=Pe.Ma)(t),Be=c.__emscripten_thread_exit=t=>(Be=c.__emscripten_thread_exit=Pe.Na)(t),Le=()=>(Le=Pe.Oa)(),Ne=t=>(Ne=Pe.Pa)(t),Fe=(t,e)=>(Fe=Pe.Qa)(t,e),Ue=()=>(Ue=Pe.Ra)(),je=t=>(je=Pe.Sa)(t),ze=t=>(ze=Pe.Ta)(t),Ge=c.dynCall_ii=(t,e)=>(Ge=c.dynCall_ii=Pe.Va)(t,e),Ve=t=>(Ve=Pe.Wa)(t),He=()=>(He=Pe.Xa)(),We=t=>(We=Pe.Ya)(t),qe=()=>(qe=Pe.Za)();function Ye(){if(!(0<V))if(g)u(c),g||yt(z),startWorker(c);else{if(c.preRun)for("function"==typeof c.preRun&&(c.preRun=[c.preRun]);c.preRun.length;)j.unshift(c.preRun.shift());yt(j),0<V||$e||($e=!0,c.calledRun=!0,N||(g||yt(z),u(c),g||yt(G)))}}return c.___start_em_js=914981,c.___stop_em_js=915754,c.wasmMemory=C,c.stackAlloc=ze,c.stackSave=Ue,c.stackRestore=je,c.keepRuntimeAlive=()=>0<st,c.addFunction=Se,c.UTF8ToString=ut,c.stringToUTF8=Et,c.lengthBytesUTF8=Tt,c.ExitStatus=rt,c.PThread=vt,W=function t(){$e||Ye(),$e||(W=t)},Ye(),t.ready});"object"==typeof t&&"object"==typeof e?e.exports=n:"function"==typeof define&&define.amd&&define([],(()=>n))})),tsvb_Ki=tsvb_cr(((t,e)=>{e.exports='"use strict";var Module={},ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads"),parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",e=>onmessage({data:e}));var fs=require("fs"),vm=require("vm");Object.assign(global,{self:global,require,Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:e=>vm.runInThisContext(fs.readFileSync(e,"utf8"),{filename:e}),postMessage:e=>parentPort.postMessage(e),performance:global.performance||{now:Date.now}})}var initializedJS=!1;function threadPrintErr(){var e=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,e+`\n`);return}console.error(e)}function threadAlert(){var e=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:e,threadId:Module._pthread_self()})}var err=threadPrintErr;self.alert=threadAlert,Module.instantiateWasm=(e,t)=>{var a=Module.wasmModule;Module.wasmModule=null;var r=new WebAssembly.Instance(a,e);return t(r)},self.onunhandledrejection=e=>{throw e.reason||e};function handleMessage(e){try{if(e.data.cmd==="load"){let a=[];self.onmessage=r=>a.push(r),self.startWorker=r=>{Module=r,postMessage({cmd:"loaded"});for(let s of a)handleMessage(s);self.onmessage=handleMessage},Module.wasmModule=e.data.wasmModule;for(const r of e.data.handlers)Module[r]=(...s)=>{postMessage({cmd:"callHandler",handler:r,args:s})};if(Module.wasmMemory=e.data.wasmMemory,Module.buffer=Module.wasmMemory.buffer,Module.ENVIRONMENT_IS_PTHREAD=!0,typeof e.data.urlOrBlob=="string")importScripts(e.data.urlOrBlob);else{var t=URL.createObjectURL(e.data.urlOrBlob);importScripts(t),URL.revokeObjectURL(t)}ortWasmThreaded(Module)}else if(e.data.cmd==="run"){Module.__emscripten_thread_init(e.data.pthread_ptr,0,0,1),Module.__emscripten_thread_mailbox_await(e.data.pthread_ptr),Module.establishStackSpace(),Module.PThread.receiveObjectTransfer(e.data),Module.PThread.threadInitTLS(),initializedJS||(initializedJS=!0);try{Module.invokeEntryPoint(e.data.start_routine,e.data.arg)}catch(a){if(a!="unwind")throw a}}else e.data.cmd==="cancel"?Module._pthread_self()&&Module.__emscripten_thread_exit(-1):e.data.target==="setimmediate"||(e.data.cmd==="checkMailbox"?initializedJS&&Module.checkMailbox():e.data.cmd&&(err(`worker.js received unknown command ${e.data.cmd}`),err(e.data)))}catch(a){throw Module.__emscripten_thread_crashed?.(),a}}self.onmessage=handleMessage;\n'})),tsvb_Zi,tsvb_bd,tsvb_ca,tsvb_pa,tsvb_mn,tsvb_Yi,tsvb_wd,tsvb_vd,tsvb_$d,tsvb_Qi,tsvb_Ne,tsvb_mr=tsvb_q((()=>{tsvb_Zi=tsvb_Wi(),tsvb_bd=tsvb_ji(),tsvb_pa=!1,tsvb_mn=!1,tsvb_Yi=!1,tsvb_wd=t=>{if(1===t)return!1;if(typeof SharedArrayBuffer>"u")return typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+t+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),!1;typeof tsvb_process<"u"&&tsvb_process.versions&&tsvb_process.versions.node&&console.warn("env.wasm.numThreads is set to "+t+", however, currently onnxruntime-web does not support multi-threads in Node.js. Please consider using onnxruntime-node for performance critical scenarios.");try{return typeof MessageChannel<"u"&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},tsvb_vd=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},tsvb_$d=(t,e)=>t?e?"ort-wasm-simd-threaded.wasm":"ort-wasm-simd.wasm":e?"ort-wasm-threaded.wasm":"ort-wasm.wasm",tsvb_Qi=async t=>{if(tsvb_pa)return Promise.resolve();if(tsvb_mn)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(tsvb_Yi)throw new Error("previous call to 'initializeWebAssembly()' failed.");tsvb_mn=!0;let e=t.initTimeout,r=t.numThreads,n=t.simd,i=tsvb_wd(r),s=n&&tsvb_vd(),o=t.wasmPaths,a="string"==typeof o?o:void 0,u=tsvb_$d(s,i),l="object"==typeof o?o[u]:void 0,c=!1,h=[];if(e>0&&h.push(new Promise((t=>{setTimeout((()=>{c=!0,t()}),e)}))),h.push(new Promise(((t,e)=>{let n=i?tsvb_bd:tsvb_Zi,s={locateFile:(t,e)=>{if(i&&t.endsWith(".worker.js")&&typeof Blob<"u")return URL.createObjectURL(new Blob([tsvb_Ki()],{type:"text/javascript"}));if(t.endsWith(".wasm")){if(l)return l;let t=a??e;return"ort-wasm-simd.wasm"===u?t+"ort-wasm-simd.jsep.wasm":"ort-wasm-simd-threaded.wasm"===u?t+"ort-wasm-simd-threaded.jsep.wasm":t+u}return e+t}};if(i)if(s.numThreads=r,typeof Blob>"u")s.mainScriptUrlOrBlob=(void 0)(__dirname,"ort-wasm-threaded.js");else{let t=`var ortWasmThreaded=${n.toString()};`;s.mainScriptUrlOrBlob=new Blob([t],{type:"text/javascript"})}n(s).then((e=>{tsvb_mn=!1,tsvb_pa=!0,tsvb_ca=e,t()}),(t=>{tsvb_mn=!1,tsvb_Yi=!0,e(t)}))}))),await Promise.race(h),c)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},tsvb_Ne=()=>{if(tsvb_pa&&tsvb_ca)return tsvb_ca;throw new Error("WebAssembly is not initialized yet.")}})),tsvb_We,tsvb_Rr,tsvb_Re,tsvb_fn=tsvb_q((()=>{tsvb_mr(),tsvb_We=(t,e)=>{let r=tsvb_Ne(),n=r.lengthBytesUTF8(t)+1,i=r._malloc(n);return r.stringToUTF8(t,i,n),e.push(i),i},tsvb_Rr=(t,e,r,n)=>{if("object"==typeof t&&null!==t){if(r.has(t))throw new Error("Circular reference in options");r.add(t)}Object.entries(t).forEach((([t,i])=>{let s=e?e+t:t;if("object"==typeof i)tsvb_Rr(i,s+".",r,n);else if("string"==typeof i||"number"==typeof i)n(s,i.toString());else{if("boolean"!=typeof i)throw new Error("Can't handle extra config type: "+typeof i);n(s,i?"1":"0")}}))},tsvb_Re=t=>{let e=tsvb_Ne(),r=e.stackSave();try{let r=e.stackAlloc(8);e._OrtGetLastError(r,r+4);let n=e.HEAP32[r/4],i=e.HEAPU32[r/4+1],s=i?e.UTF8ToString(i):"";throw new Error(`${t} ERROR_CODE: ${n}, ERROR_MESSAGE: ${s}`)}finally{e.stackRestore(r)}}})),tsvb_Xi,tsvb_Ji=tsvb_q((()=>{tsvb_mr(),tsvb_fn(),tsvb_Xi=t=>{let e=tsvb_Ne(),r=0,n=[],i=t||{};try{if(void 0===t?.logSeverityLevel)i.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===t?.logVerbosityLevel)i.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);void 0===t?.terminate&&(i.terminate=!1);let s=0;return void 0!==t?.tag&&(s=tsvb_We(t.tag,n)),r=e._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,s),0===r&&tsvb_Re("Can't create run options."),void 0!==t?.extra&&tsvb_Rr(t.extra,"",new WeakSet,((t,i)=>{let s=tsvb_We(t,n),o=tsvb_We(i,n);0!==e._OrtAddRunConfigEntry(r,s,o)&&tsvb_Re(`Can't set a run config entry: ${t} - ${i}.`)})),[r,n]}catch(t){throw 0!==r&&e._OrtReleaseRunOptions(r),n.forEach((t=>e._free(t))),t}}})),src_tsvb_d,tsvb_xd,tsvb_Sd,tsvb_Id,tsvb_eo,tsvb_to=tsvb_q((()=>{tsvb_mr(),tsvb_fn(),src_tsvb_d=t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}},tsvb_xd=t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}},tsvb_Sd=t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});let e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some((t=>"webgpu"===("string"==typeof t?t:t.name)))&&(t.enableMemPattern=!1)},tsvb_Id=(t,e,r)=>{for(let n of e){let e="string"==typeof n?n:n.name;switch(e){case"webnn":if(e="WEBNN","string"!=typeof n){let e=n;if(e?.deviceType){let n=tsvb_We("deviceType",r),i=tsvb_We(e.deviceType,r);0!==tsvb_Ne()._OrtAddSessionConfigEntry(t,n,i)&&tsvb_Re(`Can't set a session config entry: 'deviceType' - ${e.deviceType}.`)}if(e?.numThreads){let n=e.numThreads;("number"!=typeof n||!Number.isInteger(n)||n<0)&&(n=0);let i=tsvb_We("numThreads",r),s=tsvb_We(n.toString(),r);0!==tsvb_Ne()._OrtAddSessionConfigEntry(t,i,s)&&tsvb_Re(`Can't set a session config entry: 'numThreads' - ${e.numThreads}.`)}if(e?.powerPreference){let n=tsvb_We("powerPreference",r),i=tsvb_We(e.powerPreference,r);0!==tsvb_Ne()._OrtAddSessionConfigEntry(t,n,i)&&tsvb_Re(`Can't set a session config entry: 'powerPreference' - ${e.powerPreference}.`)}}break;case"webgpu":if(e="JS","string"!=typeof n){let e=n;if(e?.preferredLayout){if("NCHW"!==e.preferredLayout&&"NHWC"!==e.preferredLayout)throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${e.preferredLayout}`);let n=tsvb_We("preferredLayout",r),i=tsvb_We(e.preferredLayout,r);0!==tsvb_Ne()._OrtAddSessionConfigEntry(t,n,i)&&tsvb_Re(`Can't set a session config entry: 'preferredLayout' - ${e.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${e}`)}let i=tsvb_We(e,r);0!==tsvb_Ne()._OrtAppendExecutionProvider(t,i)&&tsvb_Re(`Can't append execution provider: ${e}.`)}},tsvb_eo=t=>{let e=tsvb_Ne(),r=0,n=[],i=t||{};tsvb_Sd(i);try{let t=src_tsvb_d(i.graphOptimizationLevel??"all"),s=tsvb_xd(i.executionMode??"sequential"),o="string"==typeof i.logId?tsvb_We(i.logId,n):0,a=i.logSeverityLevel??2;if(!Number.isInteger(a)||a<0||a>4)throw new Error(`log serverity level is not valid: ${a}`);let u=i.logVerbosityLevel??0;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log verbosity level is not valid: ${u}`);let l="string"==typeof i.optimizedModelFilePath?tsvb_We(i.optimizedModelFilePath,n):0;if(r=e._OrtCreateSessionOptions(t,!!i.enableCpuMemArena,!!i.enableMemPattern,s,!!i.enableProfiling,0,o,a,u,l),0===r&&tsvb_Re("Can't create session options."),i.executionProviders&&tsvb_Id(r,i.executionProviders,n),void 0!==i.enableGraphCapture){if("boolean"!=typeof i.enableGraphCapture)throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);let t=tsvb_We("enableGraphCapture",n),s=tsvb_We(i.enableGraphCapture.toString(),n);0!==e._OrtAddSessionConfigEntry(r,t,s)&&tsvb_Re(`Can't set a session config entry: 'enableGraphCapture' - ${i.enableGraphCapture}.`)}if(i.freeDimensionOverrides)for(let[t,s]of Object.entries(i.freeDimensionOverrides)){if("string"!=typeof t)throw new Error(`free dimension override name must be a string: ${t}`);if("number"!=typeof s||!Number.isInteger(s)||s<0)throw new Error(`free dimension override value must be a non-negative integer: ${s}`);let i=tsvb_We(t,n);0!==e._OrtAddFreeDimensionOverride(r,i,s)&&tsvb_Re(`Can't set a free dimension override: ${t} - ${s}.`)}return void 0!==i.extra&&tsvb_Rr(i.extra,"",new WeakSet,((t,i)=>{let s=tsvb_We(t,n),o=tsvb_We(i,n);0!==e._OrtAddSessionConfigEntry(r,s,o)&&tsvb_Re(`Can't set a session config entry: ${t} - ${i}.`)})),[r,n]}catch(t){throw 0!==r&&e._OrtReleaseSessionOptions(r),n.forEach((t=>e._free(t))),t}}})),tsvb_ma,tsvb_ot,tsvb_Dr,tsvb_hn,tsvb_Mr,tsvb_gn,tsvb_fa,tsvb_Ve=tsvb_q((()=>{tsvb_ma=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${t}`)}},tsvb_ot=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${t}`)}},tsvb_Dr=t=>[void 0,4,1,1,2,2,4,8,void 0,1,2,8,4,8,void 0,void 0,void 0][t],tsvb_hn=t=>{switch(t){case"float16":case"uint16":return Uint16Array;case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}},tsvb_Mr=t=>{switch(t){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${t}`)}},tsvb_gn=t=>"float32"===t||"int32"===t||"int64"===t||"bool"===t||"float16"===t||"uint32"===t,tsvb_fa=t=>{switch(t){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;default:throw new Error(`unsupported data location: ${t}`)}}})),tsvb_zr,tsvb_ha=tsvb_q((()=>{tsvb_zr=async t=>{if("string"!=typeof t)return t instanceof Blob?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:new Uint8Array(t);if(!(typeof tsvb_process<"u"&&tsvb_process.versions&&tsvb_process.versions.node)){let e=await fetch(t);if(!e.ok)throw new Error(`failed to load external data file: ${t}`);let r=e.headers.get("Content-Length"),n=r?parseInt(r,10):0;if(n<1073741824)return new Uint8Array(await e.arrayBuffer());{if(!e.body)throw new Error(`failed to load external data file: ${t}, no response body.`);let r,i=e.body.getReader();try{r=new ArrayBuffer(n)}catch(t){if(!(t instanceof RangeError))throw t;{let t=Math.ceil(n/65536);r=new WebAssembly.Memory({initial:t,maximum:t}).buffer}}let s=0;for(;;){let{done:t,value:e}=await i.read();if(t)break;let n=e.byteLength;new Uint8Array(r,s,n).set(e),s+=n}return new Uint8Array(r,0,n)}}try{return new Uint8Array(await(void 0)(t))}catch(e){if("ERR_FS_FILE_TOO_LARGE"===e.code){let e=(void 0)(t),r=[];for await(let t of e)r.push(t);return new Uint8Array(tsvb_ort_webgpu_min_Buffer.concat(r))}throw e}}})),tsvb_Cd,tsvb_Ad,tsvb_ro,tsvb_no,tsvb_ao,tsvb_Td,tsvb_De,tsvb_Nt=tsvb_q((()=>{tsvb_Ve(),tsvb_Cd=["V","I","W","E","F"],tsvb_Ad=(t,e)=>{console.log(`[${tsvb_Cd[t]},${(new Date).toISOString()}]${e}`)},tsvb_ao=(t,e)=>{tsvb_ro=t,tsvb_no=e},tsvb_Td=(t,e)=>{let r=tsvb_Mr(t);r>=tsvb_Mr(tsvb_ro)&&tsvb_Ad(r,"function"==typeof e?e():e)},tsvb_De=(...t)=>{tsvb_no&&tsvb_Td(...t)}})),tsvb_io,tsvb_oo=tsvb_q((()=>{tsvb_Ve(),tsvb_io=(t,e)=>new(tsvb_hn(e))(t)})),tsvb_yn=tsvb_q((()=>{})),tsvb_bn,tsvb_Ed,tsvb_so,tsvb_Od,tsvb_ga,tsvb_ba,tsvb_ya,tsvb_lo,tsvb_co=tsvb_q((()=>{tsvb_Nt(),tsvb_yn(),tsvb_bn=t=>16*Math.ceil(t/16),tsvb_Ed=1,tsvb_so=()=>tsvb_Ed++,tsvb_Od=1,tsvb_ga=()=>tsvb_Od++,tsvb_ba=async(t,e,r,n)=>{let i=tsvb_bn(r),s=t.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let o=t.getCommandEncoder();t.endComputePass(),o.copyBufferToBuffer(e,0,s,0,i),t.flush(),await s.mapAsync(GPUMapMode.READ);let a=s.getMappedRange();if(n){let t=n();return t.set(new Uint8Array(a,0,r)),t}return new Uint8Array(a.slice(0,r))}finally{s.destroy()}},tsvb_ya=class{constructor(t){this.backend=t,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersForUploadingPending=[],this.buffersPending=[],this.externalBuffers=new Map,this.capturedPendingBuffers=new Map}upload(t,e){let r=e.buffer,n=e.byteOffset,i=e.byteLength,s=tsvb_bn(i),o=this.storageCache.get(t);if(!o)throw new Error("gpu data for uploading does not exist");if(o.originalSize!==i)throw new Error(`inconsistent data size. gpu data size=${o.originalSize}, data size=${i}`);let a=this.backend.device.createBuffer({mappedAtCreation:!0,size:s,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),u=a.getMappedRange();new Uint8Array(u).set(new Uint8Array(r,n,i)),a.unmap();let l=this.backend.getCommandEncoder();this.backend.endComputePass(),l.copyBufferToBuffer(a,0,o.gpuData.buffer,0,s),tsvb_De("verbose",(()=>`[WebGPU] GpuDataManager.upload(id=${t})`)),this.buffersForUploadingPending.push(a)}memcpy(t,e){let r=this.storageCache.get(t);if(!r)throw new Error("source gpu data for memcpy does not exist");let n=this.storageCache.get(e);if(!n)throw new Error("destination gpu data for memcpy does not exist");if(r.originalSize!==n.originalSize)throw new Error("inconsistent source and destination gpu data size");let i=tsvb_bn(r.originalSize),s=this.backend.getCommandEncoder();this.backend.endComputePass(),s.copyBufferToBuffer(r.gpuData.buffer,0,n.gpuData.buffer,0,i)}registerExternalBuffer(t,e,r){let n;if(r){if(n=this.externalBuffers.get(r),void 0===n)throw new Error("previous buffer is not registered");if(t===r)return tsvb_De("verbose",(()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${n}, buffer is the same, skip.`)),n;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error("Registering a different external buffer under graph capture mode is not supported yet.\n             Please use the previous external buffer!");this.externalBuffers.delete(r)}else n=tsvb_so();return this.storageCache.set(n,{gpuData:{id:n,type:0,buffer:t,permamentID:tsvb_ga()},originalSize:e}),this.externalBuffers.set(t,n),tsvb_De("verbose",(()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${n}, registered.`)),n}unregisterExternalBuffer(t){let e=this.externalBuffers.get(t);void 0!==e&&(this.storageCache.delete(e),this.externalBuffers.delete(t),tsvb_De("verbose",(()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`)))}create(t,e=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let r,n=tsvb_bn(t),i=(e&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,s=(e&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(i||s){let t=i?this.freeBuffers:this.freeUniformBuffers,s=t.get(n);s||(s=[],t.set(n,s)),r=s.length>0?s.pop():{buffer:this.backend.device.createBuffer({size:n,usage:e}),permamentID:tsvb_ga()}}else r={buffer:this.backend.device.createBuffer({size:n,usage:e}),permamentID:tsvb_ga()};let o={id:tsvb_so(),type:0,buffer:r.buffer,permamentID:r.permamentID};return this.storageCache.set(o.id,{gpuData:o,originalSize:t}),tsvb_De("verbose",(()=>`[WebGPU] GpuDataManager.create(size=${t}) => id=${o.id}`)),o}get(t){return this.storageCache.get(t)?.gpuData}release(t){let e=this.storageCache.get(t);if(!e)throw new Error("releasing data does not exist");return tsvb_De("verbose",(()=>`[WebGPU] GpuDataManager.release(id=${t}), gpuDataId=${e.gpuData.id}`)),this.storageCache.delete(t),this.buffersPending.push({buffer:e.gpuData.buffer,permamentID:e.gpuData.permamentID}),e.originalSize}async download(t,e){let r=this.storageCache.get(t);if(!r)throw new Error("data does not exist");await tsvb_ba(this.backend,r.gpuData.buffer,r.originalSize,e)}refreshPendingBuffers(){for(let t of this.buffersForUploadingPending)t.destroy();if(this.buffersForUploadingPending=[],0!==this.buffersPending.length)if("default"===this.backend.sessionStatus){for(let t of this.buffersPending)(t.buffer.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE?this.freeBuffers.get(t.buffer.size).push(t):(t.buffer.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM?this.freeUniformBuffers.get(t.buffer.size).push(t):t.buffer.destroy();this.buffersPending=[]}else{let t=this.capturedPendingBuffers.get(this.backend.currentSessionId);t||(t=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,t));for(let e of this.buffersPending)t.push(e);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach((t=>{t.forEach((t=>{t.buffer.destroy()}))})),this.freeUniformBuffers.forEach((t=>{t.forEach((t=>{t.buffer.destroy()}))})),this.storageCache.forEach((t=>{t.gpuData.buffer.destroy()})),this.capturedPendingBuffers.forEach((t=>{t.forEach((t=>{t.buffer.destroy()}))})),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onReleaseSession(t){let e=this.capturedPendingBuffers.get(t);e&&(e.forEach((t=>{t.buffer.destroy()})),this.capturedPendingBuffers.delete(t))}},tsvb_lo=(...t)=>new tsvb_ya(...t)})),tsvb_wa,tsvb_he,tsvb_Fe=tsvb_q((()=>{tsvb_wa=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map((t=>`${this[t]}`)).join(";")),this.key}},tsvb_he=t=>new tsvb_wa(t)})),tsvb_va,tsvb_vt,tsvb_ort_webgpu_min_N,tsvb_Qt,tsvb_wn,tsvb_vn,tsvb_$n,tsvb_xe=tsvb_q((()=>{tsvb_va=class{static calcMatMulShape(t,e){return t[1]!==e[0]?void 0:[t[0],e[1]]}},tsvb_vt=class{static calcShape(t,e,r=!1){let n=t.length,i=e.length;if(0===n)return e;if(0===i)return t;let s=Math.max(t.length,e.length),o=new Array(s);if(r){if(n<2||i<2)return;let r=tsvb_va.calcMatMulShape([t[n-2],t[n-1]],[e[i-2],e[i-1]]);if(void 0===r)return;[o[s-2],o[s-1]]=r}for(let a=r?3:1;a<=s;a++){let r=n-a<0?1:t[n-a],u=i-a<0?1:e[i-a];if(r!==u&&r>1&&u>1)return;o[s-a]=Math.max(r,u)}return o}static isValidBroadcast(t,e){let r=t.length,n=e.length;if(r>n)return!1;for(let i=1;i<=r;i++)if(1!==t[r-i]&&t[r-i]!==e[n-i])return!1;return!0}},tsvb_ort_webgpu_min_N=class t{static size(e){return t.getSizeFromDimensionRange(e,0,e.length)}static sizeFromDimension(e,r){if(r<0||r>e.length)throw new Error(`invalid dimension of ${r} for sizeFromDimension as Tensor has ${e.length} dimensions.`);return t.getSizeFromDimensionRange(e,r,e.length)}static sizeToDimension(e,r){if(r<0||r>e.length)throw new Error(`invalid dimension of ${r} for sizeToDimension as Tensor has ${e.length} dimensions.`);return t.getSizeFromDimensionRange(e,0,r)}static getSizeFromDimensionRange(t,e,r){let n=1;for(let i=e;i<r;i++){if(t[i]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");n*=t[i]}return n}static computeStrides(t){let e=t.length;if(0===e)return[];if(1===e)return[1];let r=new Array(e);r[e-1]=1,r[e-2]=t[e-1];for(let n=e-3;n>=0;--n)r[n]=r[n+1]*t[n+1];return r}static normalizeAxis(t,e){if(t<-e&&t>=e)throw new Error("unsupported axis for this operation.");return t<0?t+e:t}static normalizeAxes(t,e){return t.map((r=>this.normalizeAxis(r,e??t.length)))}static sortBasedOnPerm(t,e){return e?e.map((e=>t[e])):t.slice().reverse()}static padShape(t,e){let r=t.length;return t.map(((t,n)=>t+e[n]+e[n+r]))}static areEqual(t,e){return t.length===e.length&&t.every(((t,r)=>t===e[r]))}},tsvb_Qt=class t{static adjustPoolAttributes(t,e,r,n,i,s){if(!t&&r.length!==e.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let t=0;t<e.length-2;t++)t>=r.length?r.push(e[t+2]):r[t]=e[t+2];for(let t=0;t<r.length;t++)if(t<n.length){if(n[t]<0)throw new Error("strides should be greater than or equal to 1")}else n.push(1);for(let t=0;t<r.length;t++)if(t<i.length){if(i[t]<0)throw new Error("dilations should be greater than or equal to 1")}else i.push(1);for(let t=0;t<2*r.length;t++)if(t<s.length){if(s[t]<0)throw new Error("pad should be greater than or equal to 1")}else s.push(0);for(let t=0;t<r.length;t++){if(r[t]<=0)throw new Error("kernel shapes need to be greater than 0");if(s[t]>=r[t]||s[t+r.length]>=r[t])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(e,r,n,i,s,o,a){if(a){if(s.length!==2*(e.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(r.length!==e.length-2)throw new Error("length of strides should be the length of data dimensions");if(i.length!==e.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let u=0;u<e.length-2;u++)t.adjustPadAndReturnShape(e[u+(o?1:2)],r[u],n[u],i[u],s,u,u+e.length-2,a)}}static computePoolOutputShape(e,r,n,i,s,o,a){if(r.length<=0)throw new Error("input shape must be of size greater than 0");let u=[r[0],r[1]];return t.computeShapeHelper(e,r,u,n,i,s,o,a),u}static computeConvOutputShape(e,r,n,i,s,o,a){if(e.length<=0||r.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let u=[e[0],r[0]];return t.computeShapeHelper(!1,e,u,n,i,s,o,a),u}static computeShapeHelper(e,r,n,i,s,o,a,u){if(e)for(let t=0;t<r.length-2;t++)n.push(1);else for(let e=0;e<r.length-2;e++)n.push(t.adjustPadAndReturnShape(r[e+2],i[e],s[e],o[e],a,e,e+r.length-2,u))}static adjustPadAndReturnShape(t,e,r,n,i,s,o,a){let u=r*(n-1)+1;if(!a||"NOTSET"===a)return Math.floor((t+i[s]+i[o]-u)/e+1);switch(a){case"VALID":return i[s]=0,i[o]=0,Math.floor((t-u)/e+1);case"SAME_LOWER":case"SAME_UPPER":if(1!==r)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let r=((t+e-1)/e-1)*e+n-t;return i[s]=Math.floor("SAME_LOWER"===a?(r+1)/2:r/2),i[o]=r-i[s],Math.floor((t+r-n)/e+1)}default:throw new Error("Unsupported AutoPad type")}}},tsvb_wn=class{static getShapeOfGemmResult(t,e,r,n,i){if(2!==t.length||2!==r.length)throw new Error("shape need to be of size 2");let s,o,a;e?(s=t[1],o=t[0]):(s=t[0],o=t[1]);let u=-1;if(n?(a=r[0],u=1):(a=r[1],u=0),r[u]!==o)throw new Error("dimension mismatch");if(s<=0||a<=0||o<=0)throw new Error("invalid shape specified");if(i&&!tsvb_vt.isValidBroadcast(i,[s,a]))throw new Error("gemm: invalid bias shape for broadcast");return[s,a,o]}},tsvb_vn=-34028234663852886e22,tsvb_$n=34028234663852886e22})),tsvb_kd,src_tsvb_a,tsvb_Le,tsvb_$t,tsvb_F,tsvb_He,tsvb_Je,tsvb_ht,tsvb_st,tsvb_le,tsvb_xa,tsvb_z,tsvb_ort_webgpu_min_j,src_tsvb_n,tsvb_$a,tsvb_po,tsvb_fr,tsvb_Ue,tsvb_$e=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_kd=64,src_tsvb_a=(t,e)=>{if(3===e)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(t){case 10:return e>1?`vec${e}<f16>`:"f16";case 1:return e>1?`vec${e}<f32>`:"f32";case 6:return e>1?`vec${e}<i32>`:"i32";case 12:return e>1?`vec${e}<u32>`:"u32";case 7:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(4!==e)throw new Error("bool must be vec4");return["u32","vec4<bool>"];default:throw new Error(`Unknown data type: ${t}`)}},tsvb_Le=(t,e=1)=>{let r=src_tsvb_a(t,e);return"string"==typeof r?r:r[0]},tsvb_$t=(t,e=1)=>{let r=src_tsvb_a(t,e);return"string"==typeof r?r:r[1]},tsvb_F=t=>0===t.length?[]:[{type:"uint32",data:t},{type:"uint32",data:tsvb_ort_webgpu_min_N.computeStrides(t)}],tsvb_He=t=>t%4==0?4:t%2==0?2:1,tsvb_Je=(t="f32",e,r="0")=>e&&1!==e?`vec${e}<${t}>(${r})`:`${t}(${r})`,tsvb_ht=(t,e,r)=>"f32"===t?r:1===e?`f32(${r})`:`vec${e}f(${r})`,tsvb_st=(t,e)=>4===e?`(${t}.x + ${t}.y + ${t}.z + ${t}.w)`:2===e?`(${t}.x + ${t}.y)`:3===e?`(${t}.x + ${t}.y + ${t}.z)`:t,tsvb_le=(t,e,r)=>t.startsWith("uniforms.")&&r>4?"string"==typeof e?`${t}[(${e}) / 4][(${e}) % 4]`:`${t}[${Math.floor(e/4)}][${e%4}]`:r>1?`${t}[${e}]`:t,tsvb_xa=(t,e,r,n,i)=>{let s="number"==typeof r,o=s?r:r.length,a=[...new Array(o).keys()],u=o<2?"u32":o<=4?`vec${o}<u32>`:`array<u32, ${o}>`,l=src_tsvb_a(e,i),c="string"==typeof l?l:l[1],h="string"==typeof l?l:l[0],f={indices:u,value:c,storage:h,tensor:e},d=t=>"string"==typeof t?t:`${t}u`,p={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},v=s?"uniforms.":"",y=`${v}${t}_shape`,b=`${v}${t}_strides`,_="";for(let t=0;t<o-1;t++)_+=`\n    let dim${t} = current / ${tsvb_le(b,t,o)};\n    let rest${t} = current % ${tsvb_le(b,t,o)};\n    indices[${t}] = dim${t};\n    current = rest${t};\n    `;_+=`indices[${o-1}] = current;`;let m=o<2?"":`\n  fn o2i_${t}(offset: u32) -> ${f.indices} {\n    var indices: ${f.indices};\n    var current = offset;\n    ${_}\n    return indices;\n  }`,g=[];if(o>=2)for(let t=o-1;t>=0;t--)g.push(`${tsvb_le(b,t,o)} * (indices[${t}])`);let w=o<2?"":`\n  fn i2o_${t}(indices: ${f.indices}) -> u32 {\n    return ${g.join("+")};\n  }`,x=(...t)=>0===o?"0u":`${f.indices}(${t.map(d).join(",")})`,T=(t,e)=>o<2?`${t}`:`${tsvb_le(t,e,o)}`,S={},E=(e,r)=>(()=>{if(f.storage===f.value)return`${t}[${e}]=${r};`;if("vec2<u32>"===f.storage&&"i32"===f.value)return`${t}[${e}]=vec2<u32>(u32(${r}), select(0u, 0xFFFFFFFFu, ${r} < 0));`;if("vec2<u32>"===f.storage&&"u32"===f.value)return`${t}[${e}]=vec2<u32>(u32(${r}), 0u);`;if("u32"===f.storage&&"vec4<bool>"===f.value)return`${t}[${e}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${r}));`;throw new Error(`not supported combination of storage type ${f.storage} and value type ${f.value} yet`)})(),O=e=>(()=>{if(f.storage===f.value)return`${t}[${e}]`;if("vec2<u32>"===f.storage&&"i32"===f.value)return`i32(${t}[${e}].x)`;if("vec2<u32>"===f.storage&&"u32"===f.value)return`u32(${t}[${e}].x)`;if("u32"===f.storage&&"vec4<bool>"===f.value)return`vec4<bool>(bool(${t}[${e}] & 0xFFu), bool(${t}[${e}] & 0xFF00u), bool(${t}[${e}] & 0xFF0000u), bool(${t}[${e}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${f.storage} and value type ${f.value} yet`)})(),P=o<2?"":`\n  fn get_${t}ByIndices(indices: ${f.indices}) -> ${c} {\n    return ${O(`i2o_${t}(indices)`)};\n  }`,A=o<2?"":(()=>{let e=a.map((t=>`d${t}: u32`)).join(", "),r=a.map((t=>`d${t}`)).join(", ");return`\n  fn get_${t}(${e}) -> ${c} {\n    return get_${t}ByIndices(${x(r)});\n  }`})(),C=o<2?"":`\n  fn set_${t}ByIndices(indices: ${f.indices}, value: ${c}) {\n    ${E(`i2o_${t}(indices)`,"value")}\n  }`,k=o<2?"":(()=>{let e=a.map((t=>`d${t}: u32`)).join(", "),r=a.map((t=>`d${t}`)).join(", ");return`\n  fn set_${t}(${e}, value: ${c}) {\n    set_${t}ByIndices(${x(r)}, value);\n  }`})();return{impl:()=>{let t=[],e=!1;return p.offsetToIndices&&(t.push(m),e=!0),p.indicesToOffset&&(t.push(w),e=!0),p.broadcastedIndicesToOffset&&(Object.values(S).forEach((e=>t.push(e))),e=!0),p.set&&(t.push(k),e=!0),p.setByIndices&&(t.push(C),e=!0),p.get&&(t.push(A),e=!0),p.getByIndices&&(t.push(P),e=!0),!s&&e&&t.unshift(`const ${y} = ${f.indices}(${r.join(",")});`,`const ${b} = ${f.indices}(${tsvb_ort_webgpu_min_N.computeStrides(r).join(",")});`),t.join("\n")},type:f,offsetToIndices:e=>(p.offsetToIndices=!0,o<2?e:`o2i_${t}(${e})`),indicesToOffset:e=>(p.indicesToOffset=!0,o<2?e:`i2o_${t}(${e})`),broadcastedIndicesToOffset:(e,r)=>{p.broadcastedIndicesToOffset=!0;let n=`${r.name}broadcastedIndicesTo${t}Offset`;if(n in S)return`${n}(${e})`;let i=[];for(let t=o-1;t>=0;t--){let e=r.indicesGet("outputIndices",t+r.rank-o);i.push(`${T(b,t)} * (${e} % ${T(y,t)})`)}return S[n]=`fn ${n}(outputIndices: ${r.type.indices}) -> u32 {\n             return ${i.length>0?i.join("+"):"0u"};\n           }`,`${n}(${e})`},indices:x,indicesGet:T,indicesSet:(t,e,r)=>o<2?`${t}=${r};`:`${tsvb_le(t,e,o)}=${r};`,set:(...e)=>{if(e.length!==o+1)throw new Error(`indices length must be ${o}`);let r=e[o];if("string"!=typeof r)throw new Error("value must be string");let n=e.slice(0,o).map(d).join(",");return 0===o?E("0u",r):1===o?E(n[0],r):(p.set=!0,p.setByIndices=!0,p.indicesToOffset=!0,`set_${t}(${n}, ${r})`)},setByOffset:E,setByIndices:(e,r)=>o<2?E(e,r):(p.setByIndices=!0,p.indicesToOffset=!0,`set_${t}ByIndices(${e}, ${r});`),get:(...e)=>{if(e.length!==o)throw new Error(`indices length must be ${o}`);let r=e.map(d).join(",");return 0===o?O("0u"):1===o?O(r[0]):(p.get=!0,p.getByIndices=!0,p.indicesToOffset=!0,`get_${t}(${r})`)},getByOffset:O,getByIndices:e=>o<2?O(e):(p.getByIndices=!0,p.indicesToOffset=!0,`get_${t}ByIndices(${e})`),usage:n,name:t,strides:b,shape:y,rank:o}},tsvb_z=(t,e,r,n=1)=>tsvb_xa(t,e,r,"input",n),tsvb_ort_webgpu_min_j=(t,e,r,n=1)=>tsvb_xa(t,e,r,"output",n),src_tsvb_n=(t,e,r,n=1)=>tsvb_xa(t,e,r,"internal",n),tsvb_$a=class{constructor(t){this.normalizedDispatchGroup=t,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(t){return`if (global_idx >= ${"number"==typeof t?`${t}u`:t}) { return; }`}mainStart(t=tsvb_kd){let e="number"==typeof t?t:t[0],r="number"==typeof t?1:t[1],n="number"==typeof t?1:t[2],i=1===this.normalizedDispatchGroup[1]&&1===this.normalizedDispatchGroup[2];return`@compute @workgroup_size(${e}, ${r}, ${n})\n  fn main(${i?"@builtin(global_invocation_id) global_id : vec3<u32>,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(local_invocation_id) local_id : vec3<u32>":"@builtin(local_invocation_id) local_id : vec3<u32>,\n    @builtin(local_invocation_index) local_idx : u32,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(num_workgroups) num_workgroups : vec3<u32>"}) {\n    ${i?"let global_idx = global_id.x; let local_idx = local_id.x;":`let global_idx = (workgroup_id.z * num_workgroups[0] * num_workgroups[1] +\n          workgroup_id.y * num_workgroups[0] + workgroup_id.x) * ${e*r*n}u + local_idx;`}\n  `}appendVariableUniforms(t){0!==t.rank&&(t.shape.startsWith("uniforms.")&&this.uniforms.push({name:t.shape.replace("uniforms.",""),type:"u32",length:t.rank}),t.strides.startsWith("uniforms.")&&this.uniforms.push({name:t.strides.replace("uniforms.",""),type:"u32",length:t.rank}))}declareVariable(t,e){if("internal"===t.usage)throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(t),this.appendVariableUniforms(t);let r="input"===t.usage?"read":"read_write",n=t.type.storage;return`@group(0) @binding(${e}) var<storage, ${r}> ${t.name}: array<${n}>;`}declareVariables(...t){return t.map((t=>this.declareVariable(t,this.variableIndex++))).join("\n")}registerInternalVariable(t){if("internal"!==t.usage)throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(t),this.appendVariableUniforms(t)}registerInternalVariables(...t){return t.forEach((t=>this.registerInternalVariable(t))),this}registerUniform(t,e,r=1){return this.uniforms.push({name:t,type:e,length:r}),this}registerUniforms(t){return this.uniforms=this.uniforms.concat(t),this}uniformDeclaration(){if(0===this.uniforms.length)return"";let t=[];for(let{name:e,type:r,length:n}of this.uniforms)if(n&&n>4)t.push(`${e}:array<vec4<${r}>, ${Math.ceil(n/4)}>`);else{let i=null==n||1===n?r:`vec${n}<${r}>`;t.push(`${e}:${i}`)}return`\n      struct Uniforms { ${t.join(", ")} };\n      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map((t=>t.impl())).join("\n")+this.internalVariables.map((t=>t.impl())).join("\n")}},tsvb_po=t=>new tsvb_$a(t),tsvb_fr=(t,e)=>{let r=t.length,n=[];for(let i=0;i<r;i++){let s=r-1-i,o=t[s]||1;(e[e.length-1-i]||1)>1&&1===o&&n.unshift(s)}return n},tsvb_Ue=t=>!0})),tsvb_Bd,tsvb_mo,tsvb_Pd,tsvb_Rd,tsvb_gt,tsvb_fo,tsvb_ho,tsvb_hr=tsvb_q((()=>{tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_Bd=t=>{if(!t||1!==t.length)throw new Error("Transpose requires 1 input.")},tsvb_mo=(t,e)=>e&&e.length!==t?[...new Array(t).keys()].reverse():e,tsvb_Pd=(t,e)=>tsvb_ort_webgpu_min_N.sortBasedOnPerm(t,tsvb_mo(t.length,e)),tsvb_Rd=(t,e,r,n)=>{let i=[];i.push(`fn perm(i: ${n.type.indices}) -> ${r.type.indices} {\n    var a: ${r.type.indices};`);for(let n=0;n<e;++n)i.push(r.indicesSet("a",t[n],`i[${n}]`));return i.push("return a;}"),i.join("\n")},tsvb_gt=(t,e)=>{let r=t.dataType,n=t.dims.length,i=tsvb_mo(n,e),s=tsvb_Ue(n),o=tsvb_Pd(t.dims,i),a=s?o.length:o,u=s?n:t.dims,l=tsvb_ort_webgpu_min_j("output",r,a),c=tsvb_z("a",r,u);return{name:"Transpose",shaderCache:{hint:`${e}`,inputDependencies:s?["rank"]:["dims"]},getRunData:t=>{let e=tsvb_ort_webgpu_min_N.size(o);return{outputs:[{dims:o,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(e/64)},programUniforms:s?[{type:"uint32",data:e},...tsvb_F(t[0].dims),...tsvb_F(o)]:[{type:"uint32",data:e}]}},getShaderSource:t=>`\n  ${t.registerUniform("output_size","u32").declareVariables(c,l)}\n\n  ${tsvb_Rd(i,n,c,l)}\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let indices = ${l.offsetToIndices("global_idx")};\n    let aIndices = perm(indices);\n\n    ${l.setByOffset("global_idx",c.getByIndices("aIndices"))}\n  }`}},tsvb_fo=(t,e)=>{tsvb_Bd(t.inputs),t.compute(tsvb_gt(t.inputs[0],e.perm))},tsvb_ho=t=>tsvb_he({perm:t.perm})})),tsvb_Dd,tsvb_Md,tsvb_zd,tsvb_Ud,tsvb_Nd,tsvb_Wd,tsvb_Vd,tsvb_Gd,tsvb_Ld,tsvb_Hd,src_tsvb_t,tsvb_go,tsvb_yo,tsvb_bo,tsvb_wo,tsvb_vo,tsvb_$o,src_tsvb_o,tsvb_xo,tsvb_So,tsvb_Io,tsvb_Co=tsvb_q((()=>{tsvb_xe(),tsvb_$e(),tsvb_xn(),tsvb_hr(),tsvb_Dd={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},tsvb_Md={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},tsvb_zd={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},tsvb_Ud={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},tsvb_Nd=(t,e)=>{let r=[];for(let n=e-t;n<e;++n)r.push(n);return r},tsvb_Wd=(t,e)=>{let r=[],n=t.length;for(let i=0;i<n;i++)-1===e.indexOf(i)&&r.push(t[i]);return[r,e.map((e=>t[e]))]},tsvb_Vd=(t,e)=>{let r=t.length+e.length,n=[],i=0;for(let s=0;s<r;s++)-1===e.indexOf(s)?n.push(t[i++]):n.push(1);return n},tsvb_Gd=(t,e)=>{for(let r=0;r<t.length;++r)if(t[t.length-r-1]!==e-1-r)return!1;return!0},tsvb_Ld=(t,e)=>{let r=[];if(!tsvb_Gd(t,e)){for(let n=0;n<e;++n)-1===t.indexOf(n)&&r.push(n);t.forEach((t=>r.push(t)))}return r},tsvb_Hd=(t,e,r,n,i,s,o)=>{let a=r[0].dims,u=tsvb_ort_webgpu_min_N.size(s),l=tsvb_ort_webgpu_min_N.size(o),c=tsvb_z("_A",r[0].dataType,a),h=tsvb_ort_webgpu_min_j("output",i,s),f=`\n          var<workgroup> aBestValues : array<${h.type.storage}, 32>;\n       `;return{name:t,shaderCache:e,getShaderSource:t=>`\n        ${t.registerUniform("reduceSize","u32").declareVariables(c,h)}\n        ${f}\n        fn DIV_CEIL(a : u32, b : u32) -> u32 {\n          return ((a - 1u) / b + 1u);\n         }\n         ${t.mainStart(32)}\n\n          let outputIndex = global_idx / 32;\n          let offset = outputIndex * uniforms.reduceSize;\n\n          var bestValue = ${h.type.storage}(${tsvb_zd[n]});\n          let Length = uniforms.reduceSize;\n          for (var k = local_idx; k < Length; k = k + 32) {\n           let candidate = ${h.type.storage}(${c.getByOffset("offset + k")});\n           bestValue = ${tsvb_Dd[n]};\n          }\n          aBestValues[local_idx] = bestValue;\n          workgroupBarrier();\n\n         var reduceSize = min(Length, 32u);\n         for (var currentSize = reduceSize / 2u; reduceSize > 1u;\n             currentSize = reduceSize / 2u) {\n           let interval = DIV_CEIL(reduceSize, 2u);\n           if (local_idx < currentSize) {\n            let candidate = aBestValues[local_idx + interval];\n            bestValue = ${tsvb_Md[n]};\n            aBestValues[local_idx] = bestValue;\n           }\n           reduceSize = interval;\n           workgroupBarrier();\n         }\n\n         if (local_idx == 0u) {\n          ${h.setByOffset("outputIndex",""+("mean"===n?`bestValue / ${h.type.storage}(uniforms.reduceSize)`:`${tsvb_Ud[n]}`))};\n         }\n        }`,getRunData:()=>({outputs:[{dims:s,dataType:i}],dispatchGroup:{x:u},programUniforms:[{type:"uint32",data:l}]})}},src_tsvb_t=(t,e,r,n)=>{let i=1===t.inputs.length?r:tsvb_Sa(t.inputs,r),s=i.axes;0===s.length&&!i.noopWithEmptyAxes&&(s=t.inputs[0].dims.map(((t,e)=>e)));let o=tsvb_ort_webgpu_min_N.normalizeAxes(s,t.inputs[0].dims.length),a=o,u=t.inputs[0],l=tsvb_Ld(a,t.inputs[0].dims.length);l.length>0&&(u=t.compute(tsvb_gt(t.inputs[0],l),{inputs:[0],outputs:[-1]})[0],a=tsvb_Nd(a.length,u.dims.length));let[c,h]=tsvb_Wd(u.dims,a),f=c;i.keepDims&&(f=tsvb_Vd(c,o)),t.compute(tsvb_Hd(e,{hint:i.cacheKey,inputDependencies:["type"]},[u],n,t.inputs[0].dataType,f,h),{inputs:[u]})},tsvb_go=(t,e)=>{src_tsvb_t(t,"ReduceMeanShared",e,"mean")},tsvb_yo=(t,e)=>{src_tsvb_t(t,"ReduceL1Shared",e,"l1")},tsvb_bo=(t,e)=>{src_tsvb_t(t,"ReduceL2Shared",e,"l2")},tsvb_wo=(t,e)=>{src_tsvb_t(t,"ReduceLogSumExpShared",e,"logSumExp")},tsvb_vo=(t,e)=>{src_tsvb_t(t,"ReduceMaxShared",e,"max")},tsvb_$o=(t,e)=>{src_tsvb_t(t,"ReduceMinShared",e,"min")},src_tsvb_o=(t,e)=>{src_tsvb_t(t,"ReduceProdShared",e,"prod")},tsvb_xo=(t,e)=>{src_tsvb_t(t,"ReduceSumShared",e,"sum")},tsvb_So=(t,e)=>{src_tsvb_t(t,"ReduceSumSquareShared",e,"sumSquare")},tsvb_Io=(t,e)=>{src_tsvb_t(t,"ReduceLogSumShared",e,"logSum")}})),tsvb_xt,tsvb_Fd,tsvb_Sn,tsvb_Sa,tsvb_St,tsvb_qd,tsvb_jd,tsvb_Kd,tsvb_Yd,tsvb_Zd,tsvb_Qd,tsvb_Xd,tsvb_Jd,tsvb_ec,tsvb_tc,tsvb_It,tsvb_Ao,tsvb_To,tsvb_Eo,tsvb_Oo,tsvb_ko,tsvb_Bo,tsvb_Po,tsvb_Ro,tsvb_Do,tsvb_Mo,tsvb_xn=tsvb_q((()=>{tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_Co(),tsvb_xt=t=>{if(!t||0===t.length||t.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(2===t.length&&1!==t[1].dims.length)throw new Error("Invalid axes input dims.")},tsvb_Fd=t=>["","",`var value = ${t.getByIndices("input_indices")};`,""],tsvb_Sn=(t,e,r,n,i,s,o=!1,a=!1)=>{let u=[],l=r[0].dims,c=l.length,h=tsvb_ort_webgpu_min_N.normalizeAxes(i,c),f=!a&&0===h.length;l.forEach(((t,e)=>{f||h.indexOf(e)>=0?o&&u.push(1):u.push(t)}));let d=u.length,p=tsvb_ort_webgpu_min_N.size(u);return{name:t,shaderCache:e,getShaderSource:t=>{let e=[],i=tsvb_z("_A",r[0].dataType,c),a=tsvb_ort_webgpu_min_j("output",s,d),u=n(i,a,h),p=u[2];for(let t=0,r=0;t<c;t++)f||h.indexOf(t)>=0?(o&&r++,p=`for(var j${t}: u32 = 0; j${t} < ${l[t]}; j${t}++) {\n                  ${u[2].includes("last_index")?`let last_index = j${t};`:""}\n                  ${i.indicesSet("input_indices",t,`j${t}`)}\n                  ${p}\n                }`):(e.push(`${i.indicesSet("input_indices",t,a.indicesGet("output_indices",r))};`),r++);return`\n\n        ${t.registerUniform("output_size","u32").declareVariables(i,a)}\n\n        ${t.mainStart()}\n          ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n          var input_indices: ${i.type.indices};\n          let output_indices = ${a.offsetToIndices("global_idx")};\n\n          ${e.join("\n")}\n          ${u[0]}       // init ops for reduce max/min\n          ${u[1]}\n          ${p}\n          ${u[3]}\n          ${4===u.length?a.setByOffset("global_idx","value"):u.slice(4).join("\n")}\n        }`},getRunData:()=>({outputs:[{dims:u,dataType:s}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:[{type:"uint32",data:p},...tsvb_F(l),...tsvb_F(u)]})}},tsvb_Sa=(t,e)=>{let r=[];return t[1].dims[0]>0&&t[1].getBigInt64Array().forEach((t=>r.push(Number(t)))),tsvb_he({axes:r,keepDims:e.keepDims,noopWithEmptyAxes:e.noopWithEmptyAxes})},tsvb_St=(t,e,r,n)=>{let i=t.inputs,s=1===i.length?r:tsvb_Sa(i,r);t.compute(tsvb_Sn(e,{hint:s.cacheKey,inputDependencies:["rank"]},[i[0]],s.noopWithEmptyAxes&&0===s.axes.length?tsvb_Fd:n,s.axes,i[0].dataType,s.keepDims,s.noopWithEmptyAxes),{inputs:[0]})},tsvb_qd=(t,e)=>{tsvb_xt(t.inputs),tsvb_St(t,"ReduceLogSum",e,((t,e)=>[`var value = ${e.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,"value = log(value);"]))},tsvb_jd=(t,e)=>{tsvb_xt(t.inputs),tsvb_St(t,"ReduceL1",e,((t,e)=>[`var value = ${e.type.storage}(0);`,"",`value += abs(${t.getByIndices("input_indices")});`,""]))},tsvb_Kd=(t,e)=>{tsvb_xt(t.inputs),tsvb_St(t,"ReduceL2",e,((t,e)=>[`var t = ${e.type.value}(0); var value = ${e.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"]))},tsvb_Yd=(t,e)=>{tsvb_xt(t.inputs),tsvb_St(t,"ReduceLogSumExp",e,((t,e)=>[`var value = ${e.type.storage}(0);`,"",`value += exp(${t.getByIndices("input_indices")});`,"value = log(value);"]))},tsvb_Zd=(t,e)=>{tsvb_xt(t.inputs),tsvb_St(t,"ReduceMax",e,((t,e,r)=>{let n=[];for(let e=0;e<t.rank;e++)(r.indexOf(e)>=0||0===r.length)&&n.push(t.indicesSet("input_indices",e,0));return[`${n.join("\n")}`,`var value = ${t.getByIndices("input_indices")};`,`value = max(value, ${t.getByIndices("input_indices")});`,""]}))},tsvb_Qd=(t,e)=>{tsvb_xt(t.inputs),tsvb_St(t,"ReduceMean",e,((e,r,n)=>{let i=1;for(let r=0;r<e.rank;r++)(n.indexOf(r)>=0||0===n.length)&&(i*=t.inputs[0].dims[r]);return["var sum = f32(0);","",`sum += f32(${e.getByIndices("input_indices")});`,`let value = ${r.type.value}(sum / ${i});`]}))},tsvb_Xd=(t,e)=>{tsvb_xt(t.inputs),tsvb_St(t,"ReduceMin",e,((t,e,r)=>{let n=[];for(let e=0;e<t.rank;e++)(r.indexOf(e)>=0||0===r.length)&&n.push(`input_indices[${e}] = 0;`);return[`${n.join("\n")}`,`var value = ${t.getByIndices("input_indices")};`,`value = min(value, ${t.getByIndices("input_indices")});`,""]}))},tsvb_Jd=(t,e)=>{tsvb_xt(t.inputs),tsvb_St(t,"ReduceProd",e,((t,e)=>[`var value = ${e.type.storage}(1);`,"",`value *= ${t.getByIndices("input_indices")};`,""]))},tsvb_ec=(t,e)=>{tsvb_xt(t.inputs),tsvb_St(t,"ReduceSum",e,((t,e)=>[`var value = ${e.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,""]))},tsvb_tc=(t,e)=>{tsvb_xt(t.inputs),tsvb_St(t,"ReduceSumSquare",e,((t,e)=>[`var t = ${e.type.value}(0); var value = ${e.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += t * t;`,""]))},tsvb_It=(t,e,r)=>{if(0===e.length)return r;let n=1,i=1;for(let r=0;r<e.length;r++)-1===e.indexOf(r)?n*=t[r]:i*=t[r];return i<32&&n>1024},tsvb_Ao=(t,e)=>{tsvb_It(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tsvb_Qd(t,e):tsvb_go(t,e)},tsvb_To=(t,e)=>{tsvb_It(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tsvb_jd(t,e):tsvb_yo(t,e)},tsvb_Eo=(t,e)=>{tsvb_It(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tsvb_Kd(t,e):tsvb_bo(t,e)},tsvb_Oo=(t,e)=>{tsvb_It(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tsvb_Yd(t,e):tsvb_wo(t,e)},tsvb_ko=(t,e)=>{tsvb_It(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tsvb_Zd(t,e):tsvb_vo(t,e)},tsvb_Bo=(t,e)=>{tsvb_It(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tsvb_Xd(t,e):tsvb_$o(t,e)},tsvb_Po=(t,e)=>{tsvb_It(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tsvb_Jd(t,e):src_tsvb_o(t,e)},tsvb_Ro=(t,e)=>{tsvb_It(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tsvb_ec(t,e):tsvb_xo(t,e)},tsvb_Do=(t,e)=>{tsvb_It(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tsvb_tc(t,e):tsvb_So(t,e)},tsvb_Mo=(t,e)=>{tsvb_It(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tsvb_qd(t,e):tsvb_Io(t,e)}})),tsvb_zo,tsvb_Uo,tsvb_No,tsvb_Ia,tsvb_Wo=tsvb_q((()=>{tsvb_Ve(),tsvb_Fe(),tsvb_xn(),tsvb_zo=t=>{if(!t||0===t.length||t.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(1!==t[0].dataType)throw new Error("Invalid input type.")},tsvb_Uo=(t,e)=>{tsvb_zo(t.inputs);t.compute(tsvb_Sn("ArgMin",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],((t,r,n)=>{let i=[];for(let e=0;e<t.rank;e++)(n.indexOf(e)>=0||0===n.length)&&i.push(`input_indices[${e}] = 0;`);return[`${i.join("\n")}`,`var value = ${t.getByIndices("input_indices")};\nvar best_index : i32 = 0;`,`if (${t.getByIndices("input_indices")} ${e.selectLastIndex>0?"<=":"<"} value) {\n         value = ${t.getByIndices("input_indices")};\n         best_index = i32(last_index);\n       }`,"",r.setByOffset("global_idx","best_index")]}),[e.axis],7,e.keepDims),{inputs:[0]})},tsvb_No=(t,e)=>{tsvb_zo(t.inputs);t.compute(tsvb_Sn("argMax",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],((t,r,n)=>{let i=[];for(let e=0;e<t.rank;e++)(n.indexOf(e)>=0||0===n.length)&&i.push(`input_indices[${e}] = 0;`);return[`${i.join("\n")}`,`var value = ${t.getByIndices("input_indices")};\nvar best_index : i32 = 0;`,`if (${t.getByIndices("input_indices")} ${e.selectLastIndex>0?">=":">"} value) {\n         value = ${t.getByIndices("input_indices")};\n         best_index = i32(last_index);\n       }`,"",r.setByOffset("global_idx","best_index")]}),[e.axis],7,e.keepDims),{inputs:[0]})},tsvb_Ia=t=>tsvb_he(t)})),tsvb_rc,tsvb_nc,tsvb_ac,tsvb_ic,tsvb_In,tsvb_oc,tsvb_Vo,tsvb_Ca=tsvb_q((()=>{tsvb_Ve(),tsvb_yn(),tsvb_$e(),tsvb_rc=(t,e)=>{let r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5];if(o&&a)throw new Error("Attention cannot have both past and relative_position_bias");if(3!==r.dims.length)throw new Error('Input "input" must have 3 dimensions');let u=r.dims[0],l=r.dims[1],c=r.dims[2];if(1!==i.dims.length)throw new Error('Input "bias" is expected to have 1 dimensions');if(2!==n.dims.length)throw new Error('Input "weights" is expected to have 2 dimensions');if(n.dims[0]!==c)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(i.dims[0]!==n.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let h=i.dims[0]/3,f=h,d=f;if(e.qkvHiddenSizes.length>0){if(3!==e.qkvHiddenSizes.length)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let t of e.qkvHiddenSizes)if(t%e.numHeads!=0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");h=e.qkvHiddenSizes[0],f=e.qkvHiddenSizes[1],d=e.qkvHiddenSizes[2]}let p=l;if(h!==f)throw new Error("qkv_hidden_sizes first element should be same as the second");if(i.dims[0]!==h+f+d)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let v=0;if(o){if(f!==d)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(5!==o.dims.length)throw new Error('Input "past" must have 5 dimensions');if(2!==o.dims[0])throw new Error('Input "past" first dimension must be 2');if(o.dims[1]!==u)throw new Error('Input "past" second dimension must be batch_size');if(o.dims[2]!==e.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(o.dims[4]!==f/e.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');e.pastPresentShareBuffer||(v=o.dims[3])}let y=p+v;if(s)throw new Error("Mask not supported");if(o)throw new Error("past is not supported");if(a)throw new Error("relativePositionBias is not supported");return{batchSize:u,sequenceLength:l,pastSequenceLength:v,kvSequenceLength:p,totalSequenceLength:y,maxSequenceLength:-1,inputHiddenSize:c,hiddenSize:h,vHiddenSize:d,headSize:Math.floor(h/e.numHeads),vHeadSize:Math.floor(d/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:0,scale:e.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},tsvb_nc=(t,e,r,n)=>{let i=tsvb_He(n),s=64,o=n/i;o<s?s=1:o/8<64&&(s=Math.ceil(o/8));let a=Math.ceil(n/i/s),u=[{type:tsvb_ot(e.dataType),data:1/n},{type:"uint32",data:o},{type:"uint32",data:a}],l=tsvb_Le(e.dataType,i);t.compute({name:"AttentionProbsSoftmax",shaderCache:{hint:`${s};${l};${i}`},getShaderSource:t=>{let r=tsvb_ort_webgpu_min_j("x",e.dataType,e.dims,i),n="thread_max_vector";2===i?n="max(thread_max_vector.x, thread_max_vector.y)":4===i&&(n="max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))");let o=tsvb_$t(e.dataType),a=[{name:"d_inv",type:o},{name:"d_comp",type:"u32"},{name:"elements_per_wg",type:"u32"}];return`\n  var<workgroup> wgMax: array<f32, ${s}>;\n  var<workgroup> wgSum: array<f32, ${s}>;\n  ${t.registerUniforms(a).declareVariables(r)}\n  ${t.mainStart([s,1,1])}\n    let localOffset = local_idx * uniforms.elements_per_wg;\n    let offset: u32 = workgroup_id.x * uniforms.d_comp + localOffset;\n\n    var thread_max_vector = ${tsvb_Je("f32",i,"-3.402823e+38f")};\n    for (var i: u32 = 0; i < uniforms.elements_per_wg && i + localOffset < uniforms.d_comp; i++) {\n      thread_max_vector = max(${tsvb_ht(o,i,"x[offset + i]")}, thread_max_vector);\n    }\n    wgMax[local_idx] = ${n};\n    workgroupBarrier();\n\n    var maxValue = -3.402823e+38f;\n    for (var i = 0u; i < ${s}; i++) {\n      maxValue = max(wgMax[i], maxValue);\n    }\n\n    var sumVector = ${tsvb_Je("f32",i,"0")};\n    for (var i: u32 = 0; i < uniforms.elements_per_wg && i + localOffset < uniforms.d_comp; i++) {\n      sumVector += exp(${tsvb_ht(o,i,"x[offset + i]")} - maxValue);\n    }\n    wgSum[local_idx] = ${tsvb_st("sumVector",i)};\n    workgroupBarrier();\n\n    var sum: f32 = 0;\n    for (var i = 0u; i < ${s}; i++) {\n      sum += wgSum[i];\n    }\n\n    if (sum == 0) {\n      for (var i: u32 = 0; i < uniforms.elements_per_wg && i + localOffset < uniforms.d_comp; i++) {\n        x[offset + i] = ${tsvb_Je("f32",i,"uniforms.d_inv")};\n      }\n    } else {\n      for (var i: u32 = 0; i < uniforms.elements_per_wg && i + localOffset < uniforms.d_comp; i++) {\n        let f32input = ${tsvb_ht(o,i,"x[offset + i]")};\n        x[offset + i] = ${r.type.value}(exp(f32input - maxValue) / sum);\n      }\n    }\n  }`},getRunData:()=>({outputs:[],dispatchGroup:{x:r},programUniforms:u})},{inputs:[e],outputs:[]})},tsvb_ac=(t,e,r,n,i,s)=>{let o=[i.batchSize,i.numHeads,i.sequenceLength,i.kvSequenceLength+i.pastSequenceLength],a=0===s.scale?1/Math.sqrt(i.headSize):s.scale,u=tsvb_He(i.headSize),l=i.headSize/u,c=12,h={x:Math.ceil(i.totalSequenceLength/c),y:Math.ceil(i.sequenceLength/c),z:i.batchSize*i.numHeads},f=tsvb_ot(e.dataType),d=[{type:"uint32",data:i.sequenceLength},{type:"uint32",data:l},{type:"uint32",data:i.totalSequenceLength},{type:"uint32",data:i.kvSequenceLength},{type:f,data:a}],p=[e,r],v=t.compute({name:"AttentionProbs",shaderCache:{hint:`${u}`,inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:o,dataType:e.dataType,gpuDataType:0}],dispatchGroup:h,programUniforms:d}),getShaderSource:t=>{let n=tsvb_z("q",e.dataType,e.dims,u),i=tsvb_z("key",r.dataType,r.dims,u),s=tsvb_ort_webgpu_min_j("output",e.dataType,o),a=tsvb_Le(e.dataType),l=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"alpha",type:a}];return`\n  const beta: ${a} = 1.0;\n  const TILE_SIZE = 12u;\n\n  var<workgroup> tileQ: array<${n.type.storage}, 144>;\n  var<workgroup> tileK: array<${n.type.storage}, 144>;\n  ${t.registerUniforms(l).declareVariables(n,i,s)}\n  ${t.mainStart([c,c,1])}\n    // x holds the N and y holds the M\n    let headIdx = workgroup_id.z;\n    let m = workgroup_id.y * TILE_SIZE;\n    let n = workgroup_id.x * TILE_SIZE;\n    let lm = m + local_id.y;\n    let ln = n + local_id.x;\n\n    let qOffset = uniforms.M * uniforms.K * headIdx + m * uniforms.K;\n    let kOffset = uniforms.kv_sequence_length * uniforms.K * headIdx + n * uniforms.K;\n\n    var value = ${tsvb_Je(a,u)};\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m + local_id.y < uniforms.M && w + local_id.x < uniforms.K) {\n        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];\n      }\n      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {\n        tileK[TILE_SIZE * local_id.y + local_id.x] = key[kOffset + local_id.y * uniforms.K + w + local_id.x];\n      }\n      workgroupBarrier();\n\n      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {\n        value += tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k];\n      }\n\n      workgroupBarrier();\n    }\n\n    let headOffset = headIdx * uniforms.M * uniforms.N;\n    if (lm < uniforms.M && ln < uniforms.N) {\n      let outputIdx = headOffset + lm * uniforms.N + ln;\n      output[outputIdx] = ${tsvb_st("value",u)} * uniforms.alpha;\n    }\n  }`}},{inputs:p,outputs:[-1]})[0];return tsvb_nc(t,v,i.batchSize*i.numHeads*i.sequenceLength,i.totalSequenceLength),v},tsvb_ic=(t,e,r,n)=>{let i=[n.batchSize,n.sequenceLength,n.vHiddenSize],s=12,o={x:Math.ceil(n.vHeadSize/s),y:Math.ceil(n.sequenceLength/s),z:n.batchSize*n.numHeads},a=[{type:"uint32",data:n.sequenceLength},{type:"uint32",data:n.totalSequenceLength},{type:"uint32",data:n.vHeadSize},{type:"uint32",data:n.numHeads},{type:"uint32",data:n.vHiddenSize}];return t.compute({name:"AttentionScore",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:i,dataType:e.dataType,gpuDataType:0}],dispatchGroup:o,programUniforms:a}),getShaderSource:t=>{let n=tsvb_z("probs",e.dataType,e.dims),o=tsvb_z("v",r.dataType,r.dims),a=tsvb_ort_webgpu_min_j("output",e.dataType,i);return`\n  const TILE_SIZE = 12u;\n  var<workgroup> tileQ: array<${n.type.value}, 144>;\n  var<workgroup> tileK: array<${n.type.value}, 144>;\n  ${t.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"v_hidden_size",type:"u32"}]).declareVariables(n,o,a)}\n  ${t.mainStart([s,s,1])}\n   let headIdx = workgroup_id.z;\n   let m = workgroup_id.y * TILE_SIZE + local_id.y;\n   let n = workgroup_id.x * TILE_SIZE + local_id.x;\n\n   let offsetA = headIdx * (uniforms.M * uniforms.K) + m * uniforms.K;\n   let offsetB = headIdx * (uniforms.N * uniforms.K) + n;\n\n   var value = ${n.type.storage}(0);\n   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n     if (m < uniforms.M && w + local_id.x < uniforms.K) {\n       tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];\n     }\n     if (n < uniforms.N && w + local_id.y < uniforms.K) {\n       tileK[TILE_SIZE * local_id.y + local_id.x] = v[offsetB + (w + local_id.y) * uniforms.N];\n     }\n     workgroupBarrier();\n     for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {\n       value += tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * k + local_id.x];\n     }\n     workgroupBarrier();\n   }\n\n   // we need to transpose output from BNSH_v to BSND_v\n   let batchIdx = workgroup_id.z / uniforms.num_heads;\n   let currentBatchHeadNumber = workgroup_id.z % uniforms.num_heads;\n   let headOffset = (batchIdx * uniforms.M * uniforms.num_heads + currentBatchHeadNumber) * uniforms.N;\n   if (m < uniforms.M && n < uniforms.N) {\n     let outputIdx = batchIdx * uniforms.M *uniforms.v_hidden_size + m * uniforms.v_hidden_size\n       + currentBatchHeadNumber * uniforms.N + n;\n     output[outputIdx] = value;\n   }\n  }`}},{inputs:[e,r],outputs:[0]})[0]},tsvb_In=(t,e,r,n,i,s,o,a,u,l,c)=>{let h=tsvb_ac(t,e,r,u,l,c);tsvb_ic(t,h,n,l)},tsvb_oc=(t,e)=>{let r=[e.batchSize,e.numHeads,e.sequenceLength,e.headSize],n=e.sequenceLength,i=e.inputHiddenSize,s=e.headSize,o=12,a={x:Math.ceil(e.headSize/o),y:Math.ceil(e.sequenceLength/o),z:e.batchSize*e.numHeads},u=[t.inputs[0],t.inputs[1],t.inputs[2]],l=[{type:"uint32",data:n},{type:"uint32",data:i},{type:"uint32",data:s},{type:"uint32",data:e.numHeads},{type:"uint32",data:e.headSize},{type:"uint32",data:e.hiddenSize},{type:"uint32",data:e.hiddenSize+e.hiddenSize+e.vHiddenSize}];return t.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:r,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:t.inputs[0].dataType,gpuDataType:0}],dispatchGroup:a,programUniforms:l}),getShaderSource:t=>{let e=tsvb_ort_webgpu_min_j("output_q",u[0].dataType,r),n=tsvb_ort_webgpu_min_j("output_k",u[0].dataType,r),i=tsvb_ort_webgpu_min_j("output_v",u[0].dataType,r),s=tsvb_z("input",u[0].dataType,u[0].dims),a=tsvb_z("weight",u[1].dataType,u[1].dims),l=tsvb_z("bias",u[2].dataType,u[2].dims),c=s.type.storage;return`\n  const TILE_SIZE = 12u;\n  var<workgroup> tileInput: array<${c}, 144>;\n  var<workgroup> tileWeightQ: array<${c}, 144>;\n  var<workgroup> tileWeightK: array<${c}, 144>;\n  var<workgroup> tileWeightV: array<${c}, 144>;\n  ${t.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}]).declareVariables(s,a,l,e,n,i)}\n  ${t.mainStart([o,o,1])}\n    let batchIndex = workgroup_id.z / uniforms.num_heads;\n    let headNumber = workgroup_id.z % uniforms.num_heads;\n    let m = workgroup_id.y * TILE_SIZE + local_id.y;\n    let n = workgroup_id.x * TILE_SIZE + local_id.x;\n\n    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;\n    let biasOffsetQ = headNumber * uniforms.head_size;\n    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;\n    let biasOffsetV = uniforms.hidden_size + biasOffsetK;\n\n    var valueQ = ${c}(0);\n    var valueK = ${c}(0);\n    var valueV = ${c}(0);\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m < uniforms.M && w + local_id.x < uniforms.K) {\n        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];\n      }\n      if (n < uniforms.N && w + local_id.y < uniforms.K) {\n        let offset = n + (w + local_id.y) * uniforms.ldb;\n        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];\n        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];\n        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];\n      }\n      workgroupBarrier();\n      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {\n        let inputTileOffset = TILE_SIZE * local_id.y + k;\n        let weightTileOffset = TILE_SIZE * k + local_id.x;\n        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];\n        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];\n        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];\n      }\n\n      workgroupBarrier();\n    }\n\n    let headOffset = (m * uniforms.N + n) % uniforms.head_size;\n    valueQ += bias[headOffset + biasOffsetQ];\n    valueK += bias[headOffset + biasOffsetK];\n    valueV += bias[headOffset + biasOffsetV];\n\n    let offset = workgroup_id.z * uniforms.M * uniforms.N;\n    if (m < uniforms.M && n < uniforms.N) {\n      let outputIdx = offset + m * uniforms.N + n;\n      output_q[outputIdx] = valueQ;\n      output_k[outputIdx] = valueK;\n      output_v[outputIdx] = valueV;\n    }\n  }`}},{inputs:u,outputs:[-1,-1,-1]})},tsvb_Vo=(t,e)=>{let r=tsvb_rc(t.inputs,e),[n,i,s]=tsvb_oc(t,r);return tsvb_In(t,n,i,s,t.inputs[4],void 0,void 0,void 0,t.inputs[5],r,e)}})),tsvb_sc,tsvb_uc,tsvb_lc,tsvb_Go,tsvb_Lo=tsvb_q((()=>{tsvb_pt(),tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_sc=(t,e)=>{if(!t||5!==t.length)throw new Error("BatchNormalization requires 5 inputs");let r=(t,e,r)=>{let n=e.length;if(n!==t.length)throw new Error(`${r}: num dimensions != ${n}`);e.forEach(((e,n)=>{if(e!==t[n])throw new Error(`${r}: dim[${n}] do not match`)}))};if(t[0].dims.length>1){let n="NHWC"===e.format?e.spatial?t[0].dims.slice(-1):t[0].dims.slice(-1).concat(t[0].dims.slice(1,t[0].dims.length-1)):t[0].dims.slice(1,e.spatial?2:void 0);r(t[1].dims,n,"Invalid input scale"),r(t[2].dims,n,"Invalid input B"),r(t[3].dims,n,"Invalid input mean"),r(t[4].dims,n,"Invalid input var")}else r(t[1].dims,[1],"Invalid input scale"),r(t[2].dims,[1],"Invalid input B"),r(t[3].dims,[1],"Invalid input mean"),r(t[4].dims,[1],"Invalid input var")},tsvb_uc=(t,e)=>{let{epsilon:r,spatial:n,format:i}=e,s=t[0].dims,o=n?tsvb_He(s[s.length-1]):1,a="NHWC"===i&&s.length>1?o:1,u=tsvb_ort_webgpu_min_N.size(s)/o,l=tsvb_Ue(s.length)&&n,c=l?s.length:s,h=tsvb_z("x",t[0].dataType,t[0].dims,o),f=tsvb_z("scale",t[1].dataType,t[1].dims,a),d=tsvb_z("bias",t[2].dataType,t[2].dims,a),p=tsvb_z("inputMean",t[3].dataType,t[3].dims,a),v=tsvb_z("inputVar",t[4].dataType,t[4].dims,a),y=tsvb_ort_webgpu_min_j("y",t[0].dataType,c,o);return{name:"BatchNormalization",shaderCache:{hint:`${e.epsilon}_${e.format}_${n}_${o}`,inputDependencies:l?["rank","type","type","type","type"]:void 0},getShaderSource:t=>`\n  const epsilon = ${r};\n  ${t.registerUniform("outputSize","u32").declareVariables(h,f,d,p,v,y)}\n  ${t.mainStart()}\n  ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n    var outputIndices = ${y.offsetToIndices(`global_idx * ${o}`)};\n    ${(()=>{let t="";if(n)t=`let cOffset = ${1===s.length?"0u":"NHWC"===i?`outputIndices[${s.length-1}] / ${o}`:"outputIndices[1]"};`;else if("NCHW"===i)t=`\n            ${y.indicesSet("outputIndices","0","0")}\n            let cOffset = ${y.indicesToOffset("outputIndices")};`;else{t=`var cIndices = ${f.type.indices}(0);\n                       cIndices[0] = outputIndices[${s.length-1}];`;for(let e=1;e<f.rank;e++)t+=`cIndices[${e}] = outputIndices[${e}];`;t+=`let cOffset = ${f.indicesToOffset("cIndices")};`}return t})()}\n    let scale = ${f.getByOffset("cOffset")};\n    let bias = ${d.getByOffset("cOffset")};\n    let inputMean = ${p.getByOffset("cOffset")};\n    let inputVar = ${v.getByOffset("cOffset")};\n    let x = ${h.getByOffset("global_idx")};\n    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;\n    ${y.setByOffset("global_idx","value")}\n  }`,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:l?[{type:"uint32",data:u},...tsvb_F(s)]:[{type:"uint32",data:u}]})}},tsvb_lc=t=>tsvb_he(t),tsvb_Go=(t,e)=>{let{inputs:r,outputCount:n}=t,i=tsvb_lc({...e,outputCount:n});if(tsvb_Te.webgpu.validateInputContent&&tsvb_sc(r,i),e.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");t.compute(tsvb_uc(r,i))}})),tsvb_dc,tsvb_cc,tsvb_Ho,tsvb_Fo=tsvb_q((()=>{tsvb_xe(),tsvb_$e(),tsvb_dc=t=>{if(3!==t[0].dims.length)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(t[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(1!==t[1].dims.length)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},tsvb_cc=t=>{let e=t[0].dims,r=t[0].dims[2],n=tsvb_ort_webgpu_min_N.size(e)/4,i=t[0].dataType,s=tsvb_z("input",i,e,4),o=tsvb_z("bias",i,[r],4),a=tsvb_z("residual",i,e,4),u=tsvb_ort_webgpu_min_j("output",i,e,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)}}),getShaderSource:t=>`\n  const channels = ${r}u / 4;\n  ${t.declareVariables(s,o,a,u)}\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes(n)}\n    let value = ${s.getByOffset("global_idx")}\n      + ${o.getByOffset("global_idx % channels")} + ${a.getByOffset("global_idx")};\n    ${u.setByOffset("global_idx","value")}\n  }`}},tsvb_Ho=t=>{tsvb_dc(t.inputs),t.compute(tsvb_cc(t.inputs))}})),tsvb_pc,tsvb_Oe,tsvb_qo,tsvb_jo,tsvb_Ko,tsvb_Yo,tsvb_Zo,tsvb_Qo,tsvb_Xo,tsvb_Jo,tsvb_es,tsvb_mc,tsvb_ts,tsvb_rs,tsvb_ns,tsvb_as,tsvb_Cn,tsvb_is,tsvb_An,tsvb_os,tsvb_ss,tsvb_us,tsvb_ls,tsvb_ds,tsvb_cs,tsvb_ps,tsvb_ms,tsvb_fs,tsvb_hs,tsvb_gs,tsvb_ys,tsvb_bs,tsvb_ws,tsvb_vs,tsvb_$s,src_tsvb_s,tsvb_Aa=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_pc=(t,e,r,n,i,s)=>{let o=Math.ceil(e/4),a="";a="string"==typeof i?`${i}(a)`:i("a");let u=tsvb_z("inputData",r,[o],4),l=tsvb_ort_webgpu_min_j("outputData",n,[o],4);return`\n      ${t.registerUniform("vec_size","u32").declareVariables(u,l)}\n\n  ${s??""}\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n\n    let a = ${u.getByOffset("global_idx")};\n    ${l.setByOffset("global_idx",a)}\n  }`},tsvb_Oe=(t,e,r,n,i,s=t.dataType)=>({name:e,shaderCache:{hint:i,inputDependencies:["type"]},getShaderSource:e=>tsvb_pc(e,tsvb_ort_webgpu_min_N.size(t.dims),t.dataType,s,r,n),getRunData:e=>({outputs:[{dims:t.dims,dataType:s}],dispatchGroup:{x:Math.ceil(tsvb_ort_webgpu_min_N.size(e[0].dims)/64/4)},programUniforms:[{type:"uint32",data:Math.ceil(tsvb_ort_webgpu_min_N.size(t.dims)/4)}]})}),tsvb_qo=t=>{t.compute(tsvb_Oe(t.inputs[0],"Abs","abs"))},tsvb_jo=t=>{t.compute(tsvb_Oe(t.inputs[0],"Acos","acos"))},tsvb_Ko=t=>{t.compute(tsvb_Oe(t.inputs[0],"Acosh","acosh"))},tsvb_Yo=t=>{t.compute(tsvb_Oe(t.inputs[0],"Asin","asin"))},tsvb_Zo=t=>{t.compute(tsvb_Oe(t.inputs[0],"Asinh","asinh"))},tsvb_Qo=t=>{t.compute(tsvb_Oe(t.inputs[0],"Atan","atan"))},tsvb_Xo=t=>{t.compute(tsvb_Oe(t.inputs[0],"Atanh","atanh"))},tsvb_Jo=t=>tsvb_he(t),tsvb_es=(t,e)=>{let r;switch(e.to){case 10:r="vec4<f16>";break;case 1:r="vec4<f32>";break;case 12:r="vec4<u32>";break;case 6:r="vec4<i32>";break;case 9:r="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${e.to}`)}t.compute(tsvb_Oe(t.inputs[0],"Cast",r,void 0,e.cacheKey,e.to))},tsvb_mc=t=>{let e=t.length>=2&&0!==t[1].data?t[1].getFloat32Array()[0]:tsvb_vn,r=t.length>=3&&0!==t[2].data?t[2].getFloat32Array()[0]:tsvb_$n;return tsvb_he({min:e,max:r})},tsvb_ts=(t,e)=>{let r=1===t.inputs.length?e:tsvb_mc(t.inputs),n=tsvb_$t(t.inputs[0].dataType);t.compute(tsvb_Oe(t.inputs[0],"Clip",(t=>`clamp(${t}, clip_min_, clip_max_)`),`\n    const clip_min_: vec4<${n}> = vec4(${n}(${r.min}));\n    const clip_max_: vec4<${n}> = vec4(${n}(${r.max}));\n`,r.cacheKey),{inputs:[0]})},tsvb_rs=t=>{t.compute(tsvb_Oe(t.inputs[0],"Ceil","ceil"))},tsvb_ns=t=>{t.compute(tsvb_Oe(t.inputs[0],"Cos","cos"))},tsvb_as=t=>{t.compute(tsvb_Oe(t.inputs[0],"Cosh","cosh"))},tsvb_Cn=t=>tsvb_he(t),tsvb_is=(t,e)=>{let r=tsvb_$t(t.inputs[0].dataType);t.compute(tsvb_Oe(t.inputs[0],"Elu",(t=>`elu_vf32(${t})`),`\n  const elu_alpha_ = ${r}(${e.alpha});\n\n  fn elu_f32(a: ${r}) -> ${r} {\n  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);\n  }\n\n  fn elu_vf32(v: vec4<${r}>) -> vec4<${r}> {\n  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));\n  }`,e.cacheKey))},tsvb_An=(t,e="f32")=>`\nconst r0: ${e} = 0.3275911;\nconst r1: ${e} = 0.254829592;\nconst r2: ${e} = -0.284496736;\nconst r3: ${e} = 1.421413741;\nconst r4: ${e} = -1.453152027;\nconst r5: ${e} = 1.061405429;\n\nfn erf_vf32(v: ${t}) -> ${t} {\n  let absv = abs(v);\n  let x = 1.0 / (1.0 + r0 * absv);\n  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));\n}`,tsvb_os=t=>{let e=tsvb_$t(t.inputs[0].dataType);t.compute(tsvb_Oe(t.inputs[0],"Erf",(t=>`erf_vf32(${t})`),tsvb_An(`vec4<${e}>`,e)))},tsvb_ss=t=>{t.compute(tsvb_Oe(t.inputs[0],"Exp","exp"))},tsvb_us=t=>{t.compute(tsvb_Oe(t.inputs[0],"Floor","floor"))},tsvb_ls=t=>{let e=tsvb_$t(t.inputs[0].dataType);t.compute(tsvb_Oe(t.inputs[0],"Gelu",(t=>`0.5 * ${t} * (1.0 + erf_vf32(${t} * 0.7071067811865475))`),tsvb_An(`vec4<${e}>`,e)))},tsvb_ds=(t,e)=>{let r=tsvb_$t(t.inputs[0].dataType);t.compute(tsvb_Oe(t.inputs[0],"LeakyRelu",(t=>`select(leaky_relu_alpha_ * ${t}, ${t}, ${t} >= vec4<${r}>(0.0))`),`const leaky_relu_alpha_ = ${r}(${e.alpha});`,e.cacheKey))},tsvb_cs=t=>{t.compute(tsvb_Oe(t.inputs[0],"Not",(t=>`!${t}`)))},tsvb_ps=t=>{t.compute(tsvb_Oe(t.inputs[0],"Neg",(t=>`-${t}`)))},tsvb_ms=t=>{t.compute(tsvb_Oe(t.inputs[0],"Reciprocal",(t=>`1.0/${t}`)))},tsvb_fs=t=>{let e=tsvb_$t(t.inputs[0].dataType);t.compute(tsvb_Oe(t.inputs[0],"Relu",(t=>`select(vec4<${e}>(0.0), ${t}, ${t} > vec4<${e}>(0.0))`)))},tsvb_hs=t=>{t.compute(tsvb_Oe(t.inputs[0],"Sigmoid",(t=>`(1.0 / (1.0 + exp(-${t})))`)))},tsvb_gs=t=>{t.compute(tsvb_Oe(t.inputs[0],"Sin","sin"))},tsvb_ys=t=>{t.compute(tsvb_Oe(t.inputs[0],"Sinh","sinh"))},tsvb_bs=t=>{t.compute(tsvb_Oe(t.inputs[0],"Sqrt","sqrt"))},tsvb_ws=t=>{t.compute(tsvb_Oe(t.inputs[0],"Tan","tan"))},tsvb_vs=t=>{t.compute(tsvb_Oe(t.inputs[0],"Tanh","tanh"))},tsvb_$s=(t,e)=>{let r=tsvb_$t(t.inputs[0].dataType);return t.compute(tsvb_Oe(t.inputs[0],"ThresholdedRelu",(t=>`select(vec4<${r}>(0.0), ${t}, ${t} > thresholded_relu_alpha_)`),`const thresholded_relu_alpha_ = vec4<${r}>(${e.alpha});`,e.cacheKey)),0},src_tsvb_s=t=>{t.compute(tsvb_Oe(t.inputs[0],"Log","log"))}})),tsvb_hc,tsvb_gc,tsvb_xs,tsvb_Ss=tsvb_q((()=>{tsvb_xe(),tsvb_$e(),tsvb_Aa(),tsvb_hc=t=>{if(3!==t[0].dims.length)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(t[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(1!==t[1].dims.length)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},tsvb_gc=t=>{let e=t[0].dims.slice();e[2]=e[2]/2;let r=tsvb_z("input",t[0].dataType,t[0].dims,4),n=tsvb_z("bias",t[0].dataType,[t[0].dims[2]],4),i=tsvb_ort_webgpu_min_j("output",t[0].dataType,e,4),s=tsvb_ort_webgpu_min_N.size(e)/4,o=tsvb_Le(t[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)}}),getShaderSource:e=>`\n  const M_SQRT2 = sqrt(2.0);\n  const halfChannels = ${t[0].dims[2]/4/2}u;\n\n  ${e.declareVariables(r,n,i)}\n\n  ${tsvb_An(`vec4<${o}>`,o)}\n\n  ${e.mainStart()}\n    ${e.guardAgainstOutOfBoundsWorkgroupSizes(s)}\n    let biasIdx = global_idx % halfChannels;\n    let batchIndex = global_idx / halfChannels;\n    let inputOffset = biasIdx + batchIndex * halfChannels * 2;\n    let valueLeft = input[inputOffset] + bias[biasIdx];\n    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];\n    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);\n\n    ${i.setByOffset("global_idx","valueLeft * geluRight")}\n  }`}},tsvb_xs=t=>{tsvb_hc(t.inputs),t.compute(tsvb_gc(t.inputs))}})),tsvb_yc,tsvb_bc,tsvb_Ct,tsvb_Is,tsvb_Cs,tsvb_As,tsvb_Ts,tsvb_Es,tsvb_Os,tsvb_ks,tsvb_Bs,tsvb_Ps,tsvb_Rs,tsvb_Ds=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_$e(),tsvb_yc=(t,e,r,n,i,s,o,a,u,l,c,h,f)=>{let d,p;"string"==typeof a?d=p=(t,e)=>`${a}((${t}),(${e}))`:"function"==typeof a?d=p=a:(d=a.scalar,p=a.vector);let v,y=h?e.length:e,b=h?r.length:r,_=h?n.length:n,m=tsvb_ort_webgpu_min_j("outputData",c,_,4),g=tsvb_z("aData",u,y,4),w=tsvb_z("bData",l,b,4);if(i)if(s){let t=1===tsvb_ort_webgpu_min_N.size(e),n=1===tsvb_ort_webgpu_min_N.size(r),i=e.length>0&&e[e.length-1]%4==0,s=r.length>0&&r[r.length-1]%4==0;v=t||n?m.setByOffset("global_idx",p(t?`${g.type.value}(${g.getByOffset("0")}.x)`:g.getByOffset("global_idx"),n?`${w.type.value}(${w.getByOffset("0")}.x)`:w.getByOffset("global_idx"))):`\n            let outputIndices = ${m.offsetToIndices("global_idx * 4u")};\n            let offsetA = ${g.broadcastedIndicesToOffset("outputIndices",m)};\n            let offsetB = ${w.broadcastedIndicesToOffset("outputIndices",m)};\n            ${m.setByOffset("global_idx",p(o||i?g.getByOffset("offsetA / 4u"):`${g.type.value}(${g.getByOffset("offsetA / 4u")}[offsetA % 4u])`,o||s?w.getByOffset("offsetB / 4u"):`${w.type.value}(${w.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}\n          `}else v=m.setByOffset("global_idx",p(g.getByOffset("global_idx"),w.getByOffset("global_idx")));else{if(!s)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let t=(t,e,r="")=>{let n=`aData[indexA${e}][componentA${e}]`,i=`bData[indexB${e}][componentB${e}]`;return`\n            let outputIndices${e} = ${m.offsetToIndices(`global_idx * 4u + ${e}u`)};\n            let offsetA${e} = ${g.broadcastedIndicesToOffset(`outputIndices${e}`,m)};\n            let offsetB${e} = ${w.broadcastedIndicesToOffset(`outputIndices${e}`,m)};\n            let indexA${e} = offsetA${e} / 4u;\n            let indexB${e} = offsetB${e} / 4u;\n            let componentA${e} = offsetA${e} % 4u;\n            let componentB${e} = offsetB${e} % 4u;\n            ${t}[${e}] = ${r}(${d(n,i)});\n          `};v=9===c?`\n            var data = vec4<u32>(0);\n            ${t("data",0,"u32")}\n            ${t("data",1,"u32")}\n            ${t("data",2,"u32")}\n            ${t("data",3,"u32")}\n            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:`\n            ${t("outputData[global_idx]",0)}\n            ${t("outputData[global_idx]",1)}\n            ${t("outputData[global_idx]",2)}\n            ${t("outputData[global_idx]",3)}\n          `}return`\n        ${t.registerUniform("vec_size","u32").declareVariables(g,w,m)}\n\n        ${f??""}\n\n        ${t.mainStart()}\n        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n        ${v}\n      }`},tsvb_bc=(t,e,r,n,i,s,o=r.dataType)=>{let a=!tsvb_ort_webgpu_min_N.areEqual(r.dims,n.dims),u=r.dims,l=tsvb_ort_webgpu_min_N.size(r.dims),c=!1,h=!1,f=[a];if(a){let t=tsvb_vt.calcShape(r.dims,n.dims,!1);if(!t)throw new Error("Can't perform binary op on the given tensors");u=t,l=tsvb_ort_webgpu_min_N.size(u);let e=1===tsvb_ort_webgpu_min_N.size(r.dims),i=1===tsvb_ort_webgpu_min_N.size(n.dims),s=r.dims.length>0&&r.dims[r.dims.length-1]%4==0,o=n.dims.length>0&&n.dims[n.dims.length-1]%4==0;f.push(e),f.push(i),f.push(s),f.push(o);let a=1;for(let t=1;t<u.length;t++){let e=r.dims[r.dims.length-t]??1;if(e!==(n.dims[n.dims.length-t]??1))break;a*=e}a%4==0?(h=!0,c=!0):(e||i||s||o)&&(c=!0)}else c=!0;f.push(c);let d=tsvb_Ue(r.dims.length)&&tsvb_Ue(n.dims.length)&&tsvb_Ue(u.length);return{name:t,shaderCache:{hint:e+f.map((t=>t.toString())).join("_"),inputDependencies:d?["rank","rank"]:["dims","dims"]},getShaderSource:t=>tsvb_yc(t,r.dims,n.dims,u,c,a,h,i,r.dataType,n.dataType,o,d,s),getRunData:()=>({outputs:[{dims:u,dataType:o}],dispatchGroup:{x:Math.ceil(l/64/4)},programUniforms:d?[{type:"uint32",data:Math.ceil(tsvb_ort_webgpu_min_N.size(u)/4)},...tsvb_F(r.dims),...tsvb_F(n.dims),...tsvb_F(u)]:[{type:"uint32",data:Math.ceil(tsvb_ort_webgpu_min_N.size(u)/4)}]})}},tsvb_Ct=(t,e,r,n,i,s)=>{t.compute(tsvb_bc(e,i??"",t.inputs[0],t.inputs[1],r,n,s))},tsvb_Is=t=>{tsvb_Ct(t,"Add",((t,e)=>`${t}+${e}`))},tsvb_Cs=t=>{tsvb_Ct(t,"Div",((t,e)=>`${t}/${e}`))},tsvb_As=t=>{tsvb_Ct(t,"Equal",{scalar:(t,e)=>`u32(${t}==${e})`,vector:(t,e)=>`vec4<u32>(${t}==${e})`},void 0,void 0,9)},tsvb_Ts=t=>{tsvb_Ct(t,"Mul",((t,e)=>`${t}*${e}`))},tsvb_Es=t=>{let e=tsvb_z("input",t.inputs[0].dataType,t.inputs[0].dims).type.value;tsvb_Ct(t,"Pow",{scalar:(t,e)=>`pow_custom(${t},${e})`,vector:(t,e)=>`pow_vector_custom(${t},${e})`},`\n    fn pow_custom(a : ${e}, b : ${e}) -> ${e} {\n      if (b == ${e}(0.0)) {\n        return ${e}(1.0);\n      } else if (a < ${e}(0.0) && f32(b) != floor(f32(b))) {\n        return ${e}(pow(f32(a), f32(b))); // NaN\n      }\n      return select(sign(a), ${e}(1.0), round(f32(abs(b) % ${e}(2.0))) != 1.0) * ${e}(${"i32"===e?"round":""}(pow(f32(abs(a)), f32(b))));\n    }\n    fn pow_vector_custom(a : vec4<${e}>, b : vec4<${e}>) -> vec4<${e}> {\n      // TODO: implement vectorized pow\n      return vec4<${e}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));\n    }\n      `)},tsvb_Os=t=>{tsvb_Ct(t,"Sub",((t,e)=>`${t}-${e}`))},tsvb_ks=t=>{tsvb_Ct(t,"Greater",{scalar:(t,e)=>`u32(${t}>${e})`,vector:(t,e)=>`vec4<u32>(${t}>${e})`},void 0,void 0,9)},tsvb_Bs=t=>{tsvb_Ct(t,"Less",{scalar:(t,e)=>`u32(${t}<${e})`,vector:(t,e)=>`vec4<u32>(${t}<${e})`},void 0,void 0,9)},tsvb_Ps=t=>{tsvb_Ct(t,"GreaterOrEqual",{scalar:(t,e)=>`u32(${t}>=${e})`,vector:(t,e)=>`vec4<u32>(${t}>=${e})`},void 0,void 0,9)},tsvb_Rs=t=>{tsvb_Ct(t,"LessOrEqual",{scalar:(t,e)=>`u32(${t}<=${e})`,vector:(t,e)=>`vec4<u32>(${t}<=${e})`},void 0,void 0,9)}})),tsvb_vc,tsvb_$c,src_tsvb_c,tsvb_xc,tsvb_Ms,tsvb_zs,tsvb_Us=tsvb_q((()=>{tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_vc=t=>{if(!t||t.length<1)throw new Error("too few inputs");let e=t[0].dataType,r=t[0].dims.length;for(let n of t){if(n.dataType!==e)throw new Error("input tensors should be one type");if(n.dims.length!==r)throw new Error("input tensors should have the same shape")}},tsvb_$c=(t,e)=>`\n  fn calculateInputIndex(index: u32) -> u32 {\n    let sizeInConcatAxis = array<u32, ${t}u>(${e});\n    for (var i: u32 = 0u; i < ${t}; i += 1u ) {\n      if (index < sizeInConcatAxis[i]) {\n        return i;\n      }\n    }\n    return ${t}u;\n  }`,src_tsvb_c=(t,e)=>{let r=t.length,n=[];for(let i=0;i<r;++i){let s=e.setByOffset("global_idx",t[i].getByIndices("indices"));1===r?n.push(s):0===i?n.push(`if (inputIndex == ${i}u) { ${s} }`):i===r-1?n.push(`else { ${s} }`):n.push(`else if (inputIndex == ${i}) { ${s} }`)}return n.join("\n")},tsvb_xc=(t,e)=>{let r=t[0].dims.slice();if(e>=r.length||e<-1*r.length)throw new Error("axis specified for concat doesn't match input dimensionality");let n=e<0?r.length+e:e,i=r.slice(0);for(let e=1;e<t.length;e++){let s=t[e].dims.slice();for(let t=0;t<r.length;t++)if(t===n)i[n]+=s[t];else if(r[t]!==s[t])throw new Error("non concat dimensions must match")}let s=tsvb_ort_webgpu_min_N.size(i),o=new Array(t.length),a=new Array(t.length),u=t[0].dataType,l=0,c=[],h=[],f=[],d=[{type:"uint32",data:s}];for(let e=0;e<t.length;++e)l+=t[e].dims[n],o[e]=l,f.push(tsvb_Ue(t[e].dims.length)),h.push(f[e]?t[e].dims.length:t[e].dims),a[e]=tsvb_z(`input${e}`,u,h[e]),c.push(f[e]?"rank":"dims"),d.push({type:"uint32",data:o[e]});for(let e=0;e<t.length;++e)f[e]&&d.push(...tsvb_F(t[e].dims));let p=tsvb_Ue(i.length);p&&d.push(...tsvb_F(i));let v=p?i.length:i,y=tsvb_ort_webgpu_min_j("output",u,v),b=y.indicesGet("indices",n),_=Array.from(Array(o.length).keys()).map((t=>`uniforms.sizeInConcatAxis${t}`)).join(",");return{name:"Concat",shaderCache:{hint:`${e}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:d}),getShaderSource:e=>`\n\n  ${(()=>{e.registerUniform("outputSize","u32");for(let r=0;r<t.length;r++)e.registerUniform(`sizeInConcatAxis${r}`,"u32");return e.declareVariables(...a,y)})()}\n\n  ${tsvb_$c(o.length,_)}\n\n  ${e.mainStart()}\n    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n    var indices = ${y.offsetToIndices("global_idx")};\n\n    let inputIndex = calculateInputIndex(${b});\n    if (inputIndex != 0u) {\n      let sizeInConcatAxis = array<u32, ${o.length}u>(${_});\n      ${b} -= sizeInConcatAxis[inputIndex - 1u];\n    }\n\n    ${src_tsvb_c(a,y)}\n  }`}},tsvb_Ms=(t,e)=>{tsvb_vc(t.inputs),t.compute(tsvb_xc(t.inputs,e.axis))},tsvb_zs=t=>tsvb_he({axis:t.axis})})),tsvb_At,tsvb_Tn,tsvb_Wt=tsvb_q((()=>{tsvb_xe(),tsvb_At=(t,e)=>{switch(t.activation){case"Relu":return{activationFunction:"",applyActivation:`value = max(value, ${e}(0.0));`};case"Sigmoid":return{activationFunction:"",applyActivation:`value = (${e}(1.0) / (${e}(1.0) + exp(-value)));`};case"Clip":return{activationFunction:`const clip_min_=${e}(${t.clipMin});const clip_max_=${e}(${t.clipMax});`,applyActivation:"value = clamp(value, clip_min_, clip_max_);"};default:return{activationFunction:"",applyActivation:""}}},tsvb_Tn=t=>{let e=t?.activation||"";if("Clip"===e){let[r,n]=t?.activation_params||[tsvb_vn,tsvb_$n];return{activation:e,clipMax:n,clipMin:r,activationCacheKey:`${e}:${r},${n}`}}return{activation:e,activationCacheKey:e}}})),tsvb_Ke,tsvb_En,tsvb_On=tsvb_q((()=>{tsvb_Ke=(t,e)=>{switch(t){case 1:return e;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${t}-component is not supported.`)}},tsvb_En=t=>`\n      ${t?"value = value + getBiasByOutputCoords(coords);":""}\n      `})),tsvb_kn,tsvb_Ta=tsvb_q((()=>{tsvb_kn=t=>`\nfn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));\n}\nfn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n    i32(${t}.x), i32(${t}.y), i32(${t}.z), 1));\n}\n`})),tsvb_Sc,tsvb_Ic,tsvb_Ur,tsvb_Ns,tsvb_Cc,tsvb_Nr,tsvb_Ac,tsvb_Bn,tsvb_Wr=tsvb_q((()=>{tsvb_xe(),tsvb_$e(),tsvb_Wt(),tsvb_On(),tsvb_Sc=(t,e)=>t?`\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          kStart + inputRow,\n          globalRowStart / innerElementSize + inputCol${e?", batchIndices":""});\n        `:`\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          globalRow + innerRow,\n          kStart / innerElementSize + inputCol${e?", batchIndices":""});\n        `,tsvb_Ic=(t,e)=>t?`\n        let ACached0 = mm_Asub[k * innerElementSize][localRow];\n        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];\n        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];\n        ${3===e?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          acc[i] = BCached0 * ACached0[i] + acc[i];\n          acc[i] = BCached1 * ACached1[i] + acc[i];\n          acc[i] = BCached2 * ACached2[i] + acc[i];\n          ${3===e?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}\n        }`:`\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          let ACached = mm_Asub[tileRow + i][k];\n          acc[i] = BCached0 * ACached.x + acc[i];\n          acc[i] = BCached1 * ACached.y + acc[i];\n          acc[i] = BCached2 * ACached.z + acc[i];\n          ${3===e?"":"acc[i] = BCached3 * ACached.w + acc[i];"}\n        }`,tsvb_Ur=(t,e,r="f32",n,i=!1,s=32,o=!1,a=32)=>{let u=e[1]*t[1],l=e[0]*t[0],c=i?u:s,h=i?s:u,f=c/e[0],d=s/e[1];if((!i||4!==f||4!==t[1])&&(i||3!==f&&4!==f)||c%e[0]!=0||s%e[1]!=0||4!==t[0])throw new Error(`If transposeA ${i} is true, innerElementSize ${f} and workPerThread[1] ${t[1]} must be 4.\n      Otherwise, innerElementSize ${f} must be 3 or 4.\n  tileAWidth ${c} must be divisible by workgroupSize[0]${e[0]}. tileInner ${s} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${t[0]} must be 4.`);return`\nvar<workgroup> mm_Asub: array<array<vec${f}<${r}>, ${c/f}>, ${h}>;\nvar<workgroup> mm_Bsub: array<array<vec4<${r}>, ${l/t[0]}>, ${s}>;\n\nconst rowPerThread = ${t[1]};\nconst colPerThread = ${t[0]};\nconst innerElementSize = ${f};\nconst tileInner = ${s};\n\n@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n  let localRow = i32(localId.y);\n  let tileRow = localRow * rowPerThread;\n  let tileCol = i32(localId.x);\n\n  let globalRow =i32(globalId.y) * rowPerThread;\n  let globalCol = i32(globalId.x);\n  let batch = ${o?"0":"i32(globalId.z)"};\n  ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}\n  let globalRowStart = i32(workgroupId.y) * ${u};\n\n  let numTiles = ${o?`${Math.ceil(a/s)}`:"(uniforms.dimInner - 1) / tileInner + 1"};\n  var kStart = ${o?`i32(globalId.z) * ${a}`:"0"};\n\n  var acc: array<vec4<${r}>, rowPerThread>;\n\n  // Loop over shared dimension.\n  let tileRowB = localRow * ${d};\n  for (var t = 0; t < numTiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let inputRow = tileRow + innerRow;\n          let inputCol = tileCol;\n          ${tsvb_Sc(i,n)}\n      }\n\n      // Load one tile of B into local memory.\n      for (var innerRow = 0; innerRow < ${d}; innerRow = innerRow + 1) {\n          let inputRow = tileRowB + innerRow;\n          let inputCol = tileCol;\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${n?", batchIndices":""});\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {\n          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];\n          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];\n          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];\n          ${3===f?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}\n\n          ${tsvb_Ic(i,f)}\n      }\n\n      workgroupBarrier();\n  }\n\n  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);\n  }\n}`},tsvb_Ns=(t,e)=>t?`\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              kStart + inputRow,\n              globalRowStart + inputCol${e?", batchIndices":""});\n            `:`\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              globalRowStart + inputRow,\n              kStart + inputCol${e?", batchIndices":""});\n            `,tsvb_Cc=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",tsvb_Nr=(t,e,r="f32",n,i=!1,s=32,o=!1,a=32,u=!1)=>{let l=t[1]*e[1],c=t[0]*e[0],h=i?l:s,f=i?s:l;if(f%e[1]!=0||h%e[0]!=0||s%e[1]!=0)throw new Error(`tileAHight ${f} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${h} must be divisible by workgroupSize[0]${e[0]}, tileInner ${s} must be divisible by workgroupSize[1]${e[1]}`);let d=f/e[1],p=h/e[0],v=s/e[1],y=u?`\n    let localRow = i32(localId.y);\n    let localCol = i32(localId.x);\n    let globalRowStart = i32(workgroupId.y) * ${l};\n    let globalColStart = i32(workgroupId.x) * ${c};\n\n    // Loop over shared dimension.\n    for (var t = 0; t < numTiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var inputRow = localRow; inputRow < ${f}; inputRow = inputRow + ${e[1]}) {\n        for (var inputCol = localCol; inputCol < ${h}; inputCol = inputCol + ${e[0]}) {\n          ${tsvb_Ns(i,n)}\n        }\n      }\n      // Load one tile of B into local memory.\n      for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${e[1]}) {\n            for (var inputCol = localCol; inputCol < ${c}; inputCol = inputCol + ${e[0]}) {\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n            kStart + inputRow,\n            globalColStart + inputCol${n?", batchIndices":""});\n        }\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      var BCached : array<${r}, colPerThread>;\n      for (var k = 0; k < tileInner; k = k + 1) {\n        for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n          BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];\n        }\n        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let ACached = ${i?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}\n          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n            acc[innerRow][innerCol] = acc[innerRow][innerCol] +\n                ACached * BCached[innerCol];\n          }\n        }\n      }\n      workgroupBarrier();\n    }\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      let gRow = globalRowStart + localRow + innerRow * ${e[1]};\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        let gCol = globalColStart + localCol + innerCol * ${e[0]};\n        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);\n      }\n    }\n    `:`\nlet tileRow = i32(localId.y) * rowPerThread;\nlet tileCol = i32(localId.x) * colPerThread;\n\nlet globalRow = i32(globalId.y) * rowPerThread;\nlet globalCol = i32(globalId.x) * colPerThread;\nlet globalRowStart = i32(workgroupId.y) * ${l};\n\nlet tileRowA = i32(localId.y) * ${d};\nlet tileColA = i32(localId.x) * ${p};\nlet tileRowB = i32(localId.y) * ${v};\n// Loop over shared dimension.\nfor (var t = 0; t < numTiles; t = t + 1) {\n  // Load one tile of A into local memory.\n  for (var innerRow = 0; innerRow < ${d}; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < ${p}; innerCol = innerCol + 1) {\n      let inputRow = tileRowA + innerRow;\n      let inputCol = tileColA + innerCol;\n      ${tsvb_Ns(i,n)}\n    }\n  }\n\n  // Load one tile of B into local memory.\n  for (var innerRow = 0; innerRow < ${v}; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n      let inputRow = tileRowB + innerRow;\n      let inputCol = tileCol + innerCol;\n      mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n        kStart + inputRow,\n        globalCol + innerCol${n?", batchIndices":""});\n    }\n  }\n  kStart = kStart + tileInner;\n  workgroupBarrier();\n\n  // Compute acc values for a single thread.\n  var BCached : array<${r}, colPerThread>;\n  for (var k = 0; k < tileInner; k = k + 1) {\n    for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n      BCached[inner] = mm_Bsub[k][tileCol + inner];\n    }\n\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      ${tsvb_Cc(i)}\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];\n      }\n    }\n  }\n\n  workgroupBarrier();\n}\n\nfor (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n    mm_write(batch, globalRow + innerRow, globalCol + innerCol,\n        acc[innerRow][innerCol]);\n  }\n}\n`;return`\n  var<workgroup> mm_Asub : array<array<${r}, ${h}>, ${f}>;\n  var<workgroup> mm_Bsub : array<array<${r}, ${c}>, ${s}>;\n  const rowPerThread = ${t[1]};\n  const colPerThread = ${t[0]};\n  const tileInner = ${s};\n\n@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n    let batch = ${o?"0":"i32(globalId.z)"};\n    ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}\n    let numTiles = ${o?`${Math.ceil(a/s)}`:"(uniforms.dimInner - 1) / tileInner + 1"};\n    var kStart = ${o?`i32(globalId.z) * ${a}`:"0"};\n\n    var acc : array<array<${r}, colPerThread>, rowPerThread>;\n\n    // Without this initialization strange values show up in acc.\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        acc[innerRow][innerCol] = 0.0;\n      }\n    }\n    ${y}\n  }\n`},tsvb_Ac=(t,e,r,n,i,s=!1)=>{let[o,a,u]=i,[l,c,h,f]=n,d=tsvb_fr(o,u),p=tsvb_fr(a,u),v=tsvb_Le(n[0].type.tensor);return`\n    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${l.type.indices}) -> ${tsvb_Ke(t,v)} {\n      var value = ${tsvb_Ke(t,v)}(0.0);\n      let col = colIn * ${t};\n      if(row < uniforms.dimAOuter && col < uniforms.dimInner)\n      {\n        ${(()=>{let t=c.rank,e=l.rank,r=`var aIndices: ${c.type.indices};`;for(let n=t-2-1,i=e-1;n>=0;n--,i--)r+=`\naIndices[${n}] = ${e>1?`batchIndices[${i}]`:"batchIndices"};`;return d.forEach((t=>{r+=`\naIndices[${t}] = 0;`})),r+=`\naIndices[${t-2}] = u32(row);\n                   aIndices[${t-1}] = u32(colIn);`,r})()}\n        value = ${c.getByIndices("aIndices")};\n      }\n      return value;\n    }\n\n    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${l.type.indices}) -> ${tsvb_Ke(t,v)} {\n      var value = ${tsvb_Ke(t,v)}(0.0);\n      let col = colIn * ${t};\n      if(row < uniforms.dimInner && col < uniforms.dimBOuter)\n      {\n        ${(()=>{let t=h.rank,e=l.rank,r=`var bIndices: ${h.type.indices};`;for(let n=t-2-1,i=e-1;n>=0;n--,i--)r+=`\nbIndices[${n}] = ${e>1?`batchIndices[${i}]`:"batchIndices"};`;return p.forEach((t=>{r+=`\nbIndices[${t}] = 0;`})),r+=`\nbIndices[${t-2}] = u32(row);\n                   bIndices[${t-1}] = u32(colIn);`,r})()}\n        value = ${h.getByIndices("bIndices")};\n      }\n      return value;\n    }\n\n    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${tsvb_Ke(t,v)}) {\n      let col = colIn * ${t};\n      if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {\n        var value = valueIn;\n        let coords = vec3<i32>(batch, row, colIn);\n        ${e?`value = value + ${s?"bias[colIn]":`${tsvb_Ke(t,v)}(bias[row])`};`:""}\n        ${r}\n        ${f.setByIndices("vec3<u32>(coords)","value")}\n      }\n    }\n    `},tsvb_Bn=(t,e,r,n,i=!1)=>{let s=t[0].dims,o=t[1].dims,a=s.slice(0,-2),u=o.slice(0,-2),l=n?n.slice(0,-2):r.slice(0,-2),c=tsvb_Ue(l.length),h=c?l.length:l,f=src_tsvb_n("batchDims",t[0].dataType,h,1),d=tsvb_ort_webgpu_min_N.size(l),p=s[s.length-2],v=s[s.length-1],y=o[o.length-1],b=v%4==0&&y%4==0,_=p<=8?[4,1,1]:[4,4,1],m=[8,8,1],g=[Math.ceil(y/m[0]/_[0]),Math.ceil(p/m[1]/_[1]),Math.ceil(d/m[2]/_[2])],w=tsvb_Le(t[0].dataType),x=b?4:1,T=[...a,p,v/x],S=tsvb_Ue(T.length),E=S?T.length:T,O=[...u,v,y/x],P=tsvb_Ue(O.length),A=P?O.length:O,C=[d,p,y/x],k=tsvb_z("a",t[0].dataType,E,x),I=tsvb_z("b",t[1].dataType,A,x),R=tsvb_ort_webgpu_min_j("result",t[0].dataType,C.length,x),$=[k,I],M=[{type:"int32",data:p},{type:"int32",data:y},{type:"int32",data:v}];c&&M.push(...tsvb_F(l)),S&&M.push(...tsvb_F(T)),P&&M.push(...tsvb_F(O));let D=[];D.push(S?"rank":"dims"),D.push(P?"rank":"dims");let B=t.length>2,{activationFunction:L,applyActivation:N}=tsvb_At(e,R.type.value),F=tsvb_Ac(x,B,N,[f,k,I,R],[a,u,l],i);if(B){let e=i?x:1;$.push(tsvb_z("bias",t[2].dataType,t[2].dims.length,e)),M.push(...tsvb_F(t[2].dims)),D.push("rank")}M.push(...tsvb_F(C));return{name:"MatMul",shaderCache:{hint:e.activationCacheKey+`${_}${b}${i}`,inputDependencies:D},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:g[0],y:g[1],z:g[2]},programUniforms:M}),getShaderSource:t=>`\n  ${t.registerUniform("dimAOuter","i32").registerUniform("dimBOuter","i32").registerUniform("dimInner","i32").registerInternalVariables(f).declareVariables(...$,R)}\n  ${L}\n  ${F}\n  ${b?tsvb_Ur(_,m,w,f):tsvb_Nr(_,m,w,f)}\n                   `}}})),tsvb_Tc,tsvb_Ws,tsvb_Vs=tsvb_q((()=>{tsvb_Nt(),tsvb_$e(),tsvb_Wt(),tsvb_On(),tsvb_Ta(),tsvb_Wr(),tsvb_Tc=(t,e,r,n,i=!1,s,o=4,a=4,u=4,l="f32")=>{let c=t?"\n    let coord = vec4<i32>(batch, xRow, xCol, xCh);\n    ":"\n    let coord = vec4<i32>(batch, xCh, xRow, xCol);\n    ",h=t?"\n    let coords = vec4<i32>(\n      batch,\n      row / outWidth,\n      row % outWidth,\n      col);\n    ":"\n    let coords = vec4<i32>(\n      batch,\n      row,\n      col / outWidth,\n      col % outWidth);\n    ",f=t?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",d=t?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",p=t?"row":"col",v=t?"col":"row",y=`\n    let inChannels = i32(uniforms.w_shape[2]);\n    let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n    let outRow = ${p} / outWidth;\n    let outCol = ${p} % outWidth;\n\n    let WRow = ${v} / (filterDims[1] * inChannels);\n    let WCol = ${v} / inChannels % filterDims[1];\n    let xRow = outRow * stride[0] + dilation[0] * WRow - pad[0];\n    let xCol = outCol * stride[1] + dilation[1] * WCol - pad[1];\n    let xCh = ${v} % inChannels;\n    var resData = ${tsvb_Ke(o,l)}(0.0);\n    // The bounds checking is always needed since we use it to pad zero for\n    // the 'same' padding type.\n    if (xRow >= 0 && xRow < ${f} && xCol >= 0 && xCol < ${d}) {\n      ${c}\n      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));\n      ${(t=>{switch(t){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${l}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${t} is not supported.`)}})(o)}\n    }\n    return resData;`,b=t?e&&n?`\n    let col = colIn * ${o};\n    ${y}`:`\n    let col = colIn * ${o};\n    if (row < uniforms.dimAOuter && col < uniforms.dimInner) {\n      ${y}\n    }\n    return ${tsvb_Ke(o,l)}(0.0);`:n&&r?`\n    let col = colIn * ${o};\n    ${y}`:`\n    let col = colIn * ${o};\n    if (row < uniforms.dimInner && col < uniforms.dimBOuter) {\n      ${y}\n    }\n    return ${tsvb_Ke(o,l)}(0.0);`,_=`${(t=>{switch(t){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${t} is not supported.`)}})(a)}`,m=tsvb_Ke(u,l),g=tsvb_Ke(t?o:a,l),w=tsvb_Ke(t?a:o,l),{activationFunction:x,applyActivation:T}=tsvb_At(s,m);return`\n    ${x}\n    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${g} {\n      ${t?b:_}\n    }\n\n    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${w} {\n      ${t?_:b}\n    }\n\n    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${m}) {\n      let col = colIn * ${u};\n      if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)\n      {\n      var value = valueIn;\n      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n      ${h}\n      ${tsvb_En(i)}\n      ${T}\n      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n      }\n    }`},tsvb_Ws=(t,e,r,n,i,s,o,a)=>{let u="NHWC"===e.format,l=u?t[0].dims[3]:t[0].dims[1],c=r[0],h=u?r[2]:r[3],f=u?r[1]:r[2],d=u?r[3]:r[1],p=u&&(l%4==0||l%3==0)&&d%4==0,v=u?d:h*f,y=u?h*f:d,b=[8,8,1],_=n<=8?[4,1,1]:[4,4,1],m=[Math.ceil(v/b[0]/_[0]),Math.ceil(y/b[1]/_[1]),Math.ceil(c/b[2]/_[2])];tsvb_De("verbose",(()=>`[conv2d_mm_webgpu] dispatch = ${m}`));let g=p?u&&l%4!=0?3:4:1,w=b[1]*_[1],x=b[0]*_[0],T=Math.max(b[0]*g,b[1]),S=n%w==0,E=i%x==0,O=s%T==0,P=p?[g,4,4]:[1,1,1],A=tsvb_Le(t[0].dataType),C=p?4:1,k=[{type:"int32",data:n},{type:"int32",data:i},{type:"int32",data:s}],I=[tsvb_z("x",t[0].dataType,t[0].dims.length,3===g?1:g),tsvb_z("w",t[1].dataType,t[1].dims.length,C)];k.push(...tsvb_F(t[0].dims)),k.push(...tsvb_F(t[1].dims));let R=`\n      fn setOutputAtIndex(flatIndex : i32, value : ${p?`vec4<${A}>`:A}) {\n        result[flatIndex] = ${p?`vec4<${A}>`:A}(value);\n      }\n      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${p?`vec4<${A}>`:A}) {\n        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));\n        setOutputAtIndex(flatIndex ${p?"/ 4":""}, value);\n      }`;if(o){let e=tsvb_z("bias",t[2].dataType,t[2].dims.length,C);I.push(e),k.push(...tsvb_F(t[2].dims)),R+=`\n        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${p?`vec4<${A}>`:A} {\n          return bias[coords.${u?"w":"y"}${p?"/ 4":""}];\n        }`}let $=tsvb_ort_webgpu_min_j("result",t[0].dataType,r.length,C);return k.push(...tsvb_F(r)),{name:"Conv2DMatMul",shaderCache:{hint:e.cacheKey},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:m[0],y:m[1],z:m[2]},programUniforms:k}),getShaderSource:t=>`\n        ${tsvb_kn("uniforms.result_strides")}\n        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,\n        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,\n        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };\n        ${t.registerUniform("dimAOuter","i32").registerUniform("dimBOuter","i32").registerUniform("dimInner","i32").declareVariables(...I,$)}\n        const filterDims : vec2<i32> = vec2<i32>(${e.kernelShape[0]}, ${e.kernelShape[1]});\n        const pad : vec2<i32> = vec2<i32>(${e.pads[0]}, ${e.pads[1]});\n        const stride : vec2<i32> = vec2<i32>(${e.strides[0]}, ${e.strides[1]});\n        const dilation : vec2<i32> = vec2<i32>(${e.dilations[0]}, ${e.dilations[1]});\n        ${R}\n        ${tsvb_Tc(u,S,E,O,o,e,P[0],P[1],P[2],A)}\n            ${p?tsvb_Ur(_,b,A,void 0,!u,T):tsvb_Nr(_,b,A,void 0,!u,T,!1,void 0,a)}`}}})),tsvb_Ea,tsvb_Gs=tsvb_q((()=>{tsvb_xe(),tsvb_$e(),tsvb_ka(),tsvb_Wt(),tsvb_Ea=(t,e,r)=>{let n=t.length>2,i=n?"value += b[output_channel];":"",s=t[0].dims,o=t[1].dims,a=o[0]/e.group,u="NHWC"===e.format,l=tsvb_Oa(s,o,e.dilations,e.pads,e.strides,u),c=tsvb_ort_webgpu_min_N.size(l),h=tsvb_ort_webgpu_min_j("output",t[0].dataType,l),{activationFunction:f,applyActivation:d}=tsvb_At(e,h.type.value),p=tsvb_z("x",t[0].dataType,s),v=tsvb_z("w",t[1].dataType,o),y=[p,v];n&&y.push(tsvb_z("b",t[2].dataType,t[2].dims));return{name:"GroupedConv",shaderCache:{hint:e.cacheKey},getRunData:()=>({outputs:[{dims:r?r(l):l,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)}}),getShaderSource:t=>`\n  const strides: vec2<u32> = vec2(${e.strides[0]}u, ${e.strides[1]}u);\n  const pads: vec2<u32> = vec2(${e.pads[0]}u, ${e.pads[1]}u);\n\n  ${t.declareVariables(...y,h)}\n\n  ${f}\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes(c)}\n\n    let outputIndices = ${h.offsetToIndices("global_idx")};\n    let batch: u32 = outputIndices[0];\n    let output_channel: u32 = outputIndices[${u?3:1}];\n    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${u?1:2}], outputIndices[${u?2:3}]) * strides - pads;\n    let group_id: u32 = output_channel / ${a}u;\n\n    var value: ${h.type.value} = ${h.type.value}(0);\n    for (var wInChannel: u32 = 0u; wInChannel < ${o[1]}u; wInChannel++) {\n      let input_channel = group_id * ${o[1]}u + wInChannel;\n      for (var wHeight: u32 = 0u; wHeight < ${o[2]}u; wHeight++) {\n        let xHeight = xRCCorner.x + wHeight * ${e.dilations[0]}u;\n\n        if (xHeight < 0u || xHeight >= ${s[u?1:2]}u) {\n          continue;\n        }\n\n        for (var wWidth: u32 = 0u; wWidth < ${o[3]}u; wWidth++) {\n          let xWidth = xRCCorner.y + wWidth * ${e.dilations[1]}u;\n          if (xWidth < 0u || xWidth >= ${s[u?2:3]}u) {\n            continue;\n          }\n\n          let xVal = ${u?p.get("batch","xHeight","xWidth","input_channel"):p.get("batch","input_channel","xHeight","xWidth")};\n          let wVal = ${v.get("output_channel","wInChannel","wHeight","wWidth")};\n          value += xVal*wVal;\n        }\n      }\n    }\n    ${i}\n    ${d}\n    ${h.setByOffset("global_idx","value")}\n  }`}}})),tsvb_Ba,tsvb_Ec,tsvb_Ls,tsvb_Pa=tsvb_q((()=>{tsvb_xe(),tsvb_Wr(),tsvb_$e(),tsvb_Wt(),tsvb_Ba=(t,e,r,n,i=!1)=>{let s=t[0].dims,o=t[1].dims,a=s[s.length-2],u=o[o.length-1],l=s[s.length-1],c=tsvb_He(u),h=tsvb_He(l),f=tsvb_He(a),d=tsvb_ort_webgpu_min_N.size(r)/c/f,p=t.length>2,v=n?n.slice(0,-2):r.slice(0,-2),y=[tsvb_ort_webgpu_min_N.size(v),a,u],b=[{type:"uint32",data:d},{type:"uint32",data:a},{type:"uint32",data:u},{type:"uint32",data:l},...tsvb_F(v),...tsvb_F(s),...tsvb_F(o)];p&&b.push(...tsvb_F(t[2].dims)),b.push(...tsvb_F(y));return{name:"MatMulNaive",shaderCache:{hint:`${e.activationCacheKey}_${c}_${h}_${f}_${i}`,inputDependencies:p?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:b}),getShaderSource:n=>{let a=src_tsvb_n("batch_dims",t[0].dataType,v.length),u=tsvb_z("a",t[0].dataType,s.length,h),l=tsvb_z("b",t[1].dataType,o.length,c),d=tsvb_ort_webgpu_min_j("output",t[0].dataType,y.length,c),{activationFunction:b,applyActivation:_}=tsvb_At(e,d.type.value),m=[u,l],g="";if(p){let e=i?c:1;m.push(tsvb_z("bias",t[2].dataType,t[2].dims.length,e)),g=""+(i?`value += bias[col / ${e}];`:`value += ${d.type.value}(bias[row + i]);`)}let w=s.slice(0,-2),x=o.slice(0,-2),T=tsvb_fr(w,v),S=tsvb_fr(x,v),E=(t,e)=>{let r=t.rank,n=t.name;if(2===r)return`var ${n}_indices = ${t.type.indices}(0u, 0u);`;let i=a.rank,s=`var ${n}_indices: ${t.type.indices};`;for(let t=r-2-1,e=i-1;t>=0;t--,e--)s+=`\n${n}_indices[${t}] = ${i>1?`batch_indices[${e}]`:"batch_indices"};`;return e.forEach((t=>{s+=`\n${n}_indices[${t}] = 0;`})),s+=`${n}_indices[${r-2}] = 0u;\n                     ${n}_indices[${r-1}] = 0u;`,s};return`\n  ${n.registerUniform("outputSize","u32").registerUniform("M","u32").registerUniform("N","u32").registerUniform("K","u32").registerInternalVariables(a).declareVariables(...m,d)}\n  ${b}\n  ${n.mainStart()}\n    ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n    let col = (global_idx % (uniforms.N / ${c})) * ${c};\n    var index1 = global_idx / (uniforms.N / ${c});\n    let stride1 = uniforms.M / ${f};\n    let row = (index1 % stride1) * ${f};\n    let batch = index1 / stride1;\n\n    ${2===r.length?"":`let batch_indices = ${a.offsetToIndices("batch")};`}\n    ${E(u,T)}\n    let a_offset = ${u.indicesToOffset("a_indices")};\n    ${E(l,S)}\n    let b_offset = ${l.indicesToOffset("b_indices")};\n    var values: array<${d.type.value}, ${f}>;\n    for (var k: u32 = 0u; k < uniforms.K; k = k + ${h}) {\n      ${(()=>{let t=`var a_data: ${u.type.value};`;for(let e=0;e<h;e++)t+=`\n              let b_data${e} = b[(b_offset + (k + ${e}) * uniforms.N + col) / ${c}];`;for(let e=0;e<f;e++){t+=`a_data = a[(a_offset + (row + ${e}) * uniforms.K + k) / ${h}];`;for(let r=0;r<h;r++)t+=`\n            values[${e}] = fma(${l.type.value}(a_data${1===h?"":`[${r}]`}), b_data${r}, values[${e}]);\n`}return t})()}\n    }\n    for (var i = 0u; i < ${f}u; i++) {\n      var value = values[i];\n      ${g}\n      ${_}\n      let cur_indices = ${d.type.indices}(batch, row + i, col);\n      let offset = ${d.indicesToOffset("cur_indices")};\n      ${d.setByOffset(`offset / ${c}`,"value")};\n    }\n  }\n  `}}},tsvb_Ec=t=>{if(!t||2!==t.length)throw new Error("MatMul requires 2 inputs.");if(t[0].dims[t[0].dims.length-1]!==t[1].dims[t[1].dims.length-2])throw new Error("shared dimension does not match.")},tsvb_Ls=t=>{tsvb_Ec(t.inputs);let e=tsvb_vt.calcShape(t.inputs[0].dims,t.inputs[1].dims,!0);if(!e)throw new Error("Can't use matmul on the given tensors");let r=e[e.length-1],n=t.inputs[0].dims[t.inputs[0].dims.length-1];r<8&&n<8?t.compute(tsvb_Ba(t.inputs,{activation:"",activationCacheKey:""},e)):t.compute(tsvb_Bn(t.inputs,{activation:"",activationCacheKey:""},e))}})),tsvb_Oa,tsvb_Hs,tsvb_Oc,tsvb_Fs,tsvb_Ra,tsvb_kc,tsvb_Bc,tsvb_Da,tsvb_ka=tsvb_q((()=>{tsvb_xe(),tsvb_Fe(),tsvb_Vs(),tsvb_Wr(),tsvb_Gs(),tsvb_Wt(),tsvb_Pa(),tsvb_hr(),tsvb_Oa=(t,e,r,n,i,s)=>{let o=t[0],a=t.slice(s?1:2,s?3:4),u=a.length,l=e[0],c=e.slice(2).map(((t,e)=>t+(t-1)*(r[e]-1))),h=a.map(((t,e)=>t+n[e]+n[e+u])).map(((t,e)=>Math.floor((t-c[e]+i[e])/i[e])));return h.splice(0,0,o),h.splice(s?3:1,0,l),h},tsvb_Hs=[2,3,1,0],tsvb_Oc=(t,e)=>{if(!t||2!==t.length&&3!==t.length)throw new Error("Conv requires 2 or 3 inputs");if(4!==t[0].dims.length&&3!==t[0].dims.length)throw new Error("currently only support conv 1D and 2D");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");if(t[0].dims["NHWC"===e.format?t[0].dims.length-1:1]!==t[1].dims[1]*e.group)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(3===t.length&&(1!==t[2].dims.length||t[1].dims[0]!==t[2].dims[0]))throw new Error("invalid bias");let r=t[0].dims.length-2;if(e.dilations.length!==r)throw new Error(`dilations should be ${r}D`);if(e.strides.length!==r)throw new Error(`strides should be ${r}D`);if(e.pads.length!==2*r)throw new Error(`pads should be ${2*r}D`);if(0!==e.kernelShape.length&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape")},tsvb_Fs=(t,e)=>{let r=t.kernelShape.slice();for(let t=2;t<e[1].dims.length;++t)0===r[t-2]&&(r[t-2]=e[1].dims[t]);let n=t.pads.slice();tsvb_Qt.adjustPadsBasedOnAutoPad(e[0].dims,t.strides,t.dilations,r,n,"NHWC"===t.format,t.autoPad);let i=Object.assign({},t);return Object.assign(i,{kernelShape:r,pads:n,cacheKey:t.cacheKey}),i},tsvb_Ra=t=>{let e=tsvb_Tn(t),r=t.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],i=t.dilations,s=t.group,o=t.kernel_shape,a=t.pads,u=t.strides,l=t.w_is_const();return tsvb_he({autoPad:n,format:r,dilations:i,group:s,kernelShape:o,pads:a,strides:u,wIsConst:l,...e})},tsvb_kc=(t,e,r)=>{let n=tsvb_Fs(r,e),i="NHWC"===r.format;if(1!==r.group)return void t.compute(tsvb_Ea(e,n));let s=3===e.length,o=e[0].dims[i?1:2],a=e[0].dims[i?2:3],u=e[0].dims[i?3:1],l=e[1].dims[2],c=e[1].dims[3],h=tsvb_Oa(e[0].dims,e[1].dims,r.dilations,n.pads,r.strides,i),f=h[i?1:2],d=h[i?2:3],p=h[i?3:1],v=i&&l===o&&c===a&&0===r.pads[0]&&0===r.pads[1];if(v||1===l&&1===c&&1===r.dilations[0]&&1===r.dilations[1]&&1===r.strides[0]&&1===r.strides[1]&&0===r.pads[0]&&0===r.pads[1]){let l,c,y,b=h[0],_=[];if(i){let n=t.kernelCustomData.wT??t.compute(tsvb_gt(e[1],tsvb_Hs),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];if(r.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=n),v){let t=o*a*u;l=e[0].reshape([1,b,t]),c=n.reshape([1,t,p]),y=[1,b,p]}else l=e[0].reshape([b,o*a,u]),c=n.reshape([1,u,p]),y=[b,f*d,p];_.push(l),_.push(c)}else l=e[0].reshape([b,u,o*a]),c=e[1].reshape([1,p,u]),y=[b,p,f*d],_.push(c),_.push(l);s&&_.push(e[2]);let m=y[2],g=_[0].dims[_[0].dims.length-1];return void(m<8&&g<8?t.compute(tsvb_Ba(_,n,h,y,i),{inputs:_}):t.compute(tsvb_Bn(_,n,h,y,i),{inputs:_}))}let y=t.kernelCustomData.wT??t.compute(tsvb_gt(e[1],tsvb_Hs),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=y);let b=[e[0],y];s&&b.push(e[2]);let _=i?f*d:p,m=i?p:f*d,g=l*c*u;t.compute(tsvb_Ws(b,n,h,_,m,g,s,!0),{inputs:b})},tsvb_Bc=(t,e)=>{let r="NHWC"===e.format,n=[t.inputs[0].reshape(r?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];3===t.inputs.length&&n.push(t.inputs[2]);let i=[0,e.pads[0],0,e.pads[1]],s=[1].concat(e.strides),o=[1].concat(e.dilations),a=[1].concat(e.kernelShape),u=tsvb_Fs({...e,pads:i,strides:s,dilations:o,kernelShape:a},n);t.compute(tsvb_Ea(n,u,(t=>r?[t[0],t[2],t[3]]:[])))},tsvb_Da=(t,e)=>{tsvb_Oc(t.inputs,e),3===t.inputs[0].dims.length?tsvb_Bc(t,e):tsvb_kc(t,t.inputs,e)}})),tsvb_Pc,tsvb_qs,tsvb_js=tsvb_q((()=>{tsvb_Nt(),tsvb_$e(),tsvb_Wt(),tsvb_On(),tsvb_Ta(),tsvb_Wr(),tsvb_Pc=(t,e=!1,r,n=4)=>{let i=tsvb_Ke(n,"f32"),s=t?"\n    let coords = vec4<i32>(\n      batch,\n      row / outWidth,\n      row % outWidth,\n      col);\n    ":"\n    let coords = vec4<i32>(\n      batch,\n      row,\n      col / outWidth,\n      col % outWidth);\n    ",o=t?"row":"col",a=t?"col":"row",u=`\n      let inChannels = ${t?"outBackprop[3]":"outBackprop[1]"};\n      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n      let outRow = ${o} / outWidth;\n      let outCol = ${o} % outWidth;\n\n      let WRow = ${a} / (filterDims[1] * inChannels);\n      let WCol = ${a} / inChannels % filterDims[1];\n      let xR = f32(outRow - pads[0] + dilation[0] * WRow) / f32(strides[0]);\n      let xC = f32(outCol - pads[1] + dilation[1] * WCol) / f32(strides[1]);\n      if (xR < 0.0 || xR >= f32(${t?"outBackprop[1]":"outBackprop[2]"}) || fract(xR) > 0.0) {\n        return ${i}(0.0);\n      }\n      if (xC < 0.0 || xC >= f32(${t?"outBackprop[2]":"outBackprop[3]"}) || fract(xC) > 0.0) {\n        return ${i}(0.0);\n      }\n      let iXR = i32(xR);\n      let iXC = i32(xC);\n      let xCh = ${a} % inChannels;\n      ${t?"\n      let coord = vec4<i32>(batch, iXR, iXC, xCh);\n      ":"\n      let coord = vec4<i32>(batch, xCh, iXR, iXC);\n      "}\n      return x[getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape))/${n}];`,l=t?`\n      let col = colIn * ${n};\n      if (row < uniforms.dimAOuter && col < uniforms.dimInner) {\n        ${u}\n      }\n      return ${i}(0.0);`:`\n      let col = colIn * ${n};\n      if (row < uniforms.dimInner && col < uniforms.dimBOuter) {\n        ${u}\n      }\n      return ${i}(0.0);`,c=`\n      let col = colIn * ${n};\n      let inChannels = ${t?"outBackprop[3]":"outBackprop[1]"};\n      let coordX = filterDims.x - 1 - row / (filterDims[1] * inChannels);\n      let coordY = filterDims.y - 1 - (row / inChannels) % filterDims[1];\n      if (${t?"row < uniforms.dimInner && col < uniforms.dimBOuter":"row < uniforms.dimInner && col < uniforms.dimAOuter"}  && coordX >= 0 && coordY >= 0) {\n        let rowInner = row % inChannels;\n        let coord = vec4<i32>(coordX, coordY, col, rowInner);\n        ${(t=>{switch(t){case 1:return"return w[getIndexFromCoords4D(coord, vec4<i32>(uniforms.w_shape))];";case 4:return"\n            let coord1 = vec4<i32>(coordX, coordY, col + 1, rowInner);\n            let coord2 = vec4<i32>(coordX, coordY, col + 2, rowInner);\n            let coord3 = vec4<i32>(coordX, coordY, col + 3, rowInner);\n            let v0 = w[getIndexFromCoords4D(coord, vec4<i32>(uniforms.w_shape))];\n            let v1 = w[getIndexFromCoords4D(coord1, vec4<i32>(uniforms.w_shape))];\n            let v2 = w[getIndexFromCoords4D(coord2, vec4<i32>(uniforms.w_shape))];\n            let v3 = w[getIndexFromCoords4D(coord3, vec4<i32>(uniforms.w_shape))];\n            return vec4<f32>(v0, v1, v2, v3);\n            ";default:throw new Error(`innerElementSize ${t} is not supported.`)}})(n)}\n      }\n      return ${i}(0.0);\n      `,{activationFunction:h,applyActivation:f}=tsvb_At(r,i);return`\n      ${h}\n  fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${i} {\n    ${t?l:c}\n  }\n\n  fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${i} {\n    ${t?c:l}\n  }\n\n  fn mm_write(batch: i32, row : i32, colIn : i32, valueInput : ${i}) {\n    let col = colIn * ${n};\n    if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {\n      var value = valueInput;\n      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n      ${s}\n      ${tsvb_En(e)}\n      ${f}\n      result[getIndexFromCoords4D(coords, vec4<i32>(uniforms.result_shape))/${n}] = value;\n    }\n  }`},tsvb_qs=(t,e,r,n,i,s,o,a)=>{let u="NHWC"===e.format,l=u?t[0].dims[3]:t[0].dims[1],c=r[0],h=u?r[2]:r[3],f=u?r[1]:r[2],d=u?r[3]:r[1],p=u?l%4==0&&d%4==0:h%4==0&&d%4==0,v=u?d:h*f,y=u?h*f:d,b=p?[8,8,1]:[v<=4||y<=4?4:16,v>4&&y<=4?4:16,1],_=p?[4,4,1]:[v<=4?1:4,v>4&&y<=4?1:4,1],m=[Math.ceil(v/b[0]/_[0]),Math.ceil(y/b[1]/_[1]),Math.ceil(c/b[2]/_[2])];tsvb_De("verbose",(()=>`[conv_backprop_mm_webgpu] dispatch = ${m}`));let g=p?4:1,w=Math.max(b[0]*g,b[1]),x=p?4:1,T=[{type:"int32",data:n},{type:"int32",data:i},{type:"int32",data:s}],S=tsvb_z("x",t[0].dataType,t[0].dims.length,x),E=tsvb_z("w",t[1].dataType,t[1].dims.length,1),O=tsvb_ort_webgpu_min_j("result",t[0].dataType,r.length,x),P=[S,E];T.push(...tsvb_F(t[0].dims)),T.push(...tsvb_F(t[1].dims));let A="";if(o){let e=tsvb_z("bias",t[2].dataType,t[2].dims.length,x);P.push(e),T.push(...tsvb_F(t[2].dims)),A+=`\n        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${p?"vec4<f32>":"f32"} {\n          return bias[coords.${u?"w":"y"}${p?"/ 4":""}];\n        }`}return T.push(...tsvb_F(r)),{name:"Conv2DTransposeMatMul",shaderCache:{hint:e.cacheKey},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:m[0],y:m[1],z:m[2]},programUniforms:T}),getShaderSource:r=>`\n        ${tsvb_kn("uniforms.result_strides")}\n        ${r.registerUniform("dimAOuter","i32").registerUniform("dimBOuter","i32").registerUniform("dimInner","i32").declareVariables(...P,O)};\n        const outBackprop : vec4<i32> = vec4<i32>(${t[0].dims.join(",")});\n        const filterDims : vec2<i32> = vec2<i32>(${e.kernelShape[u?1:2]}, ${e.kernelShape[u?2:3]});\n        const effectiveFilterDims : vec2<i32> = filterDims + vec2<i32>(\n              ${e.dilations[0]<=1?0:(e.kernelShape[u?1:2]-1)*(e.dilations[0]-1)},\n              ${e.dilations[1]<=1?0:(e.kernelShape[u?2:3]-1)*(e.dilations[1]-1)});\n        const pads : vec2<i32> = vec2<i32>(i32(effectiveFilterDims[0]) - 1 - (${e.pads[0]+e.pads[2]})/2,\n                                         i32(effectiveFilterDims[1]) - 1 - (${e.pads[1]+e.pads[3]})/2);\n        const strides : vec2<i32> = vec2<i32>(${e.strides[0]}, ${e.strides[1]});\n        const dilation : vec2<i32> = vec2<i32>(${e.dilations[0]}, ${e.dilations[1]});\n        const dimAOuter : i32 = ${n};\n        const dimBOuter : i32 = ${i};\n        const dimInner : i32 = ${s};\n        ${A}\n        ${tsvb_Pc(u,o,e,g)}\n        ${p?tsvb_Ur(_,b,"f32",void 0,!u,w):tsvb_Nr(_,b,"f32",void 0,!u,w,!1,void 0,a)}`}}})),tsvb_Rc,tsvb_Ma,tsvb_Ks=tsvb_q((()=>{tsvb_Nt(),tsvb_xe(),tsvb_$e(),tsvb_Rc=(t,e,r,n,i,s,o=!1,a)=>{let u="NHWC"===r.format,l=u?1:2,c=u?2:3,h=u?3:1,f=tsvb_ort_webgpu_min_N.size(n),d=o?2:1,p=r.group,v=e[1].dims,y=v[0]/p,b=v[1],_=`\n  fn setOutputAtIndex(flatIndex : u32, value : ${o?`vec4<${a}>`:a}) {\n    result[flatIndex] = ${o?`vec4<${a}>`:a}(value);\n  }`;i&&(_+=`\n    fn getBiasByOutputCoords(coords : vec4<u32>) -> ${o?`vec4<${a}>`:a} {\n      return bias[coords.${u?"w":"y"}${o?"/ 4":""}];\n    }`);let m=o?4:1,g=tsvb_z("W",e[1].dataType,e[1].dims,m),w=tsvb_z("Dy",e[0].dataType,e[0].dims,m),x=[w,g];i&&x.push(tsvb_z("bias",e[2].dataType,[n[h]],m));let T=tsvb_ort_webgpu_min_j("result",e[0].dataType,n,m),S=`{\n        let batch: u32 = ${s?"global_id.z":"workgroup_id.z"} / outShape[1];\n        let r = ${s?"global_id.z":"workgroup_id.z"} % outShape[1];\n        let c = ${s?"global_id.y":"workgroup_id.y"} * ${d};\n        let d1: u32 = ${s?"global_id.x":"workgroup_id.x"} * 4;\n\n        let dyCorner = vec2<i32>(i32(r), i32(c)) - vec2<i32>(pads);\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd: array<vec4<${a}>, ${d}>;\n        for (var i = 0; i < ${d}; i++) {\n          dotProd[i] = vec4<${a}>(0.0);\n        }\n        for (var wR: u32 = 0; wR < filterDims[0]; wR = wR + 1) {\n          var dyR = (${a}(dyCorner.x) + ${a}(wR)) / ${a}(strides.x);\n          let wRPerm = filterDims[0] - 1 - wR;\n          if (dyR < 0.0 || dyR >= ${a}(outBackprop[1]) ||\n              fract(dyR) > 0.0 || wRPerm < 0) {\n            continue;\n          }\n          let idyR: u32 = u32(dyR);\n\n          for (var wC: u32 = 0; wC < filterDims[1]; wC = wC + 1) {\n            let dyC = (${a}(dyCorner.y) + ${a}(wC)) / ${a}(strides.y);\n            let dyC2 = (${a}(dyCorner.y) + 1.0 + ${a}(wC)) / ${a}(strides.y);\n            let wCPerm = filterDims[1] - 1 - wC;\n            if (wCPerm < 0) {\n              continue;\n            }\n            var bDyCVal = true;\n            var bDyCVal2 = true;\n            if (dyC < 0.0 || dyC >= ${a}(outBackprop[2]) ||\n                fract(dyC) > 0.0) {\n              bDyCVal = false;\n            }\n            if (dyC2 < 0.0 || dyC2 >= ${a}(outBackprop[2]) ||\n                fract(dyC2) > 0.0) {\n              bDyCVal2 = false;\n            }\n\n            let idyC: u32 = u32(dyC);\n            let idyC2: u32 = u32(dyC2);\n            if (bDyCVal && bDyCVal2) {\n              let d2Length = outBackprop[3];\n              for (var d2 :u32 = 0; d2 < d2Length; d2 = d2 + 4) {\n                let wValue0 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1","d2")};\n                let wValue1 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 1","d2")};\n                let wValue2 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 2","d2")};\n                let wValue3 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 3","d2")};\n\n                var xValue = ${w.get("batch","idyR","idyC","d2")};\n                let tmpval = vec4<${a}>(dot(xValue, wValue0),\n                                      dot(xValue, wValue1),\n                                      dot(xValue, wValue2),\n                                      dot(xValue, wValue3));\n                dotProd[0] = dotProd[0] + tmpval;\n\n                xValue =  ${w.get("batch","idyR","idyC2","d2")};\n\n                dotProd[1] = dotProd[1] + vec4<${a}>(dot(xValue, wValue0),\n                                                    dot(xValue, wValue1),\n                                                    dot(xValue, wValue2),\n                                                    dot(xValue, wValue3));\n              }\n            } else if (bDyCVal) {\n              let d2Length = outBackprop[${h}];\n              for (var d2: u32 = 0; d2 < d2Length; d2 = d2 + 4) {\n                let wValue0 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1","d2")};\n                let wValue1 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 1","d2")};\n                let wValue2 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 2","d2")};\n                let wValue3 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 3","d2")};\n\n                var xValue = ${w.get("batch","idyR","idyC","d2")};\n                let tmpval = vec4<${a}>(dot(xValue, wValue0),\n                                      dot(xValue, wValue1),\n                                      dot(xValue, wValue2),\n                                      dot(xValue, wValue3));\n                dotProd[0] = dotProd[0] + tmpval;\n              }\n            } else if (bDyCVal2) {\n              let d2Length = outBackprop[3];\n              for (var d2: u32 = 0; d2 < d2Length; d2 = d2 + 4) {\n                let wValue0 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1","d2")};\n                let wValue1 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 1","d2")};\n                let wValue2 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 2","d2")};\n                let wValue3 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 3","d2")};\n\n                var xValue = ${w.get("batch","idyR","idyC2","d2")};\n                let tmpval = vec4<${a}>(dot(xValue, wValue0),\n                                      dot(xValue, wValue1),\n                                      dot(xValue, wValue2),\n                                      dot(xValue, wValue3));\n                dotProd[1] = dotProd[1] + tmpval;\n              }\n            }\n          }\n        }\n\n        for (var i: u32 = 0; i < ${d}; i = i + 1) {\n          let value = dotProd[i] + ${i?"bias[c+i]":`vec4<${a}>(0.0)`};\n          ${T.set("batch","r","c + i","d1","value")};\n        }\n      }`,E=`\n          let outputIndices = ${T.offsetToIndices("global_idx")};\n          let batch = ${T.indicesGet("outputIndices",0)};\n          let d1 = ${T.indicesGet("outputIndices",h)};\n          let r = ${T.indicesGet("outputIndices",l)};\n          let c = ${T.indicesGet("outputIndices",c)};\n          let dyCorner = vec2<i32>(i32(r), i32(c)) - pads;\n          let dyRCorner = dyCorner.x;\n          let dyCCorner = dyCorner.y;\n          let groupId = d1 / ${b};\n          let wOutChannel = d1 - groupId * ${b};\n          // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n          // ? = to be determined. : = across all values in that axis.\n          var dotProd = ${a}(0.0);\n          for (var wR: u32 = 0; wR < effectiveFilterDims.x; wR = wR + 1) {\n            if (wR % dilations.x != 0) {\n              continue;\n            }\n            let dyR = (${a}(dyRCorner) + ${a}(wR)) / ${a}(strides[0]);\n            let wRPerm = filterDims.x - 1 - wR / dilations.x;\n            if (dyR < 0.0 || dyR >= ${a}(outBackprop[${l}]) || fract(dyR) > 0.0 ||\n                wRPerm < 0) {\n              continue;\n            }\n            let idyR: u32 = u32(dyR);\n\n            for (var wC: u32 = 0; wC < effectiveFilterDims.y; wC = wC + 1) {\n              if (wC % dilations.y != 0) {\n                continue;\n              }\n              let dyC = (${a}(dyCCorner) + ${a}(wC)) / ${a}(strides.y);\n              let wCPerm = filterDims.y - 1 - wC / dilations.y;\n              if (dyC < 0.0 || dyC >= ${a}(outBackprop[${c}]) ||\n                  fract(dyC) > 0.0 || wCPerm < 0) {\n                continue;\n              }\n              let idyC: u32 = u32(dyC);\n              var inputChannel = groupId * ${y};\n              for (var d2: u32 = 0; d2 < ${y}; d2 = d2 + 1) {\n                let xValue = ${u?w.get("batch","idyR","idyC","inputChannel"):w.get("batch","inputChannel","idyR","idyC")};\n                let wValue = ${g.get("inputChannel","wOutChannel","u32(wRPerm)","u32(wCPerm)")};\n                dotProd = dotProd + xValue * wValue;\n                inputChannel = inputChannel + 1;\n              }\n            }\n          }\n          let value = dotProd + ${i?"bias[d1]":`${a}(0.0)`};\n          ${T.setByOffset("global_idx","value")};\n        `;return`\n  ${t.declareVariables(...x,T)}\n  ${_}\n  const outShape : vec4<u32> = vec4<u32>(${n.join(",")});\n  const outBackprop : vec4<u32> = vec4<u32>(${e[0].dims.join(",")});\n  const strides : vec2<u32> = vec2<u32>(${r.strides[0]}, ${r.strides[1]});\n  const filterDims : vec2<u32> = vec2<u32>(${r.kernelShape[u?1:2]}, ${r.kernelShape[u?2:3]});\n  const dilations : vec2<u32> = vec2<u32>(${r.dilations[0]}, ${r.dilations[1]});\n  const effectiveFilterDims : vec2<u32> = filterDims + vec2<u32>(\n          ${r.dilations[0]<=1?0:(r.kernelShape[u?1:2]-1)*(r.dilations[0]-1)},\n          ${r.dilations[1]<=1?0:(r.kernelShape[u?2:3]-1)*(r.dilations[1]-1)});\n  const pads : vec2<i32> = vec2<i32>(i32(effectiveFilterDims[0]) - 1 - (${r.pads[0]+r.pads[2]})/2,\n                                     i32(effectiveFilterDims[1]) - 1 - (${r.pads[1]+r.pads[3]})/2);\n    ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes(f)};\n  ${o?S:E}}`},tsvb_Ma=(t,e,r)=>{let n=t.length>2,i=e.outputShape,s=tsvb_ort_webgpu_min_N.size(i),o=[Math.ceil(s/64),1,1];tsvb_De("verbose",(()=>`[conv2d_backprop_webgpu] dispatch = ${o}`));let a=tsvb_Le(t[0].dataType);return{name:"ConvTranspose2D",shaderCache:{hint:e.cacheKey},getRunData:()=>({dispatchGroup:{x:o[0],y:o[1],z:o[2]},outputs:[{dims:r?r(i):i,dataType:t[0].dataType}]}),getShaderSource:r=>tsvb_Rc(r,t,e,i,n,1===o[1]&&1===o[2],!1,a)}}})),tsvb_Dc,tsvb_Mc,tsvb_zc,tsvb_Ys,tsvb_Zs,tsvb_Uc,tsvb_Nc,tsvb_Wc,tsvb_Vc,tsvb_Qs,tsvb_Xs=tsvb_q((()=>{tsvb_Fe(),tsvb_js(),tsvb_Ks(),tsvb_Wt(),tsvb_hr(),tsvb_Dc=(t,e,r,n,i,s)=>(t-1)*e+r+(n-1)*i+1-s,tsvb_Mc=(t,e,r,n,i)=>{let s=Math.floor(t/2);"SAME_UPPER"===e?(r[n]=s,r[i]=t-s):"SAME_LOWER"===e&&(r[n]=t-s,r[i]=s)},tsvb_zc=(t,e,r,n,i,s,o,a,u,l)=>{let c=t.length-2,h=0===l.length;if(0===u.length)for(let t=0;t<c;++t)u.push(0);let f=t[0],d=e[a?3:1]*i;for(let i=0,f=t.length-c-(a?1:0);i<c;++i,++f){let a=t[f],d=h?a*o[i]:l[i],p=tsvb_Dc(a,o[i],s[i],e[f],r[i],d);tsvb_Mc(p,n,s,i,i+c),h&&l.push(o[i]*(a-1)+u[i]+(e[f]-1)*r[i]+1-s[i]-s[i+c])}l.splice(0,0,f),l.splice(a?3:1,0,d)},tsvb_Ys=(t,e)=>{let r=t.kernelShape.slice();if(0===t.kernelShape.length||0===t.kernelShape.reduce(((t,e)=>t*e),1)){r.length=0;for(let t=2;t<e[1].dims.length;++t)r.push(e[1].dims[t])}let n="NHWC"===t.format;r.splice(0,0,e[1].dims[0]),r.splice(n?3:1,0,e[1].dims[1]);let i=t.pads.slice(),s=t.outputShape.slice(),o=t.outputPadding.slice(),a=e[0].dims,u=t.dilations.slice();if(0===u.reduce(((t,e)=>t+e),0)){let t=e[0].dims.length-2;u=new Array(t).fill(1)}let l=t.strides.slice();if(0===l.reduce(((t,e)=>t+e),0)){let t=e[0].dims.length-2;l=new Array(t).fill(1)}tsvb_zc(a,r,u,t.autoPad,t.group,i,l,n,o,s);let c=Object.assign({},t),h=t.cacheKey+[r.join("n,"),i.join(","),l.join(","),o.join(","),s.join(","),u.join(",")].join("_");return Object.assign(c,{kernelShape:r,pads:i,outputPadding:o,outputShape:s,dilations:u,strides:l,cacheKey:h}),c},tsvb_Zs=t=>{let e=tsvb_Tn(t),r=t.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof t.autoPad>"u"?0:t.autoPad],i=t.dilations,s=t.group,o=t.kernelShape,a=t.pads,u=t.strides,l=t.wIsConst(),c=t.outputPadding,h=t.outputShape;return tsvb_he({autoPad:n,format:r,dilations:i,group:s,kernelShape:o,outputPadding:c,outputShape:h,pads:a,strides:u,wIsConst:l,...e})},tsvb_Uc=(t,e)=>{if(!t||2!==t.length&&3!==t.length)throw new Error("Conv requires 2 or 3 inputs");if(4!==t[0].dims.length&&3!==t[0].dims.length)throw new Error("currently only support 2-dimensional conv");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");if(t[0].dims["NHWC"===e.format?t[0].dims.length-1:1]!==t[1].dims[0])throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let r=t[1].dims[1]*e.group;if(3===t.length&&(1!==t[2].dims.length||t[2].dims[0]!==r))throw new Error("invalid bias");let n=t[0].dims.length-2;if(e.dilations.reduce(((t,e)=>t+e),0)>0&&e.dilations.length!==n)throw new Error(`dilations should be ${n}D`);if(e.strides.reduce(((t,e)=>t+e),0)>0&&e.strides.length!==n)throw new Error(`strides should be ${n}D`);if(e.pads.reduce(((t,e)=>t+e),0)>0&&e.pads.length!==2*n)throw new Error(`pads should be ${2*n}D`);if(e.outputPadding.length!==n&&0!==e.outputPadding.length)throw new Error(`output_padding should be ${n}D`);if(e.kernelShape.reduce(((t,e)=>t+e),0)>0&&0!==e.kernelShape.length&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape");if(0!==e.outputShape.length&&e.outputShape.length!==t[0].dims.length-2)throw new Error("invalid output shape")},tsvb_Nc=[2,3,1,0],tsvb_Wc=(t,e,r)=>{let n=tsvb_Ys(r,e),i="NHWC"===r.format,s=n.outputShape,o=s[i?3:1],a=e[0].dims[i?3:1];if(1!==n.group||1===o&&1===a)return void t.compute(tsvb_Ma(e,n));let u=s[i?1:2],l=s[i?2:3],c=i?u*l:o,h=i?o:u*l,f=e[1].dims[2]*e[1].dims[3]*a,d=t.kernelCustomData.wT??t.compute(tsvb_gt(e[1],tsvb_Nc),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=d);let p=[e[0],d],v=3===e.length;v&&(i||1!==e[2].dims.length?p.push(e[2]):p.push(e[2].reshape([e[2].dims[0],1,1]))),t.compute(tsvb_qs(p,n,s,c,h,f,v,!0),{inputs:p})},tsvb_Vc=(t,e)=>{let r="NHWC"===e.format,n=[t.inputs[0].reshape(r?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];3===n.length&&n.push(t.inputs[2]);let i=e.kernelShape;(0===i.length||0===i[0])&&(i=[t.inputs[1].dims[2]]);let s=e.dilations;(0===s.length||0===s[0])&&(s=[1]);let o=e.strides;(0===o.length||0===o[0])&&(o=[1]);let a=e.pads;0===a.length&&(a=[0,0]),a=[0,a[0],0,a[1]],o=[1].concat(o),s=[1].concat(s),i=[1].concat(i);let u=tsvb_Ys({...e,pads:a,strides:o,dilations:s,kernelShape:i},n);t.compute(tsvb_Ma(n,u,(t=>r?[t[0],t[2],t[3]]:[t[0],t[1],t[3]])))},tsvb_Qs=(t,e)=>{tsvb_Uc(t.inputs,e),3===t.inputs[0].dims.length?tsvb_Vc(t,e):tsvb_Wc(t,t.inputs,e)}})),tsvb_Gc,tsvb_Js,tsvb_eu,tsvb_tu=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_Gc=(t,e,r,n)=>{let i=tsvb_ort_webgpu_min_N.size(e),s=e.length,o=tsvb_z("input",t,s),a=tsvb_ort_webgpu_min_j("output",t,s),u=6===r.dataType?r.getInt32Array()[0]:Number(r.getBigInt64Array()[0]),l=tsvb_ort_webgpu_min_N.normalizeAxis(u,s);return{name:"CumSum",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:e,dataType:t}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:"uint32",data:i},{type:"int32",data:l},...tsvb_F(e),...tsvb_F(e)]}),getShaderSource:t=>{let e=` i32(${o.indicesGet("inputIndices","uniforms.axis")}) `,r=tsvb_le("uniforms.input_shape","uniforms.axis",s),i=n.reverse?e+(n.exclusive?" + 1":""):"0",u=n.reverse?r:e+(n.exclusive?"":" + 1");return`\n                ${t.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(o,a)}\n                ${t.mainStart()}\n                  ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n                  var inputIndices = ${a.offsetToIndices("global_idx")};\n                  var sum = ${a.type.value}(0);\n                  let first : i32 = ${i};\n                  let last : i32 = ${u};\n                  for (var i : i32 = first; i < last; i++) {\n                    ${o.indicesSet("inputIndices","uniforms.axis","u32(i)")};\n                    sum = sum + ${o.getByIndices("inputIndices")};\n                  }\n                  ${a.setByOffset("global_idx","sum")};\n                }`}}},tsvb_Js=(t,e)=>{let r=t.inputs[0].dims,n=t.inputs[0].dataType,i=t.inputs[1];t.compute(tsvb_Gc(n,r,i,e),{inputs:[0]})},tsvb_eu=t=>{let e=1===t.exclusive,r=1===t.reverse;return tsvb_he({exclusive:e,reverse:r})}})),tsvb_za,tsvb_Pn,tsvb_ru,tsvb_Lc,tsvb_Hc,tsvb_Ua,tsvb_Na,tsvb_nu,tsvb_Fc,tsvb_au,tsvb_iu,tsvb_ou=tsvb_q((()=>{tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_ru="^"+(tsvb_Pn="("+(tsvb_za="[a-zA-Z]|\\.\\.\\.")+")+")+"$",tsvb_Hc="^"+(tsvb_Lc="("+tsvb_Pn+",)*"+tsvb_Pn)+"$",tsvb_Ua=class{constructor(t=-1){this.symbolToIndices=new Map,this.inputIndex=t}addSymbol(t,e){let r=this.symbolToIndices.get(t);void 0===r?r=[e]:r.push(e),this.symbolToIndices.set(t,r)}},tsvb_Na=class{constructor(t,e){this.equation=e,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[r,n]=e.includes("->")?e.split("->",2):[e,""];if(!r.match(RegExp(tsvb_Hc)))throw new Error("Invalid LHS term");if(r.split(",").forEach(((e,r)=>{let n=t[r].dims.slice();if(!e.match(RegExp(tsvb_ru)))throw new Error("Invalid LHS term");let i=this.processTerm(e,!0,n,r);this.lhs.push(i)})),""===n)n+=[...this.symbolToInfo.entries()].filter((([t,e])=>1===e.count||"..."===t)).map((([t])=>t)).join("");else if(!n.match(RegExp(tsvb_Pn)))throw new Error("Invalid RHS");n.match(RegExp(tsvb_za,"g"))?.forEach((t=>{if("..."===t)this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let e=this.symbolToInfo.get(t);if(void 0===e)throw new Error("Invalid RHS symbol");this.outputDims.push(e.dimValue)}})),this.rhs=this.processTerm(n,!1,this.outputDims)}addSymbol(t,e,r){let n=this.symbolToInfo.get(t);if(void 0!==n){if(n.dimValue!==e&&1!==n.count)throw new Error("Dimension mismatch");n.count++,n.inputIndices.push(r)}else n={count:1,dimValue:e,inputIndices:[r]};this.symbolToInfo.set(t,n)}processTerm(t,e,r,n=-1){let i=r.length,s=!1,o=[],a=0;if(!t.match(RegExp(tsvb_ru))&&!e&&""!==t)throw new Error("Invalid LHS term");let u=t.match(RegExp(tsvb_za,"g")),l=new tsvb_Ua(n);return u?.forEach(((t,c)=>{if("..."===t){if(s)throw new Error("Only one ellipsis is allowed per input term");s=!0;let t=i-u.length+1;if(t<0)throw new Error("Ellipsis out of bounds");if(o=r.slice(a,a+t),this.hasEllipsis){if(this.ellipsisDims.length!==o.length||this.ellipsisDims.toString()!==o.toString())throw new Error("Ellipsis dimensions mismatch")}else{if(!e)throw new Error("Ellipsis must be specified in the LHS");this.hasEllipsis=!0,this.ellipsisDims=o}for(let t=0;t<o.length;t++){let e=String.fromCharCode("0".charCodeAt(0)+t);l.addSymbol(e,c+t),this.addSymbol(e,r[a++],n)}}else l.addSymbol(t,c+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(t,r[a++],n)})),l}},tsvb_nu=t=>t+"_max",tsvb_Fc=(t,e,r,n,i)=>{let s=e.map(((e,r)=>t[r]?e.length:e)).map(((t,e)=>tsvb_z(`input${e}`,r,t))),o=tsvb_ort_webgpu_min_N.size(i),a=tsvb_Ue(i.length),u=a?i.length:i,l=tsvb_ort_webgpu_min_j("output",r,u),c=[...n.symbolToInfo.keys()].filter((t=>!n.rhs.symbolToIndices.has(t)));return{name:"Einsum",shaderCache:{hint:n.equation,inputDependencies:t.map((t=>t?"rank":"dims"))},getRunData:()=>{let s=c.filter((t=>n.symbolToInfo.has(t))).map((t=>({type:"uint32",data:n.symbolToInfo.get(t)?.dimValue||0})));s.push({type:"uint32",data:o});let u=e.filter(((e,r)=>t[r])).map(((t,e)=>[...tsvb_F(t)])).reduce(((t,e)=>t.concat(e)),s);return a&&u.push(...tsvb_F(i)),{outputs:[{dims:i,dataType:r}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:u}},getShaderSource:t=>{let e=[],r=[],i=[],o=[],a=[],u=n.symbolToInfo.size===n.rhs.symbolToIndices.size;n.symbolToInfo.forEach(((t,u)=>{if(n.rhs.symbolToIndices.has(u)){let r=n.rhs.symbolToIndices.get(u)?.[0];void 0!==r&&n.lhs.forEach(((n,i)=>{if(t.inputIndices.includes(i)){let t=n.symbolToIndices.get(u);if(void 0===t)throw new Error("Invalid symbol error");t.forEach((t=>{e.push(`${s[i].indicesSet(`input${i}Indices`,t,l.indicesGet("outputIndices",r))}`)}))}}))}else n.lhs.forEach(((e,n)=>{if(t.inputIndices.includes(n)){let t=e.symbolToIndices.get(u);if(void 0===t)throw new Error("Invalid symbol error");t.forEach((t=>{r.push(`${s[n].indicesSet(`input${n}Indices`,t,`${u}`)}`)})),a.push(`prod *= ${s[n].getByIndices(`input${n}Indices`)};`)}})),i.push(`for(var ${u}: u32 = 0; ${u} < uniforms.${tsvb_nu(u)}; ${u}++) {`),o.push("}")}));let h=u?[...e,`let sum = ${s.map(((t,e)=>t.getByIndices(`input${e}Indices`))).join(" * ")};`]:[...e,"var sum = 0.0;",...i,...r,"var prod = 1.0;",...a,"sum += prod;",...o];return`\n            ${t.registerUniforms(c.map((t=>({name:`${tsvb_nu(t)}`,type:"u32"})))).registerUniform("outputSize","u32").declareVariables(...s,l)}\n\n            ${t.mainStart()}\n            ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n            var outputIndices = ${l.offsetToIndices("global_idx")};\n            ${s.map(((t,e)=>`var input${e}Indices: ${s[e].type.indices};`)).join("\n")}\n            ${h.join("\n")};\n            ${l.setByOffset("global_idx","sum")};\n          }`}}},tsvb_au=(t,e)=>{let r=new tsvb_Na(t.inputs,e.equation),n=t.inputs.map(((t,e)=>tsvb_Ue(t.dims.length))),i=r.outputDims,s=t.inputs.map(((t,e)=>t.dims));t.compute(tsvb_Fc(n,s,t.inputs[0].dataType,r,i))},tsvb_iu=t=>{let e=t.equation.replace(/\s+/g,"");return tsvb_he({equation:e})}})),tsvb_qc,tsvb_su,tsvb_jc,tsvb_Kc,tsvb_uu,tsvb_lu=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_$e(),tsvb_qc=t=>{if(!t||2!==t.length)throw new Error("Expand requires 2 input.");let e=t[0].dims,r=Array.from(t[1].getBigInt64Array(),Number),n=r.length<e.length?0:r.length-e.length,i=e.length<r.length?0:e.length-r.length;for(;n<r.length&&i<e.length;++n,++i)if(r[n]!==e[i]&&1!==r[n]&&1!==e[i])throw new Error("Expand requires shape to be broadcastable to input")},tsvb_su=(t,e)=>{let r=t.length-e.length,n=[];for(let e=0;e<r;++e)n.push(t[e]);for(let i=0;i<e.length;++i)n.push(1===e[i]?t[i+r]:e[i]);return n},tsvb_jc=(t,e)=>t.length>e.length?tsvb_su(t,e):tsvb_su(e,t),tsvb_Kc=t=>{let e=t[0].dims,r=Array.from(t[1].getBigInt64Array(),Number),n=tsvb_jc(e,r),i=t[0].dataType,s=9===i?4:1,o=Math.ceil(tsvb_ort_webgpu_min_N.size(n)/s),a=tsvb_Ue(e.length),u=tsvb_Ue(n.length),l=[{type:"uint32",data:o}];return a&&l.push(...tsvb_F(e)),u&&l.push(...tsvb_F(n)),{name:"Expand",shaderCache:{hint:`${n.length}`,inputDependencies:[a?"rank":"dims"]},getShaderSource:t=>{let r,o=a?e.length:e,l=u?n.length:n,c=tsvb_z("input",i,o,s),h=tsvb_ort_webgpu_min_j("output",i,l,s);if(9===i){let t=(t,e,r="")=>`\n          let outputIndices${e} = ${h.offsetToIndices(`outputOffset + ${e}u`)};\n          let offset${e} = ${c.broadcastedIndicesToOffset(`outputIndices${e}`,h)};\n          let index${e} = offset${e} / 4u;\n          let component${e} = offset${e} % 4u;\n          ${t}[${e}] = ${r}(${c.getByOffset(`index${e}`)}[component${e}]);\n        `;r=`\n        let outputOffset = global_idx * ${s};\n        var data = vec4<u32>(0);\n        ${t("data",0,"u32")}\n        ${t("data",1,"u32")}\n        ${t("data",2,"u32")}\n        ${t("data",3,"u32")}\n        ${h.setByOffset("global_idx","data")}\n      }`}else r=`\n        let outputIndices = ${h.offsetToIndices("global_idx")};\n        let inputOffset = ${c.broadcastedIndicesToOffset("outputIndices",h)};\n        ${h.setByOffset("global_idx",c.getByOffset("inputOffset"))}\n      }`;return`\n    ${t.registerUniform("vec_size","u32").declareVariables(c,h)}\n    ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n    ${r}`},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:l})}},tsvb_uu=t=>{tsvb_qc(t.inputs),t.compute(tsvb_Kc(t.inputs),{inputs:[0]})}})),tsvb_Yc,tsvb_Zc,tsvb_du,tsvb_cu,tsvb_pu=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_Yc=t=>{if(!t||2!==t.length)throw new Error("Gather requires 2 inputs.")},tsvb_Zc=(t,e)=>{let r=t[0].dims,n=t[1].dims,i=r.length,s=tsvb_ort_webgpu_min_N.normalizeAxis(e.axis,i),o=r.slice(0);o.splice(s,1,...n);let a=r[s],u=9===t[0].dataType?4:1,l=Math.ceil(tsvb_ort_webgpu_min_N.size(o)/u),c=tsvb_Ue(t[0].dims.length),h=c?t[0].dims.length:t[0].dims,f=tsvb_Ue(t[1].dims.length),d=f?t[1].dims.length:t[1].dims,p=tsvb_Ue(o.length),v=p?o.length:o,y=[{type:"uint32",data:l},{type:"int32",data:a},{type:"uint32",data:s}];c&&y.push(...tsvb_F(t[0].dims)),f&&y.push(...tsvb_F(t[1].dims)),p&&y.push(...tsvb_F(o));let b=[];b.push(c?"rank":"dims"),b.push(f?"rank":"dims");return{name:"Gather",shaderCache:{hint:e.cacheKey,inputDependencies:b},getRunData:()=>({outputs:[{dims:o,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:y}),getShaderSource:e=>{let r,a=tsvb_z("data",t[0].dataType,h,u),l=tsvb_z("inputIndices",t[1].dataType,d),c=tsvb_ort_webgpu_min_j("output",t[0].dataType,v,u),f=t=>{let e=n.length,r=`var indicesIndices${t}  = ${l.type.indices}(0);`;for(let n=0;n<e;n++)r+=`${e>1?`indicesIndices${t}[${n}]`:`indicesIndices${t}`} = ${o.length>1?`outputIndices${t}[uniforms.axis + ${n}]`:`outputIndices${t}`};`;r+=`\n          var idx${t} = ${l.getByIndices(`indicesIndices${t}`)};\n          if (idx${t} < 0) {\n            idx${t} = idx${t} + uniforms.axisDimLimit;\n          }\n          var dataIndices${t} = ${a.type.indices}(0);\n        `;for(let n=0,a=0;n<i;n++)n===s?(r+=`${i>1?`dataIndices${t}[${n}]`:`dataIndices${t}`} = u32(idx${t});`,a+=e):(r+=`${i>1?`dataIndices${t}[${n}]`:`dataIndices${t}`} = ${o.length>1?`outputIndices${t}[${a}]`:`outputIndices${t}`};`,a++);return r};if(9===t[0].dataType){let t=(t,e,r="")=>`\n          let outputIndices${e} = ${c.offsetToIndices(`outputOffset + ${e}u`)};\n          ${f(e)};\n          let offset${e} = ${a.indicesToOffset(`dataIndices${e}`)};\n          let index${e} = offset${e} / 4u;\n          let component${e} = offset${e} % 4u;\n          ${t}[${e}] = ${r}(${a.getByOffset(`index${e}`)}[component${e}]);\n        `;r=`\n        let outputOffset = global_idx * ${u};\n        var value = vec4<u32>(0);\n        ${t("value",0,"u32")}\n        ${t("value",1,"u32")}\n        ${t("value",2,"u32")}\n        ${t("value",3,"u32")}\n        ${c.setByOffset("global_idx","value")}\n      `}else r=`\n      let outputIndices = ${c.offsetToIndices("global_idx")};\n      ${f("")};\n      let value = ${a.getByIndices("dataIndices")};\n      ${c.setByOffset("global_idx","value")};\n      `;return`\n      ${e.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(a,l,c)}\n      ${e.mainStart()}\n        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n        ${r}\n      }`}}},tsvb_du=t=>tsvb_he({axis:t.axis}),tsvb_cu=(t,e)=>{let r=t.inputs;tsvb_Yc(r),t.compute(tsvb_Zc(t.inputs,e))}})),tsvb_Qc,tsvb_Xc,tsvb_mu,tsvb_fu,tsvb_hu=tsvb_q((()=>{tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_Qc=t=>{if(!t||2!==t.length)throw new Error("GatherElements requires 2 inputs.");if(t[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(t[0].dims.length!==t[1].dims.length)throw new Error("GatherElements requires that the data input and\n                     indices input tensors be of same rank.")},tsvb_Xc=(t,e)=>{let r=t[0].dims,n=t[0].dataType,i=r.length,s=t[1].dims,o=t[1].dataType,a=tsvb_ort_webgpu_min_N.normalizeAxis(e.axis,i),u=r[a],l=s.slice(0),c=tsvb_ort_webgpu_min_N.size(l),h=tsvb_z("input",n,i),f=tsvb_z("indicesInput",o,s.length),d=tsvb_ort_webgpu_min_j("output",n,l.length),p=[{type:"uint32",data:c},{type:"int32",data:u},{type:"uint32",data:a}];return p.push(...tsvb_F(r)),p.push(...tsvb_F(s)),p.push(...tsvb_F(l)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:l,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:p}),getShaderSource:t=>`\n      ${t.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(h,f,d)}\n      ${t.mainStart()}\n      ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n      let outputIndices = ${d.offsetToIndices("global_idx")};\n\n      var idx = ${f.getByOffset("global_idx")};\n      if (idx < 0) {\n        idx = idx + uniforms.axisDimLimit;\n      }\n      var inputIndices = ${h.type.indices}(outputIndices);\n      ${h.indicesSet("inputIndices","uniforms.axis","u32(idx)")};\n      let value = ${h.getByIndices("inputIndices")};\n\n      ${d.setByOffset("global_idx","value")};\n  }`}},tsvb_mu=t=>tsvb_he({axis:t.axis}),tsvb_fu=(t,e)=>{let r=t.inputs;tsvb_Qc(r),t.compute(tsvb_Xc(t.inputs,e))}})),tsvb_Jc,tsvb_ep,tsvb_gu,tsvb_yu,tsvb_bu=tsvb_q((()=>{tsvb_xe(),tsvb_$e(),tsvb_Jc=t=>{if(!t)throw new Error("Input is missing");if(t.length<2||t.length>3)throw new Error("Invaid input number.");if(3===t.length&&t[2].dims.length>2)throw new Error("Invalid input shape of C");if(t[0].dataType!==t[1].dataType||3===t.length&&t[0].dataType!==t[2].dataType)throw new Error("Input types are mismatched")},tsvb_ep=(t,e)=>{let r=t[0].dims.slice(),n=t[1].dims.slice(),[i,s,o]=tsvb_wn.getShapeOfGemmResult(r,e.transA,n,e.transB,3===t.length?t[2].dims:void 0),a=[i,s];if(!a)throw new Error("Can't use gemm on the given tensors");let u=tsvb_ort_webgpu_min_N.size(a),l=[{type:"uint32",data:u},{type:"uint32",data:i},{type:"uint32",data:s},{type:"uint32",data:o},{type:"float32",data:e.alpha},{type:"float32",data:e.beta}],c=["type","type"];3===t.length&&(l.push(...tsvb_F(t[2].dims)),c.push("rank")),l.push(...tsvb_F(a));return{name:"Gemm",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:a,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:l}),getShaderSource:r=>{let n="";e.transA&&e.transB?n="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":e.transA&&!e.transB?n="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!e.transA&&e.transB?n="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!e.transA&&!e.transB&&(n="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let i=1===e.alpha?"":"value *= uniforms.alpha;",s=tsvb_z("a",t[0].dataType,t[0].dims),o=tsvb_z("b",t[1].dataType,t[1].dims),u=s.type.value,l=null,c=[s,o];3===t.length&&(l=tsvb_z("c",t[2].dataType,t[2].dims.length),c.push(l));let h=tsvb_ort_webgpu_min_j("output",t[0].dataType,a.length);c.push(h);return`\n  ${r.registerUniforms([{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}]).declareVariables(...c)}\n\n  ${r.mainStart()}\n    ${r.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let m = global_idx / uniforms.N;\n    let n = global_idx % uniforms.N;\n\n    var value = ${u}(0);\n    for (var k: u32 = 0u; k < uniforms.K; k++) {\n      ${n}\n    }\n\n    ${i}\n    ${null!=l?`let cOffset = ${l.broadcastedIndicesToOffset("vec2(m, n)",h)}; value += ${u}(uniforms.beta) * ${l.getByOffset("cOffset")};`:""}\n    output[global_idx] = value;\n  }`}}},tsvb_gu=t=>({transA:t.transA,transB:t.transB,alpha:t.alpha,beta:t.beta,cacheKey:`${t.transA};${t.transB};${1===t.alpha}`}),tsvb_yu=(t,e)=>{tsvb_Jc(t.inputs),t.compute(tsvb_ep(t.inputs,e))}})),tsvb_tp,tsvb_rp,tsvb_np,tsvb_wu,tsvb_vu=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_$e(),tsvb_tp=(t,e)=>{let r=t[0].dims,n=r,i=tsvb_ort_webgpu_min_N.sizeToDimension(r,2),s=tsvb_ort_webgpu_min_N.sizeFromDimension(r,2),o=tsvb_He(s),a=s/o,u=[r[0],r[1],a],l=[{type:"uint32",data:s},{type:"uint32",data:a}];l.push(...tsvb_F(u),...tsvb_F(u));return{name:"InstanceNormalization",shaderCache:{hint:`${e.epsilon};${o}`,inputDependencies:["rank","type","type"]},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:i},programUniforms:l}),getShaderSource:r=>{let n=tsvb_z("x",t[0].dataType,u.length,o),i=tsvb_z("scale",t[1].dataType,t[1].dims),s=tsvb_z("bias",t[2].dataType,t[2].dims),a=tsvb_ort_webgpu_min_j("output",t[0].dataType,u.length,o),l=[n,i,s,a],c=n.type.value,h=1===o?"f32":`vec${o}<f32>`;return`\n  var<workgroup> meanShared : f32;\n  var<workgroup> squaredNormShared : f32;\n  var<workgroup> workgroupShared : array<${h}, 64>;\n  const workgroupSize = 64u;\n  ${r.registerUniforms([{name:"normSize",type:"u32"},{name:"normPackedSize",type:"u32"}]).declareVariables(...l)}\n  ${r.mainStart(64)}\n    let norm = global_idx / workgroupSize;\n    let batch = norm / uniforms.x_shape[1];\n    let channel = norm % uniforms.x_shape[1];\n    let localIndex = local_id.x;\n\n    // initialize workgroup memory\n    var initial = ${h}(0);\n    for (var h = localIndex; h < uniforms.normPackedSize; h += workgroupSize) {\n      initial = initial + ${h}(${n.get("batch","channel","h")});\n    }\n    workgroupShared[localIndex] = initial;\n    workgroupBarrier();\n\n    // Calculate the mean of current channel data.\n    for (var currSize = workgroupSize >> 1;  currSize > 0; currSize = currSize >> 1) {\n      if (localIndex < currSize) {\n        workgroupShared[localIndex] = workgroupShared[localIndex] + workgroupShared[localIndex + currSize];\n      }\n      workgroupBarrier();\n    }\n    if (localIndex == 0) {\n      meanShared = ${tsvb_st("workgroupShared[0]",o)} / f32(uniforms.normSize);\n    }\n    workgroupBarrier();\n\n    // reinitialize workgroup memory.\n    initial = ${h}(0);\n    for (var h = localIndex; h < uniforms.normPackedSize; h += workgroupSize) {\n      let deviation =  ${h}(${n.get("batch","channel","h")}) - ${h}(meanShared);\n      initial = initial + deviation * deviation;\n    }\n    workgroupShared[localIndex] = initial;\n    workgroupBarrier();\n\n    // Calculate the sum of square of deviation of current channel data.\n    for (var currSize = workgroupSize >> 1;  currSize > 0; currSize = currSize >> 1) {\n      if (localIndex < currSize) {\n        workgroupShared[localIndex] = workgroupShared[localIndex] + workgroupShared[localIndex + currSize];\n      }\n      workgroupBarrier();\n    }\n    if (localIndex == 0) {\n      squaredNormShared = ${tsvb_st("workgroupShared[0]",o)};\n    }\n    workgroupBarrier();\n\n    let invStdDev = inverseSqrt(squaredNormShared / f32(uniforms.normSize) + f32(${e.epsilon}));\n    let channelScale = invStdDev * f32(${i.getByOffset("channel")});\n    let channelShift = f32(${s.getByOffset("channel")}) - meanShared * channelScale;\n    for (var h = localIndex; h < uniforms.normPackedSize; h += workgroupSize) {\n      let value = ${n.get("batch","channel","h")} * ${c}(${h}(channelScale)) + ${c}(${h}(channelShift));\n      ${a.set("batch","channel","h","value")};\n    }\n  }`}}},tsvb_rp=(t,e,r,n,i,s,o,a)=>{let u=tsvb_He(o),l=64,c=1===u?"vec2f":`mat2x${u}f`,h=1===u?"f32":`vec${u}f`,f=(t,e)=>`${c}(${t}, ${e})`,d=i*o/u,p=[{type:"uint32",data:Math.ceil(s/l)},{type:"uint32",data:s},{type:"uint32",data:Math.floor(o/u)},{type:"uint32",data:Math.floor(s*o/u)}],v=t.compute({name:"InstanceNormComputeMean",shaderCache:{hint:`${u}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:[i,o,l,2],dataType:1}],dispatchGroup:{x:i*o/u},programUniforms:p}),getShaderSource:t=>{let r=tsvb_z("input",e.dataType,e.dims,u);return`\n  ${t.declareVariables(r)}\n  @group(0) @binding(1) var<storage, read_write> output : array<${c}>;\n  struct Uniforms {wg_size:u32, H:u32, C:u32, image_size:u32};\n  @group(0) @binding(2) var<uniform> uniforms: Uniforms;\n\n  ${t.mainStart(l)}\n    let currentImageNumber = global_idx / 64 / uniforms.C;\n    let currentChannelNumber = (global_idx / 64) % uniforms.C;\n    let wgId = global_idx % 64;\n    let wgOffset = wgId * uniforms.wg_size;\n    if (wgOffset >= uniforms.H) {\n        return;\n    }\n    let wgMax = min(wgOffset + uniforms.wg_size, uniforms.H);\n\n    let offset = currentImageNumber * uniforms.image_size + currentChannelNumber;\n    var sum = ${tsvb_Je("f32",u)};\n    var squaredSum = ${tsvb_Je("f32",u)};\n    for (var i: u32 = wgOffset; i < wgMax; i++) {\n        let value = ${h}(input[offset + i * uniforms.C]);\n        sum += value;\n        squaredSum += value * value;\n    }\n    output[global_idx] = ${f("sum","squaredSum")};\n  }`}},{inputs:[e],outputs:[-1]})[0],y=[{type:"uint32",data:d},{type:"uint32",data:s},{type:"uint32",data:Math.floor(o/u)},{type:"uint32",data:Math.floor(l*o/u)}];return t.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${u};${a}`,inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:[i,o,2],dataType:1}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:y}),getShaderSource:t=>{let e=tsvb_z("scale",r.dataType,r.dims,u),i=tsvb_z("bias",n.dataType,n.dims,u);return`\n  @group(0) @binding(0) var<storage, read> input : array<${c}>;\n  @group(0) @binding(1) var<storage, read> scale : array<${e.type.storage}>;\n  @group(0) @binding(2) var<storage, read> bias : array<${i.type.storage}>;\n  @group(0) @binding(3) var<storage, read_write> output : array<${c}>;\n  struct Uniforms {units_of_work : u32, H: u32, C : u32, image_size : u32};\n  @group(0) @binding(4) var<uniform> uniforms: Uniforms;\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.units_of_work")}\n    let currentImageNumber = global_idx / uniforms.C;\n    let currentChannelNumber = global_idx % uniforms.C;\n\n    let offset = currentImageNumber * uniforms.image_size;\n    var sum = ${tsvb_Je("f32",u)};\n    var squaredSum = ${tsvb_Je("f32",u)};\n    for (var i: u32 = 0; i < 64; i++) {\n        let value = input[offset + i + currentChannelNumber * 64];\n        sum += value[0];\n        squaredSum += value[1];\n    }\n    sum = sum / f32(uniforms.H);\n    squaredSum = squaredSum / f32(uniforms.H);\n    let invStdDev = inverseSqrt(squaredSum - sum * sum + f32(${a}));\n    let channelScale = invStdDev * ${h}(scale[currentChannelNumber]);\n    let channelShift = ${h}(bias[currentChannelNumber]) - sum * channelScale;\n\n    output[global_idx] = ${f("channelScale","channelShift")};\n  }`}},{inputs:[v,r,n],outputs:[-1]})[0]},tsvb_np=(t,e,r)=>{let n=e[0].dims,i=n,s=n[0],o=n[n.length-1],a=tsvb_ort_webgpu_min_N.sizeFromDimension(n,1)/o,u=tsvb_He(o),l=tsvb_ort_webgpu_min_N.size(i)/u,c=[{type:"uint32",data:a},{type:"uint32",data:Math.floor(o/u)}],h=tsvb_rp(t,e[0],e[1],e[2],s,a,o,r.epsilon);t.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${u}`,inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c}),getShaderSource:t=>{let r=tsvb_Le(e[0].dataType),n=1===u?"vec2f":`mat2x${u}f`,s=1===u?r:`vec${u}<${r}>`,o=tsvb_z("input",e[0].dataType,e[0].dims,u),a=tsvb_ort_webgpu_min_j("output",e[0].dataType,i,u);return`\n  @group(0) @binding(0) var<storage, read> input : array<${o.type.storage}>;\n  @group(0) @binding(1) var<storage, read> scaleInput : array<${n}>;\n  @group(0) @binding(2) var<storage, read_write> output : array<${a.type.storage}>;\n  struct Uniforms {H: u32, C : u32};\n  @group(0) @binding(3) var<uniform> uniforms: Uniforms;\n\n  ${t.mainStart()}\n    let currentImageNumber = global_idx / (uniforms.C * uniforms.H);\n    let currentChannelNumber = global_idx % uniforms.C;\n\n    let scaleOffset = currentImageNumber * uniforms.C + currentChannelNumber;\n    let scale = scaleInput[scaleOffset];\n    output[global_idx] = fma(input[global_idx], ${s}(scale[0]), ${s}(scale[1]));\n  }`}},{inputs:[e[0],h]})},tsvb_wu=(t,e)=>{"NHWC"===e.format?tsvb_np(t,t.inputs,e):t.compute(tsvb_tp(t.inputs,e))}})),tsvb_ap,tsvb_ip,tsvb_$u,src_tsvb_u=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_$e(),tsvb_ap=t=>{if(!t||t.length<2)throw new Error("layerNorm requires at least 2 inputs.")},tsvb_ip=(t,e,r)=>{let n=t[0].dims,i=t[1],s=t[2],o=n,a=tsvb_ort_webgpu_min_N.normalizeAxis(e.axis,n.length),u=tsvb_ort_webgpu_min_N.sizeToDimension(n,a),l=tsvb_ort_webgpu_min_N.sizeFromDimension(n,a),c=tsvb_ort_webgpu_min_N.size(i.dims),h=s?tsvb_ort_webgpu_min_N.size(s.dims):0;if(c!==l||s&&h!==l)throw new Error(`Size of X.shape()[axis:] == ${l}.\n       Size of scale and bias (if provided) must match this.\n       Got scale size of ${c} and bias size of ${h}`);let f=[];for(let t=0;t<n.length;++t)t<a?f.push(n[t]):f.push(1);let d=tsvb_He(l),p=["type","type"],v=[{type:"uint32",data:u},{type:"float32",data:l},{type:"uint32",data:Math.floor(l/d)},{type:"float32",data:e.epsilon}];s&&p.push("type");let y=r>1,b=r>2,_=[{dims:o,dataType:t[0].dataType}];return y&&_.push({dims:f,dataType:1}),b&&_.push({dims:f,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${d};${r}`,inputDependencies:p},getRunData:()=>({outputs:_,dispatchGroup:{x:Math.ceil(u/64)},programUniforms:v}),getShaderSource:e=>{let r=tsvb_Le(t[0].dataType),n=[tsvb_z("x",t[0].dataType,t[0].dims,d),tsvb_z("scale",i.dataType,i.dims,d)];s&&n.push(tsvb_z("bias",s.dataType,s.dims,d)),n.push(tsvb_ort_webgpu_min_j("output",t[0].dataType,o,d)),y&&n.push(tsvb_ort_webgpu_min_j("mean_data_output",1,f)),b&&n.push(tsvb_ort_webgpu_min_j("inv_std_output",1,f));return`\n  ${e.registerUniforms([{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}]).declareVariables(...n)}\n  ${e.mainStart()}\n    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}\n    let offset = global_idx * uniforms.norm_size_vectorized;\n    var meanVector = ${tsvb_Je("f32",d)};\n    var meanSquareVector = ${tsvb_Je("f32",d)};\n\n    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {\n      let value = ${tsvb_ht(r,d,"x[h + offset]")};\n      meanVector += value;\n      meanSquareVector += value * value;\n    }\n    let mean = ${tsvb_st("meanVector",d)} / uniforms.norm_size;\n    let invStdDev =\n        inverseSqrt(${tsvb_st("meanSquareVector",d)} / uniforms.norm_size - mean * mean + uniforms.epsilon);\n\n    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {\n      let f32input = ${tsvb_ht(r,d,"x[j + offset]")};\n      let f32scale = ${tsvb_ht(r,d,"scale[j]")};\n      output[j + offset] = ${n[0].type.value}((f32input - mean) * invStdDev * f32scale\n        ${s?`+ ${tsvb_ht(r,d,"bias[j]")}`:""}\n      );\n    }\n\n    ${y?"mean_data_output[global_idx] = mean":""};\n    ${b?"inv_std_output[global_idx] = invStdDev":""};\n  }`}}},tsvb_$u=(t,e)=>{tsvb_ap(t.inputs),t.compute(tsvb_ip(t.inputs,e,t.outputCount))}})),tsvb_op,tsvb_Su,tsvb_xu,tsvb_sp,tsvb_Wa,tsvb_Iu,tsvb_Cu=tsvb_q((()=>{tsvb_xe(),tsvb_Fe(),tsvb_yn(),tsvb_Ca(),tsvb_$e(),tsvb_hr(),tsvb_op=(t,e)=>{let r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],l=t[7];if(3!==r.dims.length&&5!==r.dims.length)throw new Error("Input query is expected to have 3 or 5 dimensions");let c,h=r.dims[0],f=r.dims[1],d=3===r.dims.length?r.dims[2]:e.numHeads*r.dims[4],p=f,v=0,y=0,b=Math.floor(d/e.numHeads);if(u&&l){if(4!==u.dims.length)throw new Error('Input "past_key" is expected to have 4 dimensions');if(4!==l.dims.length)throw new Error('Input "past_value" is expected to have 4 dimensions');v=u.dims[2],y=u.dims[2]}else if(u||l)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');if(n){if(3!==r.dims.length)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(r.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(3===n.dims.length){if(n.dims[2]!==r.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');c=2,p=n.dims[1]}else if(5===n.dims.length){if(n.dims[2]!==e.numHeads||2!==n.dims[3]||n.dims[4]!==b)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');c=5,p=n.dims[1]}else{if(n.dims[1]!==e.numHeads||n.dims[3]!==b)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');c=0,p=n.dims[2]}}else{if(3!==r.dims.length&&5!==r.dims.length)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(5===r.dims.length&&(r.dims[2]!==e.numHeads||3!==r.dims[3]))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');c=3}if(s){if(1!==s.dims.length)throw new Error('Input "bias" is expected to have 1 dimension');if(i&&5===r.dims.length&&2===r.dims[3])throw new Error("bias is not allowed for packed kv.")}let _=0;if(o){_=8;let t=o.dims;throw 1===t.length?t[0]===h?_=1:t[0]===3*h+2&&(_=3):2===t.length&&t[0]===h&&t[1]===p&&(_=5),8===_?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, kv_sequence_length)'):new Error("Mask not supported")}let m=!1,g=d;if(i){if(3!==i.dims.length&&4!==i.dims.length)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(r.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(3===i.dims.length){if(p!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');g=i.dims[2]}else{if(p!==i.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');g=i.dims[1]*i.dims[3],m=!0}}let w=v+p;if(o)throw new Error("Key padding mask is not supported");if(a)throw new Error("extraAddQk is not supported");if(u)throw new Error("pastKey is not supported");if(l)throw new Error("pastValue is not supported");return{batchSize:h,sequenceLength:f,pastSequenceLength:v,kvSequenceLength:p,totalSequenceLength:w,maxSequenceLength:y,inputHiddenSize:0,hiddenSize:d,vHiddenSize:g,headSize:b,vHeadSize:Math.floor(g/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:_,scale:e.scale,broadcastResPosBias:!1,passPastInKv:m,qkvFormat:c}},tsvb_Su=t=>tsvb_he({...t}),tsvb_xu=tsvb_he({perm:[0,2,1,3]}),tsvb_sp=(t,e,r,n,i,s,o)=>{let a=[n,i,s],u=tsvb_ort_webgpu_min_N.size(a),l=[{type:"uint32",data:u},{type:"uint32",data:o},{type:"uint32",data:s}];return t.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:a,dataType:e.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:l}),getShaderSource:t=>{let n=tsvb_ort_webgpu_min_j("qkv_with_bias",e.dataType,a),i=tsvb_z("qkv",e.dataType,a),s=tsvb_z("bias",r.dataType,a);return`\n  ${t.registerUniforms([{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}]).declareVariables(i,s,n)}\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;\n\n    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];\n  }`}},{inputs:[e,r],outputs:[-1]})[0]},tsvb_Wa=(t,e,r,n,i,s,o,a)=>{let u=s;if(o){if(1===n)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return u=tsvb_sp(t,s,o,e,n,r*i,a),u=u.reshape([e,n,r,i]),t.compute(tsvb_gt(u,tsvb_xu.perm),{inputs:[u],outputs:[-1]})[0]}return 3===s.dims.length&&(u=s.reshape([e,n,r,i])),t.compute(tsvb_gt(u,tsvb_xu.perm),{inputs:[u],outputs:[-1]})[0]},tsvb_Iu=(t,e)=>{let r=tsvb_op(t.inputs,e);if(5===t.inputs[0].dims.length)throw new Error("Packed QKV is not implemented");if(5===t.inputs[1]?.dims.length)throw new Error("Packed KV is not implemented");let n=t.inputs[1]&&t.inputs[2]&&4===t.inputs[1].dims.length&&4===t.inputs[2].dims.length,i=tsvb_Wa(t,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,t.inputs[0],t.inputs[3],0);if(n)return tsvb_In(t,i,t.inputs[1],t.inputs[2],t.inputs[4],void 0,void 0,void 0,t.inputs[5],r,e);let s=tsvb_Wa(t,r.batchSize,r.numHeads,r.kvSequenceLength,r.headSize,t.inputs[1],t.inputs[3],r.hiddenSize),o=tsvb_Wa(t,r.batchSize,r.numHeads,r.kvSequenceLength,r.vHeadSize,t.inputs[2],t.inputs[3],2*r.hiddenSize);tsvb_In(t,i,s,o,t.inputs[4],void 0,t.inputs[6],t.inputs[7],t.inputs[5],r,e)}})),tsvb_up,tsvb_lp,tsvb_dp,tsvb_cp,tsvb_pp,tsvb_mp,tsvb_fp,tsvb_hp,tsvb_Au,tsvb_Tu=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_$e(),tsvb_up=t=>{if(!t||t.length<1)throw new Error("Too few inputs");if(1!==t[0].dataType)throw new Error("Input type must be float.");if(t.length>=2){let e=2*t[0].dims.length===t[1].dims[0];if(4===t.length&&(e=2*t[3].dims[0]===t[1].dims[0]),!e)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},tsvb_lp=(t,e,r)=>{let n="";for(let i=e-1;i>=0;--i)n+=`\n            k = i32(${t.indicesGet("indices",i)}) - ${tsvb_le("uniforms.pads",i,r)};\n            if (k < 0) {\n              break;\n            }\n            if (k >= i32(${tsvb_le("uniforms.x_shape",i,e)})) {\n              break;\n            }\n            offset += k * i32(${tsvb_le("uniforms.x_strides",i,e)});\n        `;return`\n          value = ${t.type.value}(uniforms.constant_value);\n          for (var i = 0; i < 1; i++) {\n            var offset = 0;\n            var k = 0;\n            ${n}\n            value = x[offset];\n          }\n      `},tsvb_dp=(t,e,r)=>{let n="";for(let i=e-1;i>=0;--i)n+=`\n                k = i32(${t.indicesGet("indices",i)}) - ${tsvb_le("uniforms.pads",i,r)};\n                if (k < 0) {\n                  k = -k;\n                }\n                {\n                  let _2n_1 = 2 * (i32(${tsvb_le("uniforms.x_shape",i,e)}) - 1);\n                  k = k % _2n_1;\n                  if(k >= i32(${tsvb_le("uniforms.x_shape",i,e)})) {\n                    k = _2n_1 - k;\n                  }\n                }\n                offset += k * i32(${tsvb_le("uniforms.x_strides",i,e)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${n}\n              value = x[offset];\n          `},tsvb_cp=(t,e,r)=>{let n="";for(let i=e-1;i>=0;--i)n+=`\n                k = i32(${t.indicesGet("indices",i)}) - ${tsvb_le("uniforms.pads",i,r)};\n                if (k < 0) {\n                  k = 0;\n                }\n                if (k >= i32(${tsvb_le("uniforms.x_shape",i,e)})) {\n                  k = i32(${tsvb_le("uniforms.x_shape",i,e)}) - 1;\n                }\n                offset += k * i32(${tsvb_le("uniforms.x_strides",i,e)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${n}\n              value = x[offset];\n          `},tsvb_pp=(t,e,r)=>{let n="";for(let i=e-1;i>=0;--i)n+=`\n                k = i32(${t.indicesGet("indices",i)}) - ${tsvb_le("uniforms.pads",i,r)};\n                if (k < 0)  {\n                  k += i32(${tsvb_le("uniforms.x_shape",i,e)}]);\n                }\n                if (k >= i32(${tsvb_le("uniforms.x_shape",i,e)})) {\n                  k -= i32(${tsvb_le("uniforms.x_shape",i,e)});\n                }\n                offset += k * i32(${tsvb_le("uniforms.x_strides",i,e)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${n}\n              value = x[offset];\n          `},tsvb_mp=(t,e,r)=>{switch(r.mode){case 0:return tsvb_lp(t,e,r.pads.length);case 1:return tsvb_dp(t,e,r.pads.length);case 2:return tsvb_cp(t,e,r.pads.length);case 3:return tsvb_pp(t,e,r.pads.length);default:throw new Error("Invalid mode")}},tsvb_fp=(t,e)=>{let r=tsvb_ort_webgpu_min_N.padShape(t[0].dims.slice(),e.pads),n=t[0].dims,i=[{type:"uint32",data:tsvb_ort_webgpu_min_N.size(r)},{type:"uint32",data:e.pads}];if(0===e.mode){let r=tsvb_ot(t[0].dataType);i.push({type:r,data:e.value})}i.push(...tsvb_F(t[0].dims),...tsvb_F(r));return{name:"Pad",shaderCache:{hint:`${e.mode}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(tsvb_ort_webgpu_min_N.size(r)/64)},programUniforms:i}),getShaderSource:i=>{let s=tsvb_ort_webgpu_min_j("output",t[0].dataType,r.length),o=tsvb_z("x",t[0].dataType,n.length),a=o.type.value,u=tsvb_mp(s,n.length,e),l=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:e.pads.length}];return 0===e.mode&&l.push({name:"constant_value",type:a}),`\n            ${i.registerUniforms(l).declareVariables(o,s)}\n            ${i.mainStart()}\n            ${i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n            let indices = ${s.offsetToIndices("global_idx")};\n\n            var value = ${a}(0);\n            ${u}\n            output[global_idx] = value;\n        }`}}},tsvb_hp=(t,e)=>{if(t.length>1){let r=t[1].getBigInt64Array(),n=t.length>=3&&t[2].data?t[2].getFloat32Array()[0]:0,i=t[0].dims.length,s=new Int32Array(2*i).fill(0);if(t.length>=4){let e=t[3].getBigInt64Array();for(let t=0;t<e.length;t++)s[Number(e[t])]=Number(r[t]),s[Number(e[t])+i]=Number(r[t+e.length])}else r.forEach(((t,e)=>s[Number(e)]=Number(t)));let o=[];return s.forEach((t=>o.push(t))),{mode:e.mode,value:n,pads:o}}return e},tsvb_Au=(t,e)=>{tsvb_up(t.inputs);let r=tsvb_hp(t.inputs,e);t.compute(tsvb_fp(t.inputs,r),{inputs:[0]})}})),tsvb_Rn,tsvb_Eu,tsvb_Ou,tsvb_ku,tsvb_Bu,tsvb_gp,tsvb_yp,tsvb_Pu,tsvb_Ru,tsvb_Du,tsvb_Mu,tsvb_zu,tsvb_Uu,tsvb_Nu,tsvb_Wu,tsvb_Vu,tsvb_Gu,tsvb_Lu,tsvb_Hu,tsvb_Fu=tsvb_q((()=>{tsvb_pt(),tsvb_xe(),tsvb_$e(),tsvb_Rn=t=>{if(tsvb_Te.webgpu.validateInputContent&&(!t||1!==t.length))throw new Error("Pool ops requires 1 input.")},tsvb_Eu=(t,e,r)=>{let n="NHWC"===e.format,i=t.dims.slice();n&&i.splice(1,0,i.pop());let s=Object.hasOwnProperty.call(e,"dilations"),o=e.kernelShape.slice(),a=e.strides.slice(),u=s?e.dilations.slice():[],l=e.pads.slice();tsvb_Qt.adjustPoolAttributes(r,i,o,a,u,l);let c=tsvb_Qt.computePoolOutputShape(r,i,a,u,o,l,e.autoPad),h=Object.assign({},e);s?Object.assign(h,{kernelShape:o,strides:a,pads:l,dilations:u,cacheKey:e.cacheKey}):Object.assign(h,{kernelShape:o,strides:a,pads:l,cacheKey:e.cacheKey});let f=c.slice();return f.push(f.splice(1,1)[0]),[h,n?f:c]},tsvb_Ou=(t,e)=>{let r="NHWC"===e.format,n=[{type:"uint32",data:tsvb_ort_webgpu_min_N.size(t)},{type:"uint32",data:tsvb_ort_webgpu_min_N.size(e.kernelShape)}],i=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(e.kernelShape.length<=2){let t=e.kernelShape[e.kernelShape.length-1],r=e.strides[e.strides.length-1],s=e.pads[e.pads.length/2-1],o=e.pads[e.pads.length-1],a=!!(s+o);n.push({type:"uint32",data:t},{type:"uint32",data:r},{type:"uint32",data:s},{type:"uint32",data:o}),i.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let u=!1;if(2===e.kernelShape.length){let t=e.kernelShape[e.kernelShape.length-2],r=e.strides[e.strides.length-2],s=e.pads[e.pads.length/2-2],o=e.pads[e.pads.length-2];u=!!(s+o),n.push({type:"uint32",data:t},{type:"uint32",data:r},{type:"uint32",data:s},{type:"uint32",data:o}),i.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[n,i,!0,a,u]}{if(r)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let t=tsvb_ort_webgpu_min_N.computeStrides(e.kernelShape);return n.push({type:"uint32",data:t},{type:"uint32",data:e.pads},{type:"uint32",data:e.strides}),i.push({name:"kernelStrides",type:"u32",length:t.length},{name:"pads",type:"u32",length:e.pads.length},{name:"strides",type:"u32",length:e.strides.length}),[n,i,!!e.pads.reduce(((t,e)=>t+e)),!1,!1]}},tsvb_ku=(t,e,r,n,i,s,o,a,u,l,c,h)=>{let f="NHWC"===i.format,d=e.type.value,p=tsvb_ort_webgpu_min_j("output",e.type.tensor,n);if(i.kernelShape.length<=2){let n="",l="",v="",y=r-(f?2:1);if(n=c?`\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;\n                  if (xIndices[${y}] < 0 || xIndices[${y}]\n                      >= uniforms.x_shape[${y}]) {\n                    pad++;\n                    continue;\n                  }\n                  let x_val = x[${e.indicesToOffset("xIndices")}];\n                  ${s}\n                }`:`\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;\n                  let x_val = x[${e.indicesToOffset("xIndices")}];\n                  ${s}\n                }`,2===i.kernelShape.length){let t=r-(f?3:2);l=h?`\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[${t}] = indices[${t}] * uniforms.sh - uniforms.phStart + j;\n                  if (xIndices[${t}] < 0 || xIndices[${t}] >= uniforms.x_shape[${t}]) {\n                    pad += i32(uniforms.kw);\n                    continue;\n                  }\n              `:`\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[${t}] = indices[${t}] * uniforms.sh - uniforms.phStart + j;\n                `,v="\n              }\n            "}return`\n            ${t.registerUniforms(u).declareVariables(e,p)}\n\n            ${t.mainStart()}\n              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n              let indices = ${p.offsetToIndices("global_idx")};\n              var xIndices = ${p.offsetToIndices("global_idx")};\n\n              var value = ${d}(${a});\n              var pad = 0;\n              ${l}\n              ${n}\n              ${v}\n              ${o}\n\n              output[global_idx] = value;\n            }`}{if(f)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let n=i.kernelShape.length,c=i.pads.length,h="";return h=l?`\n                if (xIndices[j] >= uniforms.x_shape[j]) {\n                  pad++;\n                  isPad = true;\n                  break;\n                }\n              }\n              if (!isPad) {\n                let x_val = x[${e.indicesToOffset("xIndices")}];\n                ${s}\n              }`:`\n              }\n              let x_val = x[${e.indicesToOffset("xIndices")}];\n              ${s}\n            `,`\n            ${t.registerUniforms(u).declareVariables(e,p)}\n\n            ${t.mainStart()}\n              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n              let indices = ${p.offsetToIndices("global_idx")};\n              var xIndices = ${p.offsetToIndices("global_idx")};\n\n              var offsets: array<u32, ${n}>;\n\n              var value = ${d}(${a});\n              var pad = 0;\n              var isPad = false;\n\n              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {\n                var offset = i;\n                for (var j = 0u; j < ${n-1}u; j++) {\n                  offsets[j] = offset / ${tsvb_le("uniforms.kernelStrides","j",n)};\n                  offset -= offsets[j] * ${tsvb_le("uniforms.kernelStrides","j",n)};\n                }\n                offsets[${n-1}] = offset;\n\n                isPad = false;\n                for (var j = ${r-n}u; j < ${r}u; j++) {\n                  xIndices[j] = indices[j] * ${tsvb_le("uniforms.strides",`j - ${r-n}u`,n)}\n                    + offsets[j - ${r-n}u] - ${tsvb_le("uniforms.pads","j - 2u",c)};\n                  ${h}\n              }\n              ${o}\n\n              output[global_idx] = value;\n            }`}},tsvb_Bu=t=>`${t.format};${t.ceilMode};${t.autoPad};${t.kernelShape.length}`,tsvb_gp=t=>`${tsvb_Bu(t)};${t.countIncludePad}`,tsvb_yp=t=>`${tsvb_Bu(t)};${t.storageOrder};${t.dilations}`,tsvb_Pu=t=>({format:t.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],ceilMode:t.ceil_mode,kernelShape:t.kernel_shape,strides:t.strides,pads:t.pads}),tsvb_Ru=(t,e,r,n)=>{let[i,s]=tsvb_Eu(e,n,r),o=tsvb_z("x",e.dataType,e.dims.length),a=o.type.value,u="";i.countIncludePad?u+=`value /= ${a}(uniforms.kernelSize);`:u+=`value /= ${a}(i32(uniforms.kernelSize) - pad);`;let[l,c,h,f,d]=tsvb_Ou(s,i);l.push(...tsvb_F(e.dims),...tsvb_F(s));return{name:t,shaderCache:{hint:`${n.cacheKey};${h};${f};${d}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:s,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(tsvb_ort_webgpu_min_N.size(s)/64)},programUniforms:l}),getShaderSource:t=>tsvb_ku(t,o,e.dims.length,s.length,i,"value += x_val;",u,0,c,h,f,d)}},tsvb_Du=t=>{let e=0!==t.count_include_pad,r=tsvb_Pu(t);if(0!==r.ceilMode)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let n={countIncludePad:e,...r,cacheKey:""};return{...n,cacheKey:tsvb_gp(n)}},tsvb_Mu=(t,e)=>{tsvb_Rn(t.inputs),t.compute(tsvb_Ru("AveragePool",t.inputs[0],!1,e))},tsvb_zu={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},tsvb_Uu=t=>{let e=t.format;return{format:e,...tsvb_zu,cacheKey:e}},tsvb_Nu=(t,e)=>{tsvb_Rn(t.inputs),t.compute(tsvb_Ru("GlobalAveragePool",t.inputs[0],!0,e))},tsvb_Wu=(t,e,r,n)=>{let[i,s]=tsvb_Eu(e,n,r),o=tsvb_z("x",e.dataType,e.dims.length),[a,u,l,c,h]=tsvb_Ou(s,i);return a.push(...tsvb_F(e.dims),...tsvb_F(s)),{name:t,shaderCache:{hint:`${n.cacheKey};${l};${c};${h}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:s,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(tsvb_ort_webgpu_min_N.size(s)/64)},programUniforms:a}),getShaderSource:t=>tsvb_ku(t,o,e.dims.length,s.length,i,"\n      value = max(x_val, value);\n    ","",-1e5,u,l,c,h)}},tsvb_Vu=(t,e)=>{tsvb_Rn(t.inputs),t.compute(tsvb_Wu("MaxPool",t.inputs[0],!1,e))},tsvb_Gu=t=>{let e=t.storage_order,r=t.dilations,n=tsvb_Pu(t);if(0!==e)throw new Error("column major storage order is not yet supported for MaxPool");if(0!==n.ceilMode)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let i={storageOrder:e,dilations:r,...n,cacheKey:""};return{...i,cacheKey:tsvb_yp(i)}},tsvb_Lu=t=>{let e=t.format;return{format:e,...tsvb_zu,cacheKey:e}},tsvb_Hu=(t,e)=>{tsvb_Rn(t.inputs),t.compute(tsvb_Wu("GlobalMaxPool",t.inputs[0],!0,e))}})),tsvb_wp,tsvb_vp,tsvb_qu,tsvb_ju=tsvb_q((()=>{tsvb_pt(),tsvb_Ve(),tsvb_$e(),tsvb_wp=(t,e,r)=>{if(t===e||t<e&&r<0||t>e&&r>0)throw new Error("Range these inputs' contents are invalid.")},tsvb_vp=(t,e,r,n)=>{let i=Math.abs(Math.ceil((e-t)/r)),s=[i],o=i,a=tsvb_ot(n),u=[{type:"uint32",data:o},{type:a,data:t},{type:a,data:r},...tsvb_F(s)];return{name:"Range",shaderCache:{hint:`${n}`},getShaderSource:t=>{let e=tsvb_ort_webgpu_min_j("output",n,s.length),r=e.type.value,i=[{name:"outputSize",type:"u32"},{name:"start",type:r},{name:"delta",type:r}];return`\n        ${t.registerUniforms(i).declareVariables(e)}\n        ${t.mainStart()}\n        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n        output[global_idx] = uniforms.start + ${r}(global_idx) * uniforms.delta;\n      }`},getRunData:()=>({outputs:[{dims:s,dataType:n}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:u})}},tsvb_qu=t=>{let e=0,r=0,n=0;6===t.inputs[0].dataType?(e=t.inputs[0].getInt32Array()[0],r=t.inputs[1].getInt32Array()[0],n=t.inputs[2].getInt32Array()[0]):1===t.inputs[0].dataType&&(e=t.inputs[0].getFloat32Array()[0],r=t.inputs[1].getFloat32Array()[0],n=t.inputs[2].getFloat32Array()[0]),tsvb_Te.webgpu.validateInputContent&&tsvb_wp(e,r,n),t.compute(tsvb_vp(e,r,n,t.inputs[0].dataType),{inputs:[]})}})),tsvb_$p,src_tsvb_p,tsvb_xp,tsvb_Sp,tsvb_Ip,tsvb_Cp,tsvb_Ap,tsvb_Tp,tsvb_Ep,tsvb_Op,tsvb_kp,tsvb_Ku,tsvb_Bp,tsvb_Pp,tsvb_Rp,tsvb_Dp,tsvb_Mp,tsvb_Yu,tsvb_Zu,tsvb_Qu=tsvb_q((()=>{tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_$p=(t,e)=>{if(t.every((t=>t>0||(()=>{throw new Error("Resize requires scales input values to be positive")}))),t.length>0)if("linear"===e.mode){if(!(2===t.length||3===t.length||4===t.length&&1===t[0]&&1===t[1]||4===t.length&&1===t[0]&&1===t[3]||5===t.length&&1===t[0]&&1===t[1]))throw new Error("For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and\n            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1")}else if("cubic"===e.mode&&!(2===t.length||4===t.length&&1===t[0]&&1===t[1]||4===t.length&&1===t[0]&&1===t[3]))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")},src_tsvb_p=(t,e,r)=>{e.every((t=>t>=0&&t<r||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")})));let n=new Array(r).fill(1);return e.forEach(((e,r)=>n[e]=t[r])),n},tsvb_xp=(t,e,r,n,i,s)=>{let[o,a,u]=r>10?[1,2,3]:[-1,t.length>1?1:-1,-1],l=t[0].dims.length;if(o>0&&t.length>o&&t[o].dims.length>0)t[o].getFloat32Array().forEach((t=>s.push(t)));else if("tf_crop_and_resize"===e.coordinateTransformMode)throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(a>0&&t.length>a&&t[a].dims.length>0){if(t[a].getFloat32Array().forEach((t=>n.push(t))),0!==n.length&&n.length!==l&&r>=18&&n.length!==e.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");tsvb_$p(n,e),e.axes.length>0&&src_tsvb_p(n,e.axes,l).forEach(((t,e)=>n[e]=t))}if(u>0&&t.length>u&&(t[u].getBigInt64Array().forEach((t=>i.push(Number(t)))),i.length!==l||r>=18&&i.length===e.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(e.axes.length>0){if(n.length!==e.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(i.length!==e.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof n<"u"&&typeof i<"u"&&n.length>0&&i.length>l)throw new Error("Resize requires only of scales or sizes to be specified")},tsvb_Sp=(t,e)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,\n     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${e} { `+(()=>{switch(t){case"asymmetric":return`return ${e}(xResized) / ${e}(xScale);`;case"pytorch_half_pixel":return`if (lengthResized > 1) {\n                    return (${e}(xResized) + 0.5) / ${e}(xScale) - 0.5;\n                  } else {\n                    return 0.0;\n                  }`;case"tf_half_pixel_for_nn":return`return (${e}(xResized) + 0.5) / ${e}(xScale);`;case"align_corners":return`if (lengthResized == 1) {\n                    return 0.0;\n                  } else {\n                    // The whole part and the fractional part are calculated separately due to inaccuracy of floating\n                    // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an\n                    // offset-by-one error later in floor().\n                    let whole = ${e}(xResized * (lengthOriginal - 1) / (lengthResized - 1));\n                    let fract =\n                        ${e}(xResized * (lengthOriginal - 1) % (lengthResized - 1)) / ${e}(lengthResized - 1);\n                    return whole + fract;\n                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {\n                    return ${e}(roiStart) * ${e}(lengthOriginal - 1) +\n                        (${e}(xResized) * ${e}(roiEnd - roiStart) * ${e}(lengthOriginal - 1)) /\n                        ${e}(lengthResized - 1);\n                  } else {\n                    return 0.5 * ${e}(roiStart + roiEnd) * ${e}(lengthOriginal - 1);\n                  }`;case"half_pixel_symmetric":return`const outputWidth = ${e}xScale * ${e}(lengthResized);\n                  const adjustment = ${e}(lengthResized) / outputWidth;\n                  const center = ${e}(lengthOriginal) / 2;\n                  const offset = center * (1 - adjustment);\n                  return offset + ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;case"half_pixel":return`return ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${t} is not supported`)}})()+"}",tsvb_Ip=(t,e,r)=>`fn getNearestPixelFromOriginal(xOriginal: ${r}, isDownSample: bool) -> ${r} {`+(()=>{switch(t){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";default:if(e<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${t} is not supported`)}})()+"}",tsvb_Cp=(t,e,r)=>{let n=new Array(r).fill(0).concat(new Array(r).fill(1)),i=0===t.length?n:t.slice();return e.length>0?(e.forEach(((t,s)=>{n[t]=i[s],n[s+r]=i[e.length+s]})),n):i},tsvb_Ap=(t,e,r,n)=>{let i=[];if(r.length>0)if(n.length>0){if(t.forEach((t=>i.push(t))),Math.max(...n)>t.length)throw new Error("axes is out of bound");n.forEach(((t,e)=>i[t]=r[e]))}else r.forEach((t=>i.push(t)));else{if(0===e.length)throw new Error("Resize requires either scales or sizes.");i=t.map(((t,r)=>Math.round(t*e[r])))}return i},tsvb_Tp=(t,e,r)=>{let n=(()=>{switch(r.keepAspectRatioPolicy){case"not_larger":return r.axes.length>0?Math.min(...r.axes.map((t=>e[t])),Number.MAX_VALUE):Math.min(...e,Number.MAX_VALUE);case"not_smaller":return r.axes.length>0?Math.max(...r.axes.map((t=>e[t])),Number.MIN_VALUE):Math.max(...e,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${r.keepAspectRatioPolicy} is not supported`)}})();e.fill(1,0,e.length);let i=t.slice();return r.axes.length>0?(r.axes.forEach((t=>e[t]=n)),r.axes.forEach((r=>i[r]=Math.round(t[r]*e[r])))):(e.fill(n,0,e.length),i.forEach(((t,r)=>i[r]=Math.round(t*e[r])))),i},tsvb_Ep=(t,e,r,n,i)=>`\n    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> array<${t.type.value}, ${r.length}> {\n      var original_indices: array<${t.type.value}, ${r.length}>;\n      for (var i:u32 = 0; i < ${r.length}; i++) {\n        var output_index = ${t.indicesGet("output_indices","i")};\n        var scale = ${tsvb_le("uniforms.scales","i",n)};\n        var roi_low = ${tsvb_le("uniforms.roi","i",i)};\n        var roi_hi = ${tsvb_le("uniforms.roi",`i + ${e.length}`,i)};\n        if (scale == 1.0) {\n          original_indices[i] = ${t.type.value}(output_index);\n        } else {\n          var input_shape_i = ${tsvb_le("uniforms.input_shape","i",e.length)};\n          var output_shape_i = ${tsvb_le("uniforms.output_shape","i",r.length)};\n          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                           input_shape_i, roi_low, roi_hi);\n        }\n      }\n      return original_indices;\n    }`,tsvb_Op=(t,e,r,n,i,s,o)=>`\n    fn calculateInputIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {\n      var input_indices: ${t.type.indices};\n      for (var i:u32 = 0; i < ${n.length}; i++) {\n        var output_index = ${e.indicesGet("output_indices","i")};\n        var input_index: u32;\n        var scale = ${tsvb_le("uniforms.scales","i",i)};\n        if (scale == 1.0) {\n          input_index = output_index;\n        } else {\n          var roi_low = ${tsvb_le("uniforms.roi","i",s)};\n          var roi_hi = ${tsvb_le("uniforms.roi",`i + ${r.length}`,s)};\n          var input_shape_i = ${tsvb_le("uniforms.input_shape","i",r.length)};\n          var output_shape_i = ${tsvb_le("uniforms.output_shape","i",n.length)};\n          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                        input_shape_i, roi_low, roi_hi);\n          if (!${o} || (original_idx >= 0 && original_idx < ${e.type.value}(input_shape_i))) {\n            if (original_idx < 0) {\n              input_index = 0;\n            } else if (original_idx > ${e.type.value}(input_shape_i - 1)) {\n              input_index = input_shape_i - 1;\n            } else {\n              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));\n            }\n          } else {\n            input_index = u32(original_idx);\n          }\n        }\n        ${t.indicesSet("input_indices","i"," input_index")}\n      }\n      return input_indices;\n    }`,tsvb_kp=(t,e)=>`\n    fn checkInputIndices(input_indices: ${t.type.indices}) -> bool {\n      for (var i:u32 = 0; i < ${e.length}; i++) {\n        var input_index = ${t.indicesGet("input_indices","i")};\n        if (input_index < 0 || input_index >= ${tsvb_le("uniforms.input_shape","i",e.length)}) {\n          return false;\n        }\n      }\n      return true;\n    }`,tsvb_Ku=(t,e,r,n)=>t.rank>n?`\n    ${t.indicesSet("input_indices",e,"channel")};\n    ${t.indicesSet("input_indices",r,"batch")};\n`:"",tsvb_Bp=(t,e,r,n,i)=>{let[s,o,a,u]=2===r.length?[-1,0,1,-1]:[0,2,3,1],l=t.type.value;return`\n    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${l} {\n      var input_indices: ${t.type.indices};\n      ${t.indicesSet("input_indices",o,`max(0, min(row, ${r[o]} - 1))`)};\n      ${t.indicesSet("input_indices",a,`max(0, min(col, ${r[a]} - 1))`)};\n      ${tsvb_Ku(t,u,s,2)}\n      return ${t.getByIndices("input_indices")};\n    }\n\n    fn bilinearInterpolation(output_indices: ${e.type.indices}) -> ${l} {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var row:${l} = originalIndices[${o}];\n      var col:${l} = originalIndices[${a}];\n      ${n?`if (row < 0 || row > (${r[o]} - 1) || col < 0 || col > (${r[a]} - 1)) {\n        return ${i};\n      }`:""};\n      row = max(0, min(row, ${r[o]} - 1));\n      col = max(0, min(col, ${r[a]} - 1));\n      var row1: u32 = u32(row);\n      var col1: u32 = u32(col);\n      var row2: u32 = u32(row + 1);\n      var col2: u32 = u32(col + 1);\n      var channel: u32 = ${r.length>2?`u32(originalIndices[${u}])`:"0"};\n      var batch: u32 =  ${r.length>2?`u32(originalIndices[${s}])`:"0"};\n      var x11: ${l} = getInputValue(batch, channel, row1, col1);\n      var x12: ${l} = getInputValue(batch, channel, row1, col2);\n      var x21: ${l} = getInputValue(batch, channel, row2, col1);\n      var x22: ${l} = getInputValue(batch, channel, row2, col2);\n      var dx1: ${l} = abs(row - ${l}(row1));\n      var dx2: ${l} = abs(${l}(row2) - row);\n      var dy1: ${l} = abs(col - ${l}(col1));\n      var dy2: ${l} = abs(${l}(col2) - col);\n      if (row1 == row2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (col1 == col2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);\n    }`},tsvb_Pp=(t,e,r,n,i,s,o,a,u,l)=>{let c=2===r.length,[h,f]=c?[0,1]:[2,3],d=t.type.value,p=o=>{let c=o===h?"row":"col";return`\n      fn ${c}CubicInterpolation(input_indices: ${t.type.indices}, output_indices: ${e.type.indices}) -> ${d} {\n        var output_index = ${e.indicesGet("output_indices",o)};\n        var originalIdx: ${d} = getOriginalCoordinateFromResizedCoordinate(output_index, ${i[o]},\n        ${n[o]}, ${r[o]}, ${s[o]}, ${s[o]} + ${r.length});\n        var fractOriginalIdx: ${d} = originalIdx - floor(originalIdx);\n        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);\n\n        if (${a} && (originalIdx < 0 || originalIdx > (${r[o]} - 1))) {\n          return ${u};\n        }\n        var data: array<${d}, 4> = array<${d}, 4>(0.0, 0.0, 0.0, 0.0);\n        for (var i: i32 = -1; i < 3; i++) {\n          var ${c}: ${d} = originalIdx + ${d}(i);\n          if (${c} < 0 || ${c} >= ${r[o]}) {\n            ${l?"coefs[i + 1] = 0.0;\n                        continue;":a?`return ${u};`:`${c} = max(0, min(${c}, ${r[o]} - 1));`};\n          }\n        var input_indices_copy: ${t.type.indices} = input_indices;\n          ${t.indicesSet("input_indices_copy",o,`u32(${c})`)};\n          data[i + 1] = ${o===h?t.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};\n        }\n        return cubicInterpolation1D(data, coefs);\n      }`};return`\n    ${p(h)};\n    ${p(f)};\n  fn getCubicInterpolationCoefs(s: ${d}) -> array<${d}, 4> {\n    var absS = abs(s);\n    var coeffs: array<${d}, 4> = array<${d}, 4>(0.0, 0.0, 0.0, 0.0);\n    var oneMinusAbsS: ${d} = 1.0 - absS;\n    var twoMinusAbsS: ${d} = 2.0 - absS;\n    var onePlusAbsS: ${d} = 1.0 + absS;\n    coeffs[0] = ((${o} * onePlusAbsS - 5 * ${o}) * onePlusAbsS + 8 * ${o}) * onePlusAbsS - 4 * ${o};\n    coeffs[1] = ((${o} + 2) * absS - (${o} + 3)) * absS * absS + 1;\n    coeffs[2] = ((${o} + 2) * oneMinusAbsS - (${o} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;\n    coeffs[3] = ((${o} * twoMinusAbsS - 5 * ${o}) * twoMinusAbsS + 8 * ${o}) * twoMinusAbsS - 4 * ${o};\n    return coeffs;\n  }\n\n  fn cubicInterpolation1D(x: array<${d}, 4>, coefs: array<${d}, 4>) -> ${d} {\n    var coefsSum: ${d} = coefs[0] + coefs[1] + coefs[2] + coefs[3];\n    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;\n  }\n\n  fn bicubicInterpolation(output_indices: ${e.type.indices}) -> ${d} {\n    var input_indices: ${t.type.indices} = output_indices;\n    return colCubicInterpolation(input_indices, output_indices);\n  }\n    `},tsvb_Rp=(t,e,r,n,i)=>{let[s,o,a,u,l]=3===r.length?[-1,0,1,2,-1]:[0,2,3,4,1],c=t.type.value;return`\n    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${c} {\n      var input_indices: ${t.type.indices};\n      ${t.indicesSet("input_indices",o,`max(0, min(depth, ${r[o]} - 1))`)};\n      ${t.indicesSet("input_indices",a,`max(0, min(height, ${r[a]} - 1))`)};\n      ${t.indicesSet("input_indices",u,`max(0, min(width, ${r[u]} - 1))`)};\n      ${tsvb_Ku(t,l,s,3)}\n      return ${t.getByIndices("input_indices")};\n    }\n\n    fn trilinearInterpolation(output_indices: ${e.type.indices}) -> ${c} {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var depth:${c} = originalIndices[${o}];\n      var height:${c} = originalIndices[${a}];\n      var width:${c} = originalIndices[${u}];\n      ${n?`if (depth < 0 || depth > (${r[o]} - 1) || height < 0 || height > (${r[a]} - 1) || width < 0 || (width > ${r[u]} - 1)) {\n      return ${i};\n        }`:""};\n\n    depth = max(0, min(depth, ${r[o]} - 1));\n      height = max(0, min(height, ${r[a]} - 1));\n      width = max(0, min(width, ${r[u]} - 1));\n      var depth1: u32 = u32(depth);\n      var height1: u32 = u32(height);\n      var width1: u32 = u32(width);\n      var depth2: u32 = u32(depth + 1);\n      var height2: u32 = u32(height + 1);\n      var width2: u32 = u32(width + 1);\n      var channel: u32 = ${r.length>3?`u32(originalIndices[${l}])`:"0"};\n      var batch: u32 =  ${r.length>3?`u32(originalIndices[${s}])`:"0"};\n\n      var x111: ${c} = getInputValue(batch, channel, depth1, height1, width1);\n      var x112: ${c} = getInputValue(batch, channel, depth1, height1, width2);\n      var x121: ${c} = getInputValue(batch, channel, depth1, height2, width1);\n      var x122: ${c} = getInputValue(batch, channel, depth1, height2, width2);\n      var x211: ${c} = getInputValue(batch, channel, depth2, height1, width1);\n      var x212: ${c} = getInputValue(batch, channel, depth2, height1, width2);\n      var x221: ${c} = getInputValue(batch, channel, depth2, height2, width1);\n      var x222: ${c} = getInputValue(batch, channel, depth2, height2, width2);\n      var dx1: ${c} = abs(depth - ${c}(depth1));\n      var dx2: ${c} = abs(${c}(depth2) - depth);\n      var dy1: ${c} = abs(height - ${c}(height1));\n      var dy2: ${c} = abs(${c}(height2) - height);\n      var dz1: ${c} = abs(width - ${c}(width1));\n      var dz2: ${c} = abs(${c}(width2) - width);\n      if (depth1 == depth2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (height1 == height2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      if (width1 == width2) {\n        dz1 = 0.5;\n        dz2 = 0.5;\n      }\n      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +\n              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);\n    }`},tsvb_Dp=(t,e,r,n,i,s)=>{let o=t.dims,a=tsvb_Cp(s,e.axes,o.length),u=tsvb_Ap(o,n,i,e.axes),l=n.slice();0===n.length&&(l=o.map(((t,e)=>0===t?1:u[e]/t)),"stretch"!==e.keepAspectRatioPolicy&&(u=tsvb_Tp(o,l,e)));let c=tsvb_ort_webgpu_min_j("output",t.dataType,u.length),h=tsvb_z("input",t.dataType,o.length),f=tsvb_ort_webgpu_min_N.size(u),d=o.length===u.length&&o.every(((t,e)=>t===u[e])),p="tf_crop_and_resize"===e.coordinateTransformMode,v=e.extrapolationValue,y=h.type.value;return{name:"Resize",shaderCache:{hint:`${e.cacheKey}|${r}|${l.length>0?l:""}|${i.length>0?i:""}|${a.length>0?a:""}|${d}|${o}`,inputDependencies:["rank"]},getShaderSource:t=>`\n      ${d?"":`\n      ${tsvb_Sp(e.coordinateTransformMode,y)};\n      ${(()=>{switch(e.mode){case"nearest":return`\n              ${tsvb_kp(h,o)};\n              ${tsvb_Ip(e.nearestMode,r,y)};\n              ${tsvb_Op(h,c,o,u,l.length,a.length,p)};\n              `;case"linear":return`\n              ${tsvb_Ep(c,o,u,l.length,a.length)};\n              ${(()=>{if(2===o.length||4===o.length)return`${tsvb_Bp(h,c,o,p,v)}`;if(3===o.length||5===o.length)return`${tsvb_Rp(h,c,o,p,v)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};\n            `;case"cubic":return`\n            ${(()=>{if(2===o.length||4===o.length)return`${tsvb_Pp(h,c,o,u,l,a,e.cubicCoeffA,p,e.extrapolationValue,e.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};\n            `;default:throw Error("Invalid resize mode")}})()};\n      `}\n      ${t.registerUniform("output_size","u32").registerUniform("scales","f32",l.length).registerUniform("roi","f32",a.length).declareVariables(h,c)}\n      ${t.mainStart()}\n        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n        ${d?"output[global_idx] = input[global_idx];":`\n        let output_indices = ${c.offsetToIndices("global_idx")};\n        var input_indices: ${h.type.indices};\n        ${(()=>{switch(e.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);\n                if (checkInputIndices(input_indices)) {\n                  output[global_idx] = ${h.getByIndices("input_indices")};\n                } else {\n                  output[global_idx] = ${e.extrapolationValue};\n                }`;case"linear":return`output[global_idx] = ${2===o.length||4===o.length?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${e.mode}`)}})()};\n`}\n      }`,getRunData:()=>({outputs:[{dims:u,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:[{type:"uint32",data:f},{type:"float32",data:l},{type:"float32",data:a},...tsvb_F(o),...tsvb_F(u)]})}},tsvb_Mp=t=>{let e=t.customDataBuffer;return new Uint32Array(e,e.byteOffset,1)[0]},tsvb_Yu=(t,e)=>{let r=[],n=[],i=[],s=tsvb_Mp(t);if(0!==e.antialias)throw Error("Only default value (0) for Antialias attribute is supported");tsvb_xp(t.inputs,e,s,r,n,i),t.compute(tsvb_Dp(t.inputs[0],e,s,r,n,i),{inputs:[0]})},tsvb_Zu=t=>{let e=t.antialias,r=t.axes,n=t.coordinateTransformMode,i=t.cubicCoeffA,s=0!==t.excludeOutside,o=t.extrapolationValue,a=t.keepAspectRatioPolicy,u=t.mode,l=""===t.nearestMode?"simple":t.nearestMode;return tsvb_he({antialias:e,axes:r,coordinateTransformMode:n,cubicCoeffA:i,excludeOutside:s,extrapolationValue:o,keepAspectRatioPolicy:a,mode:u,nearestMode:l})}})),tsvb_zp,tsvb_Up,tsvb_Xu,tsvb_Ju,tsvb_el=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_zp=t=>{if(!t||t.length<3)throw new Error("layerNorm requires at least 3 inputs.");let e=t[0],r=t[1],n=t[2];if(e.dataType!==r.dataType||e.dataType!==n.dataType)throw new Error("All inputs must have the same data type");if(3!==e.dims.length&&2!==e.dims.length)throw new Error("Input must be 2D or 3D");if(3!==r.dims.length&&2!==r.dims.length)throw new Error("Skip must be 2D or 3D");let i=e.dims[e.dims.length-1],s=e.dims[e.dims.length-2];if(r.dims[r.dims.length-1]!==i)throw new Error("Skip must have the same hidden size as input");if(r.dims[r.dims.length-2]!==s)throw new Error("Skip must have the same sequence length as input");if(1!==n.dims.length)throw new Error("Gamma must be 1D");if(n.dims[n.dims.length-1]!==i)throw new Error("Gamma must have the same hidden size as input");if(t.length>3){let e=t[3];if(1!==e.dims.length)throw new Error("Beta must be 1D");if(e.dims[e.dims.length-1]!==i)throw new Error("Beta must have the same hidden size as input")}if(t.length>4){let e=t[4];if(1!==e.dims.length)throw new Error("Bias must be 1D");if(e.dims[e.dims.length-1]!==i)throw new Error("Bias must have the same hidden size as input")}},tsvb_Up=(t,e,r,n)=>{let i=t[0].dims,s=i,o=tsvb_ort_webgpu_min_N.size(i),a=i.slice(-1)[0],u=n?i.slice(0,-1).concat(1):[],l=t.length>3,c=t.length>4,h=n&&r>1,f=n&&r>2,d=r>3,p=tsvb_He(a),v=[tsvb_z("x",t[0].dataType,t[0].dims,p),tsvb_z("skip",t[1].dataType,t[1].dims,p),tsvb_z("gamma",t[2].dataType,t[2].dims,p)];l&&v.push(tsvb_z("beta",t[3].dataType,t[3].dims,p)),c&&v.push(tsvb_z("bias",t[4].dataType,t[4].dims,p)),v.push(tsvb_ort_webgpu_min_j("output",t[0].dataType,s,p)),h&&v.push(tsvb_ort_webgpu_min_j("meanOutput",1,u)),f&&v.push(tsvb_ort_webgpu_min_j("invStdOutput",1,u)),d&&v.push(tsvb_ort_webgpu_min_j("inputSkipBiasSum",t[0].dataType,s,p));let y=tsvb_Le(t[0].dataType),b=[{dims:s,dataType:t[0].dataType}];return r>1&&b.push({dims:u,dataType:1}),r>2&&b.push({dims:u,dataType:1}),r>3&&b.push({dims:i,dataType:t[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:e.cacheKey},getShaderSource:t=>`\n      const hiddenSize: f32 = ${a};\n      const hiddenSizeVectorized: u32 = ${a/p};\n      const epsilon: f32 = ${e.epsilon};\n\n      ${t.declareVariables(...v)}\n\n      ${t.mainStart()}\n        ${t.guardAgainstOutOfBoundsWorkgroupSizes(o/a)}\n        let offset = global_idx * hiddenSizeVectorized;\n        var sum = ${tsvb_Je("f32",p)};\n        var squareSum = ${tsvb_Je("f32",p)};\n        for (var i: u32 = 0; i < hiddenSizeVectorized; i++) {\n          let skipValue = skip[offset + i];\n          let biasValue = ${c?"bias[i]":"0.0"};\n          let inputValue = x[offset + i];\n          let value = inputValue + skipValue + biasValue;\n          ${d?"inputSkipBiasSum[offset + i] = value;":""}\n          output[offset + i] = value;\n          let f32Value = ${tsvb_ht(y,p,"value")};\n          sum += f32Value;\n          squareSum += f32Value * f32Value;\n        }\n        let mean = ${tsvb_st("sum",p)} / hiddenSize;\n        let invStdDev = inverseSqrt(${tsvb_st("squareSum",p)} / hiddenSize - mean * mean + epsilon);\n        ${h?"meanOutput[global_idx] = mean;":""}\n        ${f?"invStdOutput[global_idx] = invStdDev;":""}\n        for (var i: u32 = 0; i < hiddenSizeVectorized; i++) {\n          output[offset + i] = (output[offset + i] - ${y}(mean)) * ${y}(invStdDev) * gamma[i]\n           + ${l?"beta[i]":"0.0"};\n        }\n      }`,getRunData:()=>({outputs:b,dispatchGroup:{x:Math.ceil(o/a/64)}})}},tsvb_Xu=(t,e)=>{tsvb_zp(t.inputs);let r=[0];t.outputCount>1&&r.push(-3),t.outputCount>2&&r.push(-3),t.outputCount>3&&r.push(3),t.compute(tsvb_Up(t.inputs,e,t.outputCount,!1),{outputs:r})},tsvb_Ju=t=>{let e=t.epsilon;return tsvb_he({epsilon:e})}})),tsvb_Np,tsvb_Dn,tsvb_Wp,tsvb_tl,tsvb_Vp,tsvb_Gp,tsvb_rl,tsvb_nl,tsvb_al=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_Np=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");if(0!==e.axes.length){if(e.axes.length!==e.starts.length||e.axes.length!==e.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(e.starts.length!==e.ends.length)throw new Error("starts and ends must have the same length");t.slice(1).forEach(((e,r)=>{if(6!==t[r+1].dataType&&7!==t[r+1].dataType)throw new Error(`Input ${r} must be an array of int32 or int64`)}))},tsvb_Dn=(t,e)=>{let r=[];if(t.length>e)if(7===t[e].dataType)t[e].getBigInt64Array().forEach((t=>r.push(Number(t))));else{if(6!==t[e].dataType)throw new Error(`Input ${e} must be an array of int32 or int64`);t[e].getInt32Array().forEach((t=>r.push(Number(t))))}return r},tsvb_Wp=(t,e)=>{if(t.length>1){let e=tsvb_Dn(t,1),r=tsvb_Dn(t,2),n=tsvb_Dn(t,3);return 0===n.length&&(n=[...Array(t[0].dims.length).keys()]),tsvb_he({starts:e,ends:r,axes:n})}return e},tsvb_tl=(t,e,r,n,i)=>{let s=t;return t<0&&(s+=r[n[e]]),i[e]<0?Math.max(0,Math.min(s,r[n[e]]-1)):Math.max(0,Math.min(s,r[n[e]]))},tsvb_Vp=(t,e,r)=>`fn calculateInputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {\n          var input_indices: ${t.type.indices};\n          var carry = 0u;\n          for (var i = ${r.length}; i >= 0; i--) {\n            let input_shape_i = ${tsvb_le("uniforms.input_shape","i",r.length)};\n            let steps_i = ${tsvb_le("uniforms.steps","i",r.length)};\n            let signs_i = ${tsvb_le("uniforms.signs","i",r.length)};\n            let starts_i = ${tsvb_le("uniforms.starts","i",r.length)};\n            var output_index = ${e.indicesGet("output_indices","i")};\n            var input_index = output_index * steps_i + starts_i + carry;\n            carry = input_index / input_shape_i;\n            input_index = input_index % input_shape_i;\n            if (signs_i < 0) {\n              input_index = input_shape_i - input_index - 1u + starts_i;\n            }\n            ${t.indicesSet("input_indices","i","input_index")};\n          }\n          return input_indices;\n      }`,tsvb_Gp=(t,e)=>{let r=t[0].dims,n=tsvb_ort_webgpu_min_N.size(r),i=e.axes.length>0?tsvb_ort_webgpu_min_N.normalizeAxes(e.axes,r.length):[...Array(r.length).keys()],s=tsvb_Dn(t,4);s.forEach((t=>0!==t||(()=>{throw new Error("step cannot be 0")}))),0===s.length&&(s=Array(i.length).fill(1));let o=e.starts.map(((t,e)=>tsvb_tl(t,e,r,i,s))),a=e.ends.map(((t,e)=>tsvb_tl(t,e,r,i,s)));if(i.length!==o.length||i.length!==a.length)throw new Error("start, ends and axes should have the same number of elements");if(i.length!==r.length)for(let t=0;t<r.length;++t)i.includes(t)||(o.splice(t,0,0),a.splice(t,0,r[t]),s.splice(t,0,1));let u=s.map((t=>Math.sign(t)));s.forEach(((t,e,r)=>{if(t<0){let n=(a[e]-o[e])/t,i=o[e],u=i+n*s[e];o[e]=u,a[e]=i,r[e]=-t}}));let l=r.slice(0);i.forEach(((t,e)=>{l[t]=Math.ceil((a[t]-o[t])/s[t])}));let c={dims:l,dataType:t[0].dataType},h=tsvb_ort_webgpu_min_j("output",t[0].dataType,l.length),f=tsvb_z("input",t[0].dataType,t[0].dims.length),d=tsvb_ort_webgpu_min_N.size(l),p=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:o.length},{name:"signs",type:"i32",length:u.length},{name:"steps",type:"u32",length:s.length}],v=[{type:"uint32",data:d},{type:"uint32",data:o},{type:"int32",data:u},{type:"uint32",data:s},...tsvb_F(t[0].dims),...tsvb_F(l)];return{name:"Slice",shaderCache:{hint:`${u.length}_${o.length}_${s.length}`,inputDependencies:["rank"]},getShaderSource:t=>`\n      ${t.registerUniforms(p).declareVariables(f,h)}\n        ${tsvb_Vp(f,h,r)}\n        ${t.mainStart()}\n          ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n          let output_indices = ${h.offsetToIndices("global_idx")};\n          let input_indices = calculateInputIndices(output_indices);\n          ${h.setByOffset("global_idx",f.getByIndices("input_indices"))}\n      }`,getRunData:()=>({outputs:[c],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:v})}},tsvb_rl=(t,e)=>{tsvb_Np(t.inputs,e);let r=tsvb_Wp(t.inputs,e);t.compute(tsvb_Gp(t.inputs,r),{inputs:[0]})},tsvb_nl=t=>{let e=t.starts,r=t.ends,n=t.axes;return tsvb_he({starts:e,ends:r,axes:n})}})),tsvb_Lp,tsvb_Hp,tsvb_il,tsvb_ol,tsvb_sl=tsvb_q((()=>{tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_Lp=t=>{if(!t||1!==t.length)throw new Error("Softmax op requires 1 input.")},tsvb_Hp=(t,e)=>{let r=t.dims,n=tsvb_ort_webgpu_min_N.size(r),i=e.axis;if(i<0&&(i=r.length+i),i<r.length-1)throw new Error("softmax only supports last axis for now.");let s=r[i],o=n/s,a=tsvb_He(s),u=s/a,l=tsvb_z("x",t.dataType,t.dims,a),c=tsvb_ort_webgpu_min_j("result",t.dataType,t.dims,a),h=l.type.value,f="f32"===tsvb_Le(t.dataType)?`var threadMax = ${h}(-3.402823e+38f);`:`var threadMax = ${h}(-65504.0h);`;return{name:"Softmax",shaderCache:{hint:`${a}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:r,dataType:t.dataType}],dispatchGroup:{x:o},programUniforms:[{type:"uint32",data:u}]}),getShaderSource:t=>`\n      var<workgroup> rowMaxShared : ${h};\n      var<workgroup> rowSumShared : ${h};\n      var<workgroup> threadShared : array<${h}, 64>;\n\n      fn getValue(row: i32, col: i32, row_stride: i32) -> ${h} {\n        let index = row * row_stride + col;\n        return x[index];\n      }\n\n      fn setValue(row: i32, col: i32, row_stride: i32, value: ${h}) {\n        let index = row * row_stride + col;\n        result[index] = value;\n      }\n      ${t.registerUniform("packedCols","i32").declareVariables(l,c)}\n      ${t.mainStart()}\n        let gindex = i32(global_idx);\n        let lindex = i32(local_idx);\n        const wg = 64;\n        let row = gindex / wg;\n        let cols = uniforms.packedCols;\n        let row_stride : i32 = uniforms.packedCols;\n\n        // find the rows max\n        ${f}\n        for (var col = lindex; col < cols; col += wg) {\n          let value = getValue(row, col, row_stride);\n          threadMax = max(threadMax, value);\n        }\n        if (lindex < cols) {\n          threadShared[lindex] = threadMax;\n        }\n        workgroupBarrier();\n\n        var reduceSize = min(cols, wg);\n        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {\n          reduceSize = currSize + (reduceSize & 1);\n          if (lindex < currSize) {\n            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowMaxShared = ${h}(${((t,e)=>4===e?`max(max(${t}.x, ${t}.y), max(${t}.z, ${t}.w))`:2===e?`max(${t}.x, ${t}.y)`:3===e?`max(max(${t}.x, ${t}.y), ${t}.z)`:t)("threadShared[0]",a)});\n        }\n        workgroupBarrier();\n\n        // find the rows sum\n        var threadSum = ${h}(0.0);\n        for (var col = lindex; col < cols; col += wg) {\n          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);\n          threadSum += subExp;\n        }\n        threadShared[lindex] = threadSum;\n        workgroupBarrier();\n\n        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {\n          if (lindex < currSize) {\n            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowSumShared = ${h}(${tsvb_st("threadShared[0]",a)});\n        }\n        workgroupBarrier();\n\n        // calculate final value for each element in the row\n        for (var col = lindex; col < cols; col += wg) {\n          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;\n          setValue(row, col, row_stride, value);\n        }\n      }`}},tsvb_il=(t,e)=>{tsvb_Lp(t.inputs),t.compute(tsvb_Hp(t.inputs[0],e))},tsvb_ol=t=>tsvb_he({axis:t.axis})})),tsvb_Fp,tsvb_qp,tsvb_jp,tsvb_Kp,tsvb_Yp,tsvb_ul,tsvb_ll,tsvb_dl=tsvb_q((()=>{tsvb_xe(),tsvb_Fe(),tsvb_$e(),tsvb_Fp=t=>{if(!t||t.length<1)throw new Error("too few inputs")},tsvb_qp=(t,e)=>{let r=[],n=e.numOutputs;return t[1].dims[0]>0&&(t[1].getBigInt64Array().forEach((t=>r.push(Number(t)))),n=r.length),tsvb_he({numOutputs:n,axis:e.axis,splitSizes:r})},tsvb_jp=t=>`\nfn calculateOutputIndex(index: u32) -> u32 {\n    for (var i: u32 = 0u; i < ${t}u; i += 1u ) {\n    if (index < ${tsvb_le("uniforms.size_in_split_axis","i",t)}) {\n        return i;\n    }\n    }\n    return ${t}u;\n}`,tsvb_Kp=t=>{let e=t.length,r=[];for(let n=0;n<e;++n){let i=t[n].setByIndices("indices","input[global_idx]");1===e?r.push(i):0===n?r.push(`if (output_number == ${n}u) { ${i} }`):n===e-1?r.push(`else { ${i} }`):r.push(`else if (output_number == ${n}) { ${i} }`)}return`\n      fn writeBufferData(output_number: u32, indices: ${t[0].type.indices}, global_idx: u32) {\n        ${r.join("\n")}\n      }`},tsvb_Yp=(t,e)=>{let r=t[0].dims,n=tsvb_ort_webgpu_min_N.size(r),i=t[0].dataType,s=tsvb_ort_webgpu_min_N.normalizeAxis(e.axis,r.length),o=new Array(e.numOutputs),a=tsvb_z("input",i,r),u=new Array(e.numOutputs),l=[],c=[],h=0,f=[{type:"uint32",data:n}];for(let n=0;n<e.numOutputs;n++){h+=e.splitSizes[n],u[n]=h;let s=r.slice();s[e.axis]=e.splitSizes[n],c.push(s),o[n]=tsvb_ort_webgpu_min_j(`output${n}`,i,s),l.push({dims:c[n],dataType:t[0].dataType})}f.push({type:"uint32",data:u}),f.push(...tsvb_F(r)),c.forEach((t=>f.push(...tsvb_F(t))));return{name:"Split",shaderCache:{hint:e.cacheKey,inputDependencies:["rank"]},getShaderSource:t=>`\n  ${t.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",u.length).declareVariables(a,...o)}\n  ${tsvb_jp(u.length)}\n  ${tsvb_Kp(o)}\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}\n\n    var indices = ${a.offsetToIndices("global_idx")};\n    var index = ${a.indicesGet("indices",s)};\n    let output_number = calculateOutputIndex(index);\n    if (output_number != 0) {\n      index -= ${tsvb_le("uniforms.size_in_split_axis","output_number - 1u",u.length)};\n      ${a.indicesSet("indices",s,"index")};\n    }\n    writeBufferData(output_number, indices, global_idx);\n  }`,getRunData:()=>({outputs:l,dispatchGroup:{x:Math.ceil(n/64)},programUniforms:f})}},tsvb_ul=(t,e)=>{tsvb_Fp(t.inputs);let r=1===t.inputs.length?e:tsvb_qp(t.inputs,e);t.compute(tsvb_Yp(t.inputs,r),{inputs:[0]})},tsvb_ll=t=>{let e=t.axis,r=t.splitSizes,n=t.numOutputs<0?r.length:t.numOutputs;if(n!==r.length)throw new Error("numOutputs and splitSizes lengh must be equal");return tsvb_he({axis:e,numOutputs:n,splitSizes:r})}})),tsvb_cl,tsvb_Zp,tsvb_Qp,tsvb_Xp,tsvb_pl,tsvb_ml=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_$e(),tsvb_cl=t=>Array.from(t.getBigInt64Array(),Number),tsvb_Zp=t=>{if(!t||2!==t.length)throw new Error("Tile requires 2 inputs.");if(1!==t[0].dataType&&6!==t[0].dataType&&12!==t[0].dataType)throw new Error("Tile only support float, int32, and uint32 data types");if(7!==t[1].dataType)throw new Error("Tile `repeats` input should be of int64 data type");if(1!==t[1].dims.length)throw new Error("Tile `repeats` input should be 1-D");if(tsvb_cl(t[1]).length!==t[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},tsvb_Qp=(t,e)=>{let r=[];for(let n=0;n<t.length;++n)r.push(t[n]*e[n]);return r},tsvb_Xp=t=>{let e=t[0].dims,r=tsvb_cl(t[1]),n=tsvb_Qp(e,r),i=tsvb_ort_webgpu_min_N.size(n),s=t[0].dataType,o=tsvb_z("input",s,e.length),a=tsvb_ort_webgpu_min_j("output",s,n.length);return{name:"Tile",shaderCache:{hint:`${r}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:"uint32",data:i},...tsvb_F(t[0].dims),...tsvb_F(n)]}),getShaderSource:t=>`\n      const inputShape = ${o.indices(...e)};\n      ${t.registerUniform("output_size","u32").declareVariables(o,a)}\n      ${t.mainStart()}\n      ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n      let output_indices = ${a.offsetToIndices("global_idx")};\n      var input_indices: ${o.type.indices};\n      for (var i = 0; i < ${e.length}; i++) {\n        let input_dim_i = ${o.indicesGet("uniforms.input_shape","i")};\n        let input_dim_value = ${a.indicesGet("output_indices","i")}  % input_dim_i;\n\n        ${o.indicesSet("input_indices","i","input_dim_value")}\n      }\n      ${a.setByOffset("global_idx",o.getByIndices("input_indices"))}\n    }`}},tsvb_pl=t=>{tsvb_Zp(t.inputs),t.compute(tsvb_Xp(t.inputs),{inputs:[0]})}})),tsvb_Jp,tsvb_em,tsvb_fl,tsvb_hl=tsvb_q((()=>{tsvb_Ve(),tsvb_xe(),tsvb_$e(),tsvb_Jp=(t,e,r,n,i)=>{let s,o=tsvb_ort_webgpu_min_j("output_data",i,r.length,4),a=tsvb_z("a_data",e[1].dataType,e[1].dims.length,4),u=tsvb_z("b_data",e[2].dataType,e[2].dims.length,4),l=tsvb_z("c_data",e[0].dataType,e[0].dims.length,4),c=(t,e,r)=>`select(${e}, ${t}, ${r})`;if(n){let t=(t,e,r="")=>{let n=`a_data[index_a${e}][component_a${e}]`,i=`b_data[index_b${e}][component_b${e}]`,s=`bool(c_data[index_c${e}] & ${4278190080>>>8*(3-e)}u)`;return`\n            let output_indices${e} = ${o.offsetToIndices(`global_idx * 4u + ${e}u`)};\n            let offset_a${e} = ${a.broadcastedIndicesToOffset(`output_indices${e}`,o)};\n            let offset_b${e} = ${u.broadcastedIndicesToOffset(`output_indices${e}`,o)};\n            let offset_c${e} = ${l.broadcastedIndicesToOffset(`output_indices${e}`,o)};\n            let index_a${e} = offset_a${e} / 4u;\n            let index_b${e} = offset_b${e} / 4u;\n            let index_c${e} = offset_c${e} / 4u;\n            let component_a${e} = offset_a${e} % 4u;\n            let component_b${e} = offset_b${e} % 4u;\n            ${t}[${e}] = ${r}(${c(n,i,s)});\n          `};s=9===i?`\n            var data = vec4<u32>(0);\n            ${t("data",0,"u32")}\n            ${t("data",1,"u32")}\n            ${t("data",2,"u32")}\n            ${t("data",3,"u32")}\n            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:`\n            ${t("output_data[global_idx]",0)}\n            ${t("output_data[global_idx]",1)}\n            ${t("output_data[global_idx]",2)}\n            ${t("output_data[global_idx]",3)}\n          `}else s=o.setByOffset("global_idx",c(a.getByOffset("global_idx"),u.getByOffset("global_idx"),l.getByOffset("global_idx")));return`\n        ${t.registerUniform("vec_size","u32").declareVariables(l,a,u,o)}\n        ${t.mainStart()}\n        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n        ${s}\n      }`},tsvb_em=t=>{let e=t[1].dims,r=t[2].dims,n=t[0].dims,i=t[1].dataType,s=!(tsvb_ort_webgpu_min_N.areEqual(e,r)&&tsvb_ort_webgpu_min_N.areEqual(r,n)),o=e,a=tsvb_ort_webgpu_min_N.size(e);if(s){let t=tsvb_vt.calcShape(tsvb_vt.calcShape(e,r,!1),n,!1);if(!t)throw new Error("Can't perform where op on the given tensors");o=t,a=tsvb_ort_webgpu_min_N.size(o)}let u=Math.ceil(a/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:e=>tsvb_Jp(e,t,o,s,i),getRunData:()=>({outputs:[{dims:o,dataType:i}],dispatchGroup:{x:Math.ceil(a/64/4)},programUniforms:[{type:"uint32",data:u},...tsvb_F(n),...tsvb_F(e),...tsvb_F(r),...tsvb_F(o)]})}},tsvb_fl=t=>{t.compute(tsvb_em(t.inputs))}})),tsvb_gl,tsvb_yl=tsvb_q((()=>{tsvb_Wo(),tsvb_Ca(),tsvb_Lo(),tsvb_Fo(),tsvb_Ss(),tsvb_Ds(),tsvb_Us(),tsvb_ka(),tsvb_Xs(),tsvb_tu(),tsvb_ou(),tsvb_lu(),tsvb_pu(),tsvb_hu(),tsvb_bu(),tsvb_vu(),src_tsvb_u(),tsvb_Pa(),tsvb_Cu(),tsvb_Tu(),tsvb_Fu(),tsvb_ju(),tsvb_xn(),tsvb_Qu(),tsvb_el(),tsvb_al(),tsvb_sl(),tsvb_dl(),tsvb_ml(),tsvb_hr(),tsvb_Aa(),tsvb_hl(),tsvb_gl=new Map([["Abs",[tsvb_qo]],["Acos",[tsvb_jo]],["Acosh",[tsvb_Ko]],["Add",[tsvb_Is]],["ArgMax",[tsvb_No,tsvb_Ia]],["ArgMin",[tsvb_Uo,tsvb_Ia]],["Asin",[tsvb_Yo]],["Asinh",[tsvb_Zo]],["Atan",[tsvb_Qo]],["Atanh",[tsvb_Xo]],["Attention",[tsvb_Vo]],["AveragePool",[tsvb_Mu,tsvb_Du]],["BatchNormalization",[tsvb_Go]],["BiasAdd",[tsvb_Ho]],["BiasSplitGelu",[tsvb_xs]],["Cast",[tsvb_es,tsvb_Jo]],["Ceil",[tsvb_rs]],["Clip",[tsvb_ts]],["Concat",[tsvb_Ms,tsvb_zs]],["Conv",[tsvb_Da,tsvb_Ra]],["ConvTranspose",[tsvb_Qs,tsvb_Zs]],["Cos",[tsvb_ns]],["Cosh",[tsvb_as]],["CumSum",[tsvb_Js,tsvb_eu]],["Div",[tsvb_Cs]],["Einsum",[tsvb_au,tsvb_iu]],["Elu",[tsvb_is,tsvb_Cn]],["Equal",[tsvb_As]],["Erf",[tsvb_os]],["Exp",[tsvb_ss]],["Expand",[tsvb_uu]],["Floor",[tsvb_us]],["FusedConv",[tsvb_Da,tsvb_Ra]],["Gather",[tsvb_cu,tsvb_du]],["GatherElements",[tsvb_fu,tsvb_mu]],["Gelu",[tsvb_ls]],["Gemm",[tsvb_yu,tsvb_gu]],["GlobalAveragePool",[tsvb_Nu,tsvb_Uu]],["GlobalMaxPool",[tsvb_Hu,tsvb_Lu]],["Greater",[tsvb_ks]],["GreaterOrEqual",[tsvb_Ps]],["InstanceNormalization",[tsvb_wu]],["LayerNormalization",[tsvb_$u]],["LeakyRelu",[tsvb_ds,tsvb_Cn]],["Less",[tsvb_Bs]],["LessOrEqual",[tsvb_Rs]],["Log",[src_tsvb_s]],["MatMul",[tsvb_Ls]],["MaxPool",[tsvb_Vu,tsvb_Gu]],["Mul",[tsvb_Ts]],["MultiHeadAttention",[tsvb_Iu,tsvb_Su]],["Neg",[tsvb_ps]],["Not",[tsvb_cs]],["Pad",[tsvb_Au]],["Pow",[tsvb_Es]],["Range",[tsvb_qu]],["Reciprocal",[tsvb_ms]],["ReduceMin",[tsvb_Bo]],["ReduceMean",[tsvb_Ao]],["ReduceMax",[tsvb_ko]],["ReduceSum",[tsvb_Ro]],["ReduceProd",[tsvb_Po]],["ReduceL1",[tsvb_To]],["ReduceL2",[tsvb_Eo]],["ReduceLogSum",[tsvb_Mo]],["ReduceLogSumExp",[tsvb_Oo]],["ReduceSumSquare",[tsvb_Do]],["Relu",[tsvb_fs]],["Resize",[tsvb_Yu,tsvb_Zu]],["Sigmoid",[tsvb_hs]],["Sin",[tsvb_gs]],["Sinh",[tsvb_ys]],["Slice",[tsvb_rl,tsvb_nl]],["SkipLayerNormalization",[tsvb_Xu,tsvb_Ju]],["Split",[tsvb_ul,tsvb_ll]],["Sqrt",[tsvb_bs]],["Softmax",[tsvb_il,tsvb_ol]],["Sub",[tsvb_Os]],["Tan",[tsvb_ws]],["Tanh",[tsvb_vs]],["ThresholdedRelu",[tsvb_$s,tsvb_Cn]],["Tile",[tsvb_pl]],["Transpose",[tsvb_fo,tsvb_ho]],["Where",[tsvb_fl]]])})),tsvb_Mn,tsvb_bl=tsvb_q((()=>{tsvb_pt(),tsvb_Nt(),tsvb_$e(),tsvb_Mn=class{constructor(t){this.backend=t,this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,e){this.repo.set(t,e)}run(t,e,r){tsvb_lt(t.programInfo.name);let n=this.backend.getComputePassEncoder();if(this.backend.writeTimestamp(2*this.backend.pendingDispatchNumber),"capturing"===this.backend.sessionStatus){let n={kernelId:this.backend.currentKernelId,computePipeline:t.computePipeline,bindGroup:e,dispatchGroup:r};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(n)}n.setPipeline(t.computePipeline),n.setBindGroup(0,e),n.dispatchWorkgroups(...r),this.backend.writeTimestamp(2*this.backend.pendingDispatchNumber+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||"at-passes"===this.backend.queryType)&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),tsvb_dt(t.programInfo.name)}dispose(){}build(t,e){tsvb_lt(t.name);let r=this.backend.device,n=[];r.features.has("shader-f16")&&n.push("enable f16;");let i=tsvb_po(e),s=t.getShaderSource(i),o=`${n.join("\n")}\n${i.additionalImplementations}\n${s}`,a=r.createShaderModule({code:o,label:t.name});tsvb_De("verbose",(()=>`[WebGPU] ${t.name} shader code: ${o}`));let u=r.createComputePipeline({compute:{module:a,entryPoint:"main"},layout:"auto",label:t.name});return tsvb_dt(t.name),{programInfo:t,computePipeline:u}}normalizeDispatchGroupSize(t){let e="number"==typeof t?t:t.x,r="number"==typeof t?1:t.y||1,n="number"==typeof t?1:t.z||1,i=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(e<=i&&r<=i&&n<=i)return[e,r,n];let s=e*r*n,o=Math.ceil(Math.sqrt(s));if(o>i){if(o=Math.ceil(Math.cbrt(s)),o>i)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[o,o,o]}return[o,o,1]}}})),tsvb_tm,tsvb_rm,tsvb_zn,tsvb_wl=tsvb_q((()=>{tsvb_pt(),tsvb_Ve(),tsvb_Nt(),tsvb_oo(),tsvb_co(),tsvb_yl(),tsvb_bl(),tsvb_tm=(t,e)=>{if(e.length!==t.length)throw new Error(`inputDependencies length ${e.length} is not equal to inputTensors length ${t.length}.`);let r=[];for(let n=0;n<t.length;++n){let i=t[n].dataType;switch(e[n]){case"none":r.push("");break;case"type":r.push(`${i}`);break;case"rank":{let e=t[n].dims.length;r.push(`${i};${e}`);break}case"dims":{let e=t[n].dims.join(",");r.push(`${i};${e}`);break}default:throw new Error(`unsupported input dependency: ${e[n]}`)}}return r.join("|")},tsvb_rm=(t,e,r)=>{let n=t.name;return t.shaderCache?.hint&&(n+="["+t.shaderCache.hint+"]"),n+=":"+r+`:${tsvb_tm(e,t.shaderCache?.inputDependencies??new Array(e.length).fill("dims"))}`,n},tsvb_zn=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(null===this.currentKernelId)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let t=this.kernelCustomData.get(this.currentKernelId);return t||(t={},this.kernelCustomData.set(this.currentKernelId,t)),t}async initialize(t,e){this.env=t;let r=[],n={requiredLimits:{maxComputeWorkgroupStorageSize:e.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:e.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:e.limits.maxStorageBufferBindingSize,maxBufferSize:e.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:e.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:e.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:e.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:e.limits.maxComputeWorkgroupSizeZ},requiredFeatures:r};e.features.has("chromium-experimental-timestamp-query-inside-passes")?r.push("chromium-experimental-timestamp-query-inside-passes"):e.features.has("timestamp-query")&&r.push("timestamp-query"),e.features.has("shader-f16")&&r.push("shader-f16"),this.device=await e.requestDevice(n),this.gpuDataManager=tsvb_lo(this),this.programManager=new tsvb_Mn(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,this.kernelUniformCache=new Map,this.kernelGpuBindGroupCache=new Map,tsvb_ao(t.logLevel,!!t.debug),this.device.onuncapturederror=t=>{t.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${t.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder(),this.setQueryType(),"none"!==this.queryType&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:2*this.maxDispatchNumber}),this.queryResolveBuffer=this.device.createBuffer({size:2*this.maxDispatchNumber*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE}))),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let t=this.getCommandEncoder(),e={};"at-passes"===this.queryType&&(e.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:2*this.pendingDispatchNumber,endOfPassWriteIndex:2*this.pendingDispatchNumber+1}),this.computePassEncoder=t.beginComputePass(e)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;let t;tsvb_lt(),this.endComputePass(),"none"!==this.queryType&&(this.commandEncoder.resolveQuerySet(this.querySet,0,2*this.pendingDispatchNumber,this.queryResolveBuffer,0),t=this.device.createBuffer({size:2*this.pendingDispatchNumber*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(t,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,2*this.pendingDispatchNumber*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,"none"!==this.queryType&&t.mapAsync(GPUMapMode.READ).then((()=>{let e=new BigUint64Array(t.getMappedRange()),r=this.pendingQueries.get(t);for(let t=0;t<e.length/2;t++){let n=r[t],i=n.kernelId,s=this.kernels.get(i),o=s.kernelType,a=s.kernelName,u=n.programName,l=n.inputTensorViews,c=n.outputTensorViews,h=e[2*t],f=e[2*t+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=h);let d=Number(h-this.queryTimeBase),p=Number(f-this.queryTimeBase);if(!Number.isSafeInteger(d)||!Number.isSafeInteger(p))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:l.map((t=>({dims:t.dims,dataType:tsvb_ot(t.dataType)}))),outputsMetadata:c.map((t=>({dims:t.dims,dataType:tsvb_ot(t.dataType)}))),kernelId:i,kernelType:o,kernelName:a,programName:u,startTime:d,endTime:p});else{let t="";l.forEach(((e,r)=>{t+=`input[${r}]: [${e.dims}] | ${tsvb_ot(e.dataType)}, `}));let e="";c.forEach(((t,r)=>{e+=`output[${r}]: [${t.dims}] | ${tsvb_ot(t.dataType)}, `})),console.log(`[profiling] kernel "${i}|${o}|${a}|${u}" ${t}${e}execution time: ${p-d} ns`)}tsvb_dn("GPU",`${u}::${h}::${f}`)}t.unmap(),this.pendingQueries.delete(t)})),tsvb_dt()}run(t,e,r,n,i){tsvb_lt(t.name);let s=[];for(let t=0;t<e.length;++t){let r=this.gpuDataManager.get(e[t].data);if(!r)throw new Error(`no GPU data for input: ${e[t].data}`);s[t]=r}let{outputs:o,dispatchGroup:a,programUniforms:u}=t.getRunData(e),l=0===r.length?o.map(((t,e)=>e)):r;if(l.length!==o.length)throw new Error(`Output size ${l.length} must be equal to ${o.length}.`);let c,h=[],f=[];for(let t=0;t<o.length;++t){if(!Number.isInteger(l[t])||l[t]<-3||l[t]>=o.length)throw new Error(`Invalid output index: ${l[t]}`);if(-3===l[t])continue;let e=-1===l[t],r=-2===l[t],s=e||r?i(o[t].dataType,o[t].dims):n(l[t],o[t].dataType,o[t].dims),a=this.gpuDataManager.get(s.data);if(!a)throw new Error(`no GPU data for output: ${s.data}`);if(e&&this.temporaryData.push(a),r){let t=this.kernelPersistentData.get(this.currentKernelId);t||(t=[],this.kernelPersistentData.set(this.currentKernelId,t)),t.push(a)}h.push(s),f.push(a)}if(u){let t=this.kernelUniformCache.get(this.currentKernelId);t&&(this.compareProgramUniforms(t.programUniforms,u)||(this.gpuDataManager.release(t.gpuData.id),t=void 0)),t||(t=this.createCachedUniform(u),this.kernelUniformCache.set(this.currentKernelId,t)),c=t.binding}let d=this.programManager.normalizeDispatchGroupSize(a),p=1===d[1]&&1===d[2],v=tsvb_rm(t,e,p),y=this.programManager.getArtifact(v);if(y||(y=this.programManager.build(t,d),this.programManager.setArtifact(v,y),tsvb_De("info",(()=>`[artifact] key: ${v}, programName: ${t.name}`))),tsvb_De("info",(()=>`[ProgramManager] run "${t.name}" (key=${v}) with ${d[0]}x${d[1]}x${d[2]}`)),"none"!==this.queryType||"capturing"===this.sessionStatus){let t={kernelId:this.currentKernelId,programName:y.programInfo.name,inputTensorViews:e,outputTensorViews:h};this.pendingKernels.push(t),this.capturedPendingKernels.get(this.currentSessionId).push(t)}let b,_=this.kernelGpuBindGroupCache.get(this.currentKernelId);_||(_=[],this.kernelGpuBindGroupCache.set(this.currentKernelId,_));for(let t of _)if(this.checkCachedBindGroup(t,y,s,f,c)){b=t;break}if(!b)for(b=this.createCachedBindGroup(y,s,f,c),_.push(b);_.length>20;)_.shift();return this.programManager.run(y,b.binding,d),tsvb_dt(t.name),h}compareProgramUniforms(t,e){return t.length===e.length&&t.every(((t,r)=>t.type===e[r].type))}createCachedUniform(t){let e=0,r=[];t.forEach((t=>{let n="number"==typeof t.data?[t.data]:t.data;if(0===n.length)return;let i=n.length<=2?4*n.length:16;e=Math.ceil(e/i)*i,r.push(e),e+=n.length>4?16*Math.ceil(n.length/4):4*n.length}));e=16*Math.ceil(e/16);let n=new ArrayBuffer(e);t.forEach(((t,e)=>{let i=r[e],s="number"==typeof t.data?[t.data]:t.data;"int32"===t.type?new Int32Array(n,i,s.length).set(s):"uint32"===t.type?new Uint32Array(n,i,s.length).set(s):new Float32Array(n,i,s.length).set(s)}));let i=this.gpuDataManager.create(e,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);return this.device.queue.writeBuffer(i.buffer,0,n,0,e),{programUniforms:t,binding:{offset:0,size:e,buffer:i.buffer},gpuData:i}}checkCachedBindGroup(t,e,r,n,i){if(e!==t.artifact)return!1;let s=r.every(((e,r)=>e.permamentID===t.inputPermamentIDs[r])),o=n.every(((e,r)=>e.permamentID===t.outputPermamentIDs[r])),a=i===t.uniformBinding;return s&&o&&a}createCachedBindGroup(t,e,r,n){let i=[];for(let t of e)i.push({binding:i.length,resource:{buffer:t.buffer}});for(let t of r)i.push({binding:i.length,resource:{buffer:t.buffer}});return n&&i.push({binding:i.length,resource:n}),{binding:this.device.createBindGroup({layout:t.computePipeline.getBindGroupLayout(0),entries:i,label:t.programInfo.name}),artifact:t,inputPermamentIDs:e.map((t=>t.permamentID)),outputPermamentIDs:r.map((t=>t.permamentID)),uniformBinding:n}}upload(t,e){this.gpuDataManager.upload(t,e)}memcpy(t,e){this.gpuDataManager.memcpy(t,e)}async download(t,e){await this.gpuDataManager.download(t,e)}alloc(t){return this.gpuDataManager.create(t).id}free(t){return this.gpuDataManager.release(t)}createKernel(t,e,r,n){let i=tsvb_gl.get(t);if(!i)throw new Error(`kernel not implemented: ${t}`);let s={kernelType:t,kernelName:n,kernelEntry:i[0],attributes:[i[1],r]};this.kernels.set(e,s)}releaseKernel(t){let e=this.kernelPersistentData.get(t);if(e){for(let t of e)this.gpuDataManager.release(t.id);this.kernelPersistentData.delete(t)}this.kernelCustomData.delete(t),this.kernelGpuBindGroupCache.delete(t);let r=this.kernelUniformCache.get(t);console.log("Release kernelId: ",t," has cached: ",r),r&&(this.gpuDataManager.release(r.gpuData.id),this.kernelUniformCache.delete(t)),this.kernels.delete(t)}computeKernel(t,e,r){let n=this.kernels.get(t);if(!n)throw new Error(`kernel not created: ${t}`);let i=n.kernelType,s=n.kernelName,o=n.kernelEntry,a=n.attributes;if(null!==this.currentKernelId)throw new Error(`kernel "[${i}] ${s}" is not allowed to be called recursively`);this.currentKernelId=t,a[0]&&(a[1]=a[0](a[1]),a[0]=void 0),tsvb_De("info",(()=>`[WebGPU] Start to run kernel "[${i}] ${s}"...`));let u=this.env.debug;this.temporaryData=[];try{return u&&this.device.pushErrorScope("validation"),o(e,a[1]),0}catch(t){return r.push(Promise.resolve(`[WebGPU] Kernel "[${i}] ${s}" failed. ${t}`)),1}finally{u&&r.push(this.device.popErrorScope().then((t=>t?`GPU validation error for kernel "[${i}] ${s}": ${t.message}`:null)));for(let t of this.temporaryData)this.gpuDataManager.release(t.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(t,e,r,n){let i=this.sessionExternalDataMapping.get(t);i||(i=new Map,this.sessionExternalDataMapping.set(t,i));let s=i.get(e),o=this.gpuDataManager.registerExternalBuffer(r,n,s?.[1]);return i.set(e,[o,r]),o}unregisterBuffers(t){let e=this.sessionExternalDataMapping.get(t);e&&(e.forEach((t=>this.gpuDataManager.unregisterExternalBuffer(t[1]))),this.sessionExternalDataMapping.delete(t))}getBuffer(t){let e=this.gpuDataManager.get(t);if(!e)throw new Error(`no GPU data for buffer: ${t}`);return e.buffer}createDownloader(t,e,r){return async()=>{let n=await tsvb_ba(this,t,e);return tsvb_io(n.buffer,r)}}writeTimestamp(t){"inside-passes"===this.queryType&&this.computePassEncoder.writeTimestamp(this.querySet,t)}setQueryType(){this.queryType="none",("default"===this.env.webgpu.profiling?.mode||this.env.wasm.trace)&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"))}captureBegin(){tsvb_De("info","captureBegin");let t=this.capturedCommandList.get(this.currentSessionId),e=this.capturedPendingKernels.get(this.currentSessionId);t||(t=[],this.capturedCommandList.set(this.currentSessionId,t),e=[],this.capturedPendingKernels.set(this.currentSessionId,e)),this.flush(),this.sessionStatus="capturing"}captureEnd(){tsvb_De("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){tsvb_De("info","replay"),this.sessionStatus="replaying";let t=this.capturedCommandList.get(this.currentSessionId),e=this.capturedPendingKernels.get(this.currentSessionId),r=t.length;this.pendingKernels=[];for(let n=0;n<r;n++){let r=this.getComputePassEncoder(),i=t[n];this.writeTimestamp(2*this.pendingDispatchNumber),r.setPipeline(i.computePipeline),r.setBindGroup(0,i.bindGroup),r.dispatchWorkgroups(...i.dispatchGroup),this.writeTimestamp(2*this.pendingDispatchNumber+1),this.pendingDispatchNumber++,"none"!==this.queryType&&this.pendingKernels.push(e[n]),(this.pendingDispatchNumber>=this.maxDispatchNumber||"at-passes"===this.queryType)&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onReleaseSession(t){this.unregisterBuffers(t),this.capturedCommandList.has(t)&&this.capturedCommandList.delete(t),this.capturedPendingKernels.has(t)&&this.capturedPendingKernels.delete(t),this.gpuDataManager.onReleaseSession(t)}onRunStart(t){this.currentSessionId=t,this.setQueryType()}}})),tsvb_vl={};tsvb_Kt(tsvb_vl,{init:()=>tsvb_nm});var tsvb_Vr,tsvb_Va,tsvb_nm,tsvb_$l=tsvb_q((()=>{tsvb_Ve(),tsvb_wl(),tsvb_Nt(),tsvb_xe(),tsvb_Vr=class t{constructor(t,e,r,n){this.module=t,this.dataType=e,this.data=r,this.dims=n}getFloat32Array(){if(1!==this.dataType)throw new Error("Invalid data type");let t=tsvb_ort_webgpu_min_N.size(this.dims);return 0===t?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(7!==this.dataType)throw new Error("Invalid data type");let t=tsvb_ort_webgpu_min_N.size(this.dims);return 0===t?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(6!==this.dataType)throw new Error("Invalid data type");let t=tsvb_ort_webgpu_min_N.size(this.dims);return 0===t?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}reshape(e){if(tsvb_ort_webgpu_min_N.size(e)!==tsvb_ort_webgpu_min_N.size(this.dims))throw new Error("Invalid new shape");return new t(this.module,this.dataType,this.data,e)}},tsvb_Va=class{constructor(t,e,r){this.module=t,this.backend=e,this.customDataOffset=0,this.customDataSize=0;let n=t.HEAPU32,i=r>>>2;this.opKernelContext=n[i++];let s=n[i++];this.outputCount=n[i++],this.customDataOffset=n[i++],this.customDataSize=n[i++];let o=[];for(let e=0;e<s;e++){let e=n[i++],r=n[i++],s=n[i++],a=[];for(let t=0;t<s;t++)a.push(n[i++]);o.push(new tsvb_Vr(t,e,r,a))}this.inputs=o}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(t,e){let r=e?.inputs?.map((t=>"number"==typeof t?this.inputs[t]:t))??this.inputs,n=e?.outputs??[];return this.backend.run(t,r,n,((t,e,r)=>new tsvb_Vr(this.module,e,this.output(t,r),r)),((t,e)=>{let r=tsvb_Dr(t);if(!r)throw new Error(`Unsupported data type: ${t}`);let n=r*tsvb_ort_webgpu_min_N.size(e);return new tsvb_Vr(this.module,t,this.backend.gpuDataManager.create(n).id,e)}))}output(t,e){let r=this.module.stackSave();try{let r=this.module.stackAlloc(4*(1+e.length)),n=r>>2;this.module.HEAPU32[n++]=e.length;for(let t=0;t<e.length;t++)this.module.HEAPU32[n++]=e[t];return this.module._JsepOutput(this.opKernelContext,t,r)}catch(r){throw new Error(`Failed to generate kernel's output[${t}] with dims [${e}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${r}`)}finally{this.module.stackRestore(r)}}},tsvb_nm=async(t,e,r)=>{let n=t.jsepInit;if(!n)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");let i=new tsvb_zn;await i.initialize(e,r),n(i,(t=>i.alloc(t)),(t=>i.free(t)),((e,r,n,s=!1)=>{if(s)tsvb_De("verbose",(()=>`[WebGPU] jsepCopyGpuToGpu: src=${e}, dst=${r}, size=${n}`)),i.memcpy(e,r);else{tsvb_De("verbose",(()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${e}, gpuDataId=${r}, size=${n}`));let s=t.HEAPU8.subarray(e>>>0,(e>>>0)+n);i.upload(r,s)}}),(async(e,r,n)=>{tsvb_De("verbose",(()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${e}, dataOffset=${r}, size=${n}`)),await i.download(e,(()=>t.HEAPU8.subarray(r>>>0,(r>>>0)+n)))}),((e,r,n)=>i.createKernel(e,r,n,t.UTF8ToString(t._JsepGetNodeName(r)))),(t=>i.releaseKernel(t)),((e,r,n,s)=>{tsvb_De("verbose",(()=>`[WebGPU] jsepRun: sessionHandle=${n}, kernel=${e}, contextDataOffset=${r}`));let o=new tsvb_Va(t,i,r);return i.computeKernel(e,o,s)}),(()=>i.captureBegin()),(()=>i.captureEnd()),(()=>i.replay()))}})),tsvb_am,tsvb_xl,tsvb_Sl,tsvb_Xt,tsvb_im,tsvb_Ga,tsvb_Il,tsvb_Cl,tsvb_om,src_tsvb_l,tsvb_Al,tsvb_Tl,tsvb_El,tsvb_Ol,tsvb_La,tsvb_kl=tsvb_q((()=>{tsvb_Ji(),tsvb_to(),tsvb_Ve(),tsvb_mr(),tsvb_fn(),tsvb_ha(),tsvb_am=(t,e)=>{0!==tsvb_Ne()._OrtInit(t,e)&&tsvb_Re("Can't initialize onnxruntime.")},tsvb_xl=async t=>{tsvb_am(t.wasm.numThreads,tsvb_Mr(t.logLevel))},tsvb_Sl=async(t,e)=>{if("webgpu"===e){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let e=await navigator.gpu.requestAdapter();if(!e)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.');if(!t.wasm.simd)throw new Error("Not supported for WebGPU=ON and SIMD=OFF. Please set `env.wasm.simd` to true when using `webgpu` EP");let r=(tsvb_$l(),tsvb_Rt(tsvb_vl)).init;await r(tsvb_Ne(),t,e)}},tsvb_Xt=new Map,tsvb_im=t=>{let e=tsvb_Ne(),r=e.stackSave();try{let r=e.stackAlloc(8);return 0!==e._OrtGetInputOutputCount(t,r,r+4)&&tsvb_Re("Can't get session input/output count."),[e.HEAP32[r/4],e.HEAP32[r/4+1]]}finally{e.stackRestore(r)}},tsvb_Ga=t=>{let e=tsvb_Ne(),r=e._malloc(t.byteLength);if(0===r)throw new Error(`Can't create a session. failed to allocate a buffer of size ${t.byteLength}.`);return e.HEAPU8.set(t,r),[r,t.byteLength]},tsvb_Il=async(t,e)=>{let r,n,i=tsvb_Ne();Array.isArray(t)?[r,n]=t:t.buffer===i.HEAPU8.buffer?[r,n]=[t.byteOffset,t.byteLength]:[r,n]=tsvb_Ga(t);let s=0,o=0,a=0,u=[],l=[],c=[];try{if([o,u]=tsvb_eo(e),e?.externalData&&i.mountExternalData){let t=[];for(let r of e.externalData){let e="string"==typeof r?r:r.path;t.push(tsvb_zr("string"==typeof r?r:r.data).then((t=>{i.mountExternalData(e,t)})))}await Promise.all(t)}s=i._OrtCreateSession(r,n,o),0===s&&tsvb_Re("Can't create a session.");let[t,h]=tsvb_im(s),f=!!e?.enableGraphCapture,d=[],p=[],v=[];for(let e=0;e<t;e++){let t=i._OrtGetInputName(s,e);0===t&&tsvb_Re("Can't get an input name."),l.push(t),d.push(i.UTF8ToString(t))}for(let t=0;t<h;t++){let r=i._OrtGetOutputName(s,t);0===r&&tsvb_Re("Can't get an output name."),c.push(r);let n=i.UTF8ToString(r);p.push(n);{if(f&&void 0===e?.preferredOutputLocation){v.push("gpu-buffer");continue}let t="string"==typeof e?.preferredOutputLocation?e.preferredOutputLocation:e?.preferredOutputLocation?.[n]??"cpu";if("cpu"!==t&&"cpu-pinned"!==t&&"gpu-buffer"!==t)throw new Error(`Not supported preferred output location: ${t}.`);if(f&&"gpu-buffer"!==t)throw new Error(`Not supported preferred output location: ${t}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);v.push(t)}}let y=null;return v.some((t=>"gpu-buffer"===t))&&(a=i._OrtCreateBinding(s),0===a&&tsvb_Re("Can't create IO binding."),y={handle:a,outputPreferredLocations:v,outputPreferredLocationsEncoded:v.map((t=>tsvb_fa(t)))}),tsvb_Xt.set(s,[s,l,c,y,f,!1]),[s,d,p]}catch(t){throw l.forEach((t=>i._OrtFree(t))),c.forEach((t=>i._OrtFree(t))),0!==a&&i._OrtReleaseBinding(a),0!==s&&i._OrtReleaseSession(s),t}finally{i._free(r),0!==o&&i._OrtReleaseSessionOptions(o),u.forEach((t=>i._free(t))),i.unmountExternalData?.()}},tsvb_Cl=t=>{let e=tsvb_Ne(),r=tsvb_Xt.get(t);if(!r)throw new Error(`cannot release session. invalid session id: ${t}`);let[n,i,s,o,a]=r;o&&(a&&e._OrtClearBoundOutputs(o.handle),e._OrtReleaseBinding(o.handle)),e.jsepOnReleaseSession?.(t),i.forEach((t=>e._OrtFree(t))),s.forEach((t=>e._OrtFree(t))),e._OrtReleaseSession(n),tsvb_Xt.delete(t)},tsvb_om=(t,e,r)=>{if(null!==t&&t[0]===e){let e=t[2];if(e.length===r)return e}return new(tsvb_hn(e))(r)},src_tsvb_l=(t,e,r,n,i,s=!1)=>{if(!t)return void e.push(0);let o,a,u=tsvb_Ne(),l=t[0],c=t[1],h=t[3];if("string"===l&&"gpu-buffer"===h)throw new Error("String tensor is not supported on GPU.");if(s&&"gpu-buffer"!==h)throw new Error(`External buffer must be provided for input/output index ${i} when enableGraphCapture is true.`);if("gpu-buffer"===h){let e=t[2].gpuBuffer,r=tsvb_Dr(tsvb_ma(l));a=c.reduce(((t,e)=>t*e),1)*r,o=u.jsepRegisterBuffer(n,i,e,a)}else{let e=t[2];if(Array.isArray(e)){a=4*e.length,o=u._malloc(a),r.push(o);let t=o/4;for(let n=0;n<e.length;n++){if("string"!=typeof e[n])throw new TypeError(`tensor data at index ${n} is not a string`);u.HEAPU32[t++]=tsvb_We(e[n],r)}}else a=e.byteLength,o=u._malloc(a),r.push(o),u.HEAPU8.set(new Uint8Array(e.buffer,e.byteOffset,a),o)}let f=u.stackSave(),d=u.stackAlloc(4*c.length);try{let t=d/4;c.forEach((e=>u.HEAP32[t++]=e));let r=u._OrtCreateTensor(tsvb_ma(l),o,a,d,c.length,tsvb_fa(h));0===r&&tsvb_Re(`Can't create tensor for input/output. session=${n}, index=${i}.`),e.push(r)}finally{u.stackRestore(f)}},tsvb_Al=t=>{let e=(new TextEncoder).encode(t),r=tsvb_Ne(),n=r._malloc(e.byteLength);r.HEAPU8.set(e,n);let i=r._OrtConfigure(n,e.byteLength);if(0===i)throw new Error("Can't get an configure key");let s=r.UTF8ToString(i);return r._OrtFree(i),s},tsvb_Tl=t=>{let e=(new TextEncoder).encode(t),r=tsvb_Ne(),n=r._malloc(e.byteLength);r.HEAPU8.set(e,n);let i=r._OrtAuth(n,e.byteLength);if(0===i)throw new Error("Can't get an auth result");let s=r.UTF8ToString(i);return r._OrtFree(i),s},tsvb_El=async(t,e,r,n,i,s)=>{let o=tsvb_Ne(),a=tsvb_Xt.get(t);if(!a)throw new Error(`cannot run inference. invalid session id: ${t}`);let u=a[0],l=a[1],c=a[2],h=a[3],f=a[4],d=a[5],p=e.length,v=n.length,y=0,b=[],_=[],m=[],g=[],w=o.stackSave(),x=o.stackAlloc(4*p),T=o.stackAlloc(4*p),S=o.stackAlloc(4*v),E=o.stackAlloc(4*v);try{[y,b]=tsvb_Xi(s);for(let n=0;n<p;n++)src_tsvb_l(r[n],_,g,t,e[n],f);for(let e=0;e<v;e++){let r=i[e];src_tsvb_l("gpu-buffer"===(r?.[3]??"")?r:null,m,g,t,p+n[e],f)}let a,w=x/4,O=T/4,P=S/4,A=E/4;for(let t=0;t<p;t++)o.HEAPU32[w++]=_[t],o.HEAPU32[O++]=l[e[t]];for(let t=0;t<v;t++)o.HEAPU32[P++]=m[t],o.HEAPU32[A++]=c[n[t]];if(h&&!d){let{handle:r,outputPreferredLocations:s,outputPreferredLocationsEncoded:a}=h;if(l.length!==p)throw new Error(`input count from feeds (${p}) is expected to be always equal to model's input count (${l.length}).`);for(let n=0;n<p;n++){let i=e[n];0!==await o._OrtBindInput(r,l[i],_[n])&&tsvb_Re(`Can't bind input[${n}] for session=${t}.`)}for(let e=0;e<v;e++){let u=n[e];i[e]?.[3]?0!==o._OrtBindOutput(r,c[u],m[e],0)&&tsvb_Re(`Can't bind pre-allocated output[${e}] for session=${t}.`):0!==o._OrtBindOutput(r,c[u],0,a[u])&&tsvb_Re(`Can't bind output[${e}] to ${s[e]} for session=${t}.`)}tsvb_Xt.set(t,[u,l,c,h,f,!0])}o.jsepOnRunStart?.(u),a=h?await o._OrtRunWithBinding(u,h.handle,v,S,y):await o._OrtRun(u,T,x,p,E,v,S,y),0!==a&&tsvb_Re("failed to call OrtRun().");let C=[];for(let t=0;t<v;t++){let e=o.HEAPU32[S/4+t];if(e===m[t]){C.push(i[t]);continue}let r,s=o.stackSave(),a=o.stackAlloc(16),u=!1,l=0;try{0!==o._OrtGetTensorData(e,a,a+4,a+8,a+12)&&tsvb_Re(`Can't access output tensor data on index ${t}.`);let s=a/4,c=o.HEAPU32[s++];l=o.HEAPU32[s++];let f=o.HEAPU32[s++],d=o.HEAPU32[s++],p=[];for(let t=0;t<d;t++)p.push(o.HEAPU32[f/4+t]);o._OrtFree(f);let v=p.reduce(((t,e)=>t*e),1);r=tsvb_ot(c);let y=h?.outputPreferredLocations[n[t]];if("string"===r){if("gpu-buffer"===y)throw new Error("String tensor is not supported on GPU.");let t=[],e=l/4;for(let r=0;r<v;r++){let n=o.HEAPU32[e++],i=r===v-1?void 0:o.HEAPU32[e]-n;t.push(o.UTF8ToString(n,i))}C.push([r,p,t,"cpu"])}else if("gpu-buffer"===y&&v>0){let t=o.jsepGetBuffer(l),n=tsvb_Dr(c);if(void 0===n||!tsvb_gn(r))throw new Error(`Unsupported data type: ${r}`);u=!0,C.push([r,p,{gpuBuffer:t,download:o.jsepCreateDownloader(t,v*n,r),dispose:()=>{o._OrtReleaseTensor(e)}},"gpu-buffer"])}else{let e=tsvb_om(i[t],r,v);new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(o.HEAPU8.subarray(l,l+e.byteLength)),C.push([r,p,e,"cpu"])}}finally{o.stackRestore(s),"string"===r&&l&&o._free(l),u||o._OrtReleaseTensor(e)}}return h&&!f&&(o._OrtClearBoundOutputs(h.handle),tsvb_Xt.set(t,[u,l,c,h,f,!1])),C}finally{o.stackRestore(w),_.forEach((t=>o._OrtReleaseTensor(t))),m.forEach((t=>o._OrtReleaseTensor(t))),g.forEach((t=>o._free(t))),0!==y&&o._OrtReleaseRunOptions(y),b.forEach((t=>o._free(t)))}},tsvb_Ol=t=>{let e=tsvb_Ne(),r=tsvb_Xt.get(t);if(!r)throw new Error("invalid session id");let n=r[0],i=e._OrtEndProfiling(n);0===i&&tsvb_Re("Can't get an profile file name."),e._OrtFree(i)},tsvb_La=t=>{let e=[];for(let r of t){let t=r[2];!Array.isArray(t)&&"buffer"in t&&e.push(t.buffer)}return e}})),tsvb_Bl=tsvb_cr(((t,e)=>{e.exports='/*!\n * ONNX Runtime Web v1.17.0\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n"use strict";(()=>{var In=Object.defineProperty;var rd=Object.getOwnPropertyDescriptor;var nd=Object.getOwnPropertyNames;var od=Object.prototype.hasOwnProperty;var q=(e,t)=>()=>(e&&(t=e(e=0)),t);var Sr=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),xr=(e,t)=>{for(var r in t)In(e,r,{get:t[r],enumerable:!0})},ad=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of nd(t))!od.call(e,n)&&n!==r&&In(e,n,{get:()=>t[n],enumerable:!(o=rd(t,n))||o.enumerable});return e};var Ot=e=>ad(In({},"__esModule",{value:!0}),e);var An={};xr(An,{createReadStream:()=>Mo,readFile:()=>id,readFileSync:()=>sd});var id,sd,Mo,Tn=q(()=>{id=void 0,sd=void 0,Mo=void 0});var En={};xr(En,{join:()=>ud});var ud,On=q(()=>{ud=void 0});var Pn={};xr(Pn,{crypto:()=>dd});var dd,Bn=q(()=>{dd=void 0});var Vo=Sr((zo,kn)=>{"use strict";var Uo=(()=>{var e=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(e=e||__filename),function(t={}){var r=t,o,n;r.ready=new Promise((d,m)=>{o=d,n=m}),r.mountExternalData=(d,m)=>{(r.Ka||(r.Ka=new Map)).set(d,m)},r.unmountExternalData=()=>{delete r.Ka},r.jsepInit=(d,m,b,S,P,N,L,X,pe,me,fe)=>{r.jb=d,r.Wa=m,r.$a=b,r.Qa=S,r.Za=P,r.Ba=N,r.ab=L,r.cb=X,r.Xa=pe,r.Ya=me,r.bb=fe,m=(ue,we,B)=>(...ae)=>{let ge=Je,Ze=we?.();ae=ue(...ae);let It=we?.();return Ze!==It&&(ue=It,B(Ze),we=B=null),Je!=ge?Dr():ae},b=ue=>async(...we)=>{try{if(r.Ja)throw Error("Session already started");let B=r.Ja={eb:we[0],errors:[]},ae=await ue(...we);if(r.Ja!==B)throw Error("Session mismatch");d.flush();let ge=B.errors;if(0<ge.length){let Ze=await Promise.all(ge);if(Ze=Ze.filter(It=>It),0<Ze.length)throw Error(Ze.join(`\n`))}return ae}finally{r.Ja=null}},r._OrtRun=b(m(r._OrtRun,()=>r._OrtRun,ue=>r._OrtRun=ue)),r._OrtRunWithBinding=b(m(r._OrtRunWithBinding,()=>r._OrtRunWithBinding,ue=>r._OrtRunWithBinding=ue)),r._OrtBindInput=m(r._OrtBindInput,()=>r._OrtBindInput,ue=>r._OrtBindInput=ue),r.jsepRegisterBuffer=(ue,we,B,ae)=>d.registerBuffer(ue,we,B,ae),r.jsepGetBuffer=ue=>d.getBuffer(ue),r.jsepCreateDownloader=(ue,we,B)=>d.createDownloader(ue,we,B),r.jsepOnReleaseSession=ue=>{d.onReleaseSession(ue)},r.jsepOnRunStart=ue=>d.onRunStart(ue)};var s=Object.assign({},r),u="./this.program",l=(d,m)=>{throw m},a=typeof window=="object",p=typeof importScripts=="function",h=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="",w,v,y;if(h){var _=(Tn(),Ot(An)),I=(On(),Ot(En));g=p?I.dirname(g)+"/":__dirname+"/",w=(d,m)=>(d=Ae(d)?new URL(d):I.normalize(d),_.readFileSync(d,m?void 0:"utf8")),y=d=>(d=w(d,!0),d.buffer||(d=new Uint8Array(d)),d),v=(d,m,b,S=!0)=>{d=Ae(d)?new URL(d):I.normalize(d),_.readFile(d,S?void 0:"utf8",(P,N)=>{P?b(P):m(S?N.buffer:N)})},!r.thisProgram&&1<process.argv.length&&(u=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),l=(d,m)=>{throw process.exitCode=d,m},r.inspect=()=>"[Emscripten Module object]"}else(a||p)&&(p?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),e&&(g=e),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",w=d=>{var m=new XMLHttpRequest;return m.open("GET",d,!1),m.send(null),m.responseText},p&&(y=d=>{var m=new XMLHttpRequest;return m.open("GET",d,!1),m.responseType="arraybuffer",m.send(null),new Uint8Array(m.response)}),v=(d,m,b)=>{var S=new XMLHttpRequest;S.open("GET",d,!0),S.responseType="arraybuffer",S.onload=()=>{S.status==200||S.status==0&&S.response?m(S.response):b()},S.onerror=b,S.send(null)});var x=console.log.bind(console),A=console.error.bind(console);Object.assign(r,s),s=null,typeof WebAssembly!="object"&&ie("no native wasm support detected");var O,C=!1,M,D,G,E,W,te,Y;function Z(){var d=O.buffer;r.HEAP8=D=new Int8Array(d),r.HEAP16=new Int16Array(d),r.HEAPU8=G=new Uint8Array(d),r.HEAPU16=new Uint16Array(d),r.HEAP32=E=new Int32Array(d),r.HEAPU32=W=new Uint32Array(d),r.HEAPF32=te=new Float32Array(d),r.HEAPF64=Y=new Float64Array(d)}var ee=[],Te=[],De=[],re=0,Ie=null,Oe=null;function ie(d){throw d="Aborted("+d+")",A(d),C=!0,M=1,d=new WebAssembly.RuntimeError(d+". Build with -sASSERTIONS for more info."),n(d),d}var Se=d=>d.startsWith("data:application/octet-stream;base64,"),Ae=d=>d.startsWith("file://"),Pe;if(Pe="ort-wasm-simd.wasm",!Se(Pe)){var Fe=Pe;Pe=r.locateFile?r.locateFile(Fe,g):g+Fe}function H(d){if(y)return y(d);throw"both async and sync fetching of the wasm failed"}function J(d){if(a||p){if(typeof fetch=="function"&&!Ae(d))return fetch(d,{credentials:"same-origin"}).then(m=>{if(!m.ok)throw"failed to load wasm binary file at \'"+d+"\'";return m.arrayBuffer()}).catch(()=>H(d));if(v)return new Promise((m,b)=>{v(d,S=>m(new Uint8Array(S)),b)})}return Promise.resolve().then(()=>H(d))}function Ce(d,m,b){return J(d).then(S=>WebAssembly.instantiate(S,m)).then(S=>S).then(b,S=>{A(`failed to asynchronously prepare wasm: ${S}`),ie(S)})}function $t(d,m){var b=Pe;return typeof WebAssembly.instantiateStreaming!="function"||Se(b)||Ae(b)||h||typeof fetch!="function"?Ce(b,d,m):fetch(b,{credentials:"same-origin"}).then(S=>WebAssembly.instantiateStreaming(S,d).then(m,function(P){return A(`wasm streaming compile failed: ${P}`),A("falling back to ArrayBuffer instantiation"),Ce(b,d,m)}))}var Me,tt={898320:(d,m,b,S)=>{if(typeof r>"u"||!r.Ka)return 1;if(d=Ke(d>>>0),d.startsWith("./")&&(d=d.substring(2)),d=r.Ka.get(d),!d)return 2;if(m>>>=0,b>>>=0,m+b>d.byteLength)return 3;try{return G.set(d.subarray(m,m+b),S>>>0>>>0),0}catch{return 4}},898821:()=>{r.Xa()},898852:()=>{r.Ya()},898881:()=>{r.bb()},898906:d=>r.Wa(d),898939:d=>r.$a(d),898971:(d,m,b)=>{r.Qa(d,m,b,!0)},899010:(d,m,b)=>{r.Qa(d,m,b)},899043:d=>{r.Ba("Abs",d,void 0)},899094:d=>{r.Ba("Neg",d,void 0)},899145:d=>{r.Ba("Floor",d,void 0)},899198:d=>{r.Ba("Ceil",d,void 0)},899250:d=>{r.Ba("Reciprocal",d,void 0)},899308:d=>{r.Ba("Sqrt",d,void 0)},899360:d=>{r.Ba("Exp",d,void 0)},899411:d=>{r.Ba("Erf",d,void 0)},899462:d=>{r.Ba("Sigmoid",d,void 0)},899517:d=>{r.Ba("Log",d,void 0)},899568:d=>{r.Ba("Sin",d,void 0)},899619:d=>{r.Ba("Cos",d,void 0)},899670:d=>{r.Ba("Tan",d,void 0)},899721:d=>{r.Ba("Asin",d,void 0)},899773:d=>{r.Ba("Acos",d,void 0)},899825:d=>{r.Ba("Atan",d,void 0)},899877:d=>{r.Ba("Sinh",d,void 0)},899929:d=>{r.Ba("Cosh",d,void 0)},899981:d=>{r.Ba("Asinh",d,void 0)},900034:d=>{r.Ba("Acosh",d,void 0)},900087:d=>{r.Ba("Atanh",d,void 0)},900140:d=>{r.Ba("Tanh",d,void 0)},900192:d=>{r.Ba("Not",d,void 0)},900243:(d,m,b)=>{r.Ba("Clip",d,{min:m,max:b})},900312:d=>{r.Ba("Clip",d,void 0)},900364:(d,m)=>{r.Ba("Elu",d,{alpha:m})},900422:d=>{r.Ba("Relu",d,void 0)},900474:(d,m)=>{r.Ba("LeakyRelu",d,{alpha:m})},900538:(d,m)=>{r.Ba("ThresholdedRelu",d,{alpha:m})},900608:(d,m)=>{r.Ba("Cast",d,{to:m})},900666:d=>{r.Ba("Add",d,void 0)},900717:d=>{r.Ba("Sub",d,void 0)},900768:d=>{r.Ba("Mul",d,void 0)},900819:d=>{r.Ba("Div",d,void 0)},900870:d=>{r.Ba("Pow",d,void 0)},900921:d=>{r.Ba("Equal",d,void 0)},900974:d=>{r.Ba("Greater",d,void 0)},901029:d=>{r.Ba("GreaterOrEqual",d,void 0)},901091:d=>{r.Ba("Less",d,void 0)},901143:d=>{r.Ba("LessOrEqual",d,void 0)},901202:(d,m,b,S,P)=>{r.Ba("ReduceMean",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},901361:(d,m,b,S,P)=>{r.Ba("ReduceMax",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},901519:(d,m,b,S,P)=>{r.Ba("ReduceMin",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},901677:(d,m,b,S,P)=>{r.Ba("ReduceProd",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},901836:(d,m,b,S,P)=>{r.Ba("ReduceSum",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},901994:(d,m,b,S,P)=>{r.Ba("ReduceL1",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},902151:(d,m,b,S,P)=>{r.Ba("ReduceL2",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},902308:(d,m,b,S,P)=>{r.Ba("ReduceLogSum",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},902469:(d,m,b,S,P)=>{r.Ba("ReduceSumSquare",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},902633:(d,m,b,S,P)=>{r.Ba("ReduceLogSumExp",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},902797:d=>{r.Ba("Where",d,void 0)},902850:(d,m,b)=>{r.Ba("Transpose",d,{perm:m?Array.from(E.subarray(m>>>0,b>>>0)):[]})},902958:(d,m,b,S,P,N,L,X,pe,me,fe,ue,we,B,ae)=>{r.Ba("ConvTranspose",d,{format:pe?"NHWC":"NCHW",autoPad:m,dilations:[b],group:S,kernel_shape:[P],pads:[N,L],strides:[X],wIsConst:()=>!!D[me>>>0],outputPadding:fe?Array.from(E.subarray(fe>>>0,ue>>>0)):[],outputShape:we?Array.from(E.subarray(we>>>0,B>>>0)):[],activation:Ke(ae)})},903360:(d,m,b,S,P,N,L,X,pe,me,fe,ue,we,B)=>{r.Ba("ConvTranspose",d,{format:X?"NHWC":"NCHW",autoPad:m,dilations:Array.from(E.subarray(b>>>0,(b>>>0)+2>>>0)),group:S,kernelShape:Array.from(E.subarray(P>>>0,(P>>>0)+2>>>0)),pads:Array.from(E.subarray(N>>>0,(N>>>0)+4>>>0)),strides:Array.from(E.subarray(L>>>0,(L>>>0)+2>>>0)),wIsConst:()=>!!D[pe>>>0],outputPadding:me?Array.from(E.subarray(me>>>0,fe>>>0)):[],outputShape:ue?Array.from(E.subarray(ue>>>0,we>>>0)):[],activation:Ke(B)})},903925:(d,m,b,S,P,N,L,X,pe,me,fe,ue,we,B,ae)=>{r.Ba("ConvTranspose",d,{format:pe?"NHWC":"NCHW",autoPad:m,dilations:[b],group:S,kernel_shape:[P],pads:[N,L],strides:[X],wIsConst:()=>!!D[me>>>0],outputPadding:fe?Array.from(E.subarray(fe>>>0,ue>>>0)):[],outputShape:we?Array.from(E.subarray(we>>>0,B>>>0)):[],activation:Ke(ae)})},904327:(d,m,b,S,P,N,L,X,pe,me,fe,ue,we,B)=>{r.Ba("ConvTranspose",d,{format:X?"NHWC":"NCHW",autoPad:m,dilations:Array.from(E.subarray(b>>>0,(b>>>0)+2>>>0)),group:S,kernelShape:Array.from(E.subarray(P>>>0,(P>>>0)+2>>>0)),pads:Array.from(E.subarray(N>>>0,(N>>>0)+4>>>0)),strides:Array.from(E.subarray(L>>>0,(L>>>0)+2>>>0)),wIsConst:()=>!!D[pe>>>0],outputPadding:me?Array.from(E.subarray(me>>>0,fe>>>0)):[],outputShape:ue?Array.from(E.subarray(ue>>>0,we>>>0)):[],activation:Ke(B)})},904892:(d,m)=>{r.Ba("GlobalAveragePool",d,{format:m?"NHWC":"NCHW"})},904983:(d,m,b,S,P,N,L,X,pe,me,fe,ue,we,B,ae,ge)=>{r.Ba("AveragePool",d,{format:ge?"NHWC":"NCHW",auto_pad:m,ceil_mode:b,count_include_pad:S,storage_order:P,dilations:[N,L],kernel_shape:[X,pe],pads:[me,fe,ue,we],strides:[B,ae]})},905267:(d,m)=>{r.Ba("GlobalAveragePool",d,{format:m?"NHWC":"NCHW"})},905358:(d,m,b,S,P,N,L,X,pe,me,fe,ue,we,B,ae,ge)=>{r.Ba("AveragePool",d,{format:ge?"NHWC":"NCHW",auto_pad:m,ceil_mode:b,count_include_pad:S,storage_order:P,dilations:[N,L],kernel_shape:[X,pe],pads:[me,fe,ue,we],strides:[B,ae]})},905642:(d,m)=>{r.Ba("GlobalMaxPool",d,{format:m?"NHWC":"NCHW"})},905729:(d,m,b,S,P,N,L,X,pe,me,fe,ue,we,B,ae,ge)=>{r.Ba("MaxPool",d,{format:ge?"NHWC":"NCHW",auto_pad:m,ceil_mode:b,count_include_pad:S,storage_order:P,dilations:[N,L],kernel_shape:[X,pe],pads:[me,fe,ue,we],strides:[B,ae]})},906009:(d,m)=>{r.Ba("GlobalMaxPool",d,{format:m?"NHWC":"NCHW"})},906096:(d,m,b,S,P,N,L,X,pe,me,fe,ue,we,B,ae,ge)=>{r.Ba("MaxPool",d,{format:ge?"NHWC":"NCHW",auto_pad:m,ceil_mode:b,count_include_pad:S,storage_order:P,dilations:[N,L],kernel_shape:[X,pe],pads:[me,fe,ue,we],strides:[B,ae]})},906376:(d,m,b,S,P)=>{r.Ba("Gemm",d,{alpha:m,beta:b,transA:S,transB:P})},906480:d=>{r.Ba("MatMul",d,void 0)},906534:(d,m,b,S)=>{r.Ba("ArgMax",d,{keepDims:!!m,selectLastIndex:!!b,axis:S})},906642:(d,m,b,S)=>{r.Ba("ArgMin",d,{keepDims:!!m,selectLastIndex:!!b,axis:S})},906750:(d,m)=>{r.Ba("Softmax",d,{axis:m})},906813:(d,m)=>{r.Ba("Concat",d,{axis:m})},906873:(d,m,b,S,P)=>{r.Ba("Split",d,{axis:m,numOutputs:b,splitSizes:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},907013:d=>{r.Ba("Expand",d,void 0)},907067:(d,m)=>{r.Ba("Gather",d,{axis:Number(m)})},907138:(d,m)=>{r.Ba("GatherElements",d,{axis:Number(m)})},907217:(d,m,b,S,P,N,L,X,pe,me,fe)=>{r.Ba("Resize",d,{antialias:m,axes:b?Array.from(E.subarray(b>>>0,S>>>0)):[],coordinateTransformMode:Ke(P),cubicCoeffA:N,excludeOutside:L,extrapolationValue:X,keepAspectRatioPolicy:Ke(pe),mode:Ke(me),nearestMode:Ke(fe)})},907563:(d,m,b,S,P,N,L)=>{r.Ba("Slice",d,{starts:m?Array.from(E.subarray(m>>>0,b>>>0)):[],ends:S?Array.from(E.subarray(S>>>0,P>>>0)):[],axes:N?Array.from(E.subarray(N>>>0,L>>>0)):[]})},907779:d=>{r.Ba("Tile",d,void 0)},907831:(d,m,b)=>{r.Ba("LayerNormalization",d,{axis:Number(m),epsilon:Number(b)})},907938:(d,m,b)=>{r.Ba("InstanceNormalization",d,{epsilon:m,format:b?"NHWC":"NCHW"})},908052:(d,m,b)=>{r.Ba("InstanceNormalization",d,{epsilon:m,format:b?"NHWC":"NCHW"})},908166:d=>{r.Ba("Range",d,void 0)},908219:(d,m)=>{r.Ba("Einsum",d,{equation:Ke(m)})},908300:(d,m,b,S,P)=>{r.Ba("Pad",d,{mode:m,value:b,pads:S?Array.from(E.subarray(S>>>0,P>>>0)):[]})},908427:(d,m,b,S,P,N)=>{r.Ba("BatchNormalization",d,{epsilon:m,momentum:b,spatial:!!P,trainingMode:!!S,format:N?"NHWC":"NCHW"})},908596:(d,m,b,S,P,N)=>{r.Ba("BatchNormalization",d,{epsilon:m,momentum:b,spatial:!!P,trainingMode:!!S,format:N?"NHWC":"NCHW"})},908765:(d,m,b)=>{r.Ba("CumSum",d,{exclusive:Number(m),reverse:Number(b)})},908862:(d,m,b,S,P,N,L,X,pe)=>{r.Ba("Attention",d,{numHeads:m,isUnidirectional:b,maskFilterValue:S,scale:P,doRotary:N,qkvHiddenSizes:L?Array.from(E.subarray(Number(X)>>>0,Number(X)+L>>>0)):[],pastPresentShareBuffer:!!pe})},909134:d=>{r.Ba("Gelu",d,void 0)},909186:(d,m,b,S,P,N)=>{r.Ba("MultiHeadAttention",d,{numHeads:m,isUnidirectional:b,maskFilterValue:S,scale:P,doRotary:N})},909345:d=>{r.Ba("BiasAdd",d,void 0)},909400:d=>{r.Ba("BiasSplitGelu",d,void 0)},909461:(d,m)=>{r.Ba("SkipLayerNormalization",d,{epsilon:m})},909542:(d,m,b,S,P,N,L,X,pe,me,fe,ue,we)=>{r.Ba("Conv",d,{format:pe?"NHWC":"NCHW",auto_pad:m,dilations:[b],group:S,kernel_shape:[P],pads:N?Array.from(E.subarray(N>>>0,L>>>0)):[],strides:[X],w_is_const:()=>!!D[me>>>0],activation:Ke(fe),activation_params:ue?Array.from(te.subarray(ue>>>0,we>>>0)):[]})},909912:(d,m,b,S,P,N,L,X,pe,me,fe,ue,we,B,ae,ge)=>{r.Ba("Conv",d,{format:ue?"NHWC":"NCHW",auto_pad:m,dilations:[b,S],group:P,kernel_shape:[N,L],pads:X?Array.from(E.subarray(X>>>0,pe>>>0)):[],strides:[me,fe],w_is_const:()=>!!D[we>>>0],activation:Ke(B),activation_params:ae?Array.from(te.subarray(ae>>>0,ge>>>0)):[]})},910303:d=>{r.ab(d)},910337:(d,m)=>r.cb(d,m,r.Ja.eb,r.Ja.errors)};function at(d){this.name="ExitStatus",this.message=`Program terminated with exit(${d})`,this.status=d}function Ne(d){this.Na=d-24,this.Ua=function(m){W[this.Na+4>>>2>>>0]=m},this.Ta=function(m){W[this.Na+8>>>2>>>0]=m},this.Ra=function(m,b){this.Sa(),this.Ua(m),this.Ta(b)},this.Sa=function(){W[this.Na+16>>>2>>>0]=0}}var je=0,At=0,lt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,ct=(d,m,b)=>{m>>>=0;var S=m+b;for(b=m;d[b]&&!(b>=S);)++b;if(16<b-m&&d.buffer&&lt)return lt.decode(d.subarray(m,b));for(S="";m<b;){var P=d[m++];if(P&128){var N=d[m++]&63;if((P&224)==192)S+=String.fromCharCode((P&31)<<6|N);else{var L=d[m++]&63;P=(P&240)==224?(P&15)<<12|N<<6|L:(P&7)<<18|N<<12|L<<6|d[m++]&63,65536>P?S+=String.fromCharCode(P):(P-=65536,S+=String.fromCharCode(55296|P>>10,56320|P&1023))}}else S+=String.fromCharCode(P)}return S},Ke=(d,m)=>(d>>>=0)?ct(G,d,m):"",ar=d=>{for(var m=0,b=0;b<d.length;++b){var S=d.charCodeAt(b);127>=S?m++:2047>=S?m+=2:55296<=S&&57343>=S?(m+=4,++b):m+=3}return m},Ht=(d,m,b,S)=>{if(b>>>=0,!(0<S))return 0;var P=b;S=b+S-1;for(var N=0;N<d.length;++N){var L=d.charCodeAt(N);if(55296<=L&&57343>=L){var X=d.charCodeAt(++N);L=65536+((L&1023)<<10)|X&1023}if(127>=L){if(b>=S)break;m[b++>>>0]=L}else{if(2047>=L){if(b+1>=S)break;m[b++>>>0]=192|L>>6}else{if(65535>=L){if(b+2>=S)break;m[b++>>>0]=224|L>>12}else{if(b+3>=S)break;m[b++>>>0]=240|L>>18,m[b++>>>0]=128|L>>12&63}m[b++>>>0]=128|L>>6&63}m[b++>>>0]=128|L&63}}return m[b>>>0]=0,b-P},Tt=d=>d%4===0&&(d%100!==0||d%400===0),St=[0,31,60,91,121,152,182,213,244,274,305,335],Lt=[0,31,59,90,120,151,181,212,243,273,304,334],Ft=d=>{var m=ar(d)+1,b=Zt(m);return b&&Ht(d,G,b,m),b},kt=[],ir=(d,m)=>{kt.length=0;for(var b;b=G[d++>>>0];){var S=b!=105;S&=b!=112,m+=S&&m%8?4:0,kt.push(b==112?W[m>>>2>>>0]:b==105?E[m>>>2>>>0]:Y[m>>>3>>>0]),m+=S?8:4}return kt},it={},sr=()=>{if(!Kt){var d={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:u||"./this.program"},m;for(m in it)it[m]===void 0?delete d[m]:d[m]=it[m];var b=[];for(m in d)b.push(`${m}=${d[m]}`);Kt=b}return Kt},Kt,Ye=[null,[],[]],bn=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return b=>crypto.getRandomValues(b);if(h)try{var d=(Bn(),Ot(Pn));if(d.randomFillSync)return b=>d.randomFillSync(b);var m=d.randomBytes;return b=>(b.set(m(b.byteLength)),b)}catch{}ie("initRandomDevice")},Be=d=>(Be=bn())(d),ur=[31,29,31,30,31,30,31,31,30,31,30,31],qt=[31,28,31,30,31,30,31,31,30,31,30,31];function dr(d){var m=Array(ar(d)+1);return Ht(d,m,0,m.length),m}function Pr(d,m,b,S){function P(B,ae,ge){for(B=typeof B=="number"?B.toString():B||"";B.length<ae;)B=ge[0]+B;return B}function N(B,ae){return P(B,ae,"0")}function L(B,ae){function ge(It){return 0>It?-1:0<It?1:0}var Ze;return(Ze=ge(B.getFullYear()-ae.getFullYear()))===0&&(Ze=ge(B.getMonth()-ae.getMonth()))===0&&(Ze=ge(B.getDate()-ae.getDate())),Ze}function X(B){switch(B.getDay()){case 0:return new Date(B.getFullYear()-1,11,29);case 1:return B;case 2:return new Date(B.getFullYear(),0,3);case 3:return new Date(B.getFullYear(),0,2);case 4:return new Date(B.getFullYear(),0,1);case 5:return new Date(B.getFullYear()-1,11,31);case 6:return new Date(B.getFullYear()-1,11,30)}}function pe(B){var ae=B.Ha;for(B=new Date(new Date(B.Ia+1900,0,1).getTime());0<ae;){var ge=B.getMonth(),Ze=(Tt(B.getFullYear())?ur:qt)[ge];if(ae>Ze-B.getDate())ae-=Ze-B.getDate()+1,B.setDate(1),11>ge?B.setMonth(ge+1):(B.setMonth(0),B.setFullYear(B.getFullYear()+1));else{B.setDate(B.getDate()+ae);break}}return ge=new Date(B.getFullYear()+1,0,4),ae=X(new Date(B.getFullYear(),0,4)),ge=X(ge),0>=L(ae,B)?0>=L(ge,B)?B.getFullYear()+1:B.getFullYear():B.getFullYear()-1}d>>>=0,m>>>=0,b>>>=0,S>>>=0;var me=W[S+40>>>2>>>0];S={hb:E[S>>>2>>>0],gb:E[S+4>>>2>>>0],La:E[S+8>>>2>>>0],Pa:E[S+12>>>2>>>0],Ma:E[S+16>>>2>>>0],Ia:E[S+20>>>2>>>0],Ga:E[S+24>>>2>>>0],Ha:E[S+28>>>2>>>0],kb:E[S+32>>>2>>>0],fb:E[S+36>>>2>>>0],ib:me?Ke(me):""},b=Ke(b),me={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var fe in me)b=b.replace(new RegExp(fe,"g"),me[fe]);var ue="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),we="January February March April May June July August September October November December".split(" ");me={"%a":B=>ue[B.Ga].substring(0,3),"%A":B=>ue[B.Ga],"%b":B=>we[B.Ma].substring(0,3),"%B":B=>we[B.Ma],"%C":B=>N((B.Ia+1900)/100|0,2),"%d":B=>N(B.Pa,2),"%e":B=>P(B.Pa,2," "),"%g":B=>pe(B).toString().substring(2),"%G":B=>pe(B),"%H":B=>N(B.La,2),"%I":B=>(B=B.La,B==0?B=12:12<B&&(B-=12),N(B,2)),"%j":B=>{for(var ae=0,ge=0;ge<=B.Ma-1;ae+=(Tt(B.Ia+1900)?ur:qt)[ge++]);return N(B.Pa+ae,3)},"%m":B=>N(B.Ma+1,2),"%M":B=>N(B.gb,2),"%n":()=>`\n`,"%p":B=>0<=B.La&&12>B.La?"AM":"PM","%S":B=>N(B.hb,2),"%t":()=>"\t","%u":B=>B.Ga||7,"%U":B=>N(Math.floor((B.Ha+7-B.Ga)/7),2),"%V":B=>{var ae=Math.floor((B.Ha+7-(B.Ga+6)%7)/7);if(2>=(B.Ga+371-B.Ha-2)%7&&ae++,ae)ae==53&&(ge=(B.Ga+371-B.Ha)%7,ge==4||ge==3&&Tt(B.Ia)||(ae=1));else{ae=52;var ge=(B.Ga+7-B.Ha-1)%7;(ge==4||ge==5&&Tt(B.Ia%400-1))&&ae++}return N(ae,2)},"%w":B=>B.Ga,"%W":B=>N(Math.floor((B.Ha+7-(B.Ga+6)%7)/7),2),"%y":B=>(B.Ia+1900).toString().substring(2),"%Y":B=>B.Ia+1900,"%z":B=>{B=B.fb;var ae=0<=B;return B=Math.abs(B)/60,(ae?"+":"-")+("0000"+(B/60*100+B%60)).slice(-4)},"%Z":B=>B.ib,"%%":()=>"%"},b=b.replace(/%%/g,"\\0\\0");for(fe in me)b.includes(fe)&&(b=b.replace(new RegExp(fe,"g"),me[fe](S)));return b=b.replace(/\\0\\0/g,"%"),fe=dr(b),fe.length>m?0:(D.set(fe,d>>>0),fe.length-1)}var Rt=d=>{try{d()}catch(m){ie(m)}};function wn(){var d=oe,m={};for(let[b,S]of Object.entries(d))m[b]=typeof S=="function"?function(){jt.push(b);try{return S.apply(null,arguments)}finally{C||(jt.pop(),Je&&ne===1&&jt.length===0&&(ne=0,Rt(Ct),typeof Fibers<"u"&&Fibers.lb()))}}:S;return m}var ne=0,Je=null,lr=0,jt=[],cr={},Br={},kr=0,Yt=null,Rr=[];function Dr(){return new Promise((d,m)=>{Yt={resolve:d,reject:m}})}function pr(){var d=Zt(65548),m=d+12;W[d>>>2>>>0]=m,W[d+4>>>2>>>0]=m+65536,m=jt[0];var b=cr[m];return b===void 0&&(b=kr++,cr[m]=b,Br[b]=m),E[d+8>>>2>>>0]=b,d}function Mr(d){if(!C){if(ne===0){var m=!1,b=!1;d((S=0)=>{if(!C&&(lr=S,m=!0,b)){ne=2,Rt(()=>wr(Je)),typeof Browser<"u"&&Browser.Oa.Va&&Browser.Oa.resume(),S=!1;try{var P=(0,oe[Br[E[Je+8>>>2>>>0]]])()}catch(X){P=X,S=!0}var N=!1;if(!Je){var L=Yt;L&&(Yt=null,(S?L.reject:L.resolve)(P),N=!0)}if(S&&!N)throw P}}),b=!0,m||(ne=1,Je=pr(),typeof Browser<"u"&&Browser.Oa.Va&&Browser.Oa.pause(),Rt(()=>Jt(Je)))}else ne===2?(ne=0,Rt(vr),gr(Je),Je=null,Rr.forEach(S=>{if(!C)try{S();try{M=M=S=M,r.onExit?.(S),C=!0,l(S,new at(S))}catch(P){P instanceof at||P=="unwind"||l(1,P)}}catch(P){P instanceof at||P=="unwind"||l(1,P)}})):ie(`invalid state: ${ne}`);return lr}}function Ur(d){return Mr(m=>{d().then(m)})}var xt=[],rt,_t,mr=[],fr=(d,m)=>{if(!_t){_t=new WeakMap;var b=rt.length;if(_t)for(var S=0;S<0+b;S++){var P=S,N=xt[P];N||(P>=xt.length&&(xt.length=P+1),xt[P]=N=rt.get(P)),(P=N)&&_t.set(P,S)}}if(b=_t.get(d)||0)return b;if(mr.length)b=mr.pop();else{try{rt.grow(1)}catch(X){throw X instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":X}b=rt.length-1}try{S=b,rt.set(S,d),xt[S]=rt.get(S)}catch(X){if(!(X instanceof TypeError))throw X;if(typeof WebAssembly.Function=="function"){S=WebAssembly.Function,P={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},N={parameters:[],results:m[0]=="v"?[]:[P[m[0]]]};for(var L=1;L<m.length;++L)N.parameters.push(P[m[L]]);m=new S(N,d)}else{for(S=[1],P=m.slice(0,1),m=m.slice(1),N={i:127,p:127,j:126,f:125,d:124,e:111},S.push(96),L=m.length,128>L?S.push(L):S.push(L%128|128,L>>7),L=0;L<m.length;++L)S.push(N[m[L]]);P=="v"?S.push(0):S.push(1,N[P]),m=[0,97,115,109,1,0,0,0,1],P=S.length,128>P?m.push(P):m.push(P%128|128,P>>7),m.push.apply(m,S),m.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),m=new WebAssembly.Module(new Uint8Array(m)),m=new WebAssembly.Instance(m,{e:{f:d}}).exports.f}S=b,rt.set(S,m),xt[S]=rt.get(S)}return _t.set(d,b),b},zr={n:function(d,m,b){return Ur(async()=>{await r.Za(d,m,b)})},a:function(d,m,b){throw d>>>=0,new Ne(d).Ra(m>>>0,b>>>0),je=d,At++,je},g:function(){return 0},M:function(){},C:function(){},E:function(){},v:function(){return 0},K:function(){},F:function(){},J:function(){},m:function(){},D:function(){},A:function(){},L:function(){},B:function(){},N:()=>1,q:function(d,m,b){d=m+2097152>>>0<4194305-!!d?(d>>>0)+4294967296*m:NaN,b>>>=0,d=new Date(1e3*d),E[b>>>2>>>0]=d.getUTCSeconds(),E[b+4>>>2>>>0]=d.getUTCMinutes(),E[b+8>>>2>>>0]=d.getUTCHours(),E[b+12>>>2>>>0]=d.getUTCDate(),E[b+16>>>2>>>0]=d.getUTCMonth(),E[b+20>>>2>>>0]=d.getUTCFullYear()-1900,E[b+24>>>2>>>0]=d.getUTCDay(),E[b+28>>>2>>>0]=(d.getTime()-Date.UTC(d.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},r:function(d,m,b){d=m+2097152>>>0<4194305-!!d?(d>>>0)+4294967296*m:NaN,b>>>=0,d=new Date(1e3*d),E[b>>>2>>>0]=d.getSeconds(),E[b+4>>>2>>>0]=d.getMinutes(),E[b+8>>>2>>>0]=d.getHours(),E[b+12>>>2>>>0]=d.getDate(),E[b+16>>>2>>>0]=d.getMonth(),E[b+20>>>2>>>0]=d.getFullYear()-1900,E[b+24>>>2>>>0]=d.getDay(),E[b+28>>>2>>>0]=(Tt(d.getFullYear())?St:Lt)[d.getMonth()]+d.getDate()-1|0,E[b+36>>>2>>>0]=-(60*d.getTimezoneOffset()),m=new Date(d.getFullYear(),6,1).getTimezoneOffset();var S=new Date(d.getFullYear(),0,1).getTimezoneOffset();E[b+32>>>2>>>0]=(m!=S&&d.getTimezoneOffset()==Math.min(S,m))|0},s:function(d){d>>>=0;var m=new Date(E[d+20>>>2>>>0]+1900,E[d+16>>>2>>>0],E[d+12>>>2>>>0],E[d+8>>>2>>>0],E[d+4>>>2>>>0],E[d>>>2>>>0],0),b=E[d+32>>>2>>>0],S=m.getTimezoneOffset(),P=new Date(m.getFullYear(),6,1).getTimezoneOffset(),N=new Date(m.getFullYear(),0,1).getTimezoneOffset(),L=Math.min(N,P);return 0>b?E[d+32>>>2>>>0]=+(P!=N&&L==S):0<b!=(L==S)&&(P=Math.max(N,P),m.setTime(m.getTime()+6e4*((0<b?L:P)-S))),E[d+24>>>2>>>0]=m.getDay(),E[d+28>>>2>>>0]=(Tt(m.getFullYear())?St:Lt)[m.getMonth()]+m.getDate()-1|0,E[d>>>2>>>0]=m.getSeconds(),E[d+4>>>2>>>0]=m.getMinutes(),E[d+8>>>2>>>0]=m.getHours(),E[d+12>>>2>>>0]=m.getDate(),E[d+16>>>2>>>0]=m.getMonth(),E[d+20>>>2>>>0]=m.getYear(),d=m.getTime(),isNaN(d)?(E[hr()>>>2>>>0]=61,d=-1):d/=1e3,yr((Me=d,1<=+Math.abs(Me)?0<Me?+Math.floor(Me/4294967296)>>>0:~~+Math.ceil((Me-+(~~Me>>>0))/4294967296)>>>0:0)),d>>>0},o:function(){return-52},p:function(){},y:function(d,m,b){function S(pe){return(pe=pe.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?pe[1]:"GMT"}b>>>=0;var P=new Date().getFullYear(),N=new Date(P,0,1),L=new Date(P,6,1);P=N.getTimezoneOffset();var X=L.getTimezoneOffset();W[d>>>0>>>2>>>0]=60*Math.max(P,X),E[m>>>0>>>2>>>0]=+(P!=X),d=S(N),m=S(L),d=Ft(d),m=Ft(m),X<P?(W[b>>>2>>>0]=d,W[b+4>>>2>>>0]=m):(W[b>>>2>>>0]=m,W[b+4>>>2>>>0]=d)},e:()=>{ie("")},b:function(d,m,b){return d>>>=0,m=ir(m>>>0,b>>>0),tt[d].apply(null,m)},j:function(d,m,b){return d>>>=0,m=ir(m>>>0,b>>>0),tt[d].apply(null,m)},h:()=>Date.now(),z:function(){return 4294901760},c:()=>performance.now(),I:function(d,m,b){return m>>>=0,G.copyWithin(d>>>0>>>0,m>>>0,m+(b>>>0)>>>0)},w:function(d){d>>>=0;var m=G.length;if(4294901760<d)return!1;for(var b=1;4>=b;b*=2){var S=m*(1+.2/b);S=Math.min(S,d+100663296);var P=Math;S=Math.max(d,S);e:{P=(P.min.call(P,4294901760,S+(65536-S%65536)%65536)-O.buffer.byteLength+65535)/65536;try{O.grow(P),Z();var N=1;break e}catch{}N=void 0}if(N)return!0}return!1},G:function(d,m){d>>>=0,m>>>=0;var b=0;return sr().forEach((S,P)=>{var N=m+b;for(P=W[d+4*P>>>2>>>0]=N,N=0;N<S.length;++N)D[P++>>>0>>>0]=S.charCodeAt(N);D[P>>>0>>>0]=0,b+=S.length+1}),0},H:function(d,m){d>>>=0,m>>>=0;var b=sr();W[d>>>2>>>0]=b.length;var S=0;return b.forEach(P=>S+=P.length+1),W[m>>>2>>>0]=S,0},f:()=>52,l:function(){return 52},t:function(){return 70},k:function(d,m,b,S){m>>>=0,b>>>=0,S>>>=0;for(var P=0,N=0;N<b;N++){var L=W[m>>>2>>>0],X=W[m+4>>>2>>>0];m+=8;for(var pe=0;pe<X;pe++){var me=G[L+pe>>>0],fe=Ye[d];me===0||me===10?((d===1?x:A)(ct(fe,0)),fe.length=0):fe.push(me)}P+=X}return W[S>>>2>>>0]=P,0},u:function(d,m){return d>>>=0,Be(G.subarray(d>>>0,d+(m>>>0)>>>0)),0},x:Pr,d:function(d,m,b,S){return Pr(d>>>0,m>>>0,b>>>0,S>>>0)},i:function(d,m,b,S){let P=rt.length;d=new Uint8Array(G.slice(d+m,d+b));try{var N=new WebAssembly.Module(d),L=new WebAssembly.Instance(N,{env:{memory:O}}),X;for(X in L.exports)fr(L.exports[X]);return P<rt.length?P:S}catch(pe){return console.log(pe),S}}},oe=function(){function d(b){return oe=b.exports,oe=wn(),oe=Vr(),O=oe.O,Z(),rt=oe.wa,Te.unshift(oe.P),re--,re==0&&(Ie!==null&&(clearInterval(Ie),Ie=null),Oe&&(b=Oe,Oe=null,b())),oe}var m={a:zr};if(re++,r.instantiateWasm)try{return r.instantiateWasm(m,d)}catch(b){A(`Module.instantiateWasm callback failed with error: ${b}`),n(b)}return $t(m,function(b){d(b.instance)}).catch(n),{}}();r._OrtInit=(d,m)=>(r._OrtInit=oe.Q)(d,m),r._OrtGetLastError=(d,m)=>(r._OrtGetLastError=oe.R)(d,m),r._OrtCreateSessionOptions=(d,m,b,S,P,N,L,X,pe,me)=>(r._OrtCreateSessionOptions=oe.S)(d,m,b,S,P,N,L,X,pe,me),r._OrtAppendExecutionProvider=(d,m)=>(r._OrtAppendExecutionProvider=oe.T)(d,m),r._OrtAddFreeDimensionOverride=(d,m,b)=>(r._OrtAddFreeDimensionOverride=oe.U)(d,m,b),r._OrtAddSessionConfigEntry=(d,m,b)=>(r._OrtAddSessionConfigEntry=oe.V)(d,m,b),r._OrtReleaseSessionOptions=d=>(r._OrtReleaseSessionOptions=oe.W)(d),r._OrtCreateSession=(d,m,b)=>(r._OrtCreateSession=oe.X)(d,m,b),r._OrtReleaseSession=d=>(r._OrtReleaseSession=oe.Y)(d),r._OrtGetInputOutputCount=(d,m,b)=>(r._OrtGetInputOutputCount=oe.Z)(d,m,b),r._OrtGetInputName=(d,m)=>(r._OrtGetInputName=oe._)(d,m),r._OrtGetOutputName=(d,m)=>(r._OrtGetOutputName=oe.$)(d,m),r._OrtFree=d=>(r._OrtFree=oe.aa)(d),r._OrtCreateTensor=(d,m,b,S,P,N)=>(r._OrtCreateTensor=oe.ba)(d,m,b,S,P,N),r._OrtGetTensorData=(d,m,b,S,P)=>(r._OrtGetTensorData=oe.ca)(d,m,b,S,P),r._OrtReleaseTensor=d=>(r._OrtReleaseTensor=oe.da)(d),r._OrtCreateRunOptions=(d,m,b,S)=>(r._OrtCreateRunOptions=oe.ea)(d,m,b,S),r._OrtAddRunConfigEntry=(d,m,b)=>(r._OrtAddRunConfigEntry=oe.fa)(d,m,b),r._OrtReleaseRunOptions=d=>(r._OrtReleaseRunOptions=oe.ga)(d),r._OrtCreateBinding=d=>(r._OrtCreateBinding=oe.ha)(d),r._OrtBindInput=(d,m,b)=>(r._OrtBindInput=oe.ia)(d,m,b),r._OrtBindOutput=(d,m,b,S)=>(r._OrtBindOutput=oe.ja)(d,m,b,S),r._OrtClearBoundOutputs=d=>(r._OrtClearBoundOutputs=oe.ka)(d),r._OrtReleaseBinding=d=>(r._OrtReleaseBinding=oe.la)(d),r._OrtRunWithBinding=(d,m,b,S,P)=>(r._OrtRunWithBinding=oe.ma)(d,m,b,S,P),r._OrtRun=(d,m,b,S,P,N,L,X)=>(r._OrtRun=oe.na)(d,m,b,S,P,N,L,X),r._OrtEndProfiling=d=>(r._OrtEndProfiling=oe.oa)(d),r._OrtConfigure=(d,m)=>(r._OrtConfigure=oe.pa)(d,m),r._OrtAuth=(d,m)=>(r._OrtAuth=oe.qa)(d,m),r._JsepOutput=(d,m,b)=>(r._JsepOutput=oe.ra)(d,m,b),r._JsepGetNodeName=d=>(r._JsepGetNodeName=oe.sa)(d);var hr=()=>(hr=oe.ta)(),Zt=r._malloc=d=>(Zt=r._malloc=oe.ua)(d),gr=r._free=d=>(gr=r._free=oe.va)(d),yr=d=>(yr=oe.xa)(d),br=()=>(br=oe.ya)(),Qt=d=>(Qt=oe.za)(d),Dt=d=>(Dt=oe.Aa)(d),Jt=d=>(Jt=oe.Ca)(d),Ct=()=>(Ct=oe.Da)(),wr=d=>(wr=oe.Ea)(d),vr=()=>(vr=oe.Fa)();r.___start_em_js=910449,r.___stop_em_js=911222;function Vr(){var d=oe;d=Object.assign({},d);var m=S=>()=>S()>>>0,b=S=>P=>S(P)>>>0;return d.ta=m(d.ta),d.ua=b(d.ua),d.ya=m(d.ya),d.Aa=b(d.Aa),d}r.stackAlloc=Dt,r.stackSave=br,r.stackRestore=Qt,r.addFunction=fr,r.UTF8ToString=Ke,r.stringToUTF8=(d,m,b)=>Ht(d,G,m,b),r.lengthBytesUTF8=ar;var Mt;Oe=function d(){Mt||$r(),Mt||(Oe=d)};function $r(){if(!(0<re)){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;){var d=r.preRun.shift();ee.unshift(d)}for(;0<ee.length;)ee.shift()(r);if(!(0<re||Mt||(Mt=!0,r.calledRun=!0,C))){for(;0<Te.length;)Te.shift()(r);for(o(r);0<De.length;)De.shift()(r)}}}return $r(),t.ready}})();typeof zo=="object"&&typeof kn=="object"?kn.exports=Uo:typeof define=="function"&&define.amd&&define([],()=>Uo)});var No=Sr(()=>{});var Wo=Sr(()=>{});var Go={};xr(Go,{cpus:()=>ld});var ld,Ho=q(()=>{ld=void 0});var Ko=Sr((Fo,Rn)=>{"use strict";var Lo=(()=>{var e=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(e=e||__filename),function(t={}){function r(){return ee.buffer!=Ie.buffer&&Fe(),Ie}function o(){return ee.buffer!=Ie.buffer&&Fe(),Oe}function n(){return ee.buffer!=Ie.buffer&&Fe(),ie}function s(){return ee.buffer!=Ie.buffer&&Fe(),Se}function u(){return ee.buffer!=Ie.buffer&&Fe(),Ae}function l(){return ee.buffer!=Ie.buffer&&Fe(),Pe}var a=t,p,h;a.ready=new Promise((i,c)=>{p=i,h=c}),a.mountExternalData=(i,c)=>{(a.ib||(a.ib=new Map)).set(i,c)},a.unmountExternalData=()=>{delete a.ib},a.jsepInit=(i,c,f,$,T,R,z,Q,be,ce,ye)=>{a.Ub=i,a.Bb=c,a.Fb=f,a.pb=$,a.Eb=T,a.Ua=R,a.Gb=z,a.Ib=Q,a.Cb=be,a.Db=ce,a.Hb=ye,c=(le,_e,k)=>(...se)=>{let ve=pt,Xe=_e?.();se=le(...se);let Ut=_e?.();return Xe!==Ut&&(le=Ut,k(Xe),_e=k=null),pt!=ve?ju():se},f=le=>async(..._e)=>{try{if(a.hb)throw Error("Session already started");let k=a.hb={Kb:_e[0],errors:[]},se=await le(..._e);if(a.hb!==k)throw Error("Session mismatch");i.flush();let ve=k.errors;if(0<ve.length){let Xe=await Promise.all(ve);if(Xe=Xe.filter(Ut=>Ut),0<Xe.length)throw Error(Xe.join(`\n`))}return se}finally{a.hb=null}},a._OrtRun=f(c(a._OrtRun,()=>a._OrtRun,le=>a._OrtRun=le)),a._OrtRunWithBinding=f(c(a._OrtRunWithBinding,()=>a._OrtRunWithBinding,le=>a._OrtRunWithBinding=le)),a._OrtBindInput=c(a._OrtBindInput,()=>a._OrtBindInput,le=>a._OrtBindInput=le),a.jsepRegisterBuffer=(le,_e,k,se)=>i.registerBuffer(le,_e,k,se),a.jsepGetBuffer=le=>i.getBuffer(le),a.jsepCreateDownloader=(le,_e,k)=>i.createDownloader(le,_e,k),a.jsepOnReleaseSession=le=>{i.onReleaseSession(le)},a.jsepOnRunStart=le=>i.onRunStart(le)};var g=Object.assign({},a),w="./this.program",v=(i,c)=>{throw c},y=typeof window=="object",_=typeof importScripts=="function",I=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",x=a.ENVIRONMENT_IS_PTHREAD||!1,A="";function O(i){return a.locateFile?a.locateFile(i,A):A+i}var C,M,D;if(I){var G=(Tn(),Ot(An)),E=(On(),Ot(En));A=_?E.dirname(A)+"/":__dirname+"/",C=(c,f)=>(c=lt(c)?new URL(c):E.normalize(c),G.readFileSync(c,f?void 0:"utf8")),D=c=>(c=C(c,!0),c.buffer||(c=new Uint8Array(c)),c),M=(c,f,$,T=!0)=>{c=lt(c)?new URL(c):E.normalize(c),G.readFile(c,T?void 0:"utf8",(R,z)=>{R?$(R):f(T?z.buffer:z)})},!a.thisProgram&&1<process.argv.length&&(w=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),v=(c,f)=>{throw process.exitCode=c,f},a.inspect=()=>"[Emscripten Module object]";let i;try{i=No()}catch(c){throw console.error(\'The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?\'),c}global.Worker=i.Worker}else(y||_)&&(_?A=self.location.href:typeof document<"u"&&document.currentScript&&(A=document.currentScript.src),typeof e<"u"&&e&&(A=e),A.indexOf("blob:")!==0?A=A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):A="",I||(C=i=>{var c=new XMLHttpRequest;return c.open("GET",i,!1),c.send(null),c.responseText},_&&(D=i=>{var c=new XMLHttpRequest;return c.open("GET",i,!1),c.responseType="arraybuffer",c.send(null),new Uint8Array(c.response)}),M=(i,c,f)=>{var $=new XMLHttpRequest;$.open("GET",i,!0),$.responseType="arraybuffer",$.onload=()=>{$.status==200||$.status==0&&$.response?c($.response):f()},$.onerror=f,$.send(null)}));I&&typeof performance>"u"&&(global.performance=Wo().performance);var W=console.log.bind(console),te=console.error.bind(console);I&&(W=(...i)=>G.writeSync(1,i.join(" ")+`\n`),te=(...i)=>G.writeSync(2,i.join(" ")+`\n`));var Y=W,Z=te;Object.assign(a,g),g=null,typeof WebAssembly!="object"&&je("no native wasm support detected");var ee,Te,De=!1,re,Ie,Oe,ie,Se,Ae,Pe;function Fe(){var i=ee.buffer;a.HEAP8=Ie=new Int8Array(i),a.HEAP16=new Int16Array(i),a.HEAPU8=Oe=new Uint8Array(i),a.HEAPU16=new Uint16Array(i),a.HEAP32=ie=new Int32Array(i),a.HEAPU32=Se=new Uint32Array(i),a.HEAPF32=Ae=new Float32Array(i),a.HEAPF64=Pe=new Float64Array(i)}var H=16777216;if(x)ee=a.wasmMemory;else if(a.wasmMemory)ee=a.wasmMemory;else if(ee=new WebAssembly.Memory({initial:H/65536,maximum:65536,shared:!0}),!(ee.buffer instanceof SharedArrayBuffer))throw Z("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),I&&Z("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");Fe(),H=ee.buffer.byteLength;var J=[],Ce=[],$t=[],Me=0,tt=null,at=null;function Ne(){if(Me--,Me==0&&(tt!==null&&(clearInterval(tt),tt=null),at)){var i=at;at=null,i()}}function je(i){throw i="Aborted("+i+")",Z(i),De=!0,re=1,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),h(i),i}var At=i=>i.startsWith("data:application/octet-stream;base64,"),lt=i=>i.startsWith("file://"),ct;ct="ort-wasm-simd-threaded.wasm",At(ct)||(ct=O(ct));function Ke(i){if(D)return D(i);throw"both async and sync fetching of the wasm failed"}function ar(i){if(y||_){if(typeof fetch=="function"&&!lt(i))return fetch(i,{credentials:"same-origin"}).then(c=>{if(!c.ok)throw"failed to load wasm binary file at \'"+i+"\'";return c.arrayBuffer()}).catch(()=>Ke(i));if(M)return new Promise((c,f)=>{M(i,$=>c(new Uint8Array($)),f)})}return Promise.resolve().then(()=>Ke(i))}function Ht(i,c,f){return ar(i).then($=>WebAssembly.instantiate($,c)).then($=>$).then(f,$=>{Z(`failed to asynchronously prepare wasm: ${$}`),je($)})}function Tt(i,c){var f=ct;return typeof WebAssembly.instantiateStreaming!="function"||At(f)||lt(f)||I||typeof fetch!="function"?Ht(f,i,c):fetch(f,{credentials:"same-origin"}).then($=>WebAssembly.instantiateStreaming($,i).then(c,function(T){return Z(`wasm streaming compile failed: ${T}`),Z("falling back to ArrayBuffer instantiation"),Ht(f,i,c)}))}var St,Lt={902852:(i,c,f,$)=>{if(typeof a>"u"||!a.ib)return 1;if(i=Ye(i>>>0),i.startsWith("./")&&(i=i.substring(2)),i=a.ib.get(i),!i)return 2;if(c>>>=0,f>>>=0,$>>>=0,c+f>i.byteLength)return 3;try{return o().set(i.subarray(c,c+f),$>>>0),0}catch{return 4}},903353:()=>{a.Cb()},903384:()=>{a.Db()},903413:()=>{a.Hb()},903438:i=>a.Bb(i),903471:i=>a.Fb(i),903503:(i,c,f)=>{a.pb(i,c,f,!0)},903542:(i,c,f)=>{a.pb(i,c,f)},903575:i=>{a.Ua("Abs",i,void 0)},903626:i=>{a.Ua("Neg",i,void 0)},903677:i=>{a.Ua("Floor",i,void 0)},903730:i=>{a.Ua("Ceil",i,void 0)},903782:i=>{a.Ua("Reciprocal",i,void 0)},903840:i=>{a.Ua("Sqrt",i,void 0)},903892:i=>{a.Ua("Exp",i,void 0)},903943:i=>{a.Ua("Erf",i,void 0)},903994:i=>{a.Ua("Sigmoid",i,void 0)},904049:i=>{a.Ua("Log",i,void 0)},904100:i=>{a.Ua("Sin",i,void 0)},904151:i=>{a.Ua("Cos",i,void 0)},904202:i=>{a.Ua("Tan",i,void 0)},904253:i=>{a.Ua("Asin",i,void 0)},904305:i=>{a.Ua("Acos",i,void 0)},904357:i=>{a.Ua("Atan",i,void 0)},904409:i=>{a.Ua("Sinh",i,void 0)},904461:i=>{a.Ua("Cosh",i,void 0)},904513:i=>{a.Ua("Asinh",i,void 0)},904566:i=>{a.Ua("Acosh",i,void 0)},904619:i=>{a.Ua("Atanh",i,void 0)},904672:i=>{a.Ua("Tanh",i,void 0)},904724:i=>{a.Ua("Not",i,void 0)},904775:(i,c,f)=>{a.Ua("Clip",i,{min:c,max:f})},904844:i=>{a.Ua("Clip",i,void 0)},904896:(i,c)=>{a.Ua("Elu",i,{alpha:c})},904954:i=>{a.Ua("Relu",i,void 0)},905006:(i,c)=>{a.Ua("LeakyRelu",i,{alpha:c})},905070:(i,c)=>{a.Ua("ThresholdedRelu",i,{alpha:c})},905140:(i,c)=>{a.Ua("Cast",i,{to:c})},905198:i=>{a.Ua("Add",i,void 0)},905249:i=>{a.Ua("Sub",i,void 0)},905300:i=>{a.Ua("Mul",i,void 0)},905351:i=>{a.Ua("Div",i,void 0)},905402:i=>{a.Ua("Pow",i,void 0)},905453:i=>{a.Ua("Equal",i,void 0)},905506:i=>{a.Ua("Greater",i,void 0)},905561:i=>{a.Ua("GreaterOrEqual",i,void 0)},905623:i=>{a.Ua("Less",i,void 0)},905675:i=>{a.Ua("LessOrEqual",i,void 0)},905734:(i,c,f,$,T)=>{a.Ua("ReduceMean",i,{keepDims:!!c,noopWithEmptyAxes:!!f,axes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},905893:(i,c,f,$,T)=>{a.Ua("ReduceMax",i,{keepDims:!!c,noopWithEmptyAxes:!!f,axes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},906051:(i,c,f,$,T)=>{a.Ua("ReduceMin",i,{keepDims:!!c,noopWithEmptyAxes:!!f,axes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},906209:(i,c,f,$,T)=>{a.Ua("ReduceProd",i,{keepDims:!!c,noopWithEmptyAxes:!!f,axes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},906368:(i,c,f,$,T)=>{a.Ua("ReduceSum",i,{keepDims:!!c,noopWithEmptyAxes:!!f,axes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},906526:(i,c,f,$,T)=>{a.Ua("ReduceL1",i,{keepDims:!!c,noopWithEmptyAxes:!!f,axes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},906683:(i,c,f,$,T)=>{a.Ua("ReduceL2",i,{keepDims:!!c,noopWithEmptyAxes:!!f,axes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},906840:(i,c,f,$,T)=>{a.Ua("ReduceLogSum",i,{keepDims:!!c,noopWithEmptyAxes:!!f,axes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},907001:(i,c,f,$,T)=>{a.Ua("ReduceSumSquare",i,{keepDims:!!c,noopWithEmptyAxes:!!f,axes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},907165:(i,c,f,$,T)=>{a.Ua("ReduceLogSumExp",i,{keepDims:!!c,noopWithEmptyAxes:!!f,axes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},907329:i=>{a.Ua("Where",i,void 0)},907382:(i,c,f)=>{a.Ua("Transpose",i,{perm:c?Array.from(n().subarray(c>>>0,f>>>0)):[]})},907490:(i,c,f,$,T,R,z,Q,be,ce,ye,le,_e,k,se)=>{a.Ua("ConvTranspose",i,{format:be?"NHWC":"NCHW",autoPad:c,dilations:[f],group:$,kernel_shape:[T],pads:[R,z],strides:[Q],wIsConst:()=>!!r()[ce>>>0],outputPadding:ye?Array.from(n().subarray(ye>>>0,le>>>0)):[],outputShape:_e?Array.from(n().subarray(_e>>>0,k>>>0)):[],activation:Ye(se)})},907892:(i,c,f,$,T,R,z,Q,be,ce,ye,le,_e,k)=>{a.Ua("ConvTranspose",i,{format:Q?"NHWC":"NCHW",autoPad:c,dilations:Array.from(n().subarray(f>>>0,(f>>>0)+2>>>0)),group:$,kernelShape:Array.from(n().subarray(T>>>0,(T>>>0)+2>>>0)),pads:Array.from(n().subarray(R>>>0,(R>>>0)+4>>>0)),strides:Array.from(n().subarray(z>>>0,(z>>>0)+2>>>0)),wIsConst:()=>!!r()[be>>>0],outputPadding:ce?Array.from(n().subarray(ce>>>0,ye>>>0)):[],outputShape:le?Array.from(n().subarray(le>>>0,_e>>>0)):[],activation:Ye(k)})},908457:(i,c,f,$,T,R,z,Q,be,ce,ye,le,_e,k,se)=>{a.Ua("ConvTranspose",i,{format:be?"NHWC":"NCHW",autoPad:c,dilations:[f],group:$,kernel_shape:[T],pads:[R,z],strides:[Q],wIsConst:()=>!!r()[ce>>>0],outputPadding:ye?Array.from(n().subarray(ye>>>0,le>>>0)):[],outputShape:_e?Array.from(n().subarray(_e>>>0,k>>>0)):[],activation:Ye(se)})},908859:(i,c,f,$,T,R,z,Q,be,ce,ye,le,_e,k)=>{a.Ua("ConvTranspose",i,{format:Q?"NHWC":"NCHW",autoPad:c,dilations:Array.from(n().subarray(f>>>0,(f>>>0)+2>>>0)),group:$,kernelShape:Array.from(n().subarray(T>>>0,(T>>>0)+2>>>0)),pads:Array.from(n().subarray(R>>>0,(R>>>0)+4>>>0)),strides:Array.from(n().subarray(z>>>0,(z>>>0)+2>>>0)),wIsConst:()=>!!r()[be>>>0],outputPadding:ce?Array.from(n().subarray(ce>>>0,ye>>>0)):[],outputShape:le?Array.from(n().subarray(le>>>0,_e>>>0)):[],activation:Ye(k)})},909424:(i,c)=>{a.Ua("GlobalAveragePool",i,{format:c?"NHWC":"NCHW"})},909515:(i,c,f,$,T,R,z,Q,be,ce,ye,le,_e,k,se,ve)=>{a.Ua("AveragePool",i,{format:ve?"NHWC":"NCHW",auto_pad:c,ceil_mode:f,count_include_pad:$,storage_order:T,dilations:[R,z],kernel_shape:[Q,be],pads:[ce,ye,le,_e],strides:[k,se]})},909799:(i,c)=>{a.Ua("GlobalAveragePool",i,{format:c?"NHWC":"NCHW"})},909890:(i,c,f,$,T,R,z,Q,be,ce,ye,le,_e,k,se,ve)=>{a.Ua("AveragePool",i,{format:ve?"NHWC":"NCHW",auto_pad:c,ceil_mode:f,count_include_pad:$,storage_order:T,dilations:[R,z],kernel_shape:[Q,be],pads:[ce,ye,le,_e],strides:[k,se]})},910174:(i,c)=>{a.Ua("GlobalMaxPool",i,{format:c?"NHWC":"NCHW"})},910261:(i,c,f,$,T,R,z,Q,be,ce,ye,le,_e,k,se,ve)=>{a.Ua("MaxPool",i,{format:ve?"NHWC":"NCHW",auto_pad:c,ceil_mode:f,count_include_pad:$,storage_order:T,dilations:[R,z],kernel_shape:[Q,be],pads:[ce,ye,le,_e],strides:[k,se]})},910541:(i,c)=>{a.Ua("GlobalMaxPool",i,{format:c?"NHWC":"NCHW"})},910628:(i,c,f,$,T,R,z,Q,be,ce,ye,le,_e,k,se,ve)=>{a.Ua("MaxPool",i,{format:ve?"NHWC":"NCHW",auto_pad:c,ceil_mode:f,count_include_pad:$,storage_order:T,dilations:[R,z],kernel_shape:[Q,be],pads:[ce,ye,le,_e],strides:[k,se]})},910908:(i,c,f,$,T)=>{a.Ua("Gemm",i,{alpha:c,beta:f,transA:$,transB:T})},911012:i=>{a.Ua("MatMul",i,void 0)},911066:(i,c,f,$)=>{a.Ua("ArgMax",i,{keepDims:!!c,selectLastIndex:!!f,axis:$})},911174:(i,c,f,$)=>{a.Ua("ArgMin",i,{keepDims:!!c,selectLastIndex:!!f,axis:$})},911282:(i,c)=>{a.Ua("Softmax",i,{axis:c})},911345:(i,c)=>{a.Ua("Concat",i,{axis:c})},911405:(i,c,f,$,T)=>{a.Ua("Split",i,{axis:c,numOutputs:f,splitSizes:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},911545:i=>{a.Ua("Expand",i,void 0)},911599:(i,c)=>{a.Ua("Gather",i,{axis:Number(c)})},911670:(i,c)=>{a.Ua("GatherElements",i,{axis:Number(c)})},911749:(i,c,f,$,T,R,z,Q,be,ce,ye)=>{a.Ua("Resize",i,{antialias:c,axes:f?Array.from(n().subarray(f>>>0,$>>>0)):[],coordinateTransformMode:Ye(T),cubicCoeffA:R,excludeOutside:z,extrapolationValue:Q,keepAspectRatioPolicy:Ye(be),mode:Ye(ce),nearestMode:Ye(ye)})},912095:(i,c,f,$,T,R,z)=>{a.Ua("Slice",i,{starts:c?Array.from(n().subarray(c>>>0,f>>>0)):[],ends:$?Array.from(n().subarray($>>>0,T>>>0)):[],axes:R?Array.from(n().subarray(R>>>0,z>>>0)):[]})},912311:i=>{a.Ua("Tile",i,void 0)},912363:(i,c,f)=>{a.Ua("LayerNormalization",i,{axis:Number(c),epsilon:Number(f)})},912470:(i,c,f)=>{a.Ua("InstanceNormalization",i,{epsilon:c,format:f?"NHWC":"NCHW"})},912584:(i,c,f)=>{a.Ua("InstanceNormalization",i,{epsilon:c,format:f?"NHWC":"NCHW"})},912698:i=>{a.Ua("Range",i,void 0)},912751:(i,c)=>{a.Ua("Einsum",i,{equation:Ye(c)})},912832:(i,c,f,$,T)=>{a.Ua("Pad",i,{mode:c,value:f,pads:$?Array.from(n().subarray($>>>0,T>>>0)):[]})},912959:(i,c,f,$,T,R)=>{a.Ua("BatchNormalization",i,{epsilon:c,momentum:f,spatial:!!T,trainingMode:!!$,format:R?"NHWC":"NCHW"})},913128:(i,c,f,$,T,R)=>{a.Ua("BatchNormalization",i,{epsilon:c,momentum:f,spatial:!!T,trainingMode:!!$,format:R?"NHWC":"NCHW"})},913297:(i,c,f)=>{a.Ua("CumSum",i,{exclusive:Number(c),reverse:Number(f)})},913394:(i,c,f,$,T,R,z,Q,be)=>{a.Ua("Attention",i,{numHeads:c,isUnidirectional:f,maskFilterValue:$,scale:T,doRotary:R,qkvHiddenSizes:z?Array.from(n().subarray(Number(Q)>>>0,Number(Q)+z>>>0)):[],pastPresentShareBuffer:!!be})},913666:i=>{a.Ua("Gelu",i,void 0)},913718:(i,c,f,$,T,R)=>{a.Ua("MultiHeadAttention",i,{numHeads:c,isUnidirectional:f,maskFilterValue:$,scale:T,doRotary:R})},913877:i=>{a.Ua("BiasAdd",i,void 0)},913932:i=>{a.Ua("BiasSplitGelu",i,void 0)},913993:(i,c)=>{a.Ua("SkipLayerNormalization",i,{epsilon:c})},914074:(i,c,f,$,T,R,z,Q,be,ce,ye,le,_e)=>{a.Ua("Conv",i,{format:be?"NHWC":"NCHW",auto_pad:c,dilations:[f],group:$,kernel_shape:[T],pads:R?Array.from(n().subarray(R>>>0,z>>>0)):[],strides:[Q],w_is_const:()=>!!r()[ce>>>0],activation:Ye(ye),activation_params:le?Array.from(u().subarray(le>>>0,_e>>>0)):[]})},914444:(i,c,f,$,T,R,z,Q,be,ce,ye,le,_e,k,se,ve)=>{a.Ua("Conv",i,{format:le?"NHWC":"NCHW",auto_pad:c,dilations:[f,$],group:T,kernel_shape:[R,z],pads:Q?Array.from(n().subarray(Q>>>0,be>>>0)):[],strides:[ce,ye],w_is_const:()=>!!r()[_e>>>0],activation:Ye(k),activation_params:se?Array.from(u().subarray(se>>>0,ve>>>0)):[]})},914835:i=>{a.Gb(i)},914869:(i,c)=>a.Ib(i,c,a.hb.Kb,a.hb.errors)};function Ft(i){this.name="ExitStatus",this.message=`Program terminated with exit(${i})`,this.status=i}var kt=i=>{i.terminate(),i.onmessage=()=>{}},ir=i=>{ne.cb.length==0&&(Rt(),ne.qb(ne.cb[0]));var c=ne.cb.pop();if(!c)return 6;ne.eb.push(c),ne.$a[i.bb]=c,c.bb=i.bb;var f={cmd:"run",start_routine:i.Lb,arg:i.xb,pthread_ptr:i.bb};return I&&c.unref(),c.postMessage(f,i.Rb),0},it=0,sr=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Kt=(i,c,f)=>{c>>>=0;var $=c+f;for(f=c;i[f]&&!(f>=$);)++f;if(16<f-c&&i.buffer&&sr)return sr.decode(i.buffer instanceof SharedArrayBuffer?i.slice(c,f):i.subarray(c,f));for($="";c<f;){var T=i[c++];if(T&128){var R=i[c++]&63;if((T&224)==192)$+=String.fromCharCode((T&31)<<6|R);else{var z=i[c++]&63;T=(T&240)==224?(T&15)<<12|R<<6|z:(T&7)<<18|R<<12|z<<6|i[c++]&63,65536>T?$+=String.fromCharCode(T):(T-=65536,$+=String.fromCharCode(55296|T>>10,56320|T&1023))}}else $+=String.fromCharCode(T)}return $},Ye=(i,c)=>(i>>>=0)?Kt(o(),i,c):"",bn=i=>{var c=_n();return i=i(),Hr(c),i};function Be(i,c){var f=arguments.length-2,$=arguments;return bn(()=>{for(var T=Cn(8*f),R=T>>>3,z=0;z<f;z++){var Q=$[2+z];l()[R+z>>>0]=Q}return Io(i,f,T,c)})}function ur(i){if(x)return Be(0,1,i);re=i,0<it||(ne.Mb(),a.onExit?.(i),De=!0),v(i,new Ft(i))}var qt=i=>{if(re=i,x)throw lr(i),"unwind";ur(i)},dr=i=>{i instanceof Ft||i=="unwind"||v(1,i)};function Pr(){for(var i=a.numThreads;i--;)Rt();J.unshift(()=>{Me++,wn(()=>Ne())})}function Rt(){var i=O("ort-wasm-simd-threaded.worker.js");i=new Worker(i),ne.cb.push(i)}function wn(i){x?i():Promise.all(ne.cb.map(ne.qb)).then(i)}var ne={cb:[],eb:[],ub:[],$a:{},mb(){x?(ne.receiveObjectTransfer=ne.Jb,ne.threadInitTLS=ne.tb,ne.setExitStatus=ne.sb):Pr()},sb:i=>re=i,Vb:["$terminateWorker"],Mb:()=>{for(var i of ne.eb)kt(i);for(i of ne.cb)kt(i);ne.cb=[],ne.eb=[],ne.$a=[]},rb:i=>{var c=i.bb;delete ne.$a[c],ne.cb.push(i),ne.eb.splice(ne.eb.indexOf(i),1),i.bb=0,Sn(c)},Jb(){},tb(){ne.ub.forEach(i=>i())},qb:i=>new Promise(c=>{i.onmessage=R=>{R=R.data;var z=R.cmd;if(R.targetThread&&R.targetThread!=Gr()){var Q=ne.$a[R.targetThread];Q?Q.postMessage(R,R.transferList):Z(`Internal error! Worker sent a message "${z}" to target pthread ${R.targetThread}, but that thread no longer exists!`)}else z==="checkMailbox"?Dt():z==="spawnThread"?ir(R):z==="cleanupThread"?ne.rb(ne.$a[R.thread]):z==="killThread"?(R=R.thread,z=ne.$a[R],delete ne.$a[R],kt(z),Sn(R),ne.eb.splice(ne.eb.indexOf(z),1),z.bb=0):z==="cancelThread"?ne.$a[R.thread].postMessage({cmd:"cancel"}):z==="loaded"?(i.loaded=!0,I&&!i.bb&&i.unref(),c(i)):z==="alert"?alert(`Thread ${R.threadId}: ${R.text}`):R.target==="setimmediate"?i.postMessage(R):z==="callHandler"?a[R.handler](...R.args):z&&Z(`worker sent an unknown command ${z}`)},i.onerror=R=>{throw Z(`worker sent an error! ${R.filename}:${R.lineno}: ${R.message}`),R},I&&(i.on("message",R=>i.onmessage({data:R})),i.on("error",R=>i.onerror(R)));var f=[],$=["onExit"],T;for(T of $)a.hasOwnProperty(T)&&f.push(T);i.postMessage({cmd:"load",handlers:f,urlOrBlob:a.mainScriptUrlOrBlob||e,wasmMemory:ee,wasmModule:Te})})};a.PThread=ne;var Je=i=>{for(;0<i.length;)i.shift()(a)};a.establishStackSpace=()=>{var i=Gr(),c=s()[i+52>>>2>>>0];i=s()[i+56>>>2>>>0],Eo(c,c-i),Hr(c)};function lr(i){if(x)return Be(1,0,i);qt(i)}a.invokeEntryPoint=(i,c)=>{i=Oo.apply(null,[i,c]),0<it?ne.sb(i):xn(i)};function jt(i){this.lb=i-24,this.yb=function(c){s()[this.lb+4>>>2>>>0]=c},this.wb=function(c){s()[this.lb+8>>>2>>>0]=c},this.mb=function(c,f){this.vb(),this.yb(c),this.wb(f)},this.vb=function(){s()[this.lb+16>>>2>>>0]=0}}var cr=0,Br=0;function kr(i,c,f,$){return x?Be(2,1,i,c,f,$):Yt(i,c,f,$)}function Yt(i,c,f,$){if(i>>>=0,c>>>=0,f>>>=0,$>>>=0,typeof SharedArrayBuffer>"u")return Z("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var T=[];return x&&T.length===0?kr(i,c,f,$):(i={Lb:f,bb:i,xb:$,Rb:T},x?(i.Tb="spawnThread",postMessage(i,T),0):ir(i))}function Rr(i,c,f){return x?Be(3,1,i,c,f):0}function Dr(i,c){if(x)return Be(4,1,i,c)}var pr=i=>{for(var c=0,f=0;f<i.length;++f){var $=i.charCodeAt(f);127>=$?c++:2047>=$?c+=2:55296<=$&&57343>=$?(c+=4,++f):c+=3}return c},Mr=(i,c,f,$)=>{if(f>>>=0,!(0<$))return 0;var T=f;$=f+$-1;for(var R=0;R<i.length;++R){var z=i.charCodeAt(R);if(55296<=z&&57343>=z){var Q=i.charCodeAt(++R);z=65536+((z&1023)<<10)|Q&1023}if(127>=z){if(f>=$)break;c[f++>>>0]=z}else{if(2047>=z){if(f+1>=$)break;c[f++>>>0]=192|z>>6}else{if(65535>=z){if(f+2>=$)break;c[f++>>>0]=224|z>>12}else{if(f+3>=$)break;c[f++>>>0]=240|z>>18,c[f++>>>0]=128|z>>12&63}c[f++>>>0]=128|z>>6&63}c[f++>>>0]=128|z&63}}return c[f>>>0]=0,f-T},Ur=(i,c,f)=>Mr(i,o(),c,f);function xt(i,c){if(x)return Be(5,1,i,c)}function rt(i,c,f){if(x)return Be(6,1,i,c,f)}function _t(i,c,f){return x?Be(7,1,i,c,f):0}function mr(i,c){if(x)return Be(8,1,i,c)}function fr(i,c,f){if(x)return Be(9,1,i,c,f)}function zr(i,c,f,$){if(x)return Be(10,1,i,c,f,$)}function oe(i,c,f,$){if(x)return Be(11,1,i,c,f,$)}function hr(i,c,f,$){if(x)return Be(12,1,i,c,f,$)}function Zt(i){if(x)return Be(13,1,i)}function gr(i,c){if(x)return Be(14,1,i,c)}function yr(i,c,f){if(x)return Be(15,1,i,c,f)}var br=()=>{if(!(0<it))try{x?xn(re):qt(re)}catch(i){dr(i)}};function Qt(i){i>>>=0,typeof Atomics.Sb=="function"&&(Atomics.Sb(n(),i>>>2,i).value.then(Dt),i+=128,Atomics.store(n(),i>>>2,1))}a.__emscripten_thread_mailbox_await=Qt;var Dt=()=>{var i=Gr();if(i&&(Qt(i),!De))try{Ao(),br()}catch(c){dr(c)}};a.checkMailbox=Dt;var Jt=[],Ct=i=>i%4===0&&(i%100!==0||i%400===0),wr=[0,31,60,91,121,152,182,213,244,274,305,335],vr=[0,31,59,90,120,151,181,212,243,273,304,334];function Vr(i,c,f,$,T,R,z,Q){return x?Be(16,1,i,c,f,$,T,R,z,Q):-52}function Mt(i,c,f,$,T,R,z){if(x)return Be(17,1,i,c,f,$,T,R,z)}var $r=i=>{var c=pr(i)+1,f=$n(c);return f&&Ur(i,f,c),f},d=[],m=(i,c)=>{d.length=0;for(var f;f=o()[i++>>>0];){var $=f!=105;$&=f!=112,c+=$&&c%8?4:0,d.push(f==112?s()[c>>>2>>>0]:f==105?n()[c>>>2>>>0]:l()[c>>>3>>>0]),c+=$?8:4}return d},b={},S=()=>{if(!P){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:w||"./this.program"},c;for(c in b)b[c]===void 0?delete i[c]:i[c]=b[c];var f=[];for(c in i)f.push(`${c}=${i[c]}`);P=f}return P},P;function N(i,c){if(x)return Be(18,1,i,c);i>>>=0,c>>>=0;var f=0;return S().forEach(($,T)=>{var R=c+f;for(T=s()[i+4*T>>>2>>>0]=R,R=0;R<$.length;++R)r()[T++>>>0>>>0]=$.charCodeAt(R);r()[T>>>0>>>0]=0,f+=$.length+1}),0}function L(i,c){if(x)return Be(19,1,i,c);i>>>=0,c>>>=0;var f=S();s()[i>>>2>>>0]=f.length;var $=0;return f.forEach(T=>$+=T.length+1),s()[c>>>2>>>0]=$,0}function X(i){return x?Be(20,1,i):52}function pe(i,c,f,$){return x?Be(21,1,i,c,f,$):52}function me(i,c,f,$,T){return x?Be(22,1,i,c,f,$,T):70}var fe=[null,[],[]];function ue(i,c,f,$){if(x)return Be(23,1,i,c,f,$);c>>>=0,f>>>=0,$>>>=0;for(var T=0,R=0;R<f;R++){var z=s()[c>>>2>>>0],Q=s()[c+4>>>2>>>0];c+=8;for(var be=0;be<Q;be++){var ce=o()[z+be>>>0],ye=fe[i];ce===0||ce===10?((i===1?Y:Z)(Kt(ye,0)),ye.length=0):ye.push(ce)}T+=Q}return s()[$>>>2>>>0]=T,0}var we=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return f=>(f.set(crypto.getRandomValues(new Uint8Array(f.byteLength))),f);if(I)try{var i=(Bn(),Ot(Pn));if(i.randomFillSync)return f=>i.randomFillSync(f);var c=i.randomBytes;return f=>(f.set(c(f.byteLength)),f)}catch{}je("initRandomDevice")},B=i=>(B=we())(i),ae=[31,29,31,30,31,30,31,31,30,31,30,31],ge=[31,28,31,30,31,30,31,31,30,31,30,31];function Ze(i){var c=Array(pr(i)+1);return Mr(i,c,0,c.length),c}var It=(i,c)=>{r().set(i,c>>>0)};function yo(i,c,f,$){function T(k,se,ve){for(k=typeof k=="number"?k.toString():k||"";k.length<se;)k=ve[0]+k;return k}function R(k,se){return T(k,se,"0")}function z(k,se){function ve(Ut){return 0>Ut?-1:0<Ut?1:0}var Xe;return(Xe=ve(k.getFullYear()-se.getFullYear()))===0&&(Xe=ve(k.getMonth()-se.getMonth()))===0&&(Xe=ve(k.getDate()-se.getDate())),Xe}function Q(k){switch(k.getDay()){case 0:return new Date(k.getFullYear()-1,11,29);case 1:return k;case 2:return new Date(k.getFullYear(),0,3);case 3:return new Date(k.getFullYear(),0,2);case 4:return new Date(k.getFullYear(),0,1);case 5:return new Date(k.getFullYear()-1,11,31);case 6:return new Date(k.getFullYear()-1,11,30)}}function be(k){var se=k.fb;for(k=new Date(new Date(k.gb+1900,0,1).getTime());0<se;){var ve=k.getMonth(),Xe=(Ct(k.getFullYear())?ae:ge)[ve];if(se>Xe-k.getDate())se-=Xe-k.getDate()+1,k.setDate(1),11>ve?k.setMonth(ve+1):(k.setMonth(0),k.setFullYear(k.getFullYear()+1));else{k.setDate(k.getDate()+se);break}}return ve=new Date(k.getFullYear()+1,0,4),se=Q(new Date(k.getFullYear(),0,4)),ve=Q(ve),0>=z(se,k)?0>=z(ve,k)?k.getFullYear()+1:k.getFullYear():k.getFullYear()-1}i>>>=0,c>>>=0,f>>>=0,$>>>=0;var ce=s()[$+40>>>2>>>0];$={Pb:n()[$>>>2>>>0],Ob:n()[$+4>>>2>>>0],jb:n()[$+8>>>2>>>0],ob:n()[$+12>>>2>>>0],kb:n()[$+16>>>2>>>0],gb:n()[$+20>>>2>>>0],ab:n()[$+24>>>2>>>0],fb:n()[$+28>>>2>>>0],Wb:n()[$+32>>>2>>>0],Nb:n()[$+36>>>2>>>0],Qb:ce?Ye(ce):""},f=Ye(f),ce={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var ye in ce)f=f.replace(new RegExp(ye,"g"),ce[ye]);var le="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),_e="January February March April May June July August September October November December".split(" ");ce={"%a":k=>le[k.ab].substring(0,3),"%A":k=>le[k.ab],"%b":k=>_e[k.kb].substring(0,3),"%B":k=>_e[k.kb],"%C":k=>R((k.gb+1900)/100|0,2),"%d":k=>R(k.ob,2),"%e":k=>T(k.ob,2," "),"%g":k=>be(k).toString().substring(2),"%G":k=>be(k),"%H":k=>R(k.jb,2),"%I":k=>(k=k.jb,k==0?k=12:12<k&&(k-=12),R(k,2)),"%j":k=>{for(var se=0,ve=0;ve<=k.kb-1;se+=(Ct(k.gb+1900)?ae:ge)[ve++]);return R(k.ob+se,3)},"%m":k=>R(k.kb+1,2),"%M":k=>R(k.Ob,2),"%n":()=>`\n`,"%p":k=>0<=k.jb&&12>k.jb?"AM":"PM","%S":k=>R(k.Pb,2),"%t":()=>"\t","%u":k=>k.ab||7,"%U":k=>R(Math.floor((k.fb+7-k.ab)/7),2),"%V":k=>{var se=Math.floor((k.fb+7-(k.ab+6)%7)/7);if(2>=(k.ab+371-k.fb-2)%7&&se++,se)se==53&&(ve=(k.ab+371-k.fb)%7,ve==4||ve==3&&Ct(k.gb)||(se=1));else{se=52;var ve=(k.ab+7-k.fb-1)%7;(ve==4||ve==5&&Ct(k.gb%400-1))&&se++}return R(se,2)},"%w":k=>k.ab,"%W":k=>R(Math.floor((k.fb+7-(k.ab+6)%7)/7),2),"%y":k=>(k.gb+1900).toString().substring(2),"%Y":k=>k.gb+1900,"%z":k=>{k=k.Nb;var se=0<=k;return k=Math.abs(k)/60,(se?"+":"-")+("0000"+(k/60*100+k%60)).slice(-4)},"%Z":k=>k.Qb,"%%":()=>"%"},f=f.replace(/%%/g,"\\0\\0");for(ye in ce)f.includes(ye)&&(f=f.replace(new RegExp(ye,"g"),ce[ye]($)));return f=f.replace(/\\0\\0/g,"%"),ye=Ze(f),ye.length>c?0:(It(ye,i),ye.length-1)}var Nr=i=>{try{i()}catch(c){je(c)}};function Fu(){var i=j,c={};for(let[f,$]of Object.entries(i))c[f]=typeof $=="function"?function(){Wr.push(f);try{return $.apply(null,arguments)}finally{De||(Wr.pop(),pt&&Et===1&&Wr.length===0&&(Et=0,it+=1,Nr(Bo),typeof Fibers<"u"&&Fibers.Xb()))}}:$;return c}var Et=0,pt=null,bo=0,Wr=[],wo={},vo={},Ku=0,vn=null,qu=[];function ju(){return new Promise((i,c)=>{vn={resolve:i,reject:c}})}function Yu(){var i=$n(65548),c=i+12;s()[i>>>2>>>0]=c,s()[i+4>>>2>>>0]=c+65536,c=Wr[0];var f=wo[c];return f===void 0&&(f=Ku++,wo[c]=f,vo[f]=c),c=f,n()[i+8>>>2>>>0]=c,i}function Zu(){var i=n()[pt+8>>>2>>>0];return i=j[vo[i]],--it,i()}function Qu(i){if(!De){if(Et===0){var c=!1,f=!1;i(($=0)=>{if(!De&&(bo=$,c=!0,f)){Et=2,Nr(()=>ko(pt)),typeof Browser<"u"&&Browser.nb.Ab&&Browser.nb.resume(),$=!1;try{var T=Zu()}catch(Q){T=Q,$=!0}var R=!1;if(!pt){var z=vn;z&&(vn=null,($?z.reject:z.resolve)(T),R=!0)}if($&&!R)throw T}}),f=!0,c||(Et=1,pt=Yu(),typeof Browser<"u"&&Browser.nb.Ab&&Browser.nb.pause(),Nr(()=>Po(pt)))}else Et===2?(Et=0,Nr(Ro),_o(pt),pt=null,qu.forEach($=>{if(!De)try{$(),br()}catch(T){dr(T)}})):je(`invalid state: ${Et}`);return bo}}function Ju(i){return Qu(c=>{i().then(c)})}var Xt=[],st,er,$o=[],So=(i,c)=>{if(!er){er=new WeakMap;var f=st.length;if(er)for(var $=0;$<0+f;$++){var T=$,R=Xt[T];R||(T>=Xt.length&&(Xt.length=T+1),Xt[T]=R=st.get(T)),(T=R)&&er.set(T,$)}}if(f=er.get(i)||0)return f;if($o.length)f=$o.pop();else{try{st.grow(1)}catch(Q){throw Q instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":Q}f=st.length-1}try{$=f,st.set($,i),Xt[$]=st.get($)}catch(Q){if(!(Q instanceof TypeError))throw Q;if(typeof WebAssembly.Function=="function"){$=WebAssembly.Function,T={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},R={parameters:[],results:c[0]=="v"?[]:[T[c[0]]]};for(var z=1;z<c.length;++z)R.parameters.push(T[c[z]]);c=new $(R,i)}else{for($=[1],T=c.slice(0,1),c=c.slice(1),R={i:127,p:127,j:126,f:125,d:124,e:111},$.push(96),z=c.length,128>z?$.push(z):$.push(z%128|128,z>>7),z=0;z<c.length;++z)$.push(R[c[z]]);T=="v"?$.push(0):$.push(1,R[T]),c=[0,97,115,109,1,0,0,0,1],T=$.length,128>T?c.push(T):c.push(T%128|128,T>>7),c.push.apply(c,$),c.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),c=new WebAssembly.Module(new Uint8Array(c)),c=new WebAssembly.Instance(c,{e:{f:i}}).exports.f}$=f,st.set($,c),Xt[$]=st.get($)}return er.set(i,f),f};ne.mb();var Xu=[ur,lr,kr,Rr,Dr,xt,rt,_t,mr,fr,zr,oe,hr,Zt,gr,yr,Vr,Mt,N,L,X,pe,me,ue],ed={r:function(i,c,f){return Ju(async()=>{await a.Eb(i,c,f)})},b:function(i,c,f){throw i>>>=0,new jt(i).mb(c>>>0,f>>>0),cr=i,Br++,cr},P:function(i){Co(i>>>0,!_,1,!y,131072,!1),ne.tb()},n:function(i){i>>>=0,x?postMessage({cmd:"cleanupThread",thread:i}):ne.rb(ne.$a[i])},L:Yt,i:Rr,V:Dr,H:xt,J:rt,z:_t,T:mr,N:fr,S:zr,p:oe,I:hr,F:Zt,U:gr,G:yr,Y:()=>1,D:function(i,c){i>>>=0,i==c>>>0?setTimeout(()=>Dt()):x?postMessage({targetThread:i,cmd:"checkMailbox"}):(i=ne.$a[i])&&i.postMessage({cmd:"checkMailbox"})},M:function(i,c,f,$){c>>>=0,Jt.length=f,$=$>>>0>>>3;for(var T=0;T<f;T++)Jt[T]=l()[$+T>>>0];return i=0>i?Lt[-i-1]:Xu[i],ne.zb=c,c=i.apply(null,Jt),ne.zb=0,c},O:Qt,X:function(i){I&&ne.$a[i>>>0].ref()},u:function(i,c,f){i=c+2097152>>>0<4194305-!!i?(i>>>0)+4294967296*c:NaN,f>>>=0,i=new Date(1e3*i),n()[f>>>2>>>0]=i.getUTCSeconds(),n()[f+4>>>2>>>0]=i.getUTCMinutes(),n()[f+8>>>2>>>0]=i.getUTCHours(),n()[f+12>>>2>>>0]=i.getUTCDate(),n()[f+16>>>2>>>0]=i.getUTCMonth(),n()[f+20>>>2>>>0]=i.getUTCFullYear()-1900,n()[f+24>>>2>>>0]=i.getUTCDay(),i=(i.getTime()-Date.UTC(i.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,n()[f+28>>>2>>>0]=i},v:function(i,c,f){i=c+2097152>>>0<4194305-!!i?(i>>>0)+4294967296*c:NaN,f>>>=0,i=new Date(1e3*i),n()[f>>>2>>>0]=i.getSeconds(),n()[f+4>>>2>>>0]=i.getMinutes(),n()[f+8>>>2>>>0]=i.getHours(),n()[f+12>>>2>>>0]=i.getDate(),n()[f+16>>>2>>>0]=i.getMonth(),n()[f+20>>>2>>>0]=i.getFullYear()-1900,n()[f+24>>>2>>>0]=i.getDay(),c=(Ct(i.getFullYear())?wr:vr)[i.getMonth()]+i.getDate()-1|0,n()[f+28>>>2>>>0]=c,n()[f+36>>>2>>>0]=-(60*i.getTimezoneOffset()),c=new Date(i.getFullYear(),6,1).getTimezoneOffset();var $=new Date(i.getFullYear(),0,1).getTimezoneOffset();i=(c!=$&&i.getTimezoneOffset()==Math.min($,c))|0,n()[f+32>>>2>>>0]=i},w:function(i){i>>>=0;var c=new Date(n()[i+20>>>2>>>0]+1900,n()[i+16>>>2>>>0],n()[i+12>>>2>>>0],n()[i+8>>>2>>>0],n()[i+4>>>2>>>0],n()[i>>>2>>>0],0),f=n()[i+32>>>2>>>0],$=c.getTimezoneOffset(),T=new Date(c.getFullYear(),6,1).getTimezoneOffset(),R=new Date(c.getFullYear(),0,1).getTimezoneOffset(),z=Math.min(R,T);return 0>f?n()[i+32>>>2>>>0]=+(T!=R&&z==$):0<f!=(z==$)&&(T=Math.max(R,T),c.setTime(c.getTime()+6e4*((0<f?z:T)-$))),n()[i+24>>>2>>>0]=c.getDay(),f=(Ct(c.getFullYear())?wr:vr)[c.getMonth()]+c.getDate()-1|0,n()[i+28>>>2>>>0]=f,n()[i>>>2>>>0]=c.getSeconds(),n()[i+4>>>2>>>0]=c.getMinutes(),n()[i+8>>>2>>>0]=c.getHours(),n()[i+12>>>2>>>0]=c.getDate(),n()[i+16>>>2>>>0]=c.getMonth(),n()[i+20>>>2>>>0]=c.getYear(),i=c.getTime(),isNaN(i)?(n()[xo()>>>2>>>0]=61,i=-1):i/=1e3,To((St=i,1<=+Math.abs(St)?0<St?+Math.floor(St/4294967296)>>>0:~~+Math.ceil((St-+(~~St>>>0))/4294967296)>>>0:0)),i>>>0},s:Vr,t:Mt,C:function(i,c,f){function $(ce){return(ce=ce.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?ce[1]:"GMT"}i>>>=0,c>>>=0,f>>>=0;var T=new Date().getFullYear(),R=new Date(T,0,1),z=new Date(T,6,1);T=R.getTimezoneOffset();var Q=z.getTimezoneOffset(),be=Math.max(T,Q);s()[i>>>2>>>0]=60*be,n()[c>>>2>>>0]=+(T!=Q),i=$(R),c=$(z),i=$r(i),c=$r(c),Q<T?(s()[f>>>2>>>0]=i,s()[f+4>>>2>>>0]=c):(s()[f>>>2>>>0]=c,s()[f+4>>>2>>>0]=i)},d:()=>{je("")},c:function(i,c,f){return i>>>=0,c=m(c>>>0,f>>>0),Lt[i].apply(null,c)},k:function(i,c,f){return i>>>=0,c=m(c>>>0,f>>>0),Lt[i].apply(null,c)},o:()=>{},q:()=>Date.now(),W:()=>{throw it+=1,"unwind"},E:function(){return 4294901760},f:()=>performance.timeOrigin+performance.now(),g:()=>I?(Ho(),Ot(Go)).cpus().length:navigator.hardwareConcurrency,A:function(i){i>>>=0;var c=o().length;if(i<=c||4294901760<i)return!1;for(var f=1;4>=f;f*=2){var $=c*(1+.2/f);$=Math.min($,i+100663296);var T=Math;$=Math.max(i,$);e:{T=(T.min.call(T,4294901760,$+(65536-$%65536)%65536)-ee.buffer.byteLength+65535)/65536;try{ee.grow(T),Fe();var R=1;break e}catch{}R=void 0}if(R)return!0}return!1},Q:N,R:L,K:qt,h:X,m:pe,x:me,l:ue,y:function(i,c){return i>>>=0,c>>>=0,B(o().subarray(i>>>0,i+c>>>0)),0},a:ee||a.wasmMemory,B:yo,e:function(i,c,f,$){return yo(i>>>0,c>>>0,f>>>0,$>>>0)},j:function(i,c,f,$){let T=st.length;i=new Uint8Array(o().slice(i+c,i+f));try{var R=new WebAssembly.Module(i),z=new WebAssembly.Instance(R,{env:{memory:ee}}),Q;for(Q in z.exports)So(z.exports[Q]);return T<st.length?T:$}catch(be){return console.log(be),$}}},j=function(){function i(f,$){return j=f.exports,j=Fu(),j=td(),ne.ub.push(j.Ha),st=j.Ia,Ce.unshift(j.Z),Te=$,Ne(),j}var c={a:ed};if(Me++,a.instantiateWasm)try{return a.instantiateWasm(c,i)}catch(f){Z(`Module.instantiateWasm callback failed with error: ${f}`),h(f)}return Tt(c,function(f){i(f.instance,f.module)}).catch(h),{}}();a._OrtInit=(i,c)=>(a._OrtInit=j._)(i,c),a._OrtGetLastError=(i,c)=>(a._OrtGetLastError=j.$)(i,c),a._OrtCreateSessionOptions=(i,c,f,$,T,R,z,Q,be,ce)=>(a._OrtCreateSessionOptions=j.aa)(i,c,f,$,T,R,z,Q,be,ce),a._OrtAppendExecutionProvider=(i,c)=>(a._OrtAppendExecutionProvider=j.ba)(i,c),a._OrtAddFreeDimensionOverride=(i,c,f)=>(a._OrtAddFreeDimensionOverride=j.ca)(i,c,f),a._OrtAddSessionConfigEntry=(i,c,f)=>(a._OrtAddSessionConfigEntry=j.da)(i,c,f),a._OrtReleaseSessionOptions=i=>(a._OrtReleaseSessionOptions=j.ea)(i),a._OrtCreateSession=(i,c,f)=>(a._OrtCreateSession=j.fa)(i,c,f),a._OrtReleaseSession=i=>(a._OrtReleaseSession=j.ga)(i),a._OrtGetInputOutputCount=(i,c,f)=>(a._OrtGetInputOutputCount=j.ha)(i,c,f),a._OrtGetInputName=(i,c)=>(a._OrtGetInputName=j.ia)(i,c),a._OrtGetOutputName=(i,c)=>(a._OrtGetOutputName=j.ja)(i,c),a._OrtFree=i=>(a._OrtFree=j.ka)(i),a._OrtCreateTensor=(i,c,f,$,T,R)=>(a._OrtCreateTensor=j.la)(i,c,f,$,T,R),a._OrtGetTensorData=(i,c,f,$,T)=>(a._OrtGetTensorData=j.ma)(i,c,f,$,T),a._OrtReleaseTensor=i=>(a._OrtReleaseTensor=j.na)(i),a._OrtCreateRunOptions=(i,c,f,$)=>(a._OrtCreateRunOptions=j.oa)(i,c,f,$),a._OrtAddRunConfigEntry=(i,c,f)=>(a._OrtAddRunConfigEntry=j.pa)(i,c,f),a._OrtReleaseRunOptions=i=>(a._OrtReleaseRunOptions=j.qa)(i),a._OrtCreateBinding=i=>(a._OrtCreateBinding=j.ra)(i),a._OrtBindInput=(i,c,f)=>(a._OrtBindInput=j.sa)(i,c,f),a._OrtBindOutput=(i,c,f,$)=>(a._OrtBindOutput=j.ta)(i,c,f,$),a._OrtClearBoundOutputs=i=>(a._OrtClearBoundOutputs=j.ua)(i),a._OrtReleaseBinding=i=>(a._OrtReleaseBinding=j.va)(i),a._OrtRunWithBinding=(i,c,f,$,T)=>(a._OrtRunWithBinding=j.wa)(i,c,f,$,T),a._OrtRun=(i,c,f,$,T,R,z,Q)=>(a._OrtRun=j.xa)(i,c,f,$,T,R,z,Q),a._OrtEndProfiling=i=>(a._OrtEndProfiling=j.ya)(i),a._OrtConfigure=(i,c)=>(a._OrtConfigure=j.za)(i,c),a._OrtAuth=(i,c)=>(a._OrtAuth=j.Aa)(i,c),a._JsepOutput=(i,c,f)=>(a._JsepOutput=j.Ba)(i,c,f),a._JsepGetNodeName=i=>(a._JsepGetNodeName=j.Ca)(i);var xo=()=>(xo=j.Da)(),Gr=a._pthread_self=()=>(Gr=a._pthread_self=j.Ea)(),$n=a._malloc=i=>($n=a._malloc=j.Fa)(i),_o=a._free=i=>(_o=a._free=j.Ga)(i);a.__emscripten_tls_init=()=>(a.__emscripten_tls_init=j.Ha)();var Co=a.__emscripten_thread_init=(i,c,f,$,T,R)=>(Co=a.__emscripten_thread_init=j.Ja)(i,c,f,$,T,R);a.__emscripten_thread_crashed=()=>(a.__emscripten_thread_crashed=j.Ka)();var Io=(i,c,f,$)=>(Io=j.La)(i,c,f,$),Sn=i=>(Sn=j.Ma)(i),xn=a.__emscripten_thread_exit=i=>(xn=a.__emscripten_thread_exit=j.Na)(i),Ao=()=>(Ao=j.Oa)(),To=i=>(To=j.Pa)(i),Eo=(i,c)=>(Eo=j.Qa)(i,c),_n=()=>(_n=j.Ra)(),Hr=i=>(Hr=j.Sa)(i),Cn=i=>(Cn=j.Ta)(i),Oo=a.dynCall_ii=(i,c)=>(Oo=a.dynCall_ii=j.Va)(i,c),Po=i=>(Po=j.Wa)(i),Bo=()=>(Bo=j.Xa)(),ko=i=>(ko=j.Ya)(i),Ro=()=>(Ro=j.Za)();a.___start_em_js=914981,a.___stop_em_js=915754;function td(){var i=j;i=Object.assign({},i);var c=$=>()=>$()>>>0,f=$=>T=>$(T)>>>0;return i.Da=c(i.Da),i.Ea=c(i.Ea),i.Fa=f(i.Fa),i.emscripten_main_runtime_thread_id=c(i.emscripten_main_runtime_thread_id),i.Ra=c(i.Ra),i.Ta=f(i.Ta),i}a.wasmMemory=ee,a.stackAlloc=Cn,a.stackSave=_n,a.stackRestore=Hr,a.keepRuntimeAlive=()=>0<it,a.addFunction=So,a.UTF8ToString=Ye,a.stringToUTF8=Ur,a.lengthBytesUTF8=pr,a.ExitStatus=Ft,a.PThread=ne;var Lr;at=function i(){Lr||Do(),Lr||(at=i)};function Do(){if(!(0<Me))if(x)p(a),x||Je(Ce),startWorker(a);else{if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)J.unshift(a.preRun.shift());Je(J),0<Me||Lr||(Lr=!0,a.calledRun=!0,De||(x||Je(Ce),p(a),x||Je($t)))}}return Do(),t.ready}})();typeof Fo=="object"&&typeof Rn=="object"?Rn.exports=Lo:typeof define=="function"&&define.amd&&define([],()=>Lo)});var qo=Sr((up,cd)=>{cd.exports=\'"use strict";var Module={},ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads"),parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",e=>onmessage({data:e}));var fs=require("fs"),vm=require("vm");Object.assign(global,{self:global,require,Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:e=>vm.runInThisContext(fs.readFileSync(e,"utf8"),{filename:e}),postMessage:e=>parentPort.postMessage(e),performance:global.performance||{now:Date.now}})}var initializedJS=!1;function threadPrintErr(){var e=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,e+`\\n`);return}console.error(e)}function threadAlert(){var e=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:e,threadId:Module._pthread_self()})}var err=threadPrintErr;self.alert=threadAlert,Module.instantiateWasm=(e,t)=>{var a=Module.wasmModule;Module.wasmModule=null;var r=new WebAssembly.Instance(a,e);return t(r)},self.onunhandledrejection=e=>{throw e.reason||e};function handleMessage(e){try{if(e.data.cmd==="load"){let a=[];self.onmessage=r=>a.push(r),self.startWorker=r=>{Module=r,postMessage({cmd:"loaded"});for(let s of a)handleMessage(s);self.onmessage=handleMessage},Module.wasmModule=e.data.wasmModule;for(const r of e.data.handlers)Module[r]=(...s)=>{postMessage({cmd:"callHandler",handler:r,args:s})};if(Module.wasmMemory=e.data.wasmMemory,Module.buffer=Module.wasmMemory.buffer,Module.ENVIRONMENT_IS_PTHREAD=!0,typeof e.data.urlOrBlob=="string")importScripts(e.data.urlOrBlob);else{var t=URL.createObjectURL(e.data.urlOrBlob);importScripts(t),URL.revokeObjectURL(t)}ortWasmThreaded(Module)}else if(e.data.cmd==="run"){Module.__emscripten_thread_init(e.data.pthread_ptr,0,0,1),Module.__emscripten_thread_mailbox_await(e.data.pthread_ptr),Module.establishStackSpace(),Module.PThread.receiveObjectTransfer(e.data),Module.PThread.threadInitTLS(),initializedJS||(initializedJS=!0);try{Module.invokeEntryPoint(e.data.start_routine,e.data.arg)}catch(a){if(a!="unwind")throw a}}else e.data.cmd==="cancel"?Module._pthread_self()&&Module.__emscripten_thread_exit(-1):e.data.target==="setimmediate"||(e.data.cmd==="checkMailbox"?initializedJS&&Module.checkMailbox():e.data.cmd&&(err(`worker.js received unknown command ${e.data.cmd}`),err(e.data)))}catch(a){throw Module.__emscripten_thread_crashed?.(),a}}self.onmessage=handleMessage;\\n\'});var Un,nt,Cr,Kr,Ir,Xo,zn,We=q(()=>{"use strict";Un=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${e}`)}},nt=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${e}`)}},Cr=e=>[void 0,4,1,1,2,2,4,8,void 0,1,2,8,4,8,void 0,void 0,void 0][e],Kr=e=>{switch(e){case"float16":return Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},Ir=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},Xo=e=>e==="float32"||e==="int32"||e==="int64"||e==="bool"||e==="float16"||e==="uint32",zn=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;default:throw new Error(`unsupported data location: ${e}`)}}});var qr=q(()=>{"use strict"});var ta=q(()=>{"use strict";qr()});var ra,na=q(()=>{"use strict";ra="1.17.0"});var oa,zt,Vn=q(()=>{"use strict";na();oa="warning",zt={wasm:{},webgl:{},webgpu:{},versions:{common:ra},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);oa=e}},get logLevel(){return oa}};Object.defineProperty(zt,"logLevel",{enumerable:!0})});var tr,aa=q(()=>{"use strict";Vn();tr=zt});var ia=q(()=>{"use strict"});var sa=q(()=>{"use strict";jr()});var da=q(()=>{"use strict"});var la=q(()=>{"use strict";jr()});var jr=q(()=>{"use strict";ia();sa();da();la()});var Yr=q(()=>{"use strict";jr()});var Nn,ca,Vt,Nt,Wn=q(()=>{"use strict";Vn();Nn=(e,t)=>{zt.wasm.trace&&console.timeStamp(`${e}::ORT::${t}`)},ca=(e,t)=>{let r=new Error().stack?.split(/\\r\\n|\\r|\\n/g)||[],o=!1;for(let n=0;n<r.length;n++){if(o&&!r[n].includes("TRACE_FUNC")){let s=`FUNC_${e}::${r[n].trim().split(" ")[1]}`;t&&(s+=`::${t}`),Nn("CPU",s);return}r[n].includes("TRACE_FUNC")&&(o=!0)}},Vt=e=>{zt.wasm.trace&&ca("BEGIN",e)},Nt=e=>{zt.wasm.trace&&ca("END",e)}});var pa=q(()=>{"use strict";qr();Yr();Wn()});var ma=q(()=>{"use strict";pa()});var fa=q(()=>{"use strict"});var ha=q(()=>{"use strict";qr();Yr()});var ga=q(()=>{"use strict";ha()});var rr=q(()=>{"use strict";ta();aa();ma();Yr();Wn();fa();ga()});var Sd,xd,ya,ba,wa,_d,Re,Pt=q(()=>{"use strict";We();Sd=["V","I","W","E","F"],xd=(e,t)=>{console.log(`[${Sd[e]},${new Date().toISOString()}]${t}`)},wa=(e,t)=>{ya=e,ba=t},_d=(e,t)=>{let r=Ir(e),o=Ir(ya);r>=o&&xd(r,typeof t=="function"?t():t)},Re=(...e)=>{ba&&_d(...e)}});var va,$a=q(()=>{"use strict";We();va=(e,t)=>new(Kr(t))(e)});var Zr=q(()=>{"use strict"});var Qr,Cd,Sa,Id,Gn,Ln,Hn,_a,Ca=q(()=>{"use strict";Pt();Zr();Qr=e=>Math.ceil(e/16)*16,Cd=1,Sa=()=>Cd++,Id=1,Gn=()=>Id++,Ln=async(e,t,r,o)=>{let n=Qr(r),s=e.device.createBuffer({size:n,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let u=e.getCommandEncoder();e.endComputePass(),u.copyBufferToBuffer(t,0,s,0,n),e.flush(),await s.mapAsync(GPUMapMode.READ);let l=s.getMappedRange();if(o){let a=o();return a.set(new Uint8Array(l,0,r)),a}else return new Uint8Array(l.slice(0,r))}finally{s.destroy()}},Hn=class{constructor(t){this.backend=t;this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersForUploadingPending=[],this.buffersPending=[],this.externalBuffers=new Map,this.capturedPendingBuffers=new Map}upload(t,r){let o=r.buffer,n=r.byteOffset,s=r.byteLength,u=Qr(s),l=this.storageCache.get(t);if(!l)throw new Error("gpu data for uploading does not exist");if(l.originalSize!==s)throw new Error(`inconsistent data size. gpu data size=${l.originalSize}, data size=${s}`);let a=this.backend.device.createBuffer({mappedAtCreation:!0,size:u,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),p=a.getMappedRange();new Uint8Array(p).set(new Uint8Array(o,n,s)),a.unmap();let h=this.backend.getCommandEncoder();this.backend.endComputePass(),h.copyBufferToBuffer(a,0,l.gpuData.buffer,0,u),Re("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${t})`),this.buffersForUploadingPending.push(a)}memcpy(t,r){let o=this.storageCache.get(t);if(!o)throw new Error("source gpu data for memcpy does not exist");let n=this.storageCache.get(r);if(!n)throw new Error("destination gpu data for memcpy does not exist");if(o.originalSize!==n.originalSize)throw new Error("inconsistent source and destination gpu data size");let s=Qr(o.originalSize),u=this.backend.getCommandEncoder();this.backend.endComputePass(),u.copyBufferToBuffer(o.gpuData.buffer,0,n.gpuData.buffer,0,s)}registerExternalBuffer(t,r,o){let n;if(o){if(n=this.externalBuffers.get(o),n===void 0)throw new Error("previous buffer is not registered");if(t===o)return Re("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${r}) => id=${n}, buffer is the same, skip.`),n;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.\n             Please use the previous external buffer!`);this.externalBuffers.delete(o)}else n=Sa();return this.storageCache.set(n,{gpuData:{id:n,type:0,buffer:t,permamentID:Gn()},originalSize:r}),this.externalBuffers.set(t,n),Re("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${r}) => id=${n}, registered.`),n}unregisterExternalBuffer(t){let r=this.externalBuffers.get(t);r!==void 0&&(this.storageCache.delete(r),this.externalBuffers.delete(t),Re("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${r}`))}create(t,r=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let o=Qr(t),n,s=(r&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,u=(r&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(s||u){let a=s?this.freeBuffers:this.freeUniformBuffers,p=a.get(o);p||(p=[],a.set(o,p)),p.length>0?n=p.pop():n={buffer:this.backend.device.createBuffer({size:o,usage:r}),permamentID:Gn()}}else n={buffer:this.backend.device.createBuffer({size:o,usage:r}),permamentID:Gn()};let l={id:Sa(),type:0,buffer:n.buffer,permamentID:n.permamentID};return this.storageCache.set(l.id,{gpuData:l,originalSize:t}),Re("verbose",()=>`[WebGPU] GpuDataManager.create(size=${t}) => id=${l.id}`),l}get(t){return this.storageCache.get(t)?.gpuData}release(t){let r=this.storageCache.get(t);if(!r)throw new Error("releasing data does not exist");return Re("verbose",()=>`[WebGPU] GpuDataManager.release(id=${t}), gpuDataId=${r.gpuData.id}`),this.storageCache.delete(t),this.buffersPending.push({buffer:r.gpuData.buffer,permamentID:r.gpuData.permamentID}),r.originalSize}async download(t,r){let o=this.storageCache.get(t);if(!o)throw new Error("data does not exist");await Ln(this.backend,o.gpuData.buffer,o.originalSize,r)}refreshPendingBuffers(){for(let t of this.buffersForUploadingPending)t.destroy();if(this.buffersForUploadingPending=[],this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let t of this.buffersPending)(t.buffer.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE?this.freeBuffers.get(t.buffer.size).push(t):(t.buffer.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM?this.freeUniformBuffers.get(t.buffer.size).push(t):t.buffer.destroy();this.buffersPending=[]}else{let t=this.capturedPendingBuffers.get(this.backend.currentSessionId);t||(t=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,t));for(let r of this.buffersPending)t.push(r);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(t=>{t.forEach(r=>{r.buffer.destroy()})}),this.freeUniformBuffers.forEach(t=>{t.forEach(r=>{r.buffer.destroy()})}),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(t=>{t.forEach(r=>{r.buffer.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onReleaseSession(t){let r=this.capturedPendingBuffers.get(t);r&&(r.forEach(o=>{o.buffer.destroy()}),this.capturedPendingBuffers.delete(t))}},_a=(...e)=>new Hn(...e)});var Fn,he,Le=q(()=>{"use strict";Fn=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(t=>`${this[t]}`).join(";")),this.key}},he=e=>new Fn(e)});var Kn,mt,V,Wt,Jr,Xr,en,xe=q(()=>{"use strict";Kn=class{static calcMatMulShape(t,r){return t[1]!==r[0]?void 0:[t[0],r[1]]}},mt=class{static calcShape(t,r,o=!1){let n=t.length,s=r.length;if(n===0)return r;if(s===0)return t;let u=Math.max(t.length,r.length),l=new Array(u);if(o){if(n<2||s<2)return;let a=Kn.calcMatMulShape([t[n-2],t[n-1]],[r[s-2],r[s-1]]);if(a===void 0)return;[l[u-2],l[u-1]]=a}for(let a=o?3:1;a<=u;a++){let p=n-a<0?1:t[n-a],h=s-a<0?1:r[s-a];if(p!==h&&p>1&&h>1)return;l[u-a]=Math.max(p,h)}return l}static isValidBroadcast(t,r){let o=t.length,n=r.length;if(o>n)return!1;for(let s=1;s<=o;s++)if(t[o-s]!==1&&t[o-s]!==r[n-s])return!1;return!0}},V=class e{static size(t){return e.getSizeFromDimensionRange(t,0,t.length)}static sizeFromDimension(t,r){if(r<0||r>t.length)throw new Error(`invalid dimension of ${r} for sizeFromDimension as Tensor has ${t.length} dimensions.`);return e.getSizeFromDimensionRange(t,r,t.length)}static sizeToDimension(t,r){if(r<0||r>t.length)throw new Error(`invalid dimension of ${r} for sizeToDimension as Tensor has ${t.length} dimensions.`);return e.getSizeFromDimensionRange(t,0,r)}static getSizeFromDimensionRange(t,r,o){let n=1;for(let s=r;s<o;s++){if(t[s]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");n*=t[s]}return n}static computeStrides(t){let r=t.length;if(r===0)return[];if(r===1)return[1];let o=new Array(r);o[r-1]=1,o[r-2]=t[r-1];for(let n=r-3;n>=0;--n)o[n]=o[n+1]*t[n+1];return o}static normalizeAxis(t,r){if(t<-r&&t>=r)throw new Error("unsupported axis for this operation.");return t<0?t+r:t}static normalizeAxes(t,r){return t.map(o=>this.normalizeAxis(o,r??t.length))}static sortBasedOnPerm(t,r){return r?r.map(o=>t[o]):t.slice().reverse()}static padShape(t,r){let o=t.length;return t.map((n,s)=>n+r[s]+r[s+o])}static areEqual(t,r){return t.length!==r.length?!1:t.every((o,n)=>o===r[n])}},Wt=class e{static adjustPoolAttributes(t,r,o,n,s,u){if(!t&&o.length!==r.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let l=0;l<r.length-2;l++)l>=o.length?o.push(r[l+2]):o[l]=r[l+2];for(let l=0;l<o.length;l++)if(l<n.length){if(n[l]<0)throw new Error("strides should be greater than or equal to 1")}else n.push(1);for(let l=0;l<o.length;l++)if(l<s.length){if(s[l]<0)throw new Error("dilations should be greater than or equal to 1")}else s.push(1);for(let l=0;l<o.length*2;l++)if(l<u.length){if(u[l]<0)throw new Error("pad should be greater than or equal to 1")}else u.push(0);for(let l=0;l<o.length;l++){if(o[l]<=0)throw new Error("kernel shapes need to be greater than 0");if(u[l]>=o[l]||u[l+o.length]>=o[l])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(t,r,o,n,s,u,l){if(l){if(s.length!==2*(t.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(r.length!==t.length-2)throw new Error("length of strides should be the length of data dimensions");if(n.length!==t.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let a=0;a<t.length-2;a++)e.adjustPadAndReturnShape(t[a+(u?1:2)],r[a],o[a],n[a],s,a,a+t.length-2,l)}}static computePoolOutputShape(t,r,o,n,s,u,l){if(r.length<=0)throw new Error("input shape must be of size greater than 0");let a=[r[0],r[1]];return e.computeShapeHelper(t,r,a,o,n,s,u,l),a}static computeConvOutputShape(t,r,o,n,s,u,l){if(t.length<=0||r.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let a=[t[0],r[0]];return e.computeShapeHelper(!1,t,a,o,n,s,u,l),a}static computeShapeHelper(t,r,o,n,s,u,l,a){if(t)for(let p=0;p<r.length-2;p++)o.push(1);else for(let p=0;p<r.length-2;p++)o.push(e.adjustPadAndReturnShape(r[p+2],n[p],s[p],u[p],l,p,p+r.length-2,a))}static adjustPadAndReturnShape(t,r,o,n,s,u,l,a){let p=o*(n-1)+1;if(a&&a!=="NOTSET")switch(a){case"VALID":return s[u]=0,s[l]=0,Math.floor((t-p)/r+1);case"SAME_LOWER":case"SAME_UPPER":if(o!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let g=((t+r-1)/r-1)*r+n-t;return s[u]=Math.floor(a==="SAME_LOWER"?(g+1)/2:g/2),s[l]=g-s[u],Math.floor((t+g-n)/r+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((t+s[u]+s[l]-p)/r+1)}},Jr=class{static getShapeOfGemmResult(t,r,o,n,s){if(t.length!==2||o.length!==2)throw new Error("shape need to be of size 2");let u,l,a;r?(u=t[1],l=t[0]):(u=t[0],l=t[1]);let p=-1;if(n?(a=o[0],p=1):(a=o[1],p=0),o[p]!==l)throw new Error("dimension mismatch");if(u<=0||a<=0||l<=0)throw new Error("invalid shape specified");if(s&&!mt.isValidBroadcast(s,[u,a]))throw new Error("gemm: invalid bias shape for broadcast");return[u,a,l]}},Xr=-34028234663852886e22,en=34028234663852886e22});var Ad,jn,Ge,ft,F,He,Qe,ut,ot,de,Yn,U,K,tn,qn,Ia,nr,Ue,$e=q(()=>{"use strict";We();xe();Ad=64,jn=(e,t)=>{if(t===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(e){case 10:return t>1?`vec${t}<f16>`:"f16";case 1:return t>1?`vec${t}<f32>`:"f32";case 6:return t>1?`vec${t}<i32>`:"i32";case 12:return t>1?`vec${t}<u32>`:"u32";case 7:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(t!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];default:throw new Error(`Unknown data type: ${e}`)}},Ge=(e,t=1)=>{let r=jn(e,t);return typeof r=="string"?r:r[0]},ft=(e,t=1)=>{let r=jn(e,t);return typeof r=="string"?r:r[1]},F=e=>e.length===0?[]:[{type:"uint32",data:e},{type:"uint32",data:V.computeStrides(e)}],He=e=>e%4===0?4:e%2===0?2:1,Qe=(e="f32",t,r="0")=>!t||t===1?`${e}(${r})`:`vec${t}<${e}>(${r})`,ut=(e,t,r)=>e==="f32"?r:t===1?`f32(${r})`:`vec${t}f(${r})`,ot=(e,t)=>t===4?`(${e}.x + ${e}.y + ${e}.z + ${e}.w)`:t===2?`(${e}.x + ${e}.y)`:t===3?`(${e}.x + ${e}.y + ${e}.z)`:e,de=(e,t,r)=>e.startsWith("uniforms.")&&r>4?typeof t=="string"?`${e}[(${t}) / 4][(${t}) % 4]`:`${e}[${Math.floor(t/4)}][${t%4}]`:r>1?`${e}[${t}]`:e,Yn=(e,t,r,o,n)=>{let s=typeof r=="number",u=s?r:r.length,l=[...new Array(u).keys()],a=u<2?"u32":u<=4?`vec${u}<u32>`:`array<u32, ${u}>`,p=jn(t,n),h=typeof p=="string"?p:p[1],g=typeof p=="string"?p:p[0],w={indices:a,value:h,storage:g,tensor:t},v=H=>typeof H=="string"?H:`${H}u`,y={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},_=s?"uniforms.":"",I=`${_}${e}_shape`,x=`${_}${e}_strides`,A="";for(let H=0;H<u-1;H++)A+=`\n    let dim${H} = current / ${de(x,H,u)};\n    let rest${H} = current % ${de(x,H,u)};\n    indices[${H}] = dim${H};\n    current = rest${H};\n    `;A+=`indices[${u-1}] = current;`;let O=u<2?"":`\n  fn o2i_${e}(offset: u32) -> ${w.indices} {\n    var indices: ${w.indices};\n    var current = offset;\n    ${A}\n    return indices;\n  }`,C=H=>(y.offsetToIndices=!0,u<2?H:`o2i_${e}(${H})`),M=[];if(u>=2)for(let H=u-1;H>=0;H--)M.push(`${de(x,H,u)} * (indices[${H}])`);let D=u<2?"":`\n  fn i2o_${e}(indices: ${w.indices}) -> u32 {\n    return ${M.join("+")};\n  }`,G=H=>(y.indicesToOffset=!0,u<2?H:`i2o_${e}(${H})`),E=(...H)=>u===0?"0u":`${w.indices}(${H.map(v).join(",")})`,W=(H,J)=>u<2?`${H}`:`${de(H,J,u)}`,te=(H,J,Ce)=>u<2?`${H}=${Ce};`:`${de(H,J,u)}=${Ce};`,Y={},Z=(H,J)=>{y.broadcastedIndicesToOffset=!0;let Ce=`${J.name}broadcastedIndicesTo${e}Offset`;if(Ce in Y)return`${Ce}(${H})`;let $t=[];for(let Me=u-1;Me>=0;Me--){let tt=J.indicesGet("outputIndices",Me+J.rank-u);$t.push(`${W(x,Me)} * (${tt} % ${W(I,Me)})`)}return Y[Ce]=`fn ${Ce}(outputIndices: ${J.type.indices}) -> u32 {\n             return ${$t.length>0?$t.join("+"):"0u"};\n           }`,`${Ce}(${H})`},ee=(H,J)=>(()=>{if(w.storage===w.value)return`${e}[${H}]=${J};`;if(w.storage==="vec2<u32>"&&w.value==="i32")return`${e}[${H}]=vec2<u32>(u32(${J}), select(0u, 0xFFFFFFFFu, ${J} < 0));`;if(w.storage==="vec2<u32>"&&w.value==="u32")return`${e}[${H}]=vec2<u32>(u32(${J}), 0u);`;if(w.storage==="u32"&&w.value==="vec4<bool>")return`${e}[${H}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${J}));`;throw new Error(`not supported combination of storage type ${w.storage} and value type ${w.value} yet`)})(),Te=H=>(()=>{if(w.storage===w.value)return`${e}[${H}]`;if(w.storage==="vec2<u32>"&&w.value==="i32")return`i32(${e}[${H}].x)`;if(w.storage==="vec2<u32>"&&w.value==="u32")return`u32(${e}[${H}].x)`;if(w.storage==="u32"&&w.value==="vec4<bool>")return`vec4<bool>(bool(${e}[${H}] & 0xFFu), bool(${e}[${H}] & 0xFF00u), bool(${e}[${H}] & 0xFF0000u), bool(${e}[${H}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${w.storage} and value type ${w.value} yet`)})(),De=u<2?"":`\n  fn get_${e}ByIndices(indices: ${w.indices}) -> ${h} {\n    return ${Te(`i2o_${e}(indices)`)};\n  }`,re=u<2?"":(()=>{let H=l.map(Ce=>`d${Ce}: u32`).join(", "),J=l.map(Ce=>`d${Ce}`).join(", ");return`\n  fn get_${e}(${H}) -> ${h} {\n    return get_${e}ByIndices(${E(J)});\n  }`})(),Ie=(...H)=>{if(H.length!==u)throw new Error(`indices length must be ${u}`);let J=H.map(v).join(",");return u===0?Te("0u"):u===1?Te(J[0]):(y.get=!0,y.getByIndices=!0,y.indicesToOffset=!0,`get_${e}(${J})`)},Oe=H=>u<2?Te(H):(y.getByIndices=!0,y.indicesToOffset=!0,`get_${e}ByIndices(${H})`),ie=u<2?"":`\n  fn set_${e}ByIndices(indices: ${w.indices}, value: ${h}) {\n    ${ee(`i2o_${e}(indices)`,"value")}\n  }`,Se=u<2?"":(()=>{let H=l.map(Ce=>`d${Ce}: u32`).join(", "),J=l.map(Ce=>`d${Ce}`).join(", ");return`\n  fn set_${e}(${H}, value: ${h}) {\n    set_${e}ByIndices(${E(J)}, value);\n  }`})();return{impl:()=>{let H=[],J=!1;return y.offsetToIndices&&(H.push(O),J=!0),y.indicesToOffset&&(H.push(D),J=!0),y.broadcastedIndicesToOffset&&(Object.values(Y).forEach(Ce=>H.push(Ce)),J=!0),y.set&&(H.push(Se),J=!0),y.setByIndices&&(H.push(ie),J=!0),y.get&&(H.push(re),J=!0),y.getByIndices&&(H.push(De),J=!0),!s&&J&&H.unshift(`const ${I} = ${w.indices}(${r.join(",")});`,`const ${x} = ${w.indices}(${V.computeStrides(r).join(",")});`),H.join(`\n`)},type:w,offsetToIndices:C,indicesToOffset:G,broadcastedIndicesToOffset:Z,indices:E,indicesGet:W,indicesSet:te,set:(...H)=>{if(H.length!==u+1)throw new Error(`indices length must be ${u}`);let J=H[u];if(typeof J!="string")throw new Error("value must be string");let Ce=H.slice(0,u).map(v).join(",");return u===0?ee("0u",J):u===1?ee(Ce[0],J):(y.set=!0,y.setByIndices=!0,y.indicesToOffset=!0,`set_${e}(${Ce}, ${J})`)},setByOffset:ee,setByIndices:(H,J)=>u<2?ee(H,J):(y.setByIndices=!0,y.indicesToOffset=!0,`set_${e}ByIndices(${H}, ${J});`),get:Ie,getByOffset:Te,getByIndices:Oe,usage:o,name:e,strides:x,shape:I,rank:u}},U=(e,t,r,o=1)=>Yn(e,t,r,"input",o),K=(e,t,r,o=1)=>Yn(e,t,r,"output",o),tn=(e,t,r,o=1)=>Yn(e,t,r,"internal",o),qn=class{constructor(t){this.normalizedDispatchGroup=t;this.internalVariables=[];this.variables=[];this.uniforms=[];this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(t){return`if (global_idx >= ${typeof t=="number"?`${t}u`:t}) { return; }`}mainStart(t=Ad){let r=typeof t=="number"?t:t[0],o=typeof t=="number"?1:t[1],n=typeof t=="number"?1:t[2],s=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,u=s?`@builtin(global_invocation_id) global_id : vec3<u32>,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(local_invocation_id) local_id : vec3<u32>,\n    @builtin(local_invocation_index) local_idx : u32,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(num_workgroups) num_workgroups : vec3<u32>`,l=s?"let global_idx = global_id.x; let local_idx = local_id.x;":`let global_idx = (workgroup_id.z * num_workgroups[0] * num_workgroups[1] +\n          workgroup_id.y * num_workgroups[0] + workgroup_id.x) * ${r*o*n}u + local_idx;`;return`@compute @workgroup_size(${r}, ${o}, ${n})\n  fn main(${u}) {\n    ${l}\n  `}appendVariableUniforms(t){t.rank!==0&&(t.shape.startsWith("uniforms.")&&this.uniforms.push({name:t.shape.replace("uniforms.",""),type:"u32",length:t.rank}),t.strides.startsWith("uniforms.")&&this.uniforms.push({name:t.strides.replace("uniforms.",""),type:"u32",length:t.rank}))}declareVariable(t,r){if(t.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(t),this.appendVariableUniforms(t);let o=t.usage==="input"?"read":"read_write",n=t.type.storage;return`@group(0) @binding(${r}) var<storage, ${o}> ${t.name}: array<${n}>;`}declareVariables(...t){return t.map(r=>this.declareVariable(r,this.variableIndex++)).join(`\n`)}registerInternalVariable(t){if(t.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(t),this.appendVariableUniforms(t)}registerInternalVariables(...t){return t.forEach(r=>this.registerInternalVariable(r)),this}registerUniform(t,r,o=1){return this.uniforms.push({name:t,type:r,length:o}),this}registerUniforms(t){return this.uniforms=this.uniforms.concat(t),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let t=[];for(let{name:r,type:o,length:n}of this.uniforms)if(n&&n>4)t.push(`${r}:array<vec4<${o}>, ${Math.ceil(n/4)}>`);else{let s=n==null||n===1?o:`vec${n}<${o}>`;t.push(`${r}:${s}`)}return`\n      struct Uniforms { ${t.join(", ")} };\n      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(t=>t.impl()).join(`\n`)+this.internalVariables.map(t=>t.impl()).join(`\n`)}},Ia=e=>new qn(e),nr=(e,t)=>{let r=e.length,o=[];for(let n=0;n<r;n++){let s=r-1-n,u=e[s]||1;(t[t.length-1-n]||1)>1&&u===1&&o.unshift(s)}return o},Ue=e=>!0});var Td,Aa,Ed,Od,dt,Ta,Ea,or=q(()=>{"use strict";xe();Le();$e();Td=e=>{if(!e||e.length!==1)throw new Error("Transpose requires 1 input.")},Aa=(e,t)=>t&&t.length!==e?[...new Array(e).keys()].reverse():t,Ed=(e,t)=>V.sortBasedOnPerm(e,Aa(e.length,t)),Od=(e,t,r,o)=>{let n=[];n.push(`fn perm(i: ${o.type.indices}) -> ${r.type.indices} {\n    var a: ${r.type.indices};`);for(let s=0;s<t;++s)n.push(r.indicesSet("a",e[s],`i[${s}]`));return n.push("return a;}"),n.join(`\n`)},dt=(e,t)=>{let r=e.dataType,o=e.dims.length,n=Aa(o,t),s=Ue(o),u=Ed(e.dims,n),l=s?u.length:u,a=s?o:e.dims,p=K("output",r,l),h=U("a",r,a),g=w=>`\n  ${w.registerUniform("output_size","u32").declareVariables(h,p)}\n\n  ${Od(n,o,h,p)}\n\n  ${w.mainStart()}\n    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let indices = ${p.offsetToIndices("global_idx")};\n    let aIndices = perm(indices);\n\n    ${p.setByOffset("global_idx",h.getByIndices("aIndices"))}\n  }`;return{name:"Transpose",shaderCache:{hint:`${t}`,inputDependencies:s?["rank"]:["dims"]},getRunData:w=>{let v=V.size(u);return{outputs:[{dims:u,dataType:w[0].dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:s?[{type:"uint32",data:v},...F(w[0].dims),...F(u)]:[{type:"uint32",data:v}]}},getShaderSource:g}},Ta=(e,t)=>{Td(e.inputs),e.compute(dt(e.inputs[0],t.perm))},Ea=e=>he({perm:e.perm})});var Pd,Bd,kd,Rd,Dd,Md,Ud,zd,Vd,Nd,ht,Oa,Pa,Ba,ka,Ra,Da,Ma,Ua,za,Va,Na=q(()=>{"use strict";xe();$e();rn();or();Pd={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Bd={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},kd={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Rd={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Dd=(e,t)=>{let r=[];for(let o=t-e;o<t;++o)r.push(o);return r},Md=(e,t)=>{let r=[],o=e.length;for(let s=0;s<o;s++)t.indexOf(s)===-1&&r.push(e[s]);let n=t.map(s=>e[s]);return[r,n]},Ud=(e,t)=>{let r=e.length+t.length,o=[],n=0;for(let s=0;s<r;s++)t.indexOf(s)===-1?o.push(e[n++]):o.push(1);return o},zd=(e,t)=>{for(let r=0;r<e.length;++r)if(e[e.length-r-1]!==t-1-r)return!1;return!0},Vd=(e,t)=>{let r=[];if(!zd(e,t)){for(let o=0;o<t;++o)e.indexOf(o)===-1&&r.push(o);e.forEach(o=>r.push(o))}return r},Nd=(e,t,r,o,n,s,u)=>{let l=r[0].dims,a=V.size(s),p=V.size(u),h=U("_A",r[0].dataType,l),g=K("output",n,s),w=32,v=`\n          var<workgroup> aBestValues : array<${g.type.storage}, ${w}>;\n       `;return{name:e,shaderCache:t,getShaderSource:_=>`\n        ${_.registerUniform("reduceSize","u32").declareVariables(h,g)}\n        ${v}\n        fn DIV_CEIL(a : u32, b : u32) -> u32 {\n          return ((a - 1u) / b + 1u);\n         }\n         ${_.mainStart(w)}\n\n          let outputIndex = global_idx / ${w};\n          let offset = outputIndex * uniforms.reduceSize;\n\n          var bestValue = ${g.type.storage}(${kd[o]});\n          let Length = uniforms.reduceSize;\n          for (var k = local_idx; k < Length; k = k + ${w}) {\n           let candidate = ${g.type.storage}(${h.getByOffset("offset + k")});\n           bestValue = ${Pd[o]};\n          }\n          aBestValues[local_idx] = bestValue;\n          workgroupBarrier();\n\n         var reduceSize = min(Length, ${w}u);\n         for (var currentSize = reduceSize / 2u; reduceSize > 1u;\n             currentSize = reduceSize / 2u) {\n           let interval = DIV_CEIL(reduceSize, 2u);\n           if (local_idx < currentSize) {\n            let candidate = aBestValues[local_idx + interval];\n            bestValue = ${Bd[o]};\n            aBestValues[local_idx] = bestValue;\n           }\n           reduceSize = interval;\n           workgroupBarrier();\n         }\n\n         if (local_idx == 0u) {\n          ${g.setByOffset("outputIndex",`${o==="mean"?`bestValue / ${g.type.storage}(uniforms.reduceSize)`:`${Rd[o]}`}`)};\n         }\n        }`,getRunData:()=>({outputs:[{dims:s,dataType:n}],dispatchGroup:{x:a},programUniforms:[{type:"uint32",data:p}]})}},ht=(e,t,r,o)=>{let n=e.inputs.length===1?r:Zn(e.inputs,r),s=n.axes;s.length===0&&!n.noopWithEmptyAxes&&(s=e.inputs[0].dims.map((v,y)=>y));let u=V.normalizeAxes(s,e.inputs[0].dims.length),l=u,a=e.inputs[0],p=Vd(l,e.inputs[0].dims.length);p.length>0&&(a=e.compute(dt(e.inputs[0],p),{inputs:[0],outputs:[-1]})[0],l=Dd(l.length,a.dims.length));let[h,g]=Md(a.dims,l),w=h;n.keepDims&&(w=Ud(h,u)),e.compute(Nd(t,{hint:n.cacheKey,inputDependencies:["type"]},[a],o,e.inputs[0].dataType,w,g),{inputs:[a]})},Oa=(e,t)=>{ht(e,"ReduceMeanShared",t,"mean")},Pa=(e,t)=>{ht(e,"ReduceL1Shared",t,"l1")},Ba=(e,t)=>{ht(e,"ReduceL2Shared",t,"l2")},ka=(e,t)=>{ht(e,"ReduceLogSumExpShared",t,"logSumExp")},Ra=(e,t)=>{ht(e,"ReduceMaxShared",t,"max")},Da=(e,t)=>{ht(e,"ReduceMinShared",t,"min")},Ma=(e,t)=>{ht(e,"ReduceProdShared",t,"prod")},Ua=(e,t)=>{ht(e,"ReduceSumShared",t,"sum")},za=(e,t)=>{ht(e,"ReduceSumSquareShared",t,"sumSquare")},Va=(e,t)=>{ht(e,"ReduceLogSumShared",t,"logSum")}});var gt,Wd,nn,Zn,yt,Gd,Hd,Ld,Fd,Kd,qd,jd,Yd,Zd,Qd,bt,Wa,Ga,Ha,La,Fa,Ka,qa,ja,Ya,Za,rn=q(()=>{"use strict";xe();Le();$e();Na();gt=e=>{if(!e||e.length===0||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(e.length===2&&e[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Wd=e=>["","",`var value = ${e.getByIndices("input_indices")};`,""],nn=(e,t,r,o,n,s,u=!1,l=!1)=>{let a=[],p=r[0].dims,h=p.length,g=V.normalizeAxes(n,h),w=!l&&g.length===0;p.forEach((I,x)=>{w||g.indexOf(x)>=0?u&&a.push(1):a.push(I)});let v=a.length,y=V.size(a);return{name:e,shaderCache:t,getShaderSource:I=>{let x=[],A=U("_A",r[0].dataType,h),O=K("output",s,v),C=o(A,O,g),M=C[2];for(let D=0,G=0;D<h;D++)w||g.indexOf(D)>=0?(u&&G++,M=`for(var j${D}: u32 = 0; j${D} < ${p[D]}; j${D}++) {\n                  ${C[2].includes("last_index")?`let last_index = j${D};`:""}\n                  ${A.indicesSet("input_indices",D,`j${D}`)}\n                  ${M}\n                }`):(x.push(`${A.indicesSet("input_indices",D,O.indicesGet("output_indices",G))};`),G++);return`\n\n        ${I.registerUniform("output_size","u32").declareVariables(A,O)}\n\n        ${I.mainStart()}\n          ${I.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n          var input_indices: ${A.type.indices};\n          let output_indices = ${O.offsetToIndices("global_idx")};\n\n          ${x.join(`\n`)}\n          ${C[0]}       // init ops for reduce max/min\n          ${C[1]}\n          ${M}\n          ${C[3]}\n          ${C.length===4?O.setByOffset("global_idx","value"):C.slice(4).join(`\n`)}\n        }`},getRunData:()=>({outputs:[{dims:a,dataType:s}],dispatchGroup:{x:Math.ceil(y/64)},programUniforms:[{type:"uint32",data:y},...F(p),...F(a)]})}},Zn=(e,t)=>{let r=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(o=>r.push(Number(o))),he({axes:r,keepDims:t.keepDims,noopWithEmptyAxes:t.noopWithEmptyAxes})},yt=(e,t,r,o)=>{let n=e.inputs,s=n.length===1?r:Zn(n,r);e.compute(nn(t,{hint:s.cacheKey,inputDependencies:["rank"]},[n[0]],s.noopWithEmptyAxes&&s.axes.length===0?Wd:o,s.axes,n[0].dataType,s.keepDims,s.noopWithEmptyAxes),{inputs:[0]})},Gd=(e,t)=>{gt(e.inputs),yt(e,"ReduceLogSum",t,(o,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${o.getByIndices("input_indices")};`,"value = log(value);"])},Hd=(e,t)=>{gt(e.inputs),yt(e,"ReduceL1",t,(o,n)=>[`var value = ${n.type.storage}(0);`,"",`value += abs(${o.getByIndices("input_indices")});`,""])},Ld=(e,t)=>{gt(e.inputs),yt(e,"ReduceL2",t,(o,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${o.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},Fd=(e,t)=>{gt(e.inputs),yt(e,"ReduceLogSumExp",t,(o,n)=>[`var value = ${n.type.storage}(0);`,"",`value += exp(${o.getByIndices("input_indices")});`,"value = log(value);"])},Kd=(e,t)=>{gt(e.inputs),yt(e,"ReduceMax",t,(o,n,s)=>{let u=[];for(let l=0;l<o.rank;l++)(s.indexOf(l)>=0||s.length===0)&&u.push(o.indicesSet("input_indices",l,0));return[`${u.join(`\n`)}`,`var value = ${o.getByIndices("input_indices")};`,`value = max(value, ${o.getByIndices("input_indices")});`,""]})},qd=(e,t)=>{gt(e.inputs),yt(e,"ReduceMean",t,(o,n,s)=>{let u=1;for(let l=0;l<o.rank;l++)(s.indexOf(l)>=0||s.length===0)&&(u*=e.inputs[0].dims[l]);return["var sum = f32(0);","",`sum += f32(${o.getByIndices("input_indices")});`,`let value = ${n.type.value}(sum / ${u});`]})},jd=(e,t)=>{gt(e.inputs),yt(e,"ReduceMin",t,(o,n,s)=>{let u=[];for(let l=0;l<o.rank;l++)(s.indexOf(l)>=0||s.length===0)&&u.push(`input_indices[${l}] = 0;`);return[`${u.join(`\n`)}`,`var value = ${o.getByIndices("input_indices")};`,`value = min(value, ${o.getByIndices("input_indices")});`,""]})},Yd=(e,t)=>{gt(e.inputs),yt(e,"ReduceProd",t,(o,n)=>[`var value = ${n.type.storage}(1);`,"",`value *= ${o.getByIndices("input_indices")};`,""])},Zd=(e,t)=>{gt(e.inputs),yt(e,"ReduceSum",t,(o,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${o.getByIndices("input_indices")};`,""])},Qd=(e,t)=>{gt(e.inputs),yt(e,"ReduceSumSquare",t,(o,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${o.getByIndices("input_indices")}; value += t * t;`,""])},bt=(e,t,r)=>{if(t.length===0)return r;let o=1,n=1;for(let s=0;s<t.length;s++)t.indexOf(s)===-1?o*=e[s]:n*=e[s];return n<32&&o>1024},Wa=(e,t)=>{bt(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?qd(e,t):Oa(e,t)},Ga=(e,t)=>{bt(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Hd(e,t):Pa(e,t)},Ha=(e,t)=>{bt(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Ld(e,t):Ba(e,t)},La=(e,t)=>{bt(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Fd(e,t):ka(e,t)},Fa=(e,t)=>{bt(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Kd(e,t):Ra(e,t)},Ka=(e,t)=>{bt(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?jd(e,t):Da(e,t)},qa=(e,t)=>{bt(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Yd(e,t):Ma(e,t)},ja=(e,t)=>{bt(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Zd(e,t):Ua(e,t)},Ya=(e,t)=>{bt(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Qd(e,t):za(e,t)},Za=(e,t)=>{bt(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Gd(e,t):Va(e,t)}});var Qa,Ja,Xa,Qn,ei=q(()=>{"use strict";We();Le();rn();Qa=e=>{if(!e||e.length===0||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(e[0].dataType!==1)throw new Error("Invalid input type.")},Ja=(e,t)=>{Qa(e.inputs);let r=(o,n,s)=>{let u=[];for(let l=0;l<o.rank;l++)(s.indexOf(l)>=0||s.length===0)&&u.push(`input_indices[${l}] = 0;`);return[`${u.join(`\n`)}`,`var value = ${o.getByIndices("input_indices")};\nvar best_index : i32 = 0;`,`if (${o.getByIndices("input_indices")} ${t.selectLastIndex>0?"<=":"<"} value) {\n         value = ${o.getByIndices("input_indices")};\n         best_index = i32(last_index);\n       }`,"",n.setByOffset("global_idx","best_index")]};e.compute(nn("ArgMin",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],r,[t.axis],7,t.keepDims),{inputs:[0]})},Xa=(e,t)=>{Qa(e.inputs);let r=(o,n,s)=>{let u=[];for(let l=0;l<o.rank;l++)(s.indexOf(l)>=0||s.length===0)&&u.push(`input_indices[${l}] = 0;`);return[`${u.join(`\n`)}`,`var value = ${o.getByIndices("input_indices")};\nvar best_index : i32 = 0;`,`if (${o.getByIndices("input_indices")} ${t.selectLastIndex>0?">=":">"} value) {\n         value = ${o.getByIndices("input_indices")};\n         best_index = i32(last_index);\n       }`,"",n.setByOffset("global_idx","best_index")]};e.compute(nn("argMax",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],r,[t.axis],7,t.keepDims),{inputs:[0]})},Qn=e=>he(e)});var Jd,Xd,el,tl,on,rl,ti,Jn=q(()=>{"use strict";We();Zr();$e();Jd=(e,t)=>{let r=e[0],o=e[1],n=e[2],s=e[3],u=e[4],l=e[5];if(u&&l)throw new Error("Attention cannot have both past and relative_position_bias");if(r.dims.length!==3)throw new Error(\'Input "input" must have 3 dimensions\');let a=r.dims[0],p=r.dims[1],h=r.dims[2];if(n.dims.length!==1)throw new Error(\'Input "bias" is expected to have 1 dimensions\');if(o.dims.length!==2)throw new Error(\'Input "weights" is expected to have 2 dimensions\');if(o.dims[0]!==h)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(n.dims[0]!==o.dims[1])throw new Error(\'Input "bias" dimension 0 should have same length as dimension 1 of input "weights"\');let g=n.dims[0]/3,w=g,v=w;if(t.qkvHiddenSizes.length>0){if(t.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let O of t.qkvHiddenSizes)if(O%t.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");g=t.qkvHiddenSizes[0],w=t.qkvHiddenSizes[1],v=t.qkvHiddenSizes[2]}let y=p;if(g!==w)throw new Error("qkv_hidden_sizes first element should be same as the second");if(n.dims[0]!==g+w+v)throw new Error(\'Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes\');let _=0;if(u){if(w!==v)throw new Error(\'Input "past" expect k_hidden_size == v_hidden_size\');if(u.dims.length!==5)throw new Error(\'Input "past" must have 5 dimensions\');if(u.dims[0]!==2)throw new Error(\'Input "past" first dimension must be 2\');if(u.dims[1]!==a)throw new Error(\'Input "past" second dimension must be batch_size\');if(u.dims[2]!==t.numHeads)throw new Error(\'Input "past" third dimension must be num_heads\');if(u.dims[4]!==w/t.numHeads)throw new Error(\'Input "past" fifth dimension must be k_hidden_size / num_heads\');t.pastPresentShareBuffer||(_=u.dims[3])}let I=y+_,x=-1,A=0;if(s)throw new Error("Mask not supported");if(u)throw new Error("past is not supported");if(l)throw new Error("relativePositionBias is not supported");return{batchSize:a,sequenceLength:p,pastSequenceLength:_,kvSequenceLength:y,totalSequenceLength:I,maxSequenceLength:x,inputHiddenSize:h,hiddenSize:g,vHiddenSize:v,headSize:Math.floor(g/t.numHeads),vHeadSize:Math.floor(v/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:A,scale:t.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},Xd=(e,t,r,o)=>{let n=He(o),s=64,u=o/n;u<s?s=1:u/8<64&&(s=Math.ceil(u/8));let l=Math.ceil(o/n/s),p=[{type:nt(t.dataType),data:1/o},{type:"uint32",data:u},{type:"uint32",data:l}],h=Ge(t.dataType,n),g=w=>{let v=K("x",t.dataType,t.dims,n),y="thread_max_vector";n===2?y="max(thread_max_vector.x, thread_max_vector.y)":n===4&&(y="max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))");let _=ft(t.dataType),I=[{name:"d_inv",type:_},{name:"d_comp",type:"u32"},{name:"elements_per_wg",type:"u32"}];return`\n  var<workgroup> wgMax: array<f32, ${s}>;\n  var<workgroup> wgSum: array<f32, ${s}>;\n  ${w.registerUniforms(I).declareVariables(v)}\n  ${w.mainStart([s,1,1])}\n    let localOffset = local_idx * uniforms.elements_per_wg;\n    let offset: u32 = workgroup_id.x * uniforms.d_comp + localOffset;\n\n    var thread_max_vector = ${Qe("f32",n,"-3.402823e+38f")};\n    for (var i: u32 = 0; i < uniforms.elements_per_wg && i + localOffset < uniforms.d_comp; i++) {\n      thread_max_vector = max(${ut(_,n,"x[offset + i]")}, thread_max_vector);\n    }\n    wgMax[local_idx] = ${y};\n    workgroupBarrier();\n\n    var maxValue = -3.402823e+38f;\n    for (var i = 0u; i < ${s}; i++) {\n      maxValue = max(wgMax[i], maxValue);\n    }\n\n    var sumVector = ${Qe("f32",n,"0")};\n    for (var i: u32 = 0; i < uniforms.elements_per_wg && i + localOffset < uniforms.d_comp; i++) {\n      sumVector += exp(${ut(_,n,"x[offset + i]")} - maxValue);\n    }\n    wgSum[local_idx] = ${ot("sumVector",n)};\n    workgroupBarrier();\n\n    var sum: f32 = 0;\n    for (var i = 0u; i < ${s}; i++) {\n      sum += wgSum[i];\n    }\n\n    if (sum == 0) {\n      for (var i: u32 = 0; i < uniforms.elements_per_wg && i + localOffset < uniforms.d_comp; i++) {\n        x[offset + i] = ${Qe("f32",n,"uniforms.d_inv")};\n      }\n    } else {\n      for (var i: u32 = 0; i < uniforms.elements_per_wg && i + localOffset < uniforms.d_comp; i++) {\n        let f32input = ${ut(_,n,"x[offset + i]")};\n        x[offset + i] = ${v.type.value}(exp(f32input - maxValue) / sum);\n      }\n    }\n  }`};e.compute({name:"AttentionProbsSoftmax",shaderCache:{hint:`${s};${h};${n}`},getShaderSource:g,getRunData:()=>({outputs:[],dispatchGroup:{x:r},programUniforms:p})},{inputs:[t],outputs:[]})},el=(e,t,r,o,n,s)=>{let u=[n.batchSize,n.numHeads,n.sequenceLength,n.kvSequenceLength+n.pastSequenceLength],l=s.scale===0?1/Math.sqrt(n.headSize):s.scale,a=He(n.headSize),p=n.headSize/a,h=12,g={x:Math.ceil(n.totalSequenceLength/h),y:Math.ceil(n.sequenceLength/h),z:n.batchSize*n.numHeads},w=nt(t.dataType),v=[{type:"uint32",data:n.sequenceLength},{type:"uint32",data:p},{type:"uint32",data:n.totalSequenceLength},{type:"uint32",data:n.kvSequenceLength},{type:w,data:l}],y=[t,r],_=x=>{let A=U("q",t.dataType,t.dims,a),O=U("key",r.dataType,r.dims,a),C=K("output",t.dataType,u),M=Ge(t.dataType),D=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"alpha",type:M}];return`\n  const beta: ${M} = 1.0;\n  const TILE_SIZE = ${h}u;\n\n  var<workgroup> tileQ: array<${A.type.storage}, ${h*h}>;\n  var<workgroup> tileK: array<${A.type.storage}, ${h*h}>;\n  ${x.registerUniforms(D).declareVariables(A,O,C)}\n  ${x.mainStart([h,h,1])}\n    // x holds the N and y holds the M\n    let headIdx = workgroup_id.z;\n    let m = workgroup_id.y * TILE_SIZE;\n    let n = workgroup_id.x * TILE_SIZE;\n    let lm = m + local_id.y;\n    let ln = n + local_id.x;\n\n    let qOffset = uniforms.M * uniforms.K * headIdx + m * uniforms.K;\n    let kOffset = uniforms.kv_sequence_length * uniforms.K * headIdx + n * uniforms.K;\n\n    var value = ${Qe(M,a)};\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m + local_id.y < uniforms.M && w + local_id.x < uniforms.K) {\n        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];\n      }\n      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {\n        tileK[TILE_SIZE * local_id.y + local_id.x] = key[kOffset + local_id.y * uniforms.K + w + local_id.x];\n      }\n      workgroupBarrier();\n\n      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {\n        value += tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k];\n      }\n\n      workgroupBarrier();\n    }\n\n    let headOffset = headIdx * uniforms.M * uniforms.N;\n    if (lm < uniforms.M && ln < uniforms.N) {\n      let outputIdx = headOffset + lm * uniforms.N + ln;\n      output[outputIdx] = ${ot("value",a)} * uniforms.alpha;\n    }\n  }`},I=e.compute({name:"AttentionProbs",shaderCache:{hint:`${a}`,inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:u,dataType:t.dataType,gpuDataType:0}],dispatchGroup:g,programUniforms:v}),getShaderSource:_},{inputs:y,outputs:[-1]})[0];return Xd(e,I,n.batchSize*n.numHeads*n.sequenceLength,n.totalSequenceLength),I},tl=(e,t,r,o)=>{let n=[o.batchSize,o.sequenceLength,o.vHiddenSize],s=12,u={x:Math.ceil(o.vHeadSize/s),y:Math.ceil(o.sequenceLength/s),z:o.batchSize*o.numHeads},l=[{type:"uint32",data:o.sequenceLength},{type:"uint32",data:o.totalSequenceLength},{type:"uint32",data:o.vHeadSize},{type:"uint32",data:o.numHeads},{type:"uint32",data:o.vHiddenSize}],a=p=>{let h=U("probs",t.dataType,t.dims),g=U("v",r.dataType,r.dims),w=K("output",t.dataType,n),v=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"v_hidden_size",type:"u32"}];return`\n  const TILE_SIZE = ${s}u;\n  var<workgroup> tileQ: array<${h.type.value}, ${s*s}>;\n  var<workgroup> tileK: array<${h.type.value}, ${s*s}>;\n  ${p.registerUniforms(v).declareVariables(h,g,w)}\n  ${p.mainStart([s,s,1])}\n   let headIdx = workgroup_id.z;\n   let m = workgroup_id.y * TILE_SIZE + local_id.y;\n   let n = workgroup_id.x * TILE_SIZE + local_id.x;\n\n   let offsetA = headIdx * (uniforms.M * uniforms.K) + m * uniforms.K;\n   let offsetB = headIdx * (uniforms.N * uniforms.K) + n;\n\n   var value = ${h.type.storage}(0);\n   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n     if (m < uniforms.M && w + local_id.x < uniforms.K) {\n       tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];\n     }\n     if (n < uniforms.N && w + local_id.y < uniforms.K) {\n       tileK[TILE_SIZE * local_id.y + local_id.x] = v[offsetB + (w + local_id.y) * uniforms.N];\n     }\n     workgroupBarrier();\n     for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {\n       value += tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * k + local_id.x];\n     }\n     workgroupBarrier();\n   }\n\n   // we need to transpose output from BNSH_v to BSND_v\n   let batchIdx = workgroup_id.z / uniforms.num_heads;\n   let currentBatchHeadNumber = workgroup_id.z % uniforms.num_heads;\n   let headOffset = (batchIdx * uniforms.M * uniforms.num_heads + currentBatchHeadNumber) * uniforms.N;\n   if (m < uniforms.M && n < uniforms.N) {\n     let outputIdx = batchIdx * uniforms.M *uniforms.v_hidden_size + m * uniforms.v_hidden_size\n       + currentBatchHeadNumber * uniforms.N + n;\n     output[outputIdx] = value;\n   }\n  }`};return e.compute({name:"AttentionScore",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:n,dataType:t.dataType,gpuDataType:0}],dispatchGroup:u,programUniforms:l}),getShaderSource:a},{inputs:[t,r],outputs:[0]})[0]},on=(e,t,r,o,n,s,u,l,a,p,h)=>{let g=el(e,t,r,a,p,h);tl(e,g,o,p)},rl=(e,t)=>{let r=[t.batchSize,t.numHeads,t.sequenceLength,t.headSize],o=t.sequenceLength,n=t.inputHiddenSize,s=t.headSize,u=12,l={x:Math.ceil(t.headSize/u),y:Math.ceil(t.sequenceLength/u),z:t.batchSize*t.numHeads},a=[e.inputs[0],e.inputs[1],e.inputs[2]],p=[{type:"uint32",data:o},{type:"uint32",data:n},{type:"uint32",data:s},{type:"uint32",data:t.numHeads},{type:"uint32",data:t.headSize},{type:"uint32",data:t.hiddenSize},{type:"uint32",data:t.hiddenSize+t.hiddenSize+t.vHiddenSize}],h=g=>{let w=K("output_q",a[0].dataType,r),v=K("output_k",a[0].dataType,r),y=K("output_v",a[0].dataType,r),_=U("input",a[0].dataType,a[0].dims),I=U("weight",a[1].dataType,a[1].dims),x=U("bias",a[2].dataType,a[2].dims),A=_.type.storage,O=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`\n  const TILE_SIZE = ${u}u;\n  var<workgroup> tileInput: array<${A}, ${u*u}>;\n  var<workgroup> tileWeightQ: array<${A}, ${u*u}>;\n  var<workgroup> tileWeightK: array<${A}, ${u*u}>;\n  var<workgroup> tileWeightV: array<${A}, ${u*u}>;\n  ${g.registerUniforms(O).declareVariables(_,I,x,w,v,y)}\n  ${g.mainStart([u,u,1])}\n    let batchIndex = workgroup_id.z / uniforms.num_heads;\n    let headNumber = workgroup_id.z % uniforms.num_heads;\n    let m = workgroup_id.y * TILE_SIZE + local_id.y;\n    let n = workgroup_id.x * TILE_SIZE + local_id.x;\n\n    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;\n    let biasOffsetQ = headNumber * uniforms.head_size;\n    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;\n    let biasOffsetV = uniforms.hidden_size + biasOffsetK;\n\n    var valueQ = ${A}(0);\n    var valueK = ${A}(0);\n    var valueV = ${A}(0);\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m < uniforms.M && w + local_id.x < uniforms.K) {\n        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];\n      }\n      if (n < uniforms.N && w + local_id.y < uniforms.K) {\n        let offset = n + (w + local_id.y) * uniforms.ldb;\n        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];\n        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];\n        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];\n      }\n      workgroupBarrier();\n      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {\n        let inputTileOffset = TILE_SIZE * local_id.y + k;\n        let weightTileOffset = TILE_SIZE * k + local_id.x;\n        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];\n        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];\n        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];\n      }\n\n      workgroupBarrier();\n    }\n\n    let headOffset = (m * uniforms.N + n) % uniforms.head_size;\n    valueQ += bias[headOffset + biasOffsetQ];\n    valueK += bias[headOffset + biasOffsetK];\n    valueV += bias[headOffset + biasOffsetV];\n\n    let offset = workgroup_id.z * uniforms.M * uniforms.N;\n    if (m < uniforms.M && n < uniforms.N) {\n      let outputIdx = offset + m * uniforms.N + n;\n      output_q[outputIdx] = valueQ;\n      output_k[outputIdx] = valueK;\n      output_v[outputIdx] = valueV;\n    }\n  }`};return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:l,programUniforms:p}),getShaderSource:h},{inputs:a,outputs:[-1,-1,-1]})},ti=(e,t)=>{let r=Jd(e.inputs,t),[o,n,s]=rl(e,r);return on(e,o,n,s,e.inputs[4],void 0,void 0,void 0,e.inputs[5],r,t)}});var nl,ol,al,ri,ni=q(()=>{"use strict";rr();xe();Le();$e();nl=(e,t)=>{if(!e||e.length!==5)throw new Error("BatchNormalization requires 5 inputs");let r=(o,n,s)=>{let u=n.length;if(u!==o.length)throw new Error(`${s}: num dimensions != ${u}`);n.forEach((l,a)=>{if(l!==o[a])throw new Error(`${s}: dim[${a}] do not match`)})};if(e[0].dims.length>1){let o=t.format==="NHWC"?t.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,t.spatial?2:void 0);r(e[1].dims,o,"Invalid input scale"),r(e[2].dims,o,"Invalid input B"),r(e[3].dims,o,"Invalid input mean"),r(e[4].dims,o,"Invalid input var")}else r(e[1].dims,[1],"Invalid input scale"),r(e[2].dims,[1],"Invalid input B"),r(e[3].dims,[1],"Invalid input mean"),r(e[4].dims,[1],"Invalid input var")},ol=(e,t)=>{let{epsilon:r,spatial:o,format:n}=t,s=e[0].dims,u=o?He(s[s.length-1]):1,l=n==="NHWC"&&s.length>1?u:1,a=V.size(s)/u,p=Ue(s.length)&&o,h=p?s.length:s,g=U("x",e[0].dataType,e[0].dims,u),w=U("scale",e[1].dataType,e[1].dims,l),v=U("bias",e[2].dataType,e[2].dims,l),y=U("inputMean",e[3].dataType,e[3].dims,l),_=U("inputVar",e[4].dataType,e[4].dims,l),I=K("y",e[0].dataType,h,u),x=()=>{let O="";if(o)O=`let cOffset = ${s.length===1?"0u":n==="NHWC"?`outputIndices[${s.length-1}] / ${u}`:"outputIndices[1]"};`;else if(n==="NCHW")O=`\n            ${I.indicesSet("outputIndices","0","0")}\n            let cOffset = ${I.indicesToOffset("outputIndices")};`;else{O=`var cIndices = ${w.type.indices}(0);\n                       cIndices[0] = outputIndices[${s.length-1}];`;for(let C=1;C<w.rank;C++)O+=`cIndices[${C}] = outputIndices[${C}];`;O+=`let cOffset = ${w.indicesToOffset("cIndices")};`}return O},A=O=>`\n  const epsilon = ${r};\n  ${O.registerUniform("outputSize","u32").declareVariables(g,w,v,y,_,I)}\n  ${O.mainStart()}\n  ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n    var outputIndices = ${I.offsetToIndices(`global_idx * ${u}`)};\n    ${x()}\n    let scale = ${w.getByOffset("cOffset")};\n    let bias = ${v.getByOffset("cOffset")};\n    let inputMean = ${y.getByOffset("cOffset")};\n    let inputVar = ${_.getByOffset("cOffset")};\n    let x = ${g.getByOffset("global_idx")};\n    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;\n    ${I.setByOffset("global_idx","value")}\n  }`;return{name:"BatchNormalization",shaderCache:{hint:`${t.epsilon}_${t.format}_${o}_${u}`,inputDependencies:p?["rank","type","type","type","type"]:void 0},getShaderSource:A,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:p?[{type:"uint32",data:a},...F(s)]:[{type:"uint32",data:a}]})}},al=e=>he(e),ri=(e,t)=>{let{inputs:r,outputCount:o}=e,n=al({...t,outputCount:o});if(tr.webgpu.validateInputContent&&nl(r,n),t.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(ol(r,n))}});var il,sl,oi,ai=q(()=>{"use strict";xe();$e();il=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},sl=e=>{let t=e[0].dims,r=e[0].dims[2],o=V.size(t)/4,n=e[0].dataType,s=U("input",n,t,4),u=U("bias",n,[r],4),l=U("residual",n,t,4),a=K("output",n,t,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)}}),getShaderSource:h=>`\n  const channels = ${r}u / 4;\n  ${h.declareVariables(s,u,l,a)}\n\n  ${h.mainStart()}\n    ${h.guardAgainstOutOfBoundsWorkgroupSizes(o)}\n    let value = ${s.getByOffset("global_idx")}\n      + ${u.getByOffset("global_idx % channels")} + ${l.getByOffset("global_idx")};\n    ${a.setByOffset("global_idx","value")}\n  }`}},oi=e=>{il(e.inputs),e.compute(sl(e.inputs))}});var ul,Ee,ii,si,ui,di,li,ci,pi,mi,fi,dl,hi,gi,yi,bi,an,wi,sn,vi,$i,Si,xi,_i,Ci,Ii,Ai,Ti,Ei,Oi,Pi,Bi,ki,Ri,Di,Mi,Xn=q(()=>{"use strict";We();xe();Le();$e();ul=(e,t,r,o,n,s)=>{let u=Math.ceil(t/4),l="";typeof n=="string"?l=`${n}(a)`:l=n("a");let a=U("inputData",r,[u],4),p=K("outputData",o,[u],4);return`\n      ${e.registerUniform("vec_size","u32").declareVariables(a,p)}\n\n  ${s??""}\n\n  ${e.mainStart()}\n    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n\n    let a = ${a.getByOffset("global_idx")};\n    ${p.setByOffset("global_idx",l)}\n  }`},Ee=(e,t,r,o,n,s=e.dataType)=>({name:t,shaderCache:{hint:n,inputDependencies:["type"]},getShaderSource:u=>ul(u,V.size(e.dims),e.dataType,s,r,o),getRunData:u=>({outputs:[{dims:e.dims,dataType:s}],dispatchGroup:{x:Math.ceil(V.size(u[0].dims)/64/4)},programUniforms:[{type:"uint32",data:Math.ceil(V.size(e.dims)/4)}]})}),ii=e=>{e.compute(Ee(e.inputs[0],"Abs","abs"))},si=e=>{e.compute(Ee(e.inputs[0],"Acos","acos"))},ui=e=>{e.compute(Ee(e.inputs[0],"Acosh","acosh"))},di=e=>{e.compute(Ee(e.inputs[0],"Asin","asin"))},li=e=>{e.compute(Ee(e.inputs[0],"Asinh","asinh"))},ci=e=>{e.compute(Ee(e.inputs[0],"Atan","atan"))},pi=e=>{e.compute(Ee(e.inputs[0],"Atanh","atanh"))},mi=e=>he(e),fi=(e,t)=>{let r;switch(t.to){case 10:r="vec4<f16>";break;case 1:r="vec4<f32>";break;case 12:r="vec4<u32>";break;case 6:r="vec4<i32>";break;case 9:r="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute \'to\' from \'Cast\' operator): ${t.to}`)}e.compute(Ee(e.inputs[0],"Cast",r,void 0,t.cacheKey,t.to))},dl=e=>{let t=e.length>=2&&e[1].data!==0?e[1].getFloat32Array()[0]:Xr,r=e.length>=3&&e[2].data!==0?e[2].getFloat32Array()[0]:en;return he({min:t,max:r})},hi=(e,t)=>{let r=e.inputs.length===1?t:dl(e.inputs),o=ft(e.inputs[0].dataType);e.compute(Ee(e.inputs[0],"Clip",n=>`clamp(${n}, clip_min_, clip_max_)`,`\n    const clip_min_: vec4<${o}> = vec4(${o}(${r.min}));\n    const clip_max_: vec4<${o}> = vec4(${o}(${r.max}));\n`,r.cacheKey),{inputs:[0]})},gi=e=>{e.compute(Ee(e.inputs[0],"Ceil","ceil"))},yi=e=>{e.compute(Ee(e.inputs[0],"Cos","cos"))},bi=e=>{e.compute(Ee(e.inputs[0],"Cosh","cosh"))},an=e=>he(e),wi=(e,t)=>{let r=ft(e.inputs[0].dataType);e.compute(Ee(e.inputs[0],"Elu",o=>`elu_vf32(${o})`,`\n  const elu_alpha_ = ${r}(${t.alpha});\n\n  fn elu_f32(a: ${r}) -> ${r} {\n  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);\n  }\n\n  fn elu_vf32(v: vec4<${r}>) -> vec4<${r}> {\n  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));\n  }`,t.cacheKey))},sn=(e,t="f32")=>`\nconst r0: ${t} = 0.3275911;\nconst r1: ${t} = 0.254829592;\nconst r2: ${t} = -0.284496736;\nconst r3: ${t} = 1.421413741;\nconst r4: ${t} = -1.453152027;\nconst r5: ${t} = 1.061405429;\n\nfn erf_vf32(v: ${e}) -> ${e} {\n  let absv = abs(v);\n  let x = 1.0 / (1.0 + r0 * absv);\n  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));\n}`,vi=e=>{let t=ft(e.inputs[0].dataType);e.compute(Ee(e.inputs[0],"Erf",r=>`erf_vf32(${r})`,sn(`vec4<${t}>`,t)))},$i=e=>{e.compute(Ee(e.inputs[0],"Exp","exp"))},Si=e=>{e.compute(Ee(e.inputs[0],"Floor","floor"))},xi=e=>{let t=ft(e.inputs[0].dataType);e.compute(Ee(e.inputs[0],"Gelu",r=>`0.5 * ${r} * (1.0 + erf_vf32(${r} * 0.7071067811865475))`,sn(`vec4<${t}>`,t)))},_i=(e,t)=>{let r=ft(e.inputs[0].dataType);e.compute(Ee(e.inputs[0],"LeakyRelu",o=>`select(leaky_relu_alpha_ * ${o}, ${o}, ${o} >= vec4<${r}>(0.0))`,`const leaky_relu_alpha_ = ${r}(${t.alpha});`,t.cacheKey))},Ci=e=>{e.compute(Ee(e.inputs[0],"Not",t=>`!${t}`))},Ii=e=>{e.compute(Ee(e.inputs[0],"Neg",t=>`-${t}`))},Ai=e=>{e.compute(Ee(e.inputs[0],"Reciprocal",t=>`1.0/${t}`))},Ti=e=>{let t=ft(e.inputs[0].dataType);e.compute(Ee(e.inputs[0],"Relu",r=>`select(vec4<${t}>(0.0), ${r}, ${r} > vec4<${t}>(0.0))`))},Ei=e=>{e.compute(Ee(e.inputs[0],"Sigmoid",t=>`(1.0 / (1.0 + exp(-${t})))`))},Oi=e=>{e.compute(Ee(e.inputs[0],"Sin","sin"))},Pi=e=>{e.compute(Ee(e.inputs[0],"Sinh","sinh"))},Bi=e=>{e.compute(Ee(e.inputs[0],"Sqrt","sqrt"))},ki=e=>{e.compute(Ee(e.inputs[0],"Tan","tan"))},Ri=e=>{e.compute(Ee(e.inputs[0],"Tanh","tanh"))},Di=(e,t)=>{let r=ft(e.inputs[0].dataType);return e.compute(Ee(e.inputs[0],"ThresholdedRelu",o=>`select(vec4<${r}>(0.0), ${o}, ${o} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${r}>(${t.alpha});`,t.cacheKey)),0},Mi=e=>{e.compute(Ee(e.inputs[0],"Log","log"))}});var cl,pl,Ui,zi=q(()=>{"use strict";xe();$e();Xn();cl=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},pl=e=>{let t=e[0].dims.slice();t[2]=t[2]/2;let r=U("input",e[0].dataType,e[0].dims,4),o=U("bias",e[0].dataType,[e[0].dims[2]],4),n=K("output",e[0].dataType,t,4),s=V.size(t)/4,u=Ge(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)}}),getShaderSource:a=>`\n  const M_SQRT2 = sqrt(2.0);\n  const halfChannels = ${e[0].dims[2]/4/2}u;\n\n  ${a.declareVariables(r,o,n)}\n\n  ${sn(`vec4<${u}>`,u)}\n\n  ${a.mainStart()}\n    ${a.guardAgainstOutOfBoundsWorkgroupSizes(s)}\n    let biasIdx = global_idx % halfChannels;\n    let batchIndex = global_idx / halfChannels;\n    let inputOffset = biasIdx + batchIndex * halfChannels * 2;\n    let valueLeft = input[inputOffset] + bias[biasIdx];\n    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];\n    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);\n\n    ${n.setByOffset("global_idx","valueLeft * geluRight")}\n  }`}},Ui=e=>{cl(e.inputs),e.compute(pl(e.inputs))}});var ml,fl,wt,Vi,Ni,Wi,Gi,Hi,Li,Fi,Ki,qi,ji,Yi=q(()=>{"use strict";We();xe();$e();ml=(e,t,r,o,n,s,u,l,a,p,h,g,w)=>{let v,y;typeof l=="string"?v=y=(D,G)=>`${l}((${D}),(${G}))`:typeof l=="function"?v=y=l:(v=l.scalar,y=l.vector);let _=g?t.length:t,I=g?r.length:r,x=g?o.length:o,A=K("outputData",h,x,4),O=U("aData",a,_,4),C=U("bData",p,I,4),M;if(n)if(s){let D=V.size(t)===1,G=V.size(r)===1,E=t.length>0&&t[t.length-1]%4===0,W=r.length>0&&r[r.length-1]%4===0;D||G?M=A.setByOffset("global_idx",y(D?`${O.type.value}(${O.getByOffset("0")}.x)`:O.getByOffset("global_idx"),G?`${C.type.value}(${C.getByOffset("0")}.x)`:C.getByOffset("global_idx"))):M=`\n            let outputIndices = ${A.offsetToIndices("global_idx * 4u")};\n            let offsetA = ${O.broadcastedIndicesToOffset("outputIndices",A)};\n            let offsetB = ${C.broadcastedIndicesToOffset("outputIndices",A)};\n            ${A.setByOffset("global_idx",y(u||E?O.getByOffset("offsetA / 4u"):`${O.type.value}(${O.getByOffset("offsetA / 4u")}[offsetA % 4u])`,u||W?C.getByOffset("offsetB / 4u"):`${C.type.value}(${C.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}\n          `}else M=A.setByOffset("global_idx",y(O.getByOffset("global_idx"),C.getByOffset("global_idx")));else{if(!s)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let D=(G,E,W="")=>{let te=`aData[indexA${E}][componentA${E}]`,Y=`bData[indexB${E}][componentB${E}]`;return`\n            let outputIndices${E} = ${A.offsetToIndices(`global_idx * 4u + ${E}u`)};\n            let offsetA${E} = ${O.broadcastedIndicesToOffset(`outputIndices${E}`,A)};\n            let offsetB${E} = ${C.broadcastedIndicesToOffset(`outputIndices${E}`,A)};\n            let indexA${E} = offsetA${E} / 4u;\n            let indexB${E} = offsetB${E} / 4u;\n            let componentA${E} = offsetA${E} % 4u;\n            let componentB${E} = offsetB${E} % 4u;\n            ${G}[${E}] = ${W}(${v(te,Y)});\n          `};h===9?M=`\n            var data = vec4<u32>(0);\n            ${D("data",0,"u32")}\n            ${D("data",1,"u32")}\n            ${D("data",2,"u32")}\n            ${D("data",3,"u32")}\n            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:M=`\n            ${D("outputData[global_idx]",0)}\n            ${D("outputData[global_idx]",1)}\n            ${D("outputData[global_idx]",2)}\n            ${D("outputData[global_idx]",3)}\n          `}return`\n        ${e.registerUniform("vec_size","u32").declareVariables(O,C,A)}\n\n        ${w??""}\n\n        ${e.mainStart()}\n        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n        ${M}\n      }`},fl=(e,t,r,o,n,s,u=r.dataType)=>{let l=!V.areEqual(r.dims,o.dims),a=r.dims,p=V.size(r.dims),h=!1,g=!1,w=[l];if(l){let y=mt.calcShape(r.dims,o.dims,!1);if(!y)throw new Error("Can\'t perform binary op on the given tensors");a=y,p=V.size(a);let _=V.size(r.dims)===1,I=V.size(o.dims)===1,x=r.dims.length>0&&r.dims[r.dims.length-1]%4===0,A=o.dims.length>0&&o.dims[o.dims.length-1]%4===0;w.push(_),w.push(I),w.push(x),w.push(A);let O=1;for(let C=1;C<a.length;C++){let M=r.dims[r.dims.length-C]??1,D=o.dims[o.dims.length-C]??1;if(M===D)O*=M;else break}O%4===0?(g=!0,h=!0):(_||I||x||A)&&(h=!0)}else h=!0;w.push(h);let v=Ue(r.dims.length)&&Ue(o.dims.length)&&Ue(a.length);return{name:e,shaderCache:{hint:t+w.map(y=>y.toString()).join("_"),inputDependencies:v?["rank","rank"]:["dims","dims"]},getShaderSource:y=>ml(y,r.dims,o.dims,a,h,l,g,n,r.dataType,o.dataType,u,v,s),getRunData:()=>({outputs:[{dims:a,dataType:u}],dispatchGroup:{x:Math.ceil(p/64/4)},programUniforms:v?[{type:"uint32",data:Math.ceil(V.size(a)/4)},...F(r.dims),...F(o.dims),...F(a)]:[{type:"uint32",data:Math.ceil(V.size(a)/4)}]})}},wt=(e,t,r,o,n,s)=>{e.compute(fl(t,n??"",e.inputs[0],e.inputs[1],r,o,s))},Vi=e=>{wt(e,"Add",(t,r)=>`${t}+${r}`)},Ni=e=>{wt(e,"Div",(t,r)=>`${t}/${r}`)},Wi=e=>{wt(e,"Equal",{scalar:(t,r)=>`u32(${t}==${r})`,vector:(t,r)=>`vec4<u32>(${t}==${r})`},void 0,void 0,9)},Gi=e=>{wt(e,"Mul",(t,r)=>`${t}*${r}`)},Hi=e=>{let t=U("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;wt(e,"Pow",{scalar:(o,n)=>`pow_custom(${o},${n})`,vector:(o,n)=>`pow_vector_custom(${o},${n})`},`\n    fn pow_custom(a : ${t}, b : ${t}) -> ${t} {\n      if (b == ${t}(0.0)) {\n        return ${t}(1.0);\n      } else if (a < ${t}(0.0) && f32(b) != floor(f32(b))) {\n        return ${t}(pow(f32(a), f32(b))); // NaN\n      }\n      return select(sign(a), ${t}(1.0), round(f32(abs(b) % ${t}(2.0))) != 1.0) * ${t}(${t==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));\n    }\n    fn pow_vector_custom(a : vec4<${t}>, b : vec4<${t}>) -> vec4<${t}> {\n      // TODO: implement vectorized pow\n      return vec4<${t}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));\n    }\n      `)},Li=e=>{wt(e,"Sub",(t,r)=>`${t}-${r}`)},Fi=e=>{wt(e,"Greater",{scalar:(t,r)=>`u32(${t}>${r})`,vector:(t,r)=>`vec4<u32>(${t}>${r})`},void 0,void 0,9)},Ki=e=>{wt(e,"Less",{scalar:(t,r)=>`u32(${t}<${r})`,vector:(t,r)=>`vec4<u32>(${t}<${r})`},void 0,void 0,9)},qi=e=>{wt(e,"GreaterOrEqual",{scalar:(t,r)=>`u32(${t}>=${r})`,vector:(t,r)=>`vec4<u32>(${t}>=${r})`},void 0,void 0,9)},ji=e=>{wt(e,"LessOrEqual",{scalar:(t,r)=>`u32(${t}<=${r})`,vector:(t,r)=>`vec4<u32>(${t}<=${r})`},void 0,void 0,9)}});var gl,yl,bl,wl,Zi,Qi,Ji=q(()=>{"use strict";xe();Le();$e();gl=e=>{if(!e||e.length<1)throw new Error("too few inputs");let t=e[0].dataType,r=e[0].dims.length;for(let o of e){if(o.dataType!==t)throw new Error("input tensors should be one type");if(o.dims.length!==r)throw new Error("input tensors should have the same shape")}},yl=(e,t)=>`\n  fn calculateInputIndex(index: u32) -> u32 {\n    let sizeInConcatAxis = array<u32, ${e}u>(${t});\n    for (var i: u32 = 0u; i < ${e}; i += 1u ) {\n      if (index < sizeInConcatAxis[i]) {\n        return i;\n      }\n    }\n    return ${e}u;\n  }`,bl=(e,t)=>{let r=e.length,o=[];for(let n=0;n<r;++n){let s=t.setByOffset("global_idx",e[n].getByIndices("indices"));r===1?o.push(s):n===0?o.push(`if (inputIndex == ${n}u) { ${s} }`):n===r-1?o.push(`else { ${s} }`):o.push(`else if (inputIndex == ${n}) { ${s} }`)}return o.join(`\n`)},wl=(e,t)=>{let r=e[0].dims.slice();if(t>=r.length||t<-1*r.length)throw new Error("axis specified for concat doesn\'t match input dimensionality");let o=t<0?r.length+t:t,n=r.slice(0);for(let C=1;C<e.length;C++){let M=e[C].dims.slice();for(let D=0;D<r.length;D++)if(D===o)n[o]+=M[D];else if(r[D]!==M[D])throw new Error("non concat dimensions must match")}let s=V.size(n),u=new Array(e.length),l=new Array(e.length),a=e[0].dataType,p=0,h=[],g=[],w=[],v=[{type:"uint32",data:s}];for(let C=0;C<e.length;++C)p+=e[C].dims[o],u[C]=p,w.push(Ue(e[C].dims.length)),g.push(w[C]?e[C].dims.length:e[C].dims),l[C]=U(`input${C}`,a,g[C]),h.push(w[C]?"rank":"dims"),v.push({type:"uint32",data:u[C]});for(let C=0;C<e.length;++C)w[C]&&v.push(...F(e[C].dims));let y=Ue(n.length);y&&v.push(...F(n));let _=y?n.length:n,I=K("output",a,_),x=I.indicesGet("indices",o),A=Array.from(Array(u.length).keys()).map(C=>`uniforms.sizeInConcatAxis${C}`).join(","),O=C=>`\n\n  ${(()=>{C.registerUniform("outputSize","u32");for(let M=0;M<e.length;M++)C.registerUniform(`sizeInConcatAxis${M}`,"u32");return C.declareVariables(...l,I)})()}\n\n  ${yl(u.length,A)}\n\n  ${C.mainStart()}\n    ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n    var indices = ${I.offsetToIndices("global_idx")};\n\n    let inputIndex = calculateInputIndex(${x});\n    if (inputIndex != 0u) {\n      let sizeInConcatAxis = array<u32, ${u.length}u>(${A});\n      ${x} -= sizeInConcatAxis[inputIndex - 1u];\n    }\n\n    ${bl(l,I)}\n  }`;return{name:"Concat",shaderCache:{hint:`${t}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:v}),getShaderSource:O}},Zi=(e,t)=>{gl(e.inputs),e.compute(wl(e.inputs,t.axis))},Qi=e=>he({axis:e.axis})});var vt,un,Bt=q(()=>{"use strict";xe();vt=(e,t)=>{switch(e.activation){case"Relu":return{activationFunction:"",applyActivation:`value = max(value, ${t}(0.0));`};case"Sigmoid":return{activationFunction:"",applyActivation:`value = (${t}(1.0) / (${t}(1.0) + exp(-value)));`};case"Clip":return{activationFunction:`const clip_min_=${t}(${e.clipMin});const clip_max_=${t}(${e.clipMax});`,applyActivation:"value = clamp(value, clip_min_, clip_max_);"};default:return{activationFunction:"",applyActivation:""}}},un=e=>{let t=e?.activation||"";if(t==="Clip"){let[r,o]=e?.activation_params||[Xr,en];return{activation:t,clipMax:o,clipMin:r,activationCacheKey:`${t}:${r},${o}`}}return{activation:t,activationCacheKey:t}}});var qe,dn,ln=q(()=>{"use strict";qe=(e,t)=>{switch(e){case 1:return t;case 2:return`vec2<${t}>`;case 3:return`vec3<${t}>`;case 4:return`vec4<${t}>`;default:throw new Error(`${e}-component is not supported.`)}},dn=e=>`\n      ${e?"value = value + getBiasByOutputCoords(coords);":""}\n      `});var cn,eo=q(()=>{"use strict";cn=e=>`\nfn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));\n}\nfn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n    i32(${e}.x), i32(${e}.y), i32(${e}.z), 1));\n}\n`});var vl,$l,Ar,Xi,Sl,Tr,xl,pn,Er=q(()=>{"use strict";xe();$e();Bt();ln();vl=(e,t)=>e?`\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          kStart + inputRow,\n          globalRowStart / innerElementSize + inputCol${t?", batchIndices":""});\n        `:`\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          globalRow + innerRow,\n          kStart / innerElementSize + inputCol${t?", batchIndices":""});\n        `,$l=(e,t)=>e?`\n        let ACached0 = mm_Asub[k * innerElementSize][localRow];\n        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];\n        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];\n        ${t===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          acc[i] = BCached0 * ACached0[i] + acc[i];\n          acc[i] = BCached1 * ACached1[i] + acc[i];\n          acc[i] = BCached2 * ACached2[i] + acc[i];\n          ${t===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}\n        }`:`\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          let ACached = mm_Asub[tileRow + i][k];\n          acc[i] = BCached0 * ACached.x + acc[i];\n          acc[i] = BCached1 * ACached.y + acc[i];\n          acc[i] = BCached2 * ACached.z + acc[i];\n          ${t===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}\n        }`,Ar=(e,t,r="f32",o,n=!1,s=32,u=!1,l=32)=>{let a=t[1]*e[1],p=t[0]*e[0],h=n?a:s,g=n?s:a,w=h/t[0],v=s/t[1];if(!((n&&w===4&&e[1]===4||!n&&(w===3||w===4))&&h%t[0]===0&&s%t[1]===0&&e[0]===4))throw new Error(`If transposeA ${n} is true, innerElementSize ${w} and workPerThread[1] ${e[1]} must be 4.\n      Otherwise, innerElementSize ${w} must be 3 or 4.\n  tileAWidth ${h} must be divisible by workgroupSize[0]${t[0]}. tileInner ${s} must be divisible by workgroupSize[1] ${t[1]}. colPerThread ${e[0]} must be 4.`);return`\nvar<workgroup> mm_Asub: array<array<vec${w}<${r}>, ${h/w}>, ${g}>;\nvar<workgroup> mm_Bsub: array<array<vec4<${r}>, ${p/e[0]}>, ${s}>;\n\nconst rowPerThread = ${e[1]};\nconst colPerThread = ${e[0]};\nconst innerElementSize = ${w};\nconst tileInner = ${s};\n\n@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n  let localRow = i32(localId.y);\n  let tileRow = localRow * rowPerThread;\n  let tileCol = i32(localId.x);\n\n  let globalRow =i32(globalId.y) * rowPerThread;\n  let globalCol = i32(globalId.x);\n  let batch = ${u?"0":"i32(globalId.z)"};\n  ${o?`let batchIndices = ${o.offsetToIndices("u32(batch)")};`:""}\n  let globalRowStart = i32(workgroupId.y) * ${a};\n\n  let numTiles = ${u?`${Math.ceil(l/s)}`:"(uniforms.dimInner - 1) / tileInner + 1"};\n  var kStart = ${u?`i32(globalId.z) * ${l}`:"0"};\n\n  var acc: array<vec4<${r}>, rowPerThread>;\n\n  // Loop over shared dimension.\n  let tileRowB = localRow * ${v};\n  for (var t = 0; t < numTiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let inputRow = tileRow + innerRow;\n          let inputCol = tileCol;\n          ${vl(n,o)}\n      }\n\n      // Load one tile of B into local memory.\n      for (var innerRow = 0; innerRow < ${v}; innerRow = innerRow + 1) {\n          let inputRow = tileRowB + innerRow;\n          let inputCol = tileCol;\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${o?", batchIndices":""});\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {\n          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];\n          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];\n          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];\n          ${w===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}\n\n          ${$l(n,w)}\n      }\n\n      workgroupBarrier();\n  }\n\n  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);\n  }\n}`},Xi=(e,t)=>e?`\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              kStart + inputRow,\n              globalRowStart + inputCol${t?", batchIndices":""});\n            `:`\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              globalRowStart + inputRow,\n              kStart + inputCol${t?", batchIndices":""});\n            `,Sl=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",Tr=(e,t,r="f32",o,n=!1,s=32,u=!1,l=32,a=!1)=>{let p=e[1]*t[1],h=e[0]*t[0],g=n?p:s,w=n?s:p;if(!(w%t[1]===0&&g%t[0]===0&&s%t[1]===0))throw new Error(`tileAHight ${w} must be divisible by workgroupSize[1]${t[1]}, tileAWidth ${g} must be divisible by workgroupSize[0]${t[0]}, tileInner ${s} must be divisible by workgroupSize[1]${t[1]}`);let v=w/t[1],y=g/t[0],_=s/t[1],I=a?`\n    let localRow = i32(localId.y);\n    let localCol = i32(localId.x);\n    let globalRowStart = i32(workgroupId.y) * ${p};\n    let globalColStart = i32(workgroupId.x) * ${h};\n\n    // Loop over shared dimension.\n    for (var t = 0; t < numTiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var inputRow = localRow; inputRow < ${w}; inputRow = inputRow + ${t[1]}) {\n        for (var inputCol = localCol; inputCol < ${g}; inputCol = inputCol + ${t[0]}) {\n          ${Xi(n,o)}\n        }\n      }\n      // Load one tile of B into local memory.\n      for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${t[1]}) {\n            for (var inputCol = localCol; inputCol < ${h}; inputCol = inputCol + ${t[0]}) {\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n            kStart + inputRow,\n            globalColStart + inputCol${o?", batchIndices":""});\n        }\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      var BCached : array<${r}, colPerThread>;\n      for (var k = 0; k < tileInner; k = k + 1) {\n        for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n          BCached[inner] = mm_Bsub[k][localCol + inner * ${t[0]}];\n        }\n        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let ACached = ${n?`mm_Asub[k][localRow + innerRow * ${t[1]}];`:`mm_Asub[localRow + innerRow * ${t[1]}][k];`}\n          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n            acc[innerRow][innerCol] = acc[innerRow][innerCol] +\n                ACached * BCached[innerCol];\n          }\n        }\n      }\n      workgroupBarrier();\n    }\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      let gRow = globalRowStart + localRow + innerRow * ${t[1]};\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        let gCol = globalColStart + localCol + innerCol * ${t[0]};\n        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);\n      }\n    }\n    `:`\nlet tileRow = i32(localId.y) * rowPerThread;\nlet tileCol = i32(localId.x) * colPerThread;\n\nlet globalRow = i32(globalId.y) * rowPerThread;\nlet globalCol = i32(globalId.x) * colPerThread;\nlet globalRowStart = i32(workgroupId.y) * ${p};\n\nlet tileRowA = i32(localId.y) * ${v};\nlet tileColA = i32(localId.x) * ${y};\nlet tileRowB = i32(localId.y) * ${_};\n// Loop over shared dimension.\nfor (var t = 0; t < numTiles; t = t + 1) {\n  // Load one tile of A into local memory.\n  for (var innerRow = 0; innerRow < ${v}; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < ${y}; innerCol = innerCol + 1) {\n      let inputRow = tileRowA + innerRow;\n      let inputCol = tileColA + innerCol;\n      ${Xi(n,o)}\n    }\n  }\n\n  // Load one tile of B into local memory.\n  for (var innerRow = 0; innerRow < ${_}; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n      let inputRow = tileRowB + innerRow;\n      let inputCol = tileCol + innerCol;\n      mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n        kStart + inputRow,\n        globalCol + innerCol${o?", batchIndices":""});\n    }\n  }\n  kStart = kStart + tileInner;\n  workgroupBarrier();\n\n  // Compute acc values for a single thread.\n  var BCached : array<${r}, colPerThread>;\n  for (var k = 0; k < tileInner; k = k + 1) {\n    for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n      BCached[inner] = mm_Bsub[k][tileCol + inner];\n    }\n\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      ${Sl(n)}\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];\n      }\n    }\n  }\n\n  workgroupBarrier();\n}\n\nfor (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n    mm_write(batch, globalRow + innerRow, globalCol + innerCol,\n        acc[innerRow][innerCol]);\n  }\n}\n`;return`\n  var<workgroup> mm_Asub : array<array<${r}, ${g}>, ${w}>;\n  var<workgroup> mm_Bsub : array<array<${r}, ${h}>, ${s}>;\n  const rowPerThread = ${e[1]};\n  const colPerThread = ${e[0]};\n  const tileInner = ${s};\n\n@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n    let batch = ${u?"0":"i32(globalId.z)"};\n    ${o?`let batchIndices = ${o.offsetToIndices("u32(batch)")};`:""}\n    let numTiles = ${u?`${Math.ceil(l/s)}`:"(uniforms.dimInner - 1) / tileInner + 1"};\n    var kStart = ${u?`i32(globalId.z) * ${l}`:"0"};\n\n    var acc : array<array<${r}, colPerThread>, rowPerThread>;\n\n    // Without this initialization strange values show up in acc.\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        acc[innerRow][innerCol] = 0.0;\n      }\n    }\n    ${I}\n  }\n`},xl=(e,t,r,o,n,s=!1)=>{let[u,l,a]=n,[p,h,g,w]=o,v=nr(u,a),y=nr(l,a),_=Ge(o[0].type.tensor),I=()=>{let O=h.rank,C=p.rank,M=`var aIndices: ${h.type.indices};`;for(let D=O-2-1,G=C-1;D>=0;D--,G--)M+=`\naIndices[${D}] = ${C>1?`batchIndices[${G}]`:"batchIndices"};`;return v.forEach(D=>{M+=`\naIndices[${D}] = 0;`}),M+=`\naIndices[${O-2}] = u32(row);\n                   aIndices[${O-1}] = u32(colIn);`,M},x=()=>{let O=g.rank,C=p.rank,M=`var bIndices: ${g.type.indices};`;for(let D=O-2-1,G=C-1;D>=0;D--,G--)M+=`\nbIndices[${D}] = ${C>1?`batchIndices[${G}]`:"batchIndices"};`;return y.forEach(D=>{M+=`\nbIndices[${D}] = 0;`}),M+=`\nbIndices[${O-2}] = u32(row);\n                   bIndices[${O-1}] = u32(colIn);`,M};return`\n    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${p.type.indices}) -> ${qe(e,_)} {\n      var value = ${qe(e,_)}(0.0);\n      let col = colIn * ${e};\n      if(row < uniforms.dimAOuter && col < uniforms.dimInner)\n      {\n        ${I()}\n        value = ${h.getByIndices("aIndices")};\n      }\n      return value;\n    }\n\n    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${p.type.indices}) -> ${qe(e,_)} {\n      var value = ${qe(e,_)}(0.0);\n      let col = colIn * ${e};\n      if(row < uniforms.dimInner && col < uniforms.dimBOuter)\n      {\n        ${x()}\n        value = ${g.getByIndices("bIndices")};\n      }\n      return value;\n    }\n\n    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${qe(e,_)}) {\n      let col = colIn * ${e};\n      if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {\n        var value = valueIn;\n        let coords = vec3<i32>(batch, row, colIn);\n        ${t?`value = value + ${s?"bias[colIn]":`${qe(e,_)}(bias[row])`};`:""}\n        ${r}\n        ${w.setByIndices("vec3<u32>(coords)","value")}\n      }\n    }\n    `},pn=(e,t,r,o,n=!1)=>{let s=e[0].dims,u=e[1].dims,l=s.slice(0,-2),a=u.slice(0,-2),p=o?o.slice(0,-2):r.slice(0,-2),h=Ue(p.length),g=h?p.length:p,w=tn("batchDims",e[0].dataType,g,1),v=V.size(p),y=s[s.length-2],_=s[s.length-1],I=u[u.length-1],x=_%4===0&&I%4===0,A=y<=8?[4,1,1]:[4,4,1],O=[8,8,1],C=[Math.ceil(I/O[0]/A[0]),Math.ceil(y/O[1]/A[1]),Math.ceil(v/O[2]/A[2])],M=Ge(e[0].dataType),D=x?4:1,G=[...l,y,_/D],E=Ue(G.length),W=E?G.length:G,te=[...a,_,I/D],Y=Ue(te.length),Z=Y?te.length:te,ee=[v,y,I/D],Te=U("a",e[0].dataType,W,D),De=U("b",e[1].dataType,Z,D),re=K("result",e[0].dataType,ee.length,D),Ie=[Te,De],Oe=[{type:"int32",data:y},{type:"int32",data:I},{type:"int32",data:_}];h&&Oe.push(...F(p)),E&&Oe.push(...F(G)),Y&&Oe.push(...F(te));let ie=[];ie.push(E?"rank":"dims"),ie.push(Y?"rank":"dims");let Se=e.length>2,{activationFunction:Ae,applyActivation:Pe}=vt(t,re.type.value),Fe=xl(D,Se,Pe,[w,Te,De,re],[l,a,p],n);if(Se){let J=n?D:1;Ie.push(U("bias",e[2].dataType,e[2].dims.length,J)),Oe.push(...F(e[2].dims)),ie.push("rank")}Oe.push(...F(ee));let H=J=>`\n  ${J.registerUniform("dimAOuter","i32").registerUniform("dimBOuter","i32").registerUniform("dimInner","i32").registerInternalVariables(w).declareVariables(...Ie,re)}\n  ${Ae}\n  ${Fe}\n  ${x?Ar(A,O,M,w):Tr(A,O,M,w)}\n                   `;return{name:"MatMul",shaderCache:{hint:t.activationCacheKey+`${A}${x}${n}`,inputDependencies:ie},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:C[0],y:C[1],z:C[2]},programUniforms:Oe}),getShaderSource:H}}});var _l,es,ts=q(()=>{"use strict";Pt();$e();Bt();ln();eo();Er();_l=(e,t,r,o,n=!1,s,u=4,l=4,a=4,p="f32")=>{let h=Y=>{switch(Y){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${p}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${Y} is not supported.`)}},g=Y=>{switch(Y){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${Y} is not supported.`)}},w=e?`\n    let coord = vec4<i32>(batch, xRow, xCol, xCh);\n    `:`\n    let coord = vec4<i32>(batch, xCh, xRow, xCol);\n    `,v=e?`\n    let coords = vec4<i32>(\n      batch,\n      row / outWidth,\n      row % outWidth,\n      col);\n    `:`\n    let coords = vec4<i32>(\n      batch,\n      row,\n      col / outWidth,\n      col % outWidth);\n    `,y=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",_=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",I=e?"row":"col",x=e?"col":"row",A=`\n    let inChannels = i32(uniforms.w_shape[2]);\n    let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n    let outRow = ${I} / outWidth;\n    let outCol = ${I} % outWidth;\n\n    let WRow = ${x} / (filterDims[1] * inChannels);\n    let WCol = ${x} / inChannels % filterDims[1];\n    let xRow = outRow * stride[0] + dilation[0] * WRow - pad[0];\n    let xCol = outCol * stride[1] + dilation[1] * WCol - pad[1];\n    let xCh = ${x} % inChannels;\n    var resData = ${qe(u,p)}(0.0);\n    // The bounds checking is always needed since we use it to pad zero for\n    // the \'same\' padding type.\n    if (xRow >= 0 && xRow < ${y} && xCol >= 0 && xCol < ${_}) {\n      ${w}\n      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));\n      ${h(u)}\n    }\n    return resData;`,O=e?t&&o?`\n    let col = colIn * ${u};\n    ${A}`:`\n    let col = colIn * ${u};\n    if (row < uniforms.dimAOuter && col < uniforms.dimInner) {\n      ${A}\n    }\n    return ${qe(u,p)}(0.0);`:o&&r?`\n    let col = colIn * ${u};\n    ${A}`:`\n    let col = colIn * ${u};\n    if (row < uniforms.dimInner && col < uniforms.dimBOuter) {\n      ${A}\n    }\n    return ${qe(u,p)}(0.0);`,C=`${g(l)}`,M=qe(a,p),D=e?qe(u,p):qe(l,p),G=e?qe(l,p):qe(u,p),{activationFunction:E,applyActivation:W}=vt(s,M);return`\n    ${E}\n    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${D} {\n      ${e?O:C}\n    }\n\n    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${G} {\n      ${e?C:O}\n    }\n\n    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${M}) {\n      let col = colIn * ${a};\n      if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)\n      {\n      var value = valueIn;\n      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n      ${v}\n      ${dn(n)}\n      ${W}\n      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n      }\n    }`},es=(e,t,r,o,n,s,u,l)=>{let a=t.format==="NHWC",p=a?e[0].dims[3]:e[0].dims[1],h=r[0],g=a?r[2]:r[3],w=a?r[1]:r[2],v=a?r[3]:r[1],y=a&&(p%4===0||p%3===0)&&v%4===0,_=a?v:g*w,I=a?g*w:v,x=[8,8,1],A=o<=8?[4,1,1]:[4,4,1],O=[Math.ceil(_/x[0]/A[0]),Math.ceil(I/x[1]/A[1]),Math.ceil(h/x[2]/A[2])];Re("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${O}`);let C=y?a&&p%4!==0?3:4:1,M=x[1]*A[1],D=x[0]*A[0],G=Math.max(x[0]*C,x[1]),E=o%M===0,W=n%D===0,te=s%G===0,Y=y?[C,4,4]:[1,1,1],Z=Ge(e[0].dataType),ee=y?4:1,Te=[{type:"int32",data:o},{type:"int32",data:n},{type:"int32",data:s}],De=U("x",e[0].dataType,e[0].dims.length,C===3?1:C),re=U("w",e[1].dataType,e[1].dims.length,ee),Ie=[De,re];Te.push(...F(e[0].dims)),Te.push(...F(e[1].dims));let Oe=`\n      fn setOutputAtIndex(flatIndex : i32, value : ${y?`vec4<${Z}>`:Z}) {\n        result[flatIndex] = ${y?`vec4<${Z}>`:Z}(value);\n      }\n      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${y?`vec4<${Z}>`:Z}) {\n        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));\n        setOutputAtIndex(flatIndex ${y?"/ 4":""}, value);\n      }`;if(u){let Se=U("bias",e[2].dataType,e[2].dims.length,ee);Ie.push(Se),Te.push(...F(e[2].dims)),Oe+=`\n        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${y?`vec4<${Z}>`:Z} {\n          return bias[coords.${a?"w":"y"}${y?"/ 4":""}];\n        }`}let ie=K("result",e[0].dataType,r.length,ee);return Te.push(...F(r)),{name:"Conv2DMatMul",shaderCache:{hint:t.cacheKey},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:O[0],y:O[1],z:O[2]},programUniforms:Te}),getShaderSource:Se=>`\n        ${cn("uniforms.result_strides")}\n        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,\n        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,\n        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };\n        ${Se.registerUniform("dimAOuter","i32").registerUniform("dimBOuter","i32").registerUniform("dimInner","i32").declareVariables(...Ie,ie)}\n        const filterDims : vec2<i32> = vec2<i32>(${t.kernelShape[0]}, ${t.kernelShape[1]});\n        const pad : vec2<i32> = vec2<i32>(${t.pads[0]}, ${t.pads[1]});\n        const stride : vec2<i32> = vec2<i32>(${t.strides[0]}, ${t.strides[1]});\n        const dilation : vec2<i32> = vec2<i32>(${t.dilations[0]}, ${t.dilations[1]});\n        ${Oe}\n        ${_l(a,E,W,te,u,t,Y[0],Y[1],Y[2],Z)}\n            ${y?Ar(A,x,Z,void 0,!a,G):Tr(A,x,Z,void 0,!a,G,!1,void 0,l)}`}}});var to,rs=q(()=>{"use strict";xe();$e();no();Bt();to=(e,t,r)=>{let o=e.length>2,n=o?"value += b[output_channel];":"",s=e[0].dims,u=e[1].dims,l=u[0]/t.group,a=t.format==="NHWC",p=ro(s,u,t.dilations,t.pads,t.strides,a),h=V.size(p),g=K("output",e[0].dataType,p),{activationFunction:w,applyActivation:v}=vt(t,g.type.value),y=U("x",e[0].dataType,s),_=U("w",e[1].dataType,u),I=[y,_];o&&I.push(U("b",e[2].dataType,e[2].dims));let x=A=>`\n  const strides: vec2<u32> = vec2(${t.strides[0]}u, ${t.strides[1]}u);\n  const pads: vec2<u32> = vec2(${t.pads[0]}u, ${t.pads[1]}u);\n\n  ${A.declareVariables(...I,g)}\n\n  ${w}\n\n  ${A.mainStart()}\n    ${A.guardAgainstOutOfBoundsWorkgroupSizes(h)}\n\n    let outputIndices = ${g.offsetToIndices("global_idx")};\n    let batch: u32 = outputIndices[0];\n    let output_channel: u32 = outputIndices[${a?3:1}];\n    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${a?1:2}], outputIndices[${a?2:3}]) * strides - pads;\n    let group_id: u32 = output_channel / ${l}u;\n\n    var value: ${g.type.value} = ${g.type.value}(0);\n    for (var wInChannel: u32 = 0u; wInChannel < ${u[1]}u; wInChannel++) {\n      let input_channel = group_id * ${u[1]}u + wInChannel;\n      for (var wHeight: u32 = 0u; wHeight < ${u[2]}u; wHeight++) {\n        let xHeight = xRCCorner.x + wHeight * ${t.dilations[0]}u;\n\n        if (xHeight < 0u || xHeight >= ${s[a?1:2]}u) {\n          continue;\n        }\n\n        for (var wWidth: u32 = 0u; wWidth < ${u[3]}u; wWidth++) {\n          let xWidth = xRCCorner.y + wWidth * ${t.dilations[1]}u;\n          if (xWidth < 0u || xWidth >= ${s[a?2:3]}u) {\n            continue;\n          }\n\n          let xVal = ${a?y.get("batch","xHeight","xWidth","input_channel"):y.get("batch","input_channel","xHeight","xWidth")};\n          let wVal = ${_.get("output_channel","wInChannel","wHeight","wWidth")};\n          value += xVal*wVal;\n        }\n      }\n    }\n    ${n}\n    ${v}\n    ${g.setByOffset("global_idx","value")}\n  }`;return{name:"GroupedConv",shaderCache:{hint:t.cacheKey},getRunData:()=>({outputs:[{dims:r?r(p):p,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)}}),getShaderSource:x}}});var oo,Cl,ns,ao=q(()=>{"use strict";xe();Er();$e();Bt();oo=(e,t,r,o,n=!1)=>{let s=e[0].dims,u=e[1].dims,l=s[s.length-2],a=u[u.length-1],p=s[s.length-1],h=He(a),g=He(p),w=He(l),v=V.size(r)/h/w,y=e.length>2,_=o?o.slice(0,-2):r.slice(0,-2),x=[V.size(_),l,a],A=[{type:"uint32",data:v},{type:"uint32",data:l},{type:"uint32",data:a},{type:"uint32",data:p},...F(_),...F(s),...F(u)];y&&A.push(...F(e[2].dims)),A.push(...F(x));let O=C=>{let M=tn("batch_dims",e[0].dataType,_.length),D=U("a",e[0].dataType,s.length,g),G=U("b",e[1].dataType,u.length,h),E=K("output",e[0].dataType,x.length,h),{activationFunction:W,applyActivation:te}=vt(t,E.type.value),Y=[D,G],Z="";if(y){let ie=n?h:1;Y.push(U("bias",e[2].dataType,e[2].dims.length,ie)),Z=`${n?`value += bias[col / ${ie}];`:`value += ${E.type.value}(bias[row + i]);`}`}let ee=s.slice(0,-2),Te=u.slice(0,-2),De=nr(ee,_),re=nr(Te,_),Ie=(ie,Se)=>{let Ae=ie.rank,Pe=ie.name;if(Ae===2)return`var ${Pe}_indices = ${ie.type.indices}(0u, 0u);`;let Fe=M.rank,H=`var ${Pe}_indices: ${ie.type.indices};`;for(let J=Ae-2-1,Ce=Fe-1;J>=0;J--,Ce--)H+=`\n${Pe}_indices[${J}] = ${Fe>1?`batch_indices[${Ce}]`:"batch_indices"};`;return Se.forEach(J=>{H+=`\n${Pe}_indices[${J}] = 0;`}),H+=`${Pe}_indices[${Ae-2}] = 0u;\n                     ${Pe}_indices[${Ae-1}] = 0u;`,H},Oe=()=>{let ie=`var a_data: ${D.type.value};`;for(let Se=0;Se<g;Se++)ie+=`\n              let b_data${Se} = b[(b_offset + (k + ${Se}) * uniforms.N + col) / ${h}];`;for(let Se=0;Se<w;Se++){ie+=`a_data = a[(a_offset + (row + ${Se}) * uniforms.K + k) / ${g}];`;for(let Ae=0;Ae<g;Ae++)ie+=`\n            values[${Se}] = fma(${G.type.value}(a_data${g===1?"":`[${Ae}]`}), b_data${Ae}, values[${Se}]);\n`}return ie};return`\n  ${C.registerUniform("outputSize","u32").registerUniform("M","u32").registerUniform("N","u32").registerUniform("K","u32").registerInternalVariables(M).declareVariables(...Y,E)}\n  ${W}\n  ${C.mainStart()}\n    ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n    let col = (global_idx % (uniforms.N / ${h})) * ${h};\n    var index1 = global_idx / (uniforms.N / ${h});\n    let stride1 = uniforms.M / ${w};\n    let row = (index1 % stride1) * ${w};\n    let batch = index1 / stride1;\n\n    ${r.length===2?"":`let batch_indices = ${M.offsetToIndices("batch")};`}\n    ${Ie(D,De)}\n    let a_offset = ${D.indicesToOffset("a_indices")};\n    ${Ie(G,re)}\n    let b_offset = ${G.indicesToOffset("b_indices")};\n    var values: array<${E.type.value}, ${w}>;\n    for (var k: u32 = 0u; k < uniforms.K; k = k + ${g}) {\n      ${Oe()}\n    }\n    for (var i = 0u; i < ${w}u; i++) {\n      var value = values[i];\n      ${Z}\n      ${te}\n      let cur_indices = ${E.type.indices}(batch, row + i, col);\n      let offset = ${E.indicesToOffset("cur_indices")};\n      ${E.setByOffset(`offset / ${h}`,"value")};\n    }\n  }\n  `};return{name:"MatMulNaive",shaderCache:{hint:`${t.activationCacheKey}_${h}_${g}_${w}_${n}`,inputDependencies:y?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:A}),getShaderSource:O}},Cl=e=>{if(!e||e.length!==2)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},ns=e=>{Cl(e.inputs);let t=mt.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!t)throw new Error("Can\'t use matmul on the given tensors");let r=t[t.length-1],o=e.inputs[0].dims[e.inputs[0].dims.length-1];r<8&&o<8?e.compute(oo(e.inputs,{activation:"",activationCacheKey:""},t)):e.compute(pn(e.inputs,{activation:"",activationCacheKey:""},t))}});var ro,os,Il,as,io,Al,Tl,so,no=q(()=>{"use strict";xe();Le();ts();Er();rs();Bt();ao();or();ro=(e,t,r,o,n,s)=>{let u=e[0],l=e.slice(s?1:2,s?3:4),a=l.length,p=t[0],g=t.slice(2).map((y,_)=>y+(y-1)*(r[_]-1)),v=l.map((y,_)=>y+o[_]+o[_+a]).map((y,_)=>Math.floor((y-g[_]+n[_])/n[_]));return v.splice(0,0,u),v.splice(s?3:1,0,p),v},os=[2,3,1,0],Il=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support conv 1D and 2D");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let r=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],o=e[1].dims[1]*t.group;if(r!==o)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(e.length===3&&(e[2].dims.length!==1||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let n=e[0].dims.length-2;if(t.dilations.length!==n)throw new Error(`dilations should be ${n}D`);if(t.strides.length!==n)throw new Error(`strides should be ${n}D`);if(t.pads.length!==n*2)throw new Error(`pads should be ${n*2}D`);if(t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},as=(e,t)=>{let r=e.kernelShape.slice();for(let s=2;s<t[1].dims.length;++s)r[s-2]===0&&(r[s-2]=t[1].dims[s]);let o=e.pads.slice();Wt.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,r,o,e.format==="NHWC",e.autoPad);let n=Object.assign({},e);return Object.assign(n,{kernelShape:r,pads:o,cacheKey:e.cacheKey}),n},io=e=>{let t=un(e),r=e.format,o=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],n=e.dilations,s=e.group,u=e.kernel_shape,l=e.pads,a=e.strides,p=e.w_is_const();return he({autoPad:o,format:r,dilations:n,group:s,kernelShape:u,pads:l,strides:a,wIsConst:p,...t})},Al=(e,t,r)=>{let o=as(r,t),n=r.format==="NHWC";if(r.group!==1){e.compute(to(t,o));return}let s=t.length===3,u=t[0].dims[n?1:2],l=t[0].dims[n?2:3],a=t[0].dims[n?3:1],p=t[1].dims[2],h=t[1].dims[3],g=ro(t[0].dims,t[1].dims,r.dilations,o.pads,r.strides,n),w=g[n?1:2],v=g[n?2:3],y=g[n?3:1],_=n&&p===u&&h===l&&r.pads[0]===0&&r.pads[1]===0;if(_||p===1&&h===1&&r.dilations[0]===1&&r.dilations[1]===1&&r.strides[0]===1&&r.strides[1]===1&&r.pads[0]===0&&r.pads[1]===0){let D=g[0],G,E,W,te=[];if(n){let ee=e.kernelCustomData.wT??e.compute(dt(t[1],os),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];if(r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=ee),_){let Te=u*l*a;G=t[0].reshape([1,D,Te]),E=ee.reshape([1,Te,y]),W=[1,D,y]}else G=t[0].reshape([D,u*l,a]),E=ee.reshape([1,a,y]),W=[D,w*v,y];te.push(G),te.push(E)}else G=t[0].reshape([D,a,u*l]),E=t[1].reshape([1,y,a]),W=[D,y,w*v],te.push(E),te.push(G);s&&te.push(t[2]);let Y=W[2],Z=te[0].dims[te[0].dims.length-1];Y<8&&Z<8?e.compute(oo(te,o,g,W,n),{inputs:te}):e.compute(pn(te,o,g,W,n),{inputs:te});return}let I=!0,x=e.kernelCustomData.wT??e.compute(dt(t[1],os),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=x);let A=[t[0],x];s&&A.push(t[2]);let O=n?w*v:y,C=n?y:w*v,M=p*h*a;e.compute(es(A,o,g,O,C,M,s,I),{inputs:A})},Tl=(e,t)=>{let r=t.format==="NHWC",o=[e.inputs[0].reshape(r?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&o.push(e.inputs[2]);let n=[0,t.pads[0],0,t.pads[1]],s=[1].concat(t.strides),u=[1].concat(t.dilations),l=[1].concat(t.kernelShape),a=as({...t,pads:n,strides:s,dilations:u,kernelShape:l},o);e.compute(to(o,a,p=>r?[p[0],p[2],p[3]]:[]))},so=(e,t)=>{Il(e.inputs,t),e.inputs[0].dims.length===3?Tl(e,t):Al(e,e.inputs,t)}});var El,is,ss=q(()=>{"use strict";Pt();$e();Bt();ln();eo();Er();El=(e,t=!1,r,o=4)=>{let n=qe(o,"f32"),s=A=>{switch(A){case 1:return"return w[getIndexFromCoords4D(coord, vec4<i32>(uniforms.w_shape))];";case 4:return`\n            let coord1 = vec4<i32>(coordX, coordY, col + 1, rowInner);\n            let coord2 = vec4<i32>(coordX, coordY, col + 2, rowInner);\n            let coord3 = vec4<i32>(coordX, coordY, col + 3, rowInner);\n            let v0 = w[getIndexFromCoords4D(coord, vec4<i32>(uniforms.w_shape))];\n            let v1 = w[getIndexFromCoords4D(coord1, vec4<i32>(uniforms.w_shape))];\n            let v2 = w[getIndexFromCoords4D(coord2, vec4<i32>(uniforms.w_shape))];\n            let v3 = w[getIndexFromCoords4D(coord3, vec4<i32>(uniforms.w_shape))];\n            return vec4<f32>(v0, v1, v2, v3);\n            `;default:throw new Error(`innerElementSize ${A} is not supported.`)}},u=e?`\n      let coord = vec4<i32>(batch, iXR, iXC, xCh);\n      `:`\n      let coord = vec4<i32>(batch, xCh, iXR, iXC);\n      `,l=e?`\n    let coords = vec4<i32>(\n      batch,\n      row / outWidth,\n      row % outWidth,\n      col);\n    `:`\n    let coords = vec4<i32>(\n      batch,\n      row,\n      col / outWidth,\n      col % outWidth);\n    `,a=e?"outBackprop[1]":"outBackprop[2]",p=e?"outBackprop[2]":"outBackprop[3]",h=e?"row":"col",g=e?"col":"row",w=`\n      let inChannels = ${e?"outBackprop[3]":"outBackprop[1]"};\n      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n      let outRow = ${h} / outWidth;\n      let outCol = ${h} % outWidth;\n\n      let WRow = ${g} / (filterDims[1] * inChannels);\n      let WCol = ${g} / inChannels % filterDims[1];\n      let xR = f32(outRow - pads[0] + dilation[0] * WRow) / f32(strides[0]);\n      let xC = f32(outCol - pads[1] + dilation[1] * WCol) / f32(strides[1]);\n      if (xR < 0.0 || xR >= f32(${a}) || fract(xR) > 0.0) {\n        return ${n}(0.0);\n      }\n      if (xC < 0.0 || xC >= f32(${p}) || fract(xC) > 0.0) {\n        return ${n}(0.0);\n      }\n      let iXR = i32(xR);\n      let iXC = i32(xC);\n      let xCh = ${g} % inChannels;\n      ${u}\n      return x[getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape))/${o}];`,v=e?`\n      let col = colIn * ${o};\n      if (row < uniforms.dimAOuter && col < uniforms.dimInner) {\n        ${w}\n      }\n      return ${n}(0.0);`:`\n      let col = colIn * ${o};\n      if (row < uniforms.dimInner && col < uniforms.dimBOuter) {\n        ${w}\n      }\n      return ${n}(0.0);`,y=`\n      let col = colIn * ${o};\n      let inChannels = ${e?"outBackprop[3]":"outBackprop[1]"};\n      let coordX = filterDims.x - 1 - row / (filterDims[1] * inChannels);\n      let coordY = filterDims.y - 1 - (row / inChannels) % filterDims[1];\n      if (${e?"row < uniforms.dimInner && col < uniforms.dimBOuter":"row < uniforms.dimInner && col < uniforms.dimAOuter"}  && coordX >= 0 && coordY >= 0) {\n        let rowInner = row % inChannels;\n        let coord = vec4<i32>(coordX, coordY, col, rowInner);\n        ${s(o)}\n      }\n      return ${n}(0.0);\n      `,{activationFunction:_,applyActivation:I}=vt(r,n);return`\n      ${_}\n  fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${n} {\n    ${e?v:y}\n  }\n\n  fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${n} {\n    ${e?y:v}\n  }\n\n  fn mm_write(batch: i32, row : i32, colIn : i32, valueInput : ${n}) {\n    let col = colIn * ${o};\n    if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {\n      var value = valueInput;\n      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n      ${l}\n      ${dn(t)}\n      ${I}\n      result[getIndexFromCoords4D(coords, vec4<i32>(uniforms.result_shape))/${o}] = value;\n    }\n  }`},is=(e,t,r,o,n,s,u,l)=>{let a=t.format==="NHWC",p=a?e[0].dims[3]:e[0].dims[1],h=r[0],g=a?r[2]:r[3],w=a?r[1]:r[2],v=a?r[3]:r[1],y=a?p%4===0&&v%4===0:g%4===0&&v%4===0,_=a?v:g*w,I=a?g*w:v,x=y?[8,8,1]:[_<=4||I<=4?4:16,_>4&&I<=4?4:16,1],A=y?[4,4,1]:[_<=4?1:4,_>4&&I<=4?1:4,1],O=[Math.ceil(_/x[0]/A[0]),Math.ceil(I/x[1]/A[1]),Math.ceil(h/x[2]/A[2])];Re("verbose",()=>`[conv_backprop_mm_webgpu] dispatch = ${O}`);let C=y?4:1,M=Math.max(x[0]*C,x[1]),D=y?4:1,G=[{type:"int32",data:o},{type:"int32",data:n},{type:"int32",data:s}],E=U("x",e[0].dataType,e[0].dims.length,D),W=U("w",e[1].dataType,e[1].dims.length,1),te=K("result",e[0].dataType,r.length,D),Y=[E,W];G.push(...F(e[0].dims)),G.push(...F(e[1].dims));let Z="";if(u){let ee=U("bias",e[2].dataType,e[2].dims.length,D);Y.push(ee),G.push(...F(e[2].dims)),Z+=`\n        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${y?"vec4<f32>":"f32"} {\n          return bias[coords.${a?"w":"y"}${y?"/ 4":""}];\n        }`}return G.push(...F(r)),{name:"Conv2DTransposeMatMul",shaderCache:{hint:t.cacheKey},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:O[0],y:O[1],z:O[2]},programUniforms:G}),getShaderSource:ee=>`\n        ${cn("uniforms.result_strides")}\n        ${ee.registerUniform("dimAOuter","i32").registerUniform("dimBOuter","i32").registerUniform("dimInner","i32").declareVariables(...Y,te)};\n        const outBackprop : vec4<i32> = vec4<i32>(${e[0].dims.join(",")});\n        const filterDims : vec2<i32> = vec2<i32>(${t.kernelShape[a?1:2]}, ${t.kernelShape[a?2:3]});\n        const effectiveFilterDims : vec2<i32> = filterDims + vec2<i32>(\n              ${t.dilations[0]<=1?0:(t.kernelShape[a?1:2]-1)*(t.dilations[0]-1)},\n              ${t.dilations[1]<=1?0:(t.kernelShape[a?2:3]-1)*(t.dilations[1]-1)});\n        const pads : vec2<i32> = vec2<i32>(i32(effectiveFilterDims[0]) - 1 - (${t.pads[0]+t.pads[2]})/2,\n                                         i32(effectiveFilterDims[1]) - 1 - (${t.pads[1]+t.pads[3]})/2);\n        const strides : vec2<i32> = vec2<i32>(${t.strides[0]}, ${t.strides[1]});\n        const dilation : vec2<i32> = vec2<i32>(${t.dilations[0]}, ${t.dilations[1]});\n        const dimAOuter : i32 = ${o};\n        const dimBOuter : i32 = ${n};\n        const dimInner : i32 = ${s};\n        ${Z}\n        ${El(a,u,t,C)}\n        ${y?Ar(A,x,"f32",void 0,!a,M):Tr(A,x,"f32",void 0,!a,M,!1,void 0,l)}`}}});var Ol,uo,us=q(()=>{"use strict";Pt();xe();$e();Ol=(e,t,r,o,n,s,u=!1,l)=>{let a=r.format==="NHWC",p=a?1:2,h=a?2:3,g=a?3:1,w=V.size(o),v=u?2:1,y=r.group,_=t[1].dims,I=_[0]/y,x=_[1],A=`\n  fn setOutputAtIndex(flatIndex : u32, value : ${u?`vec4<${l}>`:l}) {\n    result[flatIndex] = ${u?`vec4<${l}>`:l}(value);\n  }`;n&&(A+=`\n    fn getBiasByOutputCoords(coords : vec4<u32>) -> ${u?`vec4<${l}>`:l} {\n      return bias[coords.${a?"w":"y"}${u?"/ 4":""}];\n    }`);let O=u?4:1,C=U("W",t[1].dataType,t[1].dims,O),M=U("Dy",t[0].dataType,t[0].dims,O),D=[M,C];n&&D.push(U("bias",t[2].dataType,[o[g]],O));let G=K("result",t[0].dataType,o,O),E=`{\n        let batch: u32 = ${s?"global_id.z":"workgroup_id.z"} / outShape[1];\n        let r = ${s?"global_id.z":"workgroup_id.z"} % outShape[1];\n        let c = ${s?"global_id.y":"workgroup_id.y"} * ${v};\n        let d1: u32 = ${s?"global_id.x":"workgroup_id.x"} * 4;\n\n        let dyCorner = vec2<i32>(i32(r), i32(c)) - vec2<i32>(pads);\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd: array<vec4<${l}>, ${v}>;\n        for (var i = 0; i < ${v}; i++) {\n          dotProd[i] = vec4<${l}>(0.0);\n        }\n        for (var wR: u32 = 0; wR < filterDims[0]; wR = wR + 1) {\n          var dyR = (${l}(dyCorner.x) + ${l}(wR)) / ${l}(strides.x);\n          let wRPerm = filterDims[0] - 1 - wR;\n          if (dyR < 0.0 || dyR >= ${l}(outBackprop[1]) ||\n              fract(dyR) > 0.0 || wRPerm < 0) {\n            continue;\n          }\n          let idyR: u32 = u32(dyR);\n\n          for (var wC: u32 = 0; wC < filterDims[1]; wC = wC + 1) {\n            let dyC = (${l}(dyCorner.y) + ${l}(wC)) / ${l}(strides.y);\n            let dyC2 = (${l}(dyCorner.y) + 1.0 + ${l}(wC)) / ${l}(strides.y);\n            let wCPerm = filterDims[1] - 1 - wC;\n            if (wCPerm < 0) {\n              continue;\n            }\n            var bDyCVal = true;\n            var bDyCVal2 = true;\n            if (dyC < 0.0 || dyC >= ${l}(outBackprop[2]) ||\n                fract(dyC) > 0.0) {\n              bDyCVal = false;\n            }\n            if (dyC2 < 0.0 || dyC2 >= ${l}(outBackprop[2]) ||\n                fract(dyC2) > 0.0) {\n              bDyCVal2 = false;\n            }\n\n            let idyC: u32 = u32(dyC);\n            let idyC2: u32 = u32(dyC2);\n            if (bDyCVal && bDyCVal2) {\n              let d2Length = outBackprop[3];\n              for (var d2 :u32 = 0; d2 < d2Length; d2 = d2 + 4) {\n                let wValue0 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1","d2")};\n                let wValue1 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1 + 1","d2")};\n                let wValue2 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1 + 2","d2")};\n                let wValue3 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1 + 3","d2")};\n\n                var xValue = ${M.get("batch","idyR","idyC","d2")};\n                let tmpval = vec4<${l}>(dot(xValue, wValue0),\n                                      dot(xValue, wValue1),\n                                      dot(xValue, wValue2),\n                                      dot(xValue, wValue3));\n                dotProd[0] = dotProd[0] + tmpval;\n\n                xValue =  ${M.get("batch","idyR","idyC2","d2")};\n\n                dotProd[1] = dotProd[1] + vec4<${l}>(dot(xValue, wValue0),\n                                                    dot(xValue, wValue1),\n                                                    dot(xValue, wValue2),\n                                                    dot(xValue, wValue3));\n              }\n            } else if (bDyCVal) {\n              let d2Length = outBackprop[${g}];\n              for (var d2: u32 = 0; d2 < d2Length; d2 = d2 + 4) {\n                let wValue0 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1","d2")};\n                let wValue1 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1 + 1","d2")};\n                let wValue2 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1 + 2","d2")};\n                let wValue3 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1 + 3","d2")};\n\n                var xValue = ${M.get("batch","idyR","idyC","d2")};\n                let tmpval = vec4<${l}>(dot(xValue, wValue0),\n                                      dot(xValue, wValue1),\n                                      dot(xValue, wValue2),\n                                      dot(xValue, wValue3));\n                dotProd[0] = dotProd[0] + tmpval;\n              }\n            } else if (bDyCVal2) {\n              let d2Length = outBackprop[3];\n              for (var d2: u32 = 0; d2 < d2Length; d2 = d2 + 4) {\n                let wValue0 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1","d2")};\n                let wValue1 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1 + 1","d2")};\n                let wValue2 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1 + 2","d2")};\n                let wValue3 = ${C.get("u32(wRPerm)","u32(wCPerm)","d1 + 3","d2")};\n\n                var xValue = ${M.get("batch","idyR","idyC2","d2")};\n                let tmpval = vec4<${l}>(dot(xValue, wValue0),\n                                      dot(xValue, wValue1),\n                                      dot(xValue, wValue2),\n                                      dot(xValue, wValue3));\n                dotProd[1] = dotProd[1] + tmpval;\n              }\n            }\n          }\n        }\n\n        for (var i: u32 = 0; i < ${v}; i = i + 1) {\n          let value = dotProd[i] + ${n?"bias[c+i]":`vec4<${l}>(0.0)`};\n          ${G.set("batch","r","c + i","d1","value")};\n        }\n      }`,W=`\n          let outputIndices = ${G.offsetToIndices("global_idx")};\n          let batch = ${G.indicesGet("outputIndices",0)};\n          let d1 = ${G.indicesGet("outputIndices",g)};\n          let r = ${G.indicesGet("outputIndices",p)};\n          let c = ${G.indicesGet("outputIndices",h)};\n          let dyCorner = vec2<i32>(i32(r), i32(c)) - pads;\n          let dyRCorner = dyCorner.x;\n          let dyCCorner = dyCorner.y;\n          let groupId = d1 / ${x};\n          let wOutChannel = d1 - groupId * ${x};\n          // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n          // ? = to be determined. : = across all values in that axis.\n          var dotProd = ${l}(0.0);\n          for (var wR: u32 = 0; wR < effectiveFilterDims.x; wR = wR + 1) {\n            if (wR % dilations.x != 0) {\n              continue;\n            }\n            let dyR = (${l}(dyRCorner) + ${l}(wR)) / ${l}(strides[0]);\n            let wRPerm = filterDims.x - 1 - wR / dilations.x;\n            if (dyR < 0.0 || dyR >= ${l}(outBackprop[${p}]) || fract(dyR) > 0.0 ||\n                wRPerm < 0) {\n              continue;\n            }\n            let idyR: u32 = u32(dyR);\n\n            for (var wC: u32 = 0; wC < effectiveFilterDims.y; wC = wC + 1) {\n              if (wC % dilations.y != 0) {\n                continue;\n              }\n              let dyC = (${l}(dyCCorner) + ${l}(wC)) / ${l}(strides.y);\n              let wCPerm = filterDims.y - 1 - wC / dilations.y;\n              if (dyC < 0.0 || dyC >= ${l}(outBackprop[${h}]) ||\n                  fract(dyC) > 0.0 || wCPerm < 0) {\n                continue;\n              }\n              let idyC: u32 = u32(dyC);\n              var inputChannel = groupId * ${I};\n              for (var d2: u32 = 0; d2 < ${I}; d2 = d2 + 1) {\n                let xValue = ${a?M.get("batch","idyR","idyC","inputChannel"):M.get("batch","inputChannel","idyR","idyC")};\n                let wValue = ${C.get("inputChannel","wOutChannel","u32(wRPerm)","u32(wCPerm)")};\n                dotProd = dotProd + xValue * wValue;\n                inputChannel = inputChannel + 1;\n              }\n            }\n          }\n          let value = dotProd + ${n?"bias[d1]":`${l}(0.0)`};\n          ${G.setByOffset("global_idx","value")};\n        `;return`\n  ${e.declareVariables(...D,G)}\n  ${A}\n  const outShape : vec4<u32> = vec4<u32>(${o.join(",")});\n  const outBackprop : vec4<u32> = vec4<u32>(${t[0].dims.join(",")});\n  const strides : vec2<u32> = vec2<u32>(${r.strides[0]}, ${r.strides[1]});\n  const filterDims : vec2<u32> = vec2<u32>(${r.kernelShape[a?1:2]}, ${r.kernelShape[a?2:3]});\n  const dilations : vec2<u32> = vec2<u32>(${r.dilations[0]}, ${r.dilations[1]});\n  const effectiveFilterDims : vec2<u32> = filterDims + vec2<u32>(\n          ${r.dilations[0]<=1?0:(r.kernelShape[a?1:2]-1)*(r.dilations[0]-1)},\n          ${r.dilations[1]<=1?0:(r.kernelShape[a?2:3]-1)*(r.dilations[1]-1)});\n  const pads : vec2<i32> = vec2<i32>(i32(effectiveFilterDims[0]) - 1 - (${r.pads[0]+r.pads[2]})/2,\n                                     i32(effectiveFilterDims[1]) - 1 - (${r.pads[1]+r.pads[3]})/2);\n    ${e.mainStart()}\n    ${e.guardAgainstOutOfBoundsWorkgroupSizes(w)};\n  ${u?E:W}}`},uo=(e,t,r)=>{let o=e.length>2,n=t.outputShape,s=V.size(n),u=[Math.ceil(s/64),1,1];Re("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${u}`);let l=Ge(e[0].dataType);return{name:"ConvTranspose2D",shaderCache:{hint:t.cacheKey},getRunData:()=>({dispatchGroup:{x:u[0],y:u[1],z:u[2]},outputs:[{dims:r?r(n):n,dataType:e[0].dataType}]}),getShaderSource:a=>Ol(a,e,t,n,o,u[1]===1&&u[2]===1,!1,l)}}});var Pl,Bl,kl,ds,ls,Rl,Dl,Ml,Ul,cs,ps=q(()=>{"use strict";Le();ss();us();Bt();or();Pl=(e,t,r,o,n,s)=>(e-1)*t+r+(o-1)*n+1-s,Bl=(e,t,r,o,n)=>{let s=Math.floor(e/2);t==="SAME_UPPER"?(r[o]=s,r[n]=e-s):t==="SAME_LOWER"&&(r[o]=e-s,r[n]=s)},kl=(e,t,r,o,n,s,u,l,a,p)=>{let h=e.length-2,g=p.length===0;if(a.length===0)for(let y=0;y<h;++y)a.push(0);let w=e[0],v=t[l?3:1]*n;for(let y=0,_=e.length-h-(l?1:0);y<h;++y,++_){let I=e[_],x=g?I*u[y]:p[y],A=Pl(I,u[y],s[y],t[_],r[y],x);Bl(A,o,s,y,y+h),g&&p.push(u[y]*(I-1)+a[y]+(t[_]-1)*r[y]+1-s[y]-s[y+h])}p.splice(0,0,w),p.splice(l?3:1,0,v)},ds=(e,t)=>{let r=e.kernelShape.slice();if(e.kernelShape.length===0||e.kernelShape.reduce((w,v)=>w*v,1)===0){r.length=0;for(let w=2;w<t[1].dims.length;++w)r.push(t[1].dims[w])}let o=e.format==="NHWC";r.splice(0,0,t[1].dims[0]),r.splice(o?3:1,0,t[1].dims[1]);let n=e.pads.slice(),s=e.outputShape.slice(),u=e.outputPadding.slice(),l=t[0].dims,a=e.dilations.slice();if(a.reduce((w,v)=>w+v,0)===0){let w=t[0].dims.length-2;a=new Array(w).fill(1)}let p=e.strides.slice();if(p.reduce((w,v)=>w+v,0)===0){let w=t[0].dims.length-2;p=new Array(w).fill(1)}kl(l,r,a,e.autoPad,e.group,n,p,o,u,s);let h=Object.assign({},e),g=e.cacheKey+[r.join("n,"),n.join(","),p.join(","),u.join(","),s.join(","),a.join(",")].join("_");return Object.assign(h,{kernelShape:r,pads:n,outputPadding:u,outputShape:s,dilations:a,strides:p,cacheKey:g}),h},ls=e=>{let t=un(e),r=e.format,o=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],n=e.dilations,s=e.group,u=e.kernelShape,l=e.pads,a=e.strides,p=e.wIsConst(),h=e.outputPadding,g=e.outputShape;return he({autoPad:o,format:r,dilations:n,group:s,kernelShape:u,outputPadding:h,outputShape:g,pads:l,strides:a,wIsConst:p,...t})},Rl=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let r=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],o=e[1].dims[0];if(r!==o)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let n=e[1].dims[1]*t.group;if(e.length===3&&(e[2].dims.length!==1||e[2].dims[0]!==n))throw new Error("invalid bias");let s=e[0].dims.length-2;if(t.dilations.reduce((h,g)=>h+g,0)>0&&t.dilations.length!==s)throw new Error(`dilations should be ${s}D`);if(t.strides.reduce((h,g)=>h+g,0)>0&&t.strides.length!==s)throw new Error(`strides should be ${s}D`);if(t.pads.reduce((h,g)=>h+g,0)>0&&t.pads.length!==s*2)throw new Error(`pads should be ${s*2}D`);if(t.outputPadding.length!==s&&t.outputPadding.length!==0)throw new Error(`output_padding should be ${s}D`);if(t.kernelShape.reduce((h,g)=>h+g,0)>0&&t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(t.outputShape.length!==0&&t.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},Dl=[2,3,1,0],Ml=(e,t,r)=>{let o=ds(r,t),n=r.format==="NHWC",s=o.outputShape,u=s[n?3:1],l=t[0].dims[n?3:1];if(o.group!==1||u===1&&l===1){e.compute(uo(t,o));return}let a=s[n?1:2],p=s[n?2:3],h=t[1].dims[2],g=t[1].dims[3],w=n?a*p:u,v=n?u:a*p,y=h*g*l,_=!0,I=e.kernelCustomData.wT??e.compute(dt(t[1],Dl),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=I);let x=[t[0],I],A=t.length===3;A&&(!n&&t[2].dims.length===1?x.push(t[2].reshape([t[2].dims[0],1,1])):x.push(t[2])),e.compute(is(x,o,s,w,v,y,A,_),{inputs:x})},Ul=(e,t)=>{let r=t.format==="NHWC",o=[e.inputs[0].reshape(r?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];o.length===3&&o.push(e.inputs[2]);let n=t.kernelShape;(n.length===0||n[0]===0)&&(n=[e.inputs[1].dims[2]]);let s=t.dilations;(s.length===0||s[0]===0)&&(s=[1]);let u=t.strides;(u.length===0||u[0]===0)&&(u=[1]);let l=t.pads;l.length===0&&(l=[0,0]),l=[0,l[0],0,l[1]],u=[1].concat(u),s=[1].concat(s),n=[1].concat(n);let a=ds({...t,pads:l,strides:u,dilations:s,kernelShape:n},o);e.compute(uo(o,a,p=>r?[p[0],p[2],p[3]]:[p[0],p[1],p[3]]))},cs=(e,t)=>{Rl(e.inputs,t),e.inputs[0].dims.length===3?Ul(e,t):Ml(e,e.inputs,t)}});var zl,ms,fs,hs=q(()=>{"use strict";We();xe();Le();$e();zl=(e,t,r,o)=>{let n=V.size(t),s=t.length,u=U("input",e,s),l=K("output",e,s),a=r.dataType===6?r.getInt32Array()[0]:Number(r.getBigInt64Array()[0]),p=V.normalizeAxis(a,s),h=g=>{let w=` i32(${u.indicesGet("inputIndices","uniforms.axis")}) `,v=de("uniforms.input_shape","uniforms.axis",s),y=o.reverse?w+(o.exclusive?" + 1":""):"0",_=o.reverse?v:w+(o.exclusive?"":" + 1");return`\n                ${g.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(u,l)}\n                ${g.mainStart()}\n                  ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n                  var inputIndices = ${l.offsetToIndices("global_idx")};\n                  var sum = ${l.type.value}(0);\n                  let first : i32 = ${y};\n                  let last : i32 = ${_};\n                  for (var i : i32 = first; i < last; i++) {\n                    ${u.indicesSet("inputIndices","uniforms.axis","u32(i)")};\n                    sum = sum + ${u.getByIndices("inputIndices")};\n                  }\n                  ${l.setByOffset("global_idx","sum")};\n                }`};return{name:"CumSum",shaderCache:{hint:o.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:t,dataType:e}],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:[{type:"uint32",data:n},{type:"int32",data:p},...F(t),...F(t)]}),getShaderSource:h}},ms=(e,t)=>{let r=e.inputs[0].dims,o=e.inputs[0].dataType,n=e.inputs[1];e.compute(zl(o,r,n,t),{inputs:[0]})},fs=e=>{let t=e.exclusive===1,r=e.reverse===1;return he({exclusive:t,reverse:r})}});var lo,mn,gs,Vl,Nl,co,po,ys,Wl,bs,ws,vs=q(()=>{"use strict";xe();Le();$e();lo="[a-zA-Z]|\\\\.\\\\.\\\\.",mn="("+lo+")+",gs="^"+mn+"$",Vl="("+mn+",)*"+mn,Nl="^"+Vl+"$",co=class{constructor(t=-1){this.symbolToIndices=new Map,this.inputIndex=t}addSymbol(t,r){let o=this.symbolToIndices.get(t);o===void 0?o=[r]:o.push(r),this.symbolToIndices.set(t,o)}},po=class{constructor(t,r){this.equation=r;this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[o,n]=r.includes("->")?r.split("->",2):[r,""];if(!o.match(RegExp(Nl)))throw new Error("Invalid LHS term");if(o.split(",").forEach((l,a)=>{let p=t[a].dims.slice();if(!l.match(RegExp(gs)))throw new Error("Invalid LHS term");let h=this.processTerm(l,!0,p,a);this.lhs.push(h)}),n==="")n+=[...this.symbolToInfo.entries()].filter(([l,a])=>a.count===1||l==="...").map(([l])=>l).join("");else if(!n.match(RegExp(mn)))throw new Error("Invalid RHS");n.match(RegExp(lo,"g"))?.forEach(l=>{if(l==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let a=this.symbolToInfo.get(l);if(a===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(a.dimValue)}}),this.rhs=this.processTerm(n,!1,this.outputDims)}addSymbol(t,r,o){let n=this.symbolToInfo.get(t);if(n!==void 0){if(n.dimValue!==r&&n.count!==1)throw new Error("Dimension mismatch");n.count++,n.inputIndices.push(o)}else n={count:1,dimValue:r,inputIndices:[o]};this.symbolToInfo.set(t,n)}processTerm(t,r,o,n=-1){let s=o.length,u=!1,l=[],a=0;if(!t.match(RegExp(gs))&&!r&&t!=="")throw new Error("Invalid LHS term");let p=t.match(RegExp(lo,"g")),h=new co(n);return p?.forEach((g,w)=>{if(g==="..."){if(u)throw new Error("Only one ellipsis is allowed per input term");u=!0;let v=s-p.length+1;if(v<0)throw new Error("Ellipsis out of bounds");if(l=o.slice(a,a+v),this.hasEllipsis){if(this.ellipsisDims.length!==l.length||this.ellipsisDims.toString()!==l.toString())throw new Error("Ellipsis dimensions mismatch")}else if(r)this.hasEllipsis=!0,this.ellipsisDims=l;else throw new Error("Ellipsis must be specified in the LHS");for(let y=0;y<l.length;y++){let _=String.fromCharCode("0".charCodeAt(0)+y);h.addSymbol(_,w+y),this.addSymbol(_,o[a++],n)}}else h.addSymbol(g,w+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(g,o[a++],n)}),h}},ys=e=>e+"_max",Wl=(e,t,r,o,n)=>{let u=t.map((v,y)=>e[y]?v.length:v).map((v,y)=>U(`input${y}`,r,v)),l=V.size(n),a=Ue(n.length),p=a?n.length:n,h=K("output",r,p),g=[...o.symbolToInfo.keys()].filter(v=>!o.rhs.symbolToIndices.has(v)),w=v=>{let y=[],_="var prod = 1.0;",I="var sum = 0.0;",x="sum += prod;",A=[],O=[],C=[],M=[],D=o.symbolToInfo.size===o.rhs.symbolToIndices.size;o.symbolToInfo.forEach((E,W)=>{if(o.rhs.symbolToIndices.has(W)){let te=o.rhs.symbolToIndices.get(W)?.[0];te!==void 0&&o.lhs.forEach((Y,Z)=>{if(E.inputIndices.includes(Z)){let ee=Y.symbolToIndices.get(W);if(ee===void 0)throw new Error("Invalid symbol error");ee.forEach(Te=>{y.push(`${u[Z].indicesSet(`input${Z}Indices`,Te,h.indicesGet("outputIndices",te))}`)})}})}else o.lhs.forEach((te,Y)=>{if(E.inputIndices.includes(Y)){let Z=te.symbolToIndices.get(W);if(Z===void 0)throw new Error("Invalid symbol error");Z.forEach(ee=>{A.push(`${u[Y].indicesSet(`input${Y}Indices`,ee,`${W}`)}`)}),M.push(`prod *= ${u[Y].getByIndices(`input${Y}Indices`)};`)}}),O.push(`for(var ${W}: u32 = 0; ${W} < uniforms.${ys(W)}; ${W}++) {`),C.push("}")});let G=D?[...y,`let sum = ${u.map((E,W)=>E.getByIndices(`input${W}Indices`)).join(" * ")};`]:[...y,I,...O,...A,_,...M,x,...C];return`\n            ${v.registerUniforms(g.map(E=>({name:`${ys(E)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...u,h)}\n\n            ${v.mainStart()}\n            ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n            var outputIndices = ${h.offsetToIndices("global_idx")};\n            ${u.map((E,W)=>`var input${W}Indices: ${u[W].type.indices};`).join(`\n`)}\n            ${G.join(`\n`)};\n            ${h.setByOffset("global_idx","sum")};\n          }`};return{name:"Einsum",shaderCache:{hint:o.equation,inputDependencies:e.map(v=>v?"rank":"dims")},getRunData:()=>{let v=g.filter(_=>o.symbolToInfo.has(_)).map(_=>({type:"uint32",data:o.symbolToInfo.get(_)?.dimValue||0}));v.push({type:"uint32",data:l});let y=t.filter((_,I)=>e[I]).map((_,I)=>[...F(_)]).reduce((_,I)=>_.concat(I),v);return a&&y.push(...F(n)),{outputs:[{dims:n,dataType:r}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:y}},getShaderSource:w}},bs=(e,t)=>{let r=new po(e.inputs,t.equation),o=e.inputs.map((u,l)=>Ue(u.dims.length)),n=r.outputDims,s=e.inputs.map((u,l)=>u.dims);e.compute(Wl(o,s,e.inputs[0].dataType,r,n))},ws=e=>{let t=e.equation.replace(/\\s+/g,"");return he({equation:t})}});var Gl,$s,Hl,Ll,Ss,xs=q(()=>{"use strict";We();xe();$e();Gl=e=>{if(!e||e.length!==2)throw new Error("Expand requires 2 input.");let t=e[0].dims,r=Array.from(e[1].getBigInt64Array(),Number),o=r.length<t.length?0:r.length-t.length,n=t.length<r.length?0:t.length-r.length;for(;o<r.length&&n<t.length;++o,++n)if(r[o]!==t[n]&&r[o]!==1&&t[n]!==1)throw new Error("Expand requires shape to be broadcastable to input")},$s=(e,t)=>{let r=e.length-t.length,o=[];for(let n=0;n<r;++n)o.push(e[n]);for(let n=0;n<t.length;++n)o.push(t[n]===1?e[n+r]:t[n]);return o},Hl=(e,t)=>e.length>t.length?$s(e,t):$s(t,e),Ll=e=>{let t=e[0].dims,r=Array.from(e[1].getBigInt64Array(),Number),o=Hl(t,r),n=e[0].dataType,s=n===9?4:1,u=Math.ceil(V.size(o)/s),l=Ue(t.length),a=Ue(o.length),p=g=>{let w=l?t.length:t,v=a?o.length:o,y=U("input",n,w,s),_=K("output",n,v,s),I;if(n===9){let x=(A,O,C="")=>`\n          let outputIndices${O} = ${_.offsetToIndices(`outputOffset + ${O}u`)};\n          let offset${O} = ${y.broadcastedIndicesToOffset(`outputIndices${O}`,_)};\n          let index${O} = offset${O} / 4u;\n          let component${O} = offset${O} % 4u;\n          ${A}[${O}] = ${C}(${y.getByOffset(`index${O}`)}[component${O}]);\n        `;I=`\n        let outputOffset = global_idx * ${s};\n        var data = vec4<u32>(0);\n        ${x("data",0,"u32")}\n        ${x("data",1,"u32")}\n        ${x("data",2,"u32")}\n        ${x("data",3,"u32")}\n        ${_.setByOffset("global_idx","data")}\n      }`}else I=`\n        let outputIndices = ${_.offsetToIndices("global_idx")};\n        let inputOffset = ${y.broadcastedIndicesToOffset("outputIndices",_)};\n        ${_.setByOffset("global_idx",y.getByOffset("inputOffset"))}\n      }`;return`\n    ${g.registerUniform("vec_size","u32").declareVariables(y,_)}\n    ${g.mainStart()}\n    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n    ${I}`},h=[{type:"uint32",data:u}];return l&&h.push(...F(t)),a&&h.push(...F(o)),{name:"Expand",shaderCache:{hint:`${o.length}`,inputDependencies:[l?"rank":"dims"]},getShaderSource:p,getRunData:()=>({outputs:[{dims:o,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h})}},Ss=e=>{Gl(e.inputs),e.compute(Ll(e.inputs),{inputs:[0]})}});var Fl,Kl,_s,Cs,Is=q(()=>{"use strict";We();xe();Le();$e();Fl=e=>{if(!e||e.length!==2)throw new Error("Gather requires 2 inputs.")},Kl=(e,t)=>{let r=e[0].dims,o=e[1].dims,n=r.length,s=V.normalizeAxis(t.axis,n),u=r.slice(0);u.splice(s,1,...o);let l=r[s],a=e[0].dataType===9?4:1,p=Math.ceil(V.size(u)/a),h=Ue(e[0].dims.length),g=h?e[0].dims.length:e[0].dims,w=Ue(e[1].dims.length),v=w?e[1].dims.length:e[1].dims,y=Ue(u.length),_=y?u.length:u,I=[{type:"uint32",data:p},{type:"int32",data:l},{type:"uint32",data:s}];h&&I.push(...F(e[0].dims)),w&&I.push(...F(e[1].dims)),y&&I.push(...F(u));let x=[];x.push(h?"rank":"dims"),x.push(w?"rank":"dims");let A=O=>{let C=U("data",e[0].dataType,g,a),M=U("inputIndices",e[1].dataType,v),D=K("output",e[0].dataType,_,a),G=W=>{let te=o.length,Y=`var indicesIndices${W}  = ${M.type.indices}(0);`;for(let Z=0;Z<te;Z++)Y+=`${te>1?`indicesIndices${W}[${Z}]`:`indicesIndices${W}`} = ${u.length>1?`outputIndices${W}[uniforms.axis + ${Z}]`:`outputIndices${W}`};`;Y+=`\n          var idx${W} = ${M.getByIndices(`indicesIndices${W}`)};\n          if (idx${W} < 0) {\n            idx${W} = idx${W} + uniforms.axisDimLimit;\n          }\n          var dataIndices${W} = ${C.type.indices}(0);\n        `;for(let Z=0,ee=0;Z<n;Z++)Z===s?(Y+=`${n>1?`dataIndices${W}[${Z}]`:`dataIndices${W}`} = u32(idx${W});`,ee+=te):(Y+=`${n>1?`dataIndices${W}[${Z}]`:`dataIndices${W}`} = ${u.length>1?`outputIndices${W}[${ee}]`:`outputIndices${W}`};`,ee++);return Y},E;if(e[0].dataType===9){let W=(te,Y,Z="")=>`\n          let outputIndices${Y} = ${D.offsetToIndices(`outputOffset + ${Y}u`)};\n          ${G(Y)};\n          let offset${Y} = ${C.indicesToOffset(`dataIndices${Y}`)};\n          let index${Y} = offset${Y} / 4u;\n          let component${Y} = offset${Y} % 4u;\n          ${te}[${Y}] = ${Z}(${C.getByOffset(`index${Y}`)}[component${Y}]);\n        `;E=`\n        let outputOffset = global_idx * ${a};\n        var value = vec4<u32>(0);\n        ${W("value",0,"u32")}\n        ${W("value",1,"u32")}\n        ${W("value",2,"u32")}\n        ${W("value",3,"u32")}\n        ${D.setByOffset("global_idx","value")}\n      `}else E=`\n      let outputIndices = ${D.offsetToIndices("global_idx")};\n      ${G("")};\n      let value = ${C.getByIndices("dataIndices")};\n      ${D.setByOffset("global_idx","value")};\n      `;return`\n      ${O.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(C,M,D)}\n      ${O.mainStart()}\n        ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n        ${E}\n      }`};return{name:"Gather",shaderCache:{hint:t.cacheKey,inputDependencies:x},getRunData:()=>({outputs:[{dims:u,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:I}),getShaderSource:A}},_s=e=>he({axis:e.axis}),Cs=(e,t)=>{let r=e.inputs;Fl(r),e.compute(Kl(e.inputs,t))}});var ql,jl,As,Ts,Es=q(()=>{"use strict";xe();Le();$e();ql=e=>{if(!e||e.length!==2)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error(`GatherElements requires that the data input and\n                     indices input tensors be of same rank.`)},jl=(e,t)=>{let r=e[0].dims,o=e[0].dataType,n=r.length,s=e[1].dims,u=e[1].dataType,l=V.normalizeAxis(t.axis,n),a=r[l],p=s.slice(0),h=V.size(p),g=U("input",o,n),w=U("indicesInput",u,s.length),v=K("output",o,p.length),y=[{type:"uint32",data:h},{type:"int32",data:a},{type:"uint32",data:l}];return y.push(...F(r)),y.push(...F(s)),y.push(...F(p)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:p,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:y}),getShaderSource:x=>`\n      ${x.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(g,w,v)}\n      ${x.mainStart()}\n      ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n      let outputIndices = ${v.offsetToIndices("global_idx")};\n\n      var idx = ${w.getByOffset("global_idx")};\n      if (idx < 0) {\n        idx = idx + uniforms.axisDimLimit;\n      }\n      var inputIndices = ${g.type.indices}(outputIndices);\n      ${g.indicesSet("inputIndices","uniforms.axis","u32(idx)")};\n      let value = ${g.getByIndices("inputIndices")};\n\n      ${v.setByOffset("global_idx","value")};\n  }`}},As=e=>he({axis:e.axis}),Ts=(e,t)=>{let r=e.inputs;ql(r),e.compute(jl(e.inputs,t))}});var Yl,Zl,Os,Ps,Bs=q(()=>{"use strict";xe();$e();Yl=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(e.length===3&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},Zl=(e,t)=>{let r=e[0].dims.slice(),o=e[1].dims.slice(),[n,s,u]=Jr.getShapeOfGemmResult(r,t.transA,o,t.transB,e.length===3?e[2].dims:void 0),l=[n,s];if(!l)throw new Error("Can\'t use gemm on the given tensors");let a=V.size(l),p=[{type:"uint32",data:a},{type:"uint32",data:n},{type:"uint32",data:s},{type:"uint32",data:u},{type:"float32",data:t.alpha},{type:"float32",data:t.beta}],h=["type","type"];e.length===3&&(p.push(...F(e[2].dims)),h.push("rank")),p.push(...F(l));let g=w=>{let v="";t.transA&&t.transB?v="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":t.transA&&!t.transB?v="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!t.transA&&t.transB?v="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!t.transA&&!t.transB&&(v="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let y=t.alpha===1?"":"value *= uniforms.alpha;",_=U("a",e[0].dataType,e[0].dims),I=U("b",e[1].dataType,e[1].dims),x=_.type.value,A=null,O=[_,I];e.length===3&&(A=U("c",e[2].dataType,e[2].dims.length),O.push(A));let C=K("output",e[0].dataType,l.length);O.push(C);let M=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`\n  ${w.registerUniforms(M).declareVariables(...O)}\n\n  ${w.mainStart()}\n    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let m = global_idx / uniforms.N;\n    let n = global_idx % uniforms.N;\n\n    var value = ${x}(0);\n    for (var k: u32 = 0u; k < uniforms.K; k++) {\n      ${v}\n    }\n\n    ${y}\n    ${(()=>A!=null?`let cOffset = ${A.broadcastedIndicesToOffset("vec2(m, n)",C)}; value += ${x}(uniforms.beta) * ${A.getByOffset("cOffset")};`:"")()}\n    output[global_idx] = value;\n  }`};return{name:"Gemm",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:l,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:p}),getShaderSource:g}},Os=e=>{let t=e.transA,r=e.transB,o=e.alpha,n=e.beta;return{transA:t,transB:r,alpha:o,beta:n,cacheKey:`${e.transA};${e.transB};${e.alpha===1}`}},Ps=(e,t)=>{Yl(e.inputs),e.compute(Zl(e.inputs,t))}});var Ql,Jl,Xl,ks,Rs=q(()=>{"use strict";We();xe();$e();Ql=(e,t)=>{let r=e[0].dims,o=r,n=2,s=V.sizeToDimension(r,n),u=V.sizeFromDimension(r,n),l=He(u),a=u/l,p=[r[0],r[1],a],h=["rank","type","type"],g=[{type:"uint32",data:u},{type:"uint32",data:a}];g.push(...F(p),...F(p));let w=v=>{let y=U("x",e[0].dataType,p.length,l),_=U("scale",e[1].dataType,e[1].dims),I=U("bias",e[2].dataType,e[2].dims),x=K("output",e[0].dataType,p.length,l),A=[y,_,I,x],O=y.type.value,C=l===1?"f32":`vec${l}<f32>`,M=64,D=[{name:"normSize",type:"u32"},{name:"normPackedSize",type:"u32"}];return`\n  var<workgroup> meanShared : f32;\n  var<workgroup> squaredNormShared : f32;\n  var<workgroup> workgroupShared : array<${C}, ${M}>;\n  const workgroupSize = ${M}u;\n  ${v.registerUniforms(D).declareVariables(...A)}\n  ${v.mainStart(M)}\n    let norm = global_idx / workgroupSize;\n    let batch = norm / uniforms.x_shape[1];\n    let channel = norm % uniforms.x_shape[1];\n    let localIndex = local_id.x;\n\n    // initialize workgroup memory\n    var initial = ${C}(0);\n    for (var h = localIndex; h < uniforms.normPackedSize; h += workgroupSize) {\n      initial = initial + ${C}(${y.get("batch","channel","h")});\n    }\n    workgroupShared[localIndex] = initial;\n    workgroupBarrier();\n\n    // Calculate the mean of current channel data.\n    for (var currSize = workgroupSize >> 1;  currSize > 0; currSize = currSize >> 1) {\n      if (localIndex < currSize) {\n        workgroupShared[localIndex] = workgroupShared[localIndex] + workgroupShared[localIndex + currSize];\n      }\n      workgroupBarrier();\n    }\n    if (localIndex == 0) {\n      meanShared = ${ot("workgroupShared[0]",l)} / f32(uniforms.normSize);\n    }\n    workgroupBarrier();\n\n    // reinitialize workgroup memory.\n    initial = ${C}(0);\n    for (var h = localIndex; h < uniforms.normPackedSize; h += workgroupSize) {\n      let deviation =  ${C}(${y.get("batch","channel","h")}) - ${C}(meanShared);\n      initial = initial + deviation * deviation;\n    }\n    workgroupShared[localIndex] = initial;\n    workgroupBarrier();\n\n    // Calculate the sum of square of deviation of current channel data.\n    for (var currSize = workgroupSize >> 1;  currSize > 0; currSize = currSize >> 1) {\n      if (localIndex < currSize) {\n        workgroupShared[localIndex] = workgroupShared[localIndex] + workgroupShared[localIndex + currSize];\n      }\n      workgroupBarrier();\n    }\n    if (localIndex == 0) {\n      squaredNormShared = ${ot("workgroupShared[0]",l)};\n    }\n    workgroupBarrier();\n\n    let invStdDev = inverseSqrt(squaredNormShared / f32(uniforms.normSize) + f32(${t.epsilon}));\n    let channelScale = invStdDev * f32(${_.getByOffset("channel")});\n    let channelShift = f32(${I.getByOffset("channel")}) - meanShared * channelScale;\n    for (var h = localIndex; h < uniforms.normPackedSize; h += workgroupSize) {\n      let value = ${y.get("batch","channel","h")} * ${O}(${C}(channelScale)) + ${O}(${C}(channelShift));\n      ${x.set("batch","channel","h","value")};\n    }\n  }`};return{name:"InstanceNormalization",shaderCache:{hint:`${t.epsilon};${l}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:o,dataType:e[0].dataType}],dispatchGroup:{x:s},programUniforms:g}),getShaderSource:w}},Jl=(e,t,r,o,n,s,u,l)=>{let a=He(u),p=64,h=a===1?"vec2f":`mat2x${a}f`,g=a===1?"f32":`vec${a}f`,w=(D,G)=>`${h}(${D}, ${G})`,v=n*u/a,y=Math.ceil(s/p),_=["type"],I=[{type:"uint32",data:y},{type:"uint32",data:s},{type:"uint32",data:Math.floor(u/a)},{type:"uint32",data:Math.floor(s*u/a)}],x=D=>{let G=U("input",t.dataType,t.dims,a);return`\n  ${D.declareVariables(G)}\n  @group(0) @binding(1) var<storage, read_write> output : array<${h}>;\n  struct Uniforms {wg_size:u32, H:u32, C:u32, image_size:u32};\n  @group(0) @binding(2) var<uniform> uniforms: Uniforms;\n\n  ${D.mainStart(p)}\n    let currentImageNumber = global_idx / ${p} / uniforms.C;\n    let currentChannelNumber = (global_idx / ${p}) % uniforms.C;\n    let wgId = global_idx % ${p};\n    let wgOffset = wgId * uniforms.wg_size;\n    if (wgOffset >= uniforms.H) {\n        return;\n    }\n    let wgMax = min(wgOffset + uniforms.wg_size, uniforms.H);\n\n    let offset = currentImageNumber * uniforms.image_size + currentChannelNumber;\n    var sum = ${Qe("f32",a)};\n    var squaredSum = ${Qe("f32",a)};\n    for (var i: u32 = wgOffset; i < wgMax; i++) {\n        let value = ${g}(input[offset + i * uniforms.C]);\n        sum += value;\n        squaredSum += value * value;\n    }\n    output[global_idx] = ${w("sum","squaredSum")};\n  }`},A=e.compute({name:"InstanceNormComputeMean",shaderCache:{hint:`${a}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:[n,u,p,2],dataType:1}],dispatchGroup:{x:n*u/a},programUniforms:I}),getShaderSource:x},{inputs:[t],outputs:[-1]})[0],O=[{type:"uint32",data:v},{type:"uint32",data:s},{type:"uint32",data:Math.floor(u/a)},{type:"uint32",data:Math.floor(p*u/a)}],C=["type","type","type"],M=D=>{let G=U("scale",r.dataType,r.dims,a),E=U("bias",o.dataType,o.dims,a);return`\n  @group(0) @binding(0) var<storage, read> input : array<${h}>;\n  @group(0) @binding(1) var<storage, read> scale : array<${G.type.storage}>;\n  @group(0) @binding(2) var<storage, read> bias : array<${E.type.storage}>;\n  @group(0) @binding(3) var<storage, read_write> output : array<${h}>;\n  struct Uniforms {units_of_work : u32, H: u32, C : u32, image_size : u32};\n  @group(0) @binding(4) var<uniform> uniforms: Uniforms;\n\n  ${D.mainStart()}\n    ${D.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.units_of_work")}\n    let currentImageNumber = global_idx / uniforms.C;\n    let currentChannelNumber = global_idx % uniforms.C;\n\n    let offset = currentImageNumber * uniforms.image_size;\n    var sum = ${Qe("f32",a)};\n    var squaredSum = ${Qe("f32",a)};\n    for (var i: u32 = 0; i < ${p}; i++) {\n        let value = input[offset + i + currentChannelNumber * ${p}];\n        sum += value[0];\n        squaredSum += value[1];\n    }\n    sum = sum / f32(uniforms.H);\n    squaredSum = squaredSum / f32(uniforms.H);\n    let invStdDev = inverseSqrt(squaredSum - sum * sum + f32(${l}));\n    let channelScale = invStdDev * ${g}(scale[currentChannelNumber]);\n    let channelShift = ${g}(bias[currentChannelNumber]) - sum * channelScale;\n\n    output[global_idx] = ${w("channelScale","channelShift")};\n  }`};return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${a};${l}`,inputDependencies:C},getRunData:()=>({outputs:[{dims:[n,u,2],dataType:1}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:O}),getShaderSource:M},{inputs:[A,r,o],outputs:[-1]})[0]},Xl=(e,t,r)=>{let o=t[0].dims,n=o,s=o[0],u=o[o.length-1],l=V.sizeFromDimension(o,1)/u,a=He(u),p=V.size(n)/a,h=[{type:"uint32",data:l},{type:"uint32",data:Math.floor(u/a)}],g=["type","type"],w=Jl(e,t[0],t[1],t[2],s,l,u,r.epsilon),v=y=>{let _=Ge(t[0].dataType),I=a===1?"vec2f":`mat2x${a}f`,x=a===1?_:`vec${a}<${_}>`,A=U("input",t[0].dataType,t[0].dims,a),O=K("output",t[0].dataType,n,a);return`\n  @group(0) @binding(0) var<storage, read> input : array<${A.type.storage}>;\n  @group(0) @binding(1) var<storage, read> scaleInput : array<${I}>;\n  @group(0) @binding(2) var<storage, read_write> output : array<${O.type.storage}>;\n  struct Uniforms {H: u32, C : u32};\n  @group(0) @binding(3) var<uniform> uniforms: Uniforms;\n\n  ${y.mainStart()}\n    let currentImageNumber = global_idx / (uniforms.C * uniforms.H);\n    let currentChannelNumber = global_idx % uniforms.C;\n\n    let scaleOffset = currentImageNumber * uniforms.C + currentChannelNumber;\n    let scale = scaleInput[scaleOffset];\n    output[global_idx] = fma(input[global_idx], ${x}(scale[0]), ${x}(scale[1]));\n  }`};e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${a}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:h}),getShaderSource:v},{inputs:[t[0],w]})},ks=(e,t)=>{t.format==="NHWC"?Xl(e,e.inputs,t):e.compute(Ql(e.inputs,t))}});var ec,tc,Ds,Ms=q(()=>{"use strict";We();xe();$e();ec=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},tc=(e,t,r)=>{let o=e[0].dims,n=e[1],s=e[2],u=o,l=V.normalizeAxis(t.axis,o.length),a=V.sizeToDimension(o,l),p=V.sizeFromDimension(o,l),h=V.size(n.dims),g=s?V.size(s.dims):0;if(h!==p||s&&g!==p)throw new Error(`Size of X.shape()[axis:] == ${p}.\n       Size of scale and bias (if provided) must match this.\n       Got scale size of ${h} and bias size of ${g}`);let w=[];for(let C=0;C<o.length;++C)C<l?w.push(o[C]):w.push(1);let v=He(p),y=["type","type"],_=[{type:"uint32",data:a},{type:"float32",data:p},{type:"uint32",data:Math.floor(p/v)},{type:"float32",data:t.epsilon}];s&&y.push("type");let I=r>1,x=r>2,A=C=>{let M=Ge(e[0].dataType),D=[U("x",e[0].dataType,e[0].dims,v),U("scale",n.dataType,n.dims,v)];s&&D.push(U("bias",s.dataType,s.dims,v)),D.push(K("output",e[0].dataType,u,v)),I&&D.push(K("mean_data_output",1,w)),x&&D.push(K("inv_std_output",1,w));let G=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`\n  ${C.registerUniforms(G).declareVariables(...D)}\n  ${C.mainStart()}\n    ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}\n    let offset = global_idx * uniforms.norm_size_vectorized;\n    var meanVector = ${Qe("f32",v)};\n    var meanSquareVector = ${Qe("f32",v)};\n\n    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {\n      let value = ${ut(M,v,"x[h + offset]")};\n      meanVector += value;\n      meanSquareVector += value * value;\n    }\n    let mean = ${ot("meanVector",v)} / uniforms.norm_size;\n    let invStdDev =\n        inverseSqrt(${ot("meanSquareVector",v)} / uniforms.norm_size - mean * mean + uniforms.epsilon);\n\n    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {\n      let f32input = ${ut(M,v,"x[j + offset]")};\n      let f32scale = ${ut(M,v,"scale[j]")};\n      output[j + offset] = ${D[0].type.value}((f32input - mean) * invStdDev * f32scale\n        ${s?`+ ${ut(M,v,"bias[j]")}`:""}\n      );\n    }\n\n    ${I?"mean_data_output[global_idx] = mean":""};\n    ${x?"inv_std_output[global_idx] = invStdDev":""};\n  }`},O=[{dims:u,dataType:e[0].dataType}];return I&&O.push({dims:w,dataType:1}),x&&O.push({dims:w,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${v};${r}`,inputDependencies:y},getRunData:()=>({outputs:O,dispatchGroup:{x:Math.ceil(a/64)},programUniforms:_}),getShaderSource:A}},Ds=(e,t)=>{ec(e.inputs),e.compute(tc(e.inputs,t,e.outputCount))}});var rc,zs,Us,nc,mo,Vs,Ns=q(()=>{"use strict";xe();Le();Zr();Jn();$e();or();rc=(e,t)=>{let r=e[0],o=e[1],n=e[2],s=e[3],u=e[4],l=e[5],a=e[6],p=e[7];if(r.dims.length!==3&&r.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let h=!1,g=r.dims[0],w=r.dims[1],v=r.dims.length===3?h?r.dims[2]/3:r.dims[2]:t.numHeads*r.dims[4],y=w,_=0,I=0,x=Math.floor(v/t.numHeads);if(a&&p){if(a.dims.length!==4)throw new Error(\'Input "past_key" is expected to have 4 dimensions\');if(p.dims.length!==4)throw new Error(\'Input "past_value" is expected to have 4 dimensions\');_=a.dims[2],I=a.dims[2]}else if(a||p)throw new Error(\'Input "past_key" and "past_value" shall be both present or both absent\');let A;if(o){if(r.dims.length!==3)throw new Error(\'Input "query" is expected to have 3 dimensions when key is given\');if(o.dims.length<3||o.dims.length>5)throw new Error(\'Input "key" is expected to have 3, 4, or 5 dimensions\');if(r.dims[0]!==o.dims[0])throw new Error(\'Input "query" and "key" shall have same dim 0 (batch size)\');if(o.dims.length===3){if(o.dims[2]!==r.dims[2])throw new Error(\'Input "query" and "key" shall have same dim 2 (hidden_size)\');A=2,y=o.dims[1]}else if(o.dims.length===5){if(o.dims[2]!==t.numHeads||o.dims[3]!==2||o.dims[4]!==x)throw new Error(\'Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv\');if(n)throw new Error(\'Expect "value" be none when "key" has packed kv format.\');A=5,y=o.dims[1]}else{if(o.dims[1]!==t.numHeads||o.dims[3]!==x)throw new Error(\'Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key\');A=0,y=o.dims[2]}}else{if(r.dims.length!==3&&r.dims.length!==5)throw new Error(\'Input "query" is expected to have 3 or 5 dimensions when key is empty\');if(r.dims.length===5&&(r.dims[2]!==t.numHeads||r.dims[3]!==3))throw new Error(\'Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv\');A=3}if(s){if(s.dims.length!==1)throw new Error(\'Input "bias" is expected to have 1 dimension\');if(n&&r.dims.length===5&&r.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let O=0;if(u){O=8;let E=u.dims;throw E.length===1?E[0]===g?O=1:E[0]===3*g+2&&(O=3):E.length===2&&E[0]===g&&E[1]===y&&(O=5),O===8?new Error(\'Input "key_padding_mask" shape shall be (batch_size) or (batch_size, kv_sequence_length)\'):new Error("Mask not supported")}let C=!1,M=v;if(n){if(n.dims.length!==3&&n.dims.length!==4)throw new Error(\'Input "value" is expected to have 3 or 4 dimensions\');if(r.dims[0]!==n.dims[0])throw new Error(\'Input "query" and "value" shall have same dim 0 (batch_size)\');if(n.dims.length===3){if(y!==n.dims[1])throw new Error(\'Input "key" and "value" shall have the same dim 1 (kv_sequence_length)\');M=n.dims[2]}else{if(y!==n.dims[2])throw new Error(\'Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)\');M=n.dims[1]*n.dims[3],C=!0}}let D=_+y,G=!1;if(u)throw new Error("Key padding mask is not supported");if(l)throw new Error("extraAddQk is not supported");if(a)throw new Error("pastKey is not supported");if(p)throw new Error("pastValue is not supported");return{batchSize:g,sequenceLength:w,pastSequenceLength:_,kvSequenceLength:y,totalSequenceLength:D,maxSequenceLength:I,inputHiddenSize:0,hiddenSize:v,vHiddenSize:M,headSize:x,vHeadSize:Math.floor(M/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:O,scale:t.scale,broadcastResPosBias:G,passPastInKv:C,qkvFormat:A}},zs=e=>he({...e}),Us=he({perm:[0,2,1,3]}),nc=(e,t,r,o,n,s,u)=>{let l=[o,n,s],a=V.size(l),p=[{type:"uint32",data:a},{type:"uint32",data:u},{type:"uint32",data:s}],h=g=>{let w=K("qkv_with_bias",t.dataType,l),v=U("qkv",t.dataType,l),y=U("bias",r.dataType,l),_=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`\n  ${g.registerUniforms(_).declareVariables(v,y,w)}\n  ${g.mainStart()}\n    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;\n\n    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];\n  }`};return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:l,dataType:t.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:p}),getShaderSource:h},{inputs:[t,r],outputs:[-1]})[0]},mo=(e,t,r,o,n,s,u,l)=>{let a=s;if(u){if(o===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return a=nc(e,s,u,t,o,r*n,l),a=a.reshape([t,o,r,n]),e.compute(dt(a,Us.perm),{inputs:[a],outputs:[-1]})[0]}else return s.dims.length===3&&(a=s.reshape([t,o,r,n])),e.compute(dt(a,Us.perm),{inputs:[a],outputs:[-1]})[0]},Vs=(e,t)=>{let r=rc(e.inputs,t);if(e.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(e.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let o=e.inputs[1]&&e.inputs[2]&&e.inputs[1].dims.length===4&&e.inputs[2].dims.length===4,n=mo(e,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,e.inputs[0],e.inputs[3],0);if(o)return on(e,n,e.inputs[1],e.inputs[2],e.inputs[4],void 0,void 0,void 0,e.inputs[5],r,t);let s=mo(e,r.batchSize,r.numHeads,r.kvSequenceLength,r.headSize,e.inputs[1],e.inputs[3],r.hiddenSize),u=mo(e,r.batchSize,r.numHeads,r.kvSequenceLength,r.vHeadSize,e.inputs[2],e.inputs[3],2*r.hiddenSize);on(e,n,s,u,e.inputs[4],void 0,e.inputs[6],e.inputs[7],e.inputs[5],r,t)}});var oc,ac,ic,sc,uc,dc,lc,cc,Ws,Gs=q(()=>{"use strict";We();xe();$e();oc=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(e[0].dataType!==1)throw new Error("Input type must be float.");if(e.length>=2){let t=e[0].dims.length*2===e[1].dims[0];if(e.length===4&&(t=e[3].dims[0]*2===e[1].dims[0]),!t)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},ac=(e,t,r)=>{let o="";for(let n=t-1;n>=0;--n)o+=`\n            k = i32(${e.indicesGet("indices",n)}) - ${de("uniforms.pads",n,r)};\n            if (k < 0) {\n              break;\n            }\n            if (k >= i32(${de("uniforms.x_shape",n,t)})) {\n              break;\n            }\n            offset += k * i32(${de("uniforms.x_strides",n,t)});\n        `;return`\n          value = ${e.type.value}(uniforms.constant_value);\n          for (var i = 0; i < 1; i++) {\n            var offset = 0;\n            var k = 0;\n            ${o}\n            value = x[offset];\n          }\n      `},ic=(e,t,r)=>{let o="";for(let n=t-1;n>=0;--n)o+=`\n                k = i32(${e.indicesGet("indices",n)}) - ${de("uniforms.pads",n,r)};\n                if (k < 0) {\n                  k = -k;\n                }\n                {\n                  let _2n_1 = 2 * (i32(${de("uniforms.x_shape",n,t)}) - 1);\n                  k = k % _2n_1;\n                  if(k >= i32(${de("uniforms.x_shape",n,t)})) {\n                    k = _2n_1 - k;\n                  }\n                }\n                offset += k * i32(${de("uniforms.x_strides",n,t)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${o}\n              value = x[offset];\n          `},sc=(e,t,r)=>{let o="";for(let n=t-1;n>=0;--n)o+=`\n                k = i32(${e.indicesGet("indices",n)}) - ${de("uniforms.pads",n,r)};\n                if (k < 0) {\n                  k = 0;\n                }\n                if (k >= i32(${de("uniforms.x_shape",n,t)})) {\n                  k = i32(${de("uniforms.x_shape",n,t)}) - 1;\n                }\n                offset += k * i32(${de("uniforms.x_strides",n,t)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${o}\n              value = x[offset];\n          `},uc=(e,t,r)=>{let o="";for(let n=t-1;n>=0;--n)o+=`\n                k = i32(${e.indicesGet("indices",n)}) - ${de("uniforms.pads",n,r)};\n                if (k < 0)  {\n                  k += i32(${de("uniforms.x_shape",n,t)}]);\n                }\n                if (k >= i32(${de("uniforms.x_shape",n,t)})) {\n                  k -= i32(${de("uniforms.x_shape",n,t)});\n                }\n                offset += k * i32(${de("uniforms.x_strides",n,t)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${o}\n              value = x[offset];\n          `},dc=(e,t,r)=>{switch(r.mode){case 0:return ac(e,t,r.pads.length);case 1:return ic(e,t,r.pads.length);case 2:return sc(e,t,r.pads.length);case 3:return uc(e,t,r.pads.length);default:throw new Error("Invalid mode")}},lc=(e,t)=>{let r=V.padShape(e[0].dims.slice(),t.pads),o=e[0].dims,s=[{type:"uint32",data:V.size(r)},{type:"uint32",data:t.pads}];if(t.mode===0){let a=nt(e[0].dataType);s.push({type:a,data:t.value})}s.push(...F(e[0].dims),...F(r));let u=["rank"],l=a=>{let p=K("output",e[0].dataType,r.length),h=U("x",e[0].dataType,o.length),g=h.type.value,w=dc(p,o.length,t),v=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:t.pads.length}];return t.mode===0&&v.push({name:"constant_value",type:g}),`\n            ${a.registerUniforms(v).declareVariables(h,p)}\n            ${a.mainStart()}\n            ${a.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n            let indices = ${p.offsetToIndices("global_idx")};\n\n            var value = ${g}(0);\n            ${w}\n            output[global_idx] = value;\n        }`};return{name:"Pad",shaderCache:{hint:`${t.mode}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(V.size(r)/64)},programUniforms:s}),getShaderSource:l}},cc=(e,t)=>{if(e.length>1){let r=e[1].getBigInt64Array(),o=e.length>=3&&e[2].data?e[2].getFloat32Array()[0]:0,n=e[0].dims.length,s=new Int32Array(2*n).fill(0);if(e.length>=4){let l=e[3].getBigInt64Array();for(let a=0;a<l.length;a++)s[Number(l[a])]=Number(r[a]),s[Number(l[a])+n]=Number(r[a+l.length])}else r.forEach((l,a)=>s[Number(a)]=Number(l));let u=[];return s.forEach(l=>u.push(l)),{mode:t.mode,value:o,pads:u}}else return t},Ws=(e,t)=>{oc(e.inputs);let r=cc(e.inputs,t);e.compute(lc(e.inputs,r),{inputs:[0]})}});var fn,Hs,Ls,Fs,Ks,pc,mc,qs,js,Ys,Zs,Qs,Js,Xs,eu,tu,ru,nu,ou,au=q(()=>{"use strict";rr();xe();$e();fn=e=>{if(tr.webgpu.validateInputContent&&(!e||e.length!==1))throw new Error("Pool ops requires 1 input.")},Hs=(e,t,r)=>{let o=t.format==="NHWC",n=e.dims.slice();o&&n.splice(1,0,n.pop());let s=Object.hasOwnProperty.call(t,"dilations"),u=t.kernelShape.slice(),l=t.strides.slice(),a=s?t.dilations.slice():[],p=t.pads.slice();Wt.adjustPoolAttributes(r,n,u,l,a,p);let h=Wt.computePoolOutputShape(r,n,l,a,u,p,t.autoPad),g=Object.assign({},t);s?Object.assign(g,{kernelShape:u,strides:l,pads:p,dilations:a,cacheKey:t.cacheKey}):Object.assign(g,{kernelShape:u,strides:l,pads:p,cacheKey:t.cacheKey});let w=h.slice();return w.push(w.splice(1,1)[0]),[g,o?w:h]},Ls=(e,t)=>{let r=t.format==="NHWC",o=V.size(e),n=V.size(t.kernelShape),s=[{type:"uint32",data:o},{type:"uint32",data:n}],u=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(t.kernelShape.length<=2){let l=t.kernelShape[t.kernelShape.length-1],a=t.strides[t.strides.length-1],p=t.pads[t.pads.length/2-1],h=t.pads[t.pads.length-1],g=!!(p+h);s.push({type:"uint32",data:l},{type:"uint32",data:a},{type:"uint32",data:p},{type:"uint32",data:h}),u.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let w=!1;if(t.kernelShape.length===2){let v=t.kernelShape[t.kernelShape.length-2],y=t.strides[t.strides.length-2],_=t.pads[t.pads.length/2-2],I=t.pads[t.pads.length-2];w=!!(_+I),s.push({type:"uint32",data:v},{type:"uint32",data:y},{type:"uint32",data:_},{type:"uint32",data:I}),u.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[s,u,!0,g,w]}else{if(r)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let l=V.computeStrides(t.kernelShape);s.push({type:"uint32",data:l},{type:"uint32",data:t.pads},{type:"uint32",data:t.strides}),u.push({name:"kernelStrides",type:"u32",length:l.length},{name:"pads",type:"u32",length:t.pads.length},{name:"strides",type:"u32",length:t.strides.length});let a=t.pads.reduce((p,h)=>p+h);return[s,u,!!a,!1,!1]}},Fs=(e,t,r,o,n,s,u,l,a,p,h,g)=>{let w=n.format==="NHWC",v=t.type.value,y=K("output",t.type.tensor,o);if(n.kernelShape.length<=2){let _="",I="",x="",A=r-(w?2:1);if(h?_=`\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[${A}] = indices[${A}] * uniforms.sw - uniforms.pwStart + i;\n                  if (xIndices[${A}] < 0 || xIndices[${A}]\n                      >= uniforms.x_shape[${A}]) {\n                    pad++;\n                    continue;\n                  }\n                  let x_val = x[${t.indicesToOffset("xIndices")}];\n                  ${s}\n                }`:_=`\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[${A}] = indices[${A}] * uniforms.sw - uniforms.pwStart + i;\n                  let x_val = x[${t.indicesToOffset("xIndices")}];\n                  ${s}\n                }`,n.kernelShape.length===2){let C=r-(w?3:2);g?I=`\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[${C}] = indices[${C}] * uniforms.sh - uniforms.phStart + j;\n                  if (xIndices[${C}] < 0 || xIndices[${C}] >= uniforms.x_shape[${C}]) {\n                    pad += i32(uniforms.kw);\n                    continue;\n                  }\n              `:I=`\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[${C}] = indices[${C}] * uniforms.sh - uniforms.phStart + j;\n                `,x=`\n              }\n            `}return`\n            ${e.registerUniforms(a).declareVariables(t,y)}\n\n            ${e.mainStart()}\n              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n              let indices = ${y.offsetToIndices("global_idx")};\n              var xIndices = ${y.offsetToIndices("global_idx")};\n\n              var value = ${v}(${l});\n              var pad = 0;\n              ${I}\n              ${_}\n              ${x}\n              ${u}\n\n              output[global_idx] = value;\n            }`}else{if(w)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let _=n.kernelShape.length,I=n.pads.length,x="";return p?x=`\n                if (xIndices[j] >= uniforms.x_shape[j]) {\n                  pad++;\n                  isPad = true;\n                  break;\n                }\n              }\n              if (!isPad) {\n                let x_val = x[${t.indicesToOffset("xIndices")}];\n                ${s}\n              }`:x=`\n              }\n              let x_val = x[${t.indicesToOffset("xIndices")}];\n              ${s}\n            `,`\n            ${e.registerUniforms(a).declareVariables(t,y)}\n\n            ${e.mainStart()}\n              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n              let indices = ${y.offsetToIndices("global_idx")};\n              var xIndices = ${y.offsetToIndices("global_idx")};\n\n              var offsets: array<u32, ${_}>;\n\n              var value = ${v}(${l});\n              var pad = 0;\n              var isPad = false;\n\n              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {\n                var offset = i;\n                for (var j = 0u; j < ${_-1}u; j++) {\n                  offsets[j] = offset / ${de("uniforms.kernelStrides","j",_)};\n                  offset -= offsets[j] * ${de("uniforms.kernelStrides","j",_)};\n                }\n                offsets[${_-1}] = offset;\n\n                isPad = false;\n                for (var j = ${r-_}u; j < ${r}u; j++) {\n                  xIndices[j] = indices[j] * ${de("uniforms.strides",`j - ${r-_}u`,_)}\n                    + offsets[j - ${r-_}u] - ${de("uniforms.pads","j - 2u",I)};\n                  ${x}\n              }\n              ${u}\n\n              output[global_idx] = value;\n            }`}},Ks=e=>`${e.format};${e.ceilMode};${e.autoPad};${e.kernelShape.length}`,pc=e=>`${Ks(e)};${e.countIncludePad}`,mc=e=>`${Ks(e)};${e.storageOrder};${e.dilations}`,qs=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),js=(e,t,r,o)=>{let[n,s]=Hs(t,o,r),u=U("x",t.dataType,t.dims.length),l=u.type.value,a="value += x_val;",p="";n.countIncludePad?p+=`value /= ${l}(uniforms.kernelSize);`:p+=`value /= ${l}(i32(uniforms.kernelSize) - pad);`;let[h,g,w,v,y]=Ls(s,n);h.push(...F(t.dims),...F(s));let _=["rank"];return{name:e,shaderCache:{hint:`${o.cacheKey};${w};${v};${y}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(V.size(s)/64)},programUniforms:h}),getShaderSource:I=>Fs(I,u,t.dims.length,s.length,n,a,p,0,g,w,v,y)}},Ys=e=>{let t=e.count_include_pad!==0,r=qs(e);if(r.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let o={countIncludePad:t,...r,cacheKey:""};return{...o,cacheKey:pc(o)}},Zs=(e,t)=>{fn(e.inputs),e.compute(js("AveragePool",e.inputs[0],!1,t))},Qs={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},Js=e=>{let t=e.format;return{format:t,...Qs,cacheKey:t}},Xs=(e,t)=>{fn(e.inputs),e.compute(js("GlobalAveragePool",e.inputs[0],!0,t))},eu=(e,t,r,o)=>{let[n,s]=Hs(t,o,r),u=`\n      value = max(x_val, value);\n    `,l="",a=U("x",t.dataType,t.dims.length),p=["rank"],[h,g,w,v,y]=Ls(s,n);return h.push(...F(t.dims),...F(s)),{name:e,shaderCache:{hint:`${o.cacheKey};${w};${v};${y}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(V.size(s)/64)},programUniforms:h}),getShaderSource:_=>Fs(_,a,t.dims.length,s.length,n,u,l,-1e5,g,w,v,y)}},tu=(e,t)=>{fn(e.inputs),e.compute(eu("MaxPool",e.inputs[0],!1,t))},ru=e=>{let t=e.storage_order,r=e.dilations,o=qs(e);if(t!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(o.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let n={storageOrder:t,dilations:r,...o,cacheKey:""};return{...n,cacheKey:mc(n)}},nu=e=>{let t=e.format;return{format:t,...Qs,cacheKey:t}},ou=(e,t)=>{fn(e.inputs),e.compute(eu("GlobalMaxPool",e.inputs[0],!0,t))}});var hc,gc,iu,su=q(()=>{"use strict";rr();We();$e();hc=(e,t,r)=>{let o=e===t,n=e<t&&r<0,s=e>t&&r>0;if(o||n||s)throw new Error("Range these inputs\' contents are invalid.")},gc=(e,t,r,o)=>{let n=Math.abs(Math.ceil((t-e)/r)),s=[n],u=n,l=nt(o),a=[{type:"uint32",data:u},{type:l,data:e},{type:l,data:r},...F(s)],p=h=>{let g=K("output",o,s.length),w=g.type.value,v=[{name:"outputSize",type:"u32"},{name:"start",type:w},{name:"delta",type:w}];return`\n        ${h.registerUniforms(v).declareVariables(g)}\n        ${h.mainStart()}\n        ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n        output[global_idx] = uniforms.start + ${w}(global_idx) * uniforms.delta;\n      }`};return{name:"Range",shaderCache:{hint:`${o}`},getShaderSource:p,getRunData:()=>({outputs:[{dims:s,dataType:o}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:a})}},iu=e=>{let t=0,r=0,o=0;e.inputs[0].dataType===6?(t=e.inputs[0].getInt32Array()[0],r=e.inputs[1].getInt32Array()[0],o=e.inputs[2].getInt32Array()[0]):e.inputs[0].dataType===1&&(t=e.inputs[0].getFloat32Array()[0],r=e.inputs[1].getFloat32Array()[0],o=e.inputs[2].getFloat32Array()[0]),tr.webgpu.validateInputContent&&hc(t,r,o),e.compute(gc(t,r,o,e.inputs[0].dataType),{inputs:[]})}});var yc,bc,wc,vc,$c,Sc,xc,_c,Cc,Ic,Ac,uu,Tc,Ec,Oc,Pc,Bc,du,lu,cu=q(()=>{"use strict";xe();Le();$e();yc=(e,t)=>{if(e.every(r=>r>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0){if(t.mode==="linear"){if(!(e.length===2||e.length===3||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1||e.length===5&&e[0]===1&&e[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and\n            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(t.mode==="cubic"&&!(e.length===2||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},bc=(e,t,r)=>{t.every(n=>n>=0&&n<r||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let o=new Array(r).fill(1);return t.forEach((n,s)=>o[n]=e[s]),o},wc=(e,t,r,o,n,s)=>{let[u,l,a]=r>10?[1,2,3]:[-1,e.length>1?1:-1,-1],p=e[0].dims.length;if(u>0&&e.length>u&&e[u].dims.length>0)e[u].getFloat32Array().forEach(h=>s.push(h));else if(t.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(l>0&&e.length>l&&e[l].dims.length>0){if(e[l].getFloat32Array().forEach(h=>o.push(h)),o.length!==0&&o.length!==p&&r>=18&&o.length!==t.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");yc(o,t),t.axes.length>0&&bc(o,t.axes,p).forEach((h,g)=>o[g]=h)}if(a>0&&e.length>a&&(e[a].getBigInt64Array().forEach(h=>n.push(Number(h))),n.length!==p||r>=18&&n.length===t.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(t.axes.length>0){if(o.length!==t.axes.length)throw new Error(\'Resize requires "scales" input size to be of axes rank when axes attributes is specified\');if(n.length!==t.axes.length)throw new Error(\'Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified\')}if(typeof o<"u"&&typeof n<"u"&&o.length>0&&n.length>p)throw new Error("Resize requires only of scales or sizes to be specified")},vc=(e,t)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,\n     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${t} { `+(()=>{switch(e){case"asymmetric":return`return ${t}(xResized) / ${t}(xScale);`;case"pytorch_half_pixel":return`if (lengthResized > 1) {\n                    return (${t}(xResized) + 0.5) / ${t}(xScale) - 0.5;\n                  } else {\n                    return 0.0;\n                  }`;case"tf_half_pixel_for_nn":return`return (${t}(xResized) + 0.5) / ${t}(xScale);`;case"align_corners":return`if (lengthResized == 1) {\n                    return 0.0;\n                  } else {\n                    // The whole part and the fractional part are calculated separately due to inaccuracy of floating\n                    // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an\n                    // offset-by-one error later in floor().\n                    let whole = ${t}(xResized * (lengthOriginal - 1) / (lengthResized - 1));\n                    let fract =\n                        ${t}(xResized * (lengthOriginal - 1) % (lengthResized - 1)) / ${t}(lengthResized - 1);\n                    return whole + fract;\n                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {\n                    return ${t}(roiStart) * ${t}(lengthOriginal - 1) +\n                        (${t}(xResized) * ${t}(roiEnd - roiStart) * ${t}(lengthOriginal - 1)) /\n                        ${t}(lengthResized - 1);\n                  } else {\n                    return 0.5 * ${t}(roiStart + roiEnd) * ${t}(lengthOriginal - 1);\n                  }`;case"half_pixel_symmetric":return`const outputWidth = ${t}xScale * ${t}(lengthResized);\n                  const adjustment = ${t}(lengthResized) / outputWidth;\n                  const center = ${t}(lengthOriginal) / 2;\n                  const offset = center * (1 - adjustment);\n                  return offset + ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;case"half_pixel":return`return ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${e} is not supported`)}})()+"}",$c=(e,t,r)=>`fn getNearestPixelFromOriginal(xOriginal: ${r}, isDownSample: bool) -> ${r} {`+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(t<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${e} is not supported`)}})()+"}",Sc=(e,t,r)=>{let o=new Array(r).fill(0).concat(new Array(r).fill(1)),n=e.length===0?o:e.slice();return t.length>0?(t.forEach((s,u)=>{o[s]=n[u],o[u+r]=n[t.length+u]}),o):n},xc=(e,t,r,o)=>{let n=[];if(r.length>0)if(o.length>0){if(e.forEach(s=>n.push(s)),Math.max(...o)>e.length)throw new Error("axes is out of bound");o.forEach((s,u)=>n[s]=r[u])}else r.forEach(s=>n.push(s));else{if(t.length===0)throw new Error("Resize requires either scales or sizes.");n=e.map((s,u)=>Math.round(s*t[u]))}return n},_c=(e,t,r)=>{let o=(()=>{switch(r.keepAspectRatioPolicy){case"not_larger":return r.axes.length>0?Math.min(...r.axes.map(s=>t[s]),Number.MAX_VALUE):Math.min(...t,Number.MAX_VALUE);case"not_smaller":return r.axes.length>0?Math.max(...r.axes.map(s=>t[s]),Number.MIN_VALUE):Math.max(...t,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${r.keepAspectRatioPolicy} is not supported`)}})();t.fill(1,0,t.length);let n=e.slice();return r.axes.length>0?(r.axes.forEach(s=>t[s]=o),r.axes.forEach(s=>n[s]=Math.round(e[s]*t[s]))):(t.fill(o,0,t.length),n.forEach((s,u)=>n[u]=Math.round(s*t[u]))),n},Cc=(e,t,r,o,n)=>`\n    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> array<${e.type.value}, ${r.length}> {\n      var original_indices: array<${e.type.value}, ${r.length}>;\n      for (var i:u32 = 0; i < ${r.length}; i++) {\n        var output_index = ${e.indicesGet("output_indices","i")};\n        var scale = ${de("uniforms.scales","i",o)};\n        var roi_low = ${de("uniforms.roi","i",n)};\n        var roi_hi = ${de("uniforms.roi",`i + ${t.length}`,n)};\n        if (scale == 1.0) {\n          original_indices[i] = ${e.type.value}(output_index);\n        } else {\n          var input_shape_i = ${de("uniforms.input_shape","i",t.length)};\n          var output_shape_i = ${de("uniforms.output_shape","i",r.length)};\n          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                           input_shape_i, roi_low, roi_hi);\n        }\n      }\n      return original_indices;\n    }`,Ic=(e,t,r,o,n,s,u)=>`\n    fn calculateInputIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {\n      var input_indices: ${e.type.indices};\n      for (var i:u32 = 0; i < ${o.length}; i++) {\n        var output_index = ${t.indicesGet("output_indices","i")};\n        var input_index: u32;\n        var scale = ${de("uniforms.scales","i",n)};\n        if (scale == 1.0) {\n          input_index = output_index;\n        } else {\n          var roi_low = ${de("uniforms.roi","i",s)};\n          var roi_hi = ${de("uniforms.roi",`i + ${r.length}`,s)};\n          var input_shape_i = ${de("uniforms.input_shape","i",r.length)};\n          var output_shape_i = ${de("uniforms.output_shape","i",o.length)};\n          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                        input_shape_i, roi_low, roi_hi);\n          if (!${u} || (original_idx >= 0 && original_idx < ${t.type.value}(input_shape_i))) {\n            if (original_idx < 0) {\n              input_index = 0;\n            } else if (original_idx > ${t.type.value}(input_shape_i - 1)) {\n              input_index = input_shape_i - 1;\n            } else {\n              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));\n            }\n          } else {\n            input_index = u32(original_idx);\n          }\n        }\n        ${e.indicesSet("input_indices","i"," input_index")}\n      }\n      return input_indices;\n    }`,Ac=(e,t)=>`\n    fn checkInputIndices(input_indices: ${e.type.indices}) -> bool {\n      for (var i:u32 = 0; i < ${t.length}; i++) {\n        var input_index = ${e.indicesGet("input_indices","i")};\n        if (input_index < 0 || input_index >= ${de("uniforms.input_shape","i",t.length)}) {\n          return false;\n        }\n      }\n      return true;\n    }`,uu=(e,t,r,o)=>e.rank>o?`\n    ${e.indicesSet("input_indices",t,"channel")};\n    ${e.indicesSet("input_indices",r,"batch")};\n`:"",Tc=(e,t,r,o,n)=>{let[u,l,a,p]=r.length===2?[-1,0,1,-1]:[0,2,3,1],h=e.type.value;return`\n    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${h} {\n      var input_indices: ${e.type.indices};\n      ${e.indicesSet("input_indices",l,`max(0, min(row, ${r[l]} - 1))`)};\n      ${e.indicesSet("input_indices",a,`max(0, min(col, ${r[a]} - 1))`)};\n      ${uu(e,p,u,2)}\n      return ${e.getByIndices("input_indices")};\n    }\n\n    fn bilinearInterpolation(output_indices: ${t.type.indices}) -> ${h} {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var row:${h} = originalIndices[${l}];\n      var col:${h} = originalIndices[${a}];\n      ${o?`if (row < 0 || row > (${r[l]} - 1) || col < 0 || col > (${r[a]} - 1)) {\n        return ${n};\n      }`:""};\n      row = max(0, min(row, ${r[l]} - 1));\n      col = max(0, min(col, ${r[a]} - 1));\n      var row1: u32 = u32(row);\n      var col1: u32 = u32(col);\n      var row2: u32 = u32(row + 1);\n      var col2: u32 = u32(col + 1);\n      var channel: u32 = ${r.length>2?`u32(originalIndices[${p}])`:"0"};\n      var batch: u32 =  ${r.length>2?`u32(originalIndices[${u}])`:"0"};\n      var x11: ${h} = getInputValue(batch, channel, row1, col1);\n      var x12: ${h} = getInputValue(batch, channel, row1, col2);\n      var x21: ${h} = getInputValue(batch, channel, row2, col1);\n      var x22: ${h} = getInputValue(batch, channel, row2, col2);\n      var dx1: ${h} = abs(row - ${h}(row1));\n      var dx2: ${h} = abs(${h}(row2) - row);\n      var dy1: ${h} = abs(col - ${h}(col1));\n      var dy2: ${h} = abs(${h}(col2) - col);\n      if (row1 == row2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (col1 == col2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);\n    }`},Ec=(e,t,r,o,n,s,u,l,a,p)=>{let h=r.length===2,g=!0,[w,v]=h?[0,1]:g?[2,3]:[1,2],y=e.type.value,_=I=>{let x=I===w?"row":"col";return`\n      fn ${x}CubicInterpolation(input_indices: ${e.type.indices}, output_indices: ${t.type.indices}) -> ${y} {\n        var output_index = ${t.indicesGet("output_indices",I)};\n        var originalIdx: ${y} = getOriginalCoordinateFromResizedCoordinate(output_index, ${n[I]},\n        ${o[I]}, ${r[I]}, ${s[I]}, ${s[I]} + ${r.length});\n        var fractOriginalIdx: ${y} = originalIdx - floor(originalIdx);\n        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);\n\n        if (${l} && (originalIdx < 0 || originalIdx > (${r[I]} - 1))) {\n          return ${a};\n        }\n        var data: array<${y}, 4> = array<${y}, 4>(0.0, 0.0, 0.0, 0.0);\n        for (var i: i32 = -1; i < 3; i++) {\n          var ${x}: ${y} = originalIdx + ${y}(i);\n          if (${x} < 0 || ${x} >= ${r[I]}) {\n            ${(()=>p?`coefs[i + 1] = 0.0;\n                        continue;`:l?`return ${a};`:`${x} = max(0, min(${x}, ${r[I]} - 1));`)()};\n          }\n        var input_indices_copy: ${e.type.indices} = input_indices;\n          ${e.indicesSet("input_indices_copy",I,`u32(${x})`)};\n          data[i + 1] = ${I===w?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};\n        }\n        return cubicInterpolation1D(data, coefs);\n      }`};return`\n    ${_(w)};\n    ${_(v)};\n  fn getCubicInterpolationCoefs(s: ${y}) -> array<${y}, 4> {\n    var absS = abs(s);\n    var coeffs: array<${y}, 4> = array<${y}, 4>(0.0, 0.0, 0.0, 0.0);\n    var oneMinusAbsS: ${y} = 1.0 - absS;\n    var twoMinusAbsS: ${y} = 2.0 - absS;\n    var onePlusAbsS: ${y} = 1.0 + absS;\n    coeffs[0] = ((${u} * onePlusAbsS - 5 * ${u}) * onePlusAbsS + 8 * ${u}) * onePlusAbsS - 4 * ${u};\n    coeffs[1] = ((${u} + 2) * absS - (${u} + 3)) * absS * absS + 1;\n    coeffs[2] = ((${u} + 2) * oneMinusAbsS - (${u} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;\n    coeffs[3] = ((${u} * twoMinusAbsS - 5 * ${u}) * twoMinusAbsS + 8 * ${u}) * twoMinusAbsS - 4 * ${u};\n    return coeffs;\n  }\n\n  fn cubicInterpolation1D(x: array<${y}, 4>, coefs: array<${y}, 4>) -> ${y} {\n    var coefsSum: ${y} = coefs[0] + coefs[1] + coefs[2] + coefs[3];\n    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;\n  }\n\n  fn bicubicInterpolation(output_indices: ${t.type.indices}) -> ${y} {\n    var input_indices: ${e.type.indices} = output_indices;\n    return colCubicInterpolation(input_indices, output_indices);\n  }\n    `},Oc=(e,t,r,o,n)=>{let[u,l,a,p,h]=r.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],g=e.type.value;return`\n    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${g} {\n      var input_indices: ${e.type.indices};\n      ${e.indicesSet("input_indices",l,`max(0, min(depth, ${r[l]} - 1))`)};\n      ${e.indicesSet("input_indices",a,`max(0, min(height, ${r[a]} - 1))`)};\n      ${e.indicesSet("input_indices",p,`max(0, min(width, ${r[p]} - 1))`)};\n      ${uu(e,h,u,3)}\n      return ${e.getByIndices("input_indices")};\n    }\n\n    fn trilinearInterpolation(output_indices: ${t.type.indices}) -> ${g} {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var depth:${g} = originalIndices[${l}];\n      var height:${g} = originalIndices[${a}];\n      var width:${g} = originalIndices[${p}];\n      ${o?`if (depth < 0 || depth > (${r[l]} - 1) || height < 0 || height > (${r[a]} - 1) || width < 0 || (width > ${r[p]} - 1)) {\n      return ${n};\n        }`:""};\n\n    depth = max(0, min(depth, ${r[l]} - 1));\n      height = max(0, min(height, ${r[a]} - 1));\n      width = max(0, min(width, ${r[p]} - 1));\n      var depth1: u32 = u32(depth);\n      var height1: u32 = u32(height);\n      var width1: u32 = u32(width);\n      var depth2: u32 = u32(depth + 1);\n      var height2: u32 = u32(height + 1);\n      var width2: u32 = u32(width + 1);\n      var channel: u32 = ${r.length>3?`u32(originalIndices[${h}])`:"0"};\n      var batch: u32 =  ${r.length>3?`u32(originalIndices[${u}])`:"0"};\n\n      var x111: ${g} = getInputValue(batch, channel, depth1, height1, width1);\n      var x112: ${g} = getInputValue(batch, channel, depth1, height1, width2);\n      var x121: ${g} = getInputValue(batch, channel, depth1, height2, width1);\n      var x122: ${g} = getInputValue(batch, channel, depth1, height2, width2);\n      var x211: ${g} = getInputValue(batch, channel, depth2, height1, width1);\n      var x212: ${g} = getInputValue(batch, channel, depth2, height1, width2);\n      var x221: ${g} = getInputValue(batch, channel, depth2, height2, width1);\n      var x222: ${g} = getInputValue(batch, channel, depth2, height2, width2);\n      var dx1: ${g} = abs(depth - ${g}(depth1));\n      var dx2: ${g} = abs(${g}(depth2) - depth);\n      var dy1: ${g} = abs(height - ${g}(height1));\n      var dy2: ${g} = abs(${g}(height2) - height);\n      var dz1: ${g} = abs(width - ${g}(width1));\n      var dz2: ${g} = abs(${g}(width2) - width);\n      if (depth1 == depth2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (height1 == height2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      if (width1 == width2) {\n        dz1 = 0.5;\n        dz2 = 0.5;\n      }\n      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +\n              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);\n    }`},Pc=(e,t,r,o,n,s)=>{let u=e.dims,l=Sc(s,t.axes,u.length),a=xc(u,o,n,t.axes),p=o.slice();o.length===0&&(p=u.map((A,O)=>A===0?1:a[O]/A),t.keepAspectRatioPolicy!=="stretch"&&(a=_c(u,p,t)));let h=K("output",e.dataType,a.length),g=U("input",e.dataType,u.length),w=V.size(a),v=u.length===a.length&&u.every((A,O)=>A===a[O]),y=t.coordinateTransformMode==="tf_crop_and_resize",_=t.extrapolationValue,I=g.type.value,x=A=>`\n      ${v?"":`\n      ${vc(t.coordinateTransformMode,I)};\n      ${(()=>{switch(t.mode){case"nearest":return`\n              ${Ac(g,u)};\n              ${$c(t.nearestMode,r,I)};\n              ${Ic(g,h,u,a,p.length,l.length,y)};\n              `;case"linear":return`\n              ${Cc(h,u,a,p.length,l.length)};\n              ${(()=>{if(u.length===2||u.length===4)return`${Tc(g,h,u,y,_)}`;if(u.length===3||u.length===5)return`${Oc(g,h,u,y,_)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};\n            `;case"cubic":return`\n            ${(()=>{if(u.length===2||u.length===4)return`${Ec(g,h,u,a,p,l,t.cubicCoeffA,y,t.extrapolationValue,t.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};\n            `;default:throw Error("Invalid resize mode")}})()};\n      `}\n      ${A.registerUniform("output_size","u32").registerUniform("scales","f32",p.length).registerUniform("roi","f32",l.length).declareVariables(g,h)}\n      ${A.mainStart()}\n        ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n        ${v?"output[global_idx] = input[global_idx];":`\n        let output_indices = ${h.offsetToIndices("global_idx")};\n        var input_indices: ${g.type.indices};\n        ${(()=>{switch(t.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);\n                if (checkInputIndices(input_indices)) {\n                  output[global_idx] = ${g.getByIndices("input_indices")};\n                } else {\n                  output[global_idx] = ${t.extrapolationValue};\n                }`;case"linear":return`output[global_idx] = ${u.length===2||u.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${t.mode}`)}})()};\n`}\n      }`;return{name:"Resize",shaderCache:{hint:`${t.cacheKey}|${r}|${p.length>0?p:""}|${n.length>0?n:""}|${l.length>0?l:""}|${v}|${u}`,inputDependencies:["rank"]},getShaderSource:x,getRunData:()=>({outputs:[{dims:a,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(w/64)},programUniforms:[{type:"uint32",data:w},{type:"float32",data:p},{type:"float32",data:l},...F(u),...F(a)]})}},Bc=e=>{let t=e.customDataBuffer;return new Uint32Array(t,t.byteOffset,1)[0]},du=(e,t)=>{let r=[],o=[],n=[],s=Bc(e);if(t.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");wc(e.inputs,t,s,r,o,n),e.compute(Pc(e.inputs[0],t,s,r,o,n),{inputs:[0]})},lu=e=>{let t=e.antialias,r=e.axes,o=e.coordinateTransformMode,n=e.cubicCoeffA,s=e.excludeOutside!==0,u=e.extrapolationValue,l=e.keepAspectRatioPolicy,a=e.mode,p=e.nearestMode===""?"simple":e.nearestMode;return he({antialias:t,axes:r,coordinateTransformMode:o,cubicCoeffA:n,excludeOutside:s,extrapolationValue:u,keepAspectRatioPolicy:l,mode:a,nearestMode:p})}});var kc,Rc,pu,mu,fu=q(()=>{"use strict";We();xe();Le();$e();kc=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let t=e[0],r=e[1],o=e[2];if(t.dataType!==r.dataType||t.dataType!==o.dataType)throw new Error("All inputs must have the same data type");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Input must be 2D or 3D");if(r.dims.length!==3&&r.dims.length!==2)throw new Error("Skip must be 2D or 3D");let n=t.dims[t.dims.length-1],s=t.dims[t.dims.length-2];if(r.dims[r.dims.length-1]!==n)throw new Error("Skip must have the same hidden size as input");if(r.dims[r.dims.length-2]!==s)throw new Error("Skip must have the same sequence length as input");if(o.dims.length!==1)throw new Error("Gamma must be 1D");if(o.dims[o.dims.length-1]!==n)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let u=e[3];if(u.dims.length!==1)throw new Error("Beta must be 1D");if(u.dims[u.dims.length-1]!==n)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let u=e[4];if(u.dims.length!==1)throw new Error("Bias must be 1D");if(u.dims[u.dims.length-1]!==n)throw new Error("Bias must have the same hidden size as input")}},Rc=(e,t,r,o)=>{let n=e[0].dims,s=V.size(n),u=n,l=s,a=n.slice(-1)[0],p=o?n.slice(0,-1).concat(1):[],h=e.length>3,g=e.length>4,w=o&&r>1,v=o&&r>2,y=r>3,_=He(a),I=[U("x",e[0].dataType,e[0].dims,_),U("skip",e[1].dataType,e[1].dims,_),U("gamma",e[2].dataType,e[2].dims,_)];h&&I.push(U("beta",e[3].dataType,e[3].dims,_)),g&&I.push(U("bias",e[4].dataType,e[4].dims,_)),I.push(K("output",e[0].dataType,u,_)),w&&I.push(K("meanOutput",1,p)),v&&I.push(K("invStdOutput",1,p)),y&&I.push(K("inputSkipBiasSum",e[0].dataType,u,_));let x=Ge(e[0].dataType),A=C=>`\n      const hiddenSize: f32 = ${a};\n      const hiddenSizeVectorized: u32 = ${a/_};\n      const epsilon: f32 = ${t.epsilon};\n\n      ${C.declareVariables(...I)}\n\n      ${C.mainStart()}\n        ${C.guardAgainstOutOfBoundsWorkgroupSizes(l/a)}\n        let offset = global_idx * hiddenSizeVectorized;\n        var sum = ${Qe("f32",_)};\n        var squareSum = ${Qe("f32",_)};\n        for (var i: u32 = 0; i < hiddenSizeVectorized; i++) {\n          let skipValue = skip[offset + i];\n          let biasValue = ${g?"bias[i]":"0.0"};\n          let inputValue = x[offset + i];\n          let value = inputValue + skipValue + biasValue;\n          ${y?"inputSkipBiasSum[offset + i] = value;":""}\n          output[offset + i] = value;\n          let f32Value = ${ut(x,_,"value")};\n          sum += f32Value;\n          squareSum += f32Value * f32Value;\n        }\n        let mean = ${ot("sum",_)} / hiddenSize;\n        let invStdDev = inverseSqrt(${ot("squareSum",_)} / hiddenSize - mean * mean + epsilon);\n        ${w?"meanOutput[global_idx] = mean;":""}\n        ${v?"invStdOutput[global_idx] = invStdDev;":""}\n        for (var i: u32 = 0; i < hiddenSizeVectorized; i++) {\n          output[offset + i] = (output[offset + i] - ${x}(mean)) * ${x}(invStdDev) * gamma[i]\n           + ${h?"beta[i]":"0.0"};\n        }\n      }`,O=[{dims:u,dataType:e[0].dataType}];return r>1&&O.push({dims:p,dataType:1}),r>2&&O.push({dims:p,dataType:1}),r>3&&O.push({dims:n,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:t.cacheKey},getShaderSource:A,getRunData:()=>({outputs:O,dispatchGroup:{x:Math.ceil(l/a/64)}})}},pu=(e,t)=>{kc(e.inputs);let o=[0];e.outputCount>1&&o.push(-3),e.outputCount>2&&o.push(-3),e.outputCount>3&&o.push(3),e.compute(Rc(e.inputs,t,e.outputCount,!1),{outputs:o})},mu=e=>{let t=e.epsilon;return he({epsilon:t})}});var Dc,hn,Mc,hu,Uc,zc,gu,yu,bu=q(()=>{"use strict";We();xe();Le();$e();Dc=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");if(t.axes.length!==0){if(t.axes.length!==t.starts.length||t.axes.length!==t.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(t.starts.length!==t.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((r,o)=>{if(e[o+1].dataType!==6&&e[o+1].dataType!==7)throw new Error(`Input ${o} must be an array of int32 or int64`)})},hn=(e,t)=>{let r=[];if(e.length>t)if(e[t].dataType===7)e[t].getBigInt64Array().forEach(o=>r.push(Number(o)));else if(e[t].dataType===6)e[t].getInt32Array().forEach(o=>r.push(Number(o)));else throw new Error(`Input ${t} must be an array of int32 or int64`);return r},Mc=(e,t)=>{if(e.length>1){let r=hn(e,1),o=hn(e,2),n=hn(e,3);return n.length===0&&(n=[...Array(e[0].dims.length).keys()]),he({starts:r,ends:o,axes:n})}else return t},hu=(e,t,r,o,n)=>{let s=e;return e<0&&(s+=r[o[t]]),n[t]<0?Math.max(0,Math.min(s,r[o[t]]-1)):Math.max(0,Math.min(s,r[o[t]]))},Uc=(e,t,r)=>`fn calculateInputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {\n          var input_indices: ${e.type.indices};\n          var carry = 0u;\n          for (var i = ${r.length}; i >= 0; i--) {\n            let input_shape_i = ${de("uniforms.input_shape","i",r.length)};\n            let steps_i = ${de("uniforms.steps","i",r.length)};\n            let signs_i = ${de("uniforms.signs","i",r.length)};\n            let starts_i = ${de("uniforms.starts","i",r.length)};\n            var output_index = ${t.indicesGet("output_indices","i")};\n            var input_index = output_index * steps_i + starts_i + carry;\n            carry = input_index / input_shape_i;\n            input_index = input_index % input_shape_i;\n            if (signs_i < 0) {\n              input_index = input_shape_i - input_index - 1u + starts_i;\n            }\n            ${e.indicesSet("input_indices","i","input_index")};\n          }\n          return input_indices;\n      }`,zc=(e,t)=>{let r=e[0].dims,o=V.size(r),n=t.axes.length>0?V.normalizeAxes(t.axes,r.length):[...Array(r.length).keys()],s=hn(e,4);s.forEach(x=>x!==0||(()=>{throw new Error("step cannot be 0")})),s.length===0&&(s=Array(n.length).fill(1));let u=t.starts.map((x,A)=>hu(x,A,r,n,s)),l=t.ends.map((x,A)=>hu(x,A,r,n,s));if(n.length!==u.length||n.length!==l.length)throw new Error("start, ends and axes should have the same number of elements");if(n.length!==r.length)for(let x=0;x<r.length;++x)n.includes(x)||(u.splice(x,0,0),l.splice(x,0,r[x]),s.splice(x,0,1));let a=s.map(x=>Math.sign(x));s.forEach((x,A,O)=>{if(x<0){let C=(l[A]-u[A])/x,M=u[A],D=M+C*s[A];u[A]=D,l[A]=M,O[A]=-x}});let p=r.slice(0);n.forEach((x,A)=>{p[x]=Math.ceil((l[x]-u[x])/s[x])});let h={dims:p,dataType:e[0].dataType},g=K("output",e[0].dataType,p.length),w=U("input",e[0].dataType,e[0].dims.length),v=V.size(p),y=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:u.length},{name:"signs",type:"i32",length:a.length},{name:"steps",type:"u32",length:s.length}],_=[{type:"uint32",data:v},{type:"uint32",data:u},{type:"int32",data:a},{type:"uint32",data:s},...F(e[0].dims),...F(p)],I=x=>`\n      ${x.registerUniforms(y).declareVariables(w,g)}\n        ${Uc(w,g,r)}\n        ${x.mainStart()}\n          ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n          let output_indices = ${g.offsetToIndices("global_idx")};\n          let input_indices = calculateInputIndices(output_indices);\n          ${g.setByOffset("global_idx",w.getByIndices("input_indices"))}\n      }`;return{name:"Slice",shaderCache:{hint:`${a.length}_${u.length}_${s.length}`,inputDependencies:["rank"]},getShaderSource:I,getRunData:()=>({outputs:[h],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:_})}},gu=(e,t)=>{Dc(e.inputs,t);let r=Mc(e.inputs,t);e.compute(zc(e.inputs,r),{inputs:[0]})},yu=e=>{let t=e.starts,r=e.ends,o=e.axes;return he({starts:t,ends:r,axes:o})}});var Vc,Nc,wu,vu,$u=q(()=>{"use strict";xe();Le();$e();Vc=e=>{if(!e||e.length!==1)throw new Error("Softmax op requires 1 input.")},Nc=(e,t)=>{let r=e.dims,o=V.size(r),n=64,s=t.axis;if(s<0&&(s=r.length+s),s<r.length-1)throw new Error("softmax only supports last axis for now.");let u=r[s],l=o/u,a=He(u),p=u/a,h=(I,x)=>x===4?`max(max(${I}.x, ${I}.y), max(${I}.z, ${I}.w))`:x===2?`max(${I}.x, ${I}.y)`:x===3?`max(max(${I}.x, ${I}.y), ${I}.z)`:I,g=U("x",e.dataType,e.dims,a),w=K("result",e.dataType,e.dims,a),v=g.type.value,y=Ge(e.dataType)==="f32"?`var threadMax = ${v}(-3.402823e+38f);`:`var threadMax = ${v}(-65504.0h);`,_=I=>`\n      var<workgroup> rowMaxShared : ${v};\n      var<workgroup> rowSumShared : ${v};\n      var<workgroup> threadShared : array<${v}, ${n}>;\n\n      fn getValue(row: i32, col: i32, row_stride: i32) -> ${v} {\n        let index = row * row_stride + col;\n        return x[index];\n      }\n\n      fn setValue(row: i32, col: i32, row_stride: i32, value: ${v}) {\n        let index = row * row_stride + col;\n        result[index] = value;\n      }\n      ${I.registerUniform("packedCols","i32").declareVariables(g,w)}\n      ${I.mainStart()}\n        let gindex = i32(global_idx);\n        let lindex = i32(local_idx);\n        const wg = ${n};\n        let row = gindex / wg;\n        let cols = uniforms.packedCols;\n        let row_stride : i32 = uniforms.packedCols;\n\n        // find the rows max\n        ${y}\n        for (var col = lindex; col < cols; col += wg) {\n          let value = getValue(row, col, row_stride);\n          threadMax = max(threadMax, value);\n        }\n        if (lindex < cols) {\n          threadShared[lindex] = threadMax;\n        }\n        workgroupBarrier();\n\n        var reduceSize = min(cols, wg);\n        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {\n          reduceSize = currSize + (reduceSize & 1);\n          if (lindex < currSize) {\n            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowMaxShared = ${v}(${h("threadShared[0]",a)});\n        }\n        workgroupBarrier();\n\n        // find the rows sum\n        var threadSum = ${v}(0.0);\n        for (var col = lindex; col < cols; col += wg) {\n          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);\n          threadSum += subExp;\n        }\n        threadShared[lindex] = threadSum;\n        workgroupBarrier();\n\n        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {\n          if (lindex < currSize) {\n            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowSumShared = ${v}(${ot("threadShared[0]",a)});\n        }\n        workgroupBarrier();\n\n        // calculate final value for each element in the row\n        for (var col = lindex; col < cols; col += wg) {\n          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;\n          setValue(row, col, row_stride, value);\n        }\n      }`;return{name:"Softmax",shaderCache:{hint:`${a}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:r,dataType:e.dataType}],dispatchGroup:{x:l},programUniforms:[{type:"uint32",data:p}]}),getShaderSource:_}},wu=(e,t)=>{Vc(e.inputs),e.compute(Nc(e.inputs[0],t))},vu=e=>he({axis:e.axis})});var Wc,Gc,Hc,Lc,Fc,Su,xu,_u=q(()=>{"use strict";xe();Le();$e();Wc=e=>{if(!e||e.length<1)throw new Error("too few inputs")},Gc=(e,t)=>{let r=[],o=t.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(n=>r.push(Number(n))),o=r.length),he({numOutputs:o,axis:t.axis,splitSizes:r})},Hc=e=>`\nfn calculateOutputIndex(index: u32) -> u32 {\n    for (var i: u32 = 0u; i < ${e}u; i += 1u ) {\n    if (index < ${de("uniforms.size_in_split_axis","i",e)}) {\n        return i;\n    }\n    }\n    return ${e}u;\n}`,Lc=e=>{let t=e.length,r=[];for(let o=0;o<t;++o){let n=e[o].setByIndices("indices","input[global_idx]");t===1?r.push(n):o===0?r.push(`if (output_number == ${o}u) { ${n} }`):o===t-1?r.push(`else { ${n} }`):r.push(`else if (output_number == ${o}) { ${n} }`)}return`\n      fn writeBufferData(output_number: u32, indices: ${e[0].type.indices}, global_idx: u32) {\n        ${r.join(`\n`)}\n      }`},Fc=(e,t)=>{let r=e[0].dims,o=V.size(r),n=e[0].dataType,s=V.normalizeAxis(t.axis,r.length),u=new Array(t.numOutputs),l=U("input",n,r),a=new Array(t.numOutputs),p=[],h=[],g=0,w=[{type:"uint32",data:o}];for(let y=0;y<t.numOutputs;y++){g+=t.splitSizes[y],a[y]=g;let _=r.slice();_[t.axis]=t.splitSizes[y],h.push(_),u[y]=K(`output${y}`,n,_),p.push({dims:h[y],dataType:e[0].dataType})}w.push({type:"uint32",data:a}),w.push(...F(r)),h.forEach(y=>w.push(...F(y)));let v=y=>`\n  ${y.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",a.length).declareVariables(l,...u)}\n  ${Hc(a.length)}\n  ${Lc(u)}\n\n  ${y.mainStart()}\n    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}\n\n    var indices = ${l.offsetToIndices("global_idx")};\n    var index = ${l.indicesGet("indices",s)};\n    let output_number = calculateOutputIndex(index);\n    if (output_number != 0) {\n      index -= ${de("uniforms.size_in_split_axis","output_number - 1u",a.length)};\n      ${l.indicesSet("indices",s,"index")};\n    }\n    writeBufferData(output_number, indices, global_idx);\n  }`;return{name:"Split",shaderCache:{hint:t.cacheKey,inputDependencies:["rank"]},getShaderSource:v,getRunData:()=>({outputs:p,dispatchGroup:{x:Math.ceil(o/64)},programUniforms:w})}},Su=(e,t)=>{Wc(e.inputs);let r=e.inputs.length===1?t:Gc(e.inputs,t);e.compute(Fc(e.inputs,r),{inputs:[0]})},xu=e=>{let t=e.axis,r=e.splitSizes,o=e.numOutputs<0?r.length:e.numOutputs;if(o!==r.length)throw new Error("numOutputs and splitSizes lengh must be equal");return he({axis:t,numOutputs:o,splitSizes:r})}});var Cu,Kc,qc,jc,Iu,Au=q(()=>{"use strict";We();xe();$e();Cu=e=>Array.from(e.getBigInt64Array(),Number),Kc=e=>{if(!e||e.length!==2)throw new Error("Tile requires 2 inputs.");if(e[0].dataType!==1&&e[0].dataType!==6&&e[0].dataType!==12)throw new Error("Tile only support float, int32, and uint32 data types");if(e[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(e[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(Cu(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},qc=(e,t)=>{let r=[];for(let o=0;o<e.length;++o)r.push(e[o]*t[o]);return r},jc=e=>{let t=e[0].dims,r=Cu(e[1]),o=qc(t,r),n=V.size(o),s=e[0].dataType,u=U("input",s,t.length),l=K("output",s,o.length),a=p=>`\n      const inputShape = ${u.indices(...t)};\n      ${p.registerUniform("output_size","u32").declareVariables(u,l)}\n      ${p.mainStart()}\n      ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n      let output_indices = ${l.offsetToIndices("global_idx")};\n      var input_indices: ${u.type.indices};\n      for (var i = 0; i < ${t.length}; i++) {\n        let input_dim_i = ${u.indicesGet("uniforms.input_shape","i")};\n        let input_dim_value = ${l.indicesGet("output_indices","i")}  % input_dim_i;\n\n        ${u.indicesSet("input_indices","i","input_dim_value")}\n      }\n      ${l.setByOffset("global_idx",u.getByIndices("input_indices"))}\n    }`;return{name:"Tile",shaderCache:{hint:`${r}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:o,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:[{type:"uint32",data:n},...F(e[0].dims),...F(o)]}),getShaderSource:a}},Iu=e=>{Kc(e.inputs),e.compute(jc(e.inputs),{inputs:[0]})}});var Yc,Zc,Tu,Eu=q(()=>{"use strict";We();xe();$e();Yc=(e,t,r,o,n)=>{let s=K("output_data",n,r.length,4),u=U("a_data",t[1].dataType,t[1].dims.length,4),l=U("b_data",t[2].dataType,t[2].dims.length,4),a=U("c_data",t[0].dataType,t[0].dims.length,4),p,h=(g,w,v)=>`select(${w}, ${g}, ${v})`;if(!o)p=s.setByOffset("global_idx",h(u.getByOffset("global_idx"),l.getByOffset("global_idx"),a.getByOffset("global_idx")));else{let g=(w,v,y="")=>{let _=`a_data[index_a${v}][component_a${v}]`,I=`b_data[index_b${v}][component_b${v}]`,x=`bool(c_data[index_c${v}] & ${4278190080>>>(3-v)*8}u)`;return`\n            let output_indices${v} = ${s.offsetToIndices(`global_idx * 4u + ${v}u`)};\n            let offset_a${v} = ${u.broadcastedIndicesToOffset(`output_indices${v}`,s)};\n            let offset_b${v} = ${l.broadcastedIndicesToOffset(`output_indices${v}`,s)};\n            let offset_c${v} = ${a.broadcastedIndicesToOffset(`output_indices${v}`,s)};\n            let index_a${v} = offset_a${v} / 4u;\n            let index_b${v} = offset_b${v} / 4u;\n            let index_c${v} = offset_c${v} / 4u;\n            let component_a${v} = offset_a${v} % 4u;\n            let component_b${v} = offset_b${v} % 4u;\n            ${w}[${v}] = ${y}(${h(_,I,x)});\n          `};n===9?p=`\n            var data = vec4<u32>(0);\n            ${g("data",0,"u32")}\n            ${g("data",1,"u32")}\n            ${g("data",2,"u32")}\n            ${g("data",3,"u32")}\n            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:p=`\n            ${g("output_data[global_idx]",0)}\n            ${g("output_data[global_idx]",1)}\n            ${g("output_data[global_idx]",2)}\n            ${g("output_data[global_idx]",3)}\n          `}return`\n        ${e.registerUniform("vec_size","u32").declareVariables(a,u,l,s)}\n        ${e.mainStart()}\n        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n        ${p}\n      }`},Zc=e=>{let t=e[1].dims,r=e[2].dims,o=e[0].dims,n=e[1].dataType,s=!(V.areEqual(t,r)&&V.areEqual(r,o)),u=t,l=V.size(t);if(s){let p=mt.calcShape(mt.calcShape(t,r,!1),o,!1);if(!p)throw new Error("Can\'t perform where op on the given tensors");u=p,l=V.size(u)}let a=Math.ceil(l/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:p=>Yc(p,e,u,s,n),getRunData:()=>({outputs:[{dims:u,dataType:n}],dispatchGroup:{x:Math.ceil(l/64/4)},programUniforms:[{type:"uint32",data:a},...F(o),...F(t),...F(r),...F(u)]})}},Tu=e=>{e.compute(Zc(e.inputs))}});var Ou,Pu=q(()=>{"use strict";ei();Jn();ni();ai();zi();Yi();Ji();no();ps();hs();vs();xs();Is();Es();Bs();Rs();Ms();ao();Ns();Gs();au();su();rn();cu();fu();bu();$u();_u();Au();or();Xn();Eu();Ou=new Map([["Abs",[ii]],["Acos",[si]],["Acosh",[ui]],["Add",[Vi]],["ArgMax",[Xa,Qn]],["ArgMin",[Ja,Qn]],["Asin",[di]],["Asinh",[li]],["Atan",[ci]],["Atanh",[pi]],["Attention",[ti]],["AveragePool",[Zs,Ys]],["BatchNormalization",[ri]],["BiasAdd",[oi]],["BiasSplitGelu",[Ui]],["Cast",[fi,mi]],["Ceil",[gi]],["Clip",[hi]],["Concat",[Zi,Qi]],["Conv",[so,io]],["ConvTranspose",[cs,ls]],["Cos",[yi]],["Cosh",[bi]],["CumSum",[ms,fs]],["Div",[Ni]],["Einsum",[bs,ws]],["Elu",[wi,an]],["Equal",[Wi]],["Erf",[vi]],["Exp",[$i]],["Expand",[Ss]],["Floor",[Si]],["FusedConv",[so,io]],["Gather",[Cs,_s]],["GatherElements",[Ts,As]],["Gelu",[xi]],["Gemm",[Ps,Os]],["GlobalAveragePool",[Xs,Js]],["GlobalMaxPool",[ou,nu]],["Greater",[Fi]],["GreaterOrEqual",[qi]],["InstanceNormalization",[ks]],["LayerNormalization",[Ds]],["LeakyRelu",[_i,an]],["Less",[Ki]],["LessOrEqual",[ji]],["Log",[Mi]],["MatMul",[ns]],["MaxPool",[tu,ru]],["Mul",[Gi]],["MultiHeadAttention",[Vs,zs]],["Neg",[Ii]],["Not",[Ci]],["Pad",[Ws]],["Pow",[Hi]],["Range",[iu]],["Reciprocal",[Ai]],["ReduceMin",[Ka]],["ReduceMean",[Wa]],["ReduceMax",[Fa]],["ReduceSum",[ja]],["ReduceProd",[qa]],["ReduceL1",[Ga]],["ReduceL2",[Ha]],["ReduceLogSum",[Za]],["ReduceLogSumExp",[La]],["ReduceSumSquare",[Ya]],["Relu",[Ti]],["Resize",[du,lu]],["Sigmoid",[Ei]],["Sin",[Oi]],["Sinh",[Pi]],["Slice",[gu,yu]],["SkipLayerNormalization",[pu,mu]],["Split",[Su,xu]],["Sqrt",[Bi]],["Softmax",[wu,vu]],["Sub",[Li]],["Tan",[ki]],["Tanh",[Ri]],["ThresholdedRelu",[Di,an]],["Tile",[Iu]],["Transpose",[Ta,Ea]],["Where",[Tu]]])});var gn,Bu=q(()=>{"use strict";rr();Pt();$e();gn=class{constructor(t){this.backend=t;this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,r){this.repo.set(t,r)}run(t,r,o){Vt(t.programInfo.name);let n=this.backend.getComputePassEncoder();if(this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2),this.backend.sessionStatus==="capturing"){let s={kernelId:this.backend.currentKernelId,computePipeline:t.computePipeline,bindGroup:r,dispatchGroup:o};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(s)}n.setPipeline(t.computePipeline),n.setBindGroup(0,r),n.dispatchWorkgroups(...o),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Nt(t.programInfo.name)}dispose(){}build(t,r){Vt(t.name);let o=this.backend.device,n=[];o.features.has("shader-f16")&&n.push("enable f16;");let s=Ia(r),u=t.getShaderSource(s),l=`${n.join(`\n`)}\n${s.additionalImplementations}\n${u}`,a=o.createShaderModule({code:l,label:t.name});Re("verbose",()=>`[WebGPU] ${t.name} shader code: ${l}`);let p=o.createComputePipeline({compute:{module:a,entryPoint:"main"},layout:"auto",label:t.name});return Nt(t.name),{programInfo:t,computePipeline:p}}normalizeDispatchGroupSize(t){let r=typeof t=="number"?t:t.x,o=typeof t=="number"?1:t.y||1,n=typeof t=="number"?1:t.z||1,s=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(r<=s&&o<=s&&n<=s)return[r,o,n];let u=r*o*n,l=Math.ceil(Math.sqrt(u));if(l>s){if(l=Math.ceil(Math.cbrt(u)),l>s)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[l,l,l]}else return[l,l,1]}}});var Qc,Jc,yn,ku=q(()=>{"use strict";rr();We();Pt();$a();Ca();Pu();Bu();Qc=(e,t)=>{if(t.length!==e.length)throw new Error(`inputDependencies length ${t.length} is not equal to inputTensors length ${e.length}.`);let r=[];for(let o=0;o<e.length;++o){let n=e[o].dataType;switch(t[o]){case"none":{r.push("");break}case"type":{r.push(`${n}`);break}case"rank":{let s=e[o].dims.length;r.push(`${n};${s}`);break}case"dims":{let s=e[o].dims.join(",");r.push(`${n};${s}`);break}default:throw new Error(`unsupported input dependency: ${t[o]}`)}}return r.join("|")},Jc=(e,t,r)=>{let o=e.name;return e.shaderCache?.hint&&(o+="["+e.shaderCache.hint+"]"),o+=":"+r+`:${Qc(t,e.shaderCache?.inputDependencies??new Array(t.length).fill("dims"))}`,o},yn=class{constructor(){this.currentSessionId=null;this.currentKernelId=null;this.commandEncoder=null;this.computePassEncoder=null;this.maxDispatchNumber=16;this.pendingDispatchNumber=0;this.pendingKernels=[];this.pendingQueries=new Map;this.sessionStatus="default";this.capturedCommandList=new Map;this.capturedPendingKernels=new Map;this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let t=this.kernelCustomData.get(this.currentKernelId);return t||(t={},this.kernelCustomData.set(this.currentKernelId,t)),t}async initialize(t,r){this.env=t;let o=[],n={requiredLimits:{maxComputeWorkgroupStorageSize:r.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:r.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:r.limits.maxStorageBufferBindingSize,maxBufferSize:r.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:r.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:r.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:r.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:r.limits.maxComputeWorkgroupSizeZ},requiredFeatures:o};r.features.has("chromium-experimental-timestamp-query-inside-passes")?o.push("chromium-experimental-timestamp-query-inside-passes"):r.features.has("timestamp-query")&&o.push("timestamp-query"),r.features.has("shader-f16")&&o.push("shader-f16"),this.device=await r.requestDevice(n),this.gpuDataManager=_a(this),this.programManager=new gn(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,this.kernelUniformCache=new Map,this.kernelGpuBindGroupCache=new Map,wa(t.logLevel,!!t.debug),this.device.onuncapturederror=s=>{s.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${s.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder(),this.setQueryType(),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE}))),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let t=this.getCommandEncoder(),r={};this.queryType==="at-passes"&&(r.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=t.beginComputePass(r)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Vt(),this.endComputePass();let t;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),t=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(t,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&t.mapAsync(GPUMapMode.READ).then(()=>{let r=new BigUint64Array(t.getMappedRange()),o=this.pendingQueries.get(t);for(let n=0;n<r.length/2;n++){let s=o[n],u=s.kernelId,l=this.kernels.get(u),a=l.kernelType,p=l.kernelName,h=s.programName,g=s.inputTensorViews,w=s.outputTensorViews,v=r[n*2],y=r[n*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=v);let _=Number(v-this.queryTimeBase),I=Number(y-this.queryTimeBase);if(!Number.isSafeInteger(_)||!Number.isSafeInteger(I))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:g.map(x=>({dims:x.dims,dataType:nt(x.dataType)})),outputsMetadata:w.map(x=>({dims:x.dims,dataType:nt(x.dataType)})),kernelId:u,kernelType:a,kernelName:p,programName:h,startTime:_,endTime:I});else{let x="";g.forEach((O,C)=>{x+=`input[${C}]: [${O.dims}] | ${nt(O.dataType)}, `});let A="";w.forEach((O,C)=>{A+=`output[${C}]: [${O.dims}] | ${nt(O.dataType)}, `}),console.log(`[profiling] kernel "${u}|${a}|${p}|${h}" ${x}${A}execution time: ${I-_} ns`)}Nn("GPU",`${h}::${v}::${y}`)}t.unmap(),this.pendingQueries.delete(t)}),Nt()}run(t,r,o,n,s){Vt(t.name);let u=[];for(let C=0;C<r.length;++C){let M=this.gpuDataManager.get(r[C].data);if(!M)throw new Error(`no GPU data for input: ${r[C].data}`);u[C]=M}let{outputs:l,dispatchGroup:a,programUniforms:p}=t.getRunData(r),h=o.length===0?l.map((C,M)=>M):o;if(h.length!==l.length)throw new Error(`Output size ${h.length} must be equal to ${l.length}.`);let g=[],w=[];for(let C=0;C<l.length;++C){if(!Number.isInteger(h[C])||h[C]<-3||h[C]>=l.length)throw new Error(`Invalid output index: ${h[C]}`);if(h[C]===-3)continue;let M=h[C]===-1,D=h[C]===-2,G=M||D?s(l[C].dataType,l[C].dims):n(h[C],l[C].dataType,l[C].dims),E=this.gpuDataManager.get(G.data);if(!E)throw new Error(`no GPU data for output: ${G.data}`);if(M&&this.temporaryData.push(E),D){let W=this.kernelPersistentData.get(this.currentKernelId);W||(W=[],this.kernelPersistentData.set(this.currentKernelId,W)),W.push(E)}g.push(G),w.push(E)}let v;if(p){let C=this.kernelUniformCache.get(this.currentKernelId);C&&(this.compareProgramUniforms(C.programUniforms,p)||(this.gpuDataManager.release(C.gpuData.id),C=void 0)),C||(C=this.createCachedUniform(p),this.kernelUniformCache.set(this.currentKernelId,C)),v=C.binding}let y=this.programManager.normalizeDispatchGroupSize(a),_=y[1]===1&&y[2]===1,I=Jc(t,r,_),x=this.programManager.getArtifact(I);if(x||(x=this.programManager.build(t,y),this.programManager.setArtifact(I,x),Re("info",()=>`[artifact] key: ${I}, programName: ${t.name}`)),Re("info",()=>`[ProgramManager] run "${t.name}" (key=${I}) with ${y[0]}x${y[1]}x${y[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let C={kernelId:this.currentKernelId,programName:x.programInfo.name,inputTensorViews:r,outputTensorViews:g};this.pendingKernels.push(C),this.capturedPendingKernels.get(this.currentSessionId).push(C)}let A=this.kernelGpuBindGroupCache.get(this.currentKernelId);A||(A=[],this.kernelGpuBindGroupCache.set(this.currentKernelId,A));let O;for(let C of A)if(this.checkCachedBindGroup(C,x,u,w,v)){O=C;break}if(!O)for(O=this.createCachedBindGroup(x,u,w,v),A.push(O);A.length>20;)A.shift();return this.programManager.run(x,O.binding,y),Nt(t.name),g}compareProgramUniforms(t,r){return t.length!==r.length?!1:t.every((n,s)=>n.type===r[s].type)}createCachedUniform(t){let r=0,o=[];t.forEach(a=>{let p=typeof a.data=="number"?[a.data]:a.data;if(p.length===0)return;let h=p.length<=2?p.length*4:16;r=Math.ceil(r/h)*h,o.push(r),r+=p.length>4?Math.ceil(p.length/4)*16:p.length*4});let n=16;r=Math.ceil(r/n)*n;let s=new ArrayBuffer(r);t.forEach((a,p)=>{let h=o[p],g=typeof a.data=="number"?[a.data]:a.data;a.type==="int32"?new Int32Array(s,h,g.length).set(g):a.type==="uint32"?new Uint32Array(s,h,g.length).set(g):new Float32Array(s,h,g.length).set(g)});let u=this.gpuDataManager.create(r,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(u.buffer,0,s,0,r);let l={offset:0,size:r,buffer:u.buffer};return{programUniforms:t,binding:l,gpuData:u}}checkCachedBindGroup(t,r,o,n,s){if(r!==t.artifact)return!1;let u=o.every((p,h)=>p.permamentID===t.inputPermamentIDs[h]),l=n.every((p,h)=>p.permamentID===t.outputPermamentIDs[h]),a=s===t.uniformBinding;return u&&l&&a}createCachedBindGroup(t,r,o,n){let s=[];for(let l of r)s.push({binding:s.length,resource:{buffer:l.buffer}});for(let l of o)s.push({binding:s.length,resource:{buffer:l.buffer}});return n&&s.push({binding:s.length,resource:n}),{binding:this.device.createBindGroup({layout:t.computePipeline.getBindGroupLayout(0),entries:s,label:t.programInfo.name}),artifact:t,inputPermamentIDs:r.map(l=>l.permamentID),outputPermamentIDs:o.map(l=>l.permamentID),uniformBinding:n}}upload(t,r){this.gpuDataManager.upload(t,r)}memcpy(t,r){this.gpuDataManager.memcpy(t,r)}async download(t,r){await this.gpuDataManager.download(t,r)}alloc(t){return this.gpuDataManager.create(t).id}free(t){return this.gpuDataManager.release(t)}createKernel(t,r,o,n){let s=Ou.get(t);if(!s)throw new Error(`kernel not implemented: ${t}`);let u={kernelType:t,kernelName:n,kernelEntry:s[0],attributes:[s[1],o]};this.kernels.set(r,u)}releaseKernel(t){let r=this.kernelPersistentData.get(t);if(r){for(let n of r)this.gpuDataManager.release(n.id);this.kernelPersistentData.delete(t)}this.kernelCustomData.delete(t),this.kernelGpuBindGroupCache.delete(t);let o=this.kernelUniformCache.get(t);console.log("Release kernelId: ",t," has cached: ",o),o&&(this.gpuDataManager.release(o.gpuData.id),this.kernelUniformCache.delete(t)),this.kernels.delete(t)}computeKernel(t,r,o){let n=this.kernels.get(t);if(!n)throw new Error(`kernel not created: ${t}`);let s=n.kernelType,u=n.kernelName,l=n.kernelEntry,a=n.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${s}] ${u}" is not allowed to be called recursively`);this.currentKernelId=t,a[0]&&(a[1]=a[0](a[1]),a[0]=void 0),Re("info",()=>`[WebGPU] Start to run kernel "[${s}] ${u}"...`);let p=this.env.debug;this.temporaryData=[];try{return p&&this.device.pushErrorScope("validation"),l(r,a[1]),0}catch(h){return o.push(Promise.resolve(`[WebGPU] Kernel "[${s}] ${u}" failed. ${h}`)),1}finally{p&&o.push(this.device.popErrorScope().then(h=>h?`GPU validation error for kernel "[${s}] ${u}": ${h.message}`:null));for(let h of this.temporaryData)this.gpuDataManager.release(h.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(t,r,o,n){let s=this.sessionExternalDataMapping.get(t);s||(s=new Map,this.sessionExternalDataMapping.set(t,s));let u=s.get(r),l=this.gpuDataManager.registerExternalBuffer(o,n,u?.[1]);return s.set(r,[l,o]),l}unregisterBuffers(t){let r=this.sessionExternalDataMapping.get(t);r&&(r.forEach(o=>this.gpuDataManager.unregisterExternalBuffer(o[1])),this.sessionExternalDataMapping.delete(t))}getBuffer(t){let r=this.gpuDataManager.get(t);if(!r)throw new Error(`no GPU data for buffer: ${t}`);return r.buffer}createDownloader(t,r,o){return async()=>{let n=await Ln(this,t,r);return va(n.buffer,o)}}writeTimestamp(t){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,t)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||this.env.wasm.trace)&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"))}captureBegin(){Re("info","captureBegin");let t=this.capturedCommandList.get(this.currentSessionId),r=this.capturedPendingKernels.get(this.currentSessionId);t||(t=[],this.capturedCommandList.set(this.currentSessionId,t),r=[],this.capturedPendingKernels.set(this.currentSessionId,r)),this.flush(),this.sessionStatus="capturing"}captureEnd(){Re("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){Re("info","replay"),this.sessionStatus="replaying";let t=this.capturedCommandList.get(this.currentSessionId),r=this.capturedPendingKernels.get(this.currentSessionId),o=t.length;this.pendingKernels=[];for(let n=0;n<o;n++){let s=this.getComputePassEncoder(),u=t[n];this.writeTimestamp(this.pendingDispatchNumber*2),s.setPipeline(u.computePipeline),s.setBindGroup(0,u.bindGroup),s.dispatchWorkgroups(...u.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(r[n]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onReleaseSession(t){this.unregisterBuffers(t),this.capturedCommandList.has(t)&&this.capturedCommandList.delete(t),this.capturedPendingKernels.has(t)&&this.capturedPendingKernels.delete(t),this.gpuDataManager.onReleaseSession(t)}onRunStart(t){this.currentSessionId=t,this.setQueryType()}}});var Ru={};xr(Ru,{init:()=>Xc});var Or,fo,Xc,Du=q(()=>{"use strict";We();ku();Pt();xe();Or=class e{constructor(t,r,o,n){this.module=t;this.dataType=r;this.data=o;this.dims=n}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let t=V.size(this.dims);return t===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let t=V.size(this.dims);return t===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let t=V.size(this.dims);return t===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}reshape(t){if(V.size(t)!==V.size(this.dims))throw new Error("Invalid new shape");return new e(this.module,this.dataType,this.data,t)}},fo=class{constructor(t,r,o){this.module=t;this.backend=r;this.customDataOffset=0;this.customDataSize=0;let n=t.HEAPU32,s=o>>>2;this.opKernelContext=n[s++];let u=n[s++];this.outputCount=n[s++],this.customDataOffset=n[s++],this.customDataSize=n[s++];let l=[];for(let a=0;a<u;a++){let p=n[s++],h=n[s++],g=n[s++],w=[];for(let v=0;v<g;v++)w.push(n[s++]);l.push(new Or(t,p,h,w))}this.inputs=l}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(t,r){let o=r?.inputs?.map(l=>typeof l=="number"?this.inputs[l]:l)??this.inputs,n=r?.outputs??[],s=(l,a,p)=>new Or(this.module,a,this.output(l,p),p),u=(l,a)=>{let p=Cr(l);if(!p)throw new Error(`Unsupported data type: ${l}`);let h=p*V.size(a);return new Or(this.module,l,this.backend.gpuDataManager.create(h).id,a)};return this.backend.run(t,o,n,s,u)}output(t,r){let o=this.module.stackSave();try{let n=this.module.stackAlloc((1+r.length)*4),s=n>>2;this.module.HEAPU32[s++]=r.length;for(let u=0;u<r.length;u++)this.module.HEAPU32[s++]=r[u];return this.module._JsepOutput(this.opKernelContext,t,n)}catch(n){throw new Error(`Failed to generate kernel\'s output[${t}] with dims [${r}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${n}`)}finally{this.module.stackRestore(o)}}},Xc=async(e,t,r)=>{let o=e.jsepInit;if(!o)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");let n=new yn;await n.initialize(t,r),o(n,s=>n.alloc(s),s=>n.free(s),(s,u,l,a=!1)=>{if(a)Re("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${s}, dst=${u}, size=${l}`),n.memcpy(s,u);else{Re("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${s}, gpuDataId=${u}, size=${l}`);let p=e.HEAPU8.subarray(s>>>0,(s>>>0)+l);n.upload(u,p)}},async(s,u,l)=>{Re("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${s}, dataOffset=${u}, size=${l}`),await n.download(s,()=>e.HEAPU8.subarray(u>>>0,(u>>>0)+l))},(s,u,l)=>n.createKernel(s,u,l,e.UTF8ToString(e._JsepGetNodeName(u))),s=>n.releaseKernel(s),(s,u,l,a)=>{Re("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${l}, kernel=${s}, contextDataOffset=${u}`);let p=new fo(e,n,u);return n.computeKernel(s,p,a)},()=>n.captureBegin(),()=>n.captureEnd(),()=>n.replay())}});var Yo;Yo=Vo();var pd=Ko(),Dn,Mn=!1,Fr=!1,jo=!1,md=e=>{if(e===1)return!1;if(typeof SharedArrayBuffer>"u")return typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+e+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),!1;typeof process<"u"&&process.versions&&process.versions.node&&console.warn("env.wasm.numThreads is set to "+e+", however, currently onnxruntime-web does not support multi-threads in Node.js. Please consider using onnxruntime-node for performance critical scenarios.");try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},fd=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},hd=(e,t)=>e?t?"ort-wasm-simd-threaded.wasm":"ort-wasm-simd.wasm":t?"ort-wasm-threaded.wasm":"ort-wasm.wasm",Zo=async e=>{if(Mn)return Promise.resolve();if(Fr)throw new Error("multiple calls to \'initializeWebAssembly()\' detected.");if(jo)throw new Error("previous call to \'initializeWebAssembly()\' failed.");Fr=!0;let t=e.initTimeout,r=e.numThreads,o=e.simd,n=md(r),s=o&&fd(),u=e.wasmPaths,l=typeof u=="string"?u:void 0,a=hd(s,n),p=typeof u=="object"?u[a]:void 0,h=!1,g=[];if(t>0&&g.push(new Promise(w=>{setTimeout(()=>{h=!0,w()},t)})),g.push(new Promise((w,v)=>{let y=n?pd:Yo,_={locateFile:(I,x)=>{if(n&&I.endsWith(".worker.js")&&typeof Blob<"u")return URL.createObjectURL(new Blob([qo()],{type:"text/javascript"}));if(I.endsWith(".wasm")){if(p)return p;let A=l??x;return a==="ort-wasm-simd.wasm"?A+"ort-wasm-simd.jsep.wasm":a==="ort-wasm-simd-threaded.wasm"?A+"ort-wasm-simd-threaded.jsep.wasm":A+a}return x+I}};if(n)if(_.numThreads=r,typeof Blob>"u")_.mainScriptUrlOrBlob=(void 0)(__dirname,"ort-wasm-threaded.js");else{let I=`var ortWasmThreaded=${y.toString()};`;_.mainScriptUrlOrBlob=new Blob([I],{type:"text/javascript"})}y(_).then(I=>{Fr=!1,Mn=!0,Dn=I,w()},I=>{Fr=!1,jo=!0,v(I)})})),await Promise.race(g),h)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},ze=()=>{if(Mn&&Dn)return Dn;throw new Error("WebAssembly is not initialized yet.")};var Ve=(e,t)=>{let r=ze(),o=r.lengthBytesUTF8(e)+1,n=r._malloc(o);return r.stringToUTF8(e,n,o),t.push(n),n},_r=(e,t,r,o)=>{if(typeof e=="object"&&e!==null){if(r.has(e))throw new Error("Circular reference in options");r.add(e)}Object.entries(e).forEach(([n,s])=>{let u=t?t+n:n;if(typeof s=="object")_r(s,u+".",r,o);else if(typeof s=="string"||typeof s=="number")o(u,s.toString());else if(typeof s=="boolean")o(u,s?"1":"0");else throw new Error(`Can\'t handle extra config type: ${typeof s}`)})},ke=e=>{let t=ze(),r=t.stackSave();try{let o=t.stackAlloc(8);t._OrtGetLastError(o,o+4);let n=t.HEAP32[o/4],s=t.HEAPU32[o/4+1],u=s?t.UTF8ToString(s):"";throw new Error(`${e} ERROR_CODE: ${n}, ERROR_MESSAGE: ${u}`)}finally{t.stackRestore(r)}};var Qo=e=>{let t=ze(),r=0,o=[],n=e||{};try{if(e?.logSeverityLevel===void 0)n.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if(e?.logVerbosityLevel===void 0)n.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);e?.terminate===void 0&&(n.terminate=!1);let s=0;return e?.tag!==void 0&&(s=Ve(e.tag,o)),r=t._OrtCreateRunOptions(n.logSeverityLevel,n.logVerbosityLevel,!!n.terminate,s),r===0&&ke("Can\'t create run options."),e?.extra!==void 0&&_r(e.extra,"",new WeakSet,(u,l)=>{let a=Ve(u,o),p=Ve(l,o);t._OrtAddRunConfigEntry(r,a,p)!==0&&ke(`Can\'t set a run config entry: ${u} - ${l}.`)}),[r,o]}catch(s){throw r!==0&&t._OrtReleaseRunOptions(r),o.forEach(u=>t._free(u)),s}};var gd=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},yd=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},bd=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(r=>(typeof r=="string"?r:r.name)==="webgpu")&&(e.enableMemPattern=!1)},wd=(e,t,r)=>{for(let o of t){let n=typeof o=="string"?o:o.name;switch(n){case"webnn":if(n="WEBNN",typeof o!="string"){let u=o;if(u?.deviceType){let l=Ve("deviceType",r),a=Ve(u.deviceType,r);ze()._OrtAddSessionConfigEntry(e,l,a)!==0&&ke(`Can\'t set a session config entry: \'deviceType\' - ${u.deviceType}.`)}if(u?.numThreads){let l=u.numThreads;(typeof l!="number"||!Number.isInteger(l)||l<0)&&(l=0);let a=Ve("numThreads",r),p=Ve(l.toString(),r);ze()._OrtAddSessionConfigEntry(e,a,p)!==0&&ke(`Can\'t set a session config entry: \'numThreads\' - ${u.numThreads}.`)}if(u?.powerPreference){let l=Ve("powerPreference",r),a=Ve(u.powerPreference,r);ze()._OrtAddSessionConfigEntry(e,l,a)!==0&&ke(`Can\'t set a session config entry: \'powerPreference\' - ${u.powerPreference}.`)}}break;case"webgpu":if(n="JS",typeof o!="string"){let u=o;if(u?.preferredLayout){if(u.preferredLayout!=="NCHW"&&u.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either \'NCHW\' or \'NHWC\': ${u.preferredLayout}`);let l=Ve("preferredLayout",r),a=Ve(u.preferredLayout,r);ze()._OrtAddSessionConfigEntry(e,l,a)!==0&&ke(`Can\'t set a session config entry: \'preferredLayout\' - ${u.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${n}`)}let s=Ve(n,r);ze()._OrtAppendExecutionProvider(e,s)!==0&&ke(`Can\'t append execution provider: ${n}.`)}},Jo=e=>{let t=ze(),r=0,o=[],n=e||{};bd(n);try{let s=gd(n.graphOptimizationLevel??"all"),u=yd(n.executionMode??"sequential"),l=typeof n.logId=="string"?Ve(n.logId,o):0,a=n.logSeverityLevel??2;if(!Number.isInteger(a)||a<0||a>4)throw new Error(`log serverity level is not valid: ${a}`);let p=n.logVerbosityLevel??0;if(!Number.isInteger(p)||p<0||p>4)throw new Error(`log verbosity level is not valid: ${p}`);let h=typeof n.optimizedModelFilePath=="string"?Ve(n.optimizedModelFilePath,o):0;if(r=t._OrtCreateSessionOptions(s,!!n.enableCpuMemArena,!!n.enableMemPattern,u,!!n.enableProfiling,0,l,a,p,h),r===0&&ke("Can\'t create session options."),n.executionProviders&&wd(r,n.executionProviders,o),n.enableGraphCapture!==void 0){if(typeof n.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${n.enableGraphCapture}`);let g=Ve("enableGraphCapture",o),w=Ve(n.enableGraphCapture.toString(),o);t._OrtAddSessionConfigEntry(r,g,w)!==0&&ke(`Can\'t set a session config entry: \'enableGraphCapture\' - ${n.enableGraphCapture}.`)}if(n.freeDimensionOverrides)for(let[g,w]of Object.entries(n.freeDimensionOverrides)){if(typeof g!="string")throw new Error(`free dimension override name must be a string: ${g}`);if(typeof w!="number"||!Number.isInteger(w)||w<0)throw new Error(`free dimension override value must be a non-negative integer: ${w}`);let v=Ve(g,o);t._OrtAddFreeDimensionOverride(r,v,w)!==0&&ke(`Can\'t set a free dimension override: ${g} - ${w}.`)}return n.extra!==void 0&&_r(n.extra,"",new WeakSet,(g,w)=>{let v=Ve(g,o),y=Ve(w,o);t._OrtAddSessionConfigEntry(r,v,y)!==0&&ke(`Can\'t set a session config entry: ${g} - ${w}.`)}),[r,o]}catch(s){throw r!==0&&t._OrtReleaseSessionOptions(r),o.forEach(u=>t._free(u)),s}};We();var ea=async e=>{if(typeof e=="string")if(typeof process<"u"&&process.versions&&process.versions.node)try{return new Uint8Array(await(void 0)(e))}catch(t){if(t.code==="ERR_FS_FILE_TOO_LARGE"){let r=(void 0)(e),o=[];for await(let n of r)o.push(n);return new Uint8Array(Buffer.concat(o))}throw t}else{let t=await fetch(e);if(!t.ok)throw new Error(`failed to load external data file: ${e}`);let r=t.headers.get("Content-Length"),o=r?parseInt(r,10):0;if(o<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let n=t.body.getReader(),s;try{s=new ArrayBuffer(o)}catch(l){if(l instanceof RangeError){let a=Math.ceil(o/65536);s=new WebAssembly.Memory({initial:a,maximum:a}).buffer}else throw l}let u=0;for(;;){let{done:l,value:a}=await n.read();if(l)break;let p=a.byteLength;new Uint8Array(s,u,p).set(a),u+=p}return new Uint8Array(s,0,o)}}else return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)};var ep=(e,t)=>{ze()._OrtInit(e,t)!==0&&ke("Can\'t initialize onnxruntime.")},Uu=async e=>{ep(e.wasm.numThreads,Ir(e.logLevel))},zu=async(e,t)=>{if(t==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let r=await navigator.gpu.requestAdapter();if(!r)throw new Error(\'Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.\');if(!e.wasm.simd)throw new Error("Not supported for WebGPU=ON and SIMD=OFF. Please set `env.wasm.simd` to true when using `webgpu` EP");let o=(Du(),Ot(Ru)).init;await o(ze(),e,r)}},Gt=new Map,tp=e=>{let t=ze(),r=t.stackSave();try{let o=t.stackAlloc(8);return t._OrtGetInputOutputCount(e,o,o+4)!==0&&ke("Can\'t get session input/output count."),[t.HEAP32[o/4],t.HEAP32[o/4+1]]}finally{t.stackRestore(r)}},ho=e=>{let t=ze(),r=t._malloc(e.byteLength);if(r===0)throw new Error(`Can\'t create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,r),[r,e.byteLength]},Vu=async(e,t)=>{let r,o,n=ze();Array.isArray(e)?[r,o]=e:e.buffer===n.HEAPU8.buffer?[r,o]=[e.byteOffset,e.byteLength]:[r,o]=ho(e);let s=0,u=0,l=0,a=[],p=[],h=[];try{if([u,a]=Jo(t),t?.externalData&&n.mountExternalData){let A=[];for(let O of t.externalData){let C=typeof O=="string"?O:O.path;A.push(ea(typeof O=="string"?O:O.data).then(M=>{n.mountExternalData(C,M)}))}await Promise.all(A)}s=n._OrtCreateSession(r,o,u),s===0&&ke("Can\'t create a session.");let[g,w]=tp(s),v=!!t?.enableGraphCapture,y=[],_=[],I=[];for(let A=0;A<g;A++){let O=n._OrtGetInputName(s,A);O===0&&ke("Can\'t get an input name."),p.push(O),y.push(n.UTF8ToString(O))}for(let A=0;A<w;A++){let O=n._OrtGetOutputName(s,A);O===0&&ke("Can\'t get an output name."),h.push(O);let C=n.UTF8ToString(O);_.push(C);{if(v&&t?.preferredOutputLocation===void 0){I.push("gpu-buffer");continue}let M=typeof t?.preferredOutputLocation=="string"?t.preferredOutputLocation:t?.preferredOutputLocation?.[C]??"cpu";if(M!=="cpu"&&M!=="cpu-pinned"&&M!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${M}.`);if(v&&M!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${M}. Only \'gpu-buffer\' location is supported when enableGraphCapture is true.`);I.push(M)}}let x=null;return I.some(A=>A==="gpu-buffer")&&(l=n._OrtCreateBinding(s),l===0&&ke("Can\'t create IO binding."),x={handle:l,outputPreferredLocations:I,outputPreferredLocationsEncoded:I.map(A=>zn(A))}),Gt.set(s,[s,p,h,x,v,!1]),[s,y,_]}catch(g){throw p.forEach(w=>n._OrtFree(w)),h.forEach(w=>n._OrtFree(w)),l!==0&&n._OrtReleaseBinding(l),s!==0&&n._OrtReleaseSession(s),g}finally{n._free(r),u!==0&&n._OrtReleaseSessionOptions(u),a.forEach(g=>n._free(g)),n.unmountExternalData?.()}},Nu=e=>{let t=ze(),r=Gt.get(e);if(!r)throw new Error(`cannot release session. invalid session id: ${e}`);let[o,n,s,u,l]=r;u&&(l&&t._OrtClearBoundOutputs(u.handle),t._OrtReleaseBinding(u.handle)),t.jsepOnReleaseSession?.(e),n.forEach(a=>t._OrtFree(a)),s.forEach(a=>t._OrtFree(a)),t._OrtReleaseSession(o),Gt.delete(e)},rp=(e,t,r)=>{if(e!==null&&e[0]===t){let n=e[2];if(n.length===r)return n}let o=Kr(t);return new o(r)},Mu=(e,t,r,o,n,s=!1)=>{if(!e){t.push(0);return}let u=ze(),l=e[0],a=e[1],p=e[3],h,g;if(l==="string"&&p==="gpu-buffer")throw new Error("String tensor is not supported on GPU.");if(s&&p!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${n} when enableGraphCapture is true.`);if(p==="gpu-buffer"){let y=e[2].gpuBuffer,_=Cr(Un(l));g=a.reduce((I,x)=>I*x,1)*_,h=u.jsepRegisterBuffer(o,n,y,g)}else{let y=e[2];if(Array.isArray(y)){g=4*y.length,h=u._malloc(g),r.push(h);let _=h/4;for(let I=0;I<y.length;I++){if(typeof y[I]!="string")throw new TypeError(`tensor data at index ${I} is not a string`);u.HEAPU32[_++]=Ve(y[I],r)}}else g=y.byteLength,h=u._malloc(g),r.push(h),u.HEAPU8.set(new Uint8Array(y.buffer,y.byteOffset,g),h)}let w=u.stackSave(),v=u.stackAlloc(4*a.length);try{let y=v/4;a.forEach(I=>u.HEAP32[y++]=I);let _=u._OrtCreateTensor(Un(l),h,g,v,a.length,zn(p));_===0&&ke(`Can\'t create tensor for input/output. session=${o}, index=${n}.`),t.push(_)}finally{u.stackRestore(w)}},Wu=e=>{let r=new TextEncoder().encode(e),o=ze(),n=o._malloc(r.byteLength);o.HEAPU8.set(r,n);let s=o._OrtConfigure(n,r.byteLength);if(s===0)throw new Error("Can\'t get an configure key");let u=o.UTF8ToString(s);return o._OrtFree(s),u},Gu=e=>{let r=new TextEncoder().encode(e),o=ze(),n=o._malloc(r.byteLength);o.HEAPU8.set(r,n);let s=o._OrtAuth(n,r.byteLength);if(s===0)throw new Error("Can\'t get an auth result");let u=o.UTF8ToString(s);return o._OrtFree(s),u},Hu=async(e,t,r,o,n,s)=>{let u=ze(),l=Gt.get(e);if(!l)throw new Error(`cannot run inference. invalid session id: ${e}`);let a=l[0],p=l[1],h=l[2],g=l[3],w=l[4],v=l[5],y=t.length,_=o.length,I=0,x=[],A=[],O=[],C=[],M=u.stackSave(),D=u.stackAlloc(y*4),G=u.stackAlloc(y*4),E=u.stackAlloc(_*4),W=u.stackAlloc(_*4);try{[I,x]=Qo(s);for(let re=0;re<y;re++)Mu(r[re],A,C,e,t[re],w);for(let re=0;re<_;re++){let Ie=n[re],Oe=Ie?.[3]??"";Mu(Oe==="gpu-buffer"?Ie:null,O,C,e,y+o[re],w)}let te=D/4,Y=G/4,Z=E/4,ee=W/4;for(let re=0;re<y;re++)u.HEAPU32[te++]=A[re],u.HEAPU32[Y++]=p[t[re]];for(let re=0;re<_;re++)u.HEAPU32[Z++]=O[re],u.HEAPU32[ee++]=h[o[re]];if(g&&!v){let{handle:re,outputPreferredLocations:Ie,outputPreferredLocationsEncoded:Oe}=g;if(p.length!==y)throw new Error(`input count from feeds (${y}) is expected to be always equal to model\'s input count (${p.length}).`);for(let ie=0;ie<y;ie++){let Se=t[ie];await u._OrtBindInput(re,p[Se],A[ie])!==0&&ke(`Can\'t bind input[${ie}] for session=${e}.`)}for(let ie=0;ie<_;ie++){let Se=o[ie];n[ie]?.[3]?u._OrtBindOutput(re,h[Se],O[ie],0)!==0&&ke(`Can\'t bind pre-allocated output[${ie}] for session=${e}.`):u._OrtBindOutput(re,h[Se],0,Oe[Se])!==0&&ke(`Can\'t bind output[${ie}] to ${Ie[ie]} for session=${e}.`)}Gt.set(e,[a,p,h,g,w,!0])}let Te;u.jsepOnRunStart?.(a),g?Te=await u._OrtRunWithBinding(a,g.handle,_,E,I):Te=await u._OrtRun(a,G,D,y,W,_,E,I),Te!==0&&ke("failed to call OrtRun().");let De=[];for(let re=0;re<_;re++){let Ie=u.HEAPU32[E/4+re];if(Ie===O[re]){De.push(n[re]);continue}let Oe=u.stackSave(),ie=u.stackAlloc(4*4),Se=!1,Ae,Pe=0;try{u._OrtGetTensorData(Ie,ie,ie+4,ie+8,ie+12)!==0&&ke(`Can\'t access output tensor data on index ${re}.`);let H=ie/4,J=u.HEAPU32[H++];Pe=u.HEAPU32[H++];let Ce=u.HEAPU32[H++],$t=u.HEAPU32[H++],Me=[];for(let Ne=0;Ne<$t;Ne++)Me.push(u.HEAPU32[Ce/4+Ne]);u._OrtFree(Ce);let tt=Me.reduce((Ne,je)=>Ne*je,1);Ae=nt(J);let at=g?.outputPreferredLocations[o[re]];if(Ae==="string"){if(at==="gpu-buffer")throw new Error("String tensor is not supported on GPU.");let Ne=[],je=Pe/4;for(let At=0;At<tt;At++){let lt=u.HEAPU32[je++],ct=At===tt-1?void 0:u.HEAPU32[je]-lt;Ne.push(u.UTF8ToString(lt,ct))}De.push([Ae,Me,Ne,"cpu"])}else if(at==="gpu-buffer"&&tt>0){let Ne=u.jsepGetBuffer(Pe),je=Cr(J);if(je===void 0||!Xo(Ae))throw new Error(`Unsupported data type: ${Ae}`);Se=!0,De.push([Ae,Me,{gpuBuffer:Ne,download:u.jsepCreateDownloader(Ne,tt*je,Ae),dispose:()=>{u._OrtReleaseTensor(Ie)}},"gpu-buffer"])}else{let Ne=rp(n[re],Ae,tt);new Uint8Array(Ne.buffer,Ne.byteOffset,Ne.byteLength).set(u.HEAPU8.subarray(Pe,Pe+Ne.byteLength)),De.push([Ae,Me,Ne,"cpu"])}}finally{u.stackRestore(Oe),Ae==="string"&&Pe&&u._free(Pe),Se||u._OrtReleaseTensor(Ie)}}return g&&!w&&(u._OrtClearBoundOutputs(g.handle),Gt.set(e,[a,p,h,g,w,!1])),De}finally{u.stackRestore(M),A.forEach(te=>u._OrtReleaseTensor(te)),O.forEach(te=>u._OrtReleaseTensor(te)),C.forEach(te=>u._free(te)),I!==0&&u._OrtReleaseRunOptions(I),x.forEach(te=>u._free(te))}},Lu=e=>{let t=ze(),r=Gt.get(e);if(!r)throw new Error("invalid session id");let o=r[0],n=t._OrtEndProfiling(o);n===0&&ke("Can\'t get an profile file name."),t._OrtFree(n)},go=e=>{let t=[];for(let r of e){let o=r[2];!Array.isArray(o)&&"buffer"in o&&t.push(o.buffer)}return t};self.onmessage=e=>{let{type:t,in:r}=e.data;try{switch(t){case"init-wasm":Zo(r.wasm).then(()=>{Uu(r).then(()=>{postMessage({type:t})},o=>{postMessage({type:t,err:o})})},o=>{postMessage({type:t,err:o})});break;case"init-ep":{let{epName:o,env:n}=r;zu(n,o).then(()=>{postMessage({type:t})},s=>{postMessage({type:t,err:s})});break}case"copy-from":{let{buffer:o}=r,n=ho(o);postMessage({type:t,out:n});break}case"create":{let{model:o,options:n}=r;Vu(o,n).then(s=>{postMessage({type:t,out:s})},s=>{postMessage({type:t,err:s})});break}case"release":Nu(r),postMessage({type:t});break;case"run":{let{sessionId:o,inputIndices:n,inputs:s,outputIndices:u,options:l}=r,a=e.data.prealloc??[];for(;a.length<u.length;)a.push(null);Hu(o,n,s,u,a,l).then(p=>{p.some(h=>h[3]!=="cpu")?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:p,inputsBack:s},go(p).concat(go(s)))},p=>{postMessage({type:t,err:p})});break}case"configure":try{let o=Wu(e.data.in);postMessage({type:"configure",out:o})}catch(o){postMessage({type:"configure",err:o})}break;case"auth":try{let o=Gu(e.data.in);postMessage({type:"auth",out:o})}catch(o){postMessage({type:"auth",err:o})}break;case"end-profiling":Lu(r),postMessage({type:t});break;default:}}catch(o){postMessage({type:t,err:o})}};})();\n/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n'})),tsvb_Dt,tsvb_ut,tsvb_Gr,tsvb_Nn,tsvb_Wn,tsvb_Ha,tsvb_Vn,tsvb_Vt,tsvb_Gt,tsvb_lm,tsvb_Un,tsvb_dm,tsvb_Pl,tsvb_Rl,tsvb_Dl,tsvb_Ml,tsvb_zl,tsvb_Ul,tsvb_Nl,tsvb_Wl,tsvb_Vl,tsvb_Fa=tsvb_q((()=>{tsvb_pt(),tsvb_kl(),tsvb_mr(),tsvb_Dt=()=>!!tsvb_Te.wasm.proxy&&typeof document<"u",tsvb_Gr=!1,tsvb_Nn=!1,tsvb_Wn=!1,tsvb_Vn=new Map,tsvb_Vt=(t,e)=>{let r=tsvb_Vn.get(t);r?r.push(e):tsvb_Vn.set(t,[e])},tsvb_Gt=()=>{if(tsvb_Gr||!tsvb_Nn||tsvb_Wn||!tsvb_ut)throw new Error("worker not ready")},tsvb_lm=t=>{switch(t.data.type){case"init-wasm":tsvb_Gr=!1,t.data.err?(tsvb_Wn=!0,tsvb_Ha[1](t.data.err)):(tsvb_Nn=!0,tsvb_Ha[0]());break;case"init-ep":case"copy-from":case"create":case"configure":case"auth":case"release":case"end-profiling":{let e=tsvb_Vn.get(t.data.type);t.data.err?e.shift()[1](t.data.err):e.shift()[0](t.data.out);break}case"run":{let e=tsvb_Vn.get(t.data.type);t.data.err?e.shift()[1](t.data.err):e.shift()[0](t.data.out.concat(t.data.inputsBack));break}}},tsvb_Un=typeof document<"u"?document?.currentScript?.src:void 0,tsvb_dm=t=>{let e=[];for(var r=0;r<t.length;++r){let n=t[r];null!==n&&e.push(n)}return e},tsvb_Pl=async()=>{if(!tsvb_Nn){if(tsvb_Gr)throw new Error("multiple calls to 'initWasm()' detected.");if(tsvb_Wn)throw new Error("previous call to 'initWasm()' failed.");if(tsvb_Gr=!0,tsvb_Dt())return void 0===tsvb_Te.wasm.wasmPaths&&tsvb_Un&&0!==tsvb_Un.indexOf("blob:")&&(tsvb_Te.wasm.wasmPaths=tsvb_Un.substr(0,+tsvb_Un.lastIndexOf("/")+1)),new Promise(((t,e)=>{tsvb_ut?.terminate();let r=URL.createObjectURL(new Blob([tsvb_Bl()],{type:"text/javascript"}));(tsvb_ut=new Worker(r,{name:"ort-wasm-proxy-worker"})).onerror=t=>e(t),tsvb_ut.onmessage=tsvb_lm,URL.revokeObjectURL(r),tsvb_Ha=[t,e];let n={type:"init-wasm",in:tsvb_Te};tsvb_ut.postMessage(n)}));try{await tsvb_Qi(tsvb_Te.wasm),await tsvb_xl(tsvb_Te),tsvb_Nn=!0}catch(t){throw tsvb_Wn=!0,t}finally{tsvb_Gr=!1}}},tsvb_Rl=async t=>{if(tsvb_Dt())return tsvb_Gt(),new Promise(((e,r)=>{tsvb_Vt("init-ep",[e,r]);let n={type:"init-ep",in:{epName:t,env:tsvb_Te}};tsvb_ut.postMessage(n)}));await tsvb_Sl(tsvb_Te,t)},tsvb_Dl=async t=>tsvb_Dt()?(tsvb_Gt(),new Promise(((e,r)=>{tsvb_Vt("copy-from",[e,r]);let n={type:"copy-from",in:{buffer:t}};tsvb_ut.postMessage(n,[t.buffer])}))):tsvb_Ga(t),tsvb_Ml=async(t,e)=>{if(tsvb_Dt()){if(e?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return tsvb_Gt(),new Promise(((r,n)=>{tsvb_Vt("create",[r,n]);let i={type:"create",in:{model:t,options:e}},s=[];t instanceof Uint8Array&&s.push(t.buffer),tsvb_ut.postMessage(i,s)}))}return tsvb_Il(t,e)},tsvb_zl=async t=>{if(tsvb_Dt())return tsvb_Gt(),new Promise(((e,r)=>{tsvb_Vt("release",[e,r]);let n={type:"release",in:t};tsvb_ut.postMessage(n)}));tsvb_Cl(t)},tsvb_Ul=async t=>tsvb_Dt()?(tsvb_Gt(),new Promise(((e,r)=>{tsvb_Vt("configure",[e,r]);let n={type:"configure",in:t};tsvb_ut.postMessage(n)}))):tsvb_Al(t),tsvb_Nl=async t=>tsvb_Dt()?(tsvb_Gt(),new Promise(((e,r)=>{tsvb_Vt("auth",[e,r]);let n={type:"auth",in:t};tsvb_ut.postMessage(n)}))):tsvb_Tl(t),tsvb_Wl=async(t,e,r,n,i,s)=>{if(tsvb_Dt()){if(r.some((t=>"cpu"!==t[3])))throw new Error("input tensor on GPU is not supported for proxy.");return tsvb_Gt(),new Promise(((o,a)=>{tsvb_Vt("run",[o,a]);let u=r,l={type:"run",in:{sessionId:t,inputIndices:e,inputs:u,outputIndices:n,options:s},prealloc:i};tsvb_ut.postMessage(l,tsvb_La(u).concat(tsvb_La(tsvb_dm(i))))}))}return tsvb_El(t,e,r,n,i,s).then((t=>t.concat(r)))},tsvb_Vl=async t=>{if(tsvb_Dt())return tsvb_Gt(),new Promise(((e,r)=>{tsvb_Vt("end-profiling",[e,r]);let n={type:"end-profiling",in:t};tsvb_ut.postMessage(n)}));tsvb_Ol(t)}})),tsvb_Gl,tsvb_Ll,tsvb_Gn,tsvb_Hl=tsvb_q((()=>{tsvb_pt(),tsvb_Fa(),tsvb_Ve(),tsvb_ha(),tsvb_Gl=(t,e)=>{switch(t.location){case"cpu":return[t.type,t.dims,t.data,"cpu"];case"gpu-buffer":return[t.type,t.dims,{gpuBuffer:t.gpuBuffer},"gpu-buffer"];default:throw new Error(`invalid data location: ${t.location} for ${e()}`)}},tsvb_Ll=t=>{switch(t[3]){case"cpu":return new tsvb_Xe(t[0],t[2],t[1]);case"gpu-buffer":{let e=t[0];if(!tsvb_gn(e))throw new Error(`not supported data type: ${e} for deserializing GPU tensor`);let{gpuBuffer:r,download:n,dispose:i}=t[2];return tsvb_Xe.fromGpuBuffer(r,{dataType:e,dims:t[1],download:n,dispose:i})}default:throw new Error(`invalid data location: ${t[3]}`)}},tsvb_Gn=class{async fetchModelAndCopyToWasmMemory(t){return tsvb_Dl(await tsvb_zr(t))}async loadModel(t,e){let r;tsvb_lt(),r="string"==typeof t?typeof tsvb_process<"u"&&tsvb_process.versions&&tsvb_process.versions.node?await tsvb_zr(t):await this.fetchModelAndCopyToWasmMemory(t):t,[this.sessionId,this.inputNames,this.outputNames]=await tsvb_Ml(r,e),tsvb_dt()}async dispose(){return tsvb_zl(this.sessionId)}async configure(t){return tsvb_Ul(t)}async auth(t){return tsvb_Nl(t)}async run(t,e,r){tsvb_lt();let n=[],i=[];Object.entries(t).forEach((t=>{let e=t[0],r=t[1],s=this.inputNames.indexOf(e);if(-1===s)throw new Error(`invalid input '${e}'`);n.push(r),i.push(s)}));let s=[],o=[],a=t=>null!==t&&"gpu-buffer"===t.location?t:null;Object.entries(e).forEach((t=>{let e=t[0],r=t[1],n=this.outputNames.indexOf(e);if(-1===n)throw new Error(`invalid output '${e}'`);s.push(r),o.push(n)}));let u=n.map(((t,e)=>tsvb_Gl(t,(()=>`input "${this.inputNames[i[e]]}"`)))),l=s.map(((t,e)=>t?tsvb_Gl(t,(()=>`output "${this.outputNames[o[e]]}"`)):null)),c=await tsvb_Wl(this.sessionId,i,u,o,l,r),h={},f=[];for(let t=0;t<c.length;t++)t>=o.length?f.push(tsvb_Ll(c[t])):h[this.outputNames[o[t]]]=a(s[t])??tsvb_Ll(c[t]);return f.length>0&&(h.inputBack=f[0]),tsvb_dt(),h}startProfiling(){}endProfiling(){tsvb_Vl(this.sessionId)}}})),tsvb_cm,tsvb_Ln,tsvb_Fl=tsvb_q((()=>{tsvb_pt(),tsvb_Fa(),tsvb_Hl(),tsvb_cm=()=>{if(("number"!=typeof tsvb_Te.wasm.initTimeout||tsvb_Te.wasm.initTimeout<0)&&(tsvb_Te.wasm.initTimeout=0),"boolean"!=typeof tsvb_Te.wasm.simd&&(tsvb_Te.wasm.simd=!0),"boolean"!=typeof tsvb_Te.wasm.proxy&&(tsvb_Te.wasm.proxy=!1),"boolean"!=typeof tsvb_Te.wasm.trace&&(tsvb_Te.wasm.trace=!1),"number"!=typeof tsvb_Te.wasm.numThreads||!Number.isInteger(tsvb_Te.wasm.numThreads)||tsvb_Te.wasm.numThreads<=0){(typeof self<"u"&&!self.crossOriginIsolated||typeof tsvb_process<"u"&&tsvb_process.versions&&tsvb_process.versions.node)&&(tsvb_Te.wasm.numThreads=1);let t=typeof navigator>"u"?(void 0)().length:navigator.hardwareConcurrency;tsvb_Te.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},tsvb_Ln=class{async init(t){tsvb_cm(),await tsvb_Pl(),await tsvb_Rl(t)}async createInferenceSessionHandler(t,e){let r=new tsvb_Gn;return await r.loadModel(t,e),Promise.resolve(r)}}})),tsvb_ql={};tsvb_Kt(tsvb_ql,{wasmBackend:()=>tsvb_pm});var tsvb_pm,tsvb_jl=tsvb_q((()=>{tsvb_Fl(),tsvb_pm=new tsvb_Ln}));tsvb_pt(),tsvb_pt(),tsvb_pt();var tsvb_Mi="1.17.0",tsvb_iv=null,tsvb_isWebGPUSupported;{let t=(tsvb_jl(),tsvb_Rt(tsvb_ql)).wasmBackend;tsvb_pr("webgpu",t,5),tsvb_pr("cpu",t,10),tsvb_pr("wasm",t,10)}function tsvb_gpu_typeof(t){return tsvb_gpu_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_gpu_typeof(t)}function tsvb_gpu_regeneratorRuntime(){tsvb_gpu_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_gpu_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_gpu_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_gpu_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_gpu_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_gpu_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_gpu_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function src_tsvb_isWebGPUSupported(){return tsvb_isWebGPUSupported2.apply(this,arguments)}function tsvb_isWebGPUSupported2(){return tsvb_isWebGPUSupported2=tsvb_gpu_asyncToGenerator(tsvb_gpu_regeneratorRuntime().mark((function t(){var e,r=arguments;return tsvb_gpu_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=r.length>0&&void 0!==r[0]?r[0]:{},void 0===tsvb_isWebGPUSupported){t.next=3;break}return t.abrupt("return",tsvb_isWebGPUSupported);case 3:return t.next=5,tsvb_gpu_asyncToGenerator(tsvb_gpu_regeneratorRuntime().mark((function t(){var r;return tsvb_gpu_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(navigator.gpu){t.next=3;break}return t.abrupt("return",!1);case 3:return t.prev=3,t.next=6,navigator.gpu.requestAdapter(e);case 6:return r=t.sent,t.next=9,r.requestDevice();case 9:return t.abrupt("return",!0);case 12:return t.prev=12,t.t0=t.catch(3),t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,null,[[3,12]])})))();case 5:return tsvb_isWebGPUSupported=t.sent,t.abrupt("return",tsvb_isWebGPUSupported);case 7:case"end":return t.stop()}}),t)}))),tsvb_isWebGPUSupported2.apply(this,arguments)}function tsvb_loader_typeof(t){return tsvb_loader_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_loader_typeof(t)}function tsvb_loader_regeneratorRuntime(){tsvb_loader_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_loader_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_loader_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_loader_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_loader_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_loader_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_loader_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_loader_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_loader_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_loader_toPropertyKey(n.key),n)}}function tsvb_loader_createClass(t,e,r){return e&&tsvb_loader_defineProperties(t.prototype,e),r&&tsvb_loader_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_loader_toPropertyKey(t){var e=tsvb_loader_toPrimitive(t,"string");return"symbol"==tsvb_loader_typeof(e)?e:e+""}function tsvb_loader_toPrimitive(t,e){if("object"!=tsvb_loader_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_loader_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}Object.defineProperty(tsvb_Te.versions,"web",{value:tsvb_Mi,enumerable:!0});var tsvb_loader_Loader=function(){return tsvb_loader_createClass((function t(){tsvb_loader_classCallCheck(this,t),this._name="tsvb"}),[{key:"get",value:(e=tsvb_loader_asyncToGenerator(tsvb_loader_regeneratorRuntime().mark((function t(e,r){var n,i;return tsvb_loader_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._cache){t.next=4;break}return t.next=3,caches.open(this._name);case 3:this._cache=t.sent;case 4:return t.next=6,this._cache.match(e);case 6:if(void 0===(n=t.sent)){t.next=9;break}return t.abrupt("return",n);case 9:return t.next=11,fetch(e);case 11:if((n=t.sent).ok){t.next=15;break}return tsvb_errorBus.bv.notify({message:"".concat(e," don't found"),emitter:tsvb_errorBus.JK.ML_INFERENCE}),t.abrupt("return",n);case 15:if(!r){t.next=20;break}return i=n.clone(),t.next=19,this._cache.put(e,n);case 19:return t.abrupt("return",i);case 20:return t.abrupt("return",n);case 21:case"end":return t.stop()}}),t,this)}))),function(t,r){return e.apply(this,arguments)})},{key:"delete",value:(t=tsvb_loader_asyncToGenerator(tsvb_loader_regeneratorRuntime().mark((function t(){return tsvb_loader_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,caches.delete(this._name);case 2:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})}]);var t,e}(),tsvb_src_settings=__webpack_require__(8380),tsvb_axios=__webpack_require__(2505),tsvb_axios_default=__webpack_require__.n(tsvb_axios),tsvb_user_uid=__webpack_require__(2004),tsvb_ModelType,ModelType;function tsvb_sessionManager_typeof(t){return tsvb_sessionManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_sessionManager_typeof(t)}function tsvb_slicedToArray(t,e){return tsvb_arrayWithHoles(t)||tsvb_iterableToArrayLimit(t,e)||src_tsvb_unsupportedIterableToArray(t,e)||tsvb_nonIterableRest()}function tsvb_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function src_tsvb_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return src_tsvb_arrayLikeToArray(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?src_tsvb_arrayLikeToArray(t,e):void 0}}function src_tsvb_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function tsvb_iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,s,o,a=[],u=!0,l=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=s.call(r)).done)&&(a.push(n.value),a.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function tsvb_arrayWithHoles(t){if(Array.isArray(t))return t}function tsvb_sessionManager_regeneratorRuntime(){tsvb_sessionManager_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_sessionManager_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_sessionManager_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_sessionManager_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_sessionManager_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_sessionManager_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_sessionManager_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_sessionManager_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_sessionManager_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_sessionManager_toPropertyKey(n.key),n)}}function tsvb_sessionManager_createClass(t,e,r){return e&&tsvb_sessionManager_defineProperties(t.prototype,e),r&&tsvb_sessionManager_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_sessionManager_toPropertyKey(t){var e=tsvb_sessionManager_toPrimitive(t,"string");return"symbol"==tsvb_sessionManager_typeof(e)?e:e+""}function tsvb_sessionManager_toPrimitive(t,e){if("object"!=tsvb_sessionManager_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_sessionManager_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}ModelType=tsvb_ModelType||(tsvb_ModelType={}),ModelType.SEGMENTATION="segmentation",ModelType.FACEDETECTOR="facedetector",ModelType.COLORCORRECTOR="colorcorrector",ModelType.LOWLIGHTER="lowlighter";var tsvb_CustomInferenceSessionManager=function(){return tsvb_sessionManager_createClass((function t(){tsvb_sessionManager_classCallCheck(this,t),this.inference=null,this.ready=!1,this.preset="balanced",this.isGPU=!1}),[{key:"getSession",value:function(t){return t==tsvb_ModelType.SEGMENTATION?this.inference:null}},{key:"onAuth",value:function(){}},{key:"setPresetManager",value:function(t){this.presetManager=t}},{key:"preload",value:(r=tsvb_sessionManager_asyncToGenerator(tsvb_sessionManager_regeneratorRuntime().mark((function t(e){return tsvb_sessionManager_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(t){return r.apply(this,arguments)})},{key:"cache",value:(e=tsvb_sessionManager_asyncToGenerator(tsvb_sessionManager_regeneratorRuntime().mark((function t(e,r){return tsvb_sessionManager_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(t,r){return e.apply(this,arguments)})},{key:"getType",value:function(){return"custom"}},{key:"setPreset",value:function(t){this.preset=t}},{key:"setBackend",value:function(t){this.inference=t}},{key:"init",value:(t=tsvb_sessionManager_asyncToGenerator(tsvb_sessionManager_regeneratorRuntime().mark((function t(e){var r,n,i,s;return tsvb_sessionManager_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.inference.setPreset(this.preset);case 3:return t.next=5,this.inference.configure(e);case 5:return n=t.sent,t.next=8,tsvb_sdkAuth(n,e);case 8:return i=t.sent,t.next=11,this.inference.auth(i.data.key);case 11:if(s=t.sent,"active"==JSON.parse(s).status){t.next=15;break}throw new Error("Authentication failed");case 15:this.ready=!0,tsvb_errorBus.bv.notify({message:"custom ".concat(this.preset),type:tsvb_errorBus.By.INFO,emitter:tsvb_errorBus.JK.ML_INFERENCE}),t.next=23;break;case 19:throw t.prev=19,t.t0=t.catch(0),tsvb_errorBus.bv.notify({message:null!==(r=t.t0.message)&&void 0!==r?r:t.t0,emitter:tsvb_errorBus.JK.ML_INFERENCE,cause:t.t0}),t.t0;case 23:case"end":return t.stop()}}),t,this,[[0,19]])}))),function(e){return t.apply(this,arguments)})},{key:"isReady",value:function(t){return this.ready}}]);var t,e,r}(),tsvb_OnnxInferenceSessionManager=function(){return tsvb_sessionManager_createClass((function t(){tsvb_sessionManager_classCallCheck(this,t),this.sessions=new Map,this.sessionPromises=new Map,this._loader=new tsvb_loader_Loader,this._sequentialExecutor=new tsvb_SequentialExecutor,this._cached=!1,this._preloaded=!1,this.sessionIdIncrement=0,this._preset=tsvb_src_settings.yy.PRESET,this._segmentationModel=tsvb_src_settings.yy.getModelUrl(tsvb_src_settings.yy.PRESETS[tsvb_src_settings.yy.PRESET])}),[{key:"isReady",value:function(t){return!!this.getSession(t)}},{key:"setBackend",value:function(t){}},{key:"setPresetManager",value:function(t){this.presetManager=t}},{key:"getSession",value:function(t){var e=this.getModel(t);return this.sessions.has(e)?this.sessions.get(e):(tsvb_errorBus.bv.notify({message:"ML inference for ".concat(t," model is not initialized"),emitter:tsvb_errorBus.JK.ML_INFERENCE}),null)}},{key:"onAuth",value:function(t){var e="function"==typeof t;this.authFunction=e?t:void 0}},{key:"cache",value:(i=tsvb_sessionManager_asyncToGenerator(tsvb_sessionManager_regeneratorRuntime().mark((function t(){var e,r,n,i,s,o=arguments;return tsvb_sessionManager_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=o.length>1&&void 0!==o[1]&&o[1],!(o.length>0&&void 0!==o[0]&&o[0])){t.next=6;break}return t.next=5,this._loader.delete();case 5:return t.abrupt("return");case 6:if(!this._cached){t.next=8;break}return t.abrupt("return");case 8:for(this._cached=!0,r=0,n=Object.entries(tsvb_src_settings.yy.MODELS);r<n.length;r++)i=tsvb_slicedToArray(n[r],2),s=i[0],""!==i[1]&&this._loader.get(this.getModel(s),!0);e||(this.setPreset(this._preset),this._loader.get(this.getModel(tsvb_ModelType.SEGMENTATION),!0));case 11:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"preload",value:(n=tsvb_sessionManager_asyncToGenerator(tsvb_sessionManager_regeneratorRuntime().mark((function t(){var e,r,n,i,s,o=arguments;return tsvb_sessionManager_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=o.length>0&&void 0!==o[0]&&o[0],!this._preloaded){t.next=3;break}return t.abrupt("return");case 3:this._preloaded=!0,r=0,n=Object.entries(tsvb_src_settings.yy.MODELS);case 5:if(!(r<n.length)){t.next=13;break}if(i=tsvb_slicedToArray(n[r],2),s=i[0],""===i[1]){t.next=10;break}return t.next=10,this.init(tsvb_src_settings.yy.CUSTOMER_ID,s);case 10:r++,t.next=5;break;case 13:if(e){t.next=17;break}return this.setPreset(this._preset),t.next=17,this.init(tsvb_src_settings.yy.CUSTOMER_ID,tsvb_ModelType.SEGMENTATION);case 17:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"getModel",value:function(t){return t==tsvb_ModelType.SEGMENTATION?this.presetManager?this.presetManager.getModelURL(this._preset):this._segmentationModel:tsvb_src_settings.yy.getModelUrl(tsvb_src_settings.yy.MODELS[t])}},{key:"setPreset",value:function(t){this._preset=t,this.presetManager?this._segmentationModel=this.presetManager.getModelURL(this._preset):this._segmentationModel=tsvb_src_settings.yy.getModelUrl(tsvb_src_settings.yy.PRESETS[tsvb_src_settings.yy.PRESET])}},{key:"init",value:(r=tsvb_sessionManager_asyncToGenerator(tsvb_sessionManager_regeneratorRuntime().mark((function t(e,r){var n,i,s,o,a,u,l,c,h,f=this;return tsvb_sessionManager_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=[],this.sessionPromises.forEach((function(t,e,r){"pending"==t.state&&i.push(t.promise)})),s=this.getModel(r),!this.sessionPromises.has(s)){t.next=5;break}return t.abrupt("return",null===(n=this.sessionPromises.get(s))||void 0===n?void 0:n.promise);case 5:return o=new tsvb_Deferred,this.sessionPromises.set(s,o),t.next=9,this._loader.get(s);case 9:return a=t.sent,t.next=12,a.arrayBuffer();case 12:return u=t.sent,t.next=15,Promise.all(i);case 15:if(tsvb_ort_min.wV,l="wasm",r!=tsvb_ModelType.SEGMENTATION){t.next=23;break}if("webgpu"!=tsvb_src_settings.yy.PROVIDER&&"auto"!=tsvb_src_settings.yy.PROVIDER){t.next=23;break}return t.next=21,src_tsvb_isWebGPUSupported();case 21:t.sent?l="webgpu":tsvb_errorBus.bv.notify({message:"WebGPU is not supported",emitter:tsvb_errorBus.JK.ML_INFERENCE});case 23:return c="webgpu"==l?this.createGPUSession(u):this.createCPUSession(u),t.abrupt("return",c.then((function(t){return(h=t).configure(e)})).then((function(t){if("extension"!==tsvb_src_settings.yy.APP_ENV)return tsvb_sdkAuth(t,tsvb_src_settings.yy.CUSTOMER_ID);if("function"!=typeof f.authFunction)throw"Can't find auth function";var e=tsvb_src_settings.yy.API_URL+tsvb_src_settings.yy.CUSTOMER_ID,r=tsvb_user_uid.W.getInstance().getUID(tsvb_src_settings.yy.CUSTOMER_ID);return f.authFunction(e,{user_id:r,payload:t})})).then((function(t){var e;return h.auth(null!==(e=t.key)&&void 0!==e?e:t.data.key)})).then((function(t){if("active"!==JSON.parse(t).status)throw new Error("Authentication failed");var e="webgpu"==l;f.sessions.set(s,{session:h,isGPU:e,id:++f.sessionIdIncrement,gpuDevice:e?f.gpuDevice:void 0}),o.resolve(),tsvb_errorBus.bv.notify({message:"init ".concat(r),type:tsvb_errorBus.By.INFO,emitter:tsvb_errorBus.JK.ML_INFERENCE})})).catch((function(t){var e;throw tsvb_errorBus.bv.notify({message:null!==(e=t.message)&&void 0!==e?e:t,emitter:tsvb_errorBus.JK.ML_INFERENCE,cause:t}),t})));case 25:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"createCPUSession",value:(e=tsvb_sessionManager_asyncToGenerator(tsvb_sessionManager_regeneratorRuntime().mark((function t(e){var r;return tsvb_sessionManager_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={executionProviders:["wasm"],enableCpuMemArena:!0,enableMemPattern:!0,executionMode:"parallel",graphOptimizationLevel:"all",extra:{session:{set_denormal_as_zero:"1",disable_prepacking:"1",dynamic_block_base:"4"},optimization:{enable_gelu_approximation:"1"}}},tsvb_ort_min._K.wasm.numThreads=1,tsvb_src_settings.yy.PROXY&&(tsvb_ort_min._K.wasm.proxy=!0),Object.keys(tsvb_src_settings.yy.WASM_PATHS).length&&(tsvb_ort_min._K.wasm.wasmPaths=tsvb_src_settings.yy.WASM_PATHS),t.abrupt("return",tsvb_ort_min.wV.create(e,r));case 5:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})},{key:"createGPUSession",value:(t=tsvb_sessionManager_asyncToGenerator(tsvb_sessionManager_regeneratorRuntime().mark((function t(e){var r,n,i,s,o,a,u,l,c=this;return tsvb_sessionManager_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r={executionProviders:["webgpu"],enableGraphCapture:!0},tsvb_Te.wasm.numThreads=1,tsvb_src_settings.yy.PROXY&&(tsvb_Te.wasm.proxy=!1),Object.keys(tsvb_src_settings.yy.WASM_PATHS).length){for(n=[],i=0,s=Object.entries(tsvb_src_settings.yy.WASM_PATHS);i<s.length;i++)o=tsvb_slicedToArray(s[i],2),a=o[0],u=o[1],n[a]=u.replace(".wasm",".jsep.wasm");l=Object.assign({},n),tsvb_Te.wasm.wasmPaths=l}return t.abrupt("return",tsvb_ld.create(e,r).then((function(t){return c.gpuDevice=tsvb_Te.webgpu.device,c.gpuDevice.lost.then((function(t){tsvb_errorBus.bv.notify({message:"GPU adapter was lost: ".concat(t.message,", reason: ").concat(t.reason),code:tsvb_errorBus.O4.GPU_DEVICE_LOST,type:tsvb_errorBus.By.ERROR,emitter:tsvb_errorBus.JK.SESSION_MANAGER})})),tsvb_Te.webgpu.device.adapterInfo&&tsvb_errorBus.bv.notify({message:"GPU adapter info: ".concat(tsvb_Te.webgpu.device.adapterInfo.vendor," - ").concat(tsvb_Te.webgpu.device.adapterInfo.architecture),type:tsvb_errorBus.By.INFO,emitter:tsvb_errorBus.JK.SESSION_MANAGER}),t})));case 5:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]);var t,e,r,n,i}();function tsvb_sdkAuth(t,e){return src_tsvb_sdkAuth.apply(this,arguments)}function src_tsvb_sdkAuth(){return(src_tsvb_sdkAuth=tsvb_sessionManager_asyncToGenerator(tsvb_sessionManager_regeneratorRuntime().mark((function t(e,r){return tsvb_sessionManager_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",tsvb_axios_default().post(tsvb_src_settings.yy.API_URL+r,{user_id:tsvb_user_uid.W.getInstance().getUID(r),payload:e},{headers:{"Tsvb-Version":tsvb_src_settings.yy.VERSION}}).catch((function(t){throw new Error(t.response.data.message)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function tsvb_sessionRunner_typeof(t){return tsvb_sessionRunner_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_sessionRunner_typeof(t)}function tsvb_sessionRunner_slicedToArray(t,e){return tsvb_sessionRunner_arrayWithHoles(t)||tsvb_sessionRunner_iterableToArrayLimit(t,e)||tsvb_sessionRunner_unsupportedIterableToArray(t,e)||tsvb_sessionRunner_nonIterableRest()}function tsvb_sessionRunner_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tsvb_sessionRunner_iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,s,o,a=[],u=!0,l=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=s.call(r)).done)&&(a.push(n.value),a.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function tsvb_sessionRunner_arrayWithHoles(t){if(Array.isArray(t))return t}function tsvb_sessionRunner_regeneratorRuntime(){tsvb_sessionRunner_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_sessionRunner_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_sessionRunner_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_createForOfIteratorHelper(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=tsvb_sessionRunner_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function tsvb_sessionRunner_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return tsvb_sessionRunner_arrayLikeToArray(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tsvb_sessionRunner_arrayLikeToArray(t,e):void 0}}function tsvb_sessionRunner_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function tsvb_sessionRunner_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_sessionRunner_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_sessionRunner_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_sessionRunner_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_sessionRunner_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_sessionRunner_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_sessionRunner_toPropertyKey(n.key),n)}}function tsvb_sessionRunner_createClass(t,e,r){return e&&tsvb_sessionRunner_defineProperties(t.prototype,e),r&&tsvb_sessionRunner_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_sessionRunner_toPropertyKey(t){var e=tsvb_sessionRunner_toPrimitive(t,"string");return"symbol"==tsvb_sessionRunner_typeof(e)?e:e+""}function tsvb_sessionRunner_toPrimitive(t,e){if("object"!=tsvb_sessionRunner_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_sessionRunner_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_dimensions={segmentation:4,facedetector:3,colorcorrector:3,lowlighter:3};function tsvb_calculateByteSize(t){return 4*t.reduce((function(t,e){return t*e}),1)}function tsvb_wrapTensor(t,e,r){return r?tsvb_wrapGPUTensor(t,e):tsvb_wrapCPUTensor(t,e)}function tsvb_wrapCPUTensor(t,e){if(t instanceof Float32Array)return new tsvb_ort_min.qY("float32",t,e);throw TypeError("Unsupported tensor data type, currently CPU session only supports Float32Array")}function tsvb_wrapGPUTensor(t,e){if(t instanceof GPUBuffer)return tsvb_Xe.fromGpuBuffer(t,{dataType:"float32",dims:e});if(t instanceof Float32Array)return new tsvb_Xe("float32",t,e);throw TypeError("Unsupported tensor data type, currently WebGPU session only supports Float32Array or GPUBuffer")}var tsvb_CPUSessionRunner=function(){return tsvb_sessionRunner_createClass((function t(){tsvb_sessionRunner_classCallCheck(this,t),this._executor=new tsvb_SequentialExecutor}),[{key:"run",value:(t=tsvb_sessionRunner_asyncToGenerator(tsvb_sessionRunner_regeneratorRuntime().mark((function t(e,r,n,i,s,o){var a,u,l,c,h,f,d;return tsvb_sessionRunner_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=tsvb_wrapTensor(r,[1,tsvb_dimensions[s],i,n],!1),!o){t.next=15;break}l={},c=tsvb_createForOfIteratorHelper(e.session.outputNames);try{for(c.s();!(h=c.n()).done;)f=h.value,d=o[f],l[f]=tsvb_wrapTensor(d.data,d.dims,!1)}catch(t){c.e(t)}finally{c.f()}return t.prev=5,t.next=8,e.session.run({input:u},l);case 8:a=t.sent,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),tsvb_errorBus.bv.notify({message:"Session run error: ".concat(t.t0,", session: ").concat(e," with prealloc ").concat(l),cause:t.t0,emitter:tsvb_errorBus.JK.SESSION_RUNNER});case 14:return t.abrupt("return",a);case 15:return t.prev=15,t.next=18,e.session.run({input:u});case 18:a=t.sent,t.next=24;break;case 21:t.prev=21,t.t1=t.catch(15),tsvb_errorBus.bv.notify({message:"Session run error: ".concat(t.t1,", session: ").concat(e),cause:t.t1,emitter:tsvb_errorBus.JK.SESSION_RUNNER});case 24:return t.abrupt("return",a);case 25:case"end":return t.stop()}}),t,null,[[5,11],[15,21]])}))),function(e,r,n,i,s,o){return t.apply(this,arguments)})}]);var t}(),tsvb_GPUSessionRunner=function(){return tsvb_sessionRunner_createClass((function t(){tsvb_sessionRunner_classCallCheck(this,t),this._executor=new tsvb_SequentialExecutor,this.bindings=new Map}),[{key:"run",value:(t=tsvb_sessionRunner_asyncToGenerator(tsvb_sessionRunner_regeneratorRuntime().mark((function t(e,r,n,i,s,o){var a,u,l,c,h,f,d,p,v,y,b,_,m,g,w,x,T,S;return tsvb_sessionRunner_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o){t.next=2;break}throw Error("Graph replay inference can not work without preallocs");case 2:u=[1,tsvb_dimensions[s],i,n],l=this.obtainedPreallocOutput(e.session,o),c=tsvb_sessionRunner_slicedToArray(l,2),h=c[0],f=c[1],d=this.provideGPUBindings(e.gpuDevice,e.id,tsvb_calculateByteSize(u),tsvb_calculateByteSize(f.dims)),this.toInputBuffer(e.gpuDevice,r,d.inputGPUBuffer),(p={})[h]={data:d.outputGPUBuffer,dims:f.dims},v=tsvb_wrapTensor(d.inputGPUBuffer,[1,tsvb_dimensions[s],i,n],!0),y={},b=tsvb_createForOfIteratorHelper(e.session.outputNames);try{for(b.s();!(_=b.n()).done;)m=_.value,g=p[m],y[m]=tsvb_wrapTensor(g.data,g.dims,!0)}catch(t){b.e(t)}finally{b.f()}return t.prev=12,t.next=15,e.session.run({input:v},y);case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(12),tsvb_errorBus.bv.notify({message:"Session run error: ".concat(t.t0,", session: ").concat(e," with prealloc ").concat(y),cause:t.t0,emitter:tsvb_errorBus.JK.SESSION_RUNNER});case 20:return(w=e.gpuDevice.createCommandEncoder()).copyBufferToBuffer(d.outputGPUBuffer,0,d.outputTransferGPUBuffer,0,d.outputTransferGPUBuffer.size),x=w.finish(),null===(a=e.gpuDevice)||void 0===a||a.queue.submit([x]),t.next=26,d.outputTransferGPUBuffer.mapAsync(GPUMapMode.READ);case 26:try{T=new Float32Array(d.outputTransferGPUBuffer.getMappedRange()),f.data.set(T)}finally{d.outputTransferGPUBuffer.unmap()}return(S={inputBack:r})[h]=f.data,t.abrupt("return",S);case 30:case"end":return t.stop()}}),t,this,[[12,17]])}))),function(e,r,n,i,s,o){return t.apply(this,arguments)})},{key:"obtainedPreallocOutput",value:function(t,e){var r=t.outputNames;if(r.length>1)throw Error("Graph replay wrapper does not support multiples outputs. TODO: Add multiple outputs support");return[r[0],e[r[0]]]}},{key:"provideGPUBindings",value:function(t,e,r,n){var i=this.bindings.get(e);if(!i){var s=this.allocateBindings(t,r,n);return this.bindings.set(e,s),s}if(!(i.inputGPUBuffer.size===r&&i.outputGPUBuffer.size===n))throw Error("onnxruntime session can not change input|output when replay mode is enabled");return i}},{key:"allocateBindings",value:function(t,e,r){return{inputGPUBuffer:t.createBuffer({size:e,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),outputGPUBuffer:t.createBuffer({size:r,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),outputTransferGPUBuffer:t.createBuffer({size:r,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST})}}},{key:"toInputBuffer",value:function(t,e,r){if(!(e instanceof Float32Array))throw TypeError("Currently only Float32Array is supported");t.queue.writeBuffer(r,0,e.buffer,0,r.size)}}]);var t}();function tsvb_ml_inference_typeof(t){return tsvb_ml_inference_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_ml_inference_typeof(t)}function tsvb_ml_inference_regeneratorRuntime(){tsvb_ml_inference_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_ml_inference_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_ml_inference_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_ml_inference_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_ml_inference_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_ml_inference_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_ml_inference_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_ml_inference_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_ml_inference_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_ml_inference_toPropertyKey(n.key),n)}}function tsvb_ml_inference_createClass(t,e,r){return e&&tsvb_ml_inference_defineProperties(t.prototype,e),r&&tsvb_ml_inference_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_ml_inference_toPropertyKey(t){var e=tsvb_ml_inference_toPrimitive(t,"string");return"symbol"==tsvb_ml_inference_typeof(e)?e:e+""}function tsvb_ml_inference_toPrimitive(t,e){if("object"!=tsvb_ml_inference_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_ml_inference_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_CustomMLInference=function(){return tsvb_ml_inference_createClass((function t(){tsvb_ml_inference_classCallCheck(this,t),this.sessionManager=new tsvb_CustomInferenceSessionManager,this.cpuExecutor=new tsvb_SequentialExecutor,this.inferenceId=Math.floor(1e4*Math.random())}),[{key:"isReady",value:function(t){return this.sessionManager.isReady(t)}},{key:"getType",value:function(){return"custom"}},{key:"isGPU",value:function(t){return!1}},{key:"run",value:(t=tsvb_ml_inference_asyncToGenerator(tsvb_ml_inference_regeneratorRuntime().mark((function t(e,r,n,i,s){var o,a;return tsvb_ml_inference_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=this.sessionManager.getSession(tsvb_ModelType.SEGMENTATION)){t.next=4;break}return tsvb_errorBus.bv.notify({message:"ML inference for ".concat(i," model is not initialized"),emitter:tsvb_errorBus.JK.ML_INFERENCE}),t.abrupt("return",[]);case 4:return t.prev=4,t.next=7,this.cpuExecutor.enqueue((function(){return a.run(e)}));case 7:o=t.sent,t.next=13;break;case 10:t.prev=10,t.t0=t.catch(4),tsvb_errorBus.bv.notify({message:"Native session run error: ".concat(t.t0),cause:t.t0,emitter:tsvb_errorBus.JK.ML_INFERENCE});case 13:return t.abrupt("return",{seg:{data:o},inputBack:{data:e}});case 14:case"end":return t.stop()}}),t,this,[[4,10]])}))),function(e,r,n,i,s){return t.apply(this,arguments)})}]);var t}(),tsvb_ONNXMLInference=function(){return tsvb_ml_inference_createClass((function t(){tsvb_ml_inference_classCallCheck(this,t),this.sessionManager=new tsvb_OnnxInferenceSessionManager,this.cpuExecutor=new tsvb_SequentialExecutor,this.gpuExecutor=new tsvb_SequentialExecutor,this.cpuRunner=new tsvb_CPUSessionRunner,this.gpuRunner=new tsvb_GPUSessionRunner,this.inferenceId=Math.floor(1e4*Math.random())}),[{key:"getType",value:function(){return"onnx"}},{key:"isReady",value:function(t){return this.sessionManager.isReady(t)}},{key:"isGPU",value:function(t){var e=this.sessionManager.getSession(t);return!!e&&e.isGPU}},{key:"run",value:(t=tsvb_ml_inference_asyncToGenerator(tsvb_ml_inference_regeneratorRuntime().mark((function t(e,r,n,i,s){var o,a=this;return tsvb_ml_inference_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=this.sessionManager.getSession(i)){t.next=4;break}return tsvb_errorBus.bv.notify({message:"ML inference for ".concat(i," model is not initialized"),emitter:tsvb_errorBus.JK.ML_INFERENCE}),t.abrupt("return",[]);case 4:if(!o.isGPU){t.next=10;break}return t.next=7,this.gpuExecutor.enqueue((function(){return a.gpuRunner.run(o,e,r,n,i,s)}));case 7:case 12:return t.abrupt("return",t.sent);case 10:return t.next=12,this.cpuExecutor.enqueue((function(){return a.cpuRunner.run(o,e,r,n,i,s)}));case 13:case"end":return t.stop()}}),t,this)}))),function(e,r,n,i,s){return t.apply(this,arguments)})}]);var t}(),tsvb_inferenceMap={onnx:tsvb_ONNXMLInference,custom:tsvb_CustomMLInference},tsvb_MLInferenceFactory=function(){function t(){tsvb_ml_inference_classCallCheck(this,t)}return tsvb_ml_inference_createClass(t,null,[{key:"getInference",value:function(e){return t.inferences.has(e)||t.inferences.set(e,new tsvb_inferenceMap[e]),t.inferences.get(e)}}])}();function tsvb_metricsHelper_typeof(t){return tsvb_metricsHelper_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_metricsHelper_typeof(t)}function tsvb_metricsHelper_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_metricsHelper_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_metricsHelper_toPropertyKey(n.key),n)}}function tsvb_metricsHelper_createClass(t,e,r){return e&&tsvb_metricsHelper_defineProperties(t.prototype,e),r&&tsvb_metricsHelper_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_metricsHelper_toPropertyKey(t){var e=tsvb_metricsHelper_toPrimitive(t,"string");return"symbol"==tsvb_metricsHelper_typeof(e)?e:e+""}function tsvb_metricsHelper_toPrimitive(t,e){if("object"!=tsvb_metricsHelper_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_metricsHelper_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}tsvb_MLInferenceFactory.inferences=new Map;var tsvb_MetricsHelper=function(){return tsvb_metricsHelper_createClass((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;tsvb_metricsHelper_classCallCheck(this,t),this.sdkOptions=r,this.container=new src_tsvb_Container,this.background=new tsvb_Sprite(tsvb_Texture_Texture.WHITE),this.background.tint=0,e.background&&(this.background.tint=e.background);var n={fontFamily:"Arial",fontSize:e.size?e.size:24,fill:e.color?e.color:16777215,align:"left"};this.text=new src_tsvb_Text("",n);var i=e.padding?e.padding:7;this.text.x=i,this.text.y=i,this.container.addChild(this.background),this.container.addChild(this.text),this.container.visible=!1,this.sdkOptions.on("update",this.onOptionsUpdate,this)}),[{key:"onOptionsUpdate",value:function(){this.text.style.fontSize=Math.round(.02*this.sdkOptions.width)}},{key:"updateText",value:function(t){this.text.text=t;var e=this.text.getLocalBounds();this.background.width=2*this.text.x+e.width,this.background.height=2*this.text.y+e.height}},{key:"destroy",value:function(){this.sdkOptions.off("update",this.onOptionsUpdate,this)}}])}();const tsvb_yuvShader="precision mediump float;\nuniform sampler2D uSampler;\nin vec2 vTextureCoord;\nuniform vec4 filterArea;\nlayout(location = 0) out vec4 outColor;\n\nuniform sampler2D u_Texture;\nuniform float u_Offset;\nuniform vec2 u_ImgSize;\n//Y =  0.299R + 0.587G + 0.114B\n//U = -0.147R - 0.289G + 0.436B\n//V =  0.615R - 0.515G - 0.100B\nconst vec3 COEF_Y = vec3(0.2126, 0.7152, 0.0722);\nconst vec3 COEF_U = vec3(-0.1146, -0.3854, 0.5);\nconst vec3 COEF_V = vec3(0.5, -0.4542, -0.0458);\nconst float U_DIVIDE_LINE = 2.0 / 3.0;\nconst float V_DIVIDE_LINE = 5.0 / 6.0;\n\nvoid main() {\n  vec2 texelOffset = vec2(u_Offset, 0.0);\n  //outColor = vec4(vTextureCoord.y, vTextureCoord.y, vTextureCoord.y, vTextureCoord.y);\n\n  if (vTextureCoord.y <= U_DIVIDE_LINE) {\n    vec2 texCoord = vec2(vTextureCoord.x, vTextureCoord.y * 3.0 / 2.0);\n    vec4 color0 = texture(u_Texture, texCoord);\n    vec4 color1 = texture(u_Texture, texCoord + texelOffset);\n    vec4 color2 = texture(u_Texture, texCoord + texelOffset * 2.0);\n    vec4 color3 = texture(u_Texture, texCoord + texelOffset * 3.0);\n\n    float y0 = dot(color0.rgb, COEF_Y);\n    float y1 = dot(color1.rgb, COEF_Y);\n    float y2 = dot(color2.rgb, COEF_Y);\n    float y3 = dot(color3.rgb, COEF_Y);\n    outColor = vec4(y0, y1, y2, y3);\n  } else if (vTextureCoord.y <= V_DIVIDE_LINE) {\n    float offsetY = 1.0 / 3.0 / u_ImgSize.y;\n    vec2 texCoord;\n    if (vTextureCoord.x <= 0.5) {\n      texCoord = vec2(vTextureCoord.x * 2.0, (vTextureCoord.y - U_DIVIDE_LINE) * 2.0 * 3.0);\n    } else {\n      texCoord = vec2(\n        (vTextureCoord.x - 0.5) * 2.0,\n        ((vTextureCoord.y - U_DIVIDE_LINE) * 2.0 + offsetY) * 3.0\n      );\n    }\n\n    vec4 color0 = texture(u_Texture, texCoord);\n    vec4 color1 = texture(u_Texture, texCoord + texelOffset * 2.0);\n    vec4 color2 = texture(u_Texture, texCoord + texelOffset * 4.0);\n    vec4 color3 = texture(u_Texture, texCoord + texelOffset * 6.0);\n\n    float u0 = dot(color0.rgb, COEF_U) + 0.5;\n    float u1 = dot(color1.rgb, COEF_U) + 0.5;\n    float u2 = dot(color2.rgb, COEF_U) + 0.5;\n    float u3 = dot(color3.rgb, COEF_U) + 0.5;\n    outColor = vec4(u0, u1, u2, u3);\n  } else {\n    float offsetY = 1.0 / 3.0 / u_ImgSize.y;\n    vec2 texCoord;\n    if (vTextureCoord.x <= 0.5) {\n      texCoord = vec2(vTextureCoord.x * 2.0, (vTextureCoord.y - V_DIVIDE_LINE) * 2.0 * 3.0);\n    } else {\n      texCoord = vec2(\n        (vTextureCoord.x - 0.5) * 2.0,\n        ((vTextureCoord.y - V_DIVIDE_LINE) * 2.0 + offsetY) * 3.0\n      );\n    }\n\n    vec4 color0 = texture(u_Texture, texCoord);\n    vec4 color1 = texture(u_Texture, texCoord + texelOffset * 2.0);\n    vec4 color2 = texture(u_Texture, texCoord + texelOffset * 4.0);\n    vec4 color3 = texture(u_Texture, texCoord + texelOffset * 6.0);\n\n    float v0 = dot(color0.rgb, COEF_V) + 0.5;\n    float v1 = dot(color1.rgb, COEF_V) + 0.5;\n    float v2 = dot(color2.rgb, COEF_V) + 0.5;\n    float v3 = dot(color3.rgb, COEF_V) + 0.5;\n    outColor = vec4(v0, v1, v2, v3);\n  }\n}\n",tsvb_yuv_yuvShader="in vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nout vec2 vVertexPosition;\nout vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition(void ) {\n  vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.0)) + outputFrame.xy;\n\n  return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord(void ) {\n  return aVertexPosition; // * (outputFrame.zw);\n}\n\nvoid main(void ) {\n  gl_Position = filterVertexPosition();\n  vTextureCoord = filterTextureCoord();\n}\n";function tsvb_filterYUV_typeof(t){return tsvb_filterYUV_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_filterYUV_typeof(t)}function tsvb_filterYUV_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_filterYUV_toPropertyKey(n.key),n)}}function tsvb_filterYUV_createClass(t,e,r){return e&&tsvb_filterYUV_defineProperties(t.prototype,e),r&&tsvb_filterYUV_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_filterYUV_toPropertyKey(t){var e=tsvb_filterYUV_toPrimitive(t,"string");return"symbol"==tsvb_filterYUV_typeof(e)?e:e+""}function tsvb_filterYUV_toPrimitive(t,e){if("object"!=tsvb_filterYUV_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_filterYUV_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_filterYUV_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_filterYUV_callSuper(t,e,r){return e=tsvb_filterYUV_getPrototypeOf(e),tsvb_filterYUV_possibleConstructorReturn(t,tsvb_filterYUV_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_filterYUV_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_filterYUV_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_filterYUV_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_filterYUV_assertThisInitialized(t)}function tsvb_filterYUV_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_filterYUV_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_filterYUV_isNativeReflectConstruct=function(){return!!t})()}function tsvb_filterYUV_getPrototypeOf(t){return tsvb_filterYUV_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_filterYUV_getPrototypeOf(t)}function tsvb_filterYUV_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_filterYUV_setPrototypeOf(t,e)}function tsvb_filterYUV_setPrototypeOf(t,e){return tsvb_filterYUV_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_filterYUV_setPrototypeOf(t,e)}var tsvb_FilterYUV=function(t){function e(t){var r;return tsvb_filterYUV_classCallCheck(this,e),(r=tsvb_filterYUV_callSuper(this,e,[tsvb_yuv_yuvShader,tsvb_yuvShader,t.uniforms])).program.fragmentSrc.includes("#version 300 es")||(r.program.fragmentSrc="#version 300 es \n"+r.program.fragmentSrc),r.program.vertexSrc.includes("#version 300 es")||(r.program.vertexSrc="#version 300 es \n"+r.program.vertexSrc),r}return tsvb_filterYUV_inherits(e,src_tsvb_Filter),tsvb_filterYUV_createClass(e)}();function tsvb_converterYUV_typeof(t){return tsvb_converterYUV_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_converterYUV_typeof(t)}function tsvb_converterYUV_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_converterYUV_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_converterYUV_toPropertyKey(n.key),n)}}function tsvb_converterYUV_createClass(t,e,r){return e&&tsvb_converterYUV_defineProperties(t.prototype,e),r&&tsvb_converterYUV_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_converterYUV_toPropertyKey(t){var e=tsvb_converterYUV_toPrimitive(t,"string");return"symbol"==tsvb_converterYUV_typeof(e)?e:e+""}function tsvb_converterYUV_toPrimitive(t,e){if("object"!=tsvb_converterYUV_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_converterYUV_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_ConverterYUV=function(){return tsvb_converterYUV_createClass((function t(e,r){tsvb_converterYUV_classCallCheck(this,t),this.sdkOptions=r;var n=this.sdkOptions.width,i=this.sdkOptions.height;this.renderer=e,this.widthYUV=n/4,this.heightYUV=3*i/2,this.textureYUV=tsvb_RenderTexture.create({width:this.widthYUV,height:this.heightYUV}),this.textureRBG=tsvb_RenderTexture.create({width:n,height:i}),this.spriteYUV=new tsvb_Sprite(this.textureYUV),this.filterYUV=new tsvb_FilterYUV({uniforms:{u_Offset:1/n,u_ImgSize:[n,i],u_Texture:this.textureRBG}}),this.spriteYUV.filters=[this.filterYUV],this.sdkOptions.on("update",this.onOptionsUpdate,this)}),[{key:"onOptionsUpdate",value:function(){var t=this.sdkOptions.width,e=this.sdkOptions.height;this.widthYUV=t/4,this.heightYUV=3*e/2,this.textureYUV.resize(this.widthYUV,this.heightYUV),this.textureRBG.resize(t,e),this.filterYUV.uniforms.u_Offset=1/t,this.filterYUV.uniforms.u_ImgSize=[t,e]}},{key:"getVideoFrameArray",value:function(){var t=new Uint8Array(4*this.widthYUV*this.heightYUV),e=this.renderer.generateTexture(this.spriteYUV);this.renderer.renderTexture.bind(e);var r=e.framebuffer.glFramebuffers[this.renderer.CONTEXT_UID];r.blitFramebuffer&&this.renderer.framebuffer.bind(r.blitFramebuffer);var n=this.renderer.gl;return n.readPixels(0,0,this.widthYUV,this.heightYUV,n.RGBA,n.UNSIGNED_BYTE,t),e.destroy(!0),t}},{key:"getVideoFrameSettings",value:function(){return{format:"I420",codedWidth:this.sdkOptions.width,codedHeight:this.sdkOptions.height}}},{key:"destroy",value:function(){this.sdkOptions.off("update",this.onOptionsUpdate,this)}}])}();function tsvb_gl_helper_typeof(t){return tsvb_gl_helper_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_gl_helper_typeof(t)}function tsvb_gl_helper_regeneratorRuntime(){tsvb_gl_helper_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_gl_helper_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_gl_helper_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_gl_helper_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_gl_helper_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_gl_helper_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_gl_helper_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_gl_helper_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_gl_helper_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_gl_helper_toPropertyKey(n.key),n)}}function tsvb_gl_helper_createClass(t,e,r){return e&&tsvb_gl_helper_defineProperties(t.prototype,e),r&&tsvb_gl_helper_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_gl_helper_toPropertyKey(t){var e=tsvb_gl_helper_toPrimitive(t,"string");return"symbol"==tsvb_gl_helper_typeof(e)?e:e+""}function tsvb_gl_helper_toPrimitive(t,e){if("object"!=tsvb_gl_helper_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_gl_helper_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_GLHelper=function(){return tsvb_gl_helper_createClass((function t(){tsvb_gl_helper_classCallCheck(this,t)}),[{key:"clientWaitAsync",value:function(t,e,r,n){return new Promise((function(i,s){!function o(){var a=t.clientWaitSync(e,r,0);a!==t.WAIT_FAILED?a!==t.TIMEOUT_EXPIRED?i(!0):tsvb_worker_timers_setTimeout(o,n):s()}()}))}},{key:"getBufferSubDataAsync",value:(e=tsvb_gl_helper_asyncToGenerator(tsvb_gl_helper_regeneratorRuntime().mark((function t(e,r,n,i,s,o,a){var u;return tsvb_gl_helper_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0),e.flush(),t.next=4,this.clientWaitAsync(e,u,0,4);case 4:e.deleteSync(u),e.bindBuffer(r,n),e.getBufferSubData(r,i,s,o,a),e.bindBuffer(r,null);case 8:case"end":return t.stop()}}),t,this)}))),function(t,r,n,i,s,o,a){return e.apply(this,arguments)})},{key:"readPixelsAsync",value:(t=tsvb_gl_helper_asyncToGenerator(tsvb_gl_helper_regeneratorRuntime().mark((function t(e,r,n,i,s,o,a,u){var l;return tsvb_gl_helper_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=e.createBuffer(),t.prev=1,e.bindBuffer(e.PIXEL_PACK_BUFFER,l),e.bufferData(e.PIXEL_PACK_BUFFER,u.byteLength,e.STREAM_READ),e.readPixels(r,n,i,s,o,a,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),t.next=8,this.getBufferSubDataAsync(e,e.PIXEL_PACK_BUFFER,l,0,u);case 8:return t.abrupt("return",u);case 9:return t.prev=9,e.deleteBuffer(l),t.finish(9);case 12:case"end":return t.stop()}}),t,this,[[1,,9,12]])}))),function(e,r,n,i,s,o,a,u){return t.apply(this,arguments)})}]);var t,e}();const tsvb_GLSL_TO_SINGLE_SETTERS={vec3(t,e,r,n){(r[0]!==n[0]||r[1]!==n[1]||r[2]!==n[2])&&(r[0]=n[0],r[1]=n[1],r[2]=n[2],t.uniform3f(e,n[0],n[1],n[2]))},int(t,e,r,n){t.uniform1i(e,n)},ivec2(t,e,r,n){t.uniform2i(e,n[0],n[1])},ivec3(t,e,r,n){t.uniform3i(e,n[0],n[1],n[2])},ivec4(t,e,r,n){t.uniform4i(e,n[0],n[1],n[2],n[3])},uint(t,e,r,n){t.uniform1ui(e,n)},uvec2(t,e,r,n){t.uniform2ui(e,n[0],n[1])},uvec3(t,e,r,n){t.uniform3ui(e,n[0],n[1],n[2])},uvec4(t,e,r,n){t.uniform4ui(e,n[0],n[1],n[2],n[3])},bvec2(t,e,r,n){t.uniform2i(e,n[0],n[1])},bvec3(t,e,r,n){t.uniform3i(e,n[0],n[1],n[2])},bvec4(t,e,r,n){t.uniform4i(e,n[0],n[1],n[2],n[3])},mat2(t,e,r,n){t.uniformMatrix2fv(e,!1,n)},mat4(t,e,r,n){t.uniformMatrix4fv(e,!1,n)}},tsvb_syncUniforms_GLSL_TO_ARRAY_SETTERS={float(t,e,r,n){t.uniform1fv(e,n)},vec2(t,e,r,n){t.uniform2fv(e,n)},vec3(t,e,r,n){t.uniform3fv(e,n)},vec4(t,e,r,n){t.uniform4fv(e,n)},int(t,e,r,n){t.uniform1iv(e,n)},ivec2(t,e,r,n){t.uniform2iv(e,n)},ivec3(t,e,r,n){t.uniform3iv(e,n)},ivec4(t,e,r,n){t.uniform4iv(e,n)},uint(t,e,r,n){t.uniform1uiv(e,n)},uvec2(t,e,r,n){t.uniform2uiv(e,n)},uvec3(t,e,r,n){t.uniform3uiv(e,n)},uvec4(t,e,r,n){t.uniform4uiv(e,n)},bool(t,e,r,n){t.uniform1iv(e,n)},bvec2(t,e,r,n){t.uniform2iv(e,n)},bvec3(t,e,r,n){t.uniform3iv(e,n)},bvec4(t,e,r,n){t.uniform4iv(e,n)},sampler2D(t,e,r,n){t.uniform1iv(e,n)},samplerCube(t,e,r,n){t.uniform1iv(e,n)},sampler2DArray(t,e,r,n){t.uniform1iv(e,n)}};function tsvb_syncUniforms(t,e,r,n,i){let s=0,o=null,a=null;const u=i.gl;for(const l in t.uniforms){const c=e[l],h=n[l],f=r[l],d=t.uniforms[l];c?"float"!==c.type||1!==c.size||c.isArray?"bool"!==c.type||1!==c.size||c.isArray?"sampler2D"!==c.type&&"samplerCube"!==c.type&&"sampler2DArray"!==c.type||1!==c.size||c.isArray?"mat3"!==c.type||1!==c.size||c.isArray?"vec2"!==c.type||1!==c.size||c.isArray?"vec4"!==c.type||1!==c.size||c.isArray?(1!==c.size||c.isArray?tsvb_syncUniforms_GLSL_TO_ARRAY_SETTERS:tsvb_GLSL_TO_SINGLE_SETTERS)[c.type].call(null,u,f.location,f.value,h):void 0!==d.width?(a=f.value,o=h,(a[0]!==o.x||a[1]!==o.y||a[2]!==o.width||a[3]!==o.height)&&(a[0]=o.x,a[1]=o.y,a[2]=o.width,a[3]=o.height,u.uniform4f(f.location,o.x,o.y,o.width,o.height))):(a=f.value,o=h,(a[0]!==o[0]||a[1]!==o[1]||a[2]!==o[2]||a[3]!==o[3])&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],u.uniform4f(f.location,o[0],o[1],o[2],o[3]))):void 0!==d.x?(a=f.value,o=h,(a[0]!==o.x||a[1]!==o.y)&&(a[0]=o.x,a[1]=o.y,u.uniform2f(f.location,o.x,o.y))):(a=f.value,o=h,(a[0]!==o[0]||a[1]!==o[1])&&(a[0]=o[0],a[1]=o[1],u.uniform2f(f.location,o[0],o[1]))):void 0!==d.a?u.uniformMatrix3fv(f.location,!1,h.toArray(!0)):u.uniformMatrix3fv(f.location,!1,h):(i.texture.bind(h,s),f.value!==s&&(f.value=s,u.uniform1i(f.location,s)),s++):h!==f.value&&(f.value=h,u.uniform1i(f.location,Number(h))):h!==f.value&&(f.value=h,u.uniform1f(f.location,h)):!0===d.group&&i.shader.syncUniformGroup(h)}}function tsvb_install(t){utils.deprecation("7.1.0","install() has been deprecated, @pixi/unsafe-eval is self-installed since 7.1.0")}function tsvb_selfInstall(){Object.assign(tsvb_ShaderSystem.prototype,{systemCheck(){},syncUniforms(t,e){const{shader:r,renderer:n}=this;tsvb_syncUniforms(t,r.program.uniformData,e.uniformData,t.uniforms,n)}})}function tsvb_renderer_typeof(t){return tsvb_renderer_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_renderer_typeof(t)}function tsvb_renderer_regeneratorRuntime(){tsvb_renderer_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_renderer_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_renderer_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_renderer_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_renderer_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_renderer_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_renderer_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_renderer_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_renderer_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_renderer_toPropertyKey(n.key),n)}}function tsvb_renderer_createClass(t,e,r){return e&&tsvb_renderer_defineProperties(t.prototype,e),r&&tsvb_renderer_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_renderer_toPropertyKey(t){var e=tsvb_renderer_toPrimitive(t,"string");return"symbol"==tsvb_renderer_typeof(e)?e:e+""}function tsvb_renderer_toPrimitive(t,e){if("object"!=tsvb_renderer_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_renderer_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}tsvb_selfInstall();var tsvb_renderer_Renderer=function(){return tsvb_renderer_createClass((function t(e,r){var n;tsvb_renderer_classCallCheck(this,t),this.color=65280,this.frameFormat="RGBX",r&&(this.frameFormat=r),this.sdkOptions=e,this.PIXI=tsvb_pixi_js_lib_namespaceObject;try{this.renderer=new src_tsvb_Application({width:this.sdkOptions.width,height:this.sdkOptions.height,antialias:!0,backgroundAlpha:0})}catch(t){tsvb_errorBus.bv.notify({type:tsvb_errorBus.By.ERROR,code:tsvb_errorBus.O4.APP_CREATION_ISSUE,message:null!==(n=t.message)&&void 0!==n?n:t,emitter:tsvb_errorBus.JK.RENDERER,cause:t})}this.filter_manager=new tsvb_FilterSystem(this.renderer.renderer),this.timinngs={stats:new tsvb_FrameStatistics,sprite:new tsvb_MetricsHelper({size:Math.round(.02*this.sdkOptions.width),padding:5},this.sdkOptions)},this.effectsContainer=new src_tsvb_Container,this.renderer.stage.addChild(this.effectsContainer),this.overlayContainer=new src_tsvb_Container,this.renderer.stage.addChild(this.overlayContainer),this.stopTickers(),this.GLHelper=new tsvb_GLHelper,"I420"===this.frameFormat&&(this.converterYUV=new tsvb_ConverterYUV(this.renderer.renderer,this.sdkOptions)),this.sdkOptions.on("update",this.onOptionsUpdate,this)}),[{key:"onOptionsUpdate",value:function(){this.renderer.renderer.resize(this.sdkOptions.width,this.sdkOptions.height)}},{key:"stopTickers",value:function(){this.renderer.ticker.stop(),src_tsvb_Ticker.system.stop()}},{key:"startTickers",value:function(){this.renderer.ticker.start(),src_tsvb_Ticker.system.start()}},{key:"updateVideoFrame",value:function(t){this.video_frame||(this.video_frame=this.createFrom(t)),this.video_frame.texture.destroy(!0),this.video_frame.texture=tsvb_Texture_Texture.from(t)}},{key:"addStatistics",value:function(){this.addToStage(this.timinngs.sprite.container)}},{key:"removeStatistics",value:function(){this.removeFromStage(this.timinngs.sprite.container)}},{key:"updateStatistics",value:function(t,e){this.timinngs.stats.updateStats(t,e)}},{key:"hideStatistics",value:function(){this.timinngs.sprite.container.visible=!1}},{key:"drawStatistics",value:function(){this.timinngs.sprite.updateText(this.timinngs.stats.getText()),this.timinngs.sprite.container.visible=!0}},{key:"destroy",value:function(){this.renderer.renderer&&(this.sdkOptions.off("update",this.onOptionsUpdate,this),this.converterYUV&&this.converterYUV.destroy(),this.timinngs.sprite&&this.timinngs.sprite.destroy(),this.renderer.destroy(!0,{children:!0,texture:!0,baseTexture:!0}))}},{key:"renderTo",value:function(t,e){var r,n;try{(null===(r=this.renderer)||void 0===r?void 0:r.renderer)&&this.renderer.renderer.render(t,{renderTexture:e})}catch(t){tsvb_errorBus.bv.notify({message:null!==(n=t.message)&&void 0!==n?n:t,emitter:tsvb_errorBus.JK.RENDERER,cause:t})}}},{key:"createCanvas",value:function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,r}},{key:"createTextureFromBuffer",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return tsvb_Texture_Texture.fromBuffer(t,e,r,n)}},{key:"createRenderTexture",value:function(t,e){return tsvb_RenderTexture.create({width:t,height:e})}},{key:"pixels",value:function(t){return this.renderer.renderer.extract.pixels(t)}},{key:"pixelsAsync",value:(t=tsvb_renderer_asyncToGenerator(tsvb_renderer_regeneratorRuntime().mark((function t(e,r){var n,i,s,o,a,u,l;return tsvb_renderer_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=4*e._frame.width*e._frame.height,a=null!==(i=null===(n=null==r?void 0:r.pool)||void 0===n?void 0:n.getBuffer("u8",o))&&void 0!==i?i:new Uint8Array(o),u=null===(s=this.renderer)||void 0===s?void 0:s.renderer){t.next=5;break}return t.abrupt("return",a);case 5:return u.renderTexture.bind(e),(l=e.framebuffer.glFramebuffers[u.CONTEXT_UID]).blitFramebuffer&&u.framebuffer.bind(l.blitFramebuffer),t.prev=8,t.next=11,this.GLHelper.readPixelsAsync(u.gl,0,0,e._frame.width,e._frame.height,u.gl.RGBA,u.gl.UNSIGNED_BYTE,a);case 11:return t.prev=11,t.abrupt("return",a);case 14:case"end":return t.stop()}}),t,this,[[8,,11,14]])}))),function(e,r){return t.apply(this,arguments)})},{key:"calculateSpriteMatrix",value:function(t){var e=new tsvb_Matrix;return this.filter_manager.calculateSpriteMatrix(e,t)}},{key:"getFilterManager",value:function(){return this.filter_manager}},{key:"setTintColor",value:function(t){this.color=t}},{key:"getTintColor",value:function(){return this.color}},{key:"createTexture",value:function(t){return t instanceof tsvb_Texture_Texture?t:tsvb_Texture_Texture.from(t)}},{key:"createFromTexture",value:function(t){return new tsvb_Sprite(t)}},{key:"createFrom",value:function(t){return new tsvb_Sprite(tsvb_Texture_Texture.from(t))}},{key:"createFromURL",value:function(t){var e;return"string"==typeof t&&"color"===t?((e=new tsvb_Sprite(tsvb_Texture_Texture.WHITE)).tint=this.getTintColor(),e.width=this.sdkOptions.width,e.height=this.sdkOptions.height,e):e=tsvb_Sprite.from(t)}},{key:"createContainer",value:function(){return new src_tsvb_Container}},{key:"addToStage",value:function(t){var e;null===(e=this.renderer.stage)||void 0===e||e.addChild(t)}},{key:"addToEffects",value:function(t){var e;this.renderer.renderer&&(null===(e=this.effectsContainer)||void 0===e||e.addChild(t))}},{key:"addToOverlay",value:function(t){var e;null===(e=this.overlayContainer)||void 0===e||e.addChild(t)}},{key:"addToStageAt",value:function(t,e){var r;null===(r=this.renderer.stage)||void 0===r||r.addChildAt(t,e)}},{key:"addToEffectsAt",value:function(t,e){var r;null===(r=this.effectsContainer)||void 0===r||r.addChildAt(t,e)}},{key:"addToOverlayAt",value:function(t,e){var r;null===(r=this.overlayContainer)||void 0===r||r.addChildAt(t,e)}},{key:"removeFromStage",value:function(t){var e;null===(e=this.renderer.stage)||void 0===e||e.removeChild(t)}},{key:"removeFromEffects",value:function(t){var e;null===(e=this.effectsContainer)||void 0===e||e.removeChild(t)}},{key:"removeFromOverlay",value:function(t){var e;null===(e=this.overlayContainer)||void 0===e||e.removeChild(t)}},{key:"useAsMask",value:function(t){this.renderer.stage.mask=t}},{key:"setCanvas",value:function(t){this.canvas=t}},{key:"render",value:function(){var t;try{if(!this.renderer.renderer)return;this.renderer.render(),this.converterYUV&&(this.renderTo(this.renderer.stage,this.converterYUV.textureRBG),this.renderer.renderer.render(this.renderer.stage,{renderTexture:this.converterYUV.textureYUV}))}catch(e){tsvb_errorBus.bv.notify({message:null!==(t=e.message)&&void 0!==t?t:e,emitter:tsvb_errorBus.JK.RENDERER,cause:e})}}},{key:"getVideoFrameData",value:function(){return this.converterYUV?this.converterYUV.getVideoFrameArray():this.renderer.renderer.view}},{key:"getVideoFrameSettings",value:function(){return this.converterYUV?this.converterYUV.getVideoFrameSettings():{displayHeight:this.sdkOptions.height,displayWidth:this.sdkOptions.width}}}]);var t}();function tsvb_effect_processor_typeof(t){return tsvb_effect_processor_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_effect_processor_typeof(t)}function tsvb_effect_processor_slicedToArray(t,e){return tsvb_effect_processor_arrayWithHoles(t)||tsvb_effect_processor_iterableToArrayLimit(t,e)||tsvb_effect_processor_unsupportedIterableToArray(t,e)||tsvb_effect_processor_nonIterableRest()}function tsvb_effect_processor_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tsvb_effect_processor_iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,s,o,a=[],u=!0,l=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=s.call(r)).done)&&(a.push(n.value),a.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function tsvb_effect_processor_arrayWithHoles(t){if(Array.isArray(t))return t}function tsvb_effect_processor_createForOfIteratorHelper(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=tsvb_effect_processor_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function tsvb_effect_processor_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return tsvb_effect_processor_arrayLikeToArray(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tsvb_effect_processor_arrayLikeToArray(t,e):void 0}}function tsvb_effect_processor_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function tsvb_effect_processor_regeneratorRuntime(){tsvb_effect_processor_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_effect_processor_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_effect_processor_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_effect_processor_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_effect_processor_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_effect_processor_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_effect_processor_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_effect_processor_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_effect_processor_toPropertyKey(n.key),n)}}function tsvb_effect_processor_createClass(t,e,r){return e&&tsvb_effect_processor_defineProperties(t.prototype,e),r&&tsvb_effect_processor_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_effect_processor_toPropertyKey(t){var e=tsvb_effect_processor_toPrimitive(t,"string");return"symbol"==tsvb_effect_processor_typeof(e)?e:e+""}function tsvb_effect_processor_toPrimitive(t,e){if("object"!=tsvb_effect_processor_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_effect_processor_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_effect_processor_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var tsvb_SharedResources=tsvb_effect_processor_createClass((function t(){tsvb_effect_processor_classCallCheck(this,t),this.transform=null,this.mirror=!1,this.filters=new Map})),tsvb_AbstractEffect=function(){return tsvb_effect_processor_createClass((function t(e){tsvb_effect_processor_classCallCheck(this,t),this.enabled=!1,this.sdkOptions=e}),[{key:"useResources",value:function(t){this.resources=t}},{key:"prepare",value:function(){}},{key:"process",value:(t=tsvb_effect_processor_asyncToGenerator(tsvb_effect_processor_regeneratorRuntime().mark((function t(){return tsvb_effect_processor_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})},{key:"nextFrame",value:function(t){}},{key:"clearBuffers",value:function(){}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"destroy",value:function(){}}]);var t}(),tsvb_EffectProcessor=function(){return tsvb_effect_processor_createClass((function t(e,r){tsvb_effect_processor_classCallCheck(this,t),this.effects=[],this.isPaused=!1,this.isSkipPipeline=!1,this.components={},this.hasFrames=!1,this.textures=[],this.resources=new tsvb_SharedResources,this.resources.renderer=e,this.components=null!=r?r:{},this.resources.texture=new tsvb_Texture}),[{key:"destroy",value:function(){this.removeComponents(),this.resources.renderer.destroy(),this.effects.forEach((function(t){t.destroy()}))}},{key:"addEffect",value:function(t){t.useResources(this.resources),t.prepare(),this.effects.push(t)}},{key:"clearBuffers",value:function(){this.textures=[],this.effects.forEach((function(t,e){t.clearBuffers()}))}},{key:"pause",value:function(){this.isPaused=!0}},{key:"unpause",value:function(){this.isPaused=!1}},{key:"enablePipelineSkipping",value:function(){this.isSkipPipeline=!0}},{key:"disablePipelineSkipping",value:function(){this.isSkipPipeline=!1}},{key:"nextFrame",value:function(t){if(this.isPaused||this.isSkipPipeline)return t.texture.destroy(!0),void(this.textures=[]);if(this.effects.forEach((function(e,r){e.nextFrame(t)})),this.textures.length>1){var e=this.textures.shift();null==e||e.destroy()}this.textures.push(t)}},{key:"updateFrame",value:function(){if(this.textures.length){var t=this.textures.shift();t&&this.resources.texture.update(t.texture)}}},{key:"addComponents",value:function(){var t=this;this.components._getSortedComponentsArr.forEach((function(e){return t.resources.renderer.addToStage(e.container)}))}},{key:"removeComponents",value:function(){var t=this;Object.values(this.components).forEach((function(e){return t.resources.renderer.removeFromStage(e.container)}))}},{key:"process",value:(t=tsvb_effect_processor_asyncToGenerator(tsvb_effect_processor_regeneratorRuntime().mark((function t(){var e,r,n,i,s,o;return tsvb_effect_processor_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isPaused){t.next=2;break}return t.abrupt("return");case 2:if(!this.isSkipPipeline){t.next=7;break}return this.addComponents(),this.resources.renderer.render(),this.removeComponents(),t.abrupt("return");case 7:this.updateFrame(),e=tsvb_effect_processor_createForOfIteratorHelper(this.effects.entries()),t.prev=9,e.s();case 11:if((r=e.n()).done){t.next=20;break}return n=tsvb_effect_processor_slicedToArray(r.value,2),i=n[0],s=n[1],(o=i+1===this.effects.length)&&this.addComponents(),t.next=17,s.process();case 17:o&&this.removeComponents();case 18:t.next=11;break;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(9),e.e(t.t0);case 25:return t.prev=25,e.f(),t.finish(25);case 28:this.hasFrames=!0;case 29:case"end":return t.stop()}}),t,this,[[9,22,25,28]])}))),function(){return t.apply(this,arguments)})}]);var t}();const tsvb_lutShader="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D uLUT;\n\nuniform float uFilterPart;\nuniform float uFilterPower;\nuniform float uLutSize;\nuniform float uNormalizator;\nuniform float uHalfPx;\nuniform int uEdges;\nuniform int uEnabled;\n\nvec4 newColor(float rectNum, vec2 coord) {\n  int num = int(rectNum);\n  int red = num - uEdges * (num / uEdges);\n  int green = num / uEdges;\n\n  vec2 bCoord = vec2(float(red) / float(uEdges), float(green) / float(uEdges));\n\n  vec2 lutTextureCoord = vec2(coord.r + bCoord.r, coord.g + bCoord.g);\n  return texture2D(uLUT, lutTextureCoord);\n}\n\nfloat normalizeColor(float color) {\n  return color * uNormalizator + uHalfPx;\n}\n\nvoid main() {\n  vec4 color = texture2D(uSampler, vTextureCoord);\n\n  //. Check enabled\n  if (uEnabled < 1) {\n    gl_FragColor = color;\n    return;\n  }\n\n  //. Check filter part\n  if (vTextureCoord.x > uFilterPart) {\n    gl_FragColor = color;\n    return;\n  }\n\n  vec2 rgCoord = vec2(normalizeColor(color.r), normalizeColor(color.g));\n\n  //. Count number of the LUT-cell\n  float rectNumReal = color.b * (uLutSize - 1.0);\n\n  float rectNumMin = floor(rectNumReal);\n  float rectNumMax = ceil(rectNumReal);\n\n  vec4 colorLut1 = newColor(rectNumMin, rgCoord);\n  vec4 colorLut2 = newColor(rectNumMax, rgCoord);\n\n  vec4 colorInterpolated = mix(colorLut1, colorLut2, rectNumReal - rectNumMin);\n  vec3 resultColor = mix(color.rgb, colorLut1.rgb, uFilterPower);\n\n  gl_FragColor = vec4(resultColor.rgb, color.a);\n}\n\n";function tsvb_filterLut_typeof(t){return tsvb_filterLut_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_filterLut_typeof(t)}function tsvb_filterLut_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_filterLut_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_filterLut_toPropertyKey(n.key),n)}}function tsvb_filterLut_createClass(t,e,r){return e&&tsvb_filterLut_defineProperties(t.prototype,e),r&&tsvb_filterLut_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_filterLut_toPropertyKey(t){var e=tsvb_filterLut_toPrimitive(t,"string");return"symbol"==tsvb_filterLut_typeof(e)?e:e+""}function tsvb_filterLut_toPrimitive(t,e){if("object"!=tsvb_filterLut_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_filterLut_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_filterLut_callSuper(t,e,r){return e=tsvb_filterLut_getPrototypeOf(e),tsvb_filterLut_possibleConstructorReturn(t,tsvb_filterLut_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_filterLut_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_filterLut_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_filterLut_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_filterLut_assertThisInitialized(t)}function tsvb_filterLut_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_filterLut_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_filterLut_isNativeReflectConstruct=function(){return!!t})()}function tsvb_filterLut_getPrototypeOf(t){return tsvb_filterLut_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_filterLut_getPrototypeOf(t)}function tsvb_filterLut_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_filterLut_setPrototypeOf(t,e)}function tsvb_filterLut_setPrototypeOf(t,e){return tsvb_filterLut_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_filterLut_setPrototypeOf(t,e)}var tsvb_FilterLut=function(t){function e(t){var r,n,i,s;return tsvb_filterLut_classCallCheck(this,e),(r=tsvb_filterLut_callSuper(this,e,[void 0,tsvb_lutShader,{uFilterPart:1,uFilterPower:1,uEnabled:0,uLutSize:null!==(n=null==t?void 0:t.lutSize)&&void 0!==n?n:36,uEdges:null!==(i=null==t?void 0:t.edges)&&void 0!==i?i:6,uLUT:null!==(s=null==t?void 0:t.texture)&&void 0!==s?s:tsvb_Texture_Texture.WHITE}])).calcNormatizator(),r}return tsvb_filterLut_inherits(e,src_tsvb_Filter),tsvb_filterLut_createClass(e,[{key:"setLUT",value:function(t){var e;(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(null===(e=this.uniforms.uLUT)||void 0===e||e.destroy(!0)),(null==t?void 0:t.edges)&&(this.uniforms.uEdges=t.edges),(null==t?void 0:t.lutSize)&&(this.uniforms.uLutSize=t.lutSize),this.calcNormatizator(),(null==t?void 0:t.texture)?(this.uniforms.uLUT=t.texture,this.uniforms.uEnabled=1):this.uniforms.uEnabled=0}},{key:"setFilterPart",value:function(t){t=Math.min(1,Math.max(0,t)),this.uniforms.uFilterPart=t}},{key:"setFilterPower",value:function(t){t=Math.min(1,Math.max(0,t)),this.uniforms.uFilterPower=t}},{key:"calcNormatizator",value:function(){var t=this.uniforms,e=t.uLutSize,r=t.uEdges;this.uniforms.uNormalizator=(e-1)/(e*r),this.uniforms.uHalfPx=.5/(e*r)}}])}(),tsvb_defaultConfig=function(){return{lut:"none",part:1,power:1,capacity:1}};function tsvb_lutParser_typeof(t){return tsvb_lutParser_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_lutParser_typeof(t)}function src_tsvb_toConsumableArray(t){return src_tsvb_arrayWithoutHoles(t)||src_tsvb_iterableToArray(t)||tsvb_lutParser_unsupportedIterableToArray(t)||src_tsvb_nonIterableSpread()}function src_tsvb_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tsvb_lutParser_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return tsvb_lutParser_arrayLikeToArray(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tsvb_lutParser_arrayLikeToArray(t,e):void 0}}function src_tsvb_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function src_tsvb_arrayWithoutHoles(t){if(Array.isArray(t))return tsvb_lutParser_arrayLikeToArray(t)}function tsvb_lutParser_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function tsvb_lutParser_regeneratorRuntime(){tsvb_lutParser_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_lutParser_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_lutParser_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_lutParser_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_lutParser_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_lutParser_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_lutParser_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_lutParser_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_lutParser_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_lutParser_toPropertyKey(n.key),n)}}function tsvb_lutParser_createClass(t,e,r){return e&&tsvb_lutParser_defineProperties(t.prototype,e),r&&tsvb_lutParser_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_lutParser_toPropertyKey(t){var e=tsvb_lutParser_toPrimitive(t,"string");return"symbol"==tsvb_lutParser_typeof(e)?e:e+""}function tsvb_lutParser_toPrimitive(t,e){if("object"!=tsvb_lutParser_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_lutParser_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_extArr=["cube"],tsvb_LutParser=function(){return tsvb_lutParser_createClass((function t(){tsvb_lutParser_classCallCheck(this,t)}),[{key:"parse",value:function(t){var e,r=this;return new Promise(function(){var n=tsvb_lutParser_asyncToGenerator(tsvb_lutParser_regeneratorRuntime().mark((function n(i,s){var o,a,u,l,c;return tsvb_lutParser_regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t instanceof File)){n.next=14;break}if(r.checkFileExtention(t.name)){n.next=4;break}return s('[ Lut Parser ] - Invalid file extention (file "'.concat(t.name,'", available extentions: ').concat(tsvb_extArr.join(", "),")")),n.abrupt("return");case 4:return n.prev=4,n.next=7,r.readFile(t);case 7:e=n.sent,n.next=14;break;case 10:return n.prev=10,n.t0=n.catch(4),s(n.t0),n.abrupt("return");case 14:if("string"!=typeof t){n.next=25;break}return n.prev=15,n.next=18,fetch(t).then((function(t){return t.text()}));case 18:e=n.sent,n.next=25;break;case 21:return n.prev=21,n.t1=n.catch(15),s(n.t1),n.abrupt("return");case 25:if("3D"===(o=r.parseCUBE(e)).type.toUpperCase()){n.next=29;break}return s("[ Lut Parser ] - invalid lut type(".concat(o.type,"). Support 3DLUT only")),n.abrupt("return");case 29:return a=Math.ceil(Math.sqrt(o.size)),u=r.prepareTextureArray(o,a),l=o.size*a,c=tsvb_Texture_Texture.fromBuffer(u,l,l,{scaleMode:1,mipmap:tsvb_MIPMAP_MODES.OFF}),i({texture:c,lutSize:o.size,textureSize:l,edges:a}),n.abrupt("return");case 35:case"end":return n.stop()}}),n,null,[[4,10],[15,21]])})));return function(t,e){return n.apply(this,arguments)}}())}},{key:"parseCUBE",value:function(t){for(var e,r={title:"",type:"",size:0,domain:[[0,0,0],[1,1,1]],data:[]},n=t.split("\n"),i=0;i<n.length;i++){var s=n[i].trim();if("#"!==s[0]&&""!==s){var o=s.split(/\s+/);switch(o[0]){case"TITLE":r.title=s.slice(7,-1);break;case"DOMAIN_MIN":r.domain[0]=o.slice(1).map(Number);break;case"DOMAIN_MAX":r.domain[1]=o.slice(1).map(Number);break;case"LUT_1D_SIZE":r.type="1D",r.size=Number(o[1]);break;case"LUT_3D_SIZE":r.type="3D",r.size=Number(o[1]);break;default:(e=r.data).push.apply(e,src_tsvb_toConsumableArray(o.map(Number)))}}}return r}},{key:"prepareTextureArray",value:function(t,e){var r=t.data,n=t.size,i=n*n*n,s=new Uint8ClampedArray(4*Math.pow(n*e,2)),o={value:0,isNil:function(){return 0===o.value},setDefault:function(){return o.value=n*n},dec:function(){return o.value--}};o.setDefault();for(var a=0,u=0,l=function(t,r){return 4*(n*(e*u+a)+r%n)+t},c=0;c<3*i;c+=3)s[l(0,c/3)]=255*r[c+0],s[l(1,c/3)]=255*r[c+1],s[l(2,c/3)]=255*r[c+2],s[l(3,c/3)]=255,o.dec(),c/3%n==n-2&&u++,o.isNil()&&(o.setDefault(),++a>=e?a=0:u-=n);return s}},{key:"checkFileExtention",value:function(t){var e=t.split(".").pop();return!!e&&tsvb_extArr.includes(e.toLowerCase())}},{key:"readFile",value:(t=tsvb_lutParser_asyncToGenerator(tsvb_lutParser_regeneratorRuntime().mark((function t(e){return tsvb_lutParser_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var n=new FileReader;n.readAsText(e),n.onload=function(){t(n.result)},n.onerror=function(){r("[ Lut Parser ] - filereader: ".concat(n.error))}})));case 1:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]);var t}();function tsvb_activityIndexator_typeof(t){return tsvb_activityIndexator_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_activityIndexator_typeof(t)}function tsvb_activityIndexator_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_activityIndexator_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_activityIndexator_toPropertyKey(n.key),n)}}function tsvb_activityIndexator_createClass(t,e,r){return e&&tsvb_activityIndexator_defineProperties(t.prototype,e),r&&tsvb_activityIndexator_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_activityIndexator_toPropertyKey(t){var e=tsvb_activityIndexator_toPrimitive(t,"string");return"symbol"==tsvb_activityIndexator_typeof(e)?e:e+""}function tsvb_activityIndexator_toPrimitive(t,e){if("object"!=tsvb_activityIndexator_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_activityIndexator_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_ActivityIndexator=function(){return tsvb_activityIndexator_createClass((function t(e){var r;tsvb_activityIndexator_classCallCheck(this,t),this.size=null!==(r=e.size)&&void 0!==r?r:1,this.store=[]}),[{key:"add",value:function(t){var e=this,r=this.store.find((function(e){return e.id===t})),n=Date.now();if(r)return r.time=n,{hasItem:!0};var i={id:t,time:n};if(this.store.push(i),this.store.length<=this.size)return{};var s=this.store.reduce((function(t,r,n){return e.store[t].time<r.time?t:n}),0);return{removedID:this.store.splice(s,1)[0].id}}},{key:"setSize",value:function(t){var e;if(this.size=t,!(this.store.length<=t)){this.store=this.store.sort((function(t,e){return e.time-t.time}));for(var r=[];this.store.length>this.size;){var n=null===(e=this.store.pop())||void 0===e?void 0:e.id;void 0!==n&&r.push(n)}return r}}},{key:"checkItemByID",value:function(t){return!!~this.store.findIndex((function(e){return e.id===t}))}}])}();function tsvb_colorFilterEffect_typeof(t){return tsvb_colorFilterEffect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_colorFilterEffect_typeof(t)}function tsvb_colorFilterEffect_regeneratorRuntime(){tsvb_colorFilterEffect_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_colorFilterEffect_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_colorFilterEffect_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_colorFilterEffect_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_colorFilterEffect_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_colorFilterEffect_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_colorFilterEffect_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_colorFilterEffect_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_colorFilterEffect_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_colorFilterEffect_toPropertyKey(n.key),n)}}function tsvb_colorFilterEffect_createClass(t,e,r){return e&&tsvb_colorFilterEffect_defineProperties(t.prototype,e),r&&tsvb_colorFilterEffect_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_colorFilterEffect_toPropertyKey(t){var e=tsvb_colorFilterEffect_toPrimitive(t,"string");return"symbol"==tsvb_colorFilterEffect_typeof(e)?e:e+""}function tsvb_colorFilterEffect_toPrimitive(t,e){if("object"!=tsvb_colorFilterEffect_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_colorFilterEffect_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_colorFilterEffect_callSuper(t,e,r){return e=tsvb_colorFilterEffect_getPrototypeOf(e),tsvb_colorFilterEffect_possibleConstructorReturn(t,tsvb_colorFilterEffect_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_colorFilterEffect_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_colorFilterEffect_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_colorFilterEffect_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_colorFilterEffect_assertThisInitialized(t)}function tsvb_colorFilterEffect_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_colorFilterEffect_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_colorFilterEffect_isNativeReflectConstruct=function(){return!!t})()}function tsvb_colorFilterEffect_getPrototypeOf(t){return tsvb_colorFilterEffect_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_colorFilterEffect_getPrototypeOf(t)}function tsvb_colorFilterEffect_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_colorFilterEffect_setPrototypeOf(t,e)}function tsvb_colorFilterEffect_setPrototypeOf(t,e){return tsvb_colorFilterEffect_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_colorFilterEffect_setPrototypeOf(t,e)}var tsvb_ColorFilterEffect=function(t){function e(t){var r;return tsvb_colorFilterEffect_classCallCheck(this,e),(r=tsvb_colorFilterEffect_callSuper(this,e,[t])).parser=new tsvb_LutParser,r.lutStore={},r.config=tsvb_defaultConfig(),r.activityIndexator=new tsvb_ActivityIndexator({size:r.config.capacity}),r.filterName="color-filter",r}return tsvb_colorFilterEffect_inherits(e,tsvb_AbstractEffect),tsvb_colorFilterEffect_createClass(e,[{key:"prepare",value:function(){this.resources.texture;this.filter=new tsvb_FilterLut,this.setConfig(this.config)}},{key:"process",value:(n=tsvb_colorFilterEffect_asyncToGenerator(tsvb_colorFilterEffect_regeneratorRuntime().mark((function t(){return tsvb_colorFilterEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled&&"none"!==this.config.lut){t.next=3;break}return this.resources.filters.has(this.filterName)&&this.resources.filters.delete(this.filterName),t.abrupt("return");case 3:this.resources.filters.set(this.filterName,this.filter);case 4:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"setConfig",value:function(t){this.setFilterPart(t.part),this.setFilterPower(t.power),this.setFilterLut(t.lut,t.promise),this.setCapacity(t.capacity)}},{key:"setFilterPart",value:function(t){void 0!==t&&(this.config.part=t,this.filter.setFilterPart(t))}},{key:"setFilterPower",value:function(t){void 0!==t&&(this.config.power=t,this.filter.setFilterPower(t))}},{key:"setFilterLut",value:(r=tsvb_colorFilterEffect_asyncToGenerator(tsvb_colorFilterEffect_regeneratorRuntime().mark((function t(e,r){var n,i,s,o,a;return tsvb_colorFilterEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=2;break}return t.abrupt("return");case 2:if("none"!==e){t.next=5;break}return this.config.lut="none",t.abrupt("return");case 5:if(n=this.countID(e),this.config.lut=e,this.selectedID=n,i=this.activityIndexator.add(n),s=i.hasItem,o=i.removedID,s){t.next=19;break}return t.next=12,this.parser.parse(e);case 12:if(a=t.sent,this.activityIndexator.checkItemByID(n)){t.next=18;break}return a.texture.destroy(),this.removeLutByID(o),this.resolver(n,null==r?void 0:r.resolve()),t.abrupt("return");case 18:this.lutStore[n]=a;case 19:this.filter.setLUT(this.lutStore[this.selectedID],!1),this.removeLutByID(o),this.resolver(n,null==r?void 0:r.resolve());case 22:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"setCapacity",value:function(t){var e=this;if(void 0!==t){this.config.capacity=t;var r=this.activityIndexator.setSize(t);(null==r?void 0:r.length)&&r.forEach((function(t){return e.removeLutByID(t)}))}}},{key:"removeLutByID",value:function(t){var e,r;void 0!==t&&(null===(r=null===(e=this.lutStore[t])||void 0===e?void 0:e.texture)||void 0===r||r.destroy(),delete this.lutStore[t])}},{key:"countID",value:function(t){return t instanceof File?t.name:t}},{key:"onSuccess",value:function(t){var e="function"==typeof t;this.onSuccessFunction=e?t:void 0}},{key:"resolver",value:function(t,e){"function"==typeof this.onSuccessFunction&&this.onSuccessFunction(t),"function"==typeof e&&e()}},{key:"destroy",value:function(){}}]);var r,n}();const tsvb_beautyShader="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\n#define SIGMA (10.0)\n#define BSIGMA (0.1)\n#define MSIZE (15)\n\nfloat kernel[MSIZE];\n\nuniform float uBeautyficationLevel;\nuniform int uWidth;\nuniform int uHeight;\n\nfloat normpdf(float x, float sigma) {\n  return 0.39894 * exp(-0.5 * x * x / (sigma * sigma)) / sigma;\n}\n\nfloat normpdf3(vec3 v, float sigma) {\n  return 0.39894 * exp(-0.5 * dot(v, v) / (sigma * sigma)) / sigma;\n}\n\nvec4 overlay(vec4 a, vec4 b) {\n  vec4 x = vec4(2.0) * a * b;\n  vec4 y = vec4(1.0) - vec4(2.0) * (vec4(1.0) - a) * (vec4(1.0) - b);\n  vec4 result;\n  result.r = mix(x.r, y.r, float(a.r > 0.5));\n  result.g = mix(x.g, y.g, float(a.g > 0.5));\n  result.b = mix(x.b, y.b, float(a.b > 0.5));\n  result.a = mix(x.a, y.a, float(a.a > 0.5));\n  return result;\n}\n\nvec3 rgb2xyz(vec3 c) {\n  vec3 tmp;\n  tmp.x = c.r > 0.04045 ? pow((c.r + 0.055) / 1.055, 2.4) : c.r / 12.92;\n  tmp.y = c.g > 0.04045 ? pow((c.g + 0.055) / 1.055, 2.4) : c.g / 12.92,\n    tmp.z = c.b > 0.04045 ? pow((c.b + 0.055) / 1.055, 2.4) : c.b / 12.92;\n  return 100.0 *\n  tmp *\n  mat3(0.4124, 0.3576, 0.1805, 0.2126, 0.7152, 0.0722, 0.0193, 0.1192, 0.9505);\n}\n\nvec3 xyz2lab(vec3 c) {\n  vec3 n = c / vec3(95.047, 100, 108.883);\n  vec3 v;\n  v.x = n.x > 0.008856 ? pow(n.x, 1.0 / 3.0) : 7.787 * n.x + 16.0 / 116.0;\n  v.y = n.y > 0.008856 ? pow(n.y, 1.0 / 3.0) : 7.787 * n.y + 16.0 / 116.0;\n  v.z = n.z > 0.008856 ? pow(n.z, 1.0 / 3.0) : 7.787 * n.z + 16.0 / 116.0;\n  return vec3(116.0 * v.y - 16.0, 500.0 * (v.x - v.y), 200.0 * (v.y - v.z));\n}\n\nvec3 rgb2lab(vec3 c) {\n  vec3 lab = xyz2lab(rgb2xyz(c));\n  return vec3(\n    lab.x / 100.0,\n    0.5 + 0.5 * (lab.y / 127.0),\n    0.5 + 0.5 * (lab.z / 127.0)\n  );\n}\n\nbool skin_mask(vec4 color) {\n  vec3 lab = rgb2lab(color.rgb);\n  return lab.g >= uBeautyficationLevel + 0.05 &&\n  lab.b >= uBeautyficationLevel + 0.04 &&\n  lab.r <= 0.98 &&\n  length(lab.gb) <= 0.9;\n}\n\nvoid main() {\n  vec2 iResolution = vec2(float(uWidth), float(uHeight));\n  vec3 c = texture2D(uSampler, vTextureCoord).rgb;\n  float a = texture2D(uSampler, vTextureCoord).a;\n\n  if (a > 0.9 && (uBeautyficationLevel > 0.95 || skin_mask(texture2D(uSampler, vTextureCoord)))) {\n    const int kSize = (MSIZE - 1) / 2;\n    vec3 final_colour = vec3(0.0);\n    float Z = 0.0;\n\n    kernel[0] = kernel[14] = 0.031225216;\n    kernel[1] = kernel[13] = 0.033322271;\n    kernel[2] = kernel[12] = 0.035206333;\n    kernel[3] = kernel[11] = 0.036826804;\n    kernel[4] = kernel[10] = 0.038138565;\n    kernel[5] = kernel[9] = 0.039104044;\n    kernel[6] = kernel[8] = 0.039695028;\n    kernel[7] = 0.039894;\n    float bZ = 0.2506642602897679;\n\n    //create the 1-D kernel\n\n    //   for (int j = 0; j <= kSize; ++j)\n    //   {\n    //     kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), SIGMA);\n    //   }\n\n    vec3 cc;\n    float factor;\n    //float bZ = 1.0/normpdf(0.0, BSIGMA);\n    //read out the texels\n    for (int i = -kSize; i <= kSize; ++i) {\n      for (int j = -kSize; j <= kSize; ++j) {\n        cc = texture2D(\n          uSampler,\n          vTextureCoord.xy + vec2(float(i), float(j)) / iResolution.xy\n        ).rgb;\n        factor =\n          normpdf3(cc - c, BSIGMA) * bZ * kernel[kSize + j] * kernel[kSize + i];\n        Z += factor;\n        final_colour += factor * cc;\n      }\n    }\n\n    //fragColor = vec4(final_colour / Z, 1.0);\n\n    vec4 origin = texture2D(uSampler, vTextureCoord);\n    vec4 blurred = vec4(final_colour / Z, 1.0);\n    vec4 highpass =\n      vec4(\n        origin.r - blurred.r,\n        origin.g - blurred.g,\n        origin.b - blurred.b,\n        1\n      ) +\n      vec4(0.5, 0.5, 0.5, 0);\n    vec4 highpass_inverted = vec4(\n      1.0 - highpass.r,\n      1.0 - highpass.g,\n      1.0 - highpass.b,\n      1\n    );\n    gl_FragColor = overlay(origin, highpass_inverted);\n\n  } else {\n    gl_FragColor = vec4(c, a);\n\n  }\n}\n",tsvb_beautyHPassBoxBilateralShader="precision mediump float;\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float uStepSize;\n\n#define KERNEL_RAD 4\n\nvec4 readTex(vec2 uv)\n{\n  return texture2D(uSampler, uv);\n}\n\nfloat getLength(vec4 vec)\n{\n    return sqrt(dot(vec, vec));\n}\n\nfloat getDistance(vec4 a, vec4 b)\n{\n    return getLength(a - b);\n}\n\nfloat getDistanceWeight(vec4 a, vec4 b)\n{\n    return 1.0 - min(getDistance(a, b) * 5.248639, 1.0);\n}\n\nvec4 blurPass(vec2 uv)\n{    \n  float bilateralWeights[KERNEL_RAD + 1];\n  bilateralWeights[0] = 0.18;\n  bilateralWeights[1] = 0.15;\n  bilateralWeights[2] = 0.12;\n  bilateralWeights[3] = 0.09; \n  bilateralWeights[4] = 0.05;\n\n  vec4 origPixel = readTex(uv);\n  vec4 sum = origPixel * bilateralWeights[0]; \n  float weightSum = bilateralWeights[0];\n\n  for (int i = 1; i <= KERNEL_RAD; i++) {\n    vec4 pixel = readTex(uv - vec2((float(i) * uStepSize), 0.0));\n    float weight = bilateralWeights[i];\n    float sampleWeight = (weight * getDistanceWeight(origPixel, pixel));\n    weightSum = (weightSum + sampleWeight);\n    sum = (sum + (pixel * sampleWeight));\n  }\n  \n  for (int i = 1; i <= KERNEL_RAD; i++) {\n    vec4 pixel = readTex(uv + vec2((float(i) * uStepSize), 0.0));\n    float weight = bilateralWeights[i];\n    float sampleWeight = (weight * getDistanceWeight(origPixel, pixel));\n    weightSum = (weightSum + sampleWeight);\n    sum = (sum + (pixel * sampleWeight));\n  }\n  \n  if ((weightSum < 0.4)) {\n      return origPixel;\n  } else {\n      if ((weightSum < 0.5)) {\n          return mix (origPixel, (sum / weightSum), ((weightSum - 0.4) / 0.1));\n      } else {\n          return (sum / weightSum);\n      };\n  };\n}\n\nvoid main() {\n  gl_FragColor = blurPass(vTextureCoord);\n}\n",tsvb_beautyVPassBoxBilateralShader="precision mediump float;\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D uOrigin;\n\nuniform float uBeautyficationLevel;\nuniform float uStepSize;\n\n#define KERNEL_RAD 4\n#define HIGHPASS_ENABLED 0//%%highpassEnabled%%\n\nvec4 overlay(vec4 a, vec4 b) {\n  vec4 x = vec4(2.0) * a * b;\n  vec4 y = vec4(1.0) - vec4(2.0) * (vec4(1.0) - a) * (vec4(1.0) - b);\n  vec4 result;\n  result.r = mix(x.r, y.r, float(a.r > 0.5));\n  result.g = mix(x.g, y.g, float(a.g > 0.5));\n  result.b = mix(x.b, y.b, float(a.b > 0.5));\n  result.a = mix(x.a, y.a, float(a.a > 0.5));\n  return result;\n}\n\nvec3 rgb2xyz(vec3 c) {\n  vec3 tmp;\n  tmp.x = c.r > 0.04045 ? pow((c.r + 0.055) / 1.055, 2.4) : c.r / 12.92;\n  tmp.y = c.g > 0.04045 ? pow((c.g + 0.055) / 1.055, 2.4) : c.g / 12.92,\n  tmp.z = c.b > 0.04045 ? pow((c.b + 0.055) / 1.055, 2.4) : c.b / 12.92;\n  return 100.0 *\n  tmp *\n  mat3(0.4124, 0.3576, 0.1805, 0.2126, 0.7152, 0.0722, 0.0193, 0.1192, 0.9505);\n}\n\nvec3 xyz2lab(vec3 c) {\n  vec3 n = c / vec3(95.047, 100, 108.883);\n  vec3 v;\n  v.x = n.x > 0.008856 ? pow(n.x, 1.0 / 3.0) : 7.787 * n.x + 16.0 / 116.0;\n  v.y = n.y > 0.008856 ? pow(n.y, 1.0 / 3.0) : 7.787 * n.y + 16.0 / 116.0;\n  v.z = n.z > 0.008856 ? pow(n.z, 1.0 / 3.0) : 7.787 * n.z + 16.0 / 116.0;\n  return vec3(116.0 * v.y - 16.0, 500.0 * (v.x - v.y), 200.0 * (v.y - v.z));\n}\n\nvec3 rgb2lab(vec3 c) {\n  vec3 lab = xyz2lab(rgb2xyz(c));\n  return vec3(\n    lab.x / 100.0,\n    0.5 + 0.5 * (lab.y / 127.0),\n    0.5 + 0.5 * (lab.z / 127.0)\n  );\n}\n\nbool skin_mask(vec4 color) {\n  vec3 lab = rgb2lab(color.rgb);\n  return lab.g >= uBeautyficationLevel + 0.05 &&\n  lab.b >= uBeautyficationLevel + 0.04 &&\n  lab.r <= 0.98 &&\n  length(lab.gb) <= 0.9;\n}\n\nvec4 readOrig(vec2 uv) \n{\n  return texture2D(uOrigin, uv);\n}\n\nvec4 readTex(vec2 uv)\n{\n  return texture2D(uSampler, uv);\n}\n\nfloat getLength(vec4 vec)\n{\n    return sqrt(dot(vec, vec));\n}\n\nfloat getDistance(vec4 a, vec4 b)\n{\n    return getLength(a - b);\n}\n\nfloat getDistanceWeight(vec4 a, vec4 b)\n{\n    return 1.0 - min(getDistance(a, b) * 5.248639, 1.0);\n}\n\nint abs(int i) \n{\n  return (i<0)? -i : i;\n}\n\nvec4 blurPass(vec2 uv)\n{    \n  float bilateralWeights[KERNEL_RAD + 1];\n  bilateralWeights[0] = 0.18;\n  bilateralWeights[1] = 0.15;\n  bilateralWeights[2] = 0.12;\n  bilateralWeights[3] = 0.09; \n  bilateralWeights[4] = 0.05;\n\n  vec4 origPixel = readTex(uv);\n  vec4 sum = origPixel * bilateralWeights[0]; \n  float weightSum = bilateralWeights[0];\n\n  for (int i = 1; i <= KERNEL_RAD; i++) {\n    vec4 pixel = readTex(uv - vec2(0.0, (float(i) * uStepSize)));\n    float weight = bilateralWeights[i];\n    float sampleWeight = (weight * getDistanceWeight(origPixel, pixel));\n    weightSum = (weightSum + sampleWeight);\n    sum = (sum + (pixel * sampleWeight));\n  }\n  \n  for (int i = 1; i <= KERNEL_RAD; i++) {\n    vec4 pixel = readTex(uv + vec2(0.0, (float(i) * uStepSize)));\n    float weight = bilateralWeights[i];\n    float sampleWeight = (weight * getDistanceWeight(origPixel, pixel));\n    weightSum = (weightSum + sampleWeight);\n    sum = (sum + (pixel * sampleWeight));\n  }\n  \n  if ((weightSum < 0.4)) {\n      return origPixel;\n  } else {\n      if ((weightSum < 0.5)) {\n          return mix (origPixel, (sum / weightSum), ((weightSum - 0.4) / 0.1));\n      } else {\n          return (sum / weightSum);\n      };\n  };\n}\n\nvoid main() {\n  vec4 origin = readOrig(vTextureCoord);\n  float a = origin.a;\n\n  if (a < 0.9 || (uBeautyficationLevel < 0.95 && !skin_mask(origin))) {\n    gl_FragColor = origin;\n    return;\n  }\n\n  vec4 blurred = blurPass(vTextureCoord);\n\n#if HIGHPASS_ENABLED\n    vec4 highpass =\n      vec4(\n        origin.r - blurred.r,\n        origin.g - blurred.g,\n        origin.b - blurred.b,\n        1\n      ) +\n      vec4(0.5, 0.5, 0.5, 0);\n    vec4 highpass_inverted = vec4(\n      1.0 - highpass.r,\n      1.0 - highpass.g,\n      1.0 - highpass.b,\n      1\n    );\n    gl_FragColor = overlay(origin, highpass_inverted);\n#else \n    gl_FragColor = blurred;\n#endif\n}\n";function tsvb_filterBeauty_typeof(t){return tsvb_filterBeauty_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_filterBeauty_typeof(t)}function tsvb_filterBeauty_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_filterBeauty_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_filterBeauty_toPropertyKey(n.key),n)}}function tsvb_filterBeauty_createClass(t,e,r){return e&&tsvb_filterBeauty_defineProperties(t.prototype,e),r&&tsvb_filterBeauty_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_filterBeauty_toPropertyKey(t){var e=tsvb_filterBeauty_toPrimitive(t,"string");return"symbol"==tsvb_filterBeauty_typeof(e)?e:e+""}function tsvb_filterBeauty_toPrimitive(t,e){if("object"!=tsvb_filterBeauty_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_filterBeauty_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_filterBeauty_callSuper(t,e,r){return e=tsvb_filterBeauty_getPrototypeOf(e),tsvb_filterBeauty_possibleConstructorReturn(t,tsvb_filterBeauty_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_filterBeauty_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_filterBeauty_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_filterBeauty_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_filterBeauty_assertThisInitialized(t)}function tsvb_filterBeauty_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_filterBeauty_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_filterBeauty_isNativeReflectConstruct=function(){return!!t})()}function tsvb_filterBeauty_getPrototypeOf(t){return tsvb_filterBeauty_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_filterBeauty_getPrototypeOf(t)}function tsvb_filterBeauty_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_filterBeauty_setPrototypeOf(t,e)}function tsvb_filterBeauty_setPrototypeOf(t,e){return tsvb_filterBeauty_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_filterBeauty_setPrototypeOf(t,e)}var tsvb_BlurType,BlurType;function tsvb_processShader(t,e){var r=e.sigma||.3*(e.radius-1)+.8;return t.replaceAll("0//%%kernelRad%%",e.radius.toString()).replaceAll("0//%%highpassEnabled%%",e.highpassEnabled?"1":"0").replaceAll("10.0//%%sigma%%","float("+r.toString()+")")}BlurType=tsvb_BlurType||(tsvb_BlurType={}),BlurType.prod="prod",BlurType.boxBilateral="box_bilateral";var tsvb_FilterBeauty=function(t){function e(t){var r;return tsvb_filterBeauty_classCallCheck(this,e),r=tsvb_filterBeauty_callSuper(this,e,[void 0,tsvb_processShader(t.blurType===tsvb_BlurType.boxBilateral?tsvb_beautyVPassBoxBilateralShader:tsvb_beautyShader,t),{uBeautificationLevel:t.uBeautificationLevel,uWidth:t.uWidth,uHeight:t.uHeight}]),t.blurType===tsvb_BlurType.boxBilateral&&(r.hPassFilter=new src_tsvb_Filter(void 0,tsvb_beautyHPassBoxBilateralShader)),r.blurType=t.blurType,r}return tsvb_filterBeauty_inherits(e,src_tsvb_Filter),tsvb_filterBeauty_createClass(e,[{key:"setBeautificationLevel",value:function(t){this.uniforms.uBeautyficationLevel=t}},{key:"apply",value:function(t,e,r,n){if(this.blurType!==tsvb_BlurType.prod){var i=t.getFilterTexture();this.hPassFilter.uniforms.uStepSize=1.5/e._frame.width,t.applyFilter(this.hPassFilter,e,i,tsvb_CLEAR_MODES.NO),this.uniforms.uStepSize=1.5/e._frame.height,this.uniforms.uOrigin=e,t.applyFilter(this,i,r,n),t.returnFilterTexture(i)}else t.applyFilter(this,e,r,n)}}])}();const tsvb_showShader="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vOriginCoord;\nvarying vec2 vOutputFrame;\nvarying vec2 vInputSize;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\nuniform mat3 uTransformMatrix;\n\nvec4 filterVertexPosition(void ) {\n  vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.0)) + outputFrame.xy;\n\n  return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord(void ) {\n  return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void ) {\n  gl_Position = filterVertexPosition();\n  vTextureCoord = filterTextureCoord();\n\n  vOutputFrame = outputFrame.zw;\n  vInputSize = inputSize.xy;\n\n  vOriginCoord = (uTransformMatrix * vec3(vTextureCoord * inputSize.xy / outputFrame.zw, 1.0)).xy;\n}\n",tsvb_show_showShader="uniform sampler2D uSampler;\nuniform sampler2D uOriginFrame;\n\nuniform bool useMask;\nuniform float distColor;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vOriginCoord;\nvarying vec2 vOutputFrame;\nvarying vec2 vInputSize;\n\nvoid main() {\n  float personMask = texture2D(uSampler, vTextureCoord).r;\n\n  personMask = smoothstep(0.0, 1.0, personMask);\n  personMask = smoothstep(0.0, 1.0, personMask);\n  personMask = smoothstep(0.0, 1.0, personMask);\n\n  vec4 personFrame = texture2D(uOriginFrame, vOriginCoord);\n  \n  //rounded video preparation\n  //gl_FragColor = mix(vec4(0), personFrame, step(distance(vec2(vOriginCoord.x , vOriginCoord.y * vOutputFrame.y/vOutputFrame.x), vec2(0.5, 0.5 * vOutputFrame.y/vOutputFrame.x) ), 0.281) );\n  //step(distance(vTextureCoord.y, 0.5), 0.5)\n\n  if (useMask) {\n    gl_FragColor = mix(vec4(0), personFrame, personMask);  \n  } else {\n    gl_FragColor = mix(vec4(0), personFrame, distColor);\n  }\n}\n";function tsvb_filterShow_typeof(t){return tsvb_filterShow_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_filterShow_typeof(t)}function tsvb_filterShow_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_filterShow_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_filterShow_toPropertyKey(n.key),n)}}function tsvb_filterShow_createClass(t,e,r){return e&&tsvb_filterShow_defineProperties(t.prototype,e),r&&tsvb_filterShow_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_filterShow_toPropertyKey(t){var e=tsvb_filterShow_toPrimitive(t,"string");return"symbol"==tsvb_filterShow_typeof(e)?e:e+""}function tsvb_filterShow_toPrimitive(t,e){if("object"!=tsvb_filterShow_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_filterShow_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_filterShow_callSuper(t,e,r){return e=tsvb_filterShow_getPrototypeOf(e),tsvb_filterShow_possibleConstructorReturn(t,tsvb_filterShow_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_filterShow_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_filterShow_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_filterShow_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_filterShow_assertThisInitialized(t)}function tsvb_filterShow_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_filterShow_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_filterShow_isNativeReflectConstruct=function(){return!!t})()}function tsvb_filterShow_getPrototypeOf(t){return tsvb_filterShow_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_filterShow_getPrototypeOf(t)}function tsvb_filterShow_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_filterShow_setPrototypeOf(t,e)}function tsvb_filterShow_setPrototypeOf(t,e){return tsvb_filterShow_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_filterShow_setPrototypeOf(t,e)}var tsvb_FilterShow=function(t){function e(t,r,n){var i;return tsvb_filterShow_classCallCheck(this,e),(i=tsvb_filterShow_callSuper(this,e,[tsvb_showShader,tsvb_show_showShader,Object.assign({},t)])).matrix=new tsvb_Matrix,i.originalFrame=r,i.maskSprite=n,i.setLayout(),i}return tsvb_filterShow_inherits(e,src_tsvb_Filter),tsvb_filterShow_createClass(e,[{key:"setLayout",value:function(){var t=this.maskSprite.position.x<0?1-Math.abs(this.maskSprite.position.x)/this.maskSprite.width:(this.originalFrame.width-this.maskSprite.position.x)/this.maskSprite.width;t=Math.min(1,t);var e=this.maskSprite.position.x<0?-this.maskSprite.position.x/this.maskSprite.width:0,r=this.maskSprite.position.y<0?1-Math.abs(this.maskSprite.position.y)/this.maskSprite.height:(this.originalFrame.height-this.maskSprite.position.y)/this.maskSprite.height;r=Math.min(1,r);var n=this.maskSprite.position.y<0?-this.maskSprite.position.y/this.maskSprite.height:0;this.matrix.a=t,this.matrix.d=r,this.matrix.tx=e,this.matrix.ty=n,this.uniforms.uTransformMatrix=this.matrix}},{key:"setOrigin",value:function(t){this.uniforms.uOriginFrame=t}},{key:"setLayoutMode",value:function(t){switch(t){case"segmentation":this.uniforms.useMask=!0,this.uniforms.distColor=0;break;case"circle":case"hide":this.uniforms.useMask=!1,this.uniforms.distColor=0;break;case"full":this.uniforms.useMask=!1,this.uniforms.distColor=1}}},{key:"setIsBoundaryStrong",value:function(t){this.uniforms.uIsBoundaryStrong=t}}])}();const tsvb_nchwShader="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec2 pixelSize;\nuniform vec2 quarter;\nuniform vec2 _vrScale;\nuniform vec4 toPosTransform;\nuniform vec4 fromPosTransform;\nvec4 readTex(vec2 uv)\n{\n    return texture2D(uSampler, uv);\n}\nvec2 mapInsideChannel(vec2 pos)\n{\n    vec2 result = mod(pos, quarter) * 4.0;\n    result.y += floor(pos.x / quarter.x);\n    \n    return result;\n}\nvec4 extractChannel(vec4 c0, vec4 c1, vec4 c2, vec4 c3, float yPos)\n{\n    vec4 result = vec4(c0.r, c1.r, c2.r, c3.r);\n    \n    float condition = step(quarter.y, yPos);\n    result = mix(result, vec4(c0.g, c1.g, c2.g, c3.g), condition);\n    condition = step(2.0 * quarter.y, yPos);\n    result = mix(result, vec4(c0.b, c1.b, c2.b, c3.b), condition);\n    \n    \n    return result;\n}\nvec2 toPos(vec2 uv)\n{\n    return uv * toPosTransform.xy + toPosTransform.zw;\n}\nvec2 fromPos(vec2 pos)\n{\n    return ( pos * fromPosTransform.xy ) + fromPosTransform.zw;\n}\nvoid main()\n{\n    vec2 uv = vTextureCoord;\n    \n    vec2 pos = toPos(uv);\n    vec2 chPos = mapInsideChannel(pos);\n    uv = fromPos(chPos);\n    \n    vec4 c0 = readTex(uv);\n    uv.x += pixelSize.x; \n    vec4 c1 = readTex(uv);\n    uv.x += pixelSize.x; \n    vec4 c2 = readTex(uv);\n    uv.x += pixelSize.x; \n    vec4 c3 = readTex(uv);\n    gl_FragColor = extractChannel(c0, c1, c2, c3, pos.y);\n}";function tsvb_filterNCHW_typeof(t){return tsvb_filterNCHW_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_filterNCHW_typeof(t)}function tsvb_filterNCHW_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_filterNCHW_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_filterNCHW_toPropertyKey(n.key),n)}}function tsvb_filterNCHW_createClass(t,e,r){return e&&tsvb_filterNCHW_defineProperties(t.prototype,e),r&&tsvb_filterNCHW_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_filterNCHW_toPropertyKey(t){var e=tsvb_filterNCHW_toPrimitive(t,"string");return"symbol"==tsvb_filterNCHW_typeof(e)?e:e+""}function tsvb_filterNCHW_toPrimitive(t,e){if("object"!=tsvb_filterNCHW_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_filterNCHW_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_filterNCHW_callSuper(t,e,r){return e=tsvb_filterNCHW_getPrototypeOf(e),tsvb_filterNCHW_possibleConstructorReturn(t,tsvb_filterNCHW_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_filterNCHW_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_filterNCHW_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_filterNCHW_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_filterNCHW_assertThisInitialized(t)}function tsvb_filterNCHW_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_filterNCHW_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_filterNCHW_isNativeReflectConstruct=function(){return!!t})()}function tsvb_filterNCHW_getPrototypeOf(t){return tsvb_filterNCHW_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_filterNCHW_getPrototypeOf(t)}function tsvb_filterNCHW_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_filterNCHW_setPrototypeOf(t,e)}function tsvb_filterNCHW_setPrototypeOf(t,e){return tsvb_filterNCHW_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_filterNCHW_setPrototypeOf(t,e)}var tsvb_FilterNCHW=function(t){function e(t,r){var n;return tsvb_filterNCHW_classCallCheck(this,e),(n=tsvb_filterNCHW_callSuper(this,e,[void 0,tsvb_nchwShader])).setSize(t,r),n}return tsvb_filterNCHW_inherits(e,src_tsvb_Filter),tsvb_filterNCHW_createClass(e,[{key:"setSize",value:function(t,e){var r=t,n=e;e>128&&(n=256),t<256&&(r=256),this.virtualSize=new tsvb_Point(t,e),this.realSize=new tsvb_Point(r,n),this._vrScale=new tsvb_Point(this.realSize.x/this.virtualSize.x,this.realSize.y/this.virtualSize.y),this.pixelSize=new tsvb_Point(1/this.realSize.x,1/this.realSize.y),this.quarter=new tsvb_Point(this.virtualSize.x/4,this.virtualSize.y/4),this.toPosTransform=[1/((this.virtualSize.x-1)*this.pixelSize.x)*(this.virtualSize.x-1),1/((this.virtualSize.y-1)*this.pixelSize.y)*(this.virtualSize.y-1),-.5*this.pixelSize.x*(1/((this.virtualSize.x-1)*this.pixelSize.x)*(this.virtualSize.x-1)),-.5*this.pixelSize.y*(1/((this.virtualSize.y-1)*this.pixelSize.y)*(this.virtualSize.y-1))],this.fromPosTransform=[(this.virtualSize.x-1)*this.pixelSize.x/(this.virtualSize.x-1),(this.virtualSize.y-1)*this.pixelSize.y/(this.virtualSize.y-1),.5*this.pixelSize.x,.5*this.pixelSize.y],this.uniforms.pixelSize=this.pixelSize,this.uniforms.quarter=this.quarter,this.uniforms.toPosTransform=this.toPosTransform,this.uniforms.fromPosTransform=this.fromPosTransform}}])}();const tsvb_blurKawaseShader="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec2 uOffset;\n\nuniform int uHasMask;\nuniform sampler2D uMask;\n\nuniform int uClamped;\nuniform vec4 filterClamp;\n\nuniform mat3 uTransformMatrix;\n\nbool checkCoord(vec2 coord) {\n  vec4 color = texture2D(uMask, coord);\n  return color.r < 0.5;\n}\n\nvoid main(void ) {\n  vec4 color = vec4(0.0);\n  bool hasMask = uHasMask > 0;\n  bool isClamped = uClamped > 0;\n  bool isInside = hasMask && !checkCoord(vTextureCoord);\n\n  vec2 pickCoord[4];\n  pickCoord[0] = vTextureCoord + vec2(-1.0, +1.0) * uOffset;\n  pickCoord[1] = vTextureCoord + vec2(+1.0, +1.0) * uOffset;\n  pickCoord[2] = vTextureCoord + vec2(+1.0, -1.0) * uOffset;\n  pickCoord[3] = vTextureCoord + vec2(-1.0, -1.0) * uOffset;\n\n  for (int i = 0; i < 4; i += 1) {\n    vec2 coord = pickCoord[i];\n\n    //. Get original point if needed\n    if (hasMask && !isInside && !checkCoord(pickCoord[i])) {\n      coord = vTextureCoord;\n    }\n\n    //. Check clamped mode\n    color += isClamped\n      ? texture2D(uSampler, clamp(coord, filterClamp.xy, filterClamp.zw))\n      : texture2D(uSampler, coord);\n  }\n\n  gl_FragColor = color * 0.25;\n}\n";function tsvb_filterBlurKawase_typeof(t){return tsvb_filterBlurKawase_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_filterBlurKawase_typeof(t)}function tsvb_filterBlurKawase_toConsumableArray(t){return tsvb_filterBlurKawase_arrayWithoutHoles(t)||tsvb_filterBlurKawase_iterableToArray(t)||tsvb_filterBlurKawase_unsupportedIterableToArray(t)||tsvb_filterBlurKawase_nonIterableSpread()}function tsvb_filterBlurKawase_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tsvb_filterBlurKawase_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return tsvb_filterBlurKawase_arrayLikeToArray(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tsvb_filterBlurKawase_arrayLikeToArray(t,e):void 0}}function tsvb_filterBlurKawase_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function tsvb_filterBlurKawase_arrayWithoutHoles(t){if(Array.isArray(t))return tsvb_filterBlurKawase_arrayLikeToArray(t)}function tsvb_filterBlurKawase_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function tsvb_filterBlurKawase_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_filterBlurKawase_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_filterBlurKawase_toPropertyKey(n.key),n)}}function tsvb_filterBlurKawase_createClass(t,e,r){return e&&tsvb_filterBlurKawase_defineProperties(t.prototype,e),r&&tsvb_filterBlurKawase_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_filterBlurKawase_toPropertyKey(t){var e=tsvb_filterBlurKawase_toPrimitive(t,"string");return"symbol"==tsvb_filterBlurKawase_typeof(e)?e:e+""}function tsvb_filterBlurKawase_toPrimitive(t,e){if("object"!=tsvb_filterBlurKawase_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_filterBlurKawase_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_filterBlurKawase_callSuper(t,e,r){return e=tsvb_filterBlurKawase_getPrototypeOf(e),tsvb_filterBlurKawase_possibleConstructorReturn(t,tsvb_filterBlurKawase_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_filterBlurKawase_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_filterBlurKawase_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_filterBlurKawase_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_filterBlurKawase_assertThisInitialized(t)}function tsvb_filterBlurKawase_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_filterBlurKawase_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_filterBlurKawase_isNativeReflectConstruct=function(){return!!t})()}function tsvb_filterBlurKawase_getPrototypeOf(t){return tsvb_filterBlurKawase_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_filterBlurKawase_getPrototypeOf(t)}function tsvb_filterBlurKawase_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_filterBlurKawase_setPrototypeOf(t,e)}function tsvb_filterBlurKawase_setPrototypeOf(t,e){return tsvb_filterBlurKawase_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_filterBlurKawase_setPrototypeOf(t,e)}var tsvb_FilterBlurKawase=function(t){function e(t){var r,n,i;return tsvb_filterBlurKawase_classCallCheck(this,e),(r=tsvb_filterBlurKawase_callSuper(this,e,[void 0,tsvb_blurKawaseShader]))._kernels=[],r._blur=4,r._quality=3,r.isMaskEnabled=!0,r.uniforms.uOffset=new Float32Array(2),r.uniforms.uClamped=t.clamp?1:0,r.uniforms.uHasMask=0,r.uniforms.uMask=tsvb_Texture_Texture.WHITE,r.uniforms.uTransformMatrix=new tsvb_Matrix,r._pixelSize=new tsvb_Point,r.pixelSize=1,r._clamp=!!t.clamp,Array.isArray(t.blur)?r.kernels=t.blur:(r._blur=null!==(n=t.blur)&&void 0!==n?n:4,r.quality=null!==(i=t.quality)&&void 0!==i?i:3),r}return tsvb_filterBlurKawase_inherits(e,src_tsvb_Filter),tsvb_filterBlurKawase_createClass(e,[{key:"apply",value:function(t,e,r,n){var i,s=this._pixelSize.x/e._frame.width,o=this._pixelSize.y/e._frame.height;if(1===this._quality||0===this._blur)i=this._kernels[0]+.5,this.uniforms.uOffset[0]=i*s,this.uniforms.uOffset[1]=i*o,t.applyFilter(this,e,r,n);else{for(var a,u=t.getFilterTexture(),l=e,c=u,h=this._quality-1,f=0;f<h;f++)i=this._kernels[f]+.5,this.uniforms.uOffset[0]=i*s,this.uniforms.uOffset[1]=i*o,t.applyFilter(this,l,c,1),a=l,l=c,c=a;i=this._kernels[h]+.5,this.uniforms.uOffset[0]=i*s,this.uniforms.uOffset[1]=i*o,t.applyFilter(this,l,r,n),t.returnFilterTexture(u)}}},{key:"_updatePadding",value:function(){this.padding=Math.ceil(this._kernels.reduce((function(t,e){return t+e+.5}),0))}},{key:"_generateKernels",value:function(){var t=this._blur,e=this._quality,r=[t];if(t>0)for(var n=t,i=t/e,s=1;s<e;s++)n-=i,r.push(n);this._kernels=r,this._updatePadding()}},{key:"kernels",get:function(){return this._kernels},set:function(t){Array.isArray(t)&&t.length>0?(this._kernels=t,this._quality=t.length,this._blur=Math.max.apply(Math,tsvb_filterBlurKawase_toConsumableArray(t))):(this._kernels=[0],this._quality=1)}},{key:"clamp",get:function(){return this._clamp}},{key:"pixelSize",get:function(){return this._pixelSize},set:function(t){"number"==typeof t?(this._pixelSize.x=t,this._pixelSize.y=t):Array.isArray(t)?(this._pixelSize.x=t[0],this._pixelSize.y=t[1]):t instanceof tsvb_Point?(this._pixelSize.x=t.x,this._pixelSize.y=t.y):(this._pixelSize.x=1,this._pixelSize.y=1)}},{key:"quality",get:function(){return this._quality},set:function(t){this._quality=Math.max(1,Math.round(t)),this._generateKernels()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._generateKernels()}},{key:"enableMask",value:function(){this.isMaskEnabled=!0}},{key:"disableMask",value:function(){this.isMaskEnabled=!1}},{key:"setMask",value:function(t){this.uniforms.uMask=t,this.uniforms.uHasMask=this.isMaskEnabled?1:0}}])}();const tsvb_mirrorShaderVert="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\nuniform mat3 uTransformMatrix;\n\nvec4 filterVertexPosition(void ) {\n  vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.0)) + outputFrame.xy;\n\n  return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord(void ) {\n  return vec2(1.0 - aVertexPosition.x, aVertexPosition.y) * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void ) {\n  gl_Position = filterVertexPosition();\n  vTextureCoord = filterTextureCoord();\n}\n";function tsvb_filterMirror_typeof(t){return tsvb_filterMirror_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_filterMirror_typeof(t)}function tsvb_filterMirror_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_filterMirror_toPropertyKey(n.key),n)}}function tsvb_filterMirror_createClass(t,e,r){return e&&tsvb_filterMirror_defineProperties(t.prototype,e),r&&tsvb_filterMirror_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_filterMirror_toPropertyKey(t){var e=tsvb_filterMirror_toPrimitive(t,"string");return"symbol"==tsvb_filterMirror_typeof(e)?e:e+""}function tsvb_filterMirror_toPrimitive(t,e){if("object"!=tsvb_filterMirror_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_filterMirror_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_filterMirror_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_filterMirror_callSuper(t,e,r){return e=tsvb_filterMirror_getPrototypeOf(e),tsvb_filterMirror_possibleConstructorReturn(t,tsvb_filterMirror_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_filterMirror_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_filterMirror_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_filterMirror_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_filterMirror_assertThisInitialized(t)}function tsvb_filterMirror_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_filterMirror_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_filterMirror_isNativeReflectConstruct=function(){return!!t})()}function tsvb_filterMirror_getPrototypeOf(t){return tsvb_filterMirror_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_filterMirror_getPrototypeOf(t)}function tsvb_filterMirror_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_filterMirror_setPrototypeOf(t,e)}function tsvb_filterMirror_setPrototypeOf(t,e){return tsvb_filterMirror_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_filterMirror_setPrototypeOf(t,e)}var tsvb_FilterMirror=function(t){function e(){return tsvb_filterMirror_classCallCheck(this,e),tsvb_filterMirror_callSuper(this,e,[tsvb_mirrorShaderVert,void 0])}return tsvb_filterMirror_inherits(e,src_tsvb_Filter),tsvb_filterMirror_createClass(e)}();function tsvb_Model_typeof(t){return tsvb_Model_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_Model_typeof(t)}function tsvb_Model_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_Model_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_Model_toPropertyKey(n.key),n)}}function tsvb_Model_createClass(t,e,r){return e&&tsvb_Model_defineProperties(t.prototype,e),r&&tsvb_Model_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_Model_toPropertyKey(t){var e=tsvb_Model_toPrimitive(t,"string");return"symbol"==tsvb_Model_typeof(e)?e:e+""}function tsvb_Model_toPrimitive(t,e){if("object"!=tsvb_Model_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_Model_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_Model_callSuper(t,e,r){return e=tsvb_Model_getPrototypeOf(e),tsvb_Model_possibleConstructorReturn(t,tsvb_Model_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_Model_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_Model_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_Model_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_Model_assertThisInitialized(t)}function tsvb_Model_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_Model_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_Model_isNativeReflectConstruct=function(){return!!t})()}function tsvb_Model_getPrototypeOf(t){return tsvb_Model_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_Model_getPrototypeOf(t)}function tsvb_Model_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_Model_setPrototypeOf(t,e)}function tsvb_Model_setPrototypeOf(t,e){return tsvb_Model_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_Model_setPrototypeOf(t,e)}var tsvb_Model=function(t){function e(){return tsvb_Model_classCallCheck(this,e),tsvb_Model_callSuper(this,e)}return tsvb_Model_inherits(e,tsvb_eventemitter3),tsvb_Model_createClass(e,[{key:"set",value:function(t,e,r){this.preset=t,this.width=e,this.height=r,this.size=4*this.width*this.height,this.emit("update",this)}}])}();function tsvb_bufferPool_typeof(t){return tsvb_bufferPool_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_bufferPool_typeof(t)}function tsvb_bufferPool_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_bufferPool_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_bufferPool_toPropertyKey(n.key),n)}}function tsvb_bufferPool_createClass(t,e,r){return e&&tsvb_bufferPool_defineProperties(t.prototype,e),r&&tsvb_bufferPool_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_bufferPool_toPropertyKey(t){var e=tsvb_bufferPool_toPrimitive(t,"string");return"symbol"==tsvb_bufferPool_typeof(e)?e:e+""}function tsvb_bufferPool_toPrimitive(t,e){if("object"!=tsvb_bufferPool_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_bufferPool_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_BufferPool=function(){return tsvb_bufferPool_createClass((function t(){tsvb_bufferPool_classCallCheck(this,t),this.u8Buffers={},this.f32Buffers={}}),[{key:"getBuffer",value:function(t,e){var r,n;return null!==(n=null===(r=("f32"===t?this.f32Buffers:this.u8Buffers)[e])||void 0===r?void 0:r.pop())&&void 0!==n?n:"f32"===t?new Float32Array(e):new Uint8Array(e)}},{key:"returnBuffer",value:function(t){t instanceof Float32Array?this.returnBufferAs(t,this.f32Buffers,t.length):this.returnBufferAs(t,this.u8Buffers,t.length)}},{key:"returnBufferAs",value:function(t,e,r){var n=e[r];void 0!==n?n.push(t):e[r]=[t]}}])}(),tsvb_PresetType,PresetType;function tsvb_preset_callSuper(t,e,r){return e=tsvb_preset_getPrototypeOf(e),tsvb_preset_possibleConstructorReturn(t,tsvb_preset_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_preset_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_preset_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_preset_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_preset_assertThisInitialized(t)}function tsvb_preset_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_preset_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_preset_isNativeReflectConstruct=function(){return!!t})()}function tsvb_preset_getPrototypeOf(t){return tsvb_preset_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_preset_getPrototypeOf(t)}function tsvb_preset_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_preset_setPrototypeOf(t,e)}function tsvb_preset_setPrototypeOf(t,e){return tsvb_preset_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_preset_setPrototypeOf(t,e)}function tsvb_preset_typeof(t){return tsvb_preset_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_preset_typeof(t)}function tsvb_preset_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_preset_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_preset_toPropertyKey(n.key),n)}}function tsvb_preset_createClass(t,e,r){return e&&tsvb_preset_defineProperties(t.prototype,e),r&&tsvb_preset_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_preset_toPropertyKey(t){var e=tsvb_preset_toPrimitive(t,"string");return"symbol"==tsvb_preset_typeof(e)?e:e+""}function tsvb_preset_toPrimitive(t,e){if("object"!=tsvb_preset_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_preset_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}PresetType=tsvb_PresetType||(tsvb_PresetType={}),PresetType.SPEED="speed",PresetType.BALANCED="balanced",PresetType.QUALITY="quality",PresetType.LIGHTNING="lightning";var tsvb_SegmentationModel=function(){return tsvb_preset_createClass((function t(e){tsvb_preset_classCallCheck(this,t),this.isLandscape=!0,this.sdkOptions=e,this.landscapeSize={height:144,width:256},this.portraitSize={height:192,width:192},this.updateOrientation()}),[{key:"isOrientationChanged",value:function(){return this.isLandscape!=this.sdkOptions.isLandscape()}},{key:"updateOrientation",value:function(){this.isLandscape=this.sdkOptions.isLandscape()}},{key:"getModelSize",value:function(){return this.isLandscape?this.landscapeSize:this.portraitSize}},{key:"getURL",value:function(){var t=this.isLandscape?"PRESETS":"PRESETS_PORTRAIT",e=tsvb_src_settings.yy[t][this.preset];return e?tsvb_src_settings.yy.getPresetUrl(e):tsvb_src_settings.yy.MODEL_URL}}])}(),tsvb_SegmentationModelQuality=function(t){function e(t){var r;return tsvb_preset_classCallCheck(this,e),(r=tsvb_preset_callSuper(this,e,[t])).preset=tsvb_PresetType.QUALITY,r}return tsvb_preset_inherits(e,tsvb_SegmentationModel),tsvb_preset_createClass(e)}(),tsvb_SegmentationModelBalanced=function(t){function e(t){var r;return tsvb_preset_classCallCheck(this,e),(r=tsvb_preset_callSuper(this,e,[t])).preset=tsvb_PresetType.BALANCED,r.landscapeSize={height:128,width:256},r}return tsvb_preset_inherits(e,tsvb_SegmentationModel),tsvb_preset_createClass(e)}(),tsvb_SegmentationModelSpeed=function(t){function e(t){var r;return tsvb_preset_classCallCheck(this,e),(r=tsvb_preset_callSuper(this,e,[t])).preset=tsvb_PresetType.SPEED,r.landscapeSize={height:160,width:256},r}return tsvb_preset_inherits(e,tsvb_SegmentationModel),tsvb_preset_createClass(e)}(),tsvb_SegmentationModelLightning=function(t){function e(t){var r;return tsvb_preset_classCallCheck(this,e),(r=tsvb_preset_callSuper(this,e,[t])).preset=tsvb_PresetType.LIGHTNING,r}return tsvb_preset_inherits(e,tsvb_SegmentationModel),tsvb_preset_createClass(e)}(),tsvb_PresetManager=function(){return tsvb_preset_createClass((function t(e){tsvb_preset_classCallCheck(this,t),this.modelMap=new Map,this.modelMap.set(tsvb_PresetType.BALANCED,new tsvb_SegmentationModelBalanced(e)),this.modelMap.set(tsvb_PresetType.QUALITY,new tsvb_SegmentationModelQuality(e)),this.modelMap.set(tsvb_PresetType.SPEED,new tsvb_SegmentationModelSpeed(e)),this.modelMap.set(tsvb_PresetType.LIGHTNING,new tsvb_SegmentationModelLightning(e))}),[{key:"isOrientationChanged",value:function(t){var e;return null===(e=this.getModel(t))||void 0===e?void 0:e.isOrientationChanged()}},{key:"updateOrientation",value:function(){return this.modelMap.forEach((function(t,e){t.updateOrientation()}))}},{key:"getModelSize",value:function(t){var e,r;return null!==(r=null===(e=this.getModel(t))||void 0===e?void 0:e.getModelSize())&&void 0!==r?r:{height:144,width:256}}},{key:"getModelURL",value:function(t){var e,r;return null!==(r=null===(e=this.getModel(t))||void 0===e?void 0:e.getURL())&&void 0!==r?r:""}},{key:"getModel",value:function(t){return this.modelMap.has(t)?this.modelMap.get(t):(tsvb_errorBus.bv.notify({emitter:tsvb_errorBus.JK.PRESET_INIT,message:"Can't find preset ".concat(t)}),null)}}])}();function tsvb_Background_typeof(t){return tsvb_Background_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_Background_typeof(t)}function tsvb_Background_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_Background_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_Background_toPropertyKey(n.key),n)}}function tsvb_Background_createClass(t,e,r){return e&&tsvb_Background_defineProperties(t.prototype,e),r&&tsvb_Background_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_Background_toPropertyKey(t){var e=tsvb_Background_toPrimitive(t,"string");return"symbol"==tsvb_Background_typeof(e)?e:e+""}function tsvb_Background_toPrimitive(t,e){if("object"!=tsvb_Background_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_Background_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_Background_callSuper(t,e,r){return e=tsvb_Background_getPrototypeOf(e),tsvb_Background_possibleConstructorReturn(t,tsvb_Background_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_Background_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_Background_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_Background_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_Background_assertThisInitialized(t)}function tsvb_Background_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_Background_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_Background_isNativeReflectConstruct=function(){return!!t})()}function tsvb_Background_getPrototypeOf(t){return tsvb_Background_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_Background_getPrototypeOf(t)}function tsvb_Background_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_Background_setPrototypeOf(t,e)}function tsvb_Background_setPrototypeOf(t,e){return tsvb_Background_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_Background_setPrototypeOf(t,e)}var tsvb_Background=function(t){function e(t,r,n){var i;return tsvb_Background_classCallCheck(this,e),(i=tsvb_Background_callSuper(this,e)).filters={blur:{}},i.sdkOptions=t,i.type="origin",i.options=Object.assign({},e.defaultOptions,n),i.frame=r,i.filters.blur=new tsvb_FilterBlurKawase({blur:5,quality:5}),i.backgroundTrack=new tsvb_VideoTrack,i.backgroundTrack.on("ended",i.clearBackground,i),i.backgroundTrack.on("update",i.calculateBackgroundSize,i),i.globalWidth=t.width,i.globalHeight=t.height,i.sdkOptions.on("update",i.onOptionsUpdate,i),i}return tsvb_Background_inherits(e,tsvb_eventemitter3),tsvb_Background_createClass(e,[{key:"destroy",value:function(){this.backgroundTrack.off("ended",this.clearBackground,this),this.backgroundTrack.off("update",this.calculateBackgroundSize,this),this.sdkOptions.off("update",this.onOptionsUpdate,this)}},{key:"onOptionsUpdate",value:function(t){this.globalWidth=t.width,this.globalHeight=t.height,this.frame.resize(this.globalWidth,this.globalHeight),this.calculateBackgroundSize()}},{key:"render",value:function(){this.backgroundTrack.update(),document.hidden&&this.frame.frame.texture.baseTexture.resource&&this.frame.frame.texture.baseTexture.resource.source instanceof HTMLVideoElement&&this.frame.frame.texture.baseTexture.update()}},{key:"set",value:function(t){this.backgroundTrack.stop(),this.applyBackground(t)}},{key:"applyBlur",value:function(t){this.frame.frame.filters=[],this.filters.blur.disableMask(),t&&(this.filters.blur.blur=+t,this.frame.frame.filters.push(this.filters.blur),"origin"==this.frame.active&&this.filters.blur.enableMask())}},{key:"setMask",value:function(t){this.filters.blur.blur&&this.filters.blur.setMask(t)}},{key:"applyBackground",value:function(t){var e,r=this;if(this.frame.frame.tint="color"==t?this.options.color:16777215,this.options.source!=t){if(this.options.source=t,null==t)return this.type="origin",void(this.frame.active!==this.type&&(this.frame.activateTexture(this.type),this.calculateBackgroundSize(),(null===(e=this.frame.frame.filters)||void 0===e?void 0:e.length)&&"origin"==this.frame.active?this.filters.blur.enableMask():this.filters.blur.disableMask()));var n,i,s;switch(t.constructor){case String:"color"==t?(this.type="color",n=tsvb_Texture_Texture.WHITE):(n=t,this.type="url");break;case MediaStream:this.backgroundTrack.set(t),(i=document.createElement("video")).srcObject=t,n=i,this.type="media_stream";break;case CanvasCaptureMediaStreamTrack:case BrowserCaptureMediaStreamTrack:case MediaStreamTrack:s=new MediaStream([t]),this.backgroundTrack.set(s),(i=document.createElement("video")).srcObject=s,n=i,this.type="media_stream_track";break;case HTMLVideoElement:n=t,this.type="video"}if(n&&n instanceof tsvb_Texture_Texture)this.texture=n;else{if(t.constructor==String)return void tsvb_Texture_Texture.fromURL(n).then((function(t){r.texture=t,r.onBackgroundLoaded()}));this.texture=tsvb_Texture_Texture.from(n)}this.texture.baseTexture.valid?this.onBackgroundLoaded():this.texture.baseTexture.once("loaded",(function(){return r.onBackgroundLoaded()}))}}},{key:"onBackgroundLoaded",value:function(){this.texture.baseTexture&&(this.frame.addTexture("swap",this.texture),this.switchBackground(),this.calculateBackgroundSize(),this.loopAndRestart())}},{key:"loopAndRestart",value:function(){this.frame.frame.texture.baseTexture.resource.source instanceof HTMLVideoElement&&(this.frame.frame.texture.baseTexture.resource.source.loop=!0,this.frame.frame.texture.baseTexture.resource.source.currentTime=0,this.frame.frame.texture.baseTexture.resource.source.muted=!0)}},{key:"setColor",value:function(t){this.options.color=t,this.frame.frame.tint=this.options.color}},{key:"switchBackground",value:function(){var t;this.frame.activateTexture("swap"),"color"==this.type&&(this.frame.frame.tint=this.options.color),(null===(t=this.frame.frame.filters)||void 0===t?void 0:t.length)&&"origin"==this.frame.active?this.filters.blur.enableMask():this.filters.blur.disableMask(),this.emit("update",this)}},{key:"clearBackground",value:function(){this.backgroundTrack.stop(),this.applyBackground(null),this.emit("clear",this)}},{key:"updateBackgroundSize",value:function(t,e,r,n){this.frame.frame.width=r,this.frame.frame.height=n,this.frame.frame.x=t,this.frame.frame.y=e}},{key:"setFitMode",value:function(t){this.options.fit_mode=t,this.calculateBackgroundSize()}},{key:"calculateBackgroundSize",value:function(){var t=this.globalWidth,e=this.globalHeight;if("color"!=this.type&&"origin"!=this.type){if(!(this.frame.frame.texture.baseTexture.width<20)){var r=this.frame.frame.texture.baseTexture.width/this.frame.frame.texture.baseTexture.height;"fill"==this.options.fit_mode?t/r>=e?this.updateBackgroundSize(0,-Math.abs(e-t/r)/2,t,t/r):this.updateBackgroundSize(-Math.abs(t-e*r)/2,0,e*r,e):t/r<=e?this.updateBackgroundSize(0,Math.abs(e-t/r)/2,t,t/r):this.updateBackgroundSize(Math.abs(t-e*r)/2,0,e*r,e)}}else this.updateBackgroundSize(0,0,t,e)}}])}(),tsvb_LayoutMode,LayoutMode;function tsvb_virtual_background_effect_typeof(t){return tsvb_virtual_background_effect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_virtual_background_effect_typeof(t)}function tsvb_virtual_background_effect_regeneratorRuntime(){tsvb_virtual_background_effect_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_virtual_background_effect_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_virtual_background_effect_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_virtual_background_effect_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_virtual_background_effect_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_virtual_background_effect_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_virtual_background_effect_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_virtual_background_effect_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_virtual_background_effect_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_virtual_background_effect_toPropertyKey(n.key),n)}}function tsvb_virtual_background_effect_createClass(t,e,r){return e&&tsvb_virtual_background_effect_defineProperties(t.prototype,e),r&&tsvb_virtual_background_effect_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_virtual_background_effect_toPropertyKey(t){var e=tsvb_virtual_background_effect_toPrimitive(t,"string");return"symbol"==tsvb_virtual_background_effect_typeof(e)?e:e+""}function tsvb_virtual_background_effect_toPrimitive(t,e){if("object"!=tsvb_virtual_background_effect_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_virtual_background_effect_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_virtual_background_effect_callSuper(t,e,r){return e=tsvb_virtual_background_effect_getPrototypeOf(e),tsvb_virtual_background_effect_possibleConstructorReturn(t,tsvb_virtual_background_effect_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_virtual_background_effect_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_virtual_background_effect_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_virtual_background_effect_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_virtual_background_effect_assertThisInitialized(t)}function tsvb_virtual_background_effect_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_virtual_background_effect_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_virtual_background_effect_isNativeReflectConstruct=function(){return!!t})()}function tsvb_virtual_background_effect_getPrototypeOf(t){return tsvb_virtual_background_effect_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_virtual_background_effect_getPrototypeOf(t)}function tsvb_virtual_background_effect_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_virtual_background_effect_setPrototypeOf(t,e)}function tsvb_virtual_background_effect_setPrototypeOf(t,e){return tsvb_virtual_background_effect_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_virtual_background_effect_setPrototypeOf(t,e)}tsvb_Background.defaultOptions={source:null,fit_mode:"fill",color:16777215},LayoutMode=tsvb_LayoutMode||(tsvb_LayoutMode={}),LayoutMode.SEGMENTATION="segmentation",LayoutMode.FULL="full",LayoutMode.HIDE="hide",LayoutMode.TRANSPARENT="transparent",LayoutMode.CIRCLE="circle";var tsvb_VirtualBackgroundEffect=function(t){function e(t,r){var n;return tsvb_virtual_background_effect_classCallCheck(this,e),(n=tsvb_virtual_background_effect_callSuper(this,e,[t])).pixels=[],n.filters={blurMask:{},show:{},beautification:{},nchw:{},mirror:{}},n.skip_frames_counter=0,n.customLayoutOptions={width:1280,height:720,xOffset:0,yOffset:0},n.customLayoutOptions.width=t.width,n.customLayoutOptions.height=t.height,n.customer_id=r,n.presetManager=new tsvb_PresetManager(n.sdkOptions),n.inferenceTimer=new tsvb_FrameTimer,n.drawTimer=new tsvb_FrameTimer,n.settings={boundary_level:0,boundary_mode:"strong",beautification:!1,beautification_level:.48,beautification_highpass:!0,beautification_radius:7,beautification_blur_type:tsvb_BlurType.boxBilateral,blur:0,layout:"center",preset:tsvb_src_settings.yy.PRESET,skip_frames:!1,layout_mode:tsvb_LayoutMode.SEGMENTATION},n.bufferPool=new tsvb_BufferPool,n.model=new tsvb_Model,n.model.on("update",n.updateModelSize,n),n.is_running=!1,n.isNewPreset=!1,n.enable(),n}return tsvb_virtual_background_effect_inherits(e,tsvb_AbstractEffect),tsvb_virtual_background_effect_createClass(e,[{key:"onOptionsUpdate",value:function(){this.original.resize(this.sdkOptions.width,this.sdkOptions.height),this.mask.resize(this.sdkOptions.width,this.sdkOptions.height),this.effectContainer.height=this.sdkOptions.height,this.effectContainer.width=this.sdkOptions.width,this.applyLayout()}},{key:"clearBuffers",value:function(){this.pixels=[],this.bufferPool=new tsvb_BufferPool}},{key:"nextFrame",value:function(t){var e,r;if(this.enabled&&this.isActive()&&!(this.pixels.length>0)){if(this.small.addTexture("frame",t.texture),this.small.activateTexture("frame"),this.resources.transform){var n=this.resources.transform.xOffset,i=this.resources.transform.yOffset,s=Math.abs(this.sdkOptions.width*this.resources.transform.scaleValue),o=Math.abs(this.sdkOptions.height*this.resources.transform.scaleValue);this.resources.mirror&&(n=this.sdkOptions.width-this.resources.transform.xOffset-s),this.small.frame.texture.trim=new tsvb_Rectangle(n,i,s,o)}this.resources.mirror&&(null===(e=this.small.frame.filters)||void 0===e||e.push(this.filters.mirror)),null===(r=this.small.frame.filters)||void 0===r||r.push(this.filters.nchw),this.resources.renderer.renderTo(this.small.frame,this.small.getBuffer("model")),this.small.frame.filters=[],this.small.frame.texture.trim=new tsvb_Rectangle(0,0,this.sdkOptions.width,this.sdkOptions.height),this.small.activateTexture("origin");var a=this.small.getBuffer("model"),u=this.resources.renderer.pixelsAsync(a,{pool:this.bufferPool});this.pixels.push(u)}}},{key:"init",value:(o=tsvb_virtual_background_effect_asyncToGenerator(tsvb_virtual_background_effect_regeneratorRuntime().mark((function t(e){var r=this;return tsvb_virtual_background_effect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.disable(),this.inference=e,this.inference.sessionManager.setPresetManager(this.presetManager),this.inference.sessionManager.setPreset(this.settings.preset),t.next=6,this.setPreset(this.settings.preset);case 6:return t.abrupt("return",this.inference.sessionManager.init(this.customer_id,tsvb_ModelType.SEGMENTATION).then((function(){r.enable()})));case 7:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"setPreset",value:(s=tsvb_virtual_background_effect_asyncToGenerator(tsvb_virtual_background_effect_regeneratorRuntime().mark((function t(e){var r,n,i;return tsvb_virtual_background_effect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.model.preset!=e||this.presetManager.isOrientationChanged(this.model.preset)){t.next=2;break}return t.abrupt("return");case 2:if(!this.onProcessPromise||!this.onProcessPromise.isPending()){t.next=5;break}return t.next=5,this.onProcessPromise.promise;case 5:this.isNewPreset=!0,this.settings.preset=e,this.presetManager.updateOrientation(),r=this.presetManager.getModelSize(e),n=r.width,i=r.height,this.model.set(e,n,i);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"updateModelSize",value:(i=tsvb_virtual_background_effect_asyncToGenerator(tsvb_virtual_background_effect_regeneratorRuntime().mark((function t(){var e,r;return tsvb_virtual_background_effect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.pixelBuffer=new Uint8Array(this.model.width*this.model.height*4).fill(255),this.model.previous=new Float32Array(this.model.size/4),this.clearBuffers(),null===(e=this.small)||void 0===e||e.resize(this.model.width,this.model.height),null===(r=this.mask)||void 0===r||r.resize(this.model.width,this.model.height),this.filters.nchw=new tsvb_FilterNCHW(this.model.width,this.model.height),this.filters.nchw.setSize(this.model.width,this.model.height),this.mask&&this.applyLayout();case 8:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"prepare",value:function(){var t=this.model.width,e=this.model.height;this.effectContainer=new src_tsvb_Container,this.effectContainer.height=this.sdkOptions.height,this.effectContainer.width=this.sdkOptions.width,this.original=new tsvb_Frame(this.resources.texture,{width:this.sdkOptions.width,height:this.sdkOptions.height}),this.original.addBuffer("result"),this.background=new tsvb_Background(this.sdkOptions,new tsvb_Frame(this.resources.texture,{width:this.sdkOptions.width,height:this.sdkOptions.height})),this.small=new tsvb_Frame(this.resources.texture,{width:t,height:e}),this.small.addBuffer("model"),this.small.addBuffer("mask"),this.mask=new tsvb_Frame(this.small.getBuffer("mask"),{width:this.sdkOptions.width,height:this.sdkOptions.height}),this.pixelBuffer=new Uint8Array(this.model.width*this.model.height*4).fill(255),this.prepareFilters(),this.applyBlur(),this.updateModelSize(),this.sdkOptions.on("update",this.onOptionsUpdate,this)}},{key:"prepareFilters",value:function(){var t={uIsBoundaryStrong:"strong"===this.settings.boundary_mode,uOriginFrame:this.original.frame.texture,useMask:!0,distColor:1};this.filters.blurMask=new tsvb_FilterBlurKawase({blur:.1,quality:4,clamp:!0}),this.filters.show=new tsvb_FilterShow(t,this.original.frame,this.mask.frame),this.filters.nchw=new tsvb_FilterNCHW(this.model.width,this.model.height),this.filters.mirror=new tsvb_FilterMirror,this.updateBeautyFilter(),this.mask.frame.filters=[this.filters.show]}},{key:"updateBeautyFilter",value:function(){this.filters.beautification=new tsvb_FilterBeauty({uBeautificationLevel:this.settings.beautification_level,uWidth:this.mask.frame.width,uHeight:this.mask.frame.height,radius:this.settings.beautification_radius,highpassEnabled:this.settings.beautification_highpass,sigma:this.settings.beautification_sigma,blurType:this.settings.beautification_blur_type})}},{key:"updateMaskFilters",value:function(){this.mask.frame.filters=[this.filters.show],this.settings.beautification&&this.mask.frame.filters.push(this.filters.beautification)}},{key:"clearBackground",value:function(){this.background.clearBackground()}},{key:"process",value:(n=tsvb_virtual_background_effect_asyncToGenerator(tsvb_virtual_background_effect_regeneratorRuntime().mark((function t(){var e;return tsvb_virtual_background_effect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled){t.next=2;break}return t.abrupt("return");case 2:if(!this.onProcessPromise||!this.onProcessPromise.isPending()){t.next=5;break}return t.next=5,this.onProcessPromise.promise;case 5:if(this.onProcessPromise=new tsvb_Deferred,this.drawTimer.start(),this.inference&&this.inference.isReady(tsvb_ModelType.SEGMENTATION)){t.next=9;break}return t.abrupt("return");case 9:if(t.prev=9,!this.shouldSegmentationRun()){t.next=13;break}return t.next=13,this.prepareSegmentationMask();case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(9),this.disable(),t.t0&&tsvb_errorBus.bv.notify({message:"Prepare segmentation mask. "+(null!==(e=t.t0.message)&&void 0!==e?e:t.t0),emitter:tsvb_errorBus.JK.EFFECT_VIRTUAL_BACKGROUND,cause:t.t0});case 19:this.skip_frames_counter=this.skip_frames_counter?0:1,this.isActive()?(this.filters.show.setOrigin(this.original.frame.texture),this.settings.layout_mode!=tsvb_LayoutMode.TRANSPARENT&&(this.resources.renderer.addToEffects(this.background.frame.frame),this.background.render()),this.resources.renderer.addToEffects(this.mask.frame)):this.resources.renderer.addToEffects(this.original.frame),this.resources.renderer.addStatistics(),this.resources.renderer.render(),this.resources.renderer.removeStatistics(),this.resources.renderer.removeFromEffects(this.background.frame.frame),this.resources.renderer.removeFromEffects(this.mask.frame),this.drawTimer.finish(),this.resources.renderer.updateStatistics("frame_time",this.drawTimer.getFrameTime()),this.resources.renderer.updateStatistics("inference_time",this.inferenceTimer.getFrameTime()),this.onProcessPromise.resolve();case 30:case"end":return t.stop()}}),t,this,[[9,15]])}))),function(){return n.apply(this,arguments)})},{key:"isActive",value:function(){return null!==this.background.options.source||("center"!==this.settings.layout||(!!this.settings.blur||!!this.settings.beautification))}},{key:"shouldSegmentationRun",value:function(){return(!this.settings.skip_frames||!this.skip_frames_counter)&&((this.settings.layout_mode===tsvb_LayoutMode.SEGMENTATION||this.settings.layout_mode===tsvb_LayoutMode.TRANSPARENT)&&this.isActive())}},{key:"setBoundaryMode",value:function(t){this.settings.boundary_mode=t,this.filters.show.setIsBoundaryStrong("strong"===t)}},{key:"setBoundaryLevel",value:function(t){tsvb_errorBus.bv.notify({type:tsvb_errorBus.By.INFO,message:"Boundary level was deprecated and will not show any effect.",emitter:tsvb_errorBus.JK.EFFECT_VIRTUAL_BACKGROUND})}},{key:"setBeautificationLevel",value:function(t){t=.34+.34*(t=1-Math.min(Math.max(Number(t),0),1)),this.filters.beautification.setBeautificationLevel(t)}},{key:"enableFrameSkipping",value:function(){this.settings.skip_frames=!0}},{key:"disableFrameSkipping",value:function(){this.settings.skip_frames=!1}},{key:"enableBeautification",value:function(){this.settings.beautification||(this.mask.frame.filters.push(this.filters.beautification),this.settings.beautification=!0)}},{key:"disableBeautification",value:function(){this.settings.beautification&&(this.mask.frame.filters.pop(),this.settings.beautification=!1)}},{key:"getPreset",value:function(){return this.settings.preset}},{key:"setLayout",value:function(t){this.settings.layout=t,this.applyLayout()}},{key:"setLayoutMode",value:function(t){this.settings.layout_mode=t,this.filters.show.setLayoutMode(t)}},{key:"setCustomLayout",value:function(t){var e=this;Object.keys(t).forEach((function(r){e.customLayoutOptions[r]=t[r]})),this.updateMaskPosition(this.customLayoutOptions.width,this.customLayoutOptions.height,this.customLayoutOptions.xOffset,this.customLayoutOptions.yOffset)}},{key:"applyLayout",value:function(){switch(this.settings.layout){case"left":this.updateMaskPosition(this.sdkOptions.width,this.sdkOptions.height,-this.sdkOptions.width/4,0);break;case"right":this.updateMaskPosition(this.sdkOptions.width,this.sdkOptions.height,this.sdkOptions.width/4,0);break;case"left-bottom":this.updateMaskPosition(this.sdkOptions.width/2,this.sdkOptions.height/2,0,this.sdkOptions.height/2);break;case"right-bottom":this.updateMaskPosition(this.sdkOptions.width/2,this.sdkOptions.height/2,this.sdkOptions.width/2,this.sdkOptions.height/2);break;case"center":this.updateMaskPosition(this.sdkOptions.width,this.sdkOptions.height,0,0)}}},{key:"updateMaskPosition",value:function(t,e,r,n){this.mask.frame.width=t,this.mask.frame.height=e,this.mask.frame.position.x=r,this.mask.frame.position.y=n,this.filters.show.setLayout()}},{key:"setBackground",value:function(t){this.background.set(t)}},{key:"setBackgroundFitMode",value:function(t){this.background.setFitMode(t)}},{key:"setBackgroundColor",value:function(t){this.background.setColor(t)}},{key:"setBlur",value:function(t){this.settings.blur=t,this.applyBlur()}},{key:"clearBlur",value:function(){this.settings.blur=0,this.applyBlur()}},{key:"applyBlur",value:function(){this.background.applyBlur(this.settings.blur)}},{key:"prepareSegmentationMask",value:(r=tsvb_virtual_background_effect_asyncToGenerator(tsvb_virtual_background_effect_regeneratorRuntime().mark((function t(){var e,r,n,i,s,o,a=this;return tsvb_virtual_background_effect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled){t.next=2;break}return t.abrupt("return");case 2:if(e=this.model.width,r=this.model.height,this.pixels.length){t.next=6;break}return t.abrupt("return");case 6:return t.prev=6,t.next=9,this.pixels.shift();case 9:n=t.sent,t.next=15;break;case 12:return t.prev=12,t.t0=t.catch(6),t.abrupt("return");case 15:if((null==n?void 0:n.length)==4*e*r){t.next=17;break}return t.abrupt("return");case 17:return i=3*e*r,(s=this.bufferPool.getBuffer("f32",4*e*r)).set(n.subarray(0,i)),s.set(this.model.previous,i),this.bufferPool.returnBuffer(n),this.inferenceTimer.start(),o={seg:{data:this.bufferPool.getBuffer("f32",e*r),dims:[1,1,r,e]}},t.abrupt("return",this.inference.run(s,e,r,tsvb_ModelType.SEGMENTATION,o).then((function(t){var n,i,s,o;if(a.inferenceTimer.finish(),a.isNewPreset)a.isNewPreset=!1;else{a.bufferPool.returnBuffer(null!==(n=t.inputBack.data)&&void 0!==n?n:t.inputBack);var u=null!==(o=null!==(s=null===(i=t.seg)||void 0===i?void 0:i.data)&&void 0!==s?s:t.seg)&&void 0!==o?o:t;a.model.previous&&a.bufferPool.returnBuffer(a.model.previous),a.model.previous=u;for(var l=0;l<a.model.previous.length;l++)a.pixelBuffer[4*l+3]=255*u[l];var c=a.resources.renderer.createTextureFromBuffer(a.pixelBuffer,e,r);a.small.addTexture("mask",c,!1),a.small.activateTexture("mask"),a.small.frame.filters=[a.filters.blurMask],a.resources.renderer.renderTo(a.small.frame,a.small.getBuffer("mask")),a.small.frame.filters=[],a.small.activateTexture("origin"),c.destroy(!0),a.background.setMask(a.small.getBuffer("mask"))}})).catch((function(t){var e;tsvb_errorBus.bv.notify({message:null!==(e=t.message)&&void 0!==e?e:t,emitter:tsvb_errorBus.JK.EFFECT_VIRTUAL_BACKGROUND,cause:t})})));case 25:case"end":return t.stop()}}),t,this,[[6,12]])}))),function(){return r.apply(this,arguments)})},{key:"setBeauty",value:function(t){this.settings.beautification_radius=t.rad||this.settings.beautification_radius,null!==t.highpass&&void 0!==t.highpass&&(this.settings.beautification_highpass=t.highpass),this.settings.beautification_sigma=t.sigma||this.settings.beautification_sigma,t.blur&&(this.settings.beautification_blur_type=t.blur),this.updateBeautyFilter(),this.settings.beautification&&this.updateMaskFilters()}},{key:"destroy",value:function(){this.disable(),this.clearBuffers(),this.sdkOptions.off("update",this.onOptionsUpdate,this),this.model.off("update",this.updateModelSize,this),this.background.destroy()}}]);var r,n,i,s,o}();const tsvb_lowLightShader="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D uLL;\nuniform int uEnabled;\n\nvoid main() {\n  vec4 texel = texture2D(uSampler, vTextureCoord);\n\n  if (uEnabled == 0) {\n    gl_FragColor = vec4(texel);\n    return;\n  }\n\n  vec3 curve = texture2D(uLL, vTextureCoord).rgb;\n\n  vec3 x = texel.rgb + curve * (texel.rgb * texel.rgb - texel.rgb);\n\n  x = x - curve * (x * x - x);\n  x = x - curve * (x * x - x);\n  x = x - curve * (x * x - x);\n  x = x - curve * (x * x - x);\n  x = x - curve * (x * x - x);\n  x = x - curve * (x * x - x);\n  x = x - curve * (x * x - x);\n\n  x = clamp(x, 0.0, 1.0);\n\n  gl_FragColor = vec4(x, texel.a);\n}\n";function tsvb_filterLowLight_typeof(t){return tsvb_filterLowLight_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_filterLowLight_typeof(t)}function tsvb_filterLowLight_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_filterLowLight_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_filterLowLight_toPropertyKey(n.key),n)}}function tsvb_filterLowLight_createClass(t,e,r){return e&&tsvb_filterLowLight_defineProperties(t.prototype,e),r&&tsvb_filterLowLight_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_filterLowLight_toPropertyKey(t){var e=tsvb_filterLowLight_toPrimitive(t,"string");return"symbol"==tsvb_filterLowLight_typeof(e)?e:e+""}function tsvb_filterLowLight_toPrimitive(t,e){if("object"!=tsvb_filterLowLight_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_filterLowLight_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_filterLowLight_callSuper(t,e,r){return e=tsvb_filterLowLight_getPrototypeOf(e),tsvb_filterLowLight_possibleConstructorReturn(t,tsvb_filterLowLight_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_filterLowLight_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_filterLowLight_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_filterLowLight_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_filterLowLight_assertThisInitialized(t)}function tsvb_filterLowLight_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_filterLowLight_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_filterLowLight_isNativeReflectConstruct=function(){return!!t})()}function tsvb_filterLowLight_getPrototypeOf(t){return tsvb_filterLowLight_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_filterLowLight_getPrototypeOf(t)}function tsvb_filterLowLight_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_filterLowLight_setPrototypeOf(t,e)}function tsvb_filterLowLight_setPrototypeOf(t,e){return tsvb_filterLowLight_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_filterLowLight_setPrototypeOf(t,e)}var tsvb_FilterLowLight=function(t){function e(){return tsvb_filterLowLight_classCallCheck(this,e),tsvb_filterLowLight_callSuper(this,e,[void 0,tsvb_lowLightShader,{uLL:tsvb_Texture_Texture.EMPTY,uEnabled:0}])}return tsvb_filterLowLight_inherits(e,src_tsvb_Filter),tsvb_filterLowLight_createClass(e,[{key:"setLowLightTexture",value:function(t){this.uniforms.uLL=t,this.uniforms.uEnabled=1}}])}();function tsvb_lowlightPreprocess(t,e,r,n){for(var i=r*e,s=2*r*e,o=0;o<n.length/3;o++)n[0+o]=t[4*o+2]/255,n[i+o]=t[4*o]/127.5,n[s+o]=t[4*o+1]/127.5}var tsvb_DEFAULT_CONFIG={modelHeight:144,modelWidth:144,power:1};const tsvb_proxyMarker=Symbol("Comlink.proxy"),tsvb_createEndpoint=Symbol("Comlink.endpoint"),tsvb_releaseProxy=Symbol("Comlink.releaseProxy"),tsvb_finalizer=Symbol("Comlink.finalizer"),tsvb_throwMarker=Symbol("Comlink.thrown"),tsvb_isObject=t=>"object"==typeof t&&null!==t||"function"==typeof t,tsvb_proxyTransferHandler={canHandle:t=>tsvb_isObject(t)&&t[tsvb_proxyMarker],serialize(t){const{port1:e,port2:r}=new MessageChannel;return tsvb_expose(t,e),[r,[r]]},deserialize:t=>(t.start(),tsvb_wrap(t))},tsvb_throwTransferHandler={canHandle:t=>tsvb_isObject(t)&&tsvb_throwMarker in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}},tsvb_transferHandlers=new Map([["proxy",tsvb_proxyTransferHandler],["throw",tsvb_throwTransferHandler]]);function tsvb_isAllowedOrigin(t,e){for(const r of t){if(e===r||"*"===r)return!0;if(r instanceof RegExp&&r.test(e))return!0}return!1}function tsvb_expose(t,e=globalThis,r=["*"]){e.addEventListener("message",(function n(i){if(!i||!i.data)return;if(!tsvb_isAllowedOrigin(r,i.origin))return void console.warn(`Invalid origin '${i.origin}' for comlink proxy`);const{id:s,type:o,path:a}=Object.assign({path:[]},i.data),u=(i.data.argumentList||[]).map(tsvb_fromWireValue);let l;try{const e=a.slice(0,-1).reduce(((t,e)=>t[e]),t),r=a.reduce(((t,e)=>t[e]),t);switch(o){case"GET":l=r;break;case"SET":e[a.slice(-1)[0]]=tsvb_fromWireValue(i.data.value),l=!0;break;case"APPLY":l=r.apply(e,u);break;case"CONSTRUCT":l=tsvb_proxy(new r(...u));break;case"ENDPOINT":{const{port1:e,port2:r}=new MessageChannel;tsvb_expose(t,r),l=tsvb_transfer(e,[e])}break;case"RELEASE":l=void 0;break;default:return}}catch(t){l={value:t,[tsvb_throwMarker]:0}}Promise.resolve(l).catch((t=>({value:t,[tsvb_throwMarker]:0}))).then((r=>{const[i,a]=tsvb_toWireValue(r);e.postMessage(Object.assign(Object.assign({},i),{id:s}),a),"RELEASE"===o&&(e.removeEventListener("message",n),tsvb_closeEndPoint(e),tsvb_finalizer in t&&"function"==typeof t[tsvb_finalizer]&&t[tsvb_finalizer]())})).catch((t=>{const[r,n]=tsvb_toWireValue({value:new TypeError("Unserializable return value"),[tsvb_throwMarker]:0});e.postMessage(Object.assign(Object.assign({},r),{id:s}),n)}))})),e.start&&e.start()}function tsvb_isMessagePort(t){return"MessagePort"===t.constructor.name}function tsvb_closeEndPoint(t){tsvb_isMessagePort(t)&&t.close()}function tsvb_wrap(t,e){const r=new Map;return t.addEventListener("message",(function(t){const{data:e}=t;if(!e||!e.id)return;const n=r.get(e.id);if(n)try{n(e)}finally{r.delete(e.id)}})),tsvb_createProxy(t,r,[],e)}function tsvb_throwIfProxyReleased(t){if(t)throw new Error("Proxy has been released and is not useable")}function tsvb_releaseEndpoint(t){return tsvb_requestResponseMessage(t,new Map,{type:"RELEASE"}).then((()=>{tsvb_closeEndPoint(t)}))}const tsvb_proxyCounter=new WeakMap,tsvb_proxyFinalizers="FinalizationRegistry"in globalThis&&new FinalizationRegistry((t=>{const e=(tsvb_proxyCounter.get(t)||0)-1;tsvb_proxyCounter.set(t,e),0===e&&tsvb_releaseEndpoint(t)}));function tsvb_registerProxy(t,e){const r=(tsvb_proxyCounter.get(e)||0)+1;tsvb_proxyCounter.set(e,r),tsvb_proxyFinalizers&&tsvb_proxyFinalizers.register(t,e,t)}function tsvb_unregisterProxy(t){tsvb_proxyFinalizers&&tsvb_proxyFinalizers.unregister(t)}function tsvb_createProxy(t,e,r=[],n=function(){}){let i=!1;const s=new Proxy(n,{get(n,o){if(tsvb_throwIfProxyReleased(i),o===tsvb_releaseProxy)return()=>{tsvb_unregisterProxy(s),tsvb_releaseEndpoint(t),e.clear(),i=!0};if("then"===o){if(0===r.length)return{then:()=>s};const n=tsvb_requestResponseMessage(t,e,{type:"GET",path:r.map((t=>t.toString()))}).then(tsvb_fromWireValue);return n.then.bind(n)}return tsvb_createProxy(t,e,[...r,o])},set(n,s,o){tsvb_throwIfProxyReleased(i);const[a,u]=tsvb_toWireValue(o);return tsvb_requestResponseMessage(t,e,{type:"SET",path:[...r,s].map((t=>t.toString())),value:a},u).then(tsvb_fromWireValue)},apply(n,s,o){tsvb_throwIfProxyReleased(i);const a=r[r.length-1];if(a===tsvb_createEndpoint)return tsvb_requestResponseMessage(t,e,{type:"ENDPOINT"}).then(tsvb_fromWireValue);if("bind"===a)return tsvb_createProxy(t,e,r.slice(0,-1));const[u,l]=tsvb_processArguments(o);return tsvb_requestResponseMessage(t,e,{type:"APPLY",path:r.map((t=>t.toString())),argumentList:u},l).then(tsvb_fromWireValue)},construct(n,s){tsvb_throwIfProxyReleased(i);const[o,a]=tsvb_processArguments(s);return tsvb_requestResponseMessage(t,e,{type:"CONSTRUCT",path:r.map((t=>t.toString())),argumentList:o},a).then(tsvb_fromWireValue)}});return tsvb_registerProxy(s,t),s}function tsvb_myFlat(t){return Array.prototype.concat.apply([],t)}function tsvb_processArguments(t){const e=t.map(tsvb_toWireValue);return[e.map((t=>t[0])),tsvb_myFlat(e.map((t=>t[1])))]}const tsvb_transferCache=new WeakMap;function tsvb_transfer(t,e){return tsvb_transferCache.set(t,e),t}function tsvb_proxy(t){return Object.assign(t,{[tsvb_proxyMarker]:!0})}function tsvb_windowEndpoint(t,e=globalThis,r="*"){return{postMessage:(e,n)=>t.postMessage(e,r,n),addEventListener:e.addEventListener.bind(e),removeEventListener:e.removeEventListener.bind(e)}}function tsvb_toWireValue(t){for(const[e,r]of tsvb_transferHandlers)if(r.canHandle(t)){const[n,i]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:t},tsvb_transferCache.get(t)||[]]}function tsvb_fromWireValue(t){switch(t.type){case"HANDLER":return tsvb_transferHandlers.get(t.name).deserialize(t.value);case"RAW":return t.value}}function tsvb_requestResponseMessage(t,e,r,n){return new Promise((i=>{const s=tsvb_generateUUID();e.set(s,i),t.start&&t.start(),t.postMessage(Object.assign({id:s},r),n)}))}function tsvb_generateUUID(){return new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-")}const tsvb_lowLight_worker='/*! For license information please see lowLight-worker.js.LICENSE.txt */\n(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,n(a.key),a)}}function n(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,n||"default");if("object"!=t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}var r=.008856,a=1/Math.sqrt(2),o=1/Math.sqrt(3),i=1/Math.sqrt(6),u=Math.log(10),l=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},l=[{key:"RGBtoXYZ",value:function(t){var e=t.R,n=t.G,r=t.B;return{X:.412453*(e=a(e))+.35758*(n=a(n))+.180423*(r=a(r)),Y:.212671*e+.71516*n+.072169*r,Z:.019334*e+.119193*n+.950227*r};function a(t){return(t/=255)>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92}}},{key:"RGBtoCIELab",value:function(t){return this.XYZtoCIELab(this.RGBtoXYZ(t))}},{key:"RGBtoLMS",value:function(t){var e=t.R,n=t.G,r=t.B;return{L:.3811*e+.5783*n+.0402*r,M:.1967*e+.7244*n+.0782*r,S:.0241*e+.1288*n+.8444*r}}},{key:"RGBtoLab",value:function(t){return this.LMStoLab(this.RGBtoLMS(t))}},{key:"RGBtoY",value:function(t){return{Y:(.299*t.R+.587*t.G+.114*t.B)/255}}},{key:"XYZtoRGB",value:function(t){var e=t.X,n=t.Y,r=t.Z,a=u(3.2406*e+-1.5372*n+-.4986*r),o=u(-.9689*e+1.8758*n+.0415*r),i=u(.0557*e+-.204*n+1.057*r);return{R:s(255*a),G:s(255*o),B:s(255*i)};function u(t){return t>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t}}},{key:"XYZtoCIELab",value:function(t){var e=t.X,n=t.Y,a=t.Z,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=n>r?116*Math.pow(n,1/3)-16:903.3*n,u=500*(s(e)-s(n)),l=200*(s(n)-s(a));return o?this.normalizeCIELab({L:i,a:u,b:l}):{L:i,a:u,b:l};function s(t){return t>r?Math.pow(t,1/3):7.787*t+16/116}}},{key:"CIELabtoXYZ",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?t:this.normalizeBackCIELab(t),n=e.L,a=e.a,o=e.b,i=(n+16)/116,u=s(a/500+i),l=s(i-o/200);return{X:u,Y:s(i),Z:l};function s(t){var e=Math.pow(t,3);return e>r?e:(t-16/116)/7.787}}},{key:"CIELabtoRGB",value:function(t){return this.XYZtoRGB(this.CIELabtoXYZ(t))}},{key:"normalizeCIELab",value:function(t){return{L:t.L/100,a:(t.a+128)/255,b:(t.b+128)/255}}},{key:"normalizeBackCIELab",value:function(t){var e=t.L,n=t.a,r=t.b;return{L:Math.min(100,Math.max(0,100*e)),a:Math.min(127,Math.max(-127,255*n-128)),b:Math.min(127,Math.max(-127,255*r-128))}}},{key:"LMStoRGB",value:function(t){var e=t.L,n=t.M,r=t.S;return{R:s(4.4686*e-3.5886*n+.1196*r),G:s(-1.2197*e+2.383*n-.1626*r),B:s(.0585*e-.261*n+1.2056*r)}}},{key:"LMStoLab",value:function(t){var e=t.L,n=t.M,r=t.S;return e&&(e=Math.log(e)/u),n&&(n=Math.log(n)/u),r&&(r=Math.log(r)/u),{L:(e+n+r)*o,a:(e+n-2*r)*i,b:(e-n)*a}}},{key:"LabtoRGB",value:function(t){return this.LMStoRGB(this.LabtoLMS(t))}},{key:"LabtoLMS",value:function(t){var e=t.L,n=t.a,r=t.b;return e*=o,n*=i,r*=a,{L:Math.pow(10,e+n+r),M:Math.pow(10,e+n-r),S:Math.pow(10,e-2*n)}}}],(n=null)&&e(t.prototype,n),l&&e(t,l),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,l}();function s(t){return Math.min(255,Math.max(0,t))}function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,h(r.key),r)}}function h(t){var e=function(t,e){if("object"!=c(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==c(e)?e:e+""}var b=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.aAverage={},this.stdDev={},this.sum={},this.sumSqr={},this.pixelsCount=e},(e=[{key:"addPixel",value:function(t){var e=this;Object.keys(t).forEach((function(n){var r,a;e.sum[n]=(null!==(r=e.sum[n])&&void 0!==r?r:0)+t[n],e.sumSqr[n]=(null!==(a=e.sumSqr[n])&&void 0!==a?a:0)+Math.pow(t[n],2)}))}},{key:"countAverage",value:function(){var t=this;return Object.keys(this.sum).forEach((function(e){var n;t.aAverage[e]=(null!==(n=t.sum[e])&&void 0!==n?n:0)/t.pixelsCount})),this.aAverage}},{key:"countStdDev",value:function(){var t=this;return Object.keys(this.sumSqr).forEach((function(e){var n,r,a=(null!==(n=t.sumSqr[e])&&void 0!==n?n:0)-t.pixelsCount*Math.pow(null!==(r=t.aAverage[e])&&void 0!==r?r:0,2);t.stdDev[e]=Math.sqrt(+a.toFixed(5)/(t.pixelsCount-1))})),this.stdDev}}])&&f(t.prototype,e),n&&f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,m(r.key),r)}}function m(t){var e=function(t,e){if("object"!=v(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==v(e)?e:e+""}var p=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dataRGBa=e,this.pixelsCount=e.length/4,this.channelsCIELab=new b(this.pixelsCount),this.channelsLab=new b(this.pixelsCount),this.channelsY=new b(this.pixelsCount)},(e=[{key:"countAverage",value:function(){this.channelsCIELab.countAverage(),this.channelsLab.countAverage(),this.channelsY.countAverage()}},{key:"countStdDev",value:function(){this.channelsCIELab.countStdDev(),this.channelsLab.countStdDev(),this.channelsY.countStdDev()}}])&&y(t.prototype,e),n&&y(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,g(r.key),r)}}function g(t){var e=function(t,e){if("object"!=L(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=L(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==L(e)?e:e+""}var E=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.defaultLUT36_RGB=this.generateDefaultLUT36_RGB(),this.defaultLUT36_CIELab=this.generateDefaultLUT36_CIELab(this.defaultLUT36_RGB),this.defaultLUT36_Lab=this.generateDefaultLUT36_Lab(this.defaultLUT36_RGB),this.defaultLUT36_Y=this.generateDefaultLUT36_Y(this.defaultLUT36_RGB)},e=[{key:"process",value:function(t,e){for(var n=this,r=new p(t),a=new p(e),o=0;o<r.dataRGBa.length;o+=4){var i={R:r.dataRGBa[o+0],G:r.dataRGBa[o+1],B:r.dataRGBa[o+2]},u={R:a.dataRGBa[o+0],G:a.dataRGBa[o+1],B:a.dataRGBa[o+2]},s=l.RGBtoCIELab(i),c=l.RGBtoCIELab(u);r.channelsCIELab.addPixel(s),a.channelsCIELab.addPixel(c);var f=l.RGBtoLab(i),h=l.RGBtoLab(u);r.channelsLab.addPixel(f),a.channelsLab.addPixel(h);var b=l.RGBtoY(i),v=l.RGBtoY(u);r.channelsY.addPixel(b),a.channelsY.addPixel(v)}r.countAverage(),a.countAverage(),r.countStdDev(),a.countStdDev();for(var y=[],m=function(){var t=n.merge(n.defaultLUT36_CIELab[3*L+0],"L",r.channelsCIELab,a.channelsCIELab,!0),e=n.merge(n.defaultLUT36_CIELab[3*L+1],"a",r.channelsCIELab,a.channelsCIELab,!0),o=n.merge(n.defaultLUT36_CIELab[3*L+2],"b",r.channelsCIELab,a.channelsCIELab,!0),i=l.CIELabtoRGB({L:t,a:e,b:o}),u=n.merge(n.defaultLUT36_Lab[3*L+0],"L",r.channelsLab,a.channelsLab),s=n.merge(n.defaultLUT36_Lab[3*L+1],"a",r.channelsLab,a.channelsLab),c=n.merge(n.defaultLUT36_Lab[3*L+2],"b",r.channelsLab,a.channelsLab),f=l.LabtoRGB({L:u,a:s,b:c}),h=n.mix(i,f,.6),b=n.merge(n.defaultLUT36_Y[L],"Y",r.channelsY,a.channelsY,!0),v=l.RGBtoY(h).Y,m=function(t){return Math.min(255,t*b/Math.max(v,1/255))},p={R:m(h.R),G:m(h.G),B:m(h.B)},d={R:255*n.defaultLUT36_Y[L],G:255*n.defaultLUT36_Y[L],B:255*n.defaultLUT36_Y[L]},g=n.mix(p,d,.9);y.push(g.R,g.G,g.B,255)},L=0;L<this.defaultLUT36_RGB.length/3;L++)m();return{NEW_LUT36_RGBa_TINTED:y}}},{key:"generateDefaultLUT36_RGB",value:function(){for(var t=36,e=Math.pow(216,2),n=255/t,r=new Uint8ClampedArray(3*e),a=0;a<e;a++){var o=i(a,6,t);r[3*a+0]=a%t*n,r[3*a+1]=Math.trunc(a/216%t)*n,r[3*a+2]=o*(255/36)}return r;function i(t,e,n){var r=Math.trunc(t/n)%e;return e*Math.trunc(t/(n*n*e))+r}}},{key:"generateDefaultLUT36_CIELab",value:function(t){for(var e=new Array(t.length),n=0;n<t.length;n++){var r={R:t[3*n+0],G:t[3*n+1],B:t[3*n+2]},a=l.RGBtoCIELab(r),o=a.L,i=a.a,u=a.b;e[3*n+0]=o,e[3*n+1]=i,e[3*n+2]=u}return e}},{key:"generateDefaultLUT36_Lab",value:function(t){for(var e=new Array(t.length),n=0;n<t.length/3;n++){var r={R:t[3*n+0],G:t[3*n+1],B:t[3*n+2]},a=l.RGBtoLab(r),o=a.L,i=a.a,u=a.b;e[3*n+0]=o,e[3*n+1]=i,e[3*n+2]=u}return e}},{key:"generateDefaultLUT36_Y",value:function(t){for(var e=[],n=0;n<t.length/3;n++){var r={R:t[3*n+0],G:t[3*n+1],B:t[3*n+2]},a=l.RGBtoY(r).Y;e.push(a)}return e}},{key:"merge",value:function(t,e,n,r){var a,o,i,u,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=null!==(a=n.aAverage[e])&&void 0!==a?a:0,c=null!==(o=r.aAverage[e])&&void 0!==o?o:0,f=null!==(i=n.stdDev[e])&&void 0!==i?i:0,h=null!==(u=r.stdDev[e])&&void 0!==u?u:0;if(!n.stdDev[e]||!r.stdDev[e]){var b=t+c-s;return Math.min(1,Math.max(0,b))}var v=(t-s)/f*h+c;return l?Math.min(1,Math.max(0,v)):v}},{key:"mix",value:function(t,e,n){return n=Math.max(0,Math.min(1,n)),{R:r(t.R,e.R),G:r(t.G,e.G),B:r(t.B,e.B)};function r(t,e){return t*n+e*(1-n)}}}],e&&d(t.prototype,e),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();const R=Symbol("Comlink.proxy"),S=Symbol("Comlink.endpoint"),w=Symbol("Comlink.releaseProxy"),M=Symbol("Comlink.finalizer"),G=Symbol("Comlink.thrown"),B=t=>"object"==typeof t&&null!==t||"function"==typeof t,C={canHandle:t=>B(t)&&t[R],serialize(t){const{port1:e,port2:n}=new MessageChannel;return k(t,e),[n,[n]]},deserialize:t=>(t.start(),function(t,e){const n=new Map;return t.addEventListener("message",(function(t){const{data:e}=t;if(!e||!e.id)return;const r=n.get(e.id);if(r)try{r(e)}finally{n.delete(e.id)}})),_(t,n,[],e)}(t))},T=new Map([["proxy",C],["throw",{canHandle:t=>B(t)&&G in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function k(t,e=globalThis,n=["*"]){e.addEventListener("message",(function r(a){if(!a||!a.data)return;if(!function(t,e){for(const n of t){if(e===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(e))return!0}return!1}(n,a.origin))return void console.warn(`Invalid origin \'${a.origin}\' for comlink proxy`);const{id:o,type:i,path:u}=Object.assign({path:[]},a.data),l=(a.data.argumentList||[]).map(O);let s;try{const e=u.slice(0,-1).reduce(((t,e)=>t[e]),t),n=u.reduce(((t,e)=>t[e]),t);switch(i){case"GET":s=n;break;case"SET":e[u.slice(-1)[0]]=O(a.data.value),s=!0;break;case"APPLY":s=n.apply(e,l);break;case"CONSTRUCT":s=function(t){return Object.assign(t,{[R]:!0})}(new n(...l));break;case"ENDPOINT":{const{port1:e,port2:n}=new MessageChannel;k(t,n),s=function(t,e){return j.set(t,e),t}(e,[e])}break;case"RELEASE":s=void 0;break;default:return}}catch(t){s={value:t,[G]:0}}Promise.resolve(s).catch((t=>({value:t,[G]:0}))).then((n=>{const[a,u]=D(n);e.postMessage(Object.assign(Object.assign({},a),{id:o}),u),"RELEASE"===i&&(e.removeEventListener("message",r),I(e),M in t&&"function"==typeof t[M]&&t[M]())})).catch((t=>{const[n,r]=D({value:new TypeError("Unserializable return value"),[G]:0});e.postMessage(Object.assign(Object.assign({},n),{id:o}),r)}))})),e.start&&e.start()}function I(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function Y(t){if(t)throw new Error("Proxy has been released and is not useable")}function x(t){return N(t,new Map,{type:"RELEASE"}).then((()=>{I(t)}))}const P=new WeakMap,U="FinalizationRegistry"in globalThis&&new FinalizationRegistry((t=>{const e=(P.get(t)||0)-1;P.set(t,e),0===e&&x(t)}));function _(t,e,n=[],r=function(){}){let a=!1;const o=new Proxy(r,{get(r,i){if(Y(a),i===w)return()=>{!function(t){U&&U.unregister(t)}(o),x(t),e.clear(),a=!0};if("then"===i){if(0===n.length)return{then:()=>o};const r=N(t,e,{type:"GET",path:n.map((t=>t.toString()))}).then(O);return r.then.bind(r)}return _(t,e,[...n,i])},set(r,o,i){Y(a);const[u,l]=D(i);return N(t,e,{type:"SET",path:[...n,o].map((t=>t.toString())),value:u},l).then(O)},apply(r,o,i){Y(a);const u=n[n.length-1];if(u===S)return N(t,e,{type:"ENDPOINT"}).then(O);if("bind"===u)return _(t,e,n.slice(0,-1));const[l,s]=A(i);return N(t,e,{type:"APPLY",path:n.map((t=>t.toString())),argumentList:l},s).then(O)},construct(r,o){Y(a);const[i,u]=A(o);return N(t,e,{type:"CONSTRUCT",path:n.map((t=>t.toString())),argumentList:i},u).then(O)}});return function(t,e){const n=(P.get(e)||0)+1;P.set(e,n),U&&U.register(t,e,t)}(o,t),o}function A(t){const e=t.map(D);return[e.map((t=>t[0])),(n=e.map((t=>t[1])),Array.prototype.concat.apply([],n))];var n}const j=new WeakMap;function D(t){for(const[e,n]of T)if(n.canHandle(t)){const[r,a]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},a]}return[{type:"RAW",value:t},j.get(t)||[]]}function O(t){switch(t.type){case"HANDLER":return T.get(t.name).deserialize(t.value);case"RAW":return t.value}}function N(t,e,n,r){return new Promise((a=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.set(o,a),t.start&&t.start(),t.postMessage(Object.assign({id:o},n),r)}))}var z=new E;k({getLUTTexture:function(t,e){return z.process(t,e).NEW_LUT36_RGBa_TINTED},prepareCurveTexture:function(t,e,n){for(var r=e*n,a=r,o=new Float32Array(e*n*4),i=0;i<a;i++)o[4*i+0]=-2*t[i+0]*255,o[4*i+1]=-2*t[i+r]*255,o[4*i+2]=-2*t[i+2*r]*255,o[4*i+3]=255;return new Uint8ClampedArray(o)}})})();';function tsvb_worker_loader_typeof(t){return tsvb_worker_loader_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_worker_loader_typeof(t)}function tsvb_worker_loader_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_worker_loader_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_worker_loader_toPropertyKey(n.key),n)}}function tsvb_worker_loader_createClass(t,e,r){return e&&tsvb_worker_loader_defineProperties(t.prototype,e),r&&tsvb_worker_loader_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_worker_loader_toPropertyKey(t){var e=tsvb_worker_loader_toPrimitive(t,"string");return"symbol"==tsvb_worker_loader_typeof(e)?e:e+""}function tsvb_worker_loader_toPrimitive(t,e){if("object"!=tsvb_worker_loader_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_worker_loader_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_WorkerLoader=function(){return tsvb_worker_loader_createClass((function t(e){tsvb_worker_loader_classCallCheck(this,t);var r=URL.createObjectURL(new Blob([e.toString()],{type:"application/javascript"}));this.worker=new Worker(r),setTimeout((function(){return URL.revokeObjectURL(r)}))}),[{key:"getWorker",value:function(){return this.worker}}])}();function tsvb_lowLightEffect_typeof(t){return tsvb_lowLightEffect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_lowLightEffect_typeof(t)}function tsvb_lowLightEffect_regeneratorRuntime(){tsvb_lowLightEffect_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_lowLightEffect_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_lowLightEffect_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_lowLightEffect_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_lowLightEffect_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_lowLightEffect_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_lowLightEffect_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_lowLightEffect_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_lowLightEffect_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_lowLightEffect_toPropertyKey(n.key),n)}}function tsvb_lowLightEffect_createClass(t,e,r){return e&&tsvb_lowLightEffect_defineProperties(t.prototype,e),r&&tsvb_lowLightEffect_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_lowLightEffect_toPropertyKey(t){var e=tsvb_lowLightEffect_toPrimitive(t,"string");return"symbol"==tsvb_lowLightEffect_typeof(e)?e:e+""}function tsvb_lowLightEffect_toPrimitive(t,e){if("object"!=tsvb_lowLightEffect_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_lowLightEffect_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_lowLightEffect_callSuper(t,e,r){return e=tsvb_lowLightEffect_getPrototypeOf(e),tsvb_lowLightEffect_possibleConstructorReturn(t,tsvb_lowLightEffect_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_lowLightEffect_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_lowLightEffect_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_lowLightEffect_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_lowLightEffect_assertThisInitialized(t)}function tsvb_lowLightEffect_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_lowLightEffect_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_lowLightEffect_isNativeReflectConstruct=function(){return!!t})()}function tsvb_lowLightEffect_superPropGet(t,e,r,n){var i=tsvb_lowLightEffect_get(tsvb_lowLightEffect_getPrototypeOf(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof i?function(t){return i.apply(r,t)}:i}function tsvb_lowLightEffect_get(){return tsvb_lowLightEffect_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=tsvb_lowLightEffect_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tsvb_lowLightEffect_get.apply(null,arguments)}function tsvb_lowLightEffect_superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tsvb_lowLightEffect_getPrototypeOf(t)););return t}function tsvb_lowLightEffect_getPrototypeOf(t){return tsvb_lowLightEffect_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_lowLightEffect_getPrototypeOf(t)}function tsvb_lowLightEffect_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_lowLightEffect_setPrototypeOf(t,e)}function tsvb_lowLightEffect_setPrototypeOf(t,e){return tsvb_lowLightEffect_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_lowLightEffect_setPrototypeOf(t,e)}var tsvb_workerLoader=new tsvb_WorkerLoader(tsvb_lowLight_worker),tsvb_LowLightEffect=function(t){function e(t,r){var n;return tsvb_lowLightEffect_classCallCheck(this,e),(n=tsvb_lowLightEffect_callSuper(this,e,[t])).bufferPool=new tsvb_BufferPool,n.customer_id=r,n.setConfig(tsvb_DEFAULT_CONFIG),n.worker=tsvb_wrap(tsvb_workerLoader.getWorker()),n.filterName="low-light",n}return tsvb_lowLightEffect_inherits(e,tsvb_AbstractEffect),tsvb_lowLightEffect_createClass(e,[{key:"init",value:(n=tsvb_lowLightEffect_asyncToGenerator(tsvb_lowLightEffect_regeneratorRuntime().mark((function t(e){return tsvb_lowLightEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.inference=e,t.next=3,this.inference.sessionManager.init(this.customer_id,tsvb_ModelType.LOWLIGHTER);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"prepare",value:function(){this.filterLowLight=new tsvb_FilterLowLight,this.original=new tsvb_Frame(this.resources.texture,{width:this.sdkOptions.width,height:this.sdkOptions.height}),this.original.addBuffer("result"),this.original.addBuffer("output"),this.filterLUT=new tsvb_FilterLut,this.lut=new tsvb_Frame(this.resources.texture,{width:this.sdkOptions.width,height:this.sdkOptions.height}),this.lut.addBuffer("result"),this.lut.frame.filters=[this.filterLUT];var t=this.config,e=t.modelHeight,r=t.modelWidth;this.small=new tsvb_Frame(this.resources.texture,{width:r,height:e}),this.small.addBuffer("model"),this.sdkOptions.on("update",this.onOptionsUpdate,this)}},{key:"onOptionsUpdate",value:function(){this.original.resize(this.sdkOptions.width,this.sdkOptions.height),this.lut.resize(this.sdkOptions.width,this.sdkOptions.height)}},{key:"process",value:(r=tsvb_lowLightEffect_asyncToGenerator(tsvb_lowLightEffect_regeneratorRuntime().mark((function t(){return tsvb_lowLightEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled){t.next=2;break}return t.abrupt("return");case 2:this.isOutdatedLUT&&this.updateLUT(),this.resources.filters.set(this.filterName,this.filterLUT);case 4:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"setConfig",value:function(t){var e;this.config=Object.assign(null!==(e=this.config)&&void 0!==e?e:{},t),this.setFilterPower(t.power)}},{key:"onSuccess",value:function(t){var e="function"==typeof t;this.onSuccessFunction=e?t:void 0}},{key:"enable",value:function(){tsvb_lowLightEffect_superPropGet(e,"enable",this,3)([]),this.isOutdatedLUT=!this.inWork}},{key:"disable",value:function(){tsvb_lowLightEffect_superPropGet(e,"disable",this,3)([]),this.resources.filters.delete(this.filterName),this.bufferPool=new tsvb_BufferPool}},{key:"updateLUT",value:function(){var t=this;if(!this.inWork){this.inWork=!0;var e=this.config,r=e.modelHeight,n=e.modelWidth;this.resources.renderer.renderTo(this.original.frame,this.original.getBuffer("result")),this.resources.renderer.renderTo(this.small.frame,this.small.getBuffer("model"));var i=this.small.getBuffer("model"),s=this.resources.renderer.pixels(i),o=this.bufferPool.getBuffer("f32",3*n*r);tsvb_lowlightPreprocess(new Uint8ClampedArray(s),n,r,o),this.inference.run(o,n,r,tsvb_ModelType.LOWLIGHTER).then(function(){var e=tsvb_lowLightEffect_asyncToGenerator(tsvb_lowLightEffect_regeneratorRuntime().mark((function e(r){var n,i,s,o;return tsvb_lowLightEffect_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.coefs.dims[3],i=r.coefs.dims[2],e.next=4,t.worker.prepareCurveTexture(r.coefs.data,n,i);case 4:return s=e.sent,o=t.resources.renderer.createTextureFromBuffer(new Uint8Array(s),n,i),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){t.original.activateBuffer("result"),t.original.frame.filters=[t.filterLowLight],t.filterLowLight.setLowLightTexture(e),t.resources.renderer.renderTo(t.original.frame,t.original.getBuffer("output")),t.original.activateTexture("origin"),t.original.frame.filters=[];var r=t.resources.renderer.pixels(t.original.getBuffer("output")),n=t.resources.renderer.pixels(t.original.getBuffer("result"));return t.worker.getLUTTexture(new Uint8ClampedArray(n),new Uint8ClampedArray(r))})).then((function(e){t.applyLowlightLUT(e),t.emitSuccess()})).catch((function(t){var e;tsvb_errorBus.bv.notify({message:null!==(e=t.message)&&void 0!==e?e:t,emitter:tsvb_errorBus.JK.EFFECT_LOW_LIGHT,cause:t})})).finally((function(){t.inWork=!1,t.isOutdatedLUT=!1}))}}},{key:"applyLowlightLUT",value:function(t){var e=this.getLutTextureData(t).LUTTexture;this.filterLUT.setLUT({texture:e})}},{key:"getLutTextureData",value:function(t){var e=Math.sqrt(t.length/4);return{LUTTexture:tsvb_Texture_Texture.fromBuffer(new Uint8Array(t),e,e,{scaleMode:1}),LUTSize:e}}},{key:"setFilterPower",value:function(t){var e;void 0!==t&&(this.config.power=t,null===(e=this.filterLUT)||void 0===e||e.setFilterPower(t))}},{key:"emitSuccess",value:function(){"function"==typeof this.onSuccessFunction&&this.onSuccessFunction()}},{key:"destroy",value:function(){this.sdkOptions.off("update",this.onOptionsUpdate,this)}}]);var r,n}();const tsvb_config={modelHeight:256,modelWidth:256,modelPediod_ms:1e3,filterPart:100,cc_power:100};function tsvb_usePreprocessData(t,e,r,n){for(var i=r*e,s=2*r*e,o=0;o<n.length/3;o++)n[0+o]=t[4*o],n[i+o]=t[4*o+1],n[s+o]=t[4*o+2];return n}var tsvb_edge=33,tsvb_sidesCount=6;function tsvb_getPostprocessOutputSize(){return 4*Math.pow(tsvb_edge*tsvb_sidesCount,2)}function tsvb_usePostprocessData(t,e){var r=t.tensor,n=tsvb_edge*tsvb_edge*tsvb_edge,i=r.output.data,s=new Uint8ClampedArray(e.buffer),o={value:0,isNil:function(){return 0===o.value},setDefault:function(){return o.value=tsvb_edge*tsvb_edge},dec:function(){return o.value--}};o.setDefault();for(var a=0,u=0,l=function(t,e){return 4*(tsvb_edge*(tsvb_sidesCount*u+a)+e%tsvb_edge)+t},c=function(t){[t,n+t,2*n+t].forEach((function(e,r){s[l(r,t)]=255*i[e]})),s[l(3,t)]=255,o.dec(),t%tsvb_edge==tsvb_edge-1&&u++,o.isNil()&&(o.setDefault(),++a>=tsvb_sidesCount?a=0:u-=tsvb_edge)},h=0;h<n;h++)c(h)}const tsvb_lut33Shader="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D uLUT;\nuniform float uFilterPart;\nuniform float uFilterPower;\n\nfloat clampedCoord(float coord) {\n  float min = 0.5 / 198.0;\n  float max = 1.0 - min;\n  return clamp(coord, min, max);\n}\n\nfloat clampColor(float color) {\n  float min = 1.0 / 256.0;\n  float max = 1.0 / 6.0 - min;\n  return clamp(color, min, max);\n}\n\nvec4 newColor(float rectNum, vec2 coord) {\n  vec2 bCoord = vec2(mod(rectNum, 6.0) / 6.0, floor(rectNum / 6.0) / 6.0);\n  vec2 lutTextureCoord = vec2(clampedCoord(coord.r + bCoord.r), clampedCoord(coord.g + bCoord.g));\n  return texture2D(uLUT, lutTextureCoord);\n}\n\nvoid main() {\n  vec4 color = texture2D(uSampler, vTextureCoord);\n\n  if (vTextureCoord.x > uFilterPart) {\n    gl_FragColor = color;\n    return;\n  }\n\n  vec2 rgCoord = vec2(clampColor(color.r / 6.0), clampColor(color.g / 6.0));\n\n  //. Count number of the LUT-cell\n  float rectNumReal = color.b * 32.0;\n  float rectNumMin = floor(rectNumReal);\n  float rectNumMax = ceil(rectNumReal);\n\n  vec4 colorLut1 = newColor(rectNumMin, rgCoord);\n  vec4 colorLut2 = newColor(rectNumMax, rgCoord);\n\n  vec3 interpolatedColor = mix(colorLut1.rgb, colorLut2.rgb, rectNumReal - rectNumMin);\n\n  //. Add filter power\n  vec3 resultColor = mix(color.rgb, interpolatedColor.rgb, uFilterPower);\n\n  gl_FragColor = vec4(resultColor.rgb, color.a);\n}\n";function tsvb_filterLut33_typeof(t){return tsvb_filterLut33_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_filterLut33_typeof(t)}function tsvb_filterLut33_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_filterLut33_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_filterLut33_toPropertyKey(n.key),n)}}function tsvb_filterLut33_createClass(t,e,r){return e&&tsvb_filterLut33_defineProperties(t.prototype,e),r&&tsvb_filterLut33_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_filterLut33_toPropertyKey(t){var e=tsvb_filterLut33_toPrimitive(t,"string");return"symbol"==tsvb_filterLut33_typeof(e)?e:e+""}function tsvb_filterLut33_toPrimitive(t,e){if("object"!=tsvb_filterLut33_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_filterLut33_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_filterLut33_callSuper(t,e,r){return e=tsvb_filterLut33_getPrototypeOf(e),tsvb_filterLut33_possibleConstructorReturn(t,tsvb_filterLut33_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_filterLut33_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_filterLut33_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_filterLut33_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_filterLut33_assertThisInitialized(t)}function tsvb_filterLut33_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_filterLut33_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_filterLut33_isNativeReflectConstruct=function(){return!!t})()}function tsvb_filterLut33_getPrototypeOf(t){return tsvb_filterLut33_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_filterLut33_getPrototypeOf(t)}function tsvb_filterLut33_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_filterLut33_setPrototypeOf(t,e)}function tsvb_filterLut33_setPrototypeOf(t,e){return tsvb_filterLut33_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_filterLut33_setPrototypeOf(t,e)}var tsvb_FilterLut33=function(t){function e(){var t;return tsvb_filterLut33_classCallCheck(this,e),(t=tsvb_filterLut33_callSuper(this,e,[void 0,tsvb_lut33Shader,{uFilterPart:1,uFilterPower:1}])).lutTextureHeight=198,t.lutTextureWidth=198,t}return tsvb_filterLut33_inherits(e,src_tsvb_Filter),tsvb_filterLut33_createClass(e,[{key:"setLUT",value:function(t,e){var r;null===(r=this.lutTexture)||void 0===r||r.destroy(!0),this.onLutDestroyedCallback&&this.onLutDestroyedCallback(),this.lutTexture=tsvb_Texture_Texture.fromBuffer(t,this.lutTextureWidth,this.lutTextureHeight,{scaleMode:1}),this.onLutDestroyedCallback=e,this.uniforms.uLUT=this.lutTexture}},{key:"setFilterPart",value:function(t){t=Math.min(1,Math.max(0,t)),this.uniforms.uFilterPart=t}},{key:"setFilterPower",value:function(t){t=Math.min(1,Math.max(0,t)),this.uniforms.uFilterPower=t}}])}();function tsvb_colorCorrectionEffect_typeof(t){return tsvb_colorCorrectionEffect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_colorCorrectionEffect_typeof(t)}function tsvb_colorCorrectionEffect_regeneratorRuntime(){tsvb_colorCorrectionEffect_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_colorCorrectionEffect_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_colorCorrectionEffect_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_colorCorrectionEffect_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_colorCorrectionEffect_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_colorCorrectionEffect_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_colorCorrectionEffect_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_colorCorrectionEffect_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_colorCorrectionEffect_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_colorCorrectionEffect_toPropertyKey(n.key),n)}}function tsvb_colorCorrectionEffect_createClass(t,e,r){return e&&tsvb_colorCorrectionEffect_defineProperties(t.prototype,e),r&&tsvb_colorCorrectionEffect_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_colorCorrectionEffect_toPropertyKey(t){var e=tsvb_colorCorrectionEffect_toPrimitive(t,"string");return"symbol"==tsvb_colorCorrectionEffect_typeof(e)?e:e+""}function tsvb_colorCorrectionEffect_toPrimitive(t,e){if("object"!=tsvb_colorCorrectionEffect_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_colorCorrectionEffect_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_colorCorrectionEffect_callSuper(t,e,r){return e=tsvb_colorCorrectionEffect_getPrototypeOf(e),tsvb_colorCorrectionEffect_possibleConstructorReturn(t,tsvb_colorCorrectionEffect_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_colorCorrectionEffect_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_colorCorrectionEffect_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_colorCorrectionEffect_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_colorCorrectionEffect_assertThisInitialized(t)}function tsvb_colorCorrectionEffect_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_colorCorrectionEffect_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_colorCorrectionEffect_isNativeReflectConstruct=function(){return!!t})()}function tsvb_colorCorrectionEffect_superPropGet(t,e,r,n){var i=tsvb_colorCorrectionEffect_get(tsvb_colorCorrectionEffect_getPrototypeOf(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof i?function(t){return i.apply(r,t)}:i}function tsvb_colorCorrectionEffect_get(){return tsvb_colorCorrectionEffect_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=tsvb_colorCorrectionEffect_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tsvb_colorCorrectionEffect_get.apply(null,arguments)}function tsvb_colorCorrectionEffect_superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tsvb_colorCorrectionEffect_getPrototypeOf(t)););return t}function tsvb_colorCorrectionEffect_getPrototypeOf(t){return tsvb_colorCorrectionEffect_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_colorCorrectionEffect_getPrototypeOf(t)}function tsvb_colorCorrectionEffect_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_colorCorrectionEffect_setPrototypeOf(t,e)}function tsvb_colorCorrectionEffect_setPrototypeOf(t,e){return tsvb_colorCorrectionEffect_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_colorCorrectionEffect_setPrototypeOf(t,e)}var tsvb_ColorCorrectorEffect=function(t){function e(t,r){var n;return tsvb_colorCorrectionEffect_classCallCheck(this,e),(n=tsvb_colorCorrectionEffect_callSuper(this,e,[t])).hasLUT=!1,n.inWork=!1,n.bufferPool=new tsvb_BufferPool,n.customer_id=r,n.config=Object.assign({},tsvb_config),n.filterName="color-correction",n}return tsvb_colorCorrectionEffect_inherits(e,tsvb_AbstractEffect),tsvb_colorCorrectionEffect_createClass(e,[{key:"init",value:(i=tsvb_colorCorrectionEffect_asyncToGenerator(tsvb_colorCorrectionEffect_regeneratorRuntime().mark((function t(e){return tsvb_colorCorrectionEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.inference=e,t.next=3,this.inference.sessionManager.init(this.customer_id,tsvb_ModelType.COLORCORRECTOR);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"prepare",value:function(){var t=this.config,e=t.modelHeight,r=t.modelWidth,n=this.resources.texture;this.small=new tsvb_Frame(n,{width:r,height:e}),this.small.addBuffer("model"),this.ccFilter=new tsvb_FilterLut33}},{key:"process",value:(n=tsvb_colorCorrectionEffect_asyncToGenerator(tsvb_colorCorrectionEffect_regeneratorRuntime().mark((function t(){return tsvb_colorCorrectionEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled){t.next=2;break}return t.abrupt("return");case 2:this.resources.renderer.renderTo(this.small.frame,this.small.getBuffer("model")),this.modelProcess(),this.hasLUT&&this.resources.filters.set(this.filterName,this.ccFilter);case 5:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"disable",value:function(){tsvb_colorCorrectionEffect_superPropGet(e,"disable",this,3)([]),this.resources.filters.delete(this.filterName),this.bufferPool=new tsvb_BufferPool}},{key:"modelProcess",value:(r=tsvb_colorCorrectionEffect_asyncToGenerator(tsvb_colorCorrectionEffect_regeneratorRuntime().mark((function t(){var e,r,n,i,s,o,a,u,l=this;return tsvb_colorCorrectionEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.inWork){t.next=2;break}return t.abrupt("return");case 2:if(this.checkTimer()){t.next=4;break}return t.abrupt("return");case 4:return this.inWork=!0,e=this.config,r=e.modelHeight,n=e.modelWidth,i=this.small.getBuffer("model"),t.next=9,this.resources.renderer.pixelsAsync(i,{pool:this.bufferPool});case 9:return s=t.sent,o=this.bufferPool.getBuffer("f32",r*n*3),tsvb_usePreprocessData(s,n,r,o),this.bufferPool.returnBuffer(s),a=this.bufferPool,u={output:{data:a.getBuffer("f32",107811),dims:[3,33,33,33]}},t.abrupt("return",this.inference.run(o,n,r,tsvb_ModelType.COLORCORRECTOR,u).then((function(t){a.returnBuffer(t.inputBack.data);var e=a.getBuffer("u8",tsvb_getPostprocessOutputSize());tsvb_usePostprocessData({tensor:t},e),a.returnBuffer(t.output.data),l.ccFilter.setLUT(e,(function(){a.returnBuffer(e)})),l.hasLUT=!0})).catch((function(t){var e;tsvb_errorBus.bv.notify({message:null!==(e=t.message)&&void 0!==e?e:t,emitter:tsvb_errorBus.JK.EFFECT_COLOR_CORRECTION,cause:t})})).finally((function(){l.inWork=!1})));case 16:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"setConfig",value:function(t,e){this.config[t]=e,"filterPart"===t&&this.ccFilter.setFilterPart(e),"cc_power"===t&&this.ccFilter.setFilterPower(e)}},{key:"checkTimer",value:function(){return this.modelTimer?(performance.now()-this.modelTimer<this.config.modelPediod_ms||(this.modelTimer=0),!1):(this.modelTimer=performance.now(),!0)}},{key:"destroy",value:function(){}}]);var r,n,i}();const tsvb_smart_zoom_config={smoothPower:20,sensitivityValue:.15,faceAreaProportion:.1,modelHeight:240,modelWidth:320,faceDetectorAccuracy:.75,waiterSeconds:1,isFaceSquareDrawingEnabled:!1,isPreFaceSquareDrawingEnabled:!1,faceDetectorPediod_ms:250};function tsvb_faceCombiner_typeof(t){return tsvb_faceCombiner_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_faceCombiner_typeof(t)}function tsvb_faceCombiner_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_faceCombiner_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_faceCombiner_toPropertyKey(n.key),n)}}function tsvb_faceCombiner_createClass(t,e,r){return e&&tsvb_faceCombiner_defineProperties(t.prototype,e),r&&tsvb_faceCombiner_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_faceCombiner_toPropertyKey(t){var e=tsvb_faceCombiner_toPrimitive(t,"string");return"symbol"==tsvb_faceCombiner_typeof(e)?e:e+""}function tsvb_faceCombiner_toPrimitive(t,e){if("object"!=tsvb_faceCombiner_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_faceCombiner_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_FaceCombiner=function(){return tsvb_faceCombiner_createClass((function t(e,r){tsvb_faceCombiner_classCallCheck(this,t),this.setCoord(e),this.id=null!=r?r:Math.round(100*Math.random())}),[{key:"setID",value:function(t){this.id=t}},{key:"getID",value:function(){return this.id}},{key:"checkSame",value:function(t){if(void 0===this.x1)return!1;if(!(t.x1>this.x1&&t.x1<this.x2||t.x2>this.x1&&t.x2<this.x2||this.x1>t.x1&&this.x1<t.x2||this.x2>t.x1&&this.x2<t.x2))return!1;if(!(t.y1>this.y1&&t.y1<this.y2||t.y2>this.y1&&t.y2<this.y2||this.y1>t.y1&&this.y1<t.y2||this.y2>t.y1&&this.y2<t.y2))return!1;var e=this.calcSquare(t),r=Math.abs(Math.max(this.x1,t.x1)-Math.min(this.x2,t.x2));return!!(Math.abs(Math.max(this.y1,t.y1)-Math.min(this.y2,t.y2))*r/Math.min(this.square,e)>.7)&&(this.setCoord(t),!0)}},{key:"getRect",value:function(){return{x1:this.x1,y1:this.y1,width:this.x2-this.x1,height:this.y2-this.y1}}},{key:"getCoord",value:function(){return{x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2}}},{key:"getSquare",value:function(){return this.square}},{key:"getCenter",value:function(){return{x:this.x1+(this.x2-this.x1)/2,y:this.y1+(this.y2-this.y1)/2}}},{key:"isEqual",value:function(t,e,r,n){if(!t)return!1;var i=t.getCoord();return!(Math.abs(this.x1-i.x1)/(null!=n?n:this.x2-this.x1)>e)&&(!(Math.abs(this.x2-i.x2)/(null!=n?n:this.x2-this.x1)>e)&&(!(Math.abs(this.y1-i.y1)/(null!=r?r:this.y2-this.y1)>e)&&!(Math.abs(this.y2-i.y2)/(null!=r?r:this.y2-this.y1)>e)))}},{key:"setCoord",value:function(t){var e=void 0===this.x1;this.x1=e?t.x1:Math.min(this.x1,t.x1),this.y1=e?t.y1:Math.min(this.y1,t.y1),this.x2=e?t.x2:Math.max(this.x2,t.x2),this.y2=e?t.y2:Math.max(this.y2,t.y2),this.square=this.calcSquare(t)}},{key:"calcSquare",value:function(t){return(t.x2-t.x1)*(t.y2-t.y1)}}])}();const tsvb_priors=[{x:.0125,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.0125,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.0125,y:.016666666666666666,w:.075,h:.1},{x:.0375,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.0375,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.0375,y:.016666666666666666,w:.075,h:.1},{x:.0625,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.0625,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.0625,y:.016666666666666666,w:.075,h:.1},{x:.0875,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.0875,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.0875,y:.016666666666666666,w:.075,h:.1},{x:.1125,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.1125,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.1125,y:.016666666666666666,w:.075,h:.1},{x:.1375,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.1375,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.1375,y:.016666666666666666,w:.075,h:.1},{x:.1625,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.1625,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.1625,y:.016666666666666666,w:.075,h:.1},{x:.1875,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.1875,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.1875,y:.016666666666666666,w:.075,h:.1},{x:.2125,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.2125,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.2125,y:.016666666666666666,w:.075,h:.1},{x:.2375,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.2375,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.2375,y:.016666666666666666,w:.075,h:.1},{x:.2625,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.2625,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.2625,y:.016666666666666666,w:.075,h:.1},{x:.2875,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.2875,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.2875,y:.016666666666666666,w:.075,h:.1},{x:.3125,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.3125,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.3125,y:.016666666666666666,w:.075,h:.1},{x:.3375,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.3375,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.3375,y:.016666666666666666,w:.075,h:.1},{x:.3625,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.3625,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.3625,y:.016666666666666666,w:.075,h:.1},{x:.3875,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.3875,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.3875,y:.016666666666666666,w:.075,h:.1},{x:.4125,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.4125,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.4125,y:.016666666666666666,w:.075,h:.1},{x:.4375,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.4375,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.4375,y:.016666666666666666,w:.075,h:.1},{x:.4625,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.4625,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.4625,y:.016666666666666666,w:.075,h:.1},{x:.4875,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.4875,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.4875,y:.016666666666666666,w:.075,h:.1},{x:.5125,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.5125,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.5125,y:.016666666666666666,w:.075,h:.1},{x:.5375,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.5375,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.5375,y:.016666666666666666,w:.075,h:.1},{x:.5625,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.5625,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.5625,y:.016666666666666666,w:.075,h:.1},{x:.5875,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.5875,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.5875,y:.016666666666666666,w:.075,h:.1},{x:.6125,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.6125,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.6125,y:.016666666666666666,w:.075,h:.1},{x:.6375,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.6375,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.6375,y:.016666666666666666,w:.075,h:.1},{x:.6625,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.6625,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.6625,y:.016666666666666666,w:.075,h:.1},{x:.6875,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.6875,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.6875,y:.016666666666666666,w:.075,h:.1},{x:.7125,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.7125,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.7125,y:.016666666666666666,w:.075,h:.1},{x:.7375,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.7375,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.7375,y:.016666666666666666,w:.075,h:.1},{x:.7625,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.7625,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.7625,y:.016666666666666666,w:.075,h:.1},{x:.7875,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.7875,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.7875,y:.016666666666666666,w:.075,h:.1},{x:.8125,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.8125,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.8125,y:.016666666666666666,w:.075,h:.1},{x:.8375,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.8375,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.8375,y:.016666666666666666,w:.075,h:.1},{x:.8625,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.8625,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.8625,y:.016666666666666666,w:.075,h:.1},{x:.8875,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.8875,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.8875,y:.016666666666666666,w:.075,h:.1},{x:.9125,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.9125,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.9125,y:.016666666666666666,w:.075,h:.1},{x:.9375,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.9375,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.9375,y:.016666666666666666,w:.075,h:.1},{x:.9625,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.9625,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.9625,y:.016666666666666666,w:.075,h:.1},{x:.9875,y:.016666666666666666,w:.03125,h:.041666666666666664},{x:.9875,y:.016666666666666666,w:.05,h:.06666666666666667},{x:.9875,y:.016666666666666666,w:.075,h:.1},{x:.0125,y:.05,w:.03125,h:.041666666666666664},{x:.0125,y:.05,w:.05,h:.06666666666666667},{x:.0125,y:.05,w:.075,h:.1},{x:.0375,y:.05,w:.03125,h:.041666666666666664},{x:.0375,y:.05,w:.05,h:.06666666666666667},{x:.0375,y:.05,w:.075,h:.1},{x:.0625,y:.05,w:.03125,h:.041666666666666664},{x:.0625,y:.05,w:.05,h:.06666666666666667},{x:.0625,y:.05,w:.075,h:.1},{x:.0875,y:.05,w:.03125,h:.041666666666666664},{x:.0875,y:.05,w:.05,h:.06666666666666667},{x:.0875,y:.05,w:.075,h:.1},{x:.1125,y:.05,w:.03125,h:.041666666666666664},{x:.1125,y:.05,w:.05,h:.06666666666666667},{x:.1125,y:.05,w:.075,h:.1},{x:.1375,y:.05,w:.03125,h:.041666666666666664},{x:.1375,y:.05,w:.05,h:.06666666666666667},{x:.1375,y:.05,w:.075,h:.1},{x:.1625,y:.05,w:.03125,h:.041666666666666664},{x:.1625,y:.05,w:.05,h:.06666666666666667},{x:.1625,y:.05,w:.075,h:.1},{x:.1875,y:.05,w:.03125,h:.041666666666666664},{x:.1875,y:.05,w:.05,h:.06666666666666667},{x:.1875,y:.05,w:.075,h:.1},{x:.2125,y:.05,w:.03125,h:.041666666666666664},{x:.2125,y:.05,w:.05,h:.06666666666666667},{x:.2125,y:.05,w:.075,h:.1},{x:.2375,y:.05,w:.03125,h:.041666666666666664},{x:.2375,y:.05,w:.05,h:.06666666666666667},{x:.2375,y:.05,w:.075,h:.1},{x:.2625,y:.05,w:.03125,h:.041666666666666664},{x:.2625,y:.05,w:.05,h:.06666666666666667},{x:.2625,y:.05,w:.075,h:.1},{x:.2875,y:.05,w:.03125,h:.041666666666666664},{x:.2875,y:.05,w:.05,h:.06666666666666667},{x:.2875,y:.05,w:.075,h:.1},{x:.3125,y:.05,w:.03125,h:.041666666666666664},{x:.3125,y:.05,w:.05,h:.06666666666666667},{x:.3125,y:.05,w:.075,h:.1},{x:.3375,y:.05,w:.03125,h:.041666666666666664},{x:.3375,y:.05,w:.05,h:.06666666666666667},{x:.3375,y:.05,w:.075,h:.1},{x:.3625,y:.05,w:.03125,h:.041666666666666664},{x:.3625,y:.05,w:.05,h:.06666666666666667},{x:.3625,y:.05,w:.075,h:.1},{x:.3875,y:.05,w:.03125,h:.041666666666666664},{x:.3875,y:.05,w:.05,h:.06666666666666667},{x:.3875,y:.05,w:.075,h:.1},{x:.4125,y:.05,w:.03125,h:.041666666666666664},{x:.4125,y:.05,w:.05,h:.06666666666666667},{x:.4125,y:.05,w:.075,h:.1},{x:.4375,y:.05,w:.03125,h:.041666666666666664},{x:.4375,y:.05,w:.05,h:.06666666666666667},{x:.4375,y:.05,w:.075,h:.1},{x:.4625,y:.05,w:.03125,h:.041666666666666664},{x:.4625,y:.05,w:.05,h:.06666666666666667},{x:.4625,y:.05,w:.075,h:.1},{x:.4875,y:.05,w:.03125,h:.041666666666666664},{x:.4875,y:.05,w:.05,h:.06666666666666667},{x:.4875,y:.05,w:.075,h:.1},{x:.5125,y:.05,w:.03125,h:.041666666666666664},{x:.5125,y:.05,w:.05,h:.06666666666666667},{x:.5125,y:.05,w:.075,h:.1},{x:.5375,y:.05,w:.03125,h:.041666666666666664},{x:.5375,y:.05,w:.05,h:.06666666666666667},{x:.5375,y:.05,w:.075,h:.1},{x:.5625,y:.05,w:.03125,h:.041666666666666664},{x:.5625,y:.05,w:.05,h:.06666666666666667},{x:.5625,y:.05,w:.075,h:.1},{x:.5875,y:.05,w:.03125,h:.041666666666666664},{x:.5875,y:.05,w:.05,h:.06666666666666667},{x:.5875,y:.05,w:.075,h:.1},{x:.6125,y:.05,w:.03125,h:.041666666666666664},{x:.6125,y:.05,w:.05,h:.06666666666666667},{x:.6125,y:.05,w:.075,h:.1},{x:.6375,y:.05,w:.03125,h:.041666666666666664},{x:.6375,y:.05,w:.05,h:.06666666666666667},{x:.6375,y:.05,w:.075,h:.1},{x:.6625,y:.05,w:.03125,h:.041666666666666664},{x:.6625,y:.05,w:.05,h:.06666666666666667},{x:.6625,y:.05,w:.075,h:.1},{x:.6875,y:.05,w:.03125,h:.041666666666666664},{x:.6875,y:.05,w:.05,h:.06666666666666667},{x:.6875,y:.05,w:.075,h:.1},{x:.7125,y:.05,w:.03125,h:.041666666666666664},{x:.7125,y:.05,w:.05,h:.06666666666666667},{x:.7125,y:.05,w:.075,h:.1},{x:.7375,y:.05,w:.03125,h:.041666666666666664},{x:.7375,y:.05,w:.05,h:.06666666666666667},{x:.7375,y:.05,w:.075,h:.1},{x:.7625,y:.05,w:.03125,h:.041666666666666664},{x:.7625,y:.05,w:.05,h:.06666666666666667},{x:.7625,y:.05,w:.075,h:.1},{x:.7875,y:.05,w:.03125,h:.041666666666666664},{x:.7875,y:.05,w:.05,h:.06666666666666667},{x:.7875,y:.05,w:.075,h:.1},{x:.8125,y:.05,w:.03125,h:.041666666666666664},{x:.8125,y:.05,w:.05,h:.06666666666666667},{x:.8125,y:.05,w:.075,h:.1},{x:.8375,y:.05,w:.03125,h:.041666666666666664},{x:.8375,y:.05,w:.05,h:.06666666666666667},{x:.8375,y:.05,w:.075,h:.1},{x:.8625,y:.05,w:.03125,h:.041666666666666664},{x:.8625,y:.05,w:.05,h:.06666666666666667},{x:.8625,y:.05,w:.075,h:.1},{x:.8875,y:.05,w:.03125,h:.041666666666666664},{x:.8875,y:.05,w:.05,h:.06666666666666667},{x:.8875,y:.05,w:.075,h:.1},{x:.9125,y:.05,w:.03125,h:.041666666666666664},{x:.9125,y:.05,w:.05,h:.06666666666666667},{x:.9125,y:.05,w:.075,h:.1},{x:.9375,y:.05,w:.03125,h:.041666666666666664},{x:.9375,y:.05,w:.05,h:.06666666666666667},{x:.9375,y:.05,w:.075,h:.1},{x:.9625,y:.05,w:.03125,h:.041666666666666664},{x:.9625,y:.05,w:.05,h:.06666666666666667},{x:.9625,y:.05,w:.075,h:.1},{x:.9875,y:.05,w:.03125,h:.041666666666666664},{x:.9875,y:.05,w:.05,h:.06666666666666667},{x:.9875,y:.05,w:.075,h:.1},{x:.0125,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.0125,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.0125,y:.08333333333333333,w:.075,h:.1},{x:.0375,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.0375,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.0375,y:.08333333333333333,w:.075,h:.1},{x:.0625,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.0625,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.0625,y:.08333333333333333,w:.075,h:.1},{x:.0875,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.0875,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.0875,y:.08333333333333333,w:.075,h:.1},{x:.1125,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.1125,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.1125,y:.08333333333333333,w:.075,h:.1},{x:.1375,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.1375,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.1375,y:.08333333333333333,w:.075,h:.1},{x:.1625,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.1625,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.1625,y:.08333333333333333,w:.075,h:.1},{x:.1875,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.1875,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.1875,y:.08333333333333333,w:.075,h:.1},{x:.2125,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.2125,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.2125,y:.08333333333333333,w:.075,h:.1},{x:.2375,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.2375,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.2375,y:.08333333333333333,w:.075,h:.1},{x:.2625,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.2625,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.2625,y:.08333333333333333,w:.075,h:.1},{x:.2875,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.2875,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.2875,y:.08333333333333333,w:.075,h:.1},{x:.3125,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.3125,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.3125,y:.08333333333333333,w:.075,h:.1},{x:.3375,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.3375,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.3375,y:.08333333333333333,w:.075,h:.1},{x:.3625,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.3625,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.3625,y:.08333333333333333,w:.075,h:.1},{x:.3875,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.3875,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.3875,y:.08333333333333333,w:.075,h:.1},{x:.4125,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.4125,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.4125,y:.08333333333333333,w:.075,h:.1},{x:.4375,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.4375,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.4375,y:.08333333333333333,w:.075,h:.1},{x:.4625,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.4625,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.4625,y:.08333333333333333,w:.075,h:.1},{x:.4875,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.4875,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.4875,y:.08333333333333333,w:.075,h:.1},{x:.5125,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.5125,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.5125,y:.08333333333333333,w:.075,h:.1},{x:.5375,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.5375,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.5375,y:.08333333333333333,w:.075,h:.1},{x:.5625,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.5625,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.5625,y:.08333333333333333,w:.075,h:.1},{x:.5875,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.5875,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.5875,y:.08333333333333333,w:.075,h:.1},{x:.6125,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.6125,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.6125,y:.08333333333333333,w:.075,h:.1},{x:.6375,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.6375,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.6375,y:.08333333333333333,w:.075,h:.1},{x:.6625,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.6625,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.6625,y:.08333333333333333,w:.075,h:.1},{x:.6875,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.6875,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.6875,y:.08333333333333333,w:.075,h:.1},{x:.7125,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.7125,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.7125,y:.08333333333333333,w:.075,h:.1},{x:.7375,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.7375,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.7375,y:.08333333333333333,w:.075,h:.1},{x:.7625,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.7625,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.7625,y:.08333333333333333,w:.075,h:.1},{x:.7875,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.7875,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.7875,y:.08333333333333333,w:.075,h:.1},{x:.8125,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.8125,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.8125,y:.08333333333333333,w:.075,h:.1},{x:.8375,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.8375,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.8375,y:.08333333333333333,w:.075,h:.1},{x:.8625,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.8625,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.8625,y:.08333333333333333,w:.075,h:.1},{x:.8875,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.8875,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.8875,y:.08333333333333333,w:.075,h:.1},{x:.9125,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.9125,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.9125,y:.08333333333333333,w:.075,h:.1},{x:.9375,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.9375,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.9375,y:.08333333333333333,w:.075,h:.1},{x:.9625,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.9625,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.9625,y:.08333333333333333,w:.075,h:.1},{x:.9875,y:.08333333333333333,w:.03125,h:.041666666666666664},{x:.9875,y:.08333333333333333,w:.05,h:.06666666666666667},{x:.9875,y:.08333333333333333,w:.075,h:.1},{x:.0125,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.0125,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.0125,y:.11666666666666667,w:.075,h:.1},{x:.0375,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.0375,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.0375,y:.11666666666666667,w:.075,h:.1},{x:.0625,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.0625,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.0625,y:.11666666666666667,w:.075,h:.1},{x:.0875,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.0875,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.0875,y:.11666666666666667,w:.075,h:.1},{x:.1125,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.1125,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.1125,y:.11666666666666667,w:.075,h:.1},{x:.1375,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.1375,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.1375,y:.11666666666666667,w:.075,h:.1},{x:.1625,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.1625,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.1625,y:.11666666666666667,w:.075,h:.1},{x:.1875,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.1875,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.1875,y:.11666666666666667,w:.075,h:.1},{x:.2125,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.2125,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.2125,y:.11666666666666667,w:.075,h:.1},{x:.2375,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.2375,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.2375,y:.11666666666666667,w:.075,h:.1},{x:.2625,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.2625,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.2625,y:.11666666666666667,w:.075,h:.1},{x:.2875,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.2875,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.2875,y:.11666666666666667,w:.075,h:.1},{x:.3125,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.3125,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.3125,y:.11666666666666667,w:.075,h:.1},{x:.3375,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.3375,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.3375,y:.11666666666666667,w:.075,h:.1},{x:.3625,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.3625,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.3625,y:.11666666666666667,w:.075,h:.1},{x:.3875,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.3875,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.3875,y:.11666666666666667,w:.075,h:.1},{x:.4125,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.4125,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.4125,y:.11666666666666667,w:.075,h:.1},{x:.4375,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.4375,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.4375,y:.11666666666666667,w:.075,h:.1},{x:.4625,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.4625,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.4625,y:.11666666666666667,w:.075,h:.1},{x:.4875,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.4875,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.4875,y:.11666666666666667,w:.075,h:.1},{x:.5125,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.5125,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.5125,y:.11666666666666667,w:.075,h:.1},{x:.5375,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.5375,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.5375,y:.11666666666666667,w:.075,h:.1},{x:.5625,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.5625,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.5625,y:.11666666666666667,w:.075,h:.1},{x:.5875,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.5875,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.5875,y:.11666666666666667,w:.075,h:.1},{x:.6125,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.6125,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.6125,y:.11666666666666667,w:.075,h:.1},{x:.6375,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.6375,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.6375,y:.11666666666666667,w:.075,h:.1},{x:.6625,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.6625,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.6625,y:.11666666666666667,w:.075,h:.1},{x:.6875,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.6875,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.6875,y:.11666666666666667,w:.075,h:.1},{x:.7125,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.7125,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.7125,y:.11666666666666667,w:.075,h:.1},{x:.7375,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.7375,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.7375,y:.11666666666666667,w:.075,h:.1},{x:.7625,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.7625,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.7625,y:.11666666666666667,w:.075,h:.1},{x:.7875,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.7875,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.7875,y:.11666666666666667,w:.075,h:.1},{x:.8125,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.8125,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.8125,y:.11666666666666667,w:.075,h:.1},{x:.8375,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.8375,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.8375,y:.11666666666666667,w:.075,h:.1},{x:.8625,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.8625,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.8625,y:.11666666666666667,w:.075,h:.1},{x:.8875,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.8875,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.8875,y:.11666666666666667,w:.075,h:.1},{x:.9125,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.9125,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.9125,y:.11666666666666667,w:.075,h:.1},{x:.9375,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.9375,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.9375,y:.11666666666666667,w:.075,h:.1},{x:.9625,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.9625,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.9625,y:.11666666666666667,w:.075,h:.1},{x:.9875,y:.11666666666666667,w:.03125,h:.041666666666666664},{x:.9875,y:.11666666666666667,w:.05,h:.06666666666666667},{x:.9875,y:.11666666666666667,w:.075,h:.1},{x:.0125,y:.15,w:.03125,h:.041666666666666664},{x:.0125,y:.15,w:.05,h:.06666666666666667},{x:.0125,y:.15,w:.075,h:.1},{x:.0375,y:.15,w:.03125,h:.041666666666666664},{x:.0375,y:.15,w:.05,h:.06666666666666667},{x:.0375,y:.15,w:.075,h:.1},{x:.0625,y:.15,w:.03125,h:.041666666666666664},{x:.0625,y:.15,w:.05,h:.06666666666666667},{x:.0625,y:.15,w:.075,h:.1},{x:.0875,y:.15,w:.03125,h:.041666666666666664},{x:.0875,y:.15,w:.05,h:.06666666666666667},{x:.0875,y:.15,w:.075,h:.1},{x:.1125,y:.15,w:.03125,h:.041666666666666664},{x:.1125,y:.15,w:.05,h:.06666666666666667},{x:.1125,y:.15,w:.075,h:.1},{x:.1375,y:.15,w:.03125,h:.041666666666666664},{x:.1375,y:.15,w:.05,h:.06666666666666667},{x:.1375,y:.15,w:.075,h:.1},{x:.1625,y:.15,w:.03125,h:.041666666666666664},{x:.1625,y:.15,w:.05,h:.06666666666666667},{x:.1625,y:.15,w:.075,h:.1},{x:.1875,y:.15,w:.03125,h:.041666666666666664},{x:.1875,y:.15,w:.05,h:.06666666666666667},{x:.1875,y:.15,w:.075,h:.1},{x:.2125,y:.15,w:.03125,h:.041666666666666664},{x:.2125,y:.15,w:.05,h:.06666666666666667},{x:.2125,y:.15,w:.075,h:.1},{x:.2375,y:.15,w:.03125,h:.041666666666666664},{x:.2375,y:.15,w:.05,h:.06666666666666667},{x:.2375,y:.15,w:.075,h:.1},{x:.2625,y:.15,w:.03125,h:.041666666666666664},{x:.2625,y:.15,w:.05,h:.06666666666666667},{x:.2625,y:.15,w:.075,h:.1},{x:.2875,y:.15,w:.03125,h:.041666666666666664},{x:.2875,y:.15,w:.05,h:.06666666666666667},{x:.2875,y:.15,w:.075,h:.1},{x:.3125,y:.15,w:.03125,h:.041666666666666664},{x:.3125,y:.15,w:.05,h:.06666666666666667},{x:.3125,y:.15,w:.075,h:.1},{x:.3375,y:.15,w:.03125,h:.041666666666666664},{x:.3375,y:.15,w:.05,h:.06666666666666667},{x:.3375,y:.15,w:.075,h:.1},{x:.3625,y:.15,w:.03125,h:.041666666666666664},{x:.3625,y:.15,w:.05,h:.06666666666666667},{x:.3625,y:.15,w:.075,h:.1},{x:.3875,y:.15,w:.03125,h:.041666666666666664},{x:.3875,y:.15,w:.05,h:.06666666666666667},{x:.3875,y:.15,w:.075,h:.1},{x:.4125,y:.15,w:.03125,h:.041666666666666664},{x:.4125,y:.15,w:.05,h:.06666666666666667},{x:.4125,y:.15,w:.075,h:.1},{x:.4375,y:.15,w:.03125,h:.041666666666666664},{x:.4375,y:.15,w:.05,h:.06666666666666667},{x:.4375,y:.15,w:.075,h:.1},{x:.4625,y:.15,w:.03125,h:.041666666666666664},{x:.4625,y:.15,w:.05,h:.06666666666666667},{x:.4625,y:.15,w:.075,h:.1},{x:.4875,y:.15,w:.03125,h:.041666666666666664},{x:.4875,y:.15,w:.05,h:.06666666666666667},{x:.4875,y:.15,w:.075,h:.1},{x:.5125,y:.15,w:.03125,h:.041666666666666664},{x:.5125,y:.15,w:.05,h:.06666666666666667},{x:.5125,y:.15,w:.075,h:.1},{x:.5375,y:.15,w:.03125,h:.041666666666666664},{x:.5375,y:.15,w:.05,h:.06666666666666667},{x:.5375,y:.15,w:.075,h:.1},{x:.5625,y:.15,w:.03125,h:.041666666666666664},{x:.5625,y:.15,w:.05,h:.06666666666666667},{x:.5625,y:.15,w:.075,h:.1},{x:.5875,y:.15,w:.03125,h:.041666666666666664},{x:.5875,y:.15,w:.05,h:.06666666666666667},{x:.5875,y:.15,w:.075,h:.1},{x:.6125,y:.15,w:.03125,h:.041666666666666664},{x:.6125,y:.15,w:.05,h:.06666666666666667},{x:.6125,y:.15,w:.075,h:.1},{x:.6375,y:.15,w:.03125,h:.041666666666666664},{x:.6375,y:.15,w:.05,h:.06666666666666667},{x:.6375,y:.15,w:.075,h:.1},{x:.6625,y:.15,w:.03125,h:.041666666666666664},{x:.6625,y:.15,w:.05,h:.06666666666666667},{x:.6625,y:.15,w:.075,h:.1},{x:.6875,y:.15,w:.03125,h:.041666666666666664},{x:.6875,y:.15,w:.05,h:.06666666666666667},{x:.6875,y:.15,w:.075,h:.1},{x:.7125,y:.15,w:.03125,h:.041666666666666664},{x:.7125,y:.15,w:.05,h:.06666666666666667},{x:.7125,y:.15,w:.075,h:.1},{x:.7375,y:.15,w:.03125,h:.041666666666666664},{x:.7375,y:.15,w:.05,h:.06666666666666667},{x:.7375,y:.15,w:.075,h:.1},{x:.7625,y:.15,w:.03125,h:.041666666666666664},{x:.7625,y:.15,w:.05,h:.06666666666666667},{x:.7625,y:.15,w:.075,h:.1},{x:.7875,y:.15,w:.03125,h:.041666666666666664},{x:.7875,y:.15,w:.05,h:.06666666666666667},{x:.7875,y:.15,w:.075,h:.1},{x:.8125,y:.15,w:.03125,h:.041666666666666664},{x:.8125,y:.15,w:.05,h:.06666666666666667},{x:.8125,y:.15,w:.075,h:.1},{x:.8375,y:.15,w:.03125,h:.041666666666666664},{x:.8375,y:.15,w:.05,h:.06666666666666667},{x:.8375,y:.15,w:.075,h:.1},{x:.8625,y:.15,w:.03125,h:.041666666666666664},{x:.8625,y:.15,w:.05,h:.06666666666666667},{x:.8625,y:.15,w:.075,h:.1},{x:.8875,y:.15,w:.03125,h:.041666666666666664},{x:.8875,y:.15,w:.05,h:.06666666666666667},{x:.8875,y:.15,w:.075,h:.1},{x:.9125,y:.15,w:.03125,h:.041666666666666664},{x:.9125,y:.15,w:.05,h:.06666666666666667},{x:.9125,y:.15,w:.075,h:.1},{x:.9375,y:.15,w:.03125,h:.041666666666666664},{x:.9375,y:.15,w:.05,h:.06666666666666667},{x:.9375,y:.15,w:.075,h:.1},{x:.9625,y:.15,w:.03125,h:.041666666666666664},{x:.9625,y:.15,w:.05,h:.06666666666666667},{x:.9625,y:.15,w:.075,h:.1},{x:.9875,y:.15,w:.03125,h:.041666666666666664},{x:.9875,y:.15,w:.05,h:.06666666666666667},{x:.9875,y:.15,w:.075,h:.1},{x:.0125,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.0125,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.0125,y:.18333333333333332,w:.075,h:.1},{x:.0375,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.0375,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.0375,y:.18333333333333332,w:.075,h:.1},{x:.0625,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.0625,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.0625,y:.18333333333333332,w:.075,h:.1},{x:.0875,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.0875,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.0875,y:.18333333333333332,w:.075,h:.1},{x:.1125,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.1125,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.1125,y:.18333333333333332,w:.075,h:.1},{x:.1375,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.1375,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.1375,y:.18333333333333332,w:.075,h:.1},{x:.1625,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.1625,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.1625,y:.18333333333333332,w:.075,h:.1},{x:.1875,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.1875,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.1875,y:.18333333333333332,w:.075,h:.1},{x:.2125,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.2125,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.2125,y:.18333333333333332,w:.075,h:.1},{x:.2375,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.2375,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.2375,y:.18333333333333332,w:.075,h:.1},{x:.2625,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.2625,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.2625,y:.18333333333333332,w:.075,h:.1},{x:.2875,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.2875,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.2875,y:.18333333333333332,w:.075,h:.1},{x:.3125,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.3125,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.3125,y:.18333333333333332,w:.075,h:.1},{x:.3375,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.3375,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.3375,y:.18333333333333332,w:.075,h:.1},{x:.3625,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.3625,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.3625,y:.18333333333333332,w:.075,h:.1},{x:.3875,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.3875,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.3875,y:.18333333333333332,w:.075,h:.1},{x:.4125,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.4125,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.4125,y:.18333333333333332,w:.075,h:.1},{x:.4375,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.4375,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.4375,y:.18333333333333332,w:.075,h:.1},{x:.4625,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.4625,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.4625,y:.18333333333333332,w:.075,h:.1},{x:.4875,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.4875,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.4875,y:.18333333333333332,w:.075,h:.1},{x:.5125,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.5125,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.5125,y:.18333333333333332,w:.075,h:.1},{x:.5375,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.5375,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.5375,y:.18333333333333332,w:.075,h:.1},{x:.5625,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.5625,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.5625,y:.18333333333333332,w:.075,h:.1},{x:.5875,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.5875,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.5875,y:.18333333333333332,w:.075,h:.1},{x:.6125,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.6125,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.6125,y:.18333333333333332,w:.075,h:.1},{x:.6375,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.6375,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.6375,y:.18333333333333332,w:.075,h:.1},{x:.6625,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.6625,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.6625,y:.18333333333333332,w:.075,h:.1},{x:.6875,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.6875,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.6875,y:.18333333333333332,w:.075,h:.1},{x:.7125,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.7125,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.7125,y:.18333333333333332,w:.075,h:.1},{x:.7375,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.7375,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.7375,y:.18333333333333332,w:.075,h:.1},{x:.7625,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.7625,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.7625,y:.18333333333333332,w:.075,h:.1},{x:.7875,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.7875,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.7875,y:.18333333333333332,w:.075,h:.1},{x:.8125,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.8125,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.8125,y:.18333333333333332,w:.075,h:.1},{x:.8375,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.8375,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.8375,y:.18333333333333332,w:.075,h:.1},{x:.8625,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.8625,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.8625,y:.18333333333333332,w:.075,h:.1},{x:.8875,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.8875,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.8875,y:.18333333333333332,w:.075,h:.1},{x:.9125,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.9125,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.9125,y:.18333333333333332,w:.075,h:.1},{x:.9375,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.9375,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.9375,y:.18333333333333332,w:.075,h:.1},{x:.9625,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.9625,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.9625,y:.18333333333333332,w:.075,h:.1},{x:.9875,y:.18333333333333332,w:.03125,h:.041666666666666664},{x:.9875,y:.18333333333333332,w:.05,h:.06666666666666667},{x:.9875,y:.18333333333333332,w:.075,h:.1},{x:.0125,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.0125,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.0125,y:.21666666666666667,w:.075,h:.1},{x:.0375,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.0375,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.0375,y:.21666666666666667,w:.075,h:.1},{x:.0625,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.0625,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.0625,y:.21666666666666667,w:.075,h:.1},{x:.0875,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.0875,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.0875,y:.21666666666666667,w:.075,h:.1},{x:.1125,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.1125,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.1125,y:.21666666666666667,w:.075,h:.1},{x:.1375,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.1375,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.1375,y:.21666666666666667,w:.075,h:.1},{x:.1625,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.1625,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.1625,y:.21666666666666667,w:.075,h:.1},{x:.1875,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.1875,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.1875,y:.21666666666666667,w:.075,h:.1},{x:.2125,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.2125,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.2125,y:.21666666666666667,w:.075,h:.1},{x:.2375,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.2375,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.2375,y:.21666666666666667,w:.075,h:.1},{x:.2625,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.2625,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.2625,y:.21666666666666667,w:.075,h:.1},{x:.2875,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.2875,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.2875,y:.21666666666666667,w:.075,h:.1},{x:.3125,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.3125,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.3125,y:.21666666666666667,w:.075,h:.1},{x:.3375,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.3375,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.3375,y:.21666666666666667,w:.075,h:.1},{x:.3625,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.3625,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.3625,y:.21666666666666667,w:.075,h:.1},{x:.3875,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.3875,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.3875,y:.21666666666666667,w:.075,h:.1},{x:.4125,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.4125,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.4125,y:.21666666666666667,w:.075,h:.1},{x:.4375,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.4375,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.4375,y:.21666666666666667,w:.075,h:.1},{x:.4625,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.4625,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.4625,y:.21666666666666667,w:.075,h:.1},{x:.4875,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.4875,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.4875,y:.21666666666666667,w:.075,h:.1},{x:.5125,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.5125,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.5125,y:.21666666666666667,w:.075,h:.1},{x:.5375,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.5375,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.5375,y:.21666666666666667,w:.075,h:.1},{x:.5625,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.5625,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.5625,y:.21666666666666667,w:.075,h:.1},{x:.5875,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.5875,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.5875,y:.21666666666666667,w:.075,h:.1},{x:.6125,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.6125,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.6125,y:.21666666666666667,w:.075,h:.1},{x:.6375,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.6375,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.6375,y:.21666666666666667,w:.075,h:.1},{x:.6625,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.6625,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.6625,y:.21666666666666667,w:.075,h:.1},{x:.6875,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.6875,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.6875,y:.21666666666666667,w:.075,h:.1},{x:.7125,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.7125,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.7125,y:.21666666666666667,w:.075,h:.1},{x:.7375,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.7375,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.7375,y:.21666666666666667,w:.075,h:.1},{x:.7625,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.7625,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.7625,y:.21666666666666667,w:.075,h:.1},{x:.7875,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.7875,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.7875,y:.21666666666666667,w:.075,h:.1},{x:.8125,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.8125,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.8125,y:.21666666666666667,w:.075,h:.1},{x:.8375,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.8375,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.8375,y:.21666666666666667,w:.075,h:.1},{x:.8625,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.8625,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.8625,y:.21666666666666667,w:.075,h:.1},{x:.8875,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.8875,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.8875,y:.21666666666666667,w:.075,h:.1},{x:.9125,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.9125,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.9125,y:.21666666666666667,w:.075,h:.1},{x:.9375,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.9375,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.9375,y:.21666666666666667,w:.075,h:.1},{x:.9625,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.9625,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.9625,y:.21666666666666667,w:.075,h:.1},{x:.9875,y:.21666666666666667,w:.03125,h:.041666666666666664},{x:.9875,y:.21666666666666667,w:.05,h:.06666666666666667},{x:.9875,y:.21666666666666667,w:.075,h:.1},{x:.0125,y:.25,w:.03125,h:.041666666666666664},{x:.0125,y:.25,w:.05,h:.06666666666666667},{x:.0125,y:.25,w:.075,h:.1},{x:.0375,y:.25,w:.03125,h:.041666666666666664},{x:.0375,y:.25,w:.05,h:.06666666666666667},{x:.0375,y:.25,w:.075,h:.1},{x:.0625,y:.25,w:.03125,h:.041666666666666664},{x:.0625,y:.25,w:.05,h:.06666666666666667},{x:.0625,y:.25,w:.075,h:.1},{x:.0875,y:.25,w:.03125,h:.041666666666666664},{x:.0875,y:.25,w:.05,h:.06666666666666667},{x:.0875,y:.25,w:.075,h:.1},{x:.1125,y:.25,w:.03125,h:.041666666666666664},{x:.1125,y:.25,w:.05,h:.06666666666666667},{x:.1125,y:.25,w:.075,h:.1},{x:.1375,y:.25,w:.03125,h:.041666666666666664},{x:.1375,y:.25,w:.05,h:.06666666666666667},{x:.1375,y:.25,w:.075,h:.1},{x:.1625,y:.25,w:.03125,h:.041666666666666664},{x:.1625,y:.25,w:.05,h:.06666666666666667},{x:.1625,y:.25,w:.075,h:.1},{x:.1875,y:.25,w:.03125,h:.041666666666666664},{x:.1875,y:.25,w:.05,h:.06666666666666667},{x:.1875,y:.25,w:.075,h:.1},{x:.2125,y:.25,w:.03125,h:.041666666666666664},{x:.2125,y:.25,w:.05,h:.06666666666666667},{x:.2125,y:.25,w:.075,h:.1},{x:.2375,y:.25,w:.03125,h:.041666666666666664},{x:.2375,y:.25,w:.05,h:.06666666666666667},{x:.2375,y:.25,w:.075,h:.1},{x:.2625,y:.25,w:.03125,h:.041666666666666664},{x:.2625,y:.25,w:.05,h:.06666666666666667},{x:.2625,y:.25,w:.075,h:.1},{x:.2875,y:.25,w:.03125,h:.041666666666666664},{x:.2875,y:.25,w:.05,h:.06666666666666667},{x:.2875,y:.25,w:.075,h:.1},{x:.3125,y:.25,w:.03125,h:.041666666666666664},{x:.3125,y:.25,w:.05,h:.06666666666666667},{x:.3125,y:.25,w:.075,h:.1},{x:.3375,y:.25,w:.03125,h:.041666666666666664},{x:.3375,y:.25,w:.05,h:.06666666666666667},{x:.3375,y:.25,w:.075,h:.1},{x:.3625,y:.25,w:.03125,h:.041666666666666664},{x:.3625,y:.25,w:.05,h:.06666666666666667},{x:.3625,y:.25,w:.075,h:.1},{x:.3875,y:.25,w:.03125,h:.041666666666666664},{x:.3875,y:.25,w:.05,h:.06666666666666667},{x:.3875,y:.25,w:.075,h:.1},{x:.4125,y:.25,w:.03125,h:.041666666666666664},{x:.4125,y:.25,w:.05,h:.06666666666666667},{x:.4125,y:.25,w:.075,h:.1},{x:.4375,y:.25,w:.03125,h:.041666666666666664},{x:.4375,y:.25,w:.05,h:.06666666666666667},{x:.4375,y:.25,w:.075,h:.1},{x:.4625,y:.25,w:.03125,h:.041666666666666664},{x:.4625,y:.25,w:.05,h:.06666666666666667},{x:.4625,y:.25,w:.075,h:.1},{x:.4875,y:.25,w:.03125,h:.041666666666666664},{x:.4875,y:.25,w:.05,h:.06666666666666667},{x:.4875,y:.25,w:.075,h:.1},{x:.5125,y:.25,w:.03125,h:.041666666666666664},{x:.5125,y:.25,w:.05,h:.06666666666666667},{x:.5125,y:.25,w:.075,h:.1},{x:.5375,y:.25,w:.03125,h:.041666666666666664},{x:.5375,y:.25,w:.05,h:.06666666666666667},{x:.5375,y:.25,w:.075,h:.1},{x:.5625,y:.25,w:.03125,h:.041666666666666664},{x:.5625,y:.25,w:.05,h:.06666666666666667},{x:.5625,y:.25,w:.075,h:.1},{x:.5875,y:.25,w:.03125,h:.041666666666666664},{x:.5875,y:.25,w:.05,h:.06666666666666667},{x:.5875,y:.25,w:.075,h:.1},{x:.6125,y:.25,w:.03125,h:.041666666666666664},{x:.6125,y:.25,w:.05,h:.06666666666666667},{x:.6125,y:.25,w:.075,h:.1},{x:.6375,y:.25,w:.03125,h:.041666666666666664},{x:.6375,y:.25,w:.05,h:.06666666666666667},{x:.6375,y:.25,w:.075,h:.1},{x:.6625,y:.25,w:.03125,h:.041666666666666664},{x:.6625,y:.25,w:.05,h:.06666666666666667},{x:.6625,y:.25,w:.075,h:.1},{x:.6875,y:.25,w:.03125,h:.041666666666666664},{x:.6875,y:.25,w:.05,h:.06666666666666667},{x:.6875,y:.25,w:.075,h:.1},{x:.7125,y:.25,w:.03125,h:.041666666666666664},{x:.7125,y:.25,w:.05,h:.06666666666666667},{x:.7125,y:.25,w:.075,h:.1},{x:.7375,y:.25,w:.03125,h:.041666666666666664},{x:.7375,y:.25,w:.05,h:.06666666666666667},{x:.7375,y:.25,w:.075,h:.1},{x:.7625,y:.25,w:.03125,h:.041666666666666664},{x:.7625,y:.25,w:.05,h:.06666666666666667},{x:.7625,y:.25,w:.075,h:.1},{x:.7875,y:.25,w:.03125,h:.041666666666666664},{x:.7875,y:.25,w:.05,h:.06666666666666667},{x:.7875,y:.25,w:.075,h:.1},{x:.8125,y:.25,w:.03125,h:.041666666666666664},{x:.8125,y:.25,w:.05,h:.06666666666666667},{x:.8125,y:.25,w:.075,h:.1},{x:.8375,y:.25,w:.03125,h:.041666666666666664},{x:.8375,y:.25,w:.05,h:.06666666666666667},{x:.8375,y:.25,w:.075,h:.1},{x:.8625,y:.25,w:.03125,h:.041666666666666664},{x:.8625,y:.25,w:.05,h:.06666666666666667},{x:.8625,y:.25,w:.075,h:.1},{x:.8875,y:.25,w:.03125,h:.041666666666666664},{x:.8875,y:.25,w:.05,h:.06666666666666667},{x:.8875,y:.25,w:.075,h:.1},{x:.9125,y:.25,w:.03125,h:.041666666666666664},{x:.9125,y:.25,w:.05,h:.06666666666666667},{x:.9125,y:.25,w:.075,h:.1},{x:.9375,y:.25,w:.03125,h:.041666666666666664},{x:.9375,y:.25,w:.05,h:.06666666666666667},{x:.9375,y:.25,w:.075,h:.1},{x:.9625,y:.25,w:.03125,h:.041666666666666664},{x:.9625,y:.25,w:.05,h:.06666666666666667},{x:.9625,y:.25,w:.075,h:.1},{x:.9875,y:.25,w:.03125,h:.041666666666666664},{x:.9875,y:.25,w:.05,h:.06666666666666667},{x:.9875,y:.25,w:.075,h:.1},{x:.0125,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.0125,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.0125,y:.2833333333333333,w:.075,h:.1},{x:.0375,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.0375,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.0375,y:.2833333333333333,w:.075,h:.1},{x:.0625,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.0625,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.0625,y:.2833333333333333,w:.075,h:.1},{x:.0875,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.0875,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.0875,y:.2833333333333333,w:.075,h:.1},{x:.1125,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.1125,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.1125,y:.2833333333333333,w:.075,h:.1},{x:.1375,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.1375,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.1375,y:.2833333333333333,w:.075,h:.1},{x:.1625,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.1625,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.1625,y:.2833333333333333,w:.075,h:.1},{x:.1875,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.1875,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.1875,y:.2833333333333333,w:.075,h:.1},{x:.2125,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.2125,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.2125,y:.2833333333333333,w:.075,h:.1},{x:.2375,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.2375,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.2375,y:.2833333333333333,w:.075,h:.1},{x:.2625,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.2625,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.2625,y:.2833333333333333,w:.075,h:.1},{x:.2875,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.2875,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.2875,y:.2833333333333333,w:.075,h:.1},{x:.3125,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.3125,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.3125,y:.2833333333333333,w:.075,h:.1},{x:.3375,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.3375,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.3375,y:.2833333333333333,w:.075,h:.1},{x:.3625,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.3625,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.3625,y:.2833333333333333,w:.075,h:.1},{x:.3875,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.3875,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.3875,y:.2833333333333333,w:.075,h:.1},{x:.4125,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.4125,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.4125,y:.2833333333333333,w:.075,h:.1},{x:.4375,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.4375,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.4375,y:.2833333333333333,w:.075,h:.1},{x:.4625,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.4625,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.4625,y:.2833333333333333,w:.075,h:.1},{x:.4875,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.4875,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.4875,y:.2833333333333333,w:.075,h:.1},{x:.5125,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.5125,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.5125,y:.2833333333333333,w:.075,h:.1},{x:.5375,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.5375,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.5375,y:.2833333333333333,w:.075,h:.1},{x:.5625,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.5625,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.5625,y:.2833333333333333,w:.075,h:.1},{x:.5875,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.5875,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.5875,y:.2833333333333333,w:.075,h:.1},{x:.6125,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.6125,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.6125,y:.2833333333333333,w:.075,h:.1},{x:.6375,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.6375,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.6375,y:.2833333333333333,w:.075,h:.1},{x:.6625,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.6625,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.6625,y:.2833333333333333,w:.075,h:.1},{x:.6875,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.6875,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.6875,y:.2833333333333333,w:.075,h:.1},{x:.7125,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.7125,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.7125,y:.2833333333333333,w:.075,h:.1},{x:.7375,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.7375,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.7375,y:.2833333333333333,w:.075,h:.1},{x:.7625,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.7625,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.7625,y:.2833333333333333,w:.075,h:.1},{x:.7875,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.7875,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.7875,y:.2833333333333333,w:.075,h:.1},{x:.8125,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.8125,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.8125,y:.2833333333333333,w:.075,h:.1},{x:.8375,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.8375,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.8375,y:.2833333333333333,w:.075,h:.1},{x:.8625,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.8625,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.8625,y:.2833333333333333,w:.075,h:.1},{x:.8875,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.8875,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.8875,y:.2833333333333333,w:.075,h:.1},{x:.9125,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.9125,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.9125,y:.2833333333333333,w:.075,h:.1},{x:.9375,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.9375,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.9375,y:.2833333333333333,w:.075,h:.1},{x:.9625,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.9625,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.9625,y:.2833333333333333,w:.075,h:.1},{x:.9875,y:.2833333333333333,w:.03125,h:.041666666666666664},{x:.9875,y:.2833333333333333,w:.05,h:.06666666666666667},{x:.9875,y:.2833333333333333,w:.075,h:.1},{x:.0125,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.0125,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.0125,y:.31666666666666665,w:.075,h:.1},{x:.0375,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.0375,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.0375,y:.31666666666666665,w:.075,h:.1},{x:.0625,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.0625,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.0625,y:.31666666666666665,w:.075,h:.1},{x:.0875,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.0875,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.0875,y:.31666666666666665,w:.075,h:.1},{x:.1125,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.1125,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.1125,y:.31666666666666665,w:.075,h:.1},{x:.1375,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.1375,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.1375,y:.31666666666666665,w:.075,h:.1},{x:.1625,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.1625,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.1625,y:.31666666666666665,w:.075,h:.1},{x:.1875,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.1875,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.1875,y:.31666666666666665,w:.075,h:.1},{x:.2125,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.2125,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.2125,y:.31666666666666665,w:.075,h:.1},{x:.2375,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.2375,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.2375,y:.31666666666666665,w:.075,h:.1},{x:.2625,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.2625,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.2625,y:.31666666666666665,w:.075,h:.1},{x:.2875,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.2875,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.2875,y:.31666666666666665,w:.075,h:.1},{x:.3125,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.3125,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.3125,y:.31666666666666665,w:.075,h:.1},{x:.3375,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.3375,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.3375,y:.31666666666666665,w:.075,h:.1},{x:.3625,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.3625,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.3625,y:.31666666666666665,w:.075,h:.1},{x:.3875,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.3875,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.3875,y:.31666666666666665,w:.075,h:.1},{x:.4125,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.4125,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.4125,y:.31666666666666665,w:.075,h:.1},{x:.4375,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.4375,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.4375,y:.31666666666666665,w:.075,h:.1},{x:.4625,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.4625,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.4625,y:.31666666666666665,w:.075,h:.1},{x:.4875,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.4875,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.4875,y:.31666666666666665,w:.075,h:.1},{x:.5125,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.5125,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.5125,y:.31666666666666665,w:.075,h:.1},{x:.5375,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.5375,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.5375,y:.31666666666666665,w:.075,h:.1},{x:.5625,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.5625,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.5625,y:.31666666666666665,w:.075,h:.1},{x:.5875,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.5875,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.5875,y:.31666666666666665,w:.075,h:.1},{x:.6125,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.6125,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.6125,y:.31666666666666665,w:.075,h:.1},{x:.6375,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.6375,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.6375,y:.31666666666666665,w:.075,h:.1},{x:.6625,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.6625,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.6625,y:.31666666666666665,w:.075,h:.1},{x:.6875,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.6875,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.6875,y:.31666666666666665,w:.075,h:.1},{x:.7125,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.7125,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.7125,y:.31666666666666665,w:.075,h:.1},{x:.7375,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.7375,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.7375,y:.31666666666666665,w:.075,h:.1},{x:.7625,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.7625,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.7625,y:.31666666666666665,w:.075,h:.1},{x:.7875,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.7875,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.7875,y:.31666666666666665,w:.075,h:.1},{x:.8125,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.8125,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.8125,y:.31666666666666665,w:.075,h:.1},{x:.8375,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.8375,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.8375,y:.31666666666666665,w:.075,h:.1},{x:.8625,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.8625,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.8625,y:.31666666666666665,w:.075,h:.1},{x:.8875,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.8875,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.8875,y:.31666666666666665,w:.075,h:.1},{x:.9125,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.9125,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.9125,y:.31666666666666665,w:.075,h:.1},{x:.9375,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.9375,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.9375,y:.31666666666666665,w:.075,h:.1},{x:.9625,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.9625,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.9625,y:.31666666666666665,w:.075,h:.1},{x:.9875,y:.31666666666666665,w:.03125,h:.041666666666666664},{x:.9875,y:.31666666666666665,w:.05,h:.06666666666666667},{x:.9875,y:.31666666666666665,w:.075,h:.1},{x:.0125,y:.35,w:.03125,h:.041666666666666664},{x:.0125,y:.35,w:.05,h:.06666666666666667},{x:.0125,y:.35,w:.075,h:.1},{x:.0375,y:.35,w:.03125,h:.041666666666666664},{x:.0375,y:.35,w:.05,h:.06666666666666667},{x:.0375,y:.35,w:.075,h:.1},{x:.0625,y:.35,w:.03125,h:.041666666666666664},{x:.0625,y:.35,w:.05,h:.06666666666666667},{x:.0625,y:.35,w:.075,h:.1},{x:.0875,y:.35,w:.03125,h:.041666666666666664},{x:.0875,y:.35,w:.05,h:.06666666666666667},{x:.0875,y:.35,w:.075,h:.1},{x:.1125,y:.35,w:.03125,h:.041666666666666664},{x:.1125,y:.35,w:.05,h:.06666666666666667},{x:.1125,y:.35,w:.075,h:.1},{x:.1375,y:.35,w:.03125,h:.041666666666666664},{x:.1375,y:.35,w:.05,h:.06666666666666667},{x:.1375,y:.35,w:.075,h:.1},{x:.1625,y:.35,w:.03125,h:.041666666666666664},{x:.1625,y:.35,w:.05,h:.06666666666666667},{x:.1625,y:.35,w:.075,h:.1},{x:.1875,y:.35,w:.03125,h:.041666666666666664},{x:.1875,y:.35,w:.05,h:.06666666666666667},{x:.1875,y:.35,w:.075,h:.1},{x:.2125,y:.35,w:.03125,h:.041666666666666664},{x:.2125,y:.35,w:.05,h:.06666666666666667},{x:.2125,y:.35,w:.075,h:.1},{x:.2375,y:.35,w:.03125,h:.041666666666666664},{x:.2375,y:.35,w:.05,h:.06666666666666667},{x:.2375,y:.35,w:.075,h:.1},{x:.2625,y:.35,w:.03125,h:.041666666666666664},{x:.2625,y:.35,w:.05,h:.06666666666666667},{x:.2625,y:.35,w:.075,h:.1},{x:.2875,y:.35,w:.03125,h:.041666666666666664},{x:.2875,y:.35,w:.05,h:.06666666666666667},{x:.2875,y:.35,w:.075,h:.1},{x:.3125,y:.35,w:.03125,h:.041666666666666664},{x:.3125,y:.35,w:.05,h:.06666666666666667},{x:.3125,y:.35,w:.075,h:.1},{x:.3375,y:.35,w:.03125,h:.041666666666666664},{x:.3375,y:.35,w:.05,h:.06666666666666667},{x:.3375,y:.35,w:.075,h:.1},{x:.3625,y:.35,w:.03125,h:.041666666666666664},{x:.3625,y:.35,w:.05,h:.06666666666666667},{x:.3625,y:.35,w:.075,h:.1},{x:.3875,y:.35,w:.03125,h:.041666666666666664},{x:.3875,y:.35,w:.05,h:.06666666666666667},{x:.3875,y:.35,w:.075,h:.1},{x:.4125,y:.35,w:.03125,h:.041666666666666664},{x:.4125,y:.35,w:.05,h:.06666666666666667},{x:.4125,y:.35,w:.075,h:.1},{x:.4375,y:.35,w:.03125,h:.041666666666666664},{x:.4375,y:.35,w:.05,h:.06666666666666667},{x:.4375,y:.35,w:.075,h:.1},{x:.4625,y:.35,w:.03125,h:.041666666666666664},{x:.4625,y:.35,w:.05,h:.06666666666666667},{x:.4625,y:.35,w:.075,h:.1},{x:.4875,y:.35,w:.03125,h:.041666666666666664},{x:.4875,y:.35,w:.05,h:.06666666666666667},{x:.4875,y:.35,w:.075,h:.1},{x:.5125,y:.35,w:.03125,h:.041666666666666664},{x:.5125,y:.35,w:.05,h:.06666666666666667},{x:.5125,y:.35,w:.075,h:.1},{x:.5375,y:.35,w:.03125,h:.041666666666666664},{x:.5375,y:.35,w:.05,h:.06666666666666667},{x:.5375,y:.35,w:.075,h:.1},{x:.5625,y:.35,w:.03125,h:.041666666666666664},{x:.5625,y:.35,w:.05,h:.06666666666666667},{x:.5625,y:.35,w:.075,h:.1},{x:.5875,y:.35,w:.03125,h:.041666666666666664},{x:.5875,y:.35,w:.05,h:.06666666666666667},{x:.5875,y:.35,w:.075,h:.1},{x:.6125,y:.35,w:.03125,h:.041666666666666664},{x:.6125,y:.35,w:.05,h:.06666666666666667},{x:.6125,y:.35,w:.075,h:.1},{x:.6375,y:.35,w:.03125,h:.041666666666666664},{x:.6375,y:.35,w:.05,h:.06666666666666667},{x:.6375,y:.35,w:.075,h:.1},{x:.6625,y:.35,w:.03125,h:.041666666666666664},{x:.6625,y:.35,w:.05,h:.06666666666666667},{x:.6625,y:.35,w:.075,h:.1},{x:.6875,y:.35,w:.03125,h:.041666666666666664},{x:.6875,y:.35,w:.05,h:.06666666666666667},{x:.6875,y:.35,w:.075,h:.1},{x:.7125,y:.35,w:.03125,h:.041666666666666664},{x:.7125,y:.35,w:.05,h:.06666666666666667},{x:.7125,y:.35,w:.075,h:.1},{x:.7375,y:.35,w:.03125,h:.041666666666666664},{x:.7375,y:.35,w:.05,h:.06666666666666667},{x:.7375,y:.35,w:.075,h:.1},{x:.7625,y:.35,w:.03125,h:.041666666666666664},{x:.7625,y:.35,w:.05,h:.06666666666666667},{x:.7625,y:.35,w:.075,h:.1},{x:.7875,y:.35,w:.03125,h:.041666666666666664},{x:.7875,y:.35,w:.05,h:.06666666666666667},{x:.7875,y:.35,w:.075,h:.1},{x:.8125,y:.35,w:.03125,h:.041666666666666664},{x:.8125,y:.35,w:.05,h:.06666666666666667},{x:.8125,y:.35,w:.075,h:.1},{x:.8375,y:.35,w:.03125,h:.041666666666666664},{x:.8375,y:.35,w:.05,h:.06666666666666667},{x:.8375,y:.35,w:.075,h:.1},{x:.8625,y:.35,w:.03125,h:.041666666666666664},{x:.8625,y:.35,w:.05,h:.06666666666666667},{x:.8625,y:.35,w:.075,h:.1},{x:.8875,y:.35,w:.03125,h:.041666666666666664},{x:.8875,y:.35,w:.05,h:.06666666666666667},{x:.8875,y:.35,w:.075,h:.1},{x:.9125,y:.35,w:.03125,h:.041666666666666664},{x:.9125,y:.35,w:.05,h:.06666666666666667},{x:.9125,y:.35,w:.075,h:.1},{x:.9375,y:.35,w:.03125,h:.041666666666666664},{x:.9375,y:.35,w:.05,h:.06666666666666667},{x:.9375,y:.35,w:.075,h:.1},{x:.9625,y:.35,w:.03125,h:.041666666666666664},{x:.9625,y:.35,w:.05,h:.06666666666666667},{x:.9625,y:.35,w:.075,h:.1},{x:.9875,y:.35,w:.03125,h:.041666666666666664},{x:.9875,y:.35,w:.05,h:.06666666666666667},{x:.9875,y:.35,w:.075,h:.1},{x:.0125,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.0125,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.0125,y:.38333333333333336,w:.075,h:.1},{x:.0375,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.0375,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.0375,y:.38333333333333336,w:.075,h:.1},{x:.0625,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.0625,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.0625,y:.38333333333333336,w:.075,h:.1},{x:.0875,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.0875,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.0875,y:.38333333333333336,w:.075,h:.1},{x:.1125,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.1125,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.1125,y:.38333333333333336,w:.075,h:.1},{x:.1375,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.1375,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.1375,y:.38333333333333336,w:.075,h:.1},{x:.1625,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.1625,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.1625,y:.38333333333333336,w:.075,h:.1},{x:.1875,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.1875,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.1875,y:.38333333333333336,w:.075,h:.1},{x:.2125,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.2125,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.2125,y:.38333333333333336,w:.075,h:.1},{x:.2375,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.2375,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.2375,y:.38333333333333336,w:.075,h:.1},{x:.2625,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.2625,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.2625,y:.38333333333333336,w:.075,h:.1},{x:.2875,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.2875,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.2875,y:.38333333333333336,w:.075,h:.1},{x:.3125,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.3125,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.3125,y:.38333333333333336,w:.075,h:.1},{x:.3375,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.3375,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.3375,y:.38333333333333336,w:.075,h:.1},{x:.3625,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.3625,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.3625,y:.38333333333333336,w:.075,h:.1},{x:.3875,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.3875,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.3875,y:.38333333333333336,w:.075,h:.1},{x:.4125,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.4125,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.4125,y:.38333333333333336,w:.075,h:.1},{x:.4375,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.4375,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.4375,y:.38333333333333336,w:.075,h:.1},{x:.4625,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.4625,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.4625,y:.38333333333333336,w:.075,h:.1},{x:.4875,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.4875,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.4875,y:.38333333333333336,w:.075,h:.1},{x:.5125,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.5125,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.5125,y:.38333333333333336,w:.075,h:.1},{x:.5375,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.5375,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.5375,y:.38333333333333336,w:.075,h:.1},{x:.5625,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.5625,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.5625,y:.38333333333333336,w:.075,h:.1},{x:.5875,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.5875,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.5875,y:.38333333333333336,w:.075,h:.1},{x:.6125,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.6125,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.6125,y:.38333333333333336,w:.075,h:.1},{x:.6375,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.6375,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.6375,y:.38333333333333336,w:.075,h:.1},{x:.6625,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.6625,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.6625,y:.38333333333333336,w:.075,h:.1},{x:.6875,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.6875,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.6875,y:.38333333333333336,w:.075,h:.1},{x:.7125,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.7125,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.7125,y:.38333333333333336,w:.075,h:.1},{x:.7375,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.7375,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.7375,y:.38333333333333336,w:.075,h:.1},{x:.7625,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.7625,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.7625,y:.38333333333333336,w:.075,h:.1},{x:.7875,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.7875,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.7875,y:.38333333333333336,w:.075,h:.1},{x:.8125,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.8125,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.8125,y:.38333333333333336,w:.075,h:.1},{x:.8375,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.8375,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.8375,y:.38333333333333336,w:.075,h:.1},{x:.8625,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.8625,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.8625,y:.38333333333333336,w:.075,h:.1},{x:.8875,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.8875,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.8875,y:.38333333333333336,w:.075,h:.1},{x:.9125,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.9125,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.9125,y:.38333333333333336,w:.075,h:.1},{x:.9375,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.9375,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.9375,y:.38333333333333336,w:.075,h:.1},{x:.9625,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.9625,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.9625,y:.38333333333333336,w:.075,h:.1},{x:.9875,y:.38333333333333336,w:.03125,h:.041666666666666664},{x:.9875,y:.38333333333333336,w:.05,h:.06666666666666667},{x:.9875,y:.38333333333333336,w:.075,h:.1},{x:.0125,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.0125,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.0125,y:.4166666666666667,w:.075,h:.1},{x:.0375,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.0375,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.0375,y:.4166666666666667,w:.075,h:.1},{x:.0625,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.0625,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.0625,y:.4166666666666667,w:.075,h:.1},{x:.0875,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.0875,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.0875,y:.4166666666666667,w:.075,h:.1},{x:.1125,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.1125,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.1125,y:.4166666666666667,w:.075,h:.1},{x:.1375,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.1375,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.1375,y:.4166666666666667,w:.075,h:.1},{x:.1625,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.1625,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.1625,y:.4166666666666667,w:.075,h:.1},{x:.1875,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.1875,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.1875,y:.4166666666666667,w:.075,h:.1},{x:.2125,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.2125,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.2125,y:.4166666666666667,w:.075,h:.1},{x:.2375,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.2375,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.2375,y:.4166666666666667,w:.075,h:.1},{x:.2625,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.2625,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.2625,y:.4166666666666667,w:.075,h:.1},{x:.2875,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.2875,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.2875,y:.4166666666666667,w:.075,h:.1},{x:.3125,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.3125,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.3125,y:.4166666666666667,w:.075,h:.1},{x:.3375,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.3375,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.3375,y:.4166666666666667,w:.075,h:.1},{x:.3625,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.3625,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.3625,y:.4166666666666667,w:.075,h:.1},{x:.3875,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.3875,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.3875,y:.4166666666666667,w:.075,h:.1},{x:.4125,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.4125,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.4125,y:.4166666666666667,w:.075,h:.1},{x:.4375,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.4375,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.4375,y:.4166666666666667,w:.075,h:.1},{x:.4625,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.4625,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.4625,y:.4166666666666667,w:.075,h:.1},{x:.4875,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.4875,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.4875,y:.4166666666666667,w:.075,h:.1},{x:.5125,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.5125,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.5125,y:.4166666666666667,w:.075,h:.1},{x:.5375,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.5375,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.5375,y:.4166666666666667,w:.075,h:.1},{x:.5625,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.5625,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.5625,y:.4166666666666667,w:.075,h:.1},{x:.5875,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.5875,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.5875,y:.4166666666666667,w:.075,h:.1},{x:.6125,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.6125,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.6125,y:.4166666666666667,w:.075,h:.1},{x:.6375,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.6375,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.6375,y:.4166666666666667,w:.075,h:.1},{x:.6625,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.6625,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.6625,y:.4166666666666667,w:.075,h:.1},{x:.6875,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.6875,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.6875,y:.4166666666666667,w:.075,h:.1},{x:.7125,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.7125,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.7125,y:.4166666666666667,w:.075,h:.1},{x:.7375,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.7375,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.7375,y:.4166666666666667,w:.075,h:.1},{x:.7625,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.7625,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.7625,y:.4166666666666667,w:.075,h:.1},{x:.7875,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.7875,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.7875,y:.4166666666666667,w:.075,h:.1},{x:.8125,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.8125,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.8125,y:.4166666666666667,w:.075,h:.1},{x:.8375,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.8375,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.8375,y:.4166666666666667,w:.075,h:.1},{x:.8625,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.8625,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.8625,y:.4166666666666667,w:.075,h:.1},{x:.8875,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.8875,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.8875,y:.4166666666666667,w:.075,h:.1},{x:.9125,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.9125,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.9125,y:.4166666666666667,w:.075,h:.1},{x:.9375,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.9375,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.9375,y:.4166666666666667,w:.075,h:.1},{x:.9625,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.9625,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.9625,y:.4166666666666667,w:.075,h:.1},{x:.9875,y:.4166666666666667,w:.03125,h:.041666666666666664},{x:.9875,y:.4166666666666667,w:.05,h:.06666666666666667},{x:.9875,y:.4166666666666667,w:.075,h:.1},{x:.0125,y:.45,w:.03125,h:.041666666666666664},{x:.0125,y:.45,w:.05,h:.06666666666666667},{x:.0125,y:.45,w:.075,h:.1},{x:.0375,y:.45,w:.03125,h:.041666666666666664},{x:.0375,y:.45,w:.05,h:.06666666666666667},{x:.0375,y:.45,w:.075,h:.1},{x:.0625,y:.45,w:.03125,h:.041666666666666664},{x:.0625,y:.45,w:.05,h:.06666666666666667},{x:.0625,y:.45,w:.075,h:.1},{x:.0875,y:.45,w:.03125,h:.041666666666666664},{x:.0875,y:.45,w:.05,h:.06666666666666667},{x:.0875,y:.45,w:.075,h:.1},{x:.1125,y:.45,w:.03125,h:.041666666666666664},{x:.1125,y:.45,w:.05,h:.06666666666666667},{x:.1125,y:.45,w:.075,h:.1},{x:.1375,y:.45,w:.03125,h:.041666666666666664},{x:.1375,y:.45,w:.05,h:.06666666666666667},{x:.1375,y:.45,w:.075,h:.1},{x:.1625,y:.45,w:.03125,h:.041666666666666664},{x:.1625,y:.45,w:.05,h:.06666666666666667},{x:.1625,y:.45,w:.075,h:.1},{x:.1875,y:.45,w:.03125,h:.041666666666666664},{x:.1875,y:.45,w:.05,h:.06666666666666667},{x:.1875,y:.45,w:.075,h:.1},{x:.2125,y:.45,w:.03125,h:.041666666666666664},{x:.2125,y:.45,w:.05,h:.06666666666666667},{x:.2125,y:.45,w:.075,h:.1},{x:.2375,y:.45,w:.03125,h:.041666666666666664},{x:.2375,y:.45,w:.05,h:.06666666666666667},{x:.2375,y:.45,w:.075,h:.1},{x:.2625,y:.45,w:.03125,h:.041666666666666664},{x:.2625,y:.45,w:.05,h:.06666666666666667},{x:.2625,y:.45,w:.075,h:.1},{x:.2875,y:.45,w:.03125,h:.041666666666666664},{x:.2875,y:.45,w:.05,h:.06666666666666667},{x:.2875,y:.45,w:.075,h:.1},{x:.3125,y:.45,w:.03125,h:.041666666666666664},{x:.3125,y:.45,w:.05,h:.06666666666666667},{x:.3125,y:.45,w:.075,h:.1},{x:.3375,y:.45,w:.03125,h:.041666666666666664},{x:.3375,y:.45,w:.05,h:.06666666666666667},{x:.3375,y:.45,w:.075,h:.1},{x:.3625,y:.45,w:.03125,h:.041666666666666664},{x:.3625,y:.45,w:.05,h:.06666666666666667},{x:.3625,y:.45,w:.075,h:.1},{x:.3875,y:.45,w:.03125,h:.041666666666666664},{x:.3875,y:.45,w:.05,h:.06666666666666667},{x:.3875,y:.45,w:.075,h:.1},{x:.4125,y:.45,w:.03125,h:.041666666666666664},{x:.4125,y:.45,w:.05,h:.06666666666666667},{x:.4125,y:.45,w:.075,h:.1},{x:.4375,y:.45,w:.03125,h:.041666666666666664},{x:.4375,y:.45,w:.05,h:.06666666666666667},{x:.4375,y:.45,w:.075,h:.1},{x:.4625,y:.45,w:.03125,h:.041666666666666664},{x:.4625,y:.45,w:.05,h:.06666666666666667},{x:.4625,y:.45,w:.075,h:.1},{x:.4875,y:.45,w:.03125,h:.041666666666666664},{x:.4875,y:.45,w:.05,h:.06666666666666667},{x:.4875,y:.45,w:.075,h:.1},{x:.5125,y:.45,w:.03125,h:.041666666666666664},{x:.5125,y:.45,w:.05,h:.06666666666666667},{x:.5125,y:.45,w:.075,h:.1},{x:.5375,y:.45,w:.03125,h:.041666666666666664},{x:.5375,y:.45,w:.05,h:.06666666666666667},{x:.5375,y:.45,w:.075,h:.1},{x:.5625,y:.45,w:.03125,h:.041666666666666664},{x:.5625,y:.45,w:.05,h:.06666666666666667},{x:.5625,y:.45,w:.075,h:.1},{x:.5875,y:.45,w:.03125,h:.041666666666666664},{x:.5875,y:.45,w:.05,h:.06666666666666667},{x:.5875,y:.45,w:.075,h:.1},{x:.6125,y:.45,w:.03125,h:.041666666666666664},{x:.6125,y:.45,w:.05,h:.06666666666666667},{x:.6125,y:.45,w:.075,h:.1},{x:.6375,y:.45,w:.03125,h:.041666666666666664},{x:.6375,y:.45,w:.05,h:.06666666666666667},{x:.6375,y:.45,w:.075,h:.1},{x:.6625,y:.45,w:.03125,h:.041666666666666664},{x:.6625,y:.45,w:.05,h:.06666666666666667},{x:.6625,y:.45,w:.075,h:.1},{x:.6875,y:.45,w:.03125,h:.041666666666666664},{x:.6875,y:.45,w:.05,h:.06666666666666667},{x:.6875,y:.45,w:.075,h:.1},{x:.7125,y:.45,w:.03125,h:.041666666666666664},{x:.7125,y:.45,w:.05,h:.06666666666666667},{x:.7125,y:.45,w:.075,h:.1},{x:.7375,y:.45,w:.03125,h:.041666666666666664},{x:.7375,y:.45,w:.05,h:.06666666666666667},{x:.7375,y:.45,w:.075,h:.1},{x:.7625,y:.45,w:.03125,h:.041666666666666664},{x:.7625,y:.45,w:.05,h:.06666666666666667},{x:.7625,y:.45,w:.075,h:.1},{x:.7875,y:.45,w:.03125,h:.041666666666666664},{x:.7875,y:.45,w:.05,h:.06666666666666667},{x:.7875,y:.45,w:.075,h:.1},{x:.8125,y:.45,w:.03125,h:.041666666666666664},{x:.8125,y:.45,w:.05,h:.06666666666666667},{x:.8125,y:.45,w:.075,h:.1},{x:.8375,y:.45,w:.03125,h:.041666666666666664},{x:.8375,y:.45,w:.05,h:.06666666666666667},{x:.8375,y:.45,w:.075,h:.1},{x:.8625,y:.45,w:.03125,h:.041666666666666664},{x:.8625,y:.45,w:.05,h:.06666666666666667},{x:.8625,y:.45,w:.075,h:.1},{x:.8875,y:.45,w:.03125,h:.041666666666666664},{x:.8875,y:.45,w:.05,h:.06666666666666667},{x:.8875,y:.45,w:.075,h:.1},{x:.9125,y:.45,w:.03125,h:.041666666666666664},{x:.9125,y:.45,w:.05,h:.06666666666666667},{x:.9125,y:.45,w:.075,h:.1},{x:.9375,y:.45,w:.03125,h:.041666666666666664},{x:.9375,y:.45,w:.05,h:.06666666666666667},{x:.9375,y:.45,w:.075,h:.1},{x:.9625,y:.45,w:.03125,h:.041666666666666664},{x:.9625,y:.45,w:.05,h:.06666666666666667},{x:.9625,y:.45,w:.075,h:.1},{x:.9875,y:.45,w:.03125,h:.041666666666666664},{x:.9875,y:.45,w:.05,h:.06666666666666667},{x:.9875,y:.45,w:.075,h:.1},{x:.0125,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.0125,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.0125,y:.48333333333333334,w:.075,h:.1},{x:.0375,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.0375,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.0375,y:.48333333333333334,w:.075,h:.1},{x:.0625,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.0625,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.0625,y:.48333333333333334,w:.075,h:.1},{x:.0875,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.0875,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.0875,y:.48333333333333334,w:.075,h:.1},{x:.1125,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.1125,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.1125,y:.48333333333333334,w:.075,h:.1},{x:.1375,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.1375,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.1375,y:.48333333333333334,w:.075,h:.1},{x:.1625,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.1625,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.1625,y:.48333333333333334,w:.075,h:.1},{x:.1875,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.1875,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.1875,y:.48333333333333334,w:.075,h:.1},{x:.2125,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.2125,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.2125,y:.48333333333333334,w:.075,h:.1},{x:.2375,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.2375,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.2375,y:.48333333333333334,w:.075,h:.1},{x:.2625,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.2625,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.2625,y:.48333333333333334,w:.075,h:.1},{x:.2875,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.2875,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.2875,y:.48333333333333334,w:.075,h:.1},{x:.3125,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.3125,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.3125,y:.48333333333333334,w:.075,h:.1},{x:.3375,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.3375,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.3375,y:.48333333333333334,w:.075,h:.1},{x:.3625,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.3625,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.3625,y:.48333333333333334,w:.075,h:.1},{x:.3875,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.3875,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.3875,y:.48333333333333334,w:.075,h:.1},{x:.4125,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.4125,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.4125,y:.48333333333333334,w:.075,h:.1},{x:.4375,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.4375,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.4375,y:.48333333333333334,w:.075,h:.1},{x:.4625,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.4625,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.4625,y:.48333333333333334,w:.075,h:.1},{x:.4875,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.4875,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.4875,y:.48333333333333334,w:.075,h:.1},{x:.5125,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.5125,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.5125,y:.48333333333333334,w:.075,h:.1},{x:.5375,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.5375,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.5375,y:.48333333333333334,w:.075,h:.1},{x:.5625,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.5625,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.5625,y:.48333333333333334,w:.075,h:.1},{x:.5875,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.5875,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.5875,y:.48333333333333334,w:.075,h:.1},{x:.6125,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.6125,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.6125,y:.48333333333333334,w:.075,h:.1},{x:.6375,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.6375,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.6375,y:.48333333333333334,w:.075,h:.1},{x:.6625,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.6625,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.6625,y:.48333333333333334,w:.075,h:.1},{x:.6875,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.6875,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.6875,y:.48333333333333334,w:.075,h:.1},{x:.7125,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.7125,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.7125,y:.48333333333333334,w:.075,h:.1},{x:.7375,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.7375,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.7375,y:.48333333333333334,w:.075,h:.1},{x:.7625,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.7625,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.7625,y:.48333333333333334,w:.075,h:.1},{x:.7875,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.7875,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.7875,y:.48333333333333334,w:.075,h:.1},{x:.8125,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.8125,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.8125,y:.48333333333333334,w:.075,h:.1},{x:.8375,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.8375,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.8375,y:.48333333333333334,w:.075,h:.1},{x:.8625,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.8625,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.8625,y:.48333333333333334,w:.075,h:.1},{x:.8875,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.8875,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.8875,y:.48333333333333334,w:.075,h:.1},{x:.9125,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.9125,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.9125,y:.48333333333333334,w:.075,h:.1},{x:.9375,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.9375,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.9375,y:.48333333333333334,w:.075,h:.1},{x:.9625,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.9625,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.9625,y:.48333333333333334,w:.075,h:.1},{x:.9875,y:.48333333333333334,w:.03125,h:.041666666666666664},{x:.9875,y:.48333333333333334,w:.05,h:.06666666666666667},{x:.9875,y:.48333333333333334,w:.075,h:.1},{x:.0125,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.0125,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.0125,y:.5166666666666667,w:.075,h:.1},{x:.0375,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.0375,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.0375,y:.5166666666666667,w:.075,h:.1},{x:.0625,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.0625,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.0625,y:.5166666666666667,w:.075,h:.1},{x:.0875,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.0875,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.0875,y:.5166666666666667,w:.075,h:.1},{x:.1125,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.1125,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.1125,y:.5166666666666667,w:.075,h:.1},{x:.1375,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.1375,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.1375,y:.5166666666666667,w:.075,h:.1},{x:.1625,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.1625,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.1625,y:.5166666666666667,w:.075,h:.1},{x:.1875,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.1875,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.1875,y:.5166666666666667,w:.075,h:.1},{x:.2125,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.2125,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.2125,y:.5166666666666667,w:.075,h:.1},{x:.2375,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.2375,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.2375,y:.5166666666666667,w:.075,h:.1},{x:.2625,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.2625,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.2625,y:.5166666666666667,w:.075,h:.1},{x:.2875,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.2875,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.2875,y:.5166666666666667,w:.075,h:.1},{x:.3125,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.3125,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.3125,y:.5166666666666667,w:.075,h:.1},{x:.3375,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.3375,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.3375,y:.5166666666666667,w:.075,h:.1},{x:.3625,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.3625,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.3625,y:.5166666666666667,w:.075,h:.1},{x:.3875,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.3875,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.3875,y:.5166666666666667,w:.075,h:.1},{x:.4125,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.4125,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.4125,y:.5166666666666667,w:.075,h:.1},{x:.4375,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.4375,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.4375,y:.5166666666666667,w:.075,h:.1},{x:.4625,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.4625,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.4625,y:.5166666666666667,w:.075,h:.1},{x:.4875,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.4875,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.4875,y:.5166666666666667,w:.075,h:.1},{x:.5125,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.5125,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.5125,y:.5166666666666667,w:.075,h:.1},{x:.5375,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.5375,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.5375,y:.5166666666666667,w:.075,h:.1},{x:.5625,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.5625,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.5625,y:.5166666666666667,w:.075,h:.1},{x:.5875,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.5875,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.5875,y:.5166666666666667,w:.075,h:.1},{x:.6125,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.6125,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.6125,y:.5166666666666667,w:.075,h:.1},{x:.6375,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.6375,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.6375,y:.5166666666666667,w:.075,h:.1},{x:.6625,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.6625,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.6625,y:.5166666666666667,w:.075,h:.1},{x:.6875,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.6875,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.6875,y:.5166666666666667,w:.075,h:.1},{x:.7125,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.7125,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.7125,y:.5166666666666667,w:.075,h:.1},{x:.7375,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.7375,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.7375,y:.5166666666666667,w:.075,h:.1},{x:.7625,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.7625,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.7625,y:.5166666666666667,w:.075,h:.1},{x:.7875,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.7875,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.7875,y:.5166666666666667,w:.075,h:.1},{x:.8125,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.8125,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.8125,y:.5166666666666667,w:.075,h:.1},{x:.8375,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.8375,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.8375,y:.5166666666666667,w:.075,h:.1},{x:.8625,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.8625,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.8625,y:.5166666666666667,w:.075,h:.1},{x:.8875,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.8875,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.8875,y:.5166666666666667,w:.075,h:.1},{x:.9125,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.9125,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.9125,y:.5166666666666667,w:.075,h:.1},{x:.9375,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.9375,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.9375,y:.5166666666666667,w:.075,h:.1},{x:.9625,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.9625,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.9625,y:.5166666666666667,w:.075,h:.1},{x:.9875,y:.5166666666666667,w:.03125,h:.041666666666666664},{x:.9875,y:.5166666666666667,w:.05,h:.06666666666666667},{x:.9875,y:.5166666666666667,w:.075,h:.1},{x:.0125,y:.55,w:.03125,h:.041666666666666664},{x:.0125,y:.55,w:.05,h:.06666666666666667},{x:.0125,y:.55,w:.075,h:.1},{x:.0375,y:.55,w:.03125,h:.041666666666666664},{x:.0375,y:.55,w:.05,h:.06666666666666667},{x:.0375,y:.55,w:.075,h:.1},{x:.0625,y:.55,w:.03125,h:.041666666666666664},{x:.0625,y:.55,w:.05,h:.06666666666666667},{x:.0625,y:.55,w:.075,h:.1},{x:.0875,y:.55,w:.03125,h:.041666666666666664},{x:.0875,y:.55,w:.05,h:.06666666666666667},{x:.0875,y:.55,w:.075,h:.1},{x:.1125,y:.55,w:.03125,h:.041666666666666664},{x:.1125,y:.55,w:.05,h:.06666666666666667},{x:.1125,y:.55,w:.075,h:.1},{x:.1375,y:.55,w:.03125,h:.041666666666666664},{x:.1375,y:.55,w:.05,h:.06666666666666667},{x:.1375,y:.55,w:.075,h:.1},{x:.1625,y:.55,w:.03125,h:.041666666666666664},{x:.1625,y:.55,w:.05,h:.06666666666666667},{x:.1625,y:.55,w:.075,h:.1},{x:.1875,y:.55,w:.03125,h:.041666666666666664},{x:.1875,y:.55,w:.05,h:.06666666666666667},{x:.1875,y:.55,w:.075,h:.1},{x:.2125,y:.55,w:.03125,h:.041666666666666664},{x:.2125,y:.55,w:.05,h:.06666666666666667},{x:.2125,y:.55,w:.075,h:.1},{x:.2375,y:.55,w:.03125,h:.041666666666666664},{x:.2375,y:.55,w:.05,h:.06666666666666667},{x:.2375,y:.55,w:.075,h:.1},{x:.2625,y:.55,w:.03125,h:.041666666666666664},{x:.2625,y:.55,w:.05,h:.06666666666666667},{x:.2625,y:.55,w:.075,h:.1},{x:.2875,y:.55,w:.03125,h:.041666666666666664},{x:.2875,y:.55,w:.05,h:.06666666666666667},{x:.2875,y:.55,w:.075,h:.1},{x:.3125,y:.55,w:.03125,h:.041666666666666664},{x:.3125,y:.55,w:.05,h:.06666666666666667},{x:.3125,y:.55,w:.075,h:.1},{x:.3375,y:.55,w:.03125,h:.041666666666666664},{x:.3375,y:.55,w:.05,h:.06666666666666667},{x:.3375,y:.55,w:.075,h:.1},{x:.3625,y:.55,w:.03125,h:.041666666666666664},{x:.3625,y:.55,w:.05,h:.06666666666666667},{x:.3625,y:.55,w:.075,h:.1},{x:.3875,y:.55,w:.03125,h:.041666666666666664},{x:.3875,y:.55,w:.05,h:.06666666666666667},{x:.3875,y:.55,w:.075,h:.1},{x:.4125,y:.55,w:.03125,h:.041666666666666664},{x:.4125,y:.55,w:.05,h:.06666666666666667},{x:.4125,y:.55,w:.075,h:.1},{x:.4375,y:.55,w:.03125,h:.041666666666666664},{x:.4375,y:.55,w:.05,h:.06666666666666667},{x:.4375,y:.55,w:.075,h:.1},{x:.4625,y:.55,w:.03125,h:.041666666666666664},{x:.4625,y:.55,w:.05,h:.06666666666666667},{x:.4625,y:.55,w:.075,h:.1},{x:.4875,y:.55,w:.03125,h:.041666666666666664},{x:.4875,y:.55,w:.05,h:.06666666666666667},{x:.4875,y:.55,w:.075,h:.1},{x:.5125,y:.55,w:.03125,h:.041666666666666664},{x:.5125,y:.55,w:.05,h:.06666666666666667},{x:.5125,y:.55,w:.075,h:.1},{x:.5375,y:.55,w:.03125,h:.041666666666666664},{x:.5375,y:.55,w:.05,h:.06666666666666667},{x:.5375,y:.55,w:.075,h:.1},{x:.5625,y:.55,w:.03125,h:.041666666666666664},{x:.5625,y:.55,w:.05,h:.06666666666666667},{x:.5625,y:.55,w:.075,h:.1},{x:.5875,y:.55,w:.03125,h:.041666666666666664},{x:.5875,y:.55,w:.05,h:.06666666666666667},{x:.5875,y:.55,w:.075,h:.1},{x:.6125,y:.55,w:.03125,h:.041666666666666664},{x:.6125,y:.55,w:.05,h:.06666666666666667},{x:.6125,y:.55,w:.075,h:.1},{x:.6375,y:.55,w:.03125,h:.041666666666666664},{x:.6375,y:.55,w:.05,h:.06666666666666667},{x:.6375,y:.55,w:.075,h:.1},{x:.6625,y:.55,w:.03125,h:.041666666666666664},{x:.6625,y:.55,w:.05,h:.06666666666666667},{x:.6625,y:.55,w:.075,h:.1},{x:.6875,y:.55,w:.03125,h:.041666666666666664},{x:.6875,y:.55,w:.05,h:.06666666666666667},{x:.6875,y:.55,w:.075,h:.1},{x:.7125,y:.55,w:.03125,h:.041666666666666664},{x:.7125,y:.55,w:.05,h:.06666666666666667},{x:.7125,y:.55,w:.075,h:.1},{x:.7375,y:.55,w:.03125,h:.041666666666666664},{x:.7375,y:.55,w:.05,h:.06666666666666667},{x:.7375,y:.55,w:.075,h:.1},{x:.7625,y:.55,w:.03125,h:.041666666666666664},{x:.7625,y:.55,w:.05,h:.06666666666666667},{x:.7625,y:.55,w:.075,h:.1},{x:.7875,y:.55,w:.03125,h:.041666666666666664},{x:.7875,y:.55,w:.05,h:.06666666666666667},{x:.7875,y:.55,w:.075,h:.1},{x:.8125,y:.55,w:.03125,h:.041666666666666664},{x:.8125,y:.55,w:.05,h:.06666666666666667},{x:.8125,y:.55,w:.075,h:.1},{x:.8375,y:.55,w:.03125,h:.041666666666666664},{x:.8375,y:.55,w:.05,h:.06666666666666667},{x:.8375,y:.55,w:.075,h:.1},{x:.8625,y:.55,w:.03125,h:.041666666666666664},{x:.8625,y:.55,w:.05,h:.06666666666666667},{x:.8625,y:.55,w:.075,h:.1},{x:.8875,y:.55,w:.03125,h:.041666666666666664},{x:.8875,y:.55,w:.05,h:.06666666666666667},{x:.8875,y:.55,w:.075,h:.1},{x:.9125,y:.55,w:.03125,h:.041666666666666664},{x:.9125,y:.55,w:.05,h:.06666666666666667},{x:.9125,y:.55,w:.075,h:.1},{x:.9375,y:.55,w:.03125,h:.041666666666666664},{x:.9375,y:.55,w:.05,h:.06666666666666667},{x:.9375,y:.55,w:.075,h:.1},{x:.9625,y:.55,w:.03125,h:.041666666666666664},{x:.9625,y:.55,w:.05,h:.06666666666666667},{x:.9625,y:.55,w:.075,h:.1},{x:.9875,y:.55,w:.03125,h:.041666666666666664},{x:.9875,y:.55,w:.05,h:.06666666666666667},{x:.9875,y:.55,w:.075,h:.1},{x:.0125,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.0125,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.0125,y:.5833333333333334,w:.075,h:.1},{x:.0375,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.0375,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.0375,y:.5833333333333334,w:.075,h:.1},{x:.0625,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.0625,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.0625,y:.5833333333333334,w:.075,h:.1},{x:.0875,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.0875,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.0875,y:.5833333333333334,w:.075,h:.1},{x:.1125,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.1125,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.1125,y:.5833333333333334,w:.075,h:.1},{x:.1375,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.1375,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.1375,y:.5833333333333334,w:.075,h:.1},{x:.1625,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.1625,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.1625,y:.5833333333333334,w:.075,h:.1},{x:.1875,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.1875,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.1875,y:.5833333333333334,w:.075,h:.1},{x:.2125,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.2125,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.2125,y:.5833333333333334,w:.075,h:.1},{x:.2375,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.2375,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.2375,y:.5833333333333334,w:.075,h:.1},{x:.2625,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.2625,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.2625,y:.5833333333333334,w:.075,h:.1},{x:.2875,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.2875,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.2875,y:.5833333333333334,w:.075,h:.1},{x:.3125,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.3125,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.3125,y:.5833333333333334,w:.075,h:.1},{x:.3375,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.3375,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.3375,y:.5833333333333334,w:.075,h:.1},{x:.3625,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.3625,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.3625,y:.5833333333333334,w:.075,h:.1},{x:.3875,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.3875,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.3875,y:.5833333333333334,w:.075,h:.1},{x:.4125,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.4125,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.4125,y:.5833333333333334,w:.075,h:.1},{x:.4375,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.4375,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.4375,y:.5833333333333334,w:.075,h:.1},{x:.4625,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.4625,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.4625,y:.5833333333333334,w:.075,h:.1},{x:.4875,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.4875,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.4875,y:.5833333333333334,w:.075,h:.1},{x:.5125,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.5125,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.5125,y:.5833333333333334,w:.075,h:.1},{x:.5375,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.5375,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.5375,y:.5833333333333334,w:.075,h:.1},{x:.5625,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.5625,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.5625,y:.5833333333333334,w:.075,h:.1},{x:.5875,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.5875,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.5875,y:.5833333333333334,w:.075,h:.1},{x:.6125,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.6125,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.6125,y:.5833333333333334,w:.075,h:.1},{x:.6375,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.6375,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.6375,y:.5833333333333334,w:.075,h:.1},{x:.6625,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.6625,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.6625,y:.5833333333333334,w:.075,h:.1},{x:.6875,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.6875,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.6875,y:.5833333333333334,w:.075,h:.1},{x:.7125,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.7125,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.7125,y:.5833333333333334,w:.075,h:.1},{x:.7375,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.7375,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.7375,y:.5833333333333334,w:.075,h:.1},{x:.7625,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.7625,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.7625,y:.5833333333333334,w:.075,h:.1},{x:.7875,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.7875,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.7875,y:.5833333333333334,w:.075,h:.1},{x:.8125,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.8125,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.8125,y:.5833333333333334,w:.075,h:.1},{x:.8375,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.8375,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.8375,y:.5833333333333334,w:.075,h:.1},{x:.8625,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.8625,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.8625,y:.5833333333333334,w:.075,h:.1},{x:.8875,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.8875,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.8875,y:.5833333333333334,w:.075,h:.1},{x:.9125,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.9125,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.9125,y:.5833333333333334,w:.075,h:.1},{x:.9375,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.9375,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.9375,y:.5833333333333334,w:.075,h:.1},{x:.9625,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.9625,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.9625,y:.5833333333333334,w:.075,h:.1},{x:.9875,y:.5833333333333334,w:.03125,h:.041666666666666664},{x:.9875,y:.5833333333333334,w:.05,h:.06666666666666667},{x:.9875,y:.5833333333333334,w:.075,h:.1},{x:.0125,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.0125,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.0125,y:.6166666666666667,w:.075,h:.1},{x:.0375,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.0375,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.0375,y:.6166666666666667,w:.075,h:.1},{x:.0625,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.0625,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.0625,y:.6166666666666667,w:.075,h:.1},{x:.0875,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.0875,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.0875,y:.6166666666666667,w:.075,h:.1},{x:.1125,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.1125,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.1125,y:.6166666666666667,w:.075,h:.1},{x:.1375,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.1375,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.1375,y:.6166666666666667,w:.075,h:.1},{x:.1625,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.1625,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.1625,y:.6166666666666667,w:.075,h:.1},{x:.1875,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.1875,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.1875,y:.6166666666666667,w:.075,h:.1},{x:.2125,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.2125,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.2125,y:.6166666666666667,w:.075,h:.1},{x:.2375,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.2375,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.2375,y:.6166666666666667,w:.075,h:.1},{x:.2625,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.2625,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.2625,y:.6166666666666667,w:.075,h:.1},{x:.2875,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.2875,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.2875,y:.6166666666666667,w:.075,h:.1},{x:.3125,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.3125,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.3125,y:.6166666666666667,w:.075,h:.1},{x:.3375,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.3375,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.3375,y:.6166666666666667,w:.075,h:.1},{x:.3625,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.3625,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.3625,y:.6166666666666667,w:.075,h:.1},{x:.3875,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.3875,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.3875,y:.6166666666666667,w:.075,h:.1},{x:.4125,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.4125,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.4125,y:.6166666666666667,w:.075,h:.1},{x:.4375,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.4375,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.4375,y:.6166666666666667,w:.075,h:.1},{x:.4625,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.4625,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.4625,y:.6166666666666667,w:.075,h:.1},{x:.4875,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.4875,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.4875,y:.6166666666666667,w:.075,h:.1},{x:.5125,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.5125,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.5125,y:.6166666666666667,w:.075,h:.1},{x:.5375,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.5375,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.5375,y:.6166666666666667,w:.075,h:.1},{x:.5625,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.5625,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.5625,y:.6166666666666667,w:.075,h:.1},{x:.5875,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.5875,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.5875,y:.6166666666666667,w:.075,h:.1},{x:.6125,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.6125,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.6125,y:.6166666666666667,w:.075,h:.1},{x:.6375,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.6375,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.6375,y:.6166666666666667,w:.075,h:.1},{x:.6625,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.6625,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.6625,y:.6166666666666667,w:.075,h:.1},{x:.6875,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.6875,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.6875,y:.6166666666666667,w:.075,h:.1},{x:.7125,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.7125,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.7125,y:.6166666666666667,w:.075,h:.1},{x:.7375,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.7375,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.7375,y:.6166666666666667,w:.075,h:.1},{x:.7625,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.7625,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.7625,y:.6166666666666667,w:.075,h:.1},{x:.7875,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.7875,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.7875,y:.6166666666666667,w:.075,h:.1},{x:.8125,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.8125,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.8125,y:.6166666666666667,w:.075,h:.1},{x:.8375,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.8375,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.8375,y:.6166666666666667,w:.075,h:.1},{x:.8625,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.8625,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.8625,y:.6166666666666667,w:.075,h:.1},{x:.8875,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.8875,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.8875,y:.6166666666666667,w:.075,h:.1},{x:.9125,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.9125,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.9125,y:.6166666666666667,w:.075,h:.1},{x:.9375,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.9375,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.9375,y:.6166666666666667,w:.075,h:.1},{x:.9625,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.9625,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.9625,y:.6166666666666667,w:.075,h:.1},{x:.9875,y:.6166666666666667,w:.03125,h:.041666666666666664},{x:.9875,y:.6166666666666667,w:.05,h:.06666666666666667},{x:.9875,y:.6166666666666667,w:.075,h:.1},{x:.0125,y:.65,w:.03125,h:.041666666666666664},{x:.0125,y:.65,w:.05,h:.06666666666666667},{x:.0125,y:.65,w:.075,h:.1},{x:.0375,y:.65,w:.03125,h:.041666666666666664},{x:.0375,y:.65,w:.05,h:.06666666666666667},{x:.0375,y:.65,w:.075,h:.1},{x:.0625,y:.65,w:.03125,h:.041666666666666664},{x:.0625,y:.65,w:.05,h:.06666666666666667},{x:.0625,y:.65,w:.075,h:.1},{x:.0875,y:.65,w:.03125,h:.041666666666666664},{x:.0875,y:.65,w:.05,h:.06666666666666667},{x:.0875,y:.65,w:.075,h:.1},{x:.1125,y:.65,w:.03125,h:.041666666666666664},{x:.1125,y:.65,w:.05,h:.06666666666666667},{x:.1125,y:.65,w:.075,h:.1},{x:.1375,y:.65,w:.03125,h:.041666666666666664},{x:.1375,y:.65,w:.05,h:.06666666666666667},{x:.1375,y:.65,w:.075,h:.1},{x:.1625,y:.65,w:.03125,h:.041666666666666664},{x:.1625,y:.65,w:.05,h:.06666666666666667},{x:.1625,y:.65,w:.075,h:.1},{x:.1875,y:.65,w:.03125,h:.041666666666666664},{x:.1875,y:.65,w:.05,h:.06666666666666667},{x:.1875,y:.65,w:.075,h:.1},{x:.2125,y:.65,w:.03125,h:.041666666666666664},{x:.2125,y:.65,w:.05,h:.06666666666666667},{x:.2125,y:.65,w:.075,h:.1},{x:.2375,y:.65,w:.03125,h:.041666666666666664},{x:.2375,y:.65,w:.05,h:.06666666666666667},{x:.2375,y:.65,w:.075,h:.1},{x:.2625,y:.65,w:.03125,h:.041666666666666664},{x:.2625,y:.65,w:.05,h:.06666666666666667},{x:.2625,y:.65,w:.075,h:.1},{x:.2875,y:.65,w:.03125,h:.041666666666666664},{x:.2875,y:.65,w:.05,h:.06666666666666667},{x:.2875,y:.65,w:.075,h:.1},{x:.3125,y:.65,w:.03125,h:.041666666666666664},{x:.3125,y:.65,w:.05,h:.06666666666666667},{x:.3125,y:.65,w:.075,h:.1},{x:.3375,y:.65,w:.03125,h:.041666666666666664},{x:.3375,y:.65,w:.05,h:.06666666666666667},{x:.3375,y:.65,w:.075,h:.1},{x:.3625,y:.65,w:.03125,h:.041666666666666664},{x:.3625,y:.65,w:.05,h:.06666666666666667},{x:.3625,y:.65,w:.075,h:.1},{x:.3875,y:.65,w:.03125,h:.041666666666666664},{x:.3875,y:.65,w:.05,h:.06666666666666667},{x:.3875,y:.65,w:.075,h:.1},{x:.4125,y:.65,w:.03125,h:.041666666666666664},{x:.4125,y:.65,w:.05,h:.06666666666666667},{x:.4125,y:.65,w:.075,h:.1},{x:.4375,y:.65,w:.03125,h:.041666666666666664},{x:.4375,y:.65,w:.05,h:.06666666666666667},{x:.4375,y:.65,w:.075,h:.1},{x:.4625,y:.65,w:.03125,h:.041666666666666664},{x:.4625,y:.65,w:.05,h:.06666666666666667},{x:.4625,y:.65,w:.075,h:.1},{x:.4875,y:.65,w:.03125,h:.041666666666666664},{x:.4875,y:.65,w:.05,h:.06666666666666667},{x:.4875,y:.65,w:.075,h:.1},{x:.5125,y:.65,w:.03125,h:.041666666666666664},{x:.5125,y:.65,w:.05,h:.06666666666666667},{x:.5125,y:.65,w:.075,h:.1},{x:.5375,y:.65,w:.03125,h:.041666666666666664},{x:.5375,y:.65,w:.05,h:.06666666666666667},{x:.5375,y:.65,w:.075,h:.1},{x:.5625,y:.65,w:.03125,h:.041666666666666664},{x:.5625,y:.65,w:.05,h:.06666666666666667},{x:.5625,y:.65,w:.075,h:.1},{x:.5875,y:.65,w:.03125,h:.041666666666666664},{x:.5875,y:.65,w:.05,h:.06666666666666667},{x:.5875,y:.65,w:.075,h:.1},{x:.6125,y:.65,w:.03125,h:.041666666666666664},{x:.6125,y:.65,w:.05,h:.06666666666666667},{x:.6125,y:.65,w:.075,h:.1},{x:.6375,y:.65,w:.03125,h:.041666666666666664},{x:.6375,y:.65,w:.05,h:.06666666666666667},{x:.6375,y:.65,w:.075,h:.1},{x:.6625,y:.65,w:.03125,h:.041666666666666664},{x:.6625,y:.65,w:.05,h:.06666666666666667},{x:.6625,y:.65,w:.075,h:.1},{x:.6875,y:.65,w:.03125,h:.041666666666666664},{x:.6875,y:.65,w:.05,h:.06666666666666667},{x:.6875,y:.65,w:.075,h:.1},{x:.7125,y:.65,w:.03125,h:.041666666666666664},{x:.7125,y:.65,w:.05,h:.06666666666666667},{x:.7125,y:.65,w:.075,h:.1},{x:.7375,y:.65,w:.03125,h:.041666666666666664},{x:.7375,y:.65,w:.05,h:.06666666666666667},{x:.7375,y:.65,w:.075,h:.1},{x:.7625,y:.65,w:.03125,h:.041666666666666664},{x:.7625,y:.65,w:.05,h:.06666666666666667},{x:.7625,y:.65,w:.075,h:.1},{x:.7875,y:.65,w:.03125,h:.041666666666666664},{x:.7875,y:.65,w:.05,h:.06666666666666667},{x:.7875,y:.65,w:.075,h:.1},{x:.8125,y:.65,w:.03125,h:.041666666666666664},{x:.8125,y:.65,w:.05,h:.06666666666666667},{x:.8125,y:.65,w:.075,h:.1},{x:.8375,y:.65,w:.03125,h:.041666666666666664},{x:.8375,y:.65,w:.05,h:.06666666666666667},{x:.8375,y:.65,w:.075,h:.1},{x:.8625,y:.65,w:.03125,h:.041666666666666664},{x:.8625,y:.65,w:.05,h:.06666666666666667},{x:.8625,y:.65,w:.075,h:.1},{x:.8875,y:.65,w:.03125,h:.041666666666666664},{x:.8875,y:.65,w:.05,h:.06666666666666667},{x:.8875,y:.65,w:.075,h:.1},{x:.9125,y:.65,w:.03125,h:.041666666666666664},{x:.9125,y:.65,w:.05,h:.06666666666666667},{x:.9125,y:.65,w:.075,h:.1},{x:.9375,y:.65,w:.03125,h:.041666666666666664},{x:.9375,y:.65,w:.05,h:.06666666666666667},{x:.9375,y:.65,w:.075,h:.1},{x:.9625,y:.65,w:.03125,h:.041666666666666664},{x:.9625,y:.65,w:.05,h:.06666666666666667},{x:.9625,y:.65,w:.075,h:.1},{x:.9875,y:.65,w:.03125,h:.041666666666666664},{x:.9875,y:.65,w:.05,h:.06666666666666667},{x:.9875,y:.65,w:.075,h:.1},{x:.0125,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.0125,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.0125,y:.6833333333333333,w:.075,h:.1},{x:.0375,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.0375,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.0375,y:.6833333333333333,w:.075,h:.1},{x:.0625,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.0625,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.0625,y:.6833333333333333,w:.075,h:.1},{x:.0875,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.0875,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.0875,y:.6833333333333333,w:.075,h:.1},{x:.1125,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.1125,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.1125,y:.6833333333333333,w:.075,h:.1},{x:.1375,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.1375,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.1375,y:.6833333333333333,w:.075,h:.1},{x:.1625,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.1625,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.1625,y:.6833333333333333,w:.075,h:.1},{x:.1875,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.1875,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.1875,y:.6833333333333333,w:.075,h:.1},{x:.2125,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.2125,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.2125,y:.6833333333333333,w:.075,h:.1},{x:.2375,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.2375,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.2375,y:.6833333333333333,w:.075,h:.1},{x:.2625,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.2625,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.2625,y:.6833333333333333,w:.075,h:.1},{x:.2875,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.2875,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.2875,y:.6833333333333333,w:.075,h:.1},{x:.3125,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.3125,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.3125,y:.6833333333333333,w:.075,h:.1},{x:.3375,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.3375,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.3375,y:.6833333333333333,w:.075,h:.1},{x:.3625,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.3625,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.3625,y:.6833333333333333,w:.075,h:.1},{x:.3875,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.3875,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.3875,y:.6833333333333333,w:.075,h:.1},{x:.4125,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.4125,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.4125,y:.6833333333333333,w:.075,h:.1},{x:.4375,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.4375,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.4375,y:.6833333333333333,w:.075,h:.1},{x:.4625,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.4625,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.4625,y:.6833333333333333,w:.075,h:.1},{x:.4875,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.4875,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.4875,y:.6833333333333333,w:.075,h:.1},{x:.5125,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.5125,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.5125,y:.6833333333333333,w:.075,h:.1},{x:.5375,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.5375,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.5375,y:.6833333333333333,w:.075,h:.1},{x:.5625,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.5625,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.5625,y:.6833333333333333,w:.075,h:.1},{x:.5875,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.5875,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.5875,y:.6833333333333333,w:.075,h:.1},{x:.6125,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.6125,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.6125,y:.6833333333333333,w:.075,h:.1},{x:.6375,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.6375,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.6375,y:.6833333333333333,w:.075,h:.1},{x:.6625,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.6625,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.6625,y:.6833333333333333,w:.075,h:.1},{x:.6875,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.6875,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.6875,y:.6833333333333333,w:.075,h:.1},{x:.7125,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.7125,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.7125,y:.6833333333333333,w:.075,h:.1},{x:.7375,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.7375,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.7375,y:.6833333333333333,w:.075,h:.1},{x:.7625,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.7625,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.7625,y:.6833333333333333,w:.075,h:.1},{x:.7875,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.7875,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.7875,y:.6833333333333333,w:.075,h:.1},{x:.8125,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.8125,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.8125,y:.6833333333333333,w:.075,h:.1},{x:.8375,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.8375,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.8375,y:.6833333333333333,w:.075,h:.1},{x:.8625,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.8625,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.8625,y:.6833333333333333,w:.075,h:.1},{x:.8875,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.8875,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.8875,y:.6833333333333333,w:.075,h:.1},{x:.9125,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.9125,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.9125,y:.6833333333333333,w:.075,h:.1},{x:.9375,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.9375,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.9375,y:.6833333333333333,w:.075,h:.1},{x:.9625,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.9625,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.9625,y:.6833333333333333,w:.075,h:.1},{x:.9875,y:.6833333333333333,w:.03125,h:.041666666666666664},{x:.9875,y:.6833333333333333,w:.05,h:.06666666666666667},{x:.9875,y:.6833333333333333,w:.075,h:.1},{x:.0125,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.0125,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.0125,y:.7166666666666667,w:.075,h:.1},{x:.0375,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.0375,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.0375,y:.7166666666666667,w:.075,h:.1},{x:.0625,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.0625,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.0625,y:.7166666666666667,w:.075,h:.1},{x:.0875,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.0875,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.0875,y:.7166666666666667,w:.075,h:.1},{x:.1125,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.1125,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.1125,y:.7166666666666667,w:.075,h:.1},{x:.1375,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.1375,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.1375,y:.7166666666666667,w:.075,h:.1},{x:.1625,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.1625,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.1625,y:.7166666666666667,w:.075,h:.1},{x:.1875,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.1875,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.1875,y:.7166666666666667,w:.075,h:.1},{x:.2125,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.2125,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.2125,y:.7166666666666667,w:.075,h:.1},{x:.2375,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.2375,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.2375,y:.7166666666666667,w:.075,h:.1},{x:.2625,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.2625,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.2625,y:.7166666666666667,w:.075,h:.1},{x:.2875,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.2875,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.2875,y:.7166666666666667,w:.075,h:.1},{x:.3125,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.3125,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.3125,y:.7166666666666667,w:.075,h:.1},{x:.3375,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.3375,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.3375,y:.7166666666666667,w:.075,h:.1},{x:.3625,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.3625,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.3625,y:.7166666666666667,w:.075,h:.1},{x:.3875,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.3875,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.3875,y:.7166666666666667,w:.075,h:.1},{x:.4125,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.4125,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.4125,y:.7166666666666667,w:.075,h:.1},{x:.4375,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.4375,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.4375,y:.7166666666666667,w:.075,h:.1},{x:.4625,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.4625,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.4625,y:.7166666666666667,w:.075,h:.1},{x:.4875,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.4875,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.4875,y:.7166666666666667,w:.075,h:.1},{x:.5125,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.5125,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.5125,y:.7166666666666667,w:.075,h:.1},{x:.5375,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.5375,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.5375,y:.7166666666666667,w:.075,h:.1},{x:.5625,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.5625,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.5625,y:.7166666666666667,w:.075,h:.1},{x:.5875,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.5875,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.5875,y:.7166666666666667,w:.075,h:.1},{x:.6125,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.6125,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.6125,y:.7166666666666667,w:.075,h:.1},{x:.6375,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.6375,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.6375,y:.7166666666666667,w:.075,h:.1},{x:.6625,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.6625,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.6625,y:.7166666666666667,w:.075,h:.1},{x:.6875,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.6875,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.6875,y:.7166666666666667,w:.075,h:.1},{x:.7125,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.7125,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.7125,y:.7166666666666667,w:.075,h:.1},{x:.7375,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.7375,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.7375,y:.7166666666666667,w:.075,h:.1},{x:.7625,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.7625,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.7625,y:.7166666666666667,w:.075,h:.1},{x:.7875,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.7875,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.7875,y:.7166666666666667,w:.075,h:.1},{x:.8125,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.8125,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.8125,y:.7166666666666667,w:.075,h:.1},{x:.8375,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.8375,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.8375,y:.7166666666666667,w:.075,h:.1},{x:.8625,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.8625,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.8625,y:.7166666666666667,w:.075,h:.1},{x:.8875,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.8875,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.8875,y:.7166666666666667,w:.075,h:.1},{x:.9125,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.9125,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.9125,y:.7166666666666667,w:.075,h:.1},{x:.9375,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.9375,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.9375,y:.7166666666666667,w:.075,h:.1},{x:.9625,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.9625,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.9625,y:.7166666666666667,w:.075,h:.1},{x:.9875,y:.7166666666666667,w:.03125,h:.041666666666666664},{x:.9875,y:.7166666666666667,w:.05,h:.06666666666666667},{x:.9875,y:.7166666666666667,w:.075,h:.1},{x:.0125,y:.75,w:.03125,h:.041666666666666664},{x:.0125,y:.75,w:.05,h:.06666666666666667},{x:.0125,y:.75,w:.075,h:.1},{x:.0375,y:.75,w:.03125,h:.041666666666666664},{x:.0375,y:.75,w:.05,h:.06666666666666667},{x:.0375,y:.75,w:.075,h:.1},{x:.0625,y:.75,w:.03125,h:.041666666666666664},{x:.0625,y:.75,w:.05,h:.06666666666666667},{x:.0625,y:.75,w:.075,h:.1},{x:.0875,y:.75,w:.03125,h:.041666666666666664},{x:.0875,y:.75,w:.05,h:.06666666666666667},{x:.0875,y:.75,w:.075,h:.1},{x:.1125,y:.75,w:.03125,h:.041666666666666664},{x:.1125,y:.75,w:.05,h:.06666666666666667},{x:.1125,y:.75,w:.075,h:.1},{x:.1375,y:.75,w:.03125,h:.041666666666666664},{x:.1375,y:.75,w:.05,h:.06666666666666667},{x:.1375,y:.75,w:.075,h:.1},{x:.1625,y:.75,w:.03125,h:.041666666666666664},{x:.1625,y:.75,w:.05,h:.06666666666666667},{x:.1625,y:.75,w:.075,h:.1},{x:.1875,y:.75,w:.03125,h:.041666666666666664},{x:.1875,y:.75,w:.05,h:.06666666666666667},{x:.1875,y:.75,w:.075,h:.1},{x:.2125,y:.75,w:.03125,h:.041666666666666664},{x:.2125,y:.75,w:.05,h:.06666666666666667},{x:.2125,y:.75,w:.075,h:.1},{x:.2375,y:.75,w:.03125,h:.041666666666666664},{x:.2375,y:.75,w:.05,h:.06666666666666667},{x:.2375,y:.75,w:.075,h:.1},{x:.2625,y:.75,w:.03125,h:.041666666666666664},{x:.2625,y:.75,w:.05,h:.06666666666666667},{x:.2625,y:.75,w:.075,h:.1},{x:.2875,y:.75,w:.03125,h:.041666666666666664},{x:.2875,y:.75,w:.05,h:.06666666666666667},{x:.2875,y:.75,w:.075,h:.1},{x:.3125,y:.75,w:.03125,h:.041666666666666664},{x:.3125,y:.75,w:.05,h:.06666666666666667},{x:.3125,y:.75,w:.075,h:.1},{x:.3375,y:.75,w:.03125,h:.041666666666666664},{x:.3375,y:.75,w:.05,h:.06666666666666667},{x:.3375,y:.75,w:.075,h:.1},{x:.3625,y:.75,w:.03125,h:.041666666666666664},{x:.3625,y:.75,w:.05,h:.06666666666666667},{x:.3625,y:.75,w:.075,h:.1},{x:.3875,y:.75,w:.03125,h:.041666666666666664},{x:.3875,y:.75,w:.05,h:.06666666666666667},{x:.3875,y:.75,w:.075,h:.1},{x:.4125,y:.75,w:.03125,h:.041666666666666664},{x:.4125,y:.75,w:.05,h:.06666666666666667},{x:.4125,y:.75,w:.075,h:.1},{x:.4375,y:.75,w:.03125,h:.041666666666666664},{x:.4375,y:.75,w:.05,h:.06666666666666667},{x:.4375,y:.75,w:.075,h:.1},{x:.4625,y:.75,w:.03125,h:.041666666666666664},{x:.4625,y:.75,w:.05,h:.06666666666666667},{x:.4625,y:.75,w:.075,h:.1},{x:.4875,y:.75,w:.03125,h:.041666666666666664},{x:.4875,y:.75,w:.05,h:.06666666666666667},{x:.4875,y:.75,w:.075,h:.1},{x:.5125,y:.75,w:.03125,h:.041666666666666664},{x:.5125,y:.75,w:.05,h:.06666666666666667},{x:.5125,y:.75,w:.075,h:.1},{x:.5375,y:.75,w:.03125,h:.041666666666666664},{x:.5375,y:.75,w:.05,h:.06666666666666667},{x:.5375,y:.75,w:.075,h:.1},{x:.5625,y:.75,w:.03125,h:.041666666666666664},{x:.5625,y:.75,w:.05,h:.06666666666666667},{x:.5625,y:.75,w:.075,h:.1},{x:.5875,y:.75,w:.03125,h:.041666666666666664},{x:.5875,y:.75,w:.05,h:.06666666666666667},{x:.5875,y:.75,w:.075,h:.1},{x:.6125,y:.75,w:.03125,h:.041666666666666664},{x:.6125,y:.75,w:.05,h:.06666666666666667},{x:.6125,y:.75,w:.075,h:.1},{x:.6375,y:.75,w:.03125,h:.041666666666666664},{x:.6375,y:.75,w:.05,h:.06666666666666667},{x:.6375,y:.75,w:.075,h:.1},{x:.6625,y:.75,w:.03125,h:.041666666666666664},{x:.6625,y:.75,w:.05,h:.06666666666666667},{x:.6625,y:.75,w:.075,h:.1},{x:.6875,y:.75,w:.03125,h:.041666666666666664},{x:.6875,y:.75,w:.05,h:.06666666666666667},{x:.6875,y:.75,w:.075,h:.1},{x:.7125,y:.75,w:.03125,h:.041666666666666664},{x:.7125,y:.75,w:.05,h:.06666666666666667},{x:.7125,y:.75,w:.075,h:.1},{x:.7375,y:.75,w:.03125,h:.041666666666666664},{x:.7375,y:.75,w:.05,h:.06666666666666667},{x:.7375,y:.75,w:.075,h:.1},{x:.7625,y:.75,w:.03125,h:.041666666666666664},{x:.7625,y:.75,w:.05,h:.06666666666666667},{x:.7625,y:.75,w:.075,h:.1},{x:.7875,y:.75,w:.03125,h:.041666666666666664},{x:.7875,y:.75,w:.05,h:.06666666666666667},{x:.7875,y:.75,w:.075,h:.1},{x:.8125,y:.75,w:.03125,h:.041666666666666664},{x:.8125,y:.75,w:.05,h:.06666666666666667},{x:.8125,y:.75,w:.075,h:.1},{x:.8375,y:.75,w:.03125,h:.041666666666666664},{x:.8375,y:.75,w:.05,h:.06666666666666667},{x:.8375,y:.75,w:.075,h:.1},{x:.8625,y:.75,w:.03125,h:.041666666666666664},{x:.8625,y:.75,w:.05,h:.06666666666666667},{x:.8625,y:.75,w:.075,h:.1},{x:.8875,y:.75,w:.03125,h:.041666666666666664},{x:.8875,y:.75,w:.05,h:.06666666666666667},{x:.8875,y:.75,w:.075,h:.1},{x:.9125,y:.75,w:.03125,h:.041666666666666664},{x:.9125,y:.75,w:.05,h:.06666666666666667},{x:.9125,y:.75,w:.075,h:.1},{x:.9375,y:.75,w:.03125,h:.041666666666666664},{x:.9375,y:.75,w:.05,h:.06666666666666667},{x:.9375,y:.75,w:.075,h:.1},{x:.9625,y:.75,w:.03125,h:.041666666666666664},{x:.9625,y:.75,w:.05,h:.06666666666666667},{x:.9625,y:.75,w:.075,h:.1},{x:.9875,y:.75,w:.03125,h:.041666666666666664},{x:.9875,y:.75,w:.05,h:.06666666666666667},{x:.9875,y:.75,w:.075,h:.1},{x:.0125,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.0125,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.0125,y:.7833333333333333,w:.075,h:.1},{x:.0375,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.0375,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.0375,y:.7833333333333333,w:.075,h:.1},{x:.0625,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.0625,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.0625,y:.7833333333333333,w:.075,h:.1},{x:.0875,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.0875,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.0875,y:.7833333333333333,w:.075,h:.1},{x:.1125,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.1125,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.1125,y:.7833333333333333,w:.075,h:.1},{x:.1375,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.1375,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.1375,y:.7833333333333333,w:.075,h:.1},{x:.1625,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.1625,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.1625,y:.7833333333333333,w:.075,h:.1},{x:.1875,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.1875,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.1875,y:.7833333333333333,w:.075,h:.1},{x:.2125,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.2125,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.2125,y:.7833333333333333,w:.075,h:.1},{x:.2375,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.2375,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.2375,y:.7833333333333333,w:.075,h:.1},{x:.2625,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.2625,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.2625,y:.7833333333333333,w:.075,h:.1},{x:.2875,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.2875,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.2875,y:.7833333333333333,w:.075,h:.1},{x:.3125,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.3125,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.3125,y:.7833333333333333,w:.075,h:.1},{x:.3375,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.3375,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.3375,y:.7833333333333333,w:.075,h:.1},{x:.3625,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.3625,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.3625,y:.7833333333333333,w:.075,h:.1},{x:.3875,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.3875,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.3875,y:.7833333333333333,w:.075,h:.1},{x:.4125,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.4125,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.4125,y:.7833333333333333,w:.075,h:.1},{x:.4375,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.4375,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.4375,y:.7833333333333333,w:.075,h:.1},{x:.4625,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.4625,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.4625,y:.7833333333333333,w:.075,h:.1},{x:.4875,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.4875,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.4875,y:.7833333333333333,w:.075,h:.1},{x:.5125,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.5125,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.5125,y:.7833333333333333,w:.075,h:.1},{x:.5375,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.5375,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.5375,y:.7833333333333333,w:.075,h:.1},{x:.5625,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.5625,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.5625,y:.7833333333333333,w:.075,h:.1},{x:.5875,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.5875,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.5875,y:.7833333333333333,w:.075,h:.1},{x:.6125,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.6125,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.6125,y:.7833333333333333,w:.075,h:.1},{x:.6375,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.6375,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.6375,y:.7833333333333333,w:.075,h:.1},{x:.6625,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.6625,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.6625,y:.7833333333333333,w:.075,h:.1},{x:.6875,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.6875,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.6875,y:.7833333333333333,w:.075,h:.1},{x:.7125,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.7125,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.7125,y:.7833333333333333,w:.075,h:.1},{x:.7375,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.7375,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.7375,y:.7833333333333333,w:.075,h:.1},{x:.7625,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.7625,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.7625,y:.7833333333333333,w:.075,h:.1},{x:.7875,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.7875,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.7875,y:.7833333333333333,w:.075,h:.1},{x:.8125,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.8125,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.8125,y:.7833333333333333,w:.075,h:.1},{x:.8375,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.8375,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.8375,y:.7833333333333333,w:.075,h:.1},{x:.8625,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.8625,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.8625,y:.7833333333333333,w:.075,h:.1},{x:.8875,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.8875,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.8875,y:.7833333333333333,w:.075,h:.1},{x:.9125,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.9125,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.9125,y:.7833333333333333,w:.075,h:.1},{x:.9375,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.9375,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.9375,y:.7833333333333333,w:.075,h:.1},{x:.9625,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.9625,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.9625,y:.7833333333333333,w:.075,h:.1},{x:.9875,y:.7833333333333333,w:.03125,h:.041666666666666664},{x:.9875,y:.7833333333333333,w:.05,h:.06666666666666667},{x:.9875,y:.7833333333333333,w:.075,h:.1},{x:.0125,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.0125,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.0125,y:.8166666666666667,w:.075,h:.1},{x:.0375,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.0375,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.0375,y:.8166666666666667,w:.075,h:.1},{x:.0625,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.0625,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.0625,y:.8166666666666667,w:.075,h:.1},{x:.0875,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.0875,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.0875,y:.8166666666666667,w:.075,h:.1},{x:.1125,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.1125,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.1125,y:.8166666666666667,w:.075,h:.1},{x:.1375,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.1375,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.1375,y:.8166666666666667,w:.075,h:.1},{x:.1625,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.1625,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.1625,y:.8166666666666667,w:.075,h:.1},{x:.1875,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.1875,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.1875,y:.8166666666666667,w:.075,h:.1},{x:.2125,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.2125,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.2125,y:.8166666666666667,w:.075,h:.1},{x:.2375,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.2375,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.2375,y:.8166666666666667,w:.075,h:.1},{x:.2625,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.2625,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.2625,y:.8166666666666667,w:.075,h:.1},{x:.2875,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.2875,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.2875,y:.8166666666666667,w:.075,h:.1},{x:.3125,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.3125,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.3125,y:.8166666666666667,w:.075,h:.1},{x:.3375,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.3375,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.3375,y:.8166666666666667,w:.075,h:.1},{x:.3625,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.3625,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.3625,y:.8166666666666667,w:.075,h:.1},{x:.3875,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.3875,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.3875,y:.8166666666666667,w:.075,h:.1},{x:.4125,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.4125,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.4125,y:.8166666666666667,w:.075,h:.1},{x:.4375,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.4375,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.4375,y:.8166666666666667,w:.075,h:.1},{x:.4625,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.4625,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.4625,y:.8166666666666667,w:.075,h:.1},{x:.4875,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.4875,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.4875,y:.8166666666666667,w:.075,h:.1},{x:.5125,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.5125,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.5125,y:.8166666666666667,w:.075,h:.1},{x:.5375,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.5375,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.5375,y:.8166666666666667,w:.075,h:.1},{x:.5625,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.5625,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.5625,y:.8166666666666667,w:.075,h:.1},{x:.5875,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.5875,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.5875,y:.8166666666666667,w:.075,h:.1},{x:.6125,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.6125,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.6125,y:.8166666666666667,w:.075,h:.1},{x:.6375,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.6375,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.6375,y:.8166666666666667,w:.075,h:.1},{x:.6625,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.6625,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.6625,y:.8166666666666667,w:.075,h:.1},{x:.6875,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.6875,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.6875,y:.8166666666666667,w:.075,h:.1},{x:.7125,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.7125,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.7125,y:.8166666666666667,w:.075,h:.1},{x:.7375,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.7375,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.7375,y:.8166666666666667,w:.075,h:.1},{x:.7625,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.7625,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.7625,y:.8166666666666667,w:.075,h:.1},{x:.7875,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.7875,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.7875,y:.8166666666666667,w:.075,h:.1},{x:.8125,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.8125,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.8125,y:.8166666666666667,w:.075,h:.1},{x:.8375,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.8375,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.8375,y:.8166666666666667,w:.075,h:.1},{x:.8625,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.8625,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.8625,y:.8166666666666667,w:.075,h:.1},{x:.8875,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.8875,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.8875,y:.8166666666666667,w:.075,h:.1},{x:.9125,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.9125,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.9125,y:.8166666666666667,w:.075,h:.1},{x:.9375,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.9375,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.9375,y:.8166666666666667,w:.075,h:.1},{x:.9625,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.9625,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.9625,y:.8166666666666667,w:.075,h:.1},{x:.9875,y:.8166666666666667,w:.03125,h:.041666666666666664},{x:.9875,y:.8166666666666667,w:.05,h:.06666666666666667},{x:.9875,y:.8166666666666667,w:.075,h:.1},{x:.0125,y:.85,w:.03125,h:.041666666666666664},{x:.0125,y:.85,w:.05,h:.06666666666666667},{x:.0125,y:.85,w:.075,h:.1},{x:.0375,y:.85,w:.03125,h:.041666666666666664},{x:.0375,y:.85,w:.05,h:.06666666666666667},{x:.0375,y:.85,w:.075,h:.1},{x:.0625,y:.85,w:.03125,h:.041666666666666664},{x:.0625,y:.85,w:.05,h:.06666666666666667},{x:.0625,y:.85,w:.075,h:.1},{x:.0875,y:.85,w:.03125,h:.041666666666666664},{x:.0875,y:.85,w:.05,h:.06666666666666667},{x:.0875,y:.85,w:.075,h:.1},{x:.1125,y:.85,w:.03125,h:.041666666666666664},{x:.1125,y:.85,w:.05,h:.06666666666666667},{x:.1125,y:.85,w:.075,h:.1},{x:.1375,y:.85,w:.03125,h:.041666666666666664},{x:.1375,y:.85,w:.05,h:.06666666666666667},{x:.1375,y:.85,w:.075,h:.1},{x:.1625,y:.85,w:.03125,h:.041666666666666664},{x:.1625,y:.85,w:.05,h:.06666666666666667},{x:.1625,y:.85,w:.075,h:.1},{x:.1875,y:.85,w:.03125,h:.041666666666666664},{x:.1875,y:.85,w:.05,h:.06666666666666667},{x:.1875,y:.85,w:.075,h:.1},{x:.2125,y:.85,w:.03125,h:.041666666666666664},{x:.2125,y:.85,w:.05,h:.06666666666666667},{x:.2125,y:.85,w:.075,h:.1},{x:.2375,y:.85,w:.03125,h:.041666666666666664},{x:.2375,y:.85,w:.05,h:.06666666666666667},{x:.2375,y:.85,w:.075,h:.1},{x:.2625,y:.85,w:.03125,h:.041666666666666664},{x:.2625,y:.85,w:.05,h:.06666666666666667},{x:.2625,y:.85,w:.075,h:.1},{x:.2875,y:.85,w:.03125,h:.041666666666666664},{x:.2875,y:.85,w:.05,h:.06666666666666667},{x:.2875,y:.85,w:.075,h:.1},{x:.3125,y:.85,w:.03125,h:.041666666666666664},{x:.3125,y:.85,w:.05,h:.06666666666666667},{x:.3125,y:.85,w:.075,h:.1},{x:.3375,y:.85,w:.03125,h:.041666666666666664},{x:.3375,y:.85,w:.05,h:.06666666666666667},{x:.3375,y:.85,w:.075,h:.1},{x:.3625,y:.85,w:.03125,h:.041666666666666664},{x:.3625,y:.85,w:.05,h:.06666666666666667},{x:.3625,y:.85,w:.075,h:.1},{x:.3875,y:.85,w:.03125,h:.041666666666666664},{x:.3875,y:.85,w:.05,h:.06666666666666667},{x:.3875,y:.85,w:.075,h:.1},{x:.4125,y:.85,w:.03125,h:.041666666666666664},{x:.4125,y:.85,w:.05,h:.06666666666666667},{x:.4125,y:.85,w:.075,h:.1},{x:.4375,y:.85,w:.03125,h:.041666666666666664},{x:.4375,y:.85,w:.05,h:.06666666666666667},{x:.4375,y:.85,w:.075,h:.1},{x:.4625,y:.85,w:.03125,h:.041666666666666664},{x:.4625,y:.85,w:.05,h:.06666666666666667},{x:.4625,y:.85,w:.075,h:.1},{x:.4875,y:.85,w:.03125,h:.041666666666666664},{x:.4875,y:.85,w:.05,h:.06666666666666667},{x:.4875,y:.85,w:.075,h:.1},{x:.5125,y:.85,w:.03125,h:.041666666666666664},{x:.5125,y:.85,w:.05,h:.06666666666666667},{x:.5125,y:.85,w:.075,h:.1},{x:.5375,y:.85,w:.03125,h:.041666666666666664},{x:.5375,y:.85,w:.05,h:.06666666666666667},{x:.5375,y:.85,w:.075,h:.1},{x:.5625,y:.85,w:.03125,h:.041666666666666664},{x:.5625,y:.85,w:.05,h:.06666666666666667},{x:.5625,y:.85,w:.075,h:.1},{x:.5875,y:.85,w:.03125,h:.041666666666666664},{x:.5875,y:.85,w:.05,h:.06666666666666667},{x:.5875,y:.85,w:.075,h:.1},{x:.6125,y:.85,w:.03125,h:.041666666666666664},{x:.6125,y:.85,w:.05,h:.06666666666666667},{x:.6125,y:.85,w:.075,h:.1},{x:.6375,y:.85,w:.03125,h:.041666666666666664},{x:.6375,y:.85,w:.05,h:.06666666666666667},{x:.6375,y:.85,w:.075,h:.1},{x:.6625,y:.85,w:.03125,h:.041666666666666664},{x:.6625,y:.85,w:.05,h:.06666666666666667},{x:.6625,y:.85,w:.075,h:.1},{x:.6875,y:.85,w:.03125,h:.041666666666666664},{x:.6875,y:.85,w:.05,h:.06666666666666667},{x:.6875,y:.85,w:.075,h:.1},{x:.7125,y:.85,w:.03125,h:.041666666666666664},{x:.7125,y:.85,w:.05,h:.06666666666666667},{x:.7125,y:.85,w:.075,h:.1},{x:.7375,y:.85,w:.03125,h:.041666666666666664},{x:.7375,y:.85,w:.05,h:.06666666666666667},{x:.7375,y:.85,w:.075,h:.1},{x:.7625,y:.85,w:.03125,h:.041666666666666664},{x:.7625,y:.85,w:.05,h:.06666666666666667},{x:.7625,y:.85,w:.075,h:.1},{x:.7875,y:.85,w:.03125,h:.041666666666666664},{x:.7875,y:.85,w:.05,h:.06666666666666667},{x:.7875,y:.85,w:.075,h:.1},{x:.8125,y:.85,w:.03125,h:.041666666666666664},{x:.8125,y:.85,w:.05,h:.06666666666666667},{x:.8125,y:.85,w:.075,h:.1},{x:.8375,y:.85,w:.03125,h:.041666666666666664},{x:.8375,y:.85,w:.05,h:.06666666666666667},{x:.8375,y:.85,w:.075,h:.1},{x:.8625,y:.85,w:.03125,h:.041666666666666664},{x:.8625,y:.85,w:.05,h:.06666666666666667},{x:.8625,y:.85,w:.075,h:.1},{x:.8875,y:.85,w:.03125,h:.041666666666666664},{x:.8875,y:.85,w:.05,h:.06666666666666667},{x:.8875,y:.85,w:.075,h:.1},{x:.9125,y:.85,w:.03125,h:.041666666666666664},{x:.9125,y:.85,w:.05,h:.06666666666666667},{x:.9125,y:.85,w:.075,h:.1},{x:.9375,y:.85,w:.03125,h:.041666666666666664},{x:.9375,y:.85,w:.05,h:.06666666666666667},{x:.9375,y:.85,w:.075,h:.1},{x:.9625,y:.85,w:.03125,h:.041666666666666664},{x:.9625,y:.85,w:.05,h:.06666666666666667},{x:.9625,y:.85,w:.075,h:.1},{x:.9875,y:.85,w:.03125,h:.041666666666666664},{x:.9875,y:.85,w:.05,h:.06666666666666667},{x:.9875,y:.85,w:.075,h:.1},{x:.0125,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.0125,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.0125,y:.8833333333333333,w:.075,h:.1},{x:.0375,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.0375,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.0375,y:.8833333333333333,w:.075,h:.1},{x:.0625,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.0625,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.0625,y:.8833333333333333,w:.075,h:.1},{x:.0875,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.0875,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.0875,y:.8833333333333333,w:.075,h:.1},{x:.1125,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.1125,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.1125,y:.8833333333333333,w:.075,h:.1},{x:.1375,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.1375,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.1375,y:.8833333333333333,w:.075,h:.1},{x:.1625,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.1625,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.1625,y:.8833333333333333,w:.075,h:.1},{x:.1875,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.1875,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.1875,y:.8833333333333333,w:.075,h:.1},{x:.2125,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.2125,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.2125,y:.8833333333333333,w:.075,h:.1},{x:.2375,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.2375,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.2375,y:.8833333333333333,w:.075,h:.1},{x:.2625,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.2625,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.2625,y:.8833333333333333,w:.075,h:.1},{x:.2875,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.2875,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.2875,y:.8833333333333333,w:.075,h:.1},{x:.3125,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.3125,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.3125,y:.8833333333333333,w:.075,h:.1},{x:.3375,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.3375,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.3375,y:.8833333333333333,w:.075,h:.1},{x:.3625,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.3625,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.3625,y:.8833333333333333,w:.075,h:.1},{x:.3875,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.3875,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.3875,y:.8833333333333333,w:.075,h:.1},{x:.4125,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.4125,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.4125,y:.8833333333333333,w:.075,h:.1},{x:.4375,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.4375,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.4375,y:.8833333333333333,w:.075,h:.1},{x:.4625,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.4625,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.4625,y:.8833333333333333,w:.075,h:.1},{x:.4875,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.4875,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.4875,y:.8833333333333333,w:.075,h:.1},{x:.5125,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.5125,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.5125,y:.8833333333333333,w:.075,h:.1},{x:.5375,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.5375,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.5375,y:.8833333333333333,w:.075,h:.1},{x:.5625,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.5625,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.5625,y:.8833333333333333,w:.075,h:.1},{x:.5875,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.5875,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.5875,y:.8833333333333333,w:.075,h:.1},{x:.6125,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.6125,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.6125,y:.8833333333333333,w:.075,h:.1},{x:.6375,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.6375,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.6375,y:.8833333333333333,w:.075,h:.1},{x:.6625,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.6625,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.6625,y:.8833333333333333,w:.075,h:.1},{x:.6875,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.6875,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.6875,y:.8833333333333333,w:.075,h:.1},{x:.7125,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.7125,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.7125,y:.8833333333333333,w:.075,h:.1},{x:.7375,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.7375,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.7375,y:.8833333333333333,w:.075,h:.1},{x:.7625,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.7625,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.7625,y:.8833333333333333,w:.075,h:.1},{x:.7875,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.7875,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.7875,y:.8833333333333333,w:.075,h:.1},{x:.8125,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.8125,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.8125,y:.8833333333333333,w:.075,h:.1},{x:.8375,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.8375,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.8375,y:.8833333333333333,w:.075,h:.1},{x:.8625,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.8625,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.8625,y:.8833333333333333,w:.075,h:.1},{x:.8875,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.8875,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.8875,y:.8833333333333333,w:.075,h:.1},{x:.9125,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.9125,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.9125,y:.8833333333333333,w:.075,h:.1},{x:.9375,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.9375,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.9375,y:.8833333333333333,w:.075,h:.1},{x:.9625,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.9625,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.9625,y:.8833333333333333,w:.075,h:.1},{x:.9875,y:.8833333333333333,w:.03125,h:.041666666666666664},{x:.9875,y:.8833333333333333,w:.05,h:.06666666666666667},{x:.9875,y:.8833333333333333,w:.075,h:.1},{x:.0125,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.0125,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.0125,y:.9166666666666666,w:.075,h:.1},{x:.0375,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.0375,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.0375,y:.9166666666666666,w:.075,h:.1},{x:.0625,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.0625,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.0625,y:.9166666666666666,w:.075,h:.1},{x:.0875,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.0875,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.0875,y:.9166666666666666,w:.075,h:.1},{x:.1125,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.1125,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.1125,y:.9166666666666666,w:.075,h:.1},{x:.1375,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.1375,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.1375,y:.9166666666666666,w:.075,h:.1},{x:.1625,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.1625,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.1625,y:.9166666666666666,w:.075,h:.1},{x:.1875,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.1875,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.1875,y:.9166666666666666,w:.075,h:.1},{x:.2125,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.2125,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.2125,y:.9166666666666666,w:.075,h:.1},{x:.2375,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.2375,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.2375,y:.9166666666666666,w:.075,h:.1},{x:.2625,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.2625,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.2625,y:.9166666666666666,w:.075,h:.1},{x:.2875,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.2875,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.2875,y:.9166666666666666,w:.075,h:.1},{x:.3125,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.3125,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.3125,y:.9166666666666666,w:.075,h:.1},{x:.3375,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.3375,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.3375,y:.9166666666666666,w:.075,h:.1},{x:.3625,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.3625,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.3625,y:.9166666666666666,w:.075,h:.1},{x:.3875,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.3875,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.3875,y:.9166666666666666,w:.075,h:.1},{x:.4125,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.4125,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.4125,y:.9166666666666666,w:.075,h:.1},{x:.4375,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.4375,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.4375,y:.9166666666666666,w:.075,h:.1},{x:.4625,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.4625,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.4625,y:.9166666666666666,w:.075,h:.1},{x:.4875,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.4875,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.4875,y:.9166666666666666,w:.075,h:.1},{x:.5125,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.5125,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.5125,y:.9166666666666666,w:.075,h:.1},{x:.5375,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.5375,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.5375,y:.9166666666666666,w:.075,h:.1},{x:.5625,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.5625,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.5625,y:.9166666666666666,w:.075,h:.1},{x:.5875,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.5875,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.5875,y:.9166666666666666,w:.075,h:.1},{x:.6125,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.6125,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.6125,y:.9166666666666666,w:.075,h:.1},{x:.6375,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.6375,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.6375,y:.9166666666666666,w:.075,h:.1},{x:.6625,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.6625,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.6625,y:.9166666666666666,w:.075,h:.1},{x:.6875,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.6875,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.6875,y:.9166666666666666,w:.075,h:.1},{x:.7125,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.7125,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.7125,y:.9166666666666666,w:.075,h:.1},{x:.7375,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.7375,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.7375,y:.9166666666666666,w:.075,h:.1},{x:.7625,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.7625,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.7625,y:.9166666666666666,w:.075,h:.1},{x:.7875,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.7875,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.7875,y:.9166666666666666,w:.075,h:.1},{x:.8125,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.8125,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.8125,y:.9166666666666666,w:.075,h:.1},{x:.8375,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.8375,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.8375,y:.9166666666666666,w:.075,h:.1},{x:.8625,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.8625,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.8625,y:.9166666666666666,w:.075,h:.1},{x:.8875,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.8875,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.8875,y:.9166666666666666,w:.075,h:.1},{x:.9125,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.9125,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.9125,y:.9166666666666666,w:.075,h:.1},{x:.9375,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.9375,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.9375,y:.9166666666666666,w:.075,h:.1},{x:.9625,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.9625,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.9625,y:.9166666666666666,w:.075,h:.1},{x:.9875,y:.9166666666666666,w:.03125,h:.041666666666666664},{x:.9875,y:.9166666666666666,w:.05,h:.06666666666666667},{x:.9875,y:.9166666666666666,w:.075,h:.1},{x:.0125,y:.95,w:.03125,h:.041666666666666664},{x:.0125,y:.95,w:.05,h:.06666666666666667},{x:.0125,y:.95,w:.075,h:.1},{x:.0375,y:.95,w:.03125,h:.041666666666666664},{x:.0375,y:.95,w:.05,h:.06666666666666667},{x:.0375,y:.95,w:.075,h:.1},{x:.0625,y:.95,w:.03125,h:.041666666666666664},{x:.0625,y:.95,w:.05,h:.06666666666666667},{x:.0625,y:.95,w:.075,h:.1},{x:.0875,y:.95,w:.03125,h:.041666666666666664},{x:.0875,y:.95,w:.05,h:.06666666666666667},{x:.0875,y:.95,w:.075,h:.1},{x:.1125,y:.95,w:.03125,h:.041666666666666664},{x:.1125,y:.95,w:.05,h:.06666666666666667},{x:.1125,y:.95,w:.075,h:.1},{x:.1375,y:.95,w:.03125,h:.041666666666666664},{x:.1375,y:.95,w:.05,h:.06666666666666667},{x:.1375,y:.95,w:.075,h:.1},{x:.1625,y:.95,w:.03125,h:.041666666666666664},{x:.1625,y:.95,w:.05,h:.06666666666666667},{x:.1625,y:.95,w:.075,h:.1},{x:.1875,y:.95,w:.03125,h:.041666666666666664},{x:.1875,y:.95,w:.05,h:.06666666666666667},{x:.1875,y:.95,w:.075,h:.1},{x:.2125,y:.95,w:.03125,h:.041666666666666664},{x:.2125,y:.95,w:.05,h:.06666666666666667},{x:.2125,y:.95,w:.075,h:.1},{x:.2375,y:.95,w:.03125,h:.041666666666666664},{x:.2375,y:.95,w:.05,h:.06666666666666667},{x:.2375,y:.95,w:.075,h:.1},{x:.2625,y:.95,w:.03125,h:.041666666666666664},{x:.2625,y:.95,w:.05,h:.06666666666666667},{x:.2625,y:.95,w:.075,h:.1},{x:.2875,y:.95,w:.03125,h:.041666666666666664},{x:.2875,y:.95,w:.05,h:.06666666666666667},{x:.2875,y:.95,w:.075,h:.1},{x:.3125,y:.95,w:.03125,h:.041666666666666664},{x:.3125,y:.95,w:.05,h:.06666666666666667},{x:.3125,y:.95,w:.075,h:.1},{x:.3375,y:.95,w:.03125,h:.041666666666666664},{x:.3375,y:.95,w:.05,h:.06666666666666667},{x:.3375,y:.95,w:.075,h:.1},{x:.3625,y:.95,w:.03125,h:.041666666666666664},{x:.3625,y:.95,w:.05,h:.06666666666666667},{x:.3625,y:.95,w:.075,h:.1},{x:.3875,y:.95,w:.03125,h:.041666666666666664},{x:.3875,y:.95,w:.05,h:.06666666666666667},{x:.3875,y:.95,w:.075,h:.1},{x:.4125,y:.95,w:.03125,h:.041666666666666664},{x:.4125,y:.95,w:.05,h:.06666666666666667},{x:.4125,y:.95,w:.075,h:.1},{x:.4375,y:.95,w:.03125,h:.041666666666666664},{x:.4375,y:.95,w:.05,h:.06666666666666667},{x:.4375,y:.95,w:.075,h:.1},{x:.4625,y:.95,w:.03125,h:.041666666666666664},{x:.4625,y:.95,w:.05,h:.06666666666666667},{x:.4625,y:.95,w:.075,h:.1},{x:.4875,y:.95,w:.03125,h:.041666666666666664},{x:.4875,y:.95,w:.05,h:.06666666666666667},{x:.4875,y:.95,w:.075,h:.1},{x:.5125,y:.95,w:.03125,h:.041666666666666664},{x:.5125,y:.95,w:.05,h:.06666666666666667},{x:.5125,y:.95,w:.075,h:.1},{x:.5375,y:.95,w:.03125,h:.041666666666666664},{x:.5375,y:.95,w:.05,h:.06666666666666667},{x:.5375,y:.95,w:.075,h:.1},{x:.5625,y:.95,w:.03125,h:.041666666666666664},{x:.5625,y:.95,w:.05,h:.06666666666666667},{x:.5625,y:.95,w:.075,h:.1},{x:.5875,y:.95,w:.03125,h:.041666666666666664},{x:.5875,y:.95,w:.05,h:.06666666666666667},{x:.5875,y:.95,w:.075,h:.1},{x:.6125,y:.95,w:.03125,h:.041666666666666664},{x:.6125,y:.95,w:.05,h:.06666666666666667},{x:.6125,y:.95,w:.075,h:.1},{x:.6375,y:.95,w:.03125,h:.041666666666666664},{x:.6375,y:.95,w:.05,h:.06666666666666667},{x:.6375,y:.95,w:.075,h:.1},{x:.6625,y:.95,w:.03125,h:.041666666666666664},{x:.6625,y:.95,w:.05,h:.06666666666666667},{x:.6625,y:.95,w:.075,h:.1},{x:.6875,y:.95,w:.03125,h:.041666666666666664},{x:.6875,y:.95,w:.05,h:.06666666666666667},{x:.6875,y:.95,w:.075,h:.1},{x:.7125,y:.95,w:.03125,h:.041666666666666664},{x:.7125,y:.95,w:.05,h:.06666666666666667},{x:.7125,y:.95,w:.075,h:.1},{x:.7375,y:.95,w:.03125,h:.041666666666666664},{x:.7375,y:.95,w:.05,h:.06666666666666667},{x:.7375,y:.95,w:.075,h:.1},{x:.7625,y:.95,w:.03125,h:.041666666666666664},{x:.7625,y:.95,w:.05,h:.06666666666666667},{x:.7625,y:.95,w:.075,h:.1},{x:.7875,y:.95,w:.03125,h:.041666666666666664},{x:.7875,y:.95,w:.05,h:.06666666666666667},{x:.7875,y:.95,w:.075,h:.1},{x:.8125,y:.95,w:.03125,h:.041666666666666664},{x:.8125,y:.95,w:.05,h:.06666666666666667},{x:.8125,y:.95,w:.075,h:.1},{x:.8375,y:.95,w:.03125,h:.041666666666666664},{x:.8375,y:.95,w:.05,h:.06666666666666667},{x:.8375,y:.95,w:.075,h:.1},{x:.8625,y:.95,w:.03125,h:.041666666666666664},{x:.8625,y:.95,w:.05,h:.06666666666666667},{x:.8625,y:.95,w:.075,h:.1},{x:.8875,y:.95,w:.03125,h:.041666666666666664},{x:.8875,y:.95,w:.05,h:.06666666666666667},{x:.8875,y:.95,w:.075,h:.1},{x:.9125,y:.95,w:.03125,h:.041666666666666664},{x:.9125,y:.95,w:.05,h:.06666666666666667},{x:.9125,y:.95,w:.075,h:.1},{x:.9375,y:.95,w:.03125,h:.041666666666666664},{x:.9375,y:.95,w:.05,h:.06666666666666667},{x:.9375,y:.95,w:.075,h:.1},{x:.9625,y:.95,w:.03125,h:.041666666666666664},{x:.9625,y:.95,w:.05,h:.06666666666666667},{x:.9625,y:.95,w:.075,h:.1},{x:.9875,y:.95,w:.03125,h:.041666666666666664},{x:.9875,y:.95,w:.05,h:.06666666666666667},{x:.9875,y:.95,w:.075,h:.1},{x:.0125,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.0125,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.0125,y:.9833333333333333,w:.075,h:.1},{x:.0375,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.0375,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.0375,y:.9833333333333333,w:.075,h:.1},{x:.0625,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.0625,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.0625,y:.9833333333333333,w:.075,h:.1},{x:.0875,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.0875,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.0875,y:.9833333333333333,w:.075,h:.1},{x:.1125,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.1125,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.1125,y:.9833333333333333,w:.075,h:.1},{x:.1375,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.1375,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.1375,y:.9833333333333333,w:.075,h:.1},{x:.1625,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.1625,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.1625,y:.9833333333333333,w:.075,h:.1},{x:.1875,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.1875,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.1875,y:.9833333333333333,w:.075,h:.1},{x:.2125,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.2125,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.2125,y:.9833333333333333,w:.075,h:.1},{x:.2375,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.2375,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.2375,y:.9833333333333333,w:.075,h:.1},{x:.2625,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.2625,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.2625,y:.9833333333333333,w:.075,h:.1},{x:.2875,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.2875,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.2875,y:.9833333333333333,w:.075,h:.1},{x:.3125,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.3125,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.3125,y:.9833333333333333,w:.075,h:.1},{x:.3375,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.3375,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.3375,y:.9833333333333333,w:.075,h:.1},{x:.3625,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.3625,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.3625,y:.9833333333333333,w:.075,h:.1},{x:.3875,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.3875,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.3875,y:.9833333333333333,w:.075,h:.1},{x:.4125,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.4125,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.4125,y:.9833333333333333,w:.075,h:.1},{x:.4375,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.4375,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.4375,y:.9833333333333333,w:.075,h:.1},{x:.4625,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.4625,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.4625,y:.9833333333333333,w:.075,h:.1},{x:.4875,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.4875,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.4875,y:.9833333333333333,w:.075,h:.1},{x:.5125,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.5125,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.5125,y:.9833333333333333,w:.075,h:.1},{x:.5375,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.5375,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.5375,y:.9833333333333333,w:.075,h:.1},{x:.5625,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.5625,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.5625,y:.9833333333333333,w:.075,h:.1},{x:.5875,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.5875,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.5875,y:.9833333333333333,w:.075,h:.1},{x:.6125,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.6125,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.6125,y:.9833333333333333,w:.075,h:.1},{x:.6375,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.6375,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.6375,y:.9833333333333333,w:.075,h:.1},{x:.6625,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.6625,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.6625,y:.9833333333333333,w:.075,h:.1},{x:.6875,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.6875,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.6875,y:.9833333333333333,w:.075,h:.1},{x:.7125,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.7125,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.7125,y:.9833333333333333,w:.075,h:.1},{x:.7375,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.7375,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.7375,y:.9833333333333333,w:.075,h:.1},{x:.7625,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.7625,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.7625,y:.9833333333333333,w:.075,h:.1},{x:.7875,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.7875,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.7875,y:.9833333333333333,w:.075,h:.1},{x:.8125,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.8125,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.8125,y:.9833333333333333,w:.075,h:.1},{x:.8375,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.8375,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.8375,y:.9833333333333333,w:.075,h:.1},{x:.8625,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.8625,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.8625,y:.9833333333333333,w:.075,h:.1},{x:.8875,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.8875,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.8875,y:.9833333333333333,w:.075,h:.1},{x:.9125,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.9125,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.9125,y:.9833333333333333,w:.075,h:.1},{x:.9375,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.9375,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.9375,y:.9833333333333333,w:.075,h:.1},{x:.9625,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.9625,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.9625,y:.9833333333333333,w:.075,h:.1},{x:.9875,y:.9833333333333333,w:.03125,h:.041666666666666664},{x:.9875,y:.9833333333333333,w:.05,h:.06666666666666667},{x:.9875,y:.9833333333333333,w:.075,h:.1},{x:.025,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.025,y:.03333333333333333,w:.15,h:.2},{x:.075,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.075,y:.03333333333333333,w:.15,h:.2},{x:.125,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.125,y:.03333333333333333,w:.15,h:.2},{x:.175,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.175,y:.03333333333333333,w:.15,h:.2},{x:.225,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.225,y:.03333333333333333,w:.15,h:.2},{x:.275,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.275,y:.03333333333333333,w:.15,h:.2},{x:.325,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.325,y:.03333333333333333,w:.15,h:.2},{x:.375,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.375,y:.03333333333333333,w:.15,h:.2},{x:.425,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.425,y:.03333333333333333,w:.15,h:.2},{x:.475,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.475,y:.03333333333333333,w:.15,h:.2},{x:.525,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.525,y:.03333333333333333,w:.15,h:.2},{x:.575,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.575,y:.03333333333333333,w:.15,h:.2},{x:.625,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.625,y:.03333333333333333,w:.15,h:.2},{x:.675,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.675,y:.03333333333333333,w:.15,h:.2},{x:.725,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.725,y:.03333333333333333,w:.15,h:.2},{x:.775,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.775,y:.03333333333333333,w:.15,h:.2},{x:.825,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.825,y:.03333333333333333,w:.15,h:.2},{x:.875,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.875,y:.03333333333333333,w:.15,h:.2},{x:.925,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.925,y:.03333333333333333,w:.15,h:.2},{x:.975,y:.03333333333333333,w:.1,h:.13333333333333333},{x:.975,y:.03333333333333333,w:.15,h:.2},{x:.025,y:.1,w:.1,h:.13333333333333333},{x:.025,y:.1,w:.15,h:.2},{x:.075,y:.1,w:.1,h:.13333333333333333},{x:.075,y:.1,w:.15,h:.2},{x:.125,y:.1,w:.1,h:.13333333333333333},{x:.125,y:.1,w:.15,h:.2},{x:.175,y:.1,w:.1,h:.13333333333333333},{x:.175,y:.1,w:.15,h:.2},{x:.225,y:.1,w:.1,h:.13333333333333333},{x:.225,y:.1,w:.15,h:.2},{x:.275,y:.1,w:.1,h:.13333333333333333},{x:.275,y:.1,w:.15,h:.2},{x:.325,y:.1,w:.1,h:.13333333333333333},{x:.325,y:.1,w:.15,h:.2},{x:.375,y:.1,w:.1,h:.13333333333333333},{x:.375,y:.1,w:.15,h:.2},{x:.425,y:.1,w:.1,h:.13333333333333333},{x:.425,y:.1,w:.15,h:.2},{x:.475,y:.1,w:.1,h:.13333333333333333},{x:.475,y:.1,w:.15,h:.2},{x:.525,y:.1,w:.1,h:.13333333333333333},{x:.525,y:.1,w:.15,h:.2},{x:.575,y:.1,w:.1,h:.13333333333333333},{x:.575,y:.1,w:.15,h:.2},{x:.625,y:.1,w:.1,h:.13333333333333333},{x:.625,y:.1,w:.15,h:.2},{x:.675,y:.1,w:.1,h:.13333333333333333},{x:.675,y:.1,w:.15,h:.2},{x:.725,y:.1,w:.1,h:.13333333333333333},{x:.725,y:.1,w:.15,h:.2},{x:.775,y:.1,w:.1,h:.13333333333333333},{x:.775,y:.1,w:.15,h:.2},{x:.825,y:.1,w:.1,h:.13333333333333333},{x:.825,y:.1,w:.15,h:.2},{x:.875,y:.1,w:.1,h:.13333333333333333},{x:.875,y:.1,w:.15,h:.2},{x:.925,y:.1,w:.1,h:.13333333333333333},{x:.925,y:.1,w:.15,h:.2},{x:.975,y:.1,w:.1,h:.13333333333333333},{x:.975,y:.1,w:.15,h:.2},{x:.025,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.025,y:.16666666666666666,w:.15,h:.2},{x:.075,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.075,y:.16666666666666666,w:.15,h:.2},{x:.125,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.125,y:.16666666666666666,w:.15,h:.2},{x:.175,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.175,y:.16666666666666666,w:.15,h:.2},{x:.225,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.225,y:.16666666666666666,w:.15,h:.2},{x:.275,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.275,y:.16666666666666666,w:.15,h:.2},{x:.325,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.325,y:.16666666666666666,w:.15,h:.2},{x:.375,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.375,y:.16666666666666666,w:.15,h:.2},{x:.425,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.425,y:.16666666666666666,w:.15,h:.2},{x:.475,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.475,y:.16666666666666666,w:.15,h:.2},{x:.525,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.525,y:.16666666666666666,w:.15,h:.2},{x:.575,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.575,y:.16666666666666666,w:.15,h:.2},{x:.625,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.625,y:.16666666666666666,w:.15,h:.2},{x:.675,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.675,y:.16666666666666666,w:.15,h:.2},{x:.725,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.725,y:.16666666666666666,w:.15,h:.2},{x:.775,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.775,y:.16666666666666666,w:.15,h:.2},{x:.825,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.825,y:.16666666666666666,w:.15,h:.2},{x:.875,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.875,y:.16666666666666666,w:.15,h:.2},{x:.925,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.925,y:.16666666666666666,w:.15,h:.2},{x:.975,y:.16666666666666666,w:.1,h:.13333333333333333},{x:.975,y:.16666666666666666,w:.15,h:.2},{x:.025,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.025,y:.23333333333333334,w:.15,h:.2},{x:.075,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.075,y:.23333333333333334,w:.15,h:.2},{x:.125,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.125,y:.23333333333333334,w:.15,h:.2},{x:.175,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.175,y:.23333333333333334,w:.15,h:.2},{x:.225,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.225,y:.23333333333333334,w:.15,h:.2},{x:.275,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.275,y:.23333333333333334,w:.15,h:.2},{x:.325,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.325,y:.23333333333333334,w:.15,h:.2},{x:.375,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.375,y:.23333333333333334,w:.15,h:.2},{x:.425,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.425,y:.23333333333333334,w:.15,h:.2},{x:.475,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.475,y:.23333333333333334,w:.15,h:.2},{x:.525,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.525,y:.23333333333333334,w:.15,h:.2},{x:.575,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.575,y:.23333333333333334,w:.15,h:.2},{x:.625,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.625,y:.23333333333333334,w:.15,h:.2},{x:.675,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.675,y:.23333333333333334,w:.15,h:.2},{x:.725,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.725,y:.23333333333333334,w:.15,h:.2},{x:.775,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.775,y:.23333333333333334,w:.15,h:.2},{x:.825,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.825,y:.23333333333333334,w:.15,h:.2},{x:.875,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.875,y:.23333333333333334,w:.15,h:.2},{x:.925,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.925,y:.23333333333333334,w:.15,h:.2},{x:.975,y:.23333333333333334,w:.1,h:.13333333333333333},{x:.975,y:.23333333333333334,w:.15,h:.2},{x:.025,y:.3,w:.1,h:.13333333333333333},{x:.025,y:.3,w:.15,h:.2},{x:.075,y:.3,w:.1,h:.13333333333333333},{x:.075,y:.3,w:.15,h:.2},{x:.125,y:.3,w:.1,h:.13333333333333333},{x:.125,y:.3,w:.15,h:.2},{x:.175,y:.3,w:.1,h:.13333333333333333},{x:.175,y:.3,w:.15,h:.2},{x:.225,y:.3,w:.1,h:.13333333333333333},{x:.225,y:.3,w:.15,h:.2},{x:.275,y:.3,w:.1,h:.13333333333333333},{x:.275,y:.3,w:.15,h:.2},{x:.325,y:.3,w:.1,h:.13333333333333333},{x:.325,y:.3,w:.15,h:.2},{x:.375,y:.3,w:.1,h:.13333333333333333},{x:.375,y:.3,w:.15,h:.2},{x:.425,y:.3,w:.1,h:.13333333333333333},{x:.425,y:.3,w:.15,h:.2},{x:.475,y:.3,w:.1,h:.13333333333333333},{x:.475,y:.3,w:.15,h:.2},{x:.525,y:.3,w:.1,h:.13333333333333333},{x:.525,y:.3,w:.15,h:.2},{x:.575,y:.3,w:.1,h:.13333333333333333},{x:.575,y:.3,w:.15,h:.2},{x:.625,y:.3,w:.1,h:.13333333333333333},{x:.625,y:.3,w:.15,h:.2},{x:.675,y:.3,w:.1,h:.13333333333333333},{x:.675,y:.3,w:.15,h:.2},{x:.725,y:.3,w:.1,h:.13333333333333333},{x:.725,y:.3,w:.15,h:.2},{x:.775,y:.3,w:.1,h:.13333333333333333},{x:.775,y:.3,w:.15,h:.2},{x:.825,y:.3,w:.1,h:.13333333333333333},{x:.825,y:.3,w:.15,h:.2},{x:.875,y:.3,w:.1,h:.13333333333333333},{x:.875,y:.3,w:.15,h:.2},{x:.925,y:.3,w:.1,h:.13333333333333333},{x:.925,y:.3,w:.15,h:.2},{x:.975,y:.3,w:.1,h:.13333333333333333},{x:.975,y:.3,w:.15,h:.2},{x:.025,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.025,y:.36666666666666664,w:.15,h:.2},{x:.075,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.075,y:.36666666666666664,w:.15,h:.2},{x:.125,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.125,y:.36666666666666664,w:.15,h:.2},{x:.175,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.175,y:.36666666666666664,w:.15,h:.2},{x:.225,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.225,y:.36666666666666664,w:.15,h:.2},{x:.275,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.275,y:.36666666666666664,w:.15,h:.2},{x:.325,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.325,y:.36666666666666664,w:.15,h:.2},{x:.375,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.375,y:.36666666666666664,w:.15,h:.2},{x:.425,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.425,y:.36666666666666664,w:.15,h:.2},{x:.475,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.475,y:.36666666666666664,w:.15,h:.2},{x:.525,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.525,y:.36666666666666664,w:.15,h:.2},{x:.575,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.575,y:.36666666666666664,w:.15,h:.2},{x:.625,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.625,y:.36666666666666664,w:.15,h:.2},{x:.675,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.675,y:.36666666666666664,w:.15,h:.2},{x:.725,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.725,y:.36666666666666664,w:.15,h:.2},{x:.775,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.775,y:.36666666666666664,w:.15,h:.2},{x:.825,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.825,y:.36666666666666664,w:.15,h:.2},{x:.875,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.875,y:.36666666666666664,w:.15,h:.2},{x:.925,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.925,y:.36666666666666664,w:.15,h:.2},{x:.975,y:.36666666666666664,w:.1,h:.13333333333333333},{x:.975,y:.36666666666666664,w:.15,h:.2},{x:.025,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.025,y:.43333333333333335,w:.15,h:.2},{x:.075,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.075,y:.43333333333333335,w:.15,h:.2},{x:.125,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.125,y:.43333333333333335,w:.15,h:.2},{x:.175,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.175,y:.43333333333333335,w:.15,h:.2},{x:.225,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.225,y:.43333333333333335,w:.15,h:.2},{x:.275,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.275,y:.43333333333333335,w:.15,h:.2},{x:.325,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.325,y:.43333333333333335,w:.15,h:.2},{x:.375,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.375,y:.43333333333333335,w:.15,h:.2},{x:.425,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.425,y:.43333333333333335,w:.15,h:.2},{x:.475,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.475,y:.43333333333333335,w:.15,h:.2},{x:.525,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.525,y:.43333333333333335,w:.15,h:.2},{x:.575,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.575,y:.43333333333333335,w:.15,h:.2},{x:.625,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.625,y:.43333333333333335,w:.15,h:.2},{x:.675,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.675,y:.43333333333333335,w:.15,h:.2},{x:.725,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.725,y:.43333333333333335,w:.15,h:.2},{x:.775,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.775,y:.43333333333333335,w:.15,h:.2},{x:.825,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.825,y:.43333333333333335,w:.15,h:.2},{x:.875,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.875,y:.43333333333333335,w:.15,h:.2},{x:.925,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.925,y:.43333333333333335,w:.15,h:.2},{x:.975,y:.43333333333333335,w:.1,h:.13333333333333333},{x:.975,y:.43333333333333335,w:.15,h:.2},{x:.025,y:.5,w:.1,h:.13333333333333333},{x:.025,y:.5,w:.15,h:.2},{x:.075,y:.5,w:.1,h:.13333333333333333},{x:.075,y:.5,w:.15,h:.2},{x:.125,y:.5,w:.1,h:.13333333333333333},{x:.125,y:.5,w:.15,h:.2},{x:.175,y:.5,w:.1,h:.13333333333333333},{x:.175,y:.5,w:.15,h:.2},{x:.225,y:.5,w:.1,h:.13333333333333333},{x:.225,y:.5,w:.15,h:.2},{x:.275,y:.5,w:.1,h:.13333333333333333},{x:.275,y:.5,w:.15,h:.2},{x:.325,y:.5,w:.1,h:.13333333333333333},{x:.325,y:.5,w:.15,h:.2},{x:.375,y:.5,w:.1,h:.13333333333333333},{x:.375,y:.5,w:.15,h:.2},{x:.425,y:.5,w:.1,h:.13333333333333333},{x:.425,y:.5,w:.15,h:.2},{x:.475,y:.5,w:.1,h:.13333333333333333},{x:.475,y:.5,w:.15,h:.2},{x:.525,y:.5,w:.1,h:.13333333333333333},{x:.525,y:.5,w:.15,h:.2},{x:.575,y:.5,w:.1,h:.13333333333333333},{x:.575,y:.5,w:.15,h:.2},{x:.625,y:.5,w:.1,h:.13333333333333333},{x:.625,y:.5,w:.15,h:.2},{x:.675,y:.5,w:.1,h:.13333333333333333},{x:.675,y:.5,w:.15,h:.2},{x:.725,y:.5,w:.1,h:.13333333333333333},{x:.725,y:.5,w:.15,h:.2},{x:.775,y:.5,w:.1,h:.13333333333333333},{x:.775,y:.5,w:.15,h:.2},{x:.825,y:.5,w:.1,h:.13333333333333333},{x:.825,y:.5,w:.15,h:.2},{x:.875,y:.5,w:.1,h:.13333333333333333},{x:.875,y:.5,w:.15,h:.2},{x:.925,y:.5,w:.1,h:.13333333333333333},{x:.925,y:.5,w:.15,h:.2},{x:.975,y:.5,w:.1,h:.13333333333333333},{x:.975,y:.5,w:.15,h:.2},{x:.025,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.025,y:.5666666666666667,w:.15,h:.2},{x:.075,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.075,y:.5666666666666667,w:.15,h:.2},{x:.125,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.125,y:.5666666666666667,w:.15,h:.2},{x:.175,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.175,y:.5666666666666667,w:.15,h:.2},{x:.225,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.225,y:.5666666666666667,w:.15,h:.2},{x:.275,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.275,y:.5666666666666667,w:.15,h:.2},{x:.325,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.325,y:.5666666666666667,w:.15,h:.2},{x:.375,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.375,y:.5666666666666667,w:.15,h:.2},{x:.425,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.425,y:.5666666666666667,w:.15,h:.2},{x:.475,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.475,y:.5666666666666667,w:.15,h:.2},{x:.525,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.525,y:.5666666666666667,w:.15,h:.2},{x:.575,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.575,y:.5666666666666667,w:.15,h:.2},{x:.625,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.625,y:.5666666666666667,w:.15,h:.2},{x:.675,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.675,y:.5666666666666667,w:.15,h:.2},{x:.725,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.725,y:.5666666666666667,w:.15,h:.2},{x:.775,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.775,y:.5666666666666667,w:.15,h:.2},{x:.825,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.825,y:.5666666666666667,w:.15,h:.2},{x:.875,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.875,y:.5666666666666667,w:.15,h:.2},{x:.925,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.925,y:.5666666666666667,w:.15,h:.2},{x:.975,y:.5666666666666667,w:.1,h:.13333333333333333},{x:.975,y:.5666666666666667,w:.15,h:.2},{x:.025,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.025,y:.6333333333333333,w:.15,h:.2},{x:.075,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.075,y:.6333333333333333,w:.15,h:.2},{x:.125,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.125,y:.6333333333333333,w:.15,h:.2},{x:.175,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.175,y:.6333333333333333,w:.15,h:.2},{x:.225,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.225,y:.6333333333333333,w:.15,h:.2},{x:.275,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.275,y:.6333333333333333,w:.15,h:.2},{x:.325,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.325,y:.6333333333333333,w:.15,h:.2},{x:.375,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.375,y:.6333333333333333,w:.15,h:.2},{x:.425,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.425,y:.6333333333333333,w:.15,h:.2},{x:.475,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.475,y:.6333333333333333,w:.15,h:.2},{x:.525,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.525,y:.6333333333333333,w:.15,h:.2},{x:.575,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.575,y:.6333333333333333,w:.15,h:.2},{x:.625,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.625,y:.6333333333333333,w:.15,h:.2},{x:.675,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.675,y:.6333333333333333,w:.15,h:.2},{x:.725,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.725,y:.6333333333333333,w:.15,h:.2},{x:.775,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.775,y:.6333333333333333,w:.15,h:.2},{x:.825,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.825,y:.6333333333333333,w:.15,h:.2},{x:.875,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.875,y:.6333333333333333,w:.15,h:.2},{x:.925,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.925,y:.6333333333333333,w:.15,h:.2},{x:.975,y:.6333333333333333,w:.1,h:.13333333333333333},{x:.975,y:.6333333333333333,w:.15,h:.2},{x:.025,y:.7,w:.1,h:.13333333333333333},{x:.025,y:.7,w:.15,h:.2},{x:.075,y:.7,w:.1,h:.13333333333333333},{x:.075,y:.7,w:.15,h:.2},{x:.125,y:.7,w:.1,h:.13333333333333333},{x:.125,y:.7,w:.15,h:.2},{x:.175,y:.7,w:.1,h:.13333333333333333},{x:.175,y:.7,w:.15,h:.2},{x:.225,y:.7,w:.1,h:.13333333333333333},{x:.225,y:.7,w:.15,h:.2},{x:.275,y:.7,w:.1,h:.13333333333333333},{x:.275,y:.7,w:.15,h:.2},{x:.325,y:.7,w:.1,h:.13333333333333333},{x:.325,y:.7,w:.15,h:.2},{x:.375,y:.7,w:.1,h:.13333333333333333},{x:.375,y:.7,w:.15,h:.2},{x:.425,y:.7,w:.1,h:.13333333333333333},{x:.425,y:.7,w:.15,h:.2},{x:.475,y:.7,w:.1,h:.13333333333333333},{x:.475,y:.7,w:.15,h:.2},{x:.525,y:.7,w:.1,h:.13333333333333333},{x:.525,y:.7,w:.15,h:.2},{x:.575,y:.7,w:.1,h:.13333333333333333},{x:.575,y:.7,w:.15,h:.2},{x:.625,y:.7,w:.1,h:.13333333333333333},{x:.625,y:.7,w:.15,h:.2},{x:.675,y:.7,w:.1,h:.13333333333333333},{x:.675,y:.7,w:.15,h:.2},{x:.725,y:.7,w:.1,h:.13333333333333333},{x:.725,y:.7,w:.15,h:.2},{x:.775,y:.7,w:.1,h:.13333333333333333},{x:.775,y:.7,w:.15,h:.2},{x:.825,y:.7,w:.1,h:.13333333333333333},{x:.825,y:.7,w:.15,h:.2},{x:.875,y:.7,w:.1,h:.13333333333333333},{x:.875,y:.7,w:.15,h:.2},{x:.925,y:.7,w:.1,h:.13333333333333333},{x:.925,y:.7,w:.15,h:.2},{x:.975,y:.7,w:.1,h:.13333333333333333},{x:.975,y:.7,w:.15,h:.2},{x:.025,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.025,y:.7666666666666667,w:.15,h:.2},{x:.075,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.075,y:.7666666666666667,w:.15,h:.2},{x:.125,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.125,y:.7666666666666667,w:.15,h:.2},{x:.175,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.175,y:.7666666666666667,w:.15,h:.2},{x:.225,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.225,y:.7666666666666667,w:.15,h:.2},{x:.275,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.275,y:.7666666666666667,w:.15,h:.2},{x:.325,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.325,y:.7666666666666667,w:.15,h:.2},{x:.375,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.375,y:.7666666666666667,w:.15,h:.2},{x:.425,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.425,y:.7666666666666667,w:.15,h:.2},{x:.475,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.475,y:.7666666666666667,w:.15,h:.2},{x:.525,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.525,y:.7666666666666667,w:.15,h:.2},{x:.575,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.575,y:.7666666666666667,w:.15,h:.2},{x:.625,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.625,y:.7666666666666667,w:.15,h:.2},{x:.675,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.675,y:.7666666666666667,w:.15,h:.2},{x:.725,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.725,y:.7666666666666667,w:.15,h:.2},{x:.775,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.775,y:.7666666666666667,w:.15,h:.2},{x:.825,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.825,y:.7666666666666667,w:.15,h:.2},{x:.875,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.875,y:.7666666666666667,w:.15,h:.2},{x:.925,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.925,y:.7666666666666667,w:.15,h:.2},{x:.975,y:.7666666666666667,w:.1,h:.13333333333333333},{x:.975,y:.7666666666666667,w:.15,h:.2},{x:.025,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.025,y:.8333333333333334,w:.15,h:.2},{x:.075,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.075,y:.8333333333333334,w:.15,h:.2},{x:.125,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.125,y:.8333333333333334,w:.15,h:.2},{x:.175,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.175,y:.8333333333333334,w:.15,h:.2},{x:.225,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.225,y:.8333333333333334,w:.15,h:.2},{x:.275,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.275,y:.8333333333333334,w:.15,h:.2},{x:.325,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.325,y:.8333333333333334,w:.15,h:.2},{x:.375,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.375,y:.8333333333333334,w:.15,h:.2},{x:.425,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.425,y:.8333333333333334,w:.15,h:.2},{x:.475,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.475,y:.8333333333333334,w:.15,h:.2},{x:.525,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.525,y:.8333333333333334,w:.15,h:.2},{x:.575,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.575,y:.8333333333333334,w:.15,h:.2},{x:.625,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.625,y:.8333333333333334,w:.15,h:.2},{x:.675,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.675,y:.8333333333333334,w:.15,h:.2},{x:.725,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.725,y:.8333333333333334,w:.15,h:.2},{x:.775,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.775,y:.8333333333333334,w:.15,h:.2},{x:.825,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.825,y:.8333333333333334,w:.15,h:.2},{x:.875,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.875,y:.8333333333333334,w:.15,h:.2},{x:.925,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.925,y:.8333333333333334,w:.15,h:.2},{x:.975,y:.8333333333333334,w:.1,h:.13333333333333333},{x:.975,y:.8333333333333334,w:.15,h:.2},{x:.025,y:.9,w:.1,h:.13333333333333333},{x:.025,y:.9,w:.15,h:.2},{x:.075,y:.9,w:.1,h:.13333333333333333},{x:.075,y:.9,w:.15,h:.2},{x:.125,y:.9,w:.1,h:.13333333333333333},{x:.125,y:.9,w:.15,h:.2},{x:.175,y:.9,w:.1,h:.13333333333333333},{x:.175,y:.9,w:.15,h:.2},{x:.225,y:.9,w:.1,h:.13333333333333333},{x:.225,y:.9,w:.15,h:.2},{x:.275,y:.9,w:.1,h:.13333333333333333},{x:.275,y:.9,w:.15,h:.2},{x:.325,y:.9,w:.1,h:.13333333333333333},{x:.325,y:.9,w:.15,h:.2},{x:.375,y:.9,w:.1,h:.13333333333333333},{x:.375,y:.9,w:.15,h:.2},{x:.425,y:.9,w:.1,h:.13333333333333333},{x:.425,y:.9,w:.15,h:.2},{x:.475,y:.9,w:.1,h:.13333333333333333},{x:.475,y:.9,w:.15,h:.2},{x:.525,y:.9,w:.1,h:.13333333333333333},{x:.525,y:.9,w:.15,h:.2},{x:.575,y:.9,w:.1,h:.13333333333333333},{x:.575,y:.9,w:.15,h:.2},{x:.625,y:.9,w:.1,h:.13333333333333333},{x:.625,y:.9,w:.15,h:.2},{x:.675,y:.9,w:.1,h:.13333333333333333},{x:.675,y:.9,w:.15,h:.2},{x:.725,y:.9,w:.1,h:.13333333333333333},{x:.725,y:.9,w:.15,h:.2},{x:.775,y:.9,w:.1,h:.13333333333333333},{x:.775,y:.9,w:.15,h:.2},{x:.825,y:.9,w:.1,h:.13333333333333333},{x:.825,y:.9,w:.15,h:.2},{x:.875,y:.9,w:.1,h:.13333333333333333},{x:.875,y:.9,w:.15,h:.2},{x:.925,y:.9,w:.1,h:.13333333333333333},{x:.925,y:.9,w:.15,h:.2},{x:.975,y:.9,w:.1,h:.13333333333333333},{x:.975,y:.9,w:.15,h:.2},{x:.025,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.025,y:.9666666666666667,w:.15,h:.2},{x:.075,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.075,y:.9666666666666667,w:.15,h:.2},{x:.125,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.125,y:.9666666666666667,w:.15,h:.2},{x:.175,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.175,y:.9666666666666667,w:.15,h:.2},{x:.225,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.225,y:.9666666666666667,w:.15,h:.2},{x:.275,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.275,y:.9666666666666667,w:.15,h:.2},{x:.325,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.325,y:.9666666666666667,w:.15,h:.2},{x:.375,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.375,y:.9666666666666667,w:.15,h:.2},{x:.425,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.425,y:.9666666666666667,w:.15,h:.2},{x:.475,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.475,y:.9666666666666667,w:.15,h:.2},{x:.525,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.525,y:.9666666666666667,w:.15,h:.2},{x:.575,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.575,y:.9666666666666667,w:.15,h:.2},{x:.625,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.625,y:.9666666666666667,w:.15,h:.2},{x:.675,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.675,y:.9666666666666667,w:.15,h:.2},{x:.725,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.725,y:.9666666666666667,w:.15,h:.2},{x:.775,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.775,y:.9666666666666667,w:.15,h:.2},{x:.825,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.825,y:.9666666666666667,w:.15,h:.2},{x:.875,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.875,y:.9666666666666667,w:.15,h:.2},{x:.925,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.925,y:.9666666666666667,w:.15,h:.2},{x:.975,y:.9666666666666667,w:.1,h:.13333333333333333},{x:.975,y:.9666666666666667,w:.15,h:.2},{x:.05,y:.06666666666666667,w:.2,h:.26666666666666666},{x:.05,y:.06666666666666667,w:.3,h:.4},{x:.15,y:.06666666666666667,w:.2,h:.26666666666666666},{x:.15,y:.06666666666666667,w:.3,h:.4},{x:.25,y:.06666666666666667,w:.2,h:.26666666666666666},{x:.25,y:.06666666666666667,w:.3,h:.4},{x:.35,y:.06666666666666667,w:.2,h:.26666666666666666},{x:.35,y:.06666666666666667,w:.3,h:.4},{x:.45,y:.06666666666666667,w:.2,h:.26666666666666666},{x:.45,y:.06666666666666667,w:.3,h:.4},{x:.55,y:.06666666666666667,w:.2,h:.26666666666666666},{x:.55,y:.06666666666666667,w:.3,h:.4},{x:.65,y:.06666666666666667,w:.2,h:.26666666666666666},{x:.65,y:.06666666666666667,w:.3,h:.4},{x:.75,y:.06666666666666667,w:.2,h:.26666666666666666},{x:.75,y:.06666666666666667,w:.3,h:.4},{x:.85,y:.06666666666666667,w:.2,h:.26666666666666666},{x:.85,y:.06666666666666667,w:.3,h:.4},{x:.95,y:.06666666666666667,w:.2,h:.26666666666666666},{x:.95,y:.06666666666666667,w:.3,h:.4},{x:.05,y:.2,w:.2,h:.26666666666666666},{x:.05,y:.2,w:.3,h:.4},{x:.15,y:.2,w:.2,h:.26666666666666666},{x:.15,y:.2,w:.3,h:.4},{x:.25,y:.2,w:.2,h:.26666666666666666},{x:.25,y:.2,w:.3,h:.4},{x:.35,y:.2,w:.2,h:.26666666666666666},{x:.35,y:.2,w:.3,h:.4},{x:.45,y:.2,w:.2,h:.26666666666666666},{x:.45,y:.2,w:.3,h:.4},{x:.55,y:.2,w:.2,h:.26666666666666666},{x:.55,y:.2,w:.3,h:.4},{x:.65,y:.2,w:.2,h:.26666666666666666},{x:.65,y:.2,w:.3,h:.4},{x:.75,y:.2,w:.2,h:.26666666666666666},{x:.75,y:.2,w:.3,h:.4},{x:.85,y:.2,w:.2,h:.26666666666666666},{x:.85,y:.2,w:.3,h:.4},{x:.95,y:.2,w:.2,h:.26666666666666666},{x:.95,y:.2,w:.3,h:.4},{x:.05,y:.3333333333333333,w:.2,h:.26666666666666666},{x:.05,y:.3333333333333333,w:.3,h:.4},{x:.15,y:.3333333333333333,w:.2,h:.26666666666666666},{x:.15,y:.3333333333333333,w:.3,h:.4},{x:.25,y:.3333333333333333,w:.2,h:.26666666666666666},{x:.25,y:.3333333333333333,w:.3,h:.4},{x:.35,y:.3333333333333333,w:.2,h:.26666666666666666},{x:.35,y:.3333333333333333,w:.3,h:.4},{x:.45,y:.3333333333333333,w:.2,h:.26666666666666666},{x:.45,y:.3333333333333333,w:.3,h:.4},{x:.55,y:.3333333333333333,w:.2,h:.26666666666666666},{x:.55,y:.3333333333333333,w:.3,h:.4},{x:.65,y:.3333333333333333,w:.2,h:.26666666666666666},{x:.65,y:.3333333333333333,w:.3,h:.4},{x:.75,y:.3333333333333333,w:.2,h:.26666666666666666},{x:.75,y:.3333333333333333,w:.3,h:.4},{x:.85,y:.3333333333333333,w:.2,h:.26666666666666666},{x:.85,y:.3333333333333333,w:.3,h:.4},{x:.95,y:.3333333333333333,w:.2,h:.26666666666666666},{x:.95,y:.3333333333333333,w:.3,h:.4},{x:.05,y:.4666666666666667,w:.2,h:.26666666666666666},{x:.05,y:.4666666666666667,w:.3,h:.4},{x:.15,y:.4666666666666667,w:.2,h:.26666666666666666},{x:.15,y:.4666666666666667,w:.3,h:.4},{x:.25,y:.4666666666666667,w:.2,h:.26666666666666666},{x:.25,y:.4666666666666667,w:.3,h:.4},{x:.35,y:.4666666666666667,w:.2,h:.26666666666666666},{x:.35,y:.4666666666666667,w:.3,h:.4},{x:.45,y:.4666666666666667,w:.2,h:.26666666666666666},{x:.45,y:.4666666666666667,w:.3,h:.4},{x:.55,y:.4666666666666667,w:.2,h:.26666666666666666},{x:.55,y:.4666666666666667,w:.3,h:.4},{x:.65,y:.4666666666666667,w:.2,h:.26666666666666666},{x:.65,y:.4666666666666667,w:.3,h:.4},{x:.75,y:.4666666666666667,w:.2,h:.26666666666666666},{x:.75,y:.4666666666666667,w:.3,h:.4},{x:.85,y:.4666666666666667,w:.2,h:.26666666666666666},{x:.85,y:.4666666666666667,w:.3,h:.4},{x:.95,y:.4666666666666667,w:.2,h:.26666666666666666},{x:.95,y:.4666666666666667,w:.3,h:.4},{x:.05,y:.6,w:.2,h:.26666666666666666},{x:.05,y:.6,w:.3,h:.4},{x:.15,y:.6,w:.2,h:.26666666666666666},{x:.15,y:.6,w:.3,h:.4},{x:.25,y:.6,w:.2,h:.26666666666666666},{x:.25,y:.6,w:.3,h:.4},{x:.35,y:.6,w:.2,h:.26666666666666666},{x:.35,y:.6,w:.3,h:.4},{x:.45,y:.6,w:.2,h:.26666666666666666},{x:.45,y:.6,w:.3,h:.4},{x:.55,y:.6,w:.2,h:.26666666666666666},{x:.55,y:.6,w:.3,h:.4},{x:.65,y:.6,w:.2,h:.26666666666666666},{x:.65,y:.6,w:.3,h:.4},{x:.75,y:.6,w:.2,h:.26666666666666666},{x:.75,y:.6,w:.3,h:.4},{x:.85,y:.6,w:.2,h:.26666666666666666},{x:.85,y:.6,w:.3,h:.4},{x:.95,y:.6,w:.2,h:.26666666666666666},{x:.95,y:.6,w:.3,h:.4},{x:.05,y:.7333333333333333,w:.2,h:.26666666666666666},{x:.05,y:.7333333333333333,w:.3,h:.4},{x:.15,y:.7333333333333333,w:.2,h:.26666666666666666},{x:.15,y:.7333333333333333,w:.3,h:.4},{x:.25,y:.7333333333333333,w:.2,h:.26666666666666666},{x:.25,y:.7333333333333333,w:.3,h:.4},{x:.35,y:.7333333333333333,w:.2,h:.26666666666666666},{x:.35,y:.7333333333333333,w:.3,h:.4},{x:.45,y:.7333333333333333,w:.2,h:.26666666666666666},{x:.45,y:.7333333333333333,w:.3,h:.4},{x:.55,y:.7333333333333333,w:.2,h:.26666666666666666},{x:.55,y:.7333333333333333,w:.3,h:.4},{x:.65,y:.7333333333333333,w:.2,h:.26666666666666666},{x:.65,y:.7333333333333333,w:.3,h:.4},{x:.75,y:.7333333333333333,w:.2,h:.26666666666666666},{x:.75,y:.7333333333333333,w:.3,h:.4},{x:.85,y:.7333333333333333,w:.2,h:.26666666666666666},{x:.85,y:.7333333333333333,w:.3,h:.4},{x:.95,y:.7333333333333333,w:.2,h:.26666666666666666},{x:.95,y:.7333333333333333,w:.3,h:.4},{x:.05,y:.8666666666666667,w:.2,h:.26666666666666666},{x:.05,y:.8666666666666667,w:.3,h:.4},{x:.15,y:.8666666666666667,w:.2,h:.26666666666666666},{x:.15,y:.8666666666666667,w:.3,h:.4},{x:.25,y:.8666666666666667,w:.2,h:.26666666666666666},{x:.25,y:.8666666666666667,w:.3,h:.4},{x:.35,y:.8666666666666667,w:.2,h:.26666666666666666},{x:.35,y:.8666666666666667,w:.3,h:.4},{x:.45,y:.8666666666666667,w:.2,h:.26666666666666666},{x:.45,y:.8666666666666667,w:.3,h:.4},{x:.55,y:.8666666666666667,w:.2,h:.26666666666666666},{x:.55,y:.8666666666666667,w:.3,h:.4},{x:.65,y:.8666666666666667,w:.2,h:.26666666666666666},{x:.65,y:.8666666666666667,w:.3,h:.4},{x:.75,y:.8666666666666667,w:.2,h:.26666666666666666},{x:.75,y:.8666666666666667,w:.3,h:.4},{x:.85,y:.8666666666666667,w:.2,h:.26666666666666666},{x:.85,y:.8666666666666667,w:.3,h:.4},{x:.95,y:.8666666666666667,w:.2,h:.26666666666666666},{x:.95,y:.8666666666666667,w:.3,h:.4},{x:.05,y:1,w:.2,h:.26666666666666666},{x:.05,y:1,w:.3,h:.4},{x:.15,y:1,w:.2,h:.26666666666666666},{x:.15,y:1,w:.3,h:.4},{x:.25,y:1,w:.2,h:.26666666666666666},{x:.25,y:1,w:.3,h:.4},{x:.35,y:1,w:.2,h:.26666666666666666},{x:.35,y:1,w:.3,h:.4},{x:.45,y:1,w:.2,h:.26666666666666666},{x:.45,y:1,w:.3,h:.4},{x:.55,y:1,w:.2,h:.26666666666666666},{x:.55,y:1,w:.3,h:.4},{x:.65,y:1,w:.2,h:.26666666666666666},{x:.65,y:1,w:.3,h:.4},{x:.75,y:1,w:.2,h:.26666666666666666},{x:.75,y:1,w:.3,h:.4},{x:.85,y:1,w:.2,h:.26666666666666666},{x:.85,y:1,w:.3,h:.4},{x:.95,y:1,w:.2,h:.26666666666666666},{x:.95,y:1,w:.3,h:.4},{x:.1,y:.13333333333333333,w:.4,h:.5333333333333333},{x:.1,y:.13333333333333333,w:.6,h:.8},{x:.1,y:.13333333333333333,w:.8,h:1},{x:.3,y:.13333333333333333,w:.4,h:.5333333333333333},{x:.3,y:.13333333333333333,w:.6,h:.8},{x:.3,y:.13333333333333333,w:.8,h:1},{x:.5,y:.13333333333333333,w:.4,h:.5333333333333333},{x:.5,y:.13333333333333333,w:.6,h:.8},{x:.5,y:.13333333333333333,w:.8,h:1},{x:.7,y:.13333333333333333,w:.4,h:.5333333333333333},{x:.7,y:.13333333333333333,w:.6,h:.8},{x:.7,y:.13333333333333333,w:.8,h:1},{x:.9,y:.13333333333333333,w:.4,h:.5333333333333333},{x:.9,y:.13333333333333333,w:.6,h:.8},{x:.9,y:.13333333333333333,w:.8,h:1},{x:.1,y:.4,w:.4,h:.5333333333333333},{x:.1,y:.4,w:.6,h:.8},{x:.1,y:.4,w:.8,h:1},{x:.3,y:.4,w:.4,h:.5333333333333333},{x:.3,y:.4,w:.6,h:.8},{x:.3,y:.4,w:.8,h:1},{x:.5,y:.4,w:.4,h:.5333333333333333},{x:.5,y:.4,w:.6,h:.8},{x:.5,y:.4,w:.8,h:1},{x:.7,y:.4,w:.4,h:.5333333333333333},{x:.7,y:.4,w:.6,h:.8},{x:.7,y:.4,w:.8,h:1},{x:.9,y:.4,w:.4,h:.5333333333333333},{x:.9,y:.4,w:.6,h:.8},{x:.9,y:.4,w:.8,h:1},{x:.1,y:.6666666666666666,w:.4,h:.5333333333333333},{x:.1,y:.6666666666666666,w:.6,h:.8},{x:.1,y:.6666666666666666,w:.8,h:1},{x:.3,y:.6666666666666666,w:.4,h:.5333333333333333},{x:.3,y:.6666666666666666,w:.6,h:.8},{x:.3,y:.6666666666666666,w:.8,h:1},{x:.5,y:.6666666666666666,w:.4,h:.5333333333333333},{x:.5,y:.6666666666666666,w:.6,h:.8},{x:.5,y:.6666666666666666,w:.8,h:1},{x:.7,y:.6666666666666666,w:.4,h:.5333333333333333},{x:.7,y:.6666666666666666,w:.6,h:.8},{x:.7,y:.6666666666666666,w:.8,h:1},{x:.9,y:.6666666666666666,w:.4,h:.5333333333333333},{x:.9,y:.6666666666666666,w:.6,h:.8},{x:.9,y:.6666666666666666,w:.8,h:1},{x:.1,y:.9333333333333333,w:.4,h:.5333333333333333},{x:.1,y:.9333333333333333,w:.6,h:.8},{x:.1,y:.9333333333333333,w:.8,h:1},{x:.3,y:.9333333333333333,w:.4,h:.5333333333333333},{x:.3,y:.9333333333333333,w:.6,h:.8},{x:.3,y:.9333333333333333,w:.8,h:1},{x:.5,y:.9333333333333333,w:.4,h:.5333333333333333},{x:.5,y:.9333333333333333,w:.6,h:.8},{x:.5,y:.9333333333333333,w:.8,h:1},{x:.7,y:.9333333333333333,w:.4,h:.5333333333333333},{x:.7,y:.9333333333333333,w:.6,h:.8},{x:.7,y:.9333333333333333,w:.8,h:1},{x:.9,y:.9333333333333333,w:.4,h:.5333333333333333},{x:.9,y:.9333333333333333,w:.6,h:.8},{x:.9,y:.9333333333333333,w:.8,h:1}];function tsvb_faceDetector_createForOfIteratorHelper(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=tsvb_faceDetector_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function tsvb_faceDetector_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return tsvb_faceDetector_arrayLikeToArray(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tsvb_faceDetector_arrayLikeToArray(t,e):void 0}}function tsvb_faceDetector_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function tsvb_faceDetector_usePreprocessData(t,e,r,n){for(var i=r*e,s=2*r*e,o=0;o<n.length/3;o++)n[0+o]=t[4*o]/127.5-1,n[i+o]=t[4*o+1]/127.5-1,n[s+o]=t[4*o+2]/127.5-1}function tsvb_faceDetector_usePostprocessData(t){for(var e=t.tensor,r=t.faceDetectorAccuracy,n=void 0===r?.85:r,i=t.outputHeight,s=void 0===i?240:i,o=t.outputWidth,a=void 0===o?320:o,u=[],l=e.boxes.data,c=e.scores.data,h=0;h<4420;h++){if(!(c[2*h+1]<=n)){var f=.1*l[4*h+0]*tsvb_priors[h].w+tsvb_priors[h].x,d=.1*l[4*h+1]*tsvb_priors[h].h+tsvb_priors[h].y,p=Math.exp(.2*l[4*h+2])*tsvb_priors[h].w,v=Math.exp(.2*l[4*h+3])*tsvb_priors[h].h,y={x1:(f-p/2)*a,y1:(d-v/2)*s,x2:(f+p/2)*a,y2:(d+v/2)*s};if(u.length){var b,_=!1,m=tsvb_faceDetector_createForOfIteratorHelper(u);try{for(m.s();!(b=m.n()).done;){if(b.value.checkSame(y)){_=!0;break}}}catch(t){m.e(t)}finally{m.f()}_||u.push(new tsvb_FaceCombiner(y))}else u.push(new tsvb_FaceCombiner(y))}}return u}function tsvb_useDrawSquare(t,e,r){if(e&&(!Array.isArray(e)||0!==e.length)){var n=t.getContext("2d");n.lineWidth=3;var i=Math.floor(255*Math.random()),s=Math.floor(255*Math.random()),o=Math.floor(255*Math.random());n.strokeStyle=null!=r?r:"rgb(".concat(i,",").concat(s,",").concat(o,")"),n.beginPath(),Array.isArray(e)?e.forEach((function(t){return n.rect(t.x1,t.y1,t.width,t.height)})):n.rect(e.x1,e.y1,e.width,e.height),n.stroke()}}function tsvb_smoother_typeof(t){return tsvb_smoother_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_smoother_typeof(t)}function tsvb_smoother_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_smoother_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_smoother_toPropertyKey(n.key),n)}}function tsvb_smoother_createClass(t,e,r){return e&&tsvb_smoother_defineProperties(t.prototype,e),r&&tsvb_smoother_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_smoother_toPropertyKey(t){var e=tsvb_smoother_toPrimitive(t,"string");return"symbol"==tsvb_smoother_typeof(e)?e:e+""}function tsvb_smoother_toPrimitive(t,e){if("object"!=tsvb_smoother_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_smoother_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_SmoothTarget=function(){return tsvb_smoother_createClass((function t(e){var r,n;tsvb_smoother_classCallCheck(this,t),this.isFinished=!0,this.startValue=e.startValue,this.currentValue=e.startValue,this.currentStep=0,this.endValue=null!==(r=e.endValue)&&void 0!==r?r:e.startValue,this.smoothPower=null!==(n=e.smoothPower)&&void 0!==n?n:1,this.smoothFunction=function(t){switch(e.smoothFunctionType){case"ease-out-sine":return Math.sin(t*Math.PI/2);case"ease-out-quint":return 1-Math.pow(1-t,5);case"ease-out-cubic":Math.pow(1-t,3);default:return t}}}),[{key:"isEnded",value:function(t){var e,r=Math.max(0,Math.min(1,null!==(e=null==t?void 0:t.percentage)&&void 0!==e?e:1));return(null==t?void 0:t.isreverse)&&(r=1-r),(null==t?void 0:t.isreverse)?this.currentStep<=this.smoothPower*r:this.currentStep>=this.smoothPower*r}},{key:"getCurrentValue",value:function(){return this.currentValue}},{key:"getEndValue",value:function(){return this.endValue}},{key:"setCurrentStep",value:function(t){this.currentStep=t}},{key:"checkEndValueChange",value:function(t){t!==this.endValue&&(this.startValue=this.currentValue,this.endValue=t,this.currentStep=1)}},{key:"useAnimationPart",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=Math.min(1,Math.max(0,t));var r=Math.max(1,Math.round(this.smoothPower*t));e?this.currentStep<r&&(this.currentStep=r):this.currentStep>r&&(this.currentStep=r)}},{key:"useSmooth",value:function(t){var e;if(this.startValue===this.endValue)return this.currentValue;var r=(null==t?void 0:t.isReverse)?-1:1,n=this.currentStep/this.smoothPower,i=this.smoothFunction(n);return this.currentValue=this.startValue+(this.endValue-this.startValue)*i,this.smoothPower=null!==(e=null==t?void 0:t.newSmoothPower)&&void 0!==e?e:this.smoothPower,this.isFinished=this.currentStep===((null==t?void 0:t.isReverse)?0:this.smoothPower),this.currentStep=Math.max(0,Math.min(this.smoothPower,this.currentStep+r)),this.currentValue}}])}();function tsvb_smartZoomEffect_typeof(t){return tsvb_smartZoomEffect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_smartZoomEffect_typeof(t)}function tsvb_smartZoomEffect_regeneratorRuntime(){tsvb_smartZoomEffect_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_smartZoomEffect_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_smartZoomEffect_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_smartZoomEffect_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_smartZoomEffect_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_smartZoomEffect_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_smartZoomEffect_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_smartZoomEffect_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_smartZoomEffect_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_smartZoomEffect_toPropertyKey(n.key),n)}}function tsvb_smartZoomEffect_createClass(t,e,r){return e&&tsvb_smartZoomEffect_defineProperties(t.prototype,e),r&&tsvb_smartZoomEffect_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_smartZoomEffect_toPropertyKey(t){var e=tsvb_smartZoomEffect_toPrimitive(t,"string");return"symbol"==tsvb_smartZoomEffect_typeof(e)?e:e+""}function tsvb_smartZoomEffect_toPrimitive(t,e){if("object"!=tsvb_smartZoomEffect_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_smartZoomEffect_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_smartZoomEffect_callSuper(t,e,r){return e=tsvb_smartZoomEffect_getPrototypeOf(e),tsvb_smartZoomEffect_possibleConstructorReturn(t,tsvb_smartZoomEffect_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_smartZoomEffect_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_smartZoomEffect_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_smartZoomEffect_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_smartZoomEffect_assertThisInitialized(t)}function tsvb_smartZoomEffect_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_smartZoomEffect_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_smartZoomEffect_isNativeReflectConstruct=function(){return!!t})()}function tsvb_smartZoomEffect_superPropGet(t,e,r,n){var i=tsvb_smartZoomEffect_get(tsvb_smartZoomEffect_getPrototypeOf(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof i?function(t){return i.apply(r,t)}:i}function tsvb_smartZoomEffect_get(){return tsvb_smartZoomEffect_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=tsvb_smartZoomEffect_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tsvb_smartZoomEffect_get.apply(null,arguments)}function tsvb_smartZoomEffect_superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tsvb_smartZoomEffect_getPrototypeOf(t)););return t}function tsvb_smartZoomEffect_getPrototypeOf(t){return tsvb_smartZoomEffect_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_smartZoomEffect_getPrototypeOf(t)}function tsvb_smartZoomEffect_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_smartZoomEffect_setPrototypeOf(t,e)}function tsvb_smartZoomEffect_setPrototypeOf(t,e){return tsvb_smartZoomEffect_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_smartZoomEffect_setPrototypeOf(t,e)}var tsvb_coordKeys=["x1","x2","y1","y2"],tsvb_SmartZoomEffect=function(t){function e(t,r){var n;return tsvb_smartZoomEffect_classCallCheck(this,e),(n=tsvb_smartZoomEffect_callSuper(this,e,[t])).faceCoord={},n.inWork=!1,n.bufferPool=new tsvb_BufferPool,n.pixels=[],n.customer_id=r,n.config=Object.assign({},tsvb_smart_zoom_config),n.filterMirror=new tsvb_FilterMirror,n}return tsvb_smartZoomEffect_inherits(e,tsvb_AbstractEffect),tsvb_smartZoomEffect_createClass(e,[{key:"init",value:(i=tsvb_smartZoomEffect_asyncToGenerator(tsvb_smartZoomEffect_regeneratorRuntime().mark((function t(e){return tsvb_smartZoomEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.inference=e,t.next=3,this.inference.sessionManager.init(this.customer_id,tsvb_ModelType.FACEDETECTOR);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"nextFrame",value:function(t){if(this.enabled&&!(this.pixels.length>1)){this.small.addTexture("frame",t.texture),this.small.activateTexture("frame"),this.resources.mirror&&(this.small.frame.filters=[this.filterMirror]),this.resources.renderer.renderTo(this.small.frame,this.small.getBuffer("model")),this.small.frame.filters=[],this.small.activateTexture("origin");var e=this.small.getBuffer("model");this.pixels.push(this.resources.renderer.pixelsAsync(e,{pool:this.bufferPool}))}}},{key:"prepare",value:function(){var t=this,e=this.config,r=e.modelHeight,n=e.modelWidth,i=e.smoothPower;this.globalWidth=this.sdkOptions.width,this.globalHeight=this.sdkOptions.height,this.original=new tsvb_Frame(this.resources.texture,{width:this.globalWidth,height:this.globalHeight}),this.original.addBuffer("result"),this.small=new tsvb_Frame(this.resources.texture,{width:n,height:r}),this.small.addBuffer("model"),this.scaleValue=1,this.xOffset=0,this.yOffset=0;var s=this.defaultFaceCoord(),o={};tsvb_coordKeys.forEach((function(e){t.faceCoord[e]=new tsvb_SmoothTarget({startValue:s[e],smoothPower:i}),o[e]=t.faceCoord[e].getCurrentValue()})),this.currentFace=new tsvb_FaceCombiner(o),this.sdkOptions.on("update",this.onOptionsUpdate,this)}},{key:"onOptionsUpdate",value:function(){this.globalWidth=this.sdkOptions.width,this.globalHeight=this.sdkOptions.height,this.original.resize(this.globalWidth,this.globalHeight),this.scaleValue=1,this.xOffset=0,this.yOffset=0}},{key:"process",value:(n=tsvb_smartZoomEffect_asyncToGenerator(tsvb_smartZoomEffect_regeneratorRuntime().mark((function t(){var e=arguments;return tsvb_smartZoomEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled){t.next=2;break}return t.abrupt("return");case 2:this.fps=e[1]||1,this.updateWaiter(),this.findFaces(),this.setCurrentFace(),this.calcScale(),this.calcOffset(),this.setTransfrom(),this.original.frame.setTransform(this.xOffset,this.yOffset,this.scaleValue,this.scaleValue),this.resources.renderer.renderTo(this.original.frame,this.original.getBuffer("result")),this.resources.texture.update(this.original.getBuffer("result"),!1);case 12:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"getFaces",value:function(){return this.enabled?this.faces:[]}},{key:"setCurrentFace",value:function(){var t,e=this;(null===(t=this.faces)||void 0===t?void 0:t.length)?this.checkCurrentFace():this.noFaceWay();var r={};tsvb_coordKeys.forEach((function(t){e.faceCoord[t].useSmooth({newSmoothPower:e.config.smoothPower}),r[t]=e.faceCoord[t].getCurrentValue()})),this.currentFace=new tsvb_FaceCombiner(r),this.config.isFaceSquareDrawingEnabled,this.config.isPreFaceSquareDrawingEnabled}},{key:"checkCurrentFace",value:function(){var t=this;this.updateWaiter(!0);var e=this.faces.reduce((function(t,e){return e.getSquare()>t.getSquare()&&(t=e),t}),this.faces[0]),r=this.config.sensitivityValue/this.scaleValue;if(!e.isEqual(this.currentFace,r,this.globalHeight,this.globalWidth)){var n=e.getCoord();tsvb_coordKeys.forEach((function(e){t.faceCoord[e].checkEndValueChange(n[e])}))}}},{key:"noFaceWay",value:function(){var t=this;if(this.waiter.value>0)return this.waiter.value--,void this.updateWaiter(!1);var e=this.defaultFaceCoord();tsvb_coordKeys.forEach((function(r){t.faceCoord[r].checkEndValueChange(e[r])})),this.updateWaiter(!0)}},{key:"calcScale",value:function(){var t=this.globalHeight*this.globalWidth,e=this.currentFace.getSquare()/t,r=this.config.faceAreaProportion/e;this.scaleValue=Math.sqrt(Math.max(r,1))}},{key:"calcOffset",value:function(){var t=this,e=this.currentFace.getCenter(),r={x:{faceCenter:e.x,newOffset:0,base:this.globalWidth},y:{faceCenter:e.y,newOffset:0,base:this.globalHeight}};Object.values(r).forEach((function(e){var r=(t.scaleValue-1)/2*e.base,n=(e.base/2-e.faceCenter)*t.scaleValue,i=(t.scaleValue-1)*e.base,s=Math.max(n-r,-i);e.newOffset=Math.min(0,s)})),this.xOffset=r.x.newOffset,this.yOffset=r.y.newOffset}},{key:"defaultFaceCoord",value:function(){var t=this.globalWidth/2,e=this.globalHeight/2,r=t*Math.sqrt(this.config.faceAreaProportion),n=e*Math.sqrt(this.config.faceAreaProportion);return{x1:t-r,x2:t+r,y1:e-n,y2:e+n}}},{key:"updateWaiter",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]||!this.waiter?this.waiter={value:this.fps*this.config.waiterSeconds,fps:this.fps}:(this.waiter.value=this.waiter.value/this.waiter.fps*this.fps,this.waiter.fps=this.fps)}},{key:"findFaces",value:(r=tsvb_smartZoomEffect_asyncToGenerator(tsvb_smartZoomEffect_regeneratorRuntime().mark((function t(){var e,r,n,i,s,o,a,u=this;return tsvb_smartZoomEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.inWork){t.next=2;break}return t.abrupt("return");case 2:if(this.checkTimer()){t.next=4;break}return t.abrupt("return");case 4:if(this.pixels.length){t.next=6;break}return t.abrupt("return");case 6:return this.inWork=!0,e=this.config,r=e.faceDetectorAccuracy,n=e.modelHeight,i=e.modelWidth,t.next=10,this.pixels.shift();case 10:return s=t.sent,o=this.bufferPool.getBuffer("f32",3*i*n),tsvb_faceDetector_usePreprocessData(s,i,n,o),this.bufferPool.returnBuffer(s),a={scores:{data:this.bufferPool.getBuffer("f32",8840),dims:[1,4420,2]},boxes:{data:this.bufferPool.getBuffer("f32",17680),dims:[1,4420,4]}},t.abrupt("return",this.inference.run(o,i,n,tsvb_ModelType.FACEDETECTOR,a).then((function(t){u.bufferPool.returnBuffer(t.inputBack.data),u.faces=tsvb_faceDetector_usePostprocessData({tensor:t,faceDetectorAccuracy:r,outputHeight:u.globalHeight,outputWidth:u.globalWidth}),u.bufferPool.returnBuffer(t.boxes.data),u.bufferPool.returnBuffer(t.scores.data)})).catch((function(t){var e;tsvb_errorBus.bv.notify({message:null!==(e=t.message)&&void 0!==e?e:t,emitter:tsvb_errorBus.JK.EFFECT_SMART_ZOOM,cause:t})})).finally((function(){u.inWork=!1})));case 16:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"enable",value:function(){tsvb_smartZoomEffect_superPropGet(e,"enable",this,3)([]),this.setTransfrom()}},{key:"setTransfrom",value:function(){this.resources.transform={xOffset:this.xOffset,yOffset:this.yOffset,scaleValue:this.scaleValue}}},{key:"disable",value:function(){tsvb_smartZoomEffect_superPropGet(e,"disable",this,3)([]),this.resources.transform=null,this.scaleValue=1,this.xOffset=0,this.yOffset=0,this.bufferPool=new tsvb_BufferPool}},{key:"clearBuffers",value:function(){this.pixels=[]}},{key:"setConfig",value:function(t,e){this.config[t]=e}},{key:"checkTimer",value:function(){return this.faceDetectorTimer?(performance.now()-this.faceDetectorTimer<this.config.faceDetectorPediod_ms||(this.faceDetectorTimer=0),!1):(this.faceDetectorTimer=performance.now(),!0)}},{key:"destroy",value:function(){this.sdkOptions.off("update",this.onOptionsUpdate,this)}}]);var r,n,i}();function tsvb_CustomResolutionEffects_typeof(t){return tsvb_CustomResolutionEffects_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_CustomResolutionEffects_typeof(t)}function tsvb_CustomResolutionEffects_regeneratorRuntime(){tsvb_CustomResolutionEffects_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_CustomResolutionEffects_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_CustomResolutionEffects_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_CustomResolutionEffects_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_CustomResolutionEffects_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_CustomResolutionEffects_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_CustomResolutionEffects_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_CustomResolutionEffects_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_CustomResolutionEffects_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_CustomResolutionEffects_toPropertyKey(n.key),n)}}function tsvb_CustomResolutionEffects_createClass(t,e,r){return e&&tsvb_CustomResolutionEffects_defineProperties(t.prototype,e),r&&tsvb_CustomResolutionEffects_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_CustomResolutionEffects_toPropertyKey(t){var e=tsvb_CustomResolutionEffects_toPrimitive(t,"string");return"symbol"==tsvb_CustomResolutionEffects_typeof(e)?e:e+""}function tsvb_CustomResolutionEffects_toPrimitive(t,e){if("object"!=tsvb_CustomResolutionEffects_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_CustomResolutionEffects_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_CustomResolutionEffects_callSuper(t,e,r){return e=tsvb_CustomResolutionEffects_getPrototypeOf(e),tsvb_CustomResolutionEffects_possibleConstructorReturn(t,tsvb_CustomResolutionEffects_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_CustomResolutionEffects_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_CustomResolutionEffects_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_CustomResolutionEffects_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_CustomResolutionEffects_assertThisInitialized(t)}function tsvb_CustomResolutionEffects_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_CustomResolutionEffects_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_CustomResolutionEffects_isNativeReflectConstruct=function(){return!!t})()}function tsvb_CustomResolutionEffects_getPrototypeOf(t){return tsvb_CustomResolutionEffects_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_CustomResolutionEffects_getPrototypeOf(t)}function tsvb_CustomResolutionEffects_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_CustomResolutionEffects_setPrototypeOf(t,e)}function tsvb_CustomResolutionEffects_setPrototypeOf(t,e){return tsvb_CustomResolutionEffects_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_CustomResolutionEffects_setPrototypeOf(t,e)}var tsvb_CustomResolution=function(t){function e(t){return tsvb_CustomResolutionEffects_classCallCheck(this,e),tsvb_CustomResolutionEffects_callSuper(this,e,[t])}return tsvb_CustomResolutionEffects_inherits(e,tsvb_AbstractEffect),tsvb_CustomResolutionEffects_createClass(e,[{key:"prepare",value:function(){var t=this.resources.texture;this.original=new tsvb_Frame(t,{width:this.sdkOptions.width,height:this.sdkOptions.height}),this.original.addBuffer("result"),this.sdkOptions.on("update",this.onOptionsUpdate,this)}},{key:"onOptionsUpdate",value:function(){this.sdkOptions.isCustomSize()?(this.original.resize(this.sdkOptions.width,this.sdkOptions.height),this.enable()):this.disable()}},{key:"process",value:(r=tsvb_CustomResolutionEffects_asyncToGenerator(tsvb_CustomResolutionEffects_regeneratorRuntime().mark((function t(){return tsvb_CustomResolutionEffects_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled){t.next=2;break}return t.abrupt("return");case 2:this.resources.renderer.renderTo(this.original.frame,this.original.getBuffer("result")),this.resources.texture.update(this.original.getBuffer("result"),!1);case 4:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"destroy",value:function(){this.sdkOptions.off("update",this.onOptionsUpdate,this)}}]);var r}();function tsvb_component_typeof(t){return tsvb_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_component_typeof(t)}function tsvb_component_slicedToArray(t,e){return tsvb_component_arrayWithHoles(t)||tsvb_component_iterableToArrayLimit(t,e)||tsvb_component_unsupportedIterableToArray(t,e)||tsvb_component_nonIterableRest()}function tsvb_component_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tsvb_component_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return tsvb_component_arrayLikeToArray(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tsvb_component_arrayLikeToArray(t,e):void 0}}function tsvb_component_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function tsvb_component_iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,s,o,a=[],u=!0,l=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=s.call(r)).done)&&(a.push(n.value),a.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function tsvb_component_arrayWithHoles(t){if(Array.isArray(t))return t}function tsvb_component_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_component_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_component_toPropertyKey(n.key),n)}}function tsvb_component_createClass(t,e,r){return e&&tsvb_component_defineProperties(t.prototype,e),r&&tsvb_component_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_component_toPropertyKey(t){var e=tsvb_component_toPrimitive(t,"string");return"symbol"==tsvb_component_typeof(e)?e:e+""}function tsvb_component_toPrimitive(t,e){if("object"!=tsvb_component_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_component_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_Component=function(){return tsvb_component_createClass((function t(e,r){tsvb_component_classCallCheck(this,t),this.options={},this.sdkOptions=e,this.container=new src_tsvb_Container,this.setOptions(r)}),[{key:"setOptions",value:function(t){var e=this;t&&Object.entries(t).forEach((function(t){var r=tsvb_component_slicedToArray(t,2),n=r[0],i=r[1];e.options[n]=i}))}},{key:"show",value:function(){this.beforeShowFunction&&this.beforeShowFunction(),this.container.visible=!0,this.afterShowFunction&&this.afterShowFunction()}},{key:"hide",value:function(){this.beforeHideFunction&&this.beforeHideFunction(),this.container.visible=!1,this.afterHideFunction&&this.afterHideFunction()}},{key:"onBeforeShow",value:function(t){"function"==typeof t&&(this.beforeShowFunction=t)}},{key:"onAfterShow",value:function(t){"function"==typeof t&&(this.afterShowFunction=t)}},{key:"onBeforeHide",value:function(t){"function"==typeof t&&(this.beforeHideFunction=t)}},{key:"onAfterHide",value:function(t){"function"==typeof t&&(this.afterHideFunction=t)}},{key:"isVisible",value:function(){return this.container.visible}},{key:"getOptions",value:function(){return this.options}},{key:"destroy",value:function(){this.container.destroy(!0)}},{key:"px",value:function(t){return this.sdkOptions.width/640*t}},{key:"render",value:function(){}}])}(),tsvb_componentsProxyHandler={set:function(t,e,r){return r instanceof tsvb_Component?"_"!==e[0]?Reflect.set(t,e,r):t.hasOwnProperty(e)?void 0!==t[e]?(tsvb_errorBus.bv.notify({type:tsvb_errorBus.By.WARNING,message:"You can't overwrite service component '".concat(e,"' (components that begin with a '_' character)"),emitter:tsvb_errorBus.JK.COMPONENTS_SYSTEM}),!1):Reflect.set(t,e,r):(tsvb_errorBus.bv.notify({type:tsvb_errorBus.By.WARNING,message:"The component ID('".concat(e,"') cannot begin with the character '_', this case reserved for service components."),emitter:tsvb_errorBus.JK.COMPONENTS_SYSTEM}),!1):(tsvb_errorBus.bv.notify({type:tsvb_errorBus.By.WARNING,message:"Wrong assigned value",emitter:tsvb_errorBus.JK.COMPONENTS_SYSTEM}),!1)},get:function(t,e,r){if("_getSortedComponentsArr"===e){var n=[],i=[];return Object.keys(t).forEach((function(e){t[e]&&("_"===e[0]?i.push(t[e]):n.push(t[e]))})),n.concat(i)}return Reflect.get(t,e,r)}},tsvb_stats=__webpack_require__(6739);function tsvb_overlaySprite_typeof(t){return tsvb_overlaySprite_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_overlaySprite_typeof(t)}function tsvb_overlaySprite_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_overlaySprite_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_overlaySprite_toPropertyKey(n.key),n)}}function tsvb_overlaySprite_createClass(t,e,r){return e&&tsvb_overlaySprite_defineProperties(t.prototype,e),r&&tsvb_overlaySprite_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_overlaySprite_toPropertyKey(t){var e=tsvb_overlaySprite_toPrimitive(t,"string");return"symbol"==tsvb_overlaySprite_typeof(e)?e:e+""}function tsvb_overlaySprite_toPrimitive(t,e){if("object"!=tsvb_overlaySprite_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_overlaySprite_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_OverlaySprite=function(){return tsvb_overlaySprite_createClass((function t(e,r,n){tsvb_overlaySprite_classCallCheck(this,t),this.sprite=tsvb_Sprite.from(e),this.sprite.width=null!=r?r:this.sprite.texture.baseTexture.width,this.sprite.height=null!=n?n:this.sprite.texture.baseTexture.height,this.ratio=this.sprite.width/this.sprite.height}),[{key:"destroy",value:function(){var t,e;null===(e=null===(t=this.sprite)||void 0===t?void 0:t.texture)||void 0===e||e.destroy(!0)}}])}();function tsvb_overlayScreen_regeneratorRuntime(){tsvb_overlayScreen_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_overlayScreen_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_overlayScreen_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_overlayScreen_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_overlayScreen_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_overlayScreen_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_overlayScreen_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_overlayScreen_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_overlayScreen_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_overlayScreen_toPropertyKey(n.key),n)}}function tsvb_overlayScreen_createClass(t,e,r){return e&&tsvb_overlayScreen_defineProperties(t.prototype,e),r&&tsvb_overlayScreen_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_overlayScreen_toPropertyKey(t){var e=tsvb_overlayScreen_toPrimitive(t,"string");return"symbol"==tsvb_overlayScreen_typeof(e)?e:e+""}function tsvb_overlayScreen_toPrimitive(t,e){if("object"!=tsvb_overlayScreen_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_overlayScreen_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_overlayScreen_callSuper(t,e,r){return e=tsvb_overlayScreen_getPrototypeOf(e),tsvb_overlayScreen_possibleConstructorReturn(t,tsvb_overlayScreen_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_overlayScreen_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_overlayScreen_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_overlayScreen_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_overlayScreen_assertThisInitialized(t)}function tsvb_overlayScreen_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_overlayScreen_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_overlayScreen_isNativeReflectConstruct=function(){return!!t})()}function tsvb_overlayScreen_superPropGet(t,e,r,n){var i=tsvb_overlayScreen_get(tsvb_overlayScreen_getPrototypeOf(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof i?function(t){return i.apply(r,t)}:i}function tsvb_overlayScreen_get(){return tsvb_overlayScreen_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=tsvb_overlayScreen_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tsvb_overlayScreen_get.apply(null,arguments)}function tsvb_overlayScreen_superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tsvb_overlayScreen_getPrototypeOf(t)););return t}function tsvb_overlayScreen_getPrototypeOf(t){return tsvb_overlayScreen_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_overlayScreen_getPrototypeOf(t)}function tsvb_overlayScreen_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_overlayScreen_setPrototypeOf(t,e)}function tsvb_overlayScreen_setPrototypeOf(t,e){return tsvb_overlayScreen_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_overlayScreen_setPrototypeOf(t,e)}function tsvb_overlayScreen_typeof(t){return tsvb_overlayScreen_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_overlayScreen_typeof(t)}var src_tsvb_decorate=function(t,e,r,n){var i,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"===("undefined"==typeof Reflect?"undefined":tsvb_overlayScreen_typeof(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,r,o):i(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},src_tsvb_metadata=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":tsvb_overlayScreen_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tsvb_OverlayScreen=function(t){function e(t,r){var n;return tsvb_overlayScreen_classCallCheck(this,e),(n=tsvb_overlayScreen_callSuper(this,e,[t,r])).isVideo=!1,n.hide(),n.render(),n}return tsvb_overlayScreen_inherits(e,tsvb_Component),tsvb_overlayScreen_createClass(e,[{key:"render",value:function(){var t=this;this.container.removeChildren(),this.defaultOverlaySprite=new tsvb_OverlaySprite(tsvb_Texture_Texture.WHITE,1920,1280),this.initOverlayFromUrl(this.options).finally((function(){return t.setOverlayImage()}))}},{key:"show",value:function(){this.switchVideoTexture(!0),tsvb_overlayScreen_superPropGet(e,"show",this,3)([])}},{key:"hide",value:function(){tsvb_overlayScreen_superPropGet(e,"hide",this,3)([]),this.switchVideoTexture(!1)}},{key:"initOverlayFromUrl",value:(i=tsvb_overlayScreen_asyncToGenerator(tsvb_overlayScreen_regeneratorRuntime().mark((function t(e){return tsvb_overlayScreen_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.loadImage(null==e?void 0:e.url).then((function(){var t;return null===(t=null==e?void 0:e.promise)||void 0===t?void 0:t.resolve()})).catch((function(t){var r;return null===(r=null==e?void 0:e.promise)||void 0===r?void 0:r.reject(t)})).finally((function(){return null==e||delete e.promise})));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"setOptions",value:(n=tsvb_overlayScreen_asyncToGenerator(tsvb_overlayScreen_regeneratorRuntime().mark((function t(e){return tsvb_overlayScreen_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:this.loadImage(e.url).then((function(){var t;return null===(t=e.promise)||void 0===t?void 0:t.resolve()})).catch((function(t){var r;return null===(r=e.promise)||void 0===r?void 0:r.reject(t)})).finally((function(){return null==e||delete e.promise}));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"setOverlayImage",value:function(){var t,e=null!==(t=this.loadedOverlaySprite)&&void 0!==t?t:this.defaultOverlaySprite,r=e.sprite,n=e.ratio,i=this.sdkOptions.width,s=this.sdkOptions.height,o=i/s-n,a=r.width;r.width=o>0?i:i-i*o,r.height=r.height*r.width/a,r.anchor.set(.5-i/r.width/2,.5-s/r.height/2),this.container.addChild(r)}},{key:"loadImage",value:(r=tsvb_overlayScreen_asyncToGenerator(tsvb_overlayScreen_regeneratorRuntime().mark((function t(e){var r=this;return tsvb_overlayScreen_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Invalid url");case 2:if(this.currentURL!==e&&this.processedURL!==e){t.next=4;break}throw new Error("Same url");case 4:return this.processedURL=e,t.next=7,fetch(e,{method:"HEAD"}).then((function(t){if(!t.ok)throw new Error("Overlay Screen: Image loading error")})).catch((function(t){throw tsvb_errorBus.bv.notify({type:tsvb_errorBus.By.WARNING,message:'OverlayScreen image loading error [url = "'.concat(e,'"]. Error: ').concat(t),emitter:tsvb_errorBus.JK.COMPONENTS_SYSTEM,cause:t}),new Error("Overlay Screen: Image loading error")}));case 7:tsvb_Texture_Texture.fromURL(e).then((function(t){var n,i;r.isVideo=(null===(n=t.baseTexture.resource)||void 0===n?void 0:n.source)instanceof HTMLVideoElement,r.resource=t.baseTexture.resource,r.isVideo&&(r.resource.source.loop=!0,r.resource.source.autoplay=!1,r.container.visible&&r.resource.source.play(),r.resource.source.loop=!0,r.resource.source.muted=!0),r.container.removeChildren(),null===(i=r.loadedOverlaySprite)||void 0===i||i.destroy(),r.loadedOverlaySprite=new tsvb_OverlaySprite(t),r.currentURL=e})).catch((function(t){throw tsvb_errorBus.bv.notify({type:tsvb_errorBus.By.WARNING,message:'OverlayScreen image loading error [url = "'.concat(e,'"]. Error: ').concat(t),emitter:tsvb_errorBus.JK.COMPONENTS_SYSTEM,cause:t}),new Error("Overlay Screen: Image loading error")})).finally((function(){r.setOverlayImage(),r.processedURL=""}));case 8:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"switchVideoTexture",value:function(t){if(this.isVideo)return t?(this.resource.source.currentTime=0,void this.resource.source.play()):void this.resource.source.pause()}}]);var r,n,i}();function tsvb_prefetch_typeof(t){return tsvb_prefetch_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_prefetch_typeof(t)}function tsvb_prefetch_regeneratorRuntime(){tsvb_prefetch_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_prefetch_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_prefetch_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_prefetch_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_prefetch_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_prefetch_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_prefetch_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_prefetch(t){return src_tsvb_prefetch.apply(this,arguments)}function src_tsvb_prefetch(){return(src_tsvb_prefetch=tsvb_prefetch_asyncToGenerator(tsvb_prefetch_regeneratorRuntime().mark((function t(e){return tsvb_prefetch_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,{method:"HEAD"});case 2:if(t.sent.ok){t.next=5;break}throw new Error("Url is not available");case 5:return t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function tsvb_positionHelper_typeof(t){return tsvb_positionHelper_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_positionHelper_typeof(t)}function tsvb_positionHelper_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_positionHelper_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_positionHelper_toPropertyKey(n.key),n)}}function tsvb_positionHelper_createClass(t,e,r){return e&&tsvb_positionHelper_defineProperties(t.prototype,e),r&&tsvb_positionHelper_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_positionHelper_toPropertyKey(t){var e=tsvb_positionHelper_toPrimitive(t,"string");return"symbol"==tsvb_positionHelper_typeof(e)?e:e+""}function tsvb_positionHelper_toPrimitive(t,e){if("object"!=tsvb_positionHelper_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_positionHelper_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}src_tsvb_decorate([(0,tsvb_stats.kc)("overlayScreen"),src_tsvb_metadata("design:type",Function),src_tsvb_metadata("design:paramtypes",[]),src_tsvb_metadata("design:returntype",void 0)],tsvb_OverlayScreen.prototype,"show",null),src_tsvb_decorate([(0,tsvb_stats.kc)("overlayScreen"),src_tsvb_metadata("design:type",Function),src_tsvb_metadata("design:paramtypes",[]),src_tsvb_metadata("design:returntype",void 0)],tsvb_OverlayScreen.prototype,"hide",null);var tsvb_PositionHelper=function(){return tsvb_positionHelper_createClass((function t(){tsvb_positionHelper_classCallCheck(this,t)}),null,[{key:"calcPosition",value:function(t,e,r,n){return"custom"===r.placement?this.getCustomPosition(t,e,r.x,r.y):this.getPositionFromPlacement(t,e,r.placement,n)}},{key:"getPositionFromPlacement",value:function(t,e,r,n){var i=n.height,s=n.width,o=t,a=e,u={x:0,y:0};return"center"==r?(u.x=(o-s)/2,u.y=(a-i)/2,u):(r.endsWith("right")&&(u.x=o-s),r.startsWith("bottom")&&(u.y=a-i),u)}},{key:"getCustomPosition",value:function(t,e,r,n){return{x:t*r,y:e*n}}}])}();function tsvb_watermark_typeof(t){return tsvb_watermark_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_watermark_typeof(t)}function tsvb_watermark_regeneratorRuntime(){tsvb_watermark_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_watermark_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_watermark_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_watermark_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_watermark_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_watermark_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_watermark_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_watermark_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_watermark_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_watermark_toPropertyKey(n.key),n)}}function tsvb_watermark_createClass(t,e,r){return e&&tsvb_watermark_defineProperties(t.prototype,e),r&&tsvb_watermark_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_watermark_toPropertyKey(t){var e=tsvb_watermark_toPrimitive(t,"string");return"symbol"==tsvb_watermark_typeof(e)?e:e+""}function tsvb_watermark_toPrimitive(t,e){if("object"!=tsvb_watermark_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_watermark_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_watermark_callSuper(t,e,r){return e=tsvb_watermark_getPrototypeOf(e),tsvb_watermark_possibleConstructorReturn(t,tsvb_watermark_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_watermark_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_watermark_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_watermark_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_watermark_assertThisInitialized(t)}function tsvb_watermark_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_watermark_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_watermark_isNativeReflectConstruct=function(){return!!t})()}function tsvb_watermark_getPrototypeOf(t){return tsvb_watermark_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_watermark_getPrototypeOf(t)}function tsvb_watermark_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_watermark_setPrototypeOf(t,e)}function tsvb_watermark_setPrototypeOf(t,e){return tsvb_watermark_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_watermark_setPrototypeOf(t,e)}var tsvb_defaultOptions=function(){return{url:"",position:{placement:"top-left",x:0,y:0},size:.05}},tsvb_Watermark=function(t){function e(t,r){var n;return tsvb_watermark_classCallCheck(this,e),(n=tsvb_watermark_callSuper(this,e,[t])).sprite=new tsvb_Sprite,n.sprite.visible=!1,n.container.addChild(n.sprite),n.setOptions(Object.assign(tsvb_defaultOptions(),r)),n}return tsvb_watermark_inherits(e,tsvb_Component),tsvb_watermark_createClass(e,[{key:"setOptions",value:function(t){(null==t?void 0:t.size)&&this.setSize(t.size),(null==t?void 0:t.position)&&this.setPosition(t.position),(null==t?void 0:t.url)&&this.setURL(t.url)}},{key:"setURL",value:(r=tsvb_watermark_asyncToGenerator(tsvb_watermark_regeneratorRuntime().mark((function t(e){var r=this;return tsvb_watermark_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.options.url!==e){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",tsvb_prefetch(e).then((function(){return tsvb_Texture_Texture.fromURL(e)})).then((function(t){r.sprite.visible=!0,r.sprite.texture=t,r.sprite.height=r.sdkOptions.height*r.options.size,r.sprite.width=t.width/t.height*r.sprite.height,r.options.url=e,r.sprite.visible=!0})).catch((function(t){var e;tsvb_errorBus.bv.notify({message:null!==(e=null==t?void 0:t.message)&&void 0!==e?e:t,emitter:tsvb_errorBus.JK.COMPONENTS_SYSTEM,cause:t})})));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"setSize",value:function(t){this.options.size=Math.min(1,Math.max(.01,t));var e=this.sprite.width/this.sprite.height;this.sprite.height=this.sdkOptions.height*this.options.size,this.sprite.width=this.sprite.height*e,this.options.position&&"custom"!==this.options.position.placement&&this.setPosition(this.options.position)}},{key:"setPosition",value:function(t){this.options.position=t;var e={width:this.sprite.width,height:this.sprite.height},r=tsvb_PositionHelper.calcPosition(this.sdkOptions.width,this.sdkOptions.height,t,e),n=r.x,i=r.y;this.sprite.position.x=n,this.sprite.position.y=i}},{key:"clear",value:function(){this.sprite.visible=!1}},{key:"render",value:function(){this.setSize(this.options.size),this.setPosition(this.options.position)}}]);var r}();function tsvb_stickerSprite_typeof(t){return tsvb_stickerSprite_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_stickerSprite_typeof(t)}function tsvb_stickerSprite_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_stickerSprite_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_stickerSprite_toPropertyKey(n.key),n)}}function tsvb_stickerSprite_createClass(t,e,r){return e&&tsvb_stickerSprite_defineProperties(t.prototype,e),r&&tsvb_stickerSprite_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_stickerSprite_toPropertyKey(t){var e=tsvb_stickerSprite_toPrimitive(t,"string");return"symbol"==tsvb_stickerSprite_typeof(e)?e:e+""}function tsvb_stickerSprite_toPrimitive(t,e){if("object"!=tsvb_stickerSprite_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_stickerSprite_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_StickerSprite=function(){return tsvb_stickerSprite_createClass((function t(e,r){var n;tsvb_stickerSprite_classCallCheck(this,t),this.sdkOptions=e,this.sprite=r.sprite,this.id=r.id,this.player=r.player,this.canvas=r.canvas,this.aminationPhase=null!==(n=r.aminationPhase)&&void 0!==n?n:"static",this.sprite.alpha=0,this.shrink=Math.max(0,Math.min(1,r.shrink)),this.sourceRatio=this.sprite.texture.baseTexture.width/this.sprite.texture.baseTexture.height,this.setSpriteSize(r.size),this.sprite.height=this.height*this.shrink,this.sprite.width=this.width*this.shrink}),[{key:"isShowing",value:function(){return"showing"===this.aminationPhase}},{key:"isStatic",value:function(){return"static"===this.aminationPhase}},{key:"isHidingStop",value:function(){return 0===this.sprite.alpha}},{key:"animateAlpha",value:function(t){this.isStatic()||(this.sprite.alpha=this.isShowing()?Math.min(this.sprite.alpha+t,1):Math.max(this.sprite.alpha-t,0),1!==this.sprite.alpha&&0!==this.sprite.alpha||(this.aminationPhase="static"))}},{key:"animateSize",value:function(t){if(!this.isStatic()){var e=this.height*t*(1-this.shrink),r=this.width*t*(1-this.shrink);this.sprite.height=this.isShowing()?Math.min(this.sprite.height+e,this.height):Math.max(this.sprite.height-e,this.height*this.shrink),this.sprite.width=this.isShowing()?Math.min(this.sprite.width+r,this.width):Math.max(this.sprite.width-r,this.width*this.shrink)}}},{key:"animatePosition",value:function(t){this.isStatic()||(this.sprite.position.x=t.x+(this.width-this.sprite.width)/2,this.sprite.position.y=t.y+(this.height-this.sprite.height)/2)}},{key:"reset",value:function(){this.sprite.height=this.height*this.shrink,this.sprite.width=this.width*this.shrink,this.sprite.alpha=0}},{key:"setSpriteSize",value:function(t){this.height=this.sdkOptions.height*(null!=t?t:.3),this.width=this.height*this.sourceRatio,this.sprite.height=this.height,this.sprite.width=this.width}}])}(),tsvb_lib=__webpack_require__(3161),tsvb_lib_default=__webpack_require__.n(tsvb_lib);function tsvb_stickers_regeneratorRuntime(){tsvb_stickers_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_stickers_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_stickers_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_stickers_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_stickers_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_stickers_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_stickers_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_stickers_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_stickers_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_stickers_toPropertyKey(n.key),n)}}function tsvb_stickers_createClass(t,e,r){return e&&tsvb_stickers_defineProperties(t.prototype,e),r&&tsvb_stickers_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_stickers_toPropertyKey(t){var e=tsvb_stickers_toPrimitive(t,"string");return"symbol"==tsvb_stickers_typeof(e)?e:e+""}function tsvb_stickers_toPrimitive(t,e){if("object"!=tsvb_stickers_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_stickers_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_stickers_callSuper(t,e,r){return e=tsvb_stickers_getPrototypeOf(e),tsvb_stickers_possibleConstructorReturn(t,tsvb_stickers_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_stickers_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_stickers_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_stickers_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_stickers_assertThisInitialized(t)}function tsvb_stickers_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_stickers_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_stickers_isNativeReflectConstruct=function(){return!!t})()}function tsvb_stickers_superPropGet(t,e,r,n){var i=tsvb_stickers_get(tsvb_stickers_getPrototypeOf(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof i?function(t){return i.apply(r,t)}:i}function tsvb_stickers_get(){return tsvb_stickers_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=tsvb_stickers_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tsvb_stickers_get.apply(null,arguments)}function tsvb_stickers_superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tsvb_stickers_getPrototypeOf(t)););return t}function tsvb_stickers_getPrototypeOf(t){return tsvb_stickers_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_stickers_getPrototypeOf(t)}function tsvb_stickers_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_stickers_setPrototypeOf(t,e)}function tsvb_stickers_setPrototypeOf(t,e){return tsvb_stickers_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_stickers_setPrototypeOf(t,e)}function tsvb_stickers_typeof(t){return tsvb_stickers_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_stickers_typeof(t)}var tsvb_stickers_decorate=function(t,e,r,n){var i,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"===("undefined"==typeof Reflect?"undefined":tsvb_stickers_typeof(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,r,o):i(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},tsvb_stickers_metadata=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":tsvb_stickers_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tsvb_stickers_defaultOptions=function(){return{capacity:8,duration:1500,animationSpeed:.08,position:{x:0,y:0,placement:"top-left"}}},tsvb_Stickers=function(t){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return tsvb_stickers_classCallCheck(this,e),(r=tsvb_stickers_callSuper(this,e,[t,Object.assign(tsvb_stickers_defaultOptions(),n)])).spriteStore=[],r.ticker=new src_tsvb_Ticker,r.ticker.add((function(){return r.animateSticker()})),r.hide(),r}return tsvb_stickers_inherits(e,tsvb_Component),tsvb_stickers_createClass(e,[{key:"show",value:function(){tsvb_stickers_superPropGet(e,"show",this,3)([]),this.ticker.start()}},{key:"hide",value:function(){tsvb_stickers_superPropGet(e,"hide",this,3)([]),this.ticker.stop()}},{key:"onLoadSucccess",value:function(t){var e="function"==typeof t;this.loadSuccesssFunc=e?t:void 0}},{key:"onLoadError",value:function(t){var e="function"==typeof t;this.loadErrorFunc=e?t:void 0}},{key:"setOptions",value:(n=tsvb_stickers_asyncToGenerator(tsvb_stickers_regeneratorRuntime().mark((function t(r){return tsvb_stickers_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return");case 2:r.position&&(this.updateSpritePosition(r.position),delete r.position),r.sticker&&(this.addSticker(r.sticker),delete r.sticker),r.id&&(this.selectSticker(r.id),delete r.id),tsvb_stickers_superPropGet(e,"setOptions",this,3)([r]),r.size&&this.activeSticker&&this.activeSticker.setSpriteSize(r.size),r.duration&&this.activeSticker&&!this.activeSticker.isHidingStop()&&this.setOptions({id:this.activeID});case 8:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"selectSticker",value:function(t){var e,r,n=this;if(t===this.activeID)return 0===this.activeSticker.sprite.alpha&&this.show(),this.activeSticker.aminationPhase="showing",clearTimeout(this.timerId),void(this.timerId=setTimeout((function(){return n.activeSticker.aminationPhase="hiding"}),this.options.duration));this.activeSticker&&(this.container.removeChildren(),null===(e=this.activeSticker.player)||void 0===e||e.stop(),this.activeSticker.reset()),this.activeID=t;var i=this.spriteStore.find((function(t){return t.id===n.activeID}));i&&(null===(r=i.player)||void 0===r||r.play(),i.sprite.position.x=this.options.position.x,i.sprite.position.y=this.options.position.y,i.aminationPhase="showing",this.container.addChild(i.sprite),this.activeSticker=i,this.activeSticker.setSpriteSize(this.options.size),this.calcPosition(),clearTimeout(this.timerId),this.show(),this.timerId=setTimeout((function(){n.activeSticker.aminationPhase="hiding"}),this.options.duration))}},{key:"loadSticker",value:(r=tsvb_stickers_asyncToGenerator(tsvb_stickers_regeneratorRuntime().mark((function t(e){var r,n,i,s,o,a,u,l,c,h=arguments;return tsvb_stickers_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=h.length>1&&void 0!==h[1]&&h[1],i=void 0,s=void 0,o=void 0,t.next=6,tsvb_isVideoSource(e);case 6:if(!t.sent){t.next=16;break}return t.t0=tsvb_Sprite,t.next=11,tsvb_Texture_Texture.fromURL(e);case 11:t.t1=t.sent,(o=new t.t0(t.t1)).texture.baseTexture.resource.source.loop=!0,t.next=35;break;case 16:return t.next=18,fetch(e).then((function(t){return t.arrayBuffer()})).catch((function(t){throw console.log("[ Stickers component ] - url fetching: ".concat(t)),t}));case 18:if(a=t.sent,!((u=tsvb_lib_default()(a))instanceof Error)){t.next=28;break}return t.t2=tsvb_Sprite,t.next=24,tsvb_Texture_Texture.fromURL(e);case 24:t.t3=t.sent,o=new t.t2(t.t3),t.next=35;break;case 28:return(i=document.createElement("canvas")).width=u.width,i.height=u.height,t.next=33,u.getPlayer(i.getContext("2d",{willReadFrequently:!0}),!0);case 33:s=t.sent,o=new tsvb_Sprite(tsvb_Texture_Texture.from(i));case 35:return this.spriteStore.push(new tsvb_StickerSprite(this.sdkOptions,{id:e,sprite:o,player:s,canvas:i,shrink:.99,size:this.options.size})),r||this.setOptions({id:e}),l={},this.spriteStore.length>this.options.capacity&&(c=this.spriteStore.shift(),l.removedID=null==c?void 0:c.id,null==c||c.sprite.destroy(!0),null===(n=null==c?void 0:c.canvas)||void 0===n||n.remove()),t.abrupt("return",l);case 40:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"animateSticker",value:function(){var t,e,r;(null===(r=null===(e=null===(t=this.activeSticker)||void 0===t?void 0:t.sprite)||void 0===e?void 0:e.texture)||void 0===r?void 0:r.baseTexture)&&(this.activeSticker.animateSize(this.options.animationSpeed),this.activeSticker.animatePosition(this.options.position),this.activeSticker.animateAlpha(this.options.animationSpeed),this.activeSticker.isHidingStop()?this.hide():this.activeSticker.sprite.texture.update())}},{key:"updateSpritePosition",value:function(t){var e;this.options.position||(this.options.position={});var r=this.sdkOptions.width,n=this.sdkOptions.height;t.x&&(this.options.position.x=r*t.x),t.y&&(this.options.position.y=n*t.y),t.placement&&(this.options.position.placement=t.placement),(null===(e=this.activeSticker)||void 0===e?void 0:e.sprite)&&(this.calcPosition(),this.activeSticker.sprite.position.x=this.options.position.x,this.activeSticker.sprite.position.y=this.options.position.y)}},{key:"addSticker",value:function(t){var e=this,r=function(r){var n,i;"function"==typeof(null===(n=null==t?void 0:t.promise)||void 0===n?void 0:n.resolve)&&(null===(i=null==t?void 0:t.promise)||void 0===i||i.resolve(r)),"function"==typeof e.loadSuccesssFunc&&e.loadSuccesssFunc(t.url,null==r?void 0:r.removedID)};this.spriteStore.some((function(e){return e.id===t.url}))?r():this.loadSticker(t.url,null==t?void 0:t.silenceMode).then(r).catch((function(r){var n,i;"function"==typeof(null===(n=null==t?void 0:t.promise)||void 0===n?void 0:n.reject)&&(null===(i=null==t?void 0:t.promise)||void 0===i||i.reject(r)),"function"==typeof e.loadErrorFunc&&e.loadErrorFunc(t.url)}))}},{key:"calcPosition",value:function(){if("custom"!==this.options.position.placement&&this.options.position.placement){var t=this.sdkOptions.width-this.activeSticker.width,e=this.sdkOptions.height-this.activeSticker.height;if("center"===this.options.position.placement)return this.options.position.x=.5*t,void(this.options.position.y=.5*e);this.options.position.x=~this.options.position.placement.indexOf("left")?0:t,this.options.position.y=~this.options.position.placement.indexOf("top")?0:e}}}]);var r,n}();function tsvb_isVideoSource(t){return src_tsvb_isVideoSource.apply(this,arguments)}function src_tsvb_isVideoSource(){return(src_tsvb_isVideoSource=tsvb_stickers_asyncToGenerator(tsvb_stickers_regeneratorRuntime().mark((function t(e){var r;return tsvb_stickers_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,{method:"HEAD"});case 2:return r=t.sent,t.abrupt("return",!!~r.headers.get("content-type").indexOf("video"));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function tsvb_lowerThird_regeneratorRuntime(){tsvb_lowerThird_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_lowerThird_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_lowerThird_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_lowerThird_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_lowerThird_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_lowerThird_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_lowerThird_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_lowerThird_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_lowerThird_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_lowerThird_toPropertyKey(n.key),n)}}function tsvb_lowerThird_createClass(t,e,r){return e&&tsvb_lowerThird_defineProperties(t.prototype,e),r&&tsvb_lowerThird_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_lowerThird_toPropertyKey(t){var e=tsvb_lowerThird_toPrimitive(t,"string");return"symbol"==tsvb_lowerThird_typeof(e)?e:e+""}function tsvb_lowerThird_toPrimitive(t,e){if("object"!=tsvb_lowerThird_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_lowerThird_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_lowerThird_callSuper(t,e,r){return e=tsvb_lowerThird_getPrototypeOf(e),tsvb_lowerThird_possibleConstructorReturn(t,tsvb_lowerThird_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_lowerThird_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_lowerThird_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_lowerThird_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_lowerThird_assertThisInitialized(t)}function tsvb_lowerThird_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_lowerThird_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_lowerThird_isNativeReflectConstruct=function(){return!!t})()}function tsvb_lowerThird_getPrototypeOf(t){return tsvb_lowerThird_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_lowerThird_getPrototypeOf(t)}function tsvb_lowerThird_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_lowerThird_setPrototypeOf(t,e)}function tsvb_lowerThird_setPrototypeOf(t,e){return tsvb_lowerThird_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_lowerThird_setPrototypeOf(t,e)}function tsvb_lowerThird_typeof(t){return tsvb_lowerThird_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_lowerThird_typeof(t)}tsvb_stickers_decorate([(0,tsvb_stats.kc)(),tsvb_stickers_metadata("design:type",Function),tsvb_stickers_metadata("design:paramtypes",[String]),tsvb_stickers_metadata("design:returntype",void 0)],tsvb_Stickers.prototype,"selectSticker",null);var tsvb_lowerThird_decorate=function(t,e,r,n){var i,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"===("undefined"==typeof Reflect?"undefined":tsvb_lowerThird_typeof(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,r,o):i(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},tsvb_lowerThird_metadata=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":tsvb_lowerThird_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tsvb_lowerThird_defaultOptions=function(){return{position:{x:0,y:0,placement:"bottom-left"},color:{primary:33777,secondary:16777215,text:1118481},offset:{x:0,y:0},text:{title:"LowerThird Title",subtitle:"LowerThird Subtitle",maxLengthTitle:10,maxLengthSubtitle:100}}},tsvb_LowerThird=function(t){function e(t,r){var n;return tsvb_lowerThird_classCallCheck(this,e),(n=tsvb_lowerThird_callSuper(this,e,[t])).fonts={},n.isShowing=!1,n.isHiding=!1,n.options=tsvb_lowerThird_defaultOptions(),n.setOptions(r,!1),n.ticker=new src_tsvb_Ticker,n.container.visible=!1,n}return tsvb_lowerThird_inherits(e,tsvb_Component),tsvb_lowerThird_createClass(e,[{key:"render",value:function(){}},{key:"setOptions",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&(this.setColor(t.color),this.setOffset(t.offset),this.setPosition(t.position),this.setText(t.text),e&&this.render())}},{key:"showLowerThird",value:function(){this.stopHiding(),"function"==typeof this.showFunction&&(this.ticker.add(this.showFunction),this.ticker.started||this.ticker.start(),this.isShowing=!0)}},{key:"hideLowerThird",value:function(){this.stopShowing(),"function"==typeof this.hideFunction&&(this.isHiding=!0,this.ticker.add(this.hideFunction),this.ticker.started||this.ticker.start())}},{key:"stopShowing",value:function(){this.ticker.started&&this.ticker.stop(),this.ticker.remove(this.showFunction),this.isShowing=!1}},{key:"stopHiding",value:function(){this.ticker.started&&this.ticker.stop(),this.ticker.remove(this.hideFunction),this.isHiding=!1}},{key:"setColor",value:function(t){var e=this;t&&Object.keys(t).forEach((function(r){e.options.color[r]=t[r]}))}},{key:"setOffset",value:function(t){var e=this;t&&Object.keys(t).forEach((function(r){e.options.offset[r]=Math.min(.25,Math.max(0,t[r]))}))}},{key:"setPosition",value:function(t){var e=this;t&&Object.keys(t).forEach((function(r){e.options.position[r]=t[r]}))}},{key:"setText",value:function(t){var e=this;t&&Object.keys(t).forEach((function(r){e.options.text[r]=t[r]}))}},{key:"offsetX",value:function(){var t;return this.sdkOptions.width*(null!==(t=this.options.offset.x)&&void 0!==t?t:0)}},{key:"offsetY",value:function(){var t;return this.sdkOptions.height*(null!==(t=this.options.offset.y)&&void 0!==t?t:0)}},{key:"strTrimAndEllipsis",value:function(t,e){return(t=t.trim()).length<e?t:t.substring(0,e-3)+"..."}},{key:"showOffset",value:function(){var t=new src_tsvb_Graphics;t.lineStyle({color:14550873,width:1}).drawRect(this.offsetX(),this.offsetY(),this.sdkOptions.width-2*this.offsetX(),this.sdkOptions.height-2*this.offsetY()),this.container.addChild(t)}},{key:"drawRectPrimary",value:function(t,e,r,n){var i=new src_tsvb_Graphics;return i.beginFill(this.options.color.primary).drawRect(t,e,r,n).endFill(),i}},{key:"drawRectSecondary",value:function(t,e,r,n){var i=new src_tsvb_Graphics;return i.beginFill(this.options.color.secondary).drawRect(t,e,r,n).endFill(),i}},{key:"fontFamily",value:function(t){var e;return null!==(e=this.fonts[t])&&void 0!==e?e:"Arial, Helvetica, sans-serif"}},{key:"loadFont",value:(r=tsvb_lowerThird_asyncToGenerator(tsvb_lowerThird_regeneratorRuntime().mark((function t(e,r){var n=this;return tsvb_lowerThird_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,tsvb_Assets.load(r).then((function(t){n.fonts[e]||(n.fonts[e]=[]),n.fonts[e].push('"'.concat(t.family.replace(/[\\"]/g,"\\$&"),'"'))})).catch((function(t){tsvb_errorBus.bv.notify({type:tsvb_errorBus.By.WARNING,message:"LowerThird font loading. ".concat(t),cause:t,emitter:tsvb_errorBus.JK.COMPONENTS_SYSTEM})}));case 2:case"end":return t.stop()}}),t)}))),function(t,e){return r.apply(this,arguments)})},{key:"destroy",value:function(){var t;this.stopShowing(),this.stopHiding(),this.hide(),null===(t=this.container)||void 0===t||t.destroy(!0)}}]);var r}();function tsvb_smoothNumber_typeof(t){return tsvb_smoothNumber_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_smoothNumber_typeof(t)}function tsvb_smoothNumber_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_smoothNumber_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_smoothNumber_toPropertyKey(n.key),n)}}function tsvb_smoothNumber_createClass(t,e,r){return e&&tsvb_smoothNumber_defineProperties(t.prototype,e),r&&tsvb_smoothNumber_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_smoothNumber_toPropertyKey(t){var e=tsvb_smoothNumber_toPrimitive(t,"string");return"symbol"==tsvb_smoothNumber_typeof(e)?e:e+""}function tsvb_smoothNumber_toPrimitive(t,e){if("object"!=tsvb_smoothNumber_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_smoothNumber_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}tsvb_lowerThird_decorate([(0,tsvb_stats.kc)(),tsvb_lowerThird_metadata("design:type",Function),tsvb_lowerThird_metadata("design:paramtypes",[]),tsvb_lowerThird_metadata("design:returntype",void 0)],tsvb_LowerThird.prototype,"showLowerThird",null),tsvb_lowerThird_decorate([(0,tsvb_stats.kc)(),tsvb_lowerThird_metadata("design:type",Function),tsvb_lowerThird_metadata("design:paramtypes",[]),tsvb_lowerThird_metadata("design:returntype",void 0)],tsvb_LowerThird.prototype,"hideLowerThird",null);var tsvb_SmoothNumber=function(){return tsvb_smoothNumber_createClass((function t(e){var r,n,i,s,o,a;tsvb_smoothNumber_classCallCheck(this,t),this.startValue=e.startValue,this.currentValue=e.startValue,this.currentStep=0,this.endValue=null!==(r=e.endValue)&&void 0!==r?r:e.startValue,this.smoothPower=null!==(n=e.smoothPower)&&void 0!==n?n:1,this.range=this.endValue-this.startValue,this.speedNext=null!==(i=e.speedNext)&&void 0!==i?i:1,this.speedBack=null!==(o=null!==(s=e.speedBack)&&void 0!==s?s:e.speedNext)&&void 0!==o?o:1,this.smoothFunctionNext=this.getSmoothFunction(e.smoothFunctionNext),this.smoothFunctionBack=this.getSmoothFunction(null!==(a=e.smoothFunctionBack)&&void 0!==a?a:e.smoothFunctionNext)}),[{key:"setCurrentStep",value:function(t){this.currentStep=Math.max(0,Math.min(t,this.smoothPower))}},{key:"getCurrentStep",value:function(){return this.currentStep}},{key:"setEnd",value:function(){return this.currentStep=this.smoothPower,this.endValue}},{key:"isEnd",value:function(t){return this.currentStep>=this.smoothPower*(null!=t?t:1)}},{key:"isStart",value:function(t){return this.currentStep<=this.smoothPower*(null!=t?t:0)}},{key:"reset",value:function(){this.currentStep=0}},{key:"next",value:function(){if(this.startValue===this.endValue)return this.currentValue;var t=this.currentStep/this.smoothPower,e=this.smoothFunctionNext(t);return this.currentValue=this.startValue+this.range*e,this.currentStep=Math.min(this.smoothPower,this.currentStep+this.speedNext),this.currentValue}},{key:"back",value:function(){if(this.startValue===this.endValue)return this.currentValue;this.currentStep=Math.max(0,this.currentStep-this.speedBack);var t=this.currentStep/this.smoothPower,e=this.smoothFunctionBack(t);return this.currentValue=this.startValue+this.range*e,this.currentValue}},{key:"getSmoothFunction",value:function(t){return function(e){switch(t){case"ease-out-sine":return Math.sin(e*Math.PI/2);case"ease-out-quint":return 1-Math.pow(1-e,5);case"ease-out-cubic":Math.pow(1-e,3);default:return e}}}}])}();function tsvb_leftTextbox_typeof(t){return tsvb_leftTextbox_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_leftTextbox_typeof(t)}function tsvb_leftTextbox_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_leftTextbox_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_leftTextbox_toPropertyKey(n.key),n)}}function tsvb_leftTextbox_createClass(t,e,r){return e&&tsvb_leftTextbox_defineProperties(t.prototype,e),r&&tsvb_leftTextbox_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_leftTextbox_toPropertyKey(t){var e=tsvb_leftTextbox_toPrimitive(t,"string");return"symbol"==tsvb_leftTextbox_typeof(e)?e:e+""}function tsvb_leftTextbox_toPrimitive(t,e){if("object"!=tsvb_leftTextbox_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_leftTextbox_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_leftTextbox_callSuper(t,e,r){return e=tsvb_leftTextbox_getPrototypeOf(e),tsvb_leftTextbox_possibleConstructorReturn(t,tsvb_leftTextbox_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_leftTextbox_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_leftTextbox_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_leftTextbox_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_leftTextbox_assertThisInitialized(t)}function tsvb_leftTextbox_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_leftTextbox_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_leftTextbox_isNativeReflectConstruct=function(){return!!t})()}function tsvb_leftTextbox_getPrototypeOf(t){return tsvb_leftTextbox_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_leftTextbox_getPrototypeOf(t)}function tsvb_leftTextbox_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_leftTextbox_setPrototypeOf(t,e)}function tsvb_leftTextbox_setPrototypeOf(t,e){return tsvb_leftTextbox_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_leftTextbox_setPrototypeOf(t,e)}var tsvb_LtLeftTextbox=function(t){function e(t,r){var n;return tsvb_leftTextbox_classCallCheck(this,e),(n=tsvb_leftTextbox_callSuper(this,e,[t,r])).animations={},n.smoothPower=65,n.ltContainer=new src_tsvb_Container,n.container.addChild(n.ltContainer),n.addShowFunction(),n.addHideFunction(),n.render(),n}return tsvb_leftTextbox_inherits(e,tsvb_LowerThird),tsvb_leftTextbox_createClass(e,[{key:"render",value:function(){var t;null===(t=this.ltContainer)||void 0===t||t.destroy(!0),this.ltContainer=new src_tsvb_Container,this.ltContainer.position.x=this.offsetX(),this.container.addChild(this.ltContainer),this.createText(),this.addRectangles(),this.addSpriteMask(),this.ltContainer.addChild(this.rectBack),this.ltContainer.addChild(this.rectFront),this.ltContainer.addChild(this.title),this.ltContainer.addChild(this.subtitle)}},{key:"createText",value:function(){var t=this,e=this.sdkOptions.width-2*this.offsetX()-this.px(70),r=function(r,n,i){return{fontFamily:"Trebuchet MS",fontSize:t.px(r),fontWeight:n,fill:i,wordWrapWidth:e,wordWrap:!0,breakWords:!0}};this.subtitle=new src_tsvb_Text(this.options.text.subtitle,r(12,"400",this.options.color.primary)),this.subtitle.position.x=-this.subtitle.width,this.subtitle.position.y=this.sdkOptions.height-this.offsetY()-this.px(12)-this.subtitle.height,this.animations.subtitle=new tsvb_SmoothNumber({startValue:-this.subtitle.width,endValue:this.px(15),smoothPower:this.smoothPower,smoothFunctionNext:"ease-out-quint",speedBack:1.3}),this.title=new src_tsvb_Text(this.options.text.title,r(20,"700",1118481)),this.title.width=Math.min(e,this.title.width),this.title.position.x=-this.title.width,this.title.position.y=this.sdkOptions.height-this.offsetY()-this.px(15)-this.subtitle.height-this.title.height,this.animations.title=new tsvb_SmoothNumber({startValue:-this.title.width,endValue:this.px(15),smoothPower:this.smoothPower,smoothFunctionNext:"ease-out-quint",speedBack:1.3}),this.ltWidth=Math.max(this.title.width,this.subtitle.width)+this.px(45),this.ltHeight=this.title.height+this.subtitle.height+this.px(23),this.isVisible()&&(this.title.position.x=this.animations.title.setEnd(),this.subtitle.position.x=this.animations.subtitle.setEnd())}},{key:"addRectangles",value:function(){var t=this.sdkOptions.height-this.offsetY()-this.ltHeight;this.rectBack=(new src_tsvb_Graphics).beginFill(this.options.color.primary).drawRoundedRect(0,t,this.ltWidth,this.ltHeight,this.px(5)).endFill(),this.animations.rectBack=new tsvb_SmoothNumber({startValue:-this.rectBack.width,endValue:0,smoothPower:this.smoothPower,smoothFunctionNext:"ease-out-quint",speedBack:1.1}),this.rectFront=(new src_tsvb_Graphics).beginFill(16777215).drawRoundedRect(0,t,this.ltWidth-this.px(15),this.ltHeight,this.px(5)).endFill(),this.rectFront.position.x=-this.ltWidth+this.px(15),this.animations.rectFront=new tsvb_SmoothNumber({startValue:-this.rectFront.width,endValue:0,smoothPower:this.smoothPower,smoothFunctionNext:"ease-out-quint",speedBack:1.1}),this.isVisible()&&(this.rectBack.position.x=this.animations.rectBack.setEnd(),this.rectFront.position.x=this.animations.rectFront.setEnd())}},{key:"addSpriteMask",value:function(){this.mask=new tsvb_Sprite(tsvb_Texture_Texture.WHITE),this.mask.width=this.ltWidth,this.mask.height=this.sdkOptions.height,this.ltContainer.addChild(this.mask),this.ltContainer.mask=this.mask}},{key:"addShowFunction",value:function(){var t=this;this.showFunction=function(){t.show(),t.rectBack.position.x=t.animations.rectBack.next(),t.animations.rectBack.isEnd(.3)&&(t.rectFront.position.x=t.animations.rectFront.next()),t.animations.rectBack.isEnd(.8)&&(t.title.position.x=t.animations.title.next()),t.animations.title.isEnd(.3)&&(t.subtitle.position.x=t.animations.subtitle.next()),Object.values(t.animations).reduce((function(t,e){return t&&e.isEnd()}),!0)&&t.stopShowing()}}},{key:"addHideFunction",value:function(){var t=this;this.hideFunction=function(){t.isHiding||(t.stopHiding(),t.hide()),t.subtitle.position.x=t.animations.subtitle.back(),t.title.position.x=t.animations.title.back(),t.rectFront.position.x=t.animations.rectFront.back(),t.rectBack.position.x=t.animations.rectBack.back(),t.isHiding=!t.animations.rectBack.isStart()}}}])}();function tsvb_horizontalMirror_typeof(t){return tsvb_horizontalMirror_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_horizontalMirror_typeof(t)}function tsvb_horizontalMirror_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_horizontalMirror_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_horizontalMirror_toPropertyKey(n.key),n)}}function tsvb_horizontalMirror_createClass(t,e,r){return e&&tsvb_horizontalMirror_defineProperties(t.prototype,e),r&&tsvb_horizontalMirror_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_horizontalMirror_toPropertyKey(t){var e=tsvb_horizontalMirror_toPrimitive(t,"string");return"symbol"==tsvb_horizontalMirror_typeof(e)?e:e+""}function tsvb_horizontalMirror_toPrimitive(t,e){if("object"!=tsvb_horizontalMirror_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_horizontalMirror_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_horizontalMirror_callSuper(t,e,r){return e=tsvb_horizontalMirror_getPrototypeOf(e),tsvb_horizontalMirror_possibleConstructorReturn(t,tsvb_horizontalMirror_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_horizontalMirror_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_horizontalMirror_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_horizontalMirror_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_horizontalMirror_assertThisInitialized(t)}function tsvb_horizontalMirror_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_horizontalMirror_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_horizontalMirror_isNativeReflectConstruct=function(){return!!t})()}function tsvb_horizontalMirror_getPrototypeOf(t){return tsvb_horizontalMirror_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_horizontalMirror_getPrototypeOf(t)}function tsvb_horizontalMirror_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_horizontalMirror_setPrototypeOf(t,e)}function tsvb_horizontalMirror_setPrototypeOf(t,e){return tsvb_horizontalMirror_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_horizontalMirror_setPrototypeOf(t,e)}var tsvb_fonts={title:{cyrillic:"https://fonts.gstatic.com/s/notosans/v28/o-0NIpQlx3QUlC5A4PNjFhdVYNyB1Wk.woff2",latin:"https://fonts.gstatic.com/s/notosans/v28/o-0NIpQlx3QUlC5A4PNjFhdVZNyB.woff2"},subtitle:{cyrillic:"https://fonts.gstatic.com/s/notosans/v28/o-0NIpQlx3QUlC5A4PNjKhVVYNyB1Wk.woff2",latin:"https://fonts.gstatic.com/s/notosans/v28/o-0NIpQlx3QUlC5A4PNjKhVVZNyB.woff2"}},tsvb_LtHorizontalMirror=function(t){function e(t,r){var n;return tsvb_horizontalMirror_classCallCheck(this,e),(n=tsvb_horizontalMirror_callSuper(this,e,[t,r])).isReady=!1,n.animations={},n.smoothPower={title:35,subtitle:35,middleLine:50},n.addShowFunction(),n.addHideFunction(),Promise.all([n.loadFont("title",tsvb_fonts.title.cyrillic),n.loadFont("title",tsvb_fonts.title.latin),n.loadFont("subtitle",tsvb_fonts.subtitle.cyrillic),n.loadFont("subtitle",tsvb_fonts.subtitle.latin)]).finally((function(){n.isReady=!0,n.render()})),n}return tsvb_horizontalMirror_inherits(e,tsvb_LowerThird),tsvb_horizontalMirror_createClass(e,[{key:"render",value:function(){var t,e;this.container.removeChild(this.middleLine),this.container.removeChild(this.titleContainer),this.container.removeChild(this.subtitleContainer),null===(t=this.titleContainer)||void 0===t||t.destroy(!0),null===(e=this.subtitleContainer)||void 0===e||e.destroy(!0),this.createText(),this.createRectangles(),this.container.addChild(this.middleLine),this.container.addChild(this.titleContainer),this.container.addChild(this.subtitleContainer)}},{key:"createText",value:function(){this.title=new src_tsvb_Text(this.options.text.title,{fontFamily:this.fontFamily("title"),fontSize:this.px(35),fill:16777215,wordWrapWidth:this.sdkOptions.width-2*this.offsetX(),wordWrap:!0,breakWords:!0,align:"right"}),this.title.position.x=0,this.title.position.y=this.title.height,this.titleContainer=new src_tsvb_Container,this.titleContainer.width=this.title.width,this.titleContainer.height=this.title.height+this.px(200);var t=new tsvb_Sprite(tsvb_Texture_Texture.WHITE);t.tint=0,t.width=this.title.width,t.height=this.title.height,t.position.x=0,t.position.y=0,this.titleContainer.addChild(t),this.titleContainer.mask=t,this.titleContainer.addChild(this.title),this.animations.title=new tsvb_SmoothNumber({startValue:this.title.position.y,endValue:0,smoothPower:this.smoothPower.title,smoothFunctionNext:"ease-out-quint"}),this.subtitle=new src_tsvb_Text(this.options.text.subtitle,{fontFamily:this.fontFamily("subtitle"),fontSize:this.px(13),fontWeight:"100",fill:16777215,wordWrapWidth:this.sdkOptions.width-2*this.offsetX(),wordWrap:!0,breakWords:!0,align:"right"}),this.subtitle.position.x=0,this.subtitle.position.y=-this.subtitle.height-this.px(20),this.subtitleContainer=new src_tsvb_Container,this.subtitleContainer.width=this.subtitle.width,this.subtitleContainer.height=this.subtitle.height+this.px(20);var e=new tsvb_Sprite(tsvb_Texture_Texture.WHITE);e.tint=0,e.width=this.subtitle.width,e.height=this.subtitle.height,e.position.x=0,e.position.y=0,this.subtitleContainer.addChild(e),this.subtitleContainer.mask=e,this.subtitleContainer.addChild(this.subtitle),this.animations.subtitle=new tsvb_SmoothNumber({startValue:this.subtitle.position.y,smoothPower:this.smoothPower.subtitle,endValue:0,smoothFunctionNext:"ease-out-quint"}),this.ltWidth=Math.max(this.title.width,this.subtitle.width)+this.px(25),this.ltHeight=this.titleContainer.height+this.subtitleContainer.height+this.px(10),this.titleContainer.position.x=this.offsetX(),this.subtitleContainer.position.x=this.offsetX();var r=this.titleContainer.width-this.subtitleContainer.width;r>0?this.subtitleContainer.position.x+=r:this.titleContainer.position.x-=r,this.titleContainer.position.y=this.sdkOptions.height-this.offsetY()-this.ltHeight,this.subtitleContainer.position.y=this.sdkOptions.height-this.offsetY()-this.subtitleContainer.height,this.isVisible()&&(this.title.position.y=0,this.subtitle.position.y=0,this.animations.title.setCurrentStep(this.smoothPower.title),this.animations.subtitle.setCurrentStep(this.smoothPower.subtitle))}},{key:"createRectangles",value:function(){this.middleLine=new src_tsvb_Graphics;var t=this.ltWidth+this.offsetX(),e=this.sdkOptions.height-this.offsetY()-this.subtitleContainer.height-this.px(8);this.middleLine.beginFill(this.options.color.primary).drawRoundedRect(-t-this.px(2),e,t,this.px(3),this.px(2)).endFill(),this.animations.middleLine=new tsvb_SmoothNumber({startValue:0,smoothPower:this.smoothPower.middleLine,endValue:t,smoothFunctionNext:"ease-out-quint"}),this.isVisible()&&(this.middleLine.position.x=t,this.animations.middleLine.setCurrentStep(this.smoothPower.middleLine))}},{key:"addShowFunction",value:function(){var t=this;this.showFunction=function(){t.isReady&&(t.show(),t.middleLine.position.x=t.animations.middleLine.next(),t.animations.middleLine.isEnd(.5)&&(t.title.position.y=t.animations.title.next()),t.animations.middleLine.isEnd(.5)&&(t.subtitle.position.y=t.animations.subtitle.next()),Object.values(t.animations).reduce((function(t,e){return t&&e.isEnd()}),!0)&&t.stopShowing())}}},{key:"addHideFunction",value:function(){var t=this;this.hideFunction=function(){if(!t.isHiding)return t.stopHiding(),void t.hide();t.title.position.y=t.animations.title.back(),t.subtitle.position.y=t.animations.subtitle.back(),t.animations.title.isStart(.7)&&(t.middleLine.position.x=t.animations.middleLine.back()),t.isHiding=!Object.values(t.animations).reduce((function(t,e){return t&&e.isStart()}),!0)}}}])}();function tsvb_slideBold_typeof(t){return tsvb_slideBold_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_slideBold_typeof(t)}function tsvb_slideBold_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_slideBold_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_slideBold_toPropertyKey(n.key),n)}}function tsvb_slideBold_createClass(t,e,r){return e&&tsvb_slideBold_defineProperties(t.prototype,e),r&&tsvb_slideBold_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_slideBold_toPropertyKey(t){var e=tsvb_slideBold_toPrimitive(t,"string");return"symbol"==tsvb_slideBold_typeof(e)?e:e+""}function tsvb_slideBold_toPrimitive(t,e){if("object"!=tsvb_slideBold_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_slideBold_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_slideBold_callSuper(t,e,r){return e=tsvb_slideBold_getPrototypeOf(e),tsvb_slideBold_possibleConstructorReturn(t,tsvb_slideBold_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_slideBold_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_slideBold_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_slideBold_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_slideBold_assertThisInitialized(t)}function tsvb_slideBold_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_slideBold_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_slideBold_isNativeReflectConstruct=function(){return!!t})()}function tsvb_slideBold_getPrototypeOf(t){return tsvb_slideBold_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_slideBold_getPrototypeOf(t)}function tsvb_slideBold_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_slideBold_setPrototypeOf(t,e)}function tsvb_slideBold_setPrototypeOf(t,e){return tsvb_slideBold_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_slideBold_setPrototypeOf(t,e)}var tsvb_slideBold_fonts={title:{cyrillic:"https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCvr73w9aXpsog.woff2",latin:"https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCvr73w5aXo.woff2"},subtitle:{cyrillic:"https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCvr6Hw9aXpsog.woff2",latin:"https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCvr6Hw5aXo.woff2"}},tsvb_LtSlideBold=function(t){function e(t,r){var n;return tsvb_slideBold_classCallCheck(this,e),(n=tsvb_slideBold_callSuper(this,e,[t,r])).titleFontSize=35,n.animations={},n.isReady=!1,n.smoothPower={title:95,subtitle:95,titleRect:75,titleTextMask:75,titleRectMask:75,rectFront:40,rectBack:40},n.addShowFunction(),n.addHideFunction(),Promise.all([n.loadFont("title",tsvb_slideBold_fonts.title.cyrillic),n.loadFont("title",tsvb_slideBold_fonts.title.latin),n.loadFont("subtitle",tsvb_slideBold_fonts.subtitle.cyrillic),n.loadFont("subtitle",tsvb_slideBold_fonts.subtitle.latin)]).finally((function(){n.isReady=!0,n.render()})),n}return tsvb_slideBold_inherits(e,tsvb_LowerThird),tsvb_slideBold_createClass(e,[{key:"render",value:function(){var t,e,r;this.container.removeChild(this.titleContainer),this.container.removeChild(this.subtitleContainer),this.container.removeChild(this.vertLineContainer),null===(t=this.titleContainer)||void 0===t||t.destroy(!0),null===(e=this.subtitleContainer)||void 0===e||e.destroy(!0),null===(r=this.vertLineContainer)||void 0===r||r.destroy(!0),this.createSubtitle(),this.createTitle(),this.createRectangles(),this.container.addChild(this.titleContainer),this.container.addChild(this.subtitleContainer),this.container.addChild(this.vertLineContainer)}},{key:"createTitle",value:function(){var t;this.title=new src_tsvb_Text(null===(t=this.options.text.title)||void 0===t?void 0:t.toUpperCase(),{fontFamily:this.fontFamily("title"),fontSize:this.px(this.titleFontSize),fill:16777215,wordWrapWidth:this.sdkOptions.width-2*this.offsetX(),wordWrap:!0,breakWords:!0,lineHeight:this.px(this.titleFontSize)}),this.title.position.x=.3*this.title.width,this.animations.title=new tsvb_SmoothNumber({startValue:this.title.position.x,endValue:this.px(10),smoothPower:this.smoothPower.title,smoothFunctionNext:"ease-out-quint",speedBack:1.3});var e=new src_tsvb_Container;e.width=this.title.width+this.px(10),e.height=this.title.height,e.addChild(this.title),this.titleTextMask=new tsvb_Sprite(tsvb_Texture_Texture.WHITE),this.titleTextMask.width=0,this.titleTextMask.height=this.title.height,e.addChild(this.titleTextMask),e.mask=this.titleTextMask,this.animations.titleTextMask=new tsvb_SmoothNumber({startValue:0,endValue:this.title.width+this.px(10),smoothPower:this.smoothPower.titleTextMask,smoothFunctionNext:"ease-out-quint",speedBack:1.25}),this.titleRect=this.drawRectSecondary(0,this.px(this.titleFontSize/3.5),this.title.width,this.title.height-this.px(this.titleFontSize/2.2)),this.animations.titleRect=new tsvb_SmoothNumber({startValue:.2*-this.title.width,endValue:this.title.width+this.px(35),smoothPower:this.smoothPower.titleRect,smoothFunctionNext:"ease-out-quint",speedNext:.5,speedBack:1.1});var r=new src_tsvb_Container;r.width=this.titleRect.width,r.height=this.titleRect.height,r.addChild(this.titleRect),this.titleRectMask=new tsvb_Sprite(tsvb_Texture_Texture.WHITE),this.titleRectMask.width=0,this.titleRectMask.height=this.title.height,r.addChild(this.titleRectMask),r.mask=this.titleRectMask,this.animations.titleRectMask=new tsvb_SmoothNumber({startValue:0,endValue:this.title.width+this.px(35),smoothPower:this.smoothPower.titleRectMask,smoothFunctionNext:"ease-out-quint",speedNext:1.5,speedBack:1}),this.titleContainer=new src_tsvb_Container,this.titleContainer.width=this.title.width+this.px(10),this.titleContainer.height=this.title.height,this.titleContainer.addChild(e),this.titleContainer.addChild(r),this.ltHeight=this.title.height+this.subtitleContainer.height,this.titleContainer.position.x=this.offsetX(),this.titleContainer.position.y=this.sdkOptions.height-this.offsetY()-this.ltHeight+this.px(3),this.isVisible()&&(this.title.position.x=this.animations.title.setEnd(),this.titleTextMask.width=this.animations.titleTextMask.setEnd(),this.titleRect.position.x=this.animations.titleRect.setEnd(),this.titleRectMask.width=this.animations.titleRectMask.setEnd())}},{key:"createSubtitle",value:function(){var t;this.subtitle=new src_tsvb_Text(null===(t=this.options.text.subtitle)||void 0===t?void 0:t.toUpperCase(),{fontFamily:this.fontFamily("subtitle"),fontSize:this.px(11),fill:16777215,wordWrapWidth:this.sdkOptions.width-2*this.offsetX(),wordWrap:!0,breakWords:!0}),this.subtitle.position.x=-this.subtitle.width,this.animations.subtitle=new tsvb_SmoothNumber({startValue:this.subtitle.position.x,endValue:this.px(11),smoothPower:this.smoothPower.subtitle,smoothFunctionNext:"ease-out-quint",speedBack:1.2}),this.subtitleContainer=new src_tsvb_Container,this.subtitleContainer.width=this.subtitle.width+this.px(10),this.subtitleContainer.height=this.subtitle.height,this.subtitleContainer.addChild(this.subtitle),this.subtitleContainer.position.x=this.offsetX(),this.subtitleContainer.position.y=this.sdkOptions.height-this.offsetY()-this.subtitle.height;var e=new tsvb_Sprite(tsvb_Texture_Texture.WHITE);e.width=this.subtitle.width+this.px(10),e.height=this.subtitle.height,this.subtitleContainer.addChild(e),this.subtitleContainer.mask=e,this.isVisible()&&(this.subtitle.position.x=this.animations.subtitle.setEnd())}},{key:"createRectangles",value:function(){var t=this.title.height-this.px(this.titleFontSize/2.2);this.rectFront=this.drawRectPrimary(0,0,this.px(4),t),this.animations.rectFront=new tsvb_SmoothNumber({startValue:t,endValue:0,smoothPower:this.smoothPower.rectFront,smoothFunctionNext:"ease-out-quint",speedNext:.8,speedBack:1}),this.rectBack=this.drawRectSecondary(0,0,this.px(4),this.px(4)),this.animations.rectBack=new tsvb_SmoothNumber({startValue:t,endValue:-this.px(4),smoothPower:this.smoothPower.rectFront,smoothFunctionNext:"ease-out-quint",speedNext:1.5,speedBack:.6}),this.vertLineContainer=new src_tsvb_Container,this.vertLineContainer.width=this.rectFront.width,this.vertLineContainer.height=t,this.vertLineContainer.addChild(this.rectBack),this.vertLineContainer.addChild(this.rectFront),this.vertLineContainer.position.x=this.offsetX(),this.vertLineContainer.position.y=this.titleContainer.position.y+this.px(this.titleFontSize/3.5);var e=new tsvb_Sprite(tsvb_Texture_Texture.WHITE);e.width=this.vertLineContainer.width,e.height=t,this.vertLineContainer.addChild(e),this.vertLineContainer.mask=e,this.isVisible()&&(this.rectFront.position.y=this.animations.rectFront.setEnd())}},{key:"addShowFunction",value:function(){var t=this;this.showFunction=function(){t.isReady&&(t.show(),t.rectFront.position.y=t.animations.rectFront.next(),t.rectBack.position.y=t.animations.rectBack.next(),t.animations.rectFront.isEnd(.9)&&(t.title.position.x=t.animations.title.next(),t.subtitle.position.x=t.animations.subtitle.next(),t.titleTextMask.width=t.animations.titleTextMask.next(),t.titleRectMask.width=t.animations.titleRectMask.next(),t.titleRect.position.x=t.animations.titleRect.next(),Object.values(t.animations).reduce((function(t,e){return t&&e.isEnd()}),!0)&&t.stopShowing()))}}},{key:"addHideFunction",value:function(){var t=this;this.hideFunction=function(){if(!t.isHiding)return t.stopHiding(),void t.hide();t.title.position.x=t.animations.title.back(),t.subtitle.position.x=t.animations.subtitle.back(),t.animations.titleRect.getCurrentStep()<t.smoothPower.titleRect-2&&(t.titleTextMask.width=t.animations.titleTextMask.back()),t.titleRect.position.x=t.animations.titleRect.back(),t.titleRectMask.width=t.animations.titleRectMask.back(),t.animations.titleRectMask.isStart(.2)&&(t.rectBack.position.y=t.animations.rectBack.back(),t.rectFront.position.y=t.animations.rectFront.back()),t.isHiding=!Object.values(t.animations).reduce((function(t,e){return t&&e.isStart()}),!0)}}}])}();function tsvb_doubleSlideRect_typeof(t){return tsvb_doubleSlideRect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_doubleSlideRect_typeof(t)}function tsvb_doubleSlideRect_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_doubleSlideRect_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_doubleSlideRect_toPropertyKey(n.key),n)}}function tsvb_doubleSlideRect_createClass(t,e,r){return e&&tsvb_doubleSlideRect_defineProperties(t.prototype,e),r&&tsvb_doubleSlideRect_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_doubleSlideRect_toPropertyKey(t){var e=tsvb_doubleSlideRect_toPrimitive(t,"string");return"symbol"==tsvb_doubleSlideRect_typeof(e)?e:e+""}function tsvb_doubleSlideRect_toPrimitive(t,e){if("object"!=tsvb_doubleSlideRect_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_doubleSlideRect_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_doubleSlideRect_callSuper(t,e,r){return e=tsvb_doubleSlideRect_getPrototypeOf(e),tsvb_doubleSlideRect_possibleConstructorReturn(t,tsvb_doubleSlideRect_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_doubleSlideRect_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_doubleSlideRect_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_doubleSlideRect_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_doubleSlideRect_assertThisInitialized(t)}function tsvb_doubleSlideRect_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_doubleSlideRect_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_doubleSlideRect_isNativeReflectConstruct=function(){return!!t})()}function tsvb_doubleSlideRect_getPrototypeOf(t){return tsvb_doubleSlideRect_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_doubleSlideRect_getPrototypeOf(t)}function tsvb_doubleSlideRect_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_doubleSlideRect_setPrototypeOf(t,e)}function tsvb_doubleSlideRect_setPrototypeOf(t,e){return tsvb_doubleSlideRect_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_doubleSlideRect_setPrototypeOf(t,e)}var tsvb_doubleSlideRect_fonts={title:{cyrillic:"https://fonts.gstatic.com/s/geologica/v1/oY1l8evIr7j9P3TN9YwNAdyjzUyDKkKdAGOJh1UlCDUIhAIdhCZOn1fLsig7jfvCCPHZckUWF1lEP2A.woff2",latin:"https://fonts.gstatic.com/s/geologica/v1/oY1l8evIr7j9P3TN9YwNAdyjzUyDKkKdAGOJh1UlCDUIhAIdhCZOn1fLsig7jfvCCPHZckUWE1lE.woff2"},subtitle:{cyrillic:"https://fonts.gstatic.com/s/geologica/v1/oY1o8evIr7j9P3TN9YwNAdyjzUyDKkKdAGOJh1UlCDUIhAIdhCZOn1fLsig7jfvCCPHZckU8H3G11_z-_OZqD8Hsc-ASAEWn.woff2",latin:"https://fonts.gstatic.com/s/geologica/v1/oY1o8evIr7j9P3TN9YwNAdyjzUyDKkKdAGOJh1UlCDUIhAIdhCZOn1fLsig7jfvCCPHZckU8H3G11_z-_OZqD8Hsc-QSAA.woff2"}},tsvb_LtDoubleSlideRect=function(t){function e(t,r){var n;return tsvb_doubleSlideRect_classCallCheck(this,e),(n=tsvb_doubleSlideRect_callSuper(this,e,[t,r])).animations={},n.isReady=!1,n.smoothPower={title:75,subtitle:65,rectFront:40,rectBack:40},n.addShowFunction(),n.addHideFunction(),Promise.all([n.loadFont("title",tsvb_doubleSlideRect_fonts.title.cyrillic),n.loadFont("title",tsvb_doubleSlideRect_fonts.title.latin),n.loadFont("subtitle",tsvb_doubleSlideRect_fonts.subtitle.cyrillic),n.loadFont("subtitle",tsvb_doubleSlideRect_fonts.subtitle.latin)]).finally((function(){n.isReady=!0,n.render()})),n}return tsvb_doubleSlideRect_inherits(e,tsvb_LowerThird),tsvb_doubleSlideRect_createClass(e,[{key:"render",value:function(){var t,e;this.container.removeChild(this.titleContainer),this.container.removeChild(this.subtitleContainer),null===(t=this.titleContainer)||void 0===t||t.destroy(!0),null===(e=this.subtitleContainer)||void 0===e||e.destroy(!0),this.createSubtitle(),this.createTitle(),this.createRectangles(),this.container.addChild(this.titleContainer),this.container.addChild(this.subtitleContainer)}},{key:"createSubtitle",value:function(){this.subtitle=new src_tsvb_Text(this.options.text.subtitle,{fontFamily:this.fontFamily("subtitle"),fontSize:this.px(13),fill:16777215,wordWrapWidth:this.sdkOptions.width-2*this.offsetX(),wordWrap:!0,breakWords:!0});var t=this.subtitle.width+this.px(6);this.subtitle.position.x=-this.subtitle.width,this.subtitle.position.y=this.px(3),this.animations.subtitle=new tsvb_SmoothNumber({startValue:this.subtitle.position.x,endValue:this.px(10),smoothPower:this.smoothPower.subtitle,smoothFunctionNext:"ease-out-quint"}),this.subtitleContainer=new src_tsvb_Container,this.subtitleContainer.width=t,this.subtitleContainer.height=this.subtitle.height+this.px(6),this.subtitleContainer.position.x=this.offsetX(),this.subtitleContainer.position.y=this.sdkOptions.height-this.offsetY()-this.subtitle.height-this.px(6),this.isVisible()&&(this.subtitle.position.x=this.animations.subtitle.setEnd())}},{key:"createTitle",value:function(){this.title=new src_tsvb_Text(this.options.text.title,{fontFamily:this.fontFamily("title"),fontSize:this.px(30),fill:16777215,wordWrapWidth:this.sdkOptions.width-2*this.offsetX(),wordWrap:!0,breakWords:!0}),this.title.position.y=this.title.height,this.animations.title=new tsvb_SmoothNumber({startValue:this.title.position.y,endValue:0,smoothPower:this.smoothPower.title,smoothFunctionNext:"ease-out-quint"});var t=new tsvb_Sprite(tsvb_Texture_Texture.WHITE);t.width=this.title.width,t.height=this.title.height,this.titleContainer=new src_tsvb_Container,this.titleContainer.width=this.title.width,this.titleContainer.height=this.title.height,this.titleContainer.addChild(this.title),this.titleContainer.addChild(t),this.titleContainer.mask=t,this.ltWidth=Math.max(this.title.width,this.subtitle.width+this.px(15)),this.ltHeight=this.title.height+this.subtitle.height,this.titleContainer.position.x=this.offsetX(),this.titleContainer.position.y=this.sdkOptions.height-this.offsetY()-this.ltHeight-this.px(6),this.isVisible()&&(this.title.position.y=this.animations.title.setEnd())}},{key:"createRectangles",value:function(){var t=this.subtitle.height+this.px(6),e=this.ltWidth;this.rectFront=this.drawRectPrimary(0,0,e,t),this.rectFront.position.x=-e,this.animations.rectFront=new tsvb_SmoothNumber({startValue:-e,endValue:0,smoothPower:this.smoothPower.rectFront,smoothFunctionNext:"ease-out-quint"}),this.rectBack=this.drawRectSecondary(0,0,e,t),this.rectBack.position.x=e,this.animations.rectBack=new tsvb_SmoothNumber({startValue:e,endValue:0,smoothPower:this.smoothPower.rectFront,smoothFunctionNext:"ease-out-quint"});var r=new tsvb_Sprite(tsvb_Texture_Texture.WHITE);r.width=e,r.height=this.subtitle.height+this.px(6),this.subtitleContainer.addChild(r),this.subtitleContainer.mask=r,this.subtitleContainer.addChild(this.rectBack),this.subtitleContainer.addChild(this.rectFront),this.subtitleContainer.addChild(this.subtitle),this.isVisible()&&(this.rectFront.position.x=this.animations.rectFront.setEnd(),this.rectBack.position.x=this.animations.rectBack.setEnd())}},{key:"addShowFunction",value:function(){var t=this;this.showFunction=function(){t.isReady&&(t.show(),t.rectBack.position.x=t.animations.rectBack.next(),t.animations.rectBack.isEnd()&&(t.rectFront.position.x=t.animations.rectFront.next(),t.animations.rectFront.isEnd(.3)&&(t.subtitle.position.x=t.animations.subtitle.next(),t.title.position.y=t.animations.title.next(),t.animations.title.isEnd()&&t.animations.subtitle.isEnd()&&t.stopShowing())))}}},{key:"addHideFunction",value:function(){var t=this;this.hideFunction=function(){if(!t.isHiding)return t.stopHiding(),void t.hide();t.title.position.y=t.animations.title.back(),t.subtitle.position.x=t.animations.subtitle.back(),t.animations.subtitle.isStart(.5)&&(t.rectFront.position.x=t.animations.rectFront.back(),t.animations.rectFront.isStart()&&(t.rectBack.position.x=t.animations.rectBack.back())),t.isHiding=!Object.values(t.animations).reduce((function(t,e){return t&&e.isStart()}),!0)}}}])}();function tsvb_animatedBox_typeof(t){return tsvb_animatedBox_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_animatedBox_typeof(t)}function tsvb_animatedBox_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_animatedBox_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_animatedBox_toPropertyKey(n.key),n)}}function tsvb_animatedBox_createClass(t,e,r){return e&&tsvb_animatedBox_defineProperties(t.prototype,e),r&&tsvb_animatedBox_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_animatedBox_toPropertyKey(t){var e=tsvb_animatedBox_toPrimitive(t,"string");return"symbol"==tsvb_animatedBox_typeof(e)?e:e+""}function tsvb_animatedBox_toPrimitive(t,e){if("object"!=tsvb_animatedBox_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_animatedBox_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_AnimatedBox=function(){return tsvb_animatedBox_createClass((function t(e,r){tsvb_animatedBox_classCallCheck(this,t),this.padding=20,this.smoothPower=75,this.startRectValue=0,this.sdkOptions=e,this.container=new src_tsvb_Container,this.addText(r),this.addRect(r),this.addHidden(r);var n=new tsvb_Sprite(tsvb_Texture_Texture.WHITE);n.height=this.height,n.width=r.offsetX+this.width,n.position.x=-r.offsetX,this.container.addChild(n),this.container.mask=n,r.isVisible&&(this.text.position.x=this.textInAnimation.setEnd(),this.hiddenMask.position.x=this.hiddenMaskAnimation.setEnd(),this.rect.position.x=this.rectAnimation.setEnd())}),[{key:"textInAnimateFunction",value:function(){this.text.position.x=this.textInAnimation.next()}},{key:"textOutAnimateFunction",value:function(){this.text.position.x=this.textOutAnimation.next()}},{key:"textResetFunction",value:function(){this.text.position.x=2*this.px(this.padding)+this.width}},{key:"rectAnimateFunction",value:function(t){this.rect.position.x=t?this.rectAnimation.next():this.rectAnimation.back()}},{key:"hiddenMaskAnimateFunction",value:function(t){this.hiddenMask.position.x=t?this.rectAnimation.next():this.rectAnimation.back()}},{key:"destroy",value:function(){var t;null===(t=this.container)||void 0===t||t.destroy(!0)}},{key:"addText",value:function(t){this.text=new src_tsvb_Text(t.text,{fontFamily:t.fontfamily,fontSize:this.px(t.size),fill:t.colorText,wordWrapWidth:this.sdkOptions.width-2*t.offsetX-2*this.px(this.padding),wordWrap:!0,breakWords:!0}),this.height=1.2*this.text.height,this.width=this.text.width+2*this.px(this.padding);var e=2*this.px(this.padding)+this.width;this.text.position.x=e,this.text.position.y=this.px(t.size/8.5),this.textInAnimation=new tsvb_SmoothNumber({startValue:e,endValue:this.px(this.padding),smoothPower:this.smoothPower,smoothFunctionNext:"ease-out-quint"}),this.textOutAnimation=new tsvb_SmoothNumber({startValue:this.px(this.padding),endValue:-this.width-this.px(this.padding)-t.offsetX,smoothPower:this.smoothPower,smoothFunctionNext:"ease-out-quint"}),this.container.addChild(this.text)}},{key:"addRect",value:function(t){this.rect=(new src_tsvb_Graphics).beginFill(t.colorRect).drawRect(0,0,this.width,this.height).endFill(),this.startRectValue=-t.offsetX-this.width,this.rect.position.x=this.startRectValue,this.rectAnimation=new tsvb_SmoothNumber({startValue:this.startRectValue,endValue:0,smoothPower:this.smoothPower,smoothFunctionNext:"ease-out-quint"}),this.container.addChild(this.rect)}},{key:"addHidden",value:function(t){this.hiddenMask=new tsvb_Sprite(tsvb_Texture_Texture.WHITE),this.hiddenMask.width=this.width,this.hiddenMask.height=this.height,this.hiddenMask.position.x=this.startRectValue,this.hiddenMaskAnimation=new tsvb_SmoothNumber({startValue:this.startRectValue,endValue:0,smoothPower:this.smoothPower,smoothFunctionNext:"ease-out-quint"});var e=new src_tsvb_Text(t.text,{fontFamily:t.fontfamily,fontSize:this.px(t.size),fill:t.colorTextHidden,wordWrapWidth:this.sdkOptions.width-2*t.offsetX-2*this.px(this.padding),wordWrap:!0,breakWords:!0});this.hiddenContainer=new src_tsvb_Container,this.hiddenContainer.addChild(e),this.hiddenContainer.position.x=this.px(this.padding),this.hiddenContainer.position.y=this.px(t.size/8.5),this.hiddenContainer.addChild(this.hiddenMask),this.hiddenContainer.mask=this.hiddenMask,this.container.addChild(this.hiddenContainer)}},{key:"px",value:function(t){return this.sdkOptions.width/640*t}}])}();function tsvb_twoSlideRects_typeof(t){return tsvb_twoSlideRects_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_twoSlideRects_typeof(t)}function tsvb_twoSlideRects_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_twoSlideRects_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_twoSlideRects_toPropertyKey(n.key),n)}}function tsvb_twoSlideRects_createClass(t,e,r){return e&&tsvb_twoSlideRects_defineProperties(t.prototype,e),r&&tsvb_twoSlideRects_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_twoSlideRects_toPropertyKey(t){var e=tsvb_twoSlideRects_toPrimitive(t,"string");return"symbol"==tsvb_twoSlideRects_typeof(e)?e:e+""}function tsvb_twoSlideRects_toPrimitive(t,e){if("object"!=tsvb_twoSlideRects_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_twoSlideRects_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_twoSlideRects_callSuper(t,e,r){return e=tsvb_twoSlideRects_getPrototypeOf(e),tsvb_twoSlideRects_possibleConstructorReturn(t,tsvb_twoSlideRects_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_twoSlideRects_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_twoSlideRects_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_twoSlideRects_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_twoSlideRects_assertThisInitialized(t)}function tsvb_twoSlideRects_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_twoSlideRects_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_twoSlideRects_isNativeReflectConstruct=function(){return!!t})()}function tsvb_twoSlideRects_getPrototypeOf(t){return tsvb_twoSlideRects_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_twoSlideRects_getPrototypeOf(t)}function tsvb_twoSlideRects_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_twoSlideRects_setPrototypeOf(t,e)}function tsvb_twoSlideRects_setPrototypeOf(t,e){return tsvb_twoSlideRects_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_twoSlideRects_setPrototypeOf(t,e)}var tsvb_twoSlideRects_fonts={title:{cyrillic:"https://fonts.gstatic.com/s/geologica/v1/oY1o8evIr7j9P3TN9YwNAdyjzUyDKkKdAGOJh1UlCDUIhAIdhCZOn1fLsig7jfvCCPHZckU8H3G11_z-_OZqD8Hsc-ASAEWn.woff2",latin:"https://fonts.gstatic.com/s/geologica/v1/oY1o8evIr7j9P3TN9YwNAdyjzUyDKkKdAGOJh1UlCDUIhAIdhCZOn1fLsig7jfvCCPHZckU8H3G11_z-_OZqD8Hsc-QSAA.woff2"},subtitle:{cyrillic:"https://fonts.gstatic.com/s/geologica/v1/oY1o8evIr7j9P3TN9YwNAdyjzUyDKkKdAGOJh1UlCDUIhAIdhCZOn1fLsig7jfvCCPHZckU8H3G11_z-_OZqDx_rc-ASAEWn.woff2",latin:"https://fonts.gstatic.com/s/geologica/v1/oY1o8evIr7j9P3TN9YwNAdyjzUyDKkKdAGOJh1UlCDUIhAIdhCZOn1fLsig7jfvCCPHZckU8H3G11_z-_OZqDx_rc-QSAA.woff2"}},tsvb_LtTwoSlideRects=function(t){function e(t,r){var n;return tsvb_twoSlideRects_classCallCheck(this,e),(n=tsvb_twoSlideRects_callSuper(this,e,[t,r])).isTitleTextShown=!1,n.isTitleRectHidden=!1,n.isSubtitleTextShown=!1,n.isSubtitleRectHidden=!1,n.delay=300,n.gap=3,n.isReady=!1,n.addShowFunction(),n.addHideFunction(),Promise.all([n.loadFont("title",tsvb_twoSlideRects_fonts.title.cyrillic),n.loadFont("title",tsvb_twoSlideRects_fonts.title.latin),n.loadFont("subtitle",tsvb_twoSlideRects_fonts.subtitle.cyrillic),n.loadFont("subtitle",tsvb_twoSlideRects_fonts.subtitle.latin)]).finally((function(){n.isReady=!0,n.render()})),n}return tsvb_twoSlideRects_inherits(e,tsvb_LowerThird),tsvb_twoSlideRects_createClass(e,[{key:"render",value:function(){var t,e,r,n;this.container.removeChild(null===(t=this.titleBox)||void 0===t?void 0:t.container),null===(e=this.titleBox)||void 0===e||e.destroy(),this.container.removeChild(null===(r=this.subtitleBox)||void 0===r?void 0:r.container),null===(n=this.subtitleBox)||void 0===n||n.destroy(),this.subtitleBox=new tsvb_AnimatedBox(this.sdkOptions,{fontfamily:this.fontFamily("subtitle"),text:this.options.text.subtitle,colorText:this.options.color.primary,colorTextHidden:16777215,colorRect:this.options.color.primary,size:12,isVisible:this.isVisible(),offsetX:this.offsetX()}),this.subtitleBox.container.position.x=this.offsetX(),this.subtitleBox.container.position.y=this.sdkOptions.height-this.offsetY()-this.subtitleBox.height,this.titleBox=new tsvb_AnimatedBox(this.sdkOptions,{fontfamily:this.fontFamily("title"),text:this.options.text.title,colorText:this.options.color.primary,colorTextHidden:2236962,colorRect:this.options.color.secondary,size:25,isVisible:this.isVisible(),offsetX:this.offsetX()}),this.titleBox.container.position.x=this.offsetX(),this.titleBox.container.position.y=this.sdkOptions.height-this.offsetY()-this.titleBox.height-this.subtitleBox.height-this.px(this.gap),this.container.addChild(this.titleBox.container),this.container.addChild(this.subtitleBox.container)}},{key:"addShowFunction",value:function(){var t=this;this.showFunction=function(){var e,r;t.isReady&&(t.isTitleRectHidden=!1,t.isSubtitleRectHidden=!1,null===(e=t.titleBox)||void 0===e||e.textOutAnimation.reset(),null===(r=t.subtitleBox)||void 0===r||r.textOutAnimation.reset(),t.show(),t.titleBox.textInAnimateFunction(),t.titleBox.textInAnimation.isEnd(.8)&&setTimeout((function(){return t.isTitleTextShown=!0}),t.delay),t.isTitleTextShown&&(t.titleBox.rectAnimateFunction(!0),t.titleBox.hiddenMaskAnimateFunction(!0)),t.subtitleBox.textInAnimateFunction(),t.subtitleBox.textInAnimation.isEnd(.8)&&setTimeout((function(){t.isSubtitleTextShown=!0}),t.delay),t.isSubtitleTextShown&&(t.subtitleBox.rectAnimateFunction(!0),t.subtitleBox.hiddenMaskAnimateFunction(!0)),t.titleBox.rectAnimation.isEnd()&&t.subtitleBox.rectAnimation.isEnd()&&t.stopShowing())}}},{key:"addHideFunction",value:function(){var t=this;this.hideFunction=function(){if(t.isTitleTextShown=!1,t.isSubtitleTextShown=!1,t.titleBox.textInAnimation.reset(),t.subtitleBox.textInAnimation.reset(),!t.isHiding)return t.stopHiding(),t.hide(),t.titleBox.textResetFunction(),void t.subtitleBox.textResetFunction();t.titleBox.rectAnimateFunction(!1),t.titleBox.hiddenMaskAnimateFunction(!1),t.titleBox.rectAnimation.isStart()&&setTimeout((function(){return t.isTitleRectHidden=!0}),t.delay),t.isTitleRectHidden&&t.titleBox.textOutAnimateFunction(),t.subtitleBox.rectAnimateFunction(!1),t.subtitleBox.hiddenMaskAnimateFunction(!1),t.subtitleBox.rectAnimation.isStart()&&setTimeout((function(){return t.isSubtitleRectHidden=!0}),t.delay),t.isSubtitleRectHidden&&t.subtitleBox.textOutAnimateFunction(),t.isHiding=!t.titleBox.textOutAnimation.isEnd()&&!t.subtitleBox.textOutAnimation.isEnd()}}}])}();function tsvb_callbackStore_typeof(t){return tsvb_callbackStore_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_callbackStore_typeof(t)}function tsvb_callbackStore_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_callbackStore_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_callbackStore_toPropertyKey(n.key),n)}}function tsvb_callbackStore_createClass(t,e,r){return e&&tsvb_callbackStore_defineProperties(t.prototype,e),r&&tsvb_callbackStore_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_callbackStore_toPropertyKey(t){var e=tsvb_callbackStore_toPrimitive(t,"string");return"symbol"==tsvb_callbackStore_typeof(e)?e:e+""}function tsvb_callbackStore_toPrimitive(t,e){if("object"!=tsvb_callbackStore_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_callbackStore_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_CallbackStore=function(){return tsvb_callbackStore_createClass((function t(){tsvb_callbackStore_classCallCheck(this,t),this.store=new Map}),[{key:"setCallback",value:function(t,e){return"function"!=typeof e?(this.store.delete(t),!1):(this.store.set(t,e),!0)}},{key:"getCallback",value:function(t){return this.store.get(t)}},{key:"call",value:function(t){var e=this.store.get(t);if("function"==typeof e)return e()}}])}(),tsvb_promiseManager=__webpack_require__(7036),tsvb_fix_webm_duration=__webpack_require__(1707),tsvb_fix_webm_duration_default=__webpack_require__.n(tsvb_fix_webm_duration);function tsvb_timer_typeof(t){return tsvb_timer_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_timer_typeof(t)}function tsvb_timer_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_timer_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_timer_toPropertyKey(n.key),n)}}function tsvb_timer_createClass(t,e,r){return e&&tsvb_timer_defineProperties(t.prototype,e),r&&tsvb_timer_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_timer_toPropertyKey(t){var e=tsvb_timer_toPrimitive(t,"string");return"symbol"==tsvb_timer_typeof(e)?e:e+""}function tsvb_timer_toPrimitive(t,e){if("object"!=tsvb_timer_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_timer_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var tsvb_Timer=function(){return tsvb_timer_createClass((function t(){tsvb_timer_classCallCheck(this,t),this.state="inactive",this._duration=0,this.timeStart=0}),[{key:"duration",get:function(){return"active"===this.state?Date.now()-this.timeStart+this._duration:this._duration}},{key:"start",value:function(){"inactive"===this.state&&(this._duration=0,this.state="active",this.timeStart=Date.now())}},{key:"stop",value:function(){"inactive"!==this.state&&("active"===this.state&&(this._duration=this._duration+Date.now()-this.timeStart),this.state="inactive")}},{key:"pause",value:function(){"active"===this.state&&(this.state="paused",this._duration=this._duration+Date.now()-this.timeStart)}},{key:"resume",value:function(){"paused"===this.state&&(this.state="active",this.timeStart=Date.now())}}])}();function tsvb_recorder_regeneratorRuntime(){tsvb_recorder_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_recorder_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_recorder_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_recorder_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_recorder_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_recorder_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_recorder_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_recorder_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_recorder_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_recorder_toPropertyKey(n.key),n)}}function tsvb_recorder_createClass(t,e,r){return e&&tsvb_recorder_defineProperties(t.prototype,e),r&&tsvb_recorder_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_recorder_toPropertyKey(t){var e=tsvb_recorder_toPrimitive(t,"string");return"symbol"==tsvb_recorder_typeof(e)?e:e+""}function tsvb_recorder_toPrimitive(t,e){if("object"!=tsvb_recorder_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_recorder_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_recorder_typeof(t){return tsvb_recorder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_recorder_typeof(t)}var tsvb_recorder_decorate=function(t,e,r,n){var i,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"===("undefined"==typeof Reflect?"undefined":tsvb_recorder_typeof(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,r,o):i(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},tsvb_recorder_metadata=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":tsvb_recorder_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tsvb_Recorder=function(){return tsvb_recorder_createClass((function t(){tsvb_recorder_classCallCheck(this,t),this.onStartFunction=function(){},this.blobPromise=new tsvb_promiseManager.P,this.timer=new tsvb_Timer}),[{key:"removeTracks",value:function(t){var e=this;if(this.stream){("audio"===t?e.stream.getAudioTracks():"video"===t?e.stream.getVideoTracks():e.stream.getTracks()).forEach((function(t){e.stream.removeTrack(t)}))}}},{key:"initRecorder",value:function(t){var e=this;this.isActive()&&this.stop(),this.recorder=new MediaRecorder(t,{mimeType:this.mimeType}),this.recorder.ondataavailable=function(t){return e.blobPromise.resolve(t.data)}}},{key:"start",value:function(){return!!this.recorder&&("inactive"===this.recorder.state&&(this.blobPromise.createPromise(),this.recorder.start(),this.timer.start(),this.onStartFunction(),!0))}},{key:"resume",value:function(){return!!this.recorder&&("paused"===this.recorder.state&&(this.recorder.resume(),this.timer.resume(),!0))}},{key:"pause",value:function(){return!!this.recorder&&("recording"===this.recorder.state&&(this.recorder.pause(),this.timer.pause(),!0))}},{key:"stop",value:function(){return!!this.recorder&&("inactive"!==this.recorder.state&&(this.recorder.stop(),this.timer.stop(),!0))}},{key:"getRecord",value:(t=tsvb_recorder_asyncToGenerator(tsvb_recorder_regeneratorRuntime().mark((function t(){var e;return tsvb_recorder_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("inactive"===this.recorder.state){t.next=2;break}throw"[ recorder ]: Cannot get blob. First you need to stop the record.";case 2:return t.next=4,this.blobPromise.promise;case 4:if(e=t.sent){t.next=7;break}return t.abrupt("return",void 0);case 7:return t.next=9,tsvb_fix_webm_duration_default()(e,this.timer.duration,{logger:!1});case 9:return t.abrupt("return",e);case 10:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"setVideoTrack",value:function(t){t&&(this.removeTracks("video"),this.stream||(this.stream=new MediaStream),this.stream.addTrack(t),this.initRecorder(this.stream))}},{key:"setSDKVideoTrack",value:function(t){this.sdkVideoTrack=t,this.setVideoTrack(t)}},{key:"setAudioTracks",value:function(t){if(0!==t.length){if(this.removeTracks("audio"),this.stream||(this.stream=new MediaStream),1===t.length)return this.stream.addTrack(t[0]),void this.initRecorder(this.stream);var e=new AudioContext,r=e.createMediaStreamDestination();t.forEach((function(t){var n=new MediaStream;n.addTrack(t),e.createMediaStreamSource(n).connect(r)}));var n=r.stream;this.stream.addTrack(n.getAudioTracks()[0]),this.initRecorder(this.stream)}}},{key:"setMimeType",value:function(t){MediaRecorder.isTypeSupported(t)?(this.mimeType=t,this.recorder&&this.stream&&this.initRecorder(this.stream)):tsvb_errorBus.bv.notify({message:"mimeType ".concat(t," is not supported."),emitter:tsvb_errorBus.JK.RECORDER})}},{key:"onStart",value:function(t){"function"==typeof t&&(this.onStartFunction=t)}},{key:"isActive",value:function(){var t,e;return"recording"===(null===(t=this.recorder)||void 0===t?void 0:t.state)||"paused"===(null===(e=this.recorder)||void 0===e?void 0:e.state)}},{key:"getDuration",value:function(){return this.timer.duration}},{key:"getSDKTracks",value:function(){return{sdkAudioTrack:this.sdkAudioTrack,sdkVideoTrack:this.sdkVideoTrack}}}]);var t}();function tsvb_Options_typeof(t){return tsvb_Options_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_Options_typeof(t)}function tsvb_Options_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_Options_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_Options_toPropertyKey(n.key),n)}}function tsvb_Options_createClass(t,e,r){return e&&tsvb_Options_defineProperties(t.prototype,e),r&&tsvb_Options_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_Options_toPropertyKey(t){var e=tsvb_Options_toPrimitive(t,"string");return"symbol"==tsvb_Options_typeof(e)?e:e+""}function tsvb_Options_toPrimitive(t,e){if("object"!=tsvb_Options_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_Options_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_Options_callSuper(t,e,r){return e=tsvb_Options_getPrototypeOf(e),tsvb_Options_possibleConstructorReturn(t,tsvb_Options_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_Options_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_Options_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_Options_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_Options_assertThisInitialized(t)}function tsvb_Options_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_Options_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_Options_isNativeReflectConstruct=function(){return!!t})()}function tsvb_Options_getPrototypeOf(t){return tsvb_Options_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_Options_getPrototypeOf(t)}function tsvb_Options_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_Options_setPrototypeOf(t,e)}function tsvb_Options_setPrototypeOf(t,e){return tsvb_Options_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_Options_setPrototypeOf(t,e)}tsvb_Recorder=tsvb_recorder_decorate([(0,tsvb_stats.Y)("recorder"),tsvb_recorder_metadata("design:paramtypes",[])],tsvb_Recorder);var tsvb_Options=function(t){function e(){var t;return tsvb_Options_classCallCheck(this,e),(t=tsvb_Options_callSuper(this,e)).width=1280,t.height=720,t.customWidth=1280,t.customHeight=720,t.customSize=!1,t}return tsvb_Options_inherits(e,tsvb_eventemitter3),tsvb_Options_createClass(e,[{key:"setSize",value:function(t,e){var r=!1;this.width!=t&&(this.width=t,r=!0),this.height!=e&&(this.height=e,r=!0),r&&this.emit("update",this)}},{key:"setCustomSize",value:function(t,e){this.customSize=!0,this.setSize(t,e)}},{key:"isCustomSize",value:function(){return this.customSize}},{key:"isLandscape",value:function(){return this.getAspect()>1}},{key:"getAspect",value:function(){return this.width/this.height}}])}();const tsvb_sharpnessShader="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform vec2 uStep;\nuniform float uSharpnessPower;\n\nconst float FSR_RCAS_LIMIT = 0.25 - 1.0 / 16.0;\n\nfloat calcLuma(vec3 texel) {\n  float luma = texel.b * 0.5 + (texel.r * 0.5 + texel.g);\n  return luma;\n}\n\nvec3 min4_vec3(vec3 a, vec3 b, vec3 c, vec3 d) {\n  vec3 min_ab = min(a, b);\n  vec3 min_cd = min(c, d);\n\n  return min(min_ab, min_cd);\n}\n\nvec3 max4_vec3(vec3 a, vec3 b, vec3 c, vec3 d) {\n  vec3 max_ab = max(a, b);\n  vec3 max_cd = max(c, d);\n\n  return max(max_ab, max_cd);\n}\n\nfloat max3_float(float a, float b, float c) {\n  float max_ab = max(a, b);\n\n  return max(max_ab, c);\n}\n\nfloat max5_float(float a, float b, float c, float d, float e) {\n  float max_ab = max(a, b);\n  float max_cd = max(c, d);\n  float max_ab_cd = max(max_ab, max_cd);\n\n  return max(max_ab_cd, e);\n}\n\nfloat min5_float(float a, float b, float c, float d, float e) {\n  float min_ab = min(a, b);\n  float min_cd = min(c, d);\n  float min_ab_cd = min(min_ab, min_cd);\n\n  return min(min_ab_cd, e);\n}\n\nfloat saturate(float val) {\n  return min(1.0, max(0.0, val));\n}\n\nfloat rcp(float val) {\n  return 1.0 / val;\n}\n\nvoid main() {\n  vec4 color = texture2D(uSampler, vTextureCoord);\n  // Algorithm uses minimal 3x3 pixel neighborhood.\n  //    b\n  //  d e f\n  //    h\n\n  vec3 e_texel = color.rgb;\n  vec3 b_texel = texture2D(uSampler, vTextureCoord + vec2(0, -uStep.y)).rgb;\n  vec3 h_texel = texture2D(uSampler, vTextureCoord + vec2(0, +uStep.y)).rgb;\n  vec3 d_texel = texture2D(uSampler, vTextureCoord + vec2(-uStep.x, 0)).rgb;\n  vec3 f_texel = texture2D(uSampler, vTextureCoord + vec2(+uStep.x, 0)).rgb;\n\n  float e_luma = calcLuma(e_texel);\n  float b_luma = calcLuma(b_texel);\n  float h_luma = calcLuma(h_texel);\n  float d_luma = calcLuma(d_texel);\n  float f_luma = calcLuma(f_texel);\n\n  // Min and max of ring.\n  vec3 min_ring = min4_vec3(b_texel, h_texel, d_texel, f_texel);\n  vec3 max_ring = max4_vec3(b_texel, h_texel, d_texel, f_texel);\n  // Immediate constants for peak range.\n  vec2 peakC = vec2(1.0, 1.0 * 4.0);\n  // Limiters, these need to be high precision RCPs.\n  vec3 hit_min = min_ring / (4.0 * max_ring);\n  vec3 hit_max = (1.0 - max_ring) / (4.0 * min_ring - peakC.y);\n  vec3 lobeC = max(-hit_min, hit_max);\n\n  float max_lobeC = max3_float(lobeC.r, lobeC.g, lobeC.b);\n  float lobe = max(-FSR_RCAS_LIMIT, min(max_lobeC, 0.0)) * uSharpnessPower;\n\n  // Noise detection.\n  float noise = 0.25 * b_luma + 0.25 * d_luma + 0.25 * f_luma + 0.25 * h_luma - e_luma;\n  float max_luma = max5_float(e_luma, b_luma, h_luma, d_luma, f_luma);\n  float min_luma = min5_float(e_luma, b_luma, h_luma, d_luma, f_luma);\n  noise = saturate(abs(noise) * rcp(max_luma - min_luma));\n  noise = -0.5 * noise + 1.0;\n  lobe = lobe * noise;\n\n  vec3 result = (lobe * (b_texel + d_texel + h_texel + f_texel) + e_texel) / (4.0 * lobe + 1.0);\n\n  gl_FragColor = vec4(result, color.a);\n}\n";function tsvb_filterSharpness_typeof(t){return tsvb_filterSharpness_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_filterSharpness_typeof(t)}function tsvb_filterSharpness_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_filterSharpness_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_filterSharpness_toPropertyKey(n.key),n)}}function tsvb_filterSharpness_createClass(t,e,r){return e&&tsvb_filterSharpness_defineProperties(t.prototype,e),r&&tsvb_filterSharpness_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_filterSharpness_toPropertyKey(t){var e=tsvb_filterSharpness_toPrimitive(t,"string");return"symbol"==tsvb_filterSharpness_typeof(e)?e:e+""}function tsvb_filterSharpness_toPrimitive(t,e){if("object"!=tsvb_filterSharpness_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_filterSharpness_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_filterSharpness_callSuper(t,e,r){return e=tsvb_filterSharpness_getPrototypeOf(e),tsvb_filterSharpness_possibleConstructorReturn(t,tsvb_filterSharpness_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_filterSharpness_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_filterSharpness_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_filterSharpness_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_filterSharpness_assertThisInitialized(t)}function tsvb_filterSharpness_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_filterSharpness_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_filterSharpness_isNativeReflectConstruct=function(){return!!t})()}function tsvb_filterSharpness_getPrototypeOf(t){return tsvb_filterSharpness_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_filterSharpness_getPrototypeOf(t)}function tsvb_filterSharpness_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_filterSharpness_setPrototypeOf(t,e)}function tsvb_filterSharpness_setPrototypeOf(t,e){return tsvb_filterSharpness_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_filterSharpness_setPrototypeOf(t,e)}var tsvb_FilterSharpness=function(t){function e(t){var r,n;return tsvb_filterSharpness_classCallCheck(this,e),r=tsvb_filterSharpness_callSuper(this,e,[void 0,tsvb_sharpnessShader]),t.outputResolution&&r.setOutputResolution(t.outputResolution),r.setPower(null!==(n=t.power)&&void 0!==n?n:0),r}return tsvb_filterSharpness_inherits(e,src_tsvb_Filter),tsvb_filterSharpness_createClass(e,[{key:"setOutputResolution",value:function(t){var e=1/(t.width-1),r=1/(t.height-1);this.uniforms.uStep=[e,r]}},{key:"setPower",value:function(t){t=Math.max(0,t),t=Math.min(1,t),this.uniforms.uSharpnessPower=.3*t+1}}])}(),tsvb_config_defaultConfig=function(){return{power:0}};function tsvb_sharpnessEffect_typeof(t){return tsvb_sharpnessEffect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_sharpnessEffect_typeof(t)}function tsvb_sharpnessEffect_regeneratorRuntime(){tsvb_sharpnessEffect_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_sharpnessEffect_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_sharpnessEffect_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_sharpnessEffect_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_sharpnessEffect_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_sharpnessEffect_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_sharpnessEffect_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_sharpnessEffect_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_sharpnessEffect_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_sharpnessEffect_toPropertyKey(n.key),n)}}function tsvb_sharpnessEffect_createClass(t,e,r){return e&&tsvb_sharpnessEffect_defineProperties(t.prototype,e),r&&tsvb_sharpnessEffect_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_sharpnessEffect_toPropertyKey(t){var e=tsvb_sharpnessEffect_toPrimitive(t,"string");return"symbol"==tsvb_sharpnessEffect_typeof(e)?e:e+""}function tsvb_sharpnessEffect_toPrimitive(t,e){if("object"!=tsvb_sharpnessEffect_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_sharpnessEffect_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_sharpnessEffect_callSuper(t,e,r){return e=tsvb_sharpnessEffect_getPrototypeOf(e),tsvb_sharpnessEffect_possibleConstructorReturn(t,tsvb_sharpnessEffect_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_sharpnessEffect_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_sharpnessEffect_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_sharpnessEffect_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_sharpnessEffect_assertThisInitialized(t)}function tsvb_sharpnessEffect_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_sharpnessEffect_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_sharpnessEffect_isNativeReflectConstruct=function(){return!!t})()}function tsvb_sharpnessEffect_superPropGet(t,e,r,n){var i=tsvb_sharpnessEffect_get(tsvb_sharpnessEffect_getPrototypeOf(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof i?function(t){return i.apply(r,t)}:i}function tsvb_sharpnessEffect_get(){return tsvb_sharpnessEffect_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=tsvb_sharpnessEffect_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tsvb_sharpnessEffect_get.apply(null,arguments)}function tsvb_sharpnessEffect_superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tsvb_sharpnessEffect_getPrototypeOf(t)););return t}function tsvb_sharpnessEffect_getPrototypeOf(t){return tsvb_sharpnessEffect_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_sharpnessEffect_getPrototypeOf(t)}function tsvb_sharpnessEffect_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_sharpnessEffect_setPrototypeOf(t,e)}function tsvb_sharpnessEffect_setPrototypeOf(t,e){return tsvb_sharpnessEffect_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_sharpnessEffect_setPrototypeOf(t,e)}var tsvb_SharpnessEffect=function(t){function e(t){var r;return tsvb_sharpnessEffect_classCallCheck(this,e),(r=tsvb_sharpnessEffect_callSuper(this,e,[t])).config=tsvb_config_defaultConfig(),r.filterName="sharpness",r}return tsvb_sharpnessEffect_inherits(e,tsvb_AbstractEffect),tsvb_sharpnessEffect_createClass(e,[{key:"prepare",value:function(){this.resources.texture;var t=this.sdkOptions,e=t.width,r=t.height;this.filterSharpness=new tsvb_FilterSharpness({outputResolution:{height:r,width:e}}),this.sdkOptions.on("update",this.onOptionsUpdate,this)}},{key:"onOptionsUpdate",value:function(){var t=this.sdkOptions,e=t.width,r=t.height;this.filterSharpness.setOutputResolution({height:r,width:e})}},{key:"process",value:(r=tsvb_sharpnessEffect_asyncToGenerator(tsvb_sharpnessEffect_regeneratorRuntime().mark((function t(){return tsvb_sharpnessEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled){t.next=2;break}return t.abrupt("return");case 2:this.resources.filters.set(this.filterName,this.filterSharpness);case 3:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"disable",value:function(){tsvb_sharpnessEffect_superPropGet(e,"disable",this,3)([]),this.resources.filters.delete(this.filterName)}},{key:"setConfig",value:function(t){this.setPower(t.power)}},{key:"setPower",value:function(t){void 0!==t&&(this.config.power=t,this.filterSharpness.setPower(t))}},{key:"destroy",value:function(){this.sdkOptions.off("update",this.onOptionsUpdate,this)}}]);var r}();function tsvb_FilterDrawEffects_typeof(t){return tsvb_FilterDrawEffects_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_FilterDrawEffects_typeof(t)}function tsvb_FilterDrawEffects_regeneratorRuntime(){tsvb_FilterDrawEffects_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_FilterDrawEffects_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_FilterDrawEffects_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_FilterDrawEffects_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_FilterDrawEffects_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_FilterDrawEffects_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_FilterDrawEffects_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_FilterDrawEffects_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_FilterDrawEffects_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_FilterDrawEffects_toPropertyKey(n.key),n)}}function tsvb_FilterDrawEffects_createClass(t,e,r){return e&&tsvb_FilterDrawEffects_defineProperties(t.prototype,e),r&&tsvb_FilterDrawEffects_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_FilterDrawEffects_toPropertyKey(t){var e=tsvb_FilterDrawEffects_toPrimitive(t,"string");return"symbol"==tsvb_FilterDrawEffects_typeof(e)?e:e+""}function tsvb_FilterDrawEffects_toPrimitive(t,e){if("object"!=tsvb_FilterDrawEffects_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_FilterDrawEffects_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_FilterDrawEffects_callSuper(t,e,r){return e=tsvb_FilterDrawEffects_getPrototypeOf(e),tsvb_FilterDrawEffects_possibleConstructorReturn(t,tsvb_FilterDrawEffects_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_FilterDrawEffects_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_FilterDrawEffects_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_FilterDrawEffects_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_FilterDrawEffects_assertThisInitialized(t)}function tsvb_FilterDrawEffects_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_FilterDrawEffects_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_FilterDrawEffects_isNativeReflectConstruct=function(){return!!t})()}function tsvb_FilterDrawEffects_getPrototypeOf(t){return tsvb_FilterDrawEffects_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_FilterDrawEffects_getPrototypeOf(t)}function tsvb_FilterDrawEffects_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_FilterDrawEffects_setPrototypeOf(t,e)}function tsvb_FilterDrawEffects_setPrototypeOf(t,e){return tsvb_FilterDrawEffects_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_FilterDrawEffects_setPrototypeOf(t,e)}var tsvb_FilterDrawEffect=function(t){function e(t){return tsvb_FilterDrawEffects_classCallCheck(this,e),tsvb_FilterDrawEffects_callSuper(this,e,[t])}return tsvb_FilterDrawEffects_inherits(e,tsvb_AbstractEffect),tsvb_FilterDrawEffects_createClass(e,[{key:"prepare",value:function(){var t=this.resources.texture;this.original=new tsvb_Frame(t,{width:this.sdkOptions.width,height:this.sdkOptions.height}),this.original.addBuffer("result"),this.sdkOptions.on("update",this.onOptionsUpdate,this)}},{key:"onOptionsUpdate",value:function(){this.original.resize(this.sdkOptions.width,this.sdkOptions.height)}},{key:"process",value:(r=tsvb_FilterDrawEffects_asyncToGenerator(tsvb_FilterDrawEffects_regeneratorRuntime().mark((function t(){var e=this;return tsvb_FilterDrawEffects_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.resources.filters.size){t.next=2;break}return t.abrupt("return");case 2:this.resources.filters.forEach((function(t){var r;null===(r=e.original.frame.filters)||void 0===r||r.push(t)})),this.resources.renderer.renderTo(this.original.frame,this.original.getBuffer("result")),this.resources.texture.update(this.original.getBuffer("result"),!1),this.original.frame.filters=[];case 6:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"destroy",value:function(){this.sdkOptions.off("update",this.onOptionsUpdate,this)}}]);var r}();function tsvb_MirroringEffect_typeof(t){return tsvb_MirroringEffect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_MirroringEffect_typeof(t)}function tsvb_MirroringEffect_regeneratorRuntime(){tsvb_MirroringEffect_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_MirroringEffect_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_MirroringEffect_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_MirroringEffect_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_MirroringEffect_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_MirroringEffect_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_MirroringEffect_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_MirroringEffect_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_MirroringEffect_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_MirroringEffect_toPropertyKey(n.key),n)}}function tsvb_MirroringEffect_createClass(t,e,r){return e&&tsvb_MirroringEffect_defineProperties(t.prototype,e),r&&tsvb_MirroringEffect_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_MirroringEffect_toPropertyKey(t){var e=tsvb_MirroringEffect_toPrimitive(t,"string");return"symbol"==tsvb_MirroringEffect_typeof(e)?e:e+""}function tsvb_MirroringEffect_toPrimitive(t,e){if("object"!=tsvb_MirroringEffect_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_MirroringEffect_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_MirroringEffect_callSuper(t,e,r){return e=tsvb_MirroringEffect_getPrototypeOf(e),tsvb_MirroringEffect_possibleConstructorReturn(t,tsvb_MirroringEffect_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_MirroringEffect_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_MirroringEffect_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_MirroringEffect_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_MirroringEffect_assertThisInitialized(t)}function tsvb_MirroringEffect_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_MirroringEffect_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_MirroringEffect_isNativeReflectConstruct=function(){return!!t})()}function tsvb_MirroringEffect_superPropGet(t,e,r,n){var i=tsvb_MirroringEffect_get(tsvb_MirroringEffect_getPrototypeOf(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof i?function(t){return i.apply(r,t)}:i}function tsvb_MirroringEffect_get(){return tsvb_MirroringEffect_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=tsvb_MirroringEffect_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tsvb_MirroringEffect_get.apply(null,arguments)}function tsvb_MirroringEffect_superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tsvb_MirroringEffect_getPrototypeOf(t)););return t}function tsvb_MirroringEffect_getPrototypeOf(t){return tsvb_MirroringEffect_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_MirroringEffect_getPrototypeOf(t)}function tsvb_MirroringEffect_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_MirroringEffect_setPrototypeOf(t,e)}function tsvb_MirroringEffect_setPrototypeOf(t,e){return tsvb_MirroringEffect_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_MirroringEffect_setPrototypeOf(t,e)}var tsvb_MirroringEffect=function(t){function e(t){var r;return tsvb_MirroringEffect_classCallCheck(this,e),(r=tsvb_MirroringEffect_callSuper(this,e,[t])).filterName="mirroring",r.filterMirror=new tsvb_FilterMirror,r}return tsvb_MirroringEffect_inherits(e,tsvb_AbstractEffect),tsvb_MirroringEffect_createClass(e,[{key:"prepare",value:function(){}},{key:"process",value:(r=tsvb_MirroringEffect_asyncToGenerator(tsvb_MirroringEffect_regeneratorRuntime().mark((function t(){return tsvb_MirroringEffect_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled){t.next=2;break}return t.abrupt("return");case 2:this.resources.filters.set(this.filterName,this.filterMirror);case 3:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"enable",value:function(){tsvb_MirroringEffect_superPropGet(e,"enable",this,3)([]),this.resources.mirror=!0}},{key:"disable",value:function(){tsvb_MirroringEffect_superPropGet(e,"disable",this,3)([]),this.resources.mirror=!1,this.resources.filters.delete(this.filterName)}},{key:"destroy",value:function(){}}]);var r}();function tsvb_FinalDrawEffects_typeof(t){return tsvb_FinalDrawEffects_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_FinalDrawEffects_typeof(t)}function tsvb_FinalDrawEffects_regeneratorRuntime(){tsvb_FinalDrawEffects_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_FinalDrawEffects_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_FinalDrawEffects_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_FinalDrawEffects_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_FinalDrawEffects_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_FinalDrawEffects_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_FinalDrawEffects_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_FinalDrawEffects_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_FinalDrawEffects_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_FinalDrawEffects_toPropertyKey(n.key),n)}}function tsvb_FinalDrawEffects_createClass(t,e,r){return e&&tsvb_FinalDrawEffects_defineProperties(t.prototype,e),r&&tsvb_FinalDrawEffects_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_FinalDrawEffects_toPropertyKey(t){var e=tsvb_FinalDrawEffects_toPrimitive(t,"string");return"symbol"==tsvb_FinalDrawEffects_typeof(e)?e:e+""}function tsvb_FinalDrawEffects_toPrimitive(t,e){if("object"!=tsvb_FinalDrawEffects_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_FinalDrawEffects_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_FinalDrawEffects_callSuper(t,e,r){return e=tsvb_FinalDrawEffects_getPrototypeOf(e),tsvb_FinalDrawEffects_possibleConstructorReturn(t,tsvb_FinalDrawEffects_isNativeReflectConstruct()?Reflect.construct(e,r||[],tsvb_FinalDrawEffects_getPrototypeOf(t).constructor):e.apply(t,r))}function tsvb_FinalDrawEffects_possibleConstructorReturn(t,e){if(e&&("object"==tsvb_FinalDrawEffects_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tsvb_FinalDrawEffects_assertThisInitialized(t)}function tsvb_FinalDrawEffects_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tsvb_FinalDrawEffects_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tsvb_FinalDrawEffects_isNativeReflectConstruct=function(){return!!t})()}function tsvb_FinalDrawEffects_getPrototypeOf(t){return tsvb_FinalDrawEffects_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tsvb_FinalDrawEffects_getPrototypeOf(t)}function tsvb_FinalDrawEffects_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tsvb_FinalDrawEffects_setPrototypeOf(t,e)}function tsvb_FinalDrawEffects_setPrototypeOf(t,e){return tsvb_FinalDrawEffects_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tsvb_FinalDrawEffects_setPrototypeOf(t,e)}var tsvb_FinalDrawEffects_classPrivateFieldSet=function(t,e,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(t,r):i?i.value=r:e.set(t,r),r},tsvb_FinalDrawEffects_classPrivateFieldGet=function(t,e,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(t):n?n.value:e.get(t)},tsvb_FinalDrawEffect_original,tsvb_FinalDrawEffect=function(t){function e(t){var r;return tsvb_FinalDrawEffects_classCallCheck(this,e),r=tsvb_FinalDrawEffects_callSuper(this,e,[t]),tsvb_FinalDrawEffect_original.set(r,void 0),r}return tsvb_FinalDrawEffects_inherits(e,tsvb_AbstractEffect),tsvb_FinalDrawEffects_createClass(e,[{key:"prepare",value:function(){var t=this.resources.texture,e=this.sdkOptions,r=e.width,n=e.height;tsvb_FinalDrawEffects_classPrivateFieldSet(this,tsvb_FinalDrawEffect_original,new tsvb_Frame(t,{width:r,height:n}),"f"),tsvb_FinalDrawEffects_classPrivateFieldGet(this,tsvb_FinalDrawEffect_original,"f").addBuffer("result"),this.sdkOptions.on("update",this.onOptionsUpdate,this)}},{key:"onOptionsUpdate",value:function(){var t=this.sdkOptions,e=t.width,r=t.height;tsvb_FinalDrawEffects_classPrivateFieldGet(this,tsvb_FinalDrawEffect_original,"f").resize(e,r)}},{key:"process",value:(r=tsvb_FinalDrawEffects_asyncToGenerator(tsvb_FinalDrawEffects_regeneratorRuntime().mark((function t(){return tsvb_FinalDrawEffects_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.resources.renderer.addToEffects(tsvb_FinalDrawEffects_classPrivateFieldGet(this,tsvb_FinalDrawEffect_original,"f").frame),this.resources.renderer.addStatistics(),this.resources.renderer.render(),this.resources.renderer.removeStatistics(),this.resources.renderer.removeFromEffects(tsvb_FinalDrawEffects_classPrivateFieldGet(this,tsvb_FinalDrawEffect_original,"f").frame);case 5:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"destroy",value:function(){this.sdkOptions.off("update",this.onOptionsUpdate,this)}}]);var r}(),tsvb_isWebGL2Supported;function src_tsvb_isWebGL2Supported(){if(void 0!==tsvb_isWebGL2Supported)return tsvb_isWebGL2Supported;try{var t=document.createElement("canvas").getContext("webgl2");tsvb_isWebGL2Supported=t instanceof WebGL2RenderingContext}catch(t){tsvb_isWebGL2Supported=!1}return tsvb_isWebGL2Supported}function tsvb_tsvb_toConsumableArray(t){return tsvb_tsvb_arrayWithoutHoles(t)||tsvb_tsvb_iterableToArray(t)||tsvb_tsvb_unsupportedIterableToArray(t)||tsvb_tsvb_nonIterableSpread()}function tsvb_tsvb_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tsvb_tsvb_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return tsvb_tsvb_arrayLikeToArray(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tsvb_tsvb_arrayLikeToArray(t,e):void 0}}function tsvb_tsvb_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function tsvb_tsvb_arrayWithoutHoles(t){if(Array.isArray(t))return tsvb_tsvb_arrayLikeToArray(t)}function tsvb_tsvb_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function tsvb_tsvb_regeneratorRuntime(){tsvb_tsvb_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var s=e&&e.prototype instanceof b?e:b,o=Object.create(s.prototype),a=new k(n||[]);return i(o,"_invoke",{value:O(t,r,a)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",p="executing",v="completed",y={};function b(){}function _(){}function m(){}var g={};l(g,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,o)&&(g=x);var T=m.prototype=b.prototype=Object.create(g);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==tsvb_tsvb_typeof(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}})}function O(e,r,n){var i=f;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===s)throw o;return{value:t,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=P(a,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=h(e,r,n);if("normal"===l.type){if(i=n.done?v:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=v,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var s=h(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,y;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(tsvb_tsvb_typeof(e)+" is not iterable")}return _.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:_,configurable:!0}),_.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),l(T,u,"Generator"),l(T,o,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function tsvb_tsvb_asyncGeneratorStep(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function tsvb_tsvb_asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function o(t){tsvb_tsvb_asyncGeneratorStep(s,n,i,o,a,"next",t)}function a(t){tsvb_tsvb_asyncGeneratorStep(s,n,i,o,a,"throw",t)}o(void 0)}))}}function tsvb_tsvb_classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tsvb_tsvb_defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tsvb_tsvb_toPropertyKey(n.key),n)}}function tsvb_tsvb_createClass(t,e,r){return e&&tsvb_tsvb_defineProperties(t.prototype,e),r&&tsvb_tsvb_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tsvb_tsvb_toPropertyKey(t){var e=tsvb_tsvb_toPrimitive(t,"string");return"symbol"==tsvb_tsvb_typeof(e)?e:e+""}function tsvb_tsvb_toPrimitive(t,e){if("object"!=tsvb_tsvb_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tsvb_tsvb_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function tsvb_tsvb_typeof(t){return tsvb_tsvb_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tsvb_tsvb_typeof(t)}tsvb_FinalDrawEffect_original=new WeakMap;var tsvb_tsvb_decorate=function(t,e,r,n){var i,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"===("undefined"==typeof Reflect?"undefined":tsvb_tsvb_typeof(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,r,o):i(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},tsvb_tsvb_metadata=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":tsvb_tsvb_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tsvb_tsvb_classPrivateFieldGet=function(t,e,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(t):n?n.value:e.get(t)},tsvb_tsvb_classPrivateFieldSet=function(t,e,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(t,r):i?i.value=r:e.set(t,r),r},tsvb_tsvb_abortController,tsvb_tsvb=function(){return tsvb_tsvb_createClass((function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;tsvb_tsvb_classCallCheck(this,t),this.outputFrameFormat="RGBX",this.components=new Proxy({},tsvb_componentsProxyHandler),tsvb_tsvb_abortController.set(this,void 0),this.customer_id=e,tsvb_src_settings.yy.CUSTOMER_ID=e,tsvb_src_settings.yy.setVersion(),tsvb_user_uid.W.getInstance().getUID(this.customer_id),tsvb_stats.Uz.Instance.setCustomerID(this.customer_id),r&&(this.custom_inference=tsvb_MLInferenceFactory.getInference("custom"),this.custom_inference.sessionManager.setBackend(r)),this.onnx_inference=tsvb_MLInferenceFactory.getInference("onnx"),this.sdkOptions=new tsvb_Options,this.recorder=new tsvb_Recorder,this.callbackStore=new tsvb_CallbackStore,this.colorFilterEffect=new tsvb_ColorFilterEffect(this.sdkOptions),this.customResolutionEffect=new tsvb_CustomResolution(this.sdkOptions),this.sharpnessEffect=new tsvb_SharpnessEffect(this.sdkOptions),this.mirroringEffect=new tsvb_MirroringEffect(this.sdkOptions),this.filterDrawEffect=new tsvb_FilterDrawEffect(this.sdkOptions),this.finalDrawEffect=new tsvb_FinalDrawEffect(this.sdkOptions),this.sdkOptions.on("update",this.onOptionsUpdate,this)}),[{key:"onOptionsUpdate",value:function(t){Object.values(this.components).forEach((function(t){return t.render()})),this.virtualBackgroundEffect&&this.setSegmentationPreset(this.virtualBackgroundEffect.settings.preset)}},{key:"isSupported",value:function(){return src_tsvb_isWebGL2Supported()}},{key:"cache",value:(n=tsvb_tsvb_asyncToGenerator(tsvb_tsvb_regeneratorRuntime().mark((function t(){var e,r,n=arguments;return tsvb_tsvb_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]&&n[0],r=!1,this.custom_inference&&(r=!0),t.abrupt("return",this.onnx_inference.sessionManager.cache(e,r));case 4:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"preload",value:(r=tsvb_tsvb_asyncToGenerator(tsvb_tsvb_regeneratorRuntime().mark((function t(){var e;return tsvb_tsvb_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=!1,this.custom_inference&&(e=!0),t.abrupt("return",this.onnx_inference.sessionManager.preload(e));case 3:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"config",value:function(t){t.hasOwnProperty("app_env")&&(tsvb_src_settings.yy.APP_ENV=t.app_env),t.hasOwnProperty("api_url")&&(tsvb_src_settings.yy.API_URL=t.api_url),t.hasOwnProperty("model_url")&&(tsvb_src_settings.yy.MODEL_URL=t.model_url),t.hasOwnProperty("sdk_url")&&(tsvb_src_settings.yy.SDK_URL=t.sdk_url),t.hasOwnProperty("provider")&&(tsvb_src_settings.yy.PROVIDER=t.provider),t.hasOwnProperty("preset")&&(tsvb_src_settings.yy.PRESET=t.preset),t.hasOwnProperty("proxy")&&(tsvb_src_settings.yy.PROXY=t.proxy),t.hasOwnProperty("stats")&&(tsvb_src_settings.yy.STATS=t.stats),t.hasOwnProperty("wasmPaths")&&Object.keys(t.wasmPaths).length&&(tsvb_src_settings.yy.WASM_PATHS=Object.assign(tsvb_src_settings.yy.WASM_PATHS,t.wasmPaths)),t.hasOwnProperty("presets")&&Object.keys(t.presets).length&&(tsvb_src_settings.yy.PRESETS=Object.assign(tsvb_src_settings.yy.PRESETS,t.presets)),t.hasOwnProperty("models")&&Object.keys(t.models).length&&(tsvb_src_settings.yy.MODELS=Object.assign(tsvb_src_settings.yy.MODELS,t.models)),t.hasOwnProperty("effects")&&Object.keys(t.effects).length&&(tsvb_src_settings.yy.EFFECTS=tsvb_tsvb_toConsumableArray(t.effects))}},{key:"init",value:(e=tsvb_tsvb_asyncToGenerator(tsvb_tsvb_regeneratorRuntime().mark((function t(e){var r,n,i,s=this;return tsvb_tsvb_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.aborted){t.next=2;break}return t.abrupt("return");case 2:if(this.streamProcessor&&(this.streamProcessor.destroy(),this.effectProcessor.destroy()),n="requestAnimationFrameCallback","MediaStreamTrackProcessor"in window&&"MediaStreamTrackGenerator"in window?(this.streamProcessor=tsvb_StreamProcessorFactory.getStreamProcessor("transform",this.sdkOptions),n="MediaStreamTrackProcessor"):"requestVideoFrameCallback"in HTMLVideoElement.prototype?(this.streamProcessor=tsvb_StreamProcessorFactory.getStreamProcessor("videocallback",this.sdkOptions),n="requestVideoFrameCallback"):this.streamProcessor=tsvb_StreamProcessorFactory.getStreamProcessor("animationcallback",this.sdkOptions),tsvb_errorBus.bv.notify({message:"".concat(n," supported"),type:tsvb_errorBus.By.INFO,emitter:tsvb_errorBus.JK.TSVB}),this.streamProcessor.onFrameDraw(this.callbackStore.getCallback("onFrameDraw")),this.streamProcessor.onChangeInputResolution(this.callbackStore.getCallback("onChangeInputResolution")),i=new tsvb_renderer_Renderer(this.sdkOptions,this.outputFrameFormat),this.streamProcessor.setRenderer(i),this.effectProcessor=new tsvb_EffectProcessor(i,this.components),!e.aborted&&tsvb_src_settings.yy.isEffectExist(tsvb_src_settings.y$.CUSTOM_RESOLUTION)&&this.effectProcessor.addEffect(this.customResolutionEffect),!e.aborted&&tsvb_src_settings.yy.isEffectExist(tsvb_src_settings.y$.MIRRORING)&&this.effectProcessor.addEffect(this.mirroringEffect),!tsvb_src_settings.yy.isEffectExist(tsvb_src_settings.y$.LOW_LIGHT)){t.next=17;break}return this.lowLightEffect=new tsvb_LowLightEffect(this.sdkOptions,this.customer_id),t.next=17,this.lowLightEffect.init(this.onnx_inference).then((function(){if(!e.aborted){s.effectProcessor.addEffect(s.lowLightEffect);var t=s.callbackStore.getCallback("onLowLightSuccess");s.lowLightEffect.onSuccess(t)}})).catch((function(){}));case 17:if(!e.aborted&&tsvb_src_settings.yy.isEffectExist(tsvb_src_settings.y$.COLOR_FILTER)&&this.effectProcessor.addEffect(this.colorFilterEffect),!e.aborted&&tsvb_src_settings.yy.isEffectExist(tsvb_src_settings.y$.SHARPNESS)&&this.effectProcessor.addEffect(this.sharpnessEffect),!tsvb_src_settings.yy.isEffectExist(tsvb_src_settings.y$.COLOR_CORRECTION)){t.next=23;break}return this.colorCorrectorEffect=new tsvb_ColorCorrectorEffect(this.sdkOptions,this.customer_id),t.next=23,this.colorCorrectorEffect.init(this.onnx_inference).then((function(){e.aborted||s.effectProcessor.addEffect(s.colorCorrectorEffect)})).catch((function(){}));case 23:if(e.aborted||this.effectProcessor.addEffect(this.filterDrawEffect),!tsvb_src_settings.yy.isEffectExist(tsvb_src_settings.y$.SMART_ZOOM)){t.next=28;break}return this.smartZoomEffect=new tsvb_SmartZoomEffect(this.sdkOptions,this.customer_id),t.next=28,this.smartZoomEffect.init(this.onnx_inference).then((function(){e.aborted||s.effectProcessor.addEffect(s.smartZoomEffect)})).catch((function(){}));case 28:if(!tsvb_src_settings.yy.isEffectExist(tsvb_src_settings.y$.VIRTUAL_BACKGROUND)){t.next=32;break}return this.virtualBackgroundEffect=new tsvb_VirtualBackgroundEffect(this.sdkOptions,this.customer_id),t.next=32,this.virtualBackgroundEffect.init(null!==(r=this.custom_inference)&&void 0!==r?r:this.onnx_inference).then((function(){e.aborted||s.effectProcessor.addEffect(s.virtualBackgroundEffect)})).catch((function(){}));case 32:this.streamProcessor.useEffectProcessor(this.effectProcessor),this.callbackStore.call("onReady");case 34:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"getCustomerId",value:function(){return this.customer_id}},{key:"useStream",value:function(t,e){var r;if(t.getVideoTracks().length){var n=t.getVideoTracks()[0].getSettings();if(e?this.sdkOptions.setCustomSize(e.width,e.height):this.sdkOptions.setSize(n.width,n.height),Object.values(this.components).forEach((function(t){return t.render()})),tsvb_tsvb_classPrivateFieldGet(this,tsvb_tsvb_abortController,"f")&&tsvb_tsvb_classPrivateFieldGet(this,tsvb_tsvb_abortController,"f").abort(),tsvb_tsvb_classPrivateFieldSet(this,tsvb_tsvb_abortController,new AbortController,"f"),this.init(tsvb_tsvb_classPrivateFieldGet(this,tsvb_tsvb_abortController,"f").signal),this.streamProcessor.useStream(t),this.streamProcessor.getInputVideoTrack()){this.streamProcessor.process();var i=null===(r=this.streamProcessor.getStream())||void 0===r?void 0:r.getVideoTracks()[0];i&&this.recorder.setSDKVideoTrack(i)}else tsvb_errorBus.bv.notify({message:"There is no input videoTrack to process",emitter:tsvb_errorBus.JK.TSVB})}else tsvb_errorBus.bv.notify({message:"There is no input videoTrack in the Media Stream",emitter:tsvb_errorBus.JK.TSVB})}},{key:"setSegmentationPreset",value:(t=tsvb_tsvb_asyncToGenerator(tsvb_tsvb_regeneratorRuntime().mark((function t(e){var r;return tsvb_tsvb_regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.virtualBackgroundEffect){t.next=2;break}return t.abrupt("return",!1);case 2:if(!this.onnx_inference.isGPU(tsvb_ModelType.SEGMENTATION)||["quality","balanced"].includes(e)){t.next=5;break}return tsvb_errorBus.bv.notify({message:"WebGPU backend support only quality and balanced presets",emitter:tsvb_errorBus.JK.TSVB}),t.abrupt("return",!1);case 5:return this.effectProcessor.hasFrames?this.effectProcessor.pause():this.streamProcessor.pause(),this.streamProcessor.clearBuffers(),this.streamProcessor.clearBuffers(),t.next=10,this.virtualBackgroundEffect.setPreset(e);case 10:return t.next=12,this.virtualBackgroundEffect.init(null!==(r=this.custom_inference)&&void 0!==r?r:this.onnx_inference);case 12:return this.effectProcessor.hasFrames?this.effectProcessor.unpause():this.streamProcessor.unpause(),t.abrupt("return",!0);case 14:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSegmentationPreset",value:function(){return this.virtualBackgroundEffect.getPreset()}},{key:"setBackgroundColor",value:function(t){this.virtualBackgroundEffect.setBackgroundColor(t)}},{key:"getStream",value:function(){return this.streamProcessor.getStream()}},{key:"toCanvas",value:function(t){this.streamProcessor.renderToCanvas(t)}},{key:"setFpsLimit",value:function(t){return!!this.streamProcessor&&(this.streamProcessor.setFpsLimit(t),!0)}},{key:"showFps",value:function(){return!!this.streamProcessor&&(this.streamProcessor.showFps(),!0)}},{key:"hideFps",value:function(){return!!this.streamProcessor&&(this.streamProcessor.hideFps(),!0)}},{key:"freeze",value:function(){return!!this.effectProcessor&&(this.effectProcessor.pause(),!0)}},{key:"unfreeze",value:function(){return!!this.effectProcessor&&(this.effectProcessor.unpause(),!0)}},{key:"enableBeautification",value:function(){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.enableBeautification(),!0)}},{key:"disableBeautification",value:function(){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.disableBeautification(),!0)}},{key:"setBoundaryMode",value:function(t){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.setBoundaryMode(t),!0)}},{key:"setBackgroundFitMode",value:function(t){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.setBackgroundFitMode(t),!0)}},{key:"setBoundaryLevel",value:function(t){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.setBoundaryLevel(t),!0)}},{key:"setBeautificationLevel",value:function(t){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.setBeautificationLevel(t),!0)}},{key:"setBlur",value:function(t){if(!this.virtualBackgroundEffect)return!1;var e=15*Math.cbrt(this.sdkOptions.height*this.sdkOptions.width)/67;return this.virtualBackgroundEffect.setBlur(Math.round(t*e)),!0}},{key:"clearBlur",value:function(){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.clearBlur(),!0)}},{key:"setBackground",value:function(t){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.setBackground(t),!0)}},{key:"clearBackground",value:function(){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.clearBackground(),!0)}},{key:"enableFrameSkipping",value:function(){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.enableFrameSkipping(),!0)}},{key:"disableFrameSkipping",value:function(){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.disableFrameSkipping(),!0)}},{key:"setLayout",value:function(t){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.setLayout(t),!0)}},{key:"setLayoutMode",value:function(t){return!!this.virtualBackgroundEffect&&(this.virtualBackgroundEffect.setLayoutMode(t),!0)}},{key:"setCustomLayout",value:function(t){if(!this.virtualBackgroundEffect)return!1;var e={};return void 0!==t.xOffset&&(e.xOffset=t.xOffset*this.sdkOptions.width),void 0!==t.yOffset&&(e.yOffset=t.yOffset*this.sdkOptions.height),void 0!==t.size&&(e.width=t.size*this.sdkOptions.width,e.height=t.size*this.sdkOptions.height),this.virtualBackgroundEffect.setCustomLayout(e),!0}},{key:"setFaceArea",value:function(t){return!!this.smartZoomEffect&&(t=Math.max(t,.01),t=Math.min(t,1),this.smartZoomEffect.setConfig("faceAreaProportion",t),!0)}},{key:"setFaceDetectorAccuracy",value:function(t){return!!this.smartZoomEffect&&(t=Math.max(t,.2),t=Math.min(t,1),this.smartZoomEffect.setConfig("faceDetectorAccuracy",t),!0)}},{key:"getDetectedFaces",value:function(){return this.smartZoomEffect?this.smartZoomEffect.getFaces():[]}},{key:"setSmartZoomSmoothing",value:function(t){return!!this.smartZoomEffect&&(t=Math.max(t,.01),t=Math.min(t,1),this.smartZoomEffect.setConfig("smoothPower",100*t),!0)}},{key:"setSmartZoomSensitivity",value:function(t){return!!this.smartZoomEffect&&(t=Math.max(t,0),t=Math.min(t,1),this.smartZoomEffect.setConfig("sensitivityValue",t),!0)}},{key:"setSmartZoomPerod",value:function(t){return!!this.smartZoomEffect&&(t=Math.max(t,0),t=Math.min(t,1e3),this.smartZoomEffect.setConfig("faceDetectorPediod_ms",t),!0)}},{key:"switchDrawFaceSquare",value:function(t){return!!this.smartZoomEffect&&(this.smartZoomEffect.setConfig("isFaceSquareDrawingEnabled",t),!0)}},{key:"switchDrawPreFaceSquare",value:function(t){return!!this.smartZoomEffect&&(this.smartZoomEffect.setConfig("isPreFaceSquareDrawingEnabled",t),!0)}},{key:"enableSmartZoom",value:function(){return!!this.smartZoomEffect&&(this.smartZoomEffect.enable(),!0)}},{key:"disableSmartZoom",value:function(){return!!this.smartZoomEffect&&(this.smartZoomEffect.disable(),!0)}},{key:"enableColorCorrector",value:function(){return!!this.colorCorrectorEffect&&(this.colorCorrectorEffect.enable(),!0)}},{key:"disableColorCorrector",value:function(){return!!this.colorCorrectorEffect&&(this.colorCorrectorEffect.disable(),!0)}},{key:"enableMirroring",value:function(){return!!this.mirroringEffect&&(this.mirroringEffect.enable(),!0)}},{key:"disableMirroring",value:function(){return!!this.mirroringEffect&&(this.mirroringEffect.disable(),!0)}},{key:"enableColorFilter",value:function(){return!!this.colorFilterEffect&&(this.colorFilterEffect.enable(),!0)}},{key:"disableColorFilter",value:function(){return!!this.colorFilterEffect&&(this.colorFilterEffect.disable(),!0)}},{key:"setColorFilterConfig",value:function(t){return!!this.colorFilterEffect&&(this.colorFilterEffect.setConfig(t),!0)}},{key:"setFilterPart",value:function(t){return!!this.colorCorrectorEffect&&(this.colorCorrectorEffect.setConfig("filterPart",t),!0)}},{key:"setColorCorrectorPeriod",value:function(t){return!!this.colorCorrectorEffect&&(t=Math.max(t,0),t=Math.min(t,5e3),this.colorCorrectorEffect.setConfig("modelPediod_ms",t),!0)}},{key:"setColorCorrectorPower",value:function(t){return!!this.colorCorrectorEffect&&(t=Math.max(t,0),t=Math.min(t,1),this.colorCorrectorEffect.setConfig("cc_power",t),!0)}},{key:"enableLowLightEffect",value:function(){return!!this.lowLightEffect&&(this.lowLightEffect.enable(),!0)}},{key:"disableLowLightEffect",value:function(){return!!this.lowLightEffect&&(this.lowLightEffect.disable(),!0)}},{key:"setLowLightEffectConfig",value:function(t){return!!this.lowLightEffect&&(this.lowLightEffect.setConfig(t),!0)}},{key:"setLowLightEffectPower",value:function(t){return this.setLowLightEffectConfig({power:t}),!0}},{key:"enableSharpnessEffect",value:function(){return!!this.sharpnessEffect&&(this.sharpnessEffect.enable(),!0)}},{key:"disableSharpnessEffect",value:function(){return!!this.sharpnessEffect&&(this.sharpnessEffect.disable(),!0)}},{key:"setSharpnessEffectConfig",value:function(t){return!!this.sharpnessEffect&&(this.sharpnessEffect.setConfig(t),!0)}},{key:"clear",value:function(){return!!this.streamProcessor&&(this.streamProcessor.destroy(),!0)}},{key:"run",value:function(){return this.streamProcessor&&(this.streamProcessor.isRunning=!0),!0}},{key:"stop",value:function(){return this.streamProcessor&&(this.streamProcessor.isRunning=!1),!0}},{key:"enablePipelineSkipping",value:function(){var t;null===(t=this.effectProcessor)||void 0===t||t.enablePipelineSkipping()}},{key:"disablePipelineSkipping",value:function(){var t;null===(t=this.effectProcessor)||void 0===t||t.disablePipelineSkipping()}},{key:"getEffectProcessor",value:function(){return this.effectProcessor}},{key:"createComponent",value:function(t){return new tsvb_componentsMap[t.component](this.sdkOptions,t.options)}},{key:"addComponent",value:function(t,e){this.components[e]=t}},{key:"getComponentConstructor",value:function(t){return tsvb_componentsMap[t]}},{key:"setOutputResolution",value:function(t){this.streamProcessor&&this.streamProcessor.setOutputResolution(t.width,t.height)}},{key:"clearOutputResolution",value:function(){this.streamProcessor&&this.streamProcessor.clearOutputResolution()}},{key:"setOutputFrameFormat",value:function(t){this.outputFrameFormat=t}},{key:"onReady",set:function(t){this.callbackStore.setCallback("onReady",t)}},{key:"onError",value:function(t){tsvb_errorBus.bv.subscribe(t)}},{key:"onFrame",set:function(t){var e;this.callbackStore.setCallback("onFrameDraw",t),null===(e=this.streamProcessor)||void 0===e||e.onFrameDraw(t)}},{key:"onChangeInputResolution",value:function(t){var e;this.callbackStore.setCallback("onChangeInputResolution",t),null===(e=this.streamProcessor)||void 0===e||e.onChangeInputResolution(t)}},{key:"onAuthRequest",value:function(t){this.onnx_inference&&this.onnx_inference.sessionManager.onAuth(t)}},{key:"onColorFilterSuccess",value:function(t){this.callbackStore.setCallback("onColorFilterSuccess",t),this.colorFilterEffect.onSuccess(t)}},{key:"onLowLightSuccess",value:function(t){var e;this.callbackStore.setCallback("onLowLightSuccess",t),null===(e=this.lowLightEffect)||void 0===e||e.onSuccess(t)}}]);var t,e,r,n}();tsvb_tsvb_abortController=new WeakMap,tsvb_tsvb=tsvb_tsvb_decorate([(0,tsvb_stats.Y)("tsvb"),tsvb_tsvb_metadata("design:paramtypes",[String,Object])],tsvb_tsvb);var tsvb_componentsMap={overlay_screen:tsvb_OverlayScreen,watermark:tsvb_Watermark,lowerthird_1:tsvb_LtLeftTextbox,lowerthird_2:tsvb_LtHorizontalMirror,lowerthird_3:tsvb_LtSlideBold,lowerthird_4:tsvb_LtDoubleSlideRect,lowerthird_5:tsvb_LtTwoSlideRects,stickers:tsvb_Stickers},__webpack_exports__tsvb=__webpack_exports__.o;export{__webpack_exports__tsvb as tsvb};